(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-vendors"],{"1fb5":function(t,e,r){"use strict";e.byteLength=c,e.toByteArray=p,e.fromByteArray=m;for(var n=[],i=[],o="undefined"!==typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,l=s.length;a<l;++a)n[a]=s[a],i[s.charCodeAt(a)]=a;function u(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");-1===r&&(r=e);var n=r===e?0:4-r%4;return[r,n]}function c(t){var e=u(t),r=e[0],n=e[1];return 3*(r+n)/4-n}function h(t,e,r){return 3*(e+r)/4-r}function p(t){for(var e,r=u(t),n=r[0],s=r[1],a=new o(h(t,n,s)),l=0,c=s>0?n-4:n,p=0;p<c;p+=4)e=i[t.charCodeAt(p)]<<18|i[t.charCodeAt(p+1)]<<12|i[t.charCodeAt(p+2)]<<6|i[t.charCodeAt(p+3)],a[l++]=e>>16&255,a[l++]=e>>8&255,a[l++]=255&e;return 2===s&&(e=i[t.charCodeAt(p)]<<2|i[t.charCodeAt(p+1)]>>4,a[l++]=255&e),1===s&&(e=i[t.charCodeAt(p)]<<10|i[t.charCodeAt(p+1)]<<4|i[t.charCodeAt(p+2)]>>2,a[l++]=e>>8&255,a[l++]=255&e),a}function f(t){return n[t>>18&63]+n[t>>12&63]+n[t>>6&63]+n[63&t]}function d(t,e,r){for(var n,i=[],o=e;o<r;o+=3)n=(t[o]<<16&16711680)+(t[o+1]<<8&65280)+(255&t[o+2]),i.push(f(n));return i.join("")}function m(t){for(var e,r=t.length,i=r%3,o=[],s=16383,a=0,l=r-i;a<l;a+=s)o.push(d(t,a,a+s>l?l:a+s));return 1===i?(e=t[r-1],o.push(n[e>>2]+n[e<<4&63]+"==")):2===i&&(e=(t[r-2]<<8)+t[r-1],o.push(n[e>>10]+n[e>>4&63]+n[e<<2&63]+"=")),o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},2877:function(t,e,r){"use strict";function n(t,e,r,n,i,o,s,a){var l,u="function"===typeof t?t.options:t;if(e&&(u.render=e,u.staticRenderFns=r,u._compiled=!0),n&&(u.functional=!0),o&&(u._scopeId="data-v-"+o),s?(l=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"===typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),i&&i.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(s)},u._ssrRegister=l):i&&(l=a?function(){i.call(this,this.$root.$options.shadowRoot)}:i),l)if(u.functional){u._injectStyles=l;var c=u.render;u.render=function(t,e){return l.call(e),c(t,e)}}else{var h=u.beforeCreate;u.beforeCreate=h?[].concat(h,l):[l]}return{exports:t,options:u}}r.d(e,"a",function(){return n})},"2b0e":function(t,e,r){"use strict";(function(t){
/*!
 * Vue.js v2.5.22
 * (c) 2014-2019 Evan You
 * Released under the MIT License.
 */
var r=Object.freeze({});function n(t){return void 0===t||null===t}function i(t){return void 0!==t&&null!==t}function o(t){return!0===t}function s(t){return!1===t}function a(t){return"string"===typeof t||"number"===typeof t||"symbol"===typeof t||"boolean"===typeof t}function l(t){return null!==t&&"object"===typeof t}var u=Object.prototype.toString;function c(t){return"[object Object]"===u.call(t)}function h(t){return"[object RegExp]"===u.call(t)}function p(t){var e=parseFloat(String(t));return e>=0&&Math.floor(e)===e&&isFinite(t)}function f(t){return null==t?"":"object"===typeof t?JSON.stringify(t,null,2):String(t)}function d(t){var e=parseFloat(t);return isNaN(e)?t:e}function m(t,e){for(var r=Object.create(null),n=t.split(","),i=0;i<n.length;i++)r[n[i]]=!0;return e?function(t){return r[t.toLowerCase()]}:function(t){return r[t]}}m("slot,component",!0);var g=m("key,ref,slot,slot-scope,is");function y(t,e){if(t.length){var r=t.indexOf(e);if(r>-1)return t.splice(r,1)}}var _=Object.prototype.hasOwnProperty;function v(t,e){return _.call(t,e)}function x(t){var e=Object.create(null);return function(r){var n=e[r];return n||(e[r]=t(r))}}var b=/-(\w)/g,w=x(function(t){return t.replace(b,function(t,e){return e?e.toUpperCase():""})}),E=x(function(t){return t.charAt(0).toUpperCase()+t.slice(1)}),S=/\B([A-Z])/g,I=x(function(t){return t.replace(S,"-$1").toLowerCase()});function T(t,e){function r(r){var n=arguments.length;return n?n>1?t.apply(e,arguments):t.call(e,r):t.call(e)}return r._length=t.length,r}function C(t,e){return t.bind(e)}var M=Function.prototype.bind?C:T;function A(t,e){e=e||0;var r=t.length-e,n=new Array(r);while(r--)n[r]=t[r+e];return n}function P(t,e){for(var r in e)t[r]=e[r];return t}function k(t){for(var e={},r=0;r<t.length;r++)t[r]&&P(e,t[r]);return e}function L(t,e,r){}var z=function(t,e,r){return!1},D=function(t){return t};function R(t,e){if(t===e)return!0;var r=l(t),n=l(e);if(!r||!n)return!r&&!n&&String(t)===String(e);try{var i=Array.isArray(t),o=Array.isArray(e);if(i&&o)return t.length===e.length&&t.every(function(t,r){return R(t,e[r])});if(t instanceof Date&&e instanceof Date)return t.getTime()===e.getTime();if(i||o)return!1;var s=Object.keys(t),a=Object.keys(e);return s.length===a.length&&s.every(function(r){return R(t[r],e[r])})}catch(u){return!1}}function O(t,e){for(var r=0;r<t.length;r++)if(R(t[r],e))return r;return-1}function N(t){var e=!1;return function(){e||(e=!0,t.apply(this,arguments))}}var F="data-server-rendered",B=["component","directive","filter"],j=["beforeCreate","created","beforeMount","mounted","beforeUpdate","updated","beforeDestroy","destroyed","activated","deactivated","errorCaptured"],U={optionMergeStrategies:Object.create(null),silent:!1,productionTip:!1,devtools:!1,performance:!1,errorHandler:null,warnHandler:null,ignoredElements:[],keyCodes:Object.create(null),isReservedTag:z,isReservedAttr:z,isUnknownElement:z,getTagNamespace:L,parsePlatformTagName:D,mustUseProp:z,async:!0,_lifecycleHooks:j};function V(t){var e=(t+"").charCodeAt(0);return 36===e||95===e}function G(t,e,r,n){Object.defineProperty(t,e,{value:r,enumerable:!!n,writable:!0,configurable:!0})}var q=/[^\w.$]/;function $(t){if(!q.test(t)){var e=t.split(".");return function(t){for(var r=0;r<e.length;r++){if(!t)return;t=t[e[r]]}return t}}}var Z,X="__proto__"in{},W="undefined"!==typeof window,Y="undefined"!==typeof WXEnvironment&&!!WXEnvironment.platform,H=Y&&WXEnvironment.platform.toLowerCase(),J=W&&window.navigator.userAgent.toLowerCase(),K=J&&/msie|trident/.test(J),Q=J&&J.indexOf("msie 9.0")>0,tt=J&&J.indexOf("edge/")>0,et=(J&&J.indexOf("android"),J&&/iphone|ipad|ipod|ios/.test(J)||"ios"===H),rt=(J&&/chrome\/\d+/.test(J),{}.watch),nt=!1;if(W)try{var it={};Object.defineProperty(it,"passive",{get:function(){nt=!0}}),window.addEventListener("test-passive",null,it)}catch(as){}var ot=function(){return void 0===Z&&(Z=!W&&!Y&&"undefined"!==typeof t&&(t["process"]&&"server"===t["process"].env.VUE_ENV)),Z},st=W&&window.__VUE_DEVTOOLS_GLOBAL_HOOK__;function at(t){return"function"===typeof t&&/native code/.test(t.toString())}var lt,ut="undefined"!==typeof Symbol&&at(Symbol)&&"undefined"!==typeof Reflect&&at(Reflect.ownKeys);lt="undefined"!==typeof Set&&at(Set)?Set:function(){function t(){this.set=Object.create(null)}return t.prototype.has=function(t){return!0===this.set[t]},t.prototype.add=function(t){this.set[t]=!0},t.prototype.clear=function(){this.set=Object.create(null)},t}();var ct=L,ht=0,pt=function(){this.id=ht++,this.subs=[]};pt.prototype.addSub=function(t){this.subs.push(t)},pt.prototype.removeSub=function(t){y(this.subs,t)},pt.prototype.depend=function(){pt.target&&pt.target.addDep(this)},pt.prototype.notify=function(){var t=this.subs.slice();for(var e=0,r=t.length;e<r;e++)t[e].update()},pt.target=null;var ft=[];function dt(t){ft.push(t),pt.target=t}function mt(){ft.pop(),pt.target=ft[ft.length-1]}var gt=function(t,e,r,n,i,o,s,a){this.tag=t,this.data=e,this.children=r,this.text=n,this.elm=i,this.ns=void 0,this.context=o,this.fnContext=void 0,this.fnOptions=void 0,this.fnScopeId=void 0,this.key=e&&e.key,this.componentOptions=s,this.componentInstance=void 0,this.parent=void 0,this.raw=!1,this.isStatic=!1,this.isRootInsert=!0,this.isComment=!1,this.isCloned=!1,this.isOnce=!1,this.asyncFactory=a,this.asyncMeta=void 0,this.isAsyncPlaceholder=!1},yt={child:{configurable:!0}};yt.child.get=function(){return this.componentInstance},Object.defineProperties(gt.prototype,yt);var _t=function(t){void 0===t&&(t="");var e=new gt;return e.text=t,e.isComment=!0,e};function vt(t){return new gt(void 0,void 0,void 0,String(t))}function xt(t){var e=new gt(t.tag,t.data,t.children&&t.children.slice(),t.text,t.elm,t.context,t.componentOptions,t.asyncFactory);return e.ns=t.ns,e.isStatic=t.isStatic,e.key=t.key,e.isComment=t.isComment,e.fnContext=t.fnContext,e.fnOptions=t.fnOptions,e.fnScopeId=t.fnScopeId,e.asyncMeta=t.asyncMeta,e.isCloned=!0,e}var bt=Array.prototype,wt=Object.create(bt),Et=["push","pop","shift","unshift","splice","sort","reverse"];Et.forEach(function(t){var e=bt[t];G(wt,t,function(){var r=[],n=arguments.length;while(n--)r[n]=arguments[n];var i,o=e.apply(this,r),s=this.__ob__;switch(t){case"push":case"unshift":i=r;break;case"splice":i=r.slice(2);break}return i&&s.observeArray(i),s.dep.notify(),o})});var St=Object.getOwnPropertyNames(wt),It=!0;function Tt(t){It=t}var Ct=function(t){this.value=t,this.dep=new pt,this.vmCount=0,G(t,"__ob__",this),Array.isArray(t)?(X?Mt(t,wt):At(t,wt,St),this.observeArray(t)):this.walk(t)};function Mt(t,e){t.__proto__=e}function At(t,e,r){for(var n=0,i=r.length;n<i;n++){var o=r[n];G(t,o,e[o])}}function Pt(t,e){var r;if(l(t)&&!(t instanceof gt))return v(t,"__ob__")&&t.__ob__ instanceof Ct?r=t.__ob__:It&&!ot()&&(Array.isArray(t)||c(t))&&Object.isExtensible(t)&&!t._isVue&&(r=new Ct(t)),e&&r&&r.vmCount++,r}function kt(t,e,r,n,i){var o=new pt,s=Object.getOwnPropertyDescriptor(t,e);if(!s||!1!==s.configurable){var a=s&&s.get,l=s&&s.set;a&&!l||2!==arguments.length||(r=t[e]);var u=!i&&Pt(r);Object.defineProperty(t,e,{enumerable:!0,configurable:!0,get:function(){var e=a?a.call(t):r;return pt.target&&(o.depend(),u&&(u.dep.depend(),Array.isArray(e)&&Dt(e))),e},set:function(e){var n=a?a.call(t):r;e===n||e!==e&&n!==n||a&&!l||(l?l.call(t,e):r=e,u=!i&&Pt(e),o.notify())}})}}function Lt(t,e,r){if(Array.isArray(t)&&p(e))return t.length=Math.max(t.length,e),t.splice(e,1,r),r;if(e in t&&!(e in Object.prototype))return t[e]=r,r;var n=t.__ob__;return t._isVue||n&&n.vmCount?r:n?(kt(n.value,e,r),n.dep.notify(),r):(t[e]=r,r)}function zt(t,e){if(Array.isArray(t)&&p(e))t.splice(e,1);else{var r=t.__ob__;t._isVue||r&&r.vmCount||v(t,e)&&(delete t[e],r&&r.dep.notify())}}function Dt(t){for(var e=void 0,r=0,n=t.length;r<n;r++)e=t[r],e&&e.__ob__&&e.__ob__.dep.depend(),Array.isArray(e)&&Dt(e)}Ct.prototype.walk=function(t){for(var e=Object.keys(t),r=0;r<e.length;r++)kt(t,e[r])},Ct.prototype.observeArray=function(t){for(var e=0,r=t.length;e<r;e++)Pt(t[e])};var Rt=U.optionMergeStrategies;function Ot(t,e){if(!e)return t;for(var r,n,i,o=Object.keys(e),s=0;s<o.length;s++)r=o[s],n=t[r],i=e[r],v(t,r)?n!==i&&c(n)&&c(i)&&Ot(n,i):Lt(t,r,i);return t}function Nt(t,e,r){return r?function(){var n="function"===typeof e?e.call(r,r):e,i="function"===typeof t?t.call(r,r):t;return n?Ot(n,i):i}:e?t?function(){return Ot("function"===typeof e?e.call(this,this):e,"function"===typeof t?t.call(this,this):t)}:e:t}function Ft(t,e){var r=e?t?t.concat(e):Array.isArray(e)?e:[e]:t;return r?Bt(r):r}function Bt(t){for(var e=[],r=0;r<t.length;r++)-1===e.indexOf(t[r])&&e.push(t[r]);return e}function jt(t,e,r,n){var i=Object.create(t||null);return e?P(i,e):i}Rt.data=function(t,e,r){return r?Nt(t,e,r):e&&"function"!==typeof e?t:Nt(t,e)},j.forEach(function(t){Rt[t]=Ft}),B.forEach(function(t){Rt[t+"s"]=jt}),Rt.watch=function(t,e,r,n){if(t===rt&&(t=void 0),e===rt&&(e=void 0),!e)return Object.create(t||null);if(!t)return e;var i={};for(var o in P(i,t),e){var s=i[o],a=e[o];s&&!Array.isArray(s)&&(s=[s]),i[o]=s?s.concat(a):Array.isArray(a)?a:[a]}return i},Rt.props=Rt.methods=Rt.inject=Rt.computed=function(t,e,r,n){if(!t)return e;var i=Object.create(null);return P(i,t),e&&P(i,e),i},Rt.provide=Nt;var Ut=function(t,e){return void 0===e?t:e};function Vt(t,e){var r=t.props;if(r){var n,i,o,s={};if(Array.isArray(r)){n=r.length;while(n--)i=r[n],"string"===typeof i&&(o=w(i),s[o]={type:null})}else if(c(r))for(var a in r)i=r[a],o=w(a),s[o]=c(i)?i:{type:i};else 0;t.props=s}}function Gt(t,e){var r=t.inject;if(r){var n=t.inject={};if(Array.isArray(r))for(var i=0;i<r.length;i++)n[r[i]]={from:r[i]};else if(c(r))for(var o in r){var s=r[o];n[o]=c(s)?P({from:o},s):{from:s}}else 0}}function qt(t){var e=t.directives;if(e)for(var r in e){var n=e[r];"function"===typeof n&&(e[r]={bind:n,update:n})}}function $t(t,e,r){if("function"===typeof e&&(e=e.options),Vt(e,r),Gt(e,r),qt(e),!e._base&&(e.extends&&(t=$t(t,e.extends,r)),e.mixins))for(var n=0,i=e.mixins.length;n<i;n++)t=$t(t,e.mixins[n],r);var o,s={};for(o in t)a(o);for(o in e)v(t,o)||a(o);function a(n){var i=Rt[n]||Ut;s[n]=i(t[n],e[n],r,n)}return s}function Zt(t,e,r,n){if("string"===typeof r){var i=t[e];if(v(i,r))return i[r];var o=w(r);if(v(i,o))return i[o];var s=E(o);if(v(i,s))return i[s];var a=i[r]||i[o]||i[s];return a}}function Xt(t,e,r,n){var i=e[t],o=!v(r,t),s=r[t],a=Jt(Boolean,i.type);if(a>-1)if(o&&!v(i,"default"))s=!1;else if(""===s||s===I(t)){var l=Jt(String,i.type);(l<0||a<l)&&(s=!0)}if(void 0===s){s=Wt(n,i,t);var u=It;Tt(!0),Pt(s),Tt(u)}return s}function Wt(t,e,r){if(v(e,"default")){var n=e.default;return t&&t.$options.propsData&&void 0===t.$options.propsData[r]&&void 0!==t._props[r]?t._props[r]:"function"===typeof n&&"Function"!==Yt(e.type)?n.call(t):n}}function Yt(t){var e=t&&t.toString().match(/^\s*function (\w+)/);return e?e[1]:""}function Ht(t,e){return Yt(t)===Yt(e)}function Jt(t,e){if(!Array.isArray(e))return Ht(e,t)?0:-1;for(var r=0,n=e.length;r<n;r++)if(Ht(e[r],t))return r;return-1}function Kt(t,e,r){if(e){var n=e;while(n=n.$parent){var i=n.$options.errorCaptured;if(i)for(var o=0;o<i.length;o++)try{var s=!1===i[o].call(n,t,e,r);if(s)return}catch(as){Qt(as,n,"errorCaptured hook")}}}Qt(t,e,r)}function Qt(t,e,r){if(U.errorHandler)try{return U.errorHandler.call(null,t,e,r)}catch(as){te(as,null,"config.errorHandler")}te(t,e,r)}function te(t,e,r){if(!W&&!Y||"undefined"===typeof console)throw t;console.error(t)}var ee,re,ne=[],ie=!1;function oe(){ie=!1;var t=ne.slice(0);ne.length=0;for(var e=0;e<t.length;e++)t[e]()}var se=!1;if("undefined"!==typeof setImmediate&&at(setImmediate))re=function(){setImmediate(oe)};else if("undefined"===typeof MessageChannel||!at(MessageChannel)&&"[object MessageChannelConstructor]"!==MessageChannel.toString())re=function(){setTimeout(oe,0)};else{var ae=new MessageChannel,le=ae.port2;ae.port1.onmessage=oe,re=function(){le.postMessage(1)}}if("undefined"!==typeof Promise&&at(Promise)){var ue=Promise.resolve();ee=function(){ue.then(oe),et&&setTimeout(L)}}else ee=re;function ce(t){return t._withTask||(t._withTask=function(){se=!0;try{return t.apply(null,arguments)}finally{se=!1}})}function he(t,e){var r;if(ne.push(function(){if(t)try{t.call(e)}catch(as){Kt(as,e,"nextTick")}else r&&r(e)}),ie||(ie=!0,se?re():ee()),!t&&"undefined"!==typeof Promise)return new Promise(function(t){r=t})}var pe=new lt;function fe(t){de(t,pe),pe.clear()}function de(t,e){var r,n,i=Array.isArray(t);if(!(!i&&!l(t)||Object.isFrozen(t)||t instanceof gt)){if(t.__ob__){var o=t.__ob__.dep.id;if(e.has(o))return;e.add(o)}if(i){r=t.length;while(r--)de(t[r],e)}else{n=Object.keys(t),r=n.length;while(r--)de(t[n[r]],e)}}}var me,ge=x(function(t){var e="&"===t.charAt(0);t=e?t.slice(1):t;var r="~"===t.charAt(0);t=r?t.slice(1):t;var n="!"===t.charAt(0);return t=n?t.slice(1):t,{name:t,once:r,capture:n,passive:e}});function ye(t){function e(){var t=arguments,r=e.fns;if(!Array.isArray(r))return r.apply(null,arguments);for(var n=r.slice(),i=0;i<n.length;i++)n[i].apply(null,t)}return e.fns=t,e}function _e(t,e,r,i,s,a){var l,u,c,h;for(l in t)u=t[l],c=e[l],h=ge(l),n(u)||(n(c)?(n(u.fns)&&(u=t[l]=ye(u)),o(h.once)&&(u=t[l]=s(h.name,u,h.capture)),r(h.name,u,h.capture,h.passive,h.params)):u!==c&&(c.fns=u,t[l]=c));for(l in e)n(t[l])&&(h=ge(l),i(h.name,e[l],h.capture))}function ve(t,e,r){var s;t instanceof gt&&(t=t.data.hook||(t.data.hook={}));var a=t[e];function l(){r.apply(this,arguments),y(s.fns,l)}n(a)?s=ye([l]):i(a.fns)&&o(a.merged)?(s=a,s.fns.push(l)):s=ye([a,l]),s.merged=!0,t[e]=s}function xe(t,e,r){var o=e.options.props;if(!n(o)){var s={},a=t.attrs,l=t.props;if(i(a)||i(l))for(var u in o){var c=I(u);be(s,l,u,c,!0)||be(s,a,u,c,!1)}return s}}function be(t,e,r,n,o){if(i(e)){if(v(e,r))return t[r]=e[r],o||delete e[r],!0;if(v(e,n))return t[r]=e[n],o||delete e[n],!0}return!1}function we(t){for(var e=0;e<t.length;e++)if(Array.isArray(t[e]))return Array.prototype.concat.apply([],t);return t}function Ee(t){return a(t)?[vt(t)]:Array.isArray(t)?Ie(t):void 0}function Se(t){return i(t)&&i(t.text)&&s(t.isComment)}function Ie(t,e){var r,s,l,u,c=[];for(r=0;r<t.length;r++)s=t[r],n(s)||"boolean"===typeof s||(l=c.length-1,u=c[l],Array.isArray(s)?s.length>0&&(s=Ie(s,(e||"")+"_"+r),Se(s[0])&&Se(u)&&(c[l]=vt(u.text+s[0].text),s.shift()),c.push.apply(c,s)):a(s)?Se(u)?c[l]=vt(u.text+s):""!==s&&c.push(vt(s)):Se(s)&&Se(u)?c[l]=vt(u.text+s.text):(o(t._isVList)&&i(s.tag)&&n(s.key)&&i(e)&&(s.key="__vlist"+e+"_"+r+"__"),c.push(s)));return c}function Te(t,e){return(t.__esModule||ut&&"Module"===t[Symbol.toStringTag])&&(t=t.default),l(t)?e.extend(t):t}function Ce(t,e,r,n,i){var o=_t();return o.asyncFactory=t,o.asyncMeta={data:e,context:r,children:n,tag:i},o}function Me(t,e,r){if(o(t.error)&&i(t.errorComp))return t.errorComp;if(i(t.resolved))return t.resolved;if(o(t.loading)&&i(t.loadingComp))return t.loadingComp;if(!i(t.contexts)){var s=t.contexts=[r],a=!0,u=function(t){for(var e=0,r=s.length;e<r;e++)s[e].$forceUpdate();t&&(s.length=0)},c=N(function(r){t.resolved=Te(r,e),a?s.length=0:u(!0)}),h=N(function(e){i(t.errorComp)&&(t.error=!0,u(!0))}),p=t(c,h);return l(p)&&("function"===typeof p.then?n(t.resolved)&&p.then(c,h):i(p.component)&&"function"===typeof p.component.then&&(p.component.then(c,h),i(p.error)&&(t.errorComp=Te(p.error,e)),i(p.loading)&&(t.loadingComp=Te(p.loading,e),0===p.delay?t.loading=!0:setTimeout(function(){n(t.resolved)&&n(t.error)&&(t.loading=!0,u(!1))},p.delay||200)),i(p.timeout)&&setTimeout(function(){n(t.resolved)&&h(null)},p.timeout))),a=!1,t.loading?t.loadingComp:t.resolved}t.contexts.push(r)}function Ae(t){return t.isComment&&t.asyncFactory}function Pe(t){if(Array.isArray(t))for(var e=0;e<t.length;e++){var r=t[e];if(i(r)&&(i(r.componentOptions)||Ae(r)))return r}}function ke(t){t._events=Object.create(null),t._hasHookEvent=!1;var e=t.$options._parentListeners;e&&Re(t,e)}function Le(t,e){me.$on(t,e)}function ze(t,e){me.$off(t,e)}function De(t,e){var r=me;return function n(){var i=e.apply(null,arguments);null!==i&&r.$off(t,n)}}function Re(t,e,r){me=t,_e(e,r||{},Le,ze,De,t),me=void 0}function Oe(t){var e=/^hook:/;t.prototype.$on=function(t,r){var n=this;if(Array.isArray(t))for(var i=0,o=t.length;i<o;i++)n.$on(t[i],r);else(n._events[t]||(n._events[t]=[])).push(r),e.test(t)&&(n._hasHookEvent=!0);return n},t.prototype.$once=function(t,e){var r=this;function n(){r.$off(t,n),e.apply(r,arguments)}return n.fn=e,r.$on(t,n),r},t.prototype.$off=function(t,e){var r=this;if(!arguments.length)return r._events=Object.create(null),r;if(Array.isArray(t)){for(var n=0,i=t.length;n<i;n++)r.$off(t[n],e);return r}var o,s=r._events[t];if(!s)return r;if(!e)return r._events[t]=null,r;var a=s.length;while(a--)if(o=s[a],o===e||o.fn===e){s.splice(a,1);break}return r},t.prototype.$emit=function(t){var e=this,r=e._events[t];if(r){r=r.length>1?A(r):r;for(var n=A(arguments,1),i=0,o=r.length;i<o;i++)try{r[i].apply(e,n)}catch(as){Kt(as,e,'event handler for "'+t+'"')}}return e}}function Ne(t,e){var r={};if(!t)return r;for(var n=0,i=t.length;n<i;n++){var o=t[n],s=o.data;if(s&&s.attrs&&s.attrs.slot&&delete s.attrs.slot,o.context!==e&&o.fnContext!==e||!s||null==s.slot)(r.default||(r.default=[])).push(o);else{var a=s.slot,l=r[a]||(r[a]=[]);"template"===o.tag?l.push.apply(l,o.children||[]):l.push(o)}}for(var u in r)r[u].every(Fe)&&delete r[u];return r}function Fe(t){return t.isComment&&!t.asyncFactory||" "===t.text}function Be(t,e){e=e||{};for(var r=0;r<t.length;r++)Array.isArray(t[r])?Be(t[r],e):e[t[r].key]=t[r].fn;return e}var je=null;function Ue(t){var e=je;return je=t,function(){je=e}}function Ve(t){var e=t.$options,r=e.parent;if(r&&!e.abstract){while(r.$options.abstract&&r.$parent)r=r.$parent;r.$children.push(t)}t.$parent=r,t.$root=r?r.$root:t,t.$children=[],t.$refs={},t._watcher=null,t._inactive=null,t._directInactive=!1,t._isMounted=!1,t._isDestroyed=!1,t._isBeingDestroyed=!1}function Ge(t){t.prototype._update=function(t,e){var r=this,n=r.$el,i=r._vnode,o=Ue(r);r._vnode=t,r.$el=i?r.__patch__(i,t):r.__patch__(r.$el,t,e,!1),o(),n&&(n.__vue__=null),r.$el&&(r.$el.__vue__=r),r.$vnode&&r.$parent&&r.$vnode===r.$parent._vnode&&(r.$parent.$el=r.$el)},t.prototype.$forceUpdate=function(){var t=this;t._watcher&&t._watcher.update()},t.prototype.$destroy=function(){var t=this;if(!t._isBeingDestroyed){Ye(t,"beforeDestroy"),t._isBeingDestroyed=!0;var e=t.$parent;!e||e._isBeingDestroyed||t.$options.abstract||y(e.$children,t),t._watcher&&t._watcher.teardown();var r=t._watchers.length;while(r--)t._watchers[r].teardown();t._data.__ob__&&t._data.__ob__.vmCount--,t._isDestroyed=!0,t.__patch__(t._vnode,null),Ye(t,"destroyed"),t.$off(),t.$el&&(t.$el.__vue__=null),t.$vnode&&(t.$vnode.parent=null)}}}function qe(t,e,r){var n;return t.$el=e,t.$options.render||(t.$options.render=_t),Ye(t,"beforeMount"),n=function(){t._update(t._render(),r)},new ur(t,n,L,{before:function(){t._isMounted&&!t._isDestroyed&&Ye(t,"beforeUpdate")}},!0),r=!1,null==t.$vnode&&(t._isMounted=!0,Ye(t,"mounted")),t}function $e(t,e,n,i,o){var s=!!(o||t.$options._renderChildren||i.data.scopedSlots||t.$scopedSlots!==r);if(t.$options._parentVnode=i,t.$vnode=i,t._vnode&&(t._vnode.parent=i),t.$options._renderChildren=o,t.$attrs=i.data.attrs||r,t.$listeners=n||r,e&&t.$options.props){Tt(!1);for(var a=t._props,l=t.$options._propKeys||[],u=0;u<l.length;u++){var c=l[u],h=t.$options.props;a[c]=Xt(c,h,e,t)}Tt(!0),t.$options.propsData=e}n=n||r;var p=t.$options._parentListeners;t.$options._parentListeners=n,Re(t,n,p),s&&(t.$slots=Ne(o,i.context),t.$forceUpdate())}function Ze(t){while(t&&(t=t.$parent))if(t._inactive)return!0;return!1}function Xe(t,e){if(e){if(t._directInactive=!1,Ze(t))return}else if(t._directInactive)return;if(t._inactive||null===t._inactive){t._inactive=!1;for(var r=0;r<t.$children.length;r++)Xe(t.$children[r]);Ye(t,"activated")}}function We(t,e){if((!e||(t._directInactive=!0,!Ze(t)))&&!t._inactive){t._inactive=!0;for(var r=0;r<t.$children.length;r++)We(t.$children[r]);Ye(t,"deactivated")}}function Ye(t,e){dt();var r=t.$options[e];if(r)for(var n=0,i=r.length;n<i;n++)try{r[n].call(t)}catch(as){Kt(as,t,e+" hook")}t._hasHookEvent&&t.$emit("hook:"+e),mt()}var He=[],Je=[],Ke={},Qe=!1,tr=!1,er=0;function rr(){er=He.length=Je.length=0,Ke={},Qe=tr=!1}function nr(){var t,e;for(tr=!0,He.sort(function(t,e){return t.id-e.id}),er=0;er<He.length;er++)t=He[er],t.before&&t.before(),e=t.id,Ke[e]=null,t.run();var r=Je.slice(),n=He.slice();rr(),sr(r),ir(n),st&&U.devtools&&st.emit("flush")}function ir(t){var e=t.length;while(e--){var r=t[e],n=r.vm;n._watcher===r&&n._isMounted&&!n._isDestroyed&&Ye(n,"updated")}}function or(t){t._inactive=!1,Je.push(t)}function sr(t){for(var e=0;e<t.length;e++)t[e]._inactive=!0,Xe(t[e],!0)}function ar(t){var e=t.id;if(null==Ke[e]){if(Ke[e]=!0,tr){var r=He.length-1;while(r>er&&He[r].id>t.id)r--;He.splice(r+1,0,t)}else He.push(t);Qe||(Qe=!0,he(nr))}}var lr=0,ur=function(t,e,r,n,i){this.vm=t,i&&(t._watcher=this),t._watchers.push(this),n?(this.deep=!!n.deep,this.user=!!n.user,this.lazy=!!n.lazy,this.sync=!!n.sync,this.before=n.before):this.deep=this.user=this.lazy=this.sync=!1,this.cb=r,this.id=++lr,this.active=!0,this.dirty=this.lazy,this.deps=[],this.newDeps=[],this.depIds=new lt,this.newDepIds=new lt,this.expression="","function"===typeof e?this.getter=e:(this.getter=$(e),this.getter||(this.getter=L)),this.value=this.lazy?void 0:this.get()};ur.prototype.get=function(){var t;dt(this);var e=this.vm;try{t=this.getter.call(e,e)}catch(as){if(!this.user)throw as;Kt(as,e,'getter for watcher "'+this.expression+'"')}finally{this.deep&&fe(t),mt(),this.cleanupDeps()}return t},ur.prototype.addDep=function(t){var e=t.id;this.newDepIds.has(e)||(this.newDepIds.add(e),this.newDeps.push(t),this.depIds.has(e)||t.addSub(this))},ur.prototype.cleanupDeps=function(){var t=this.deps.length;while(t--){var e=this.deps[t];this.newDepIds.has(e.id)||e.removeSub(this)}var r=this.depIds;this.depIds=this.newDepIds,this.newDepIds=r,this.newDepIds.clear(),r=this.deps,this.deps=this.newDeps,this.newDeps=r,this.newDeps.length=0},ur.prototype.update=function(){this.lazy?this.dirty=!0:this.sync?this.run():ar(this)},ur.prototype.run=function(){if(this.active){var t=this.get();if(t!==this.value||l(t)||this.deep){var e=this.value;if(this.value=t,this.user)try{this.cb.call(this.vm,t,e)}catch(as){Kt(as,this.vm,'callback for watcher "'+this.expression+'"')}else this.cb.call(this.vm,t,e)}}},ur.prototype.evaluate=function(){this.value=this.get(),this.dirty=!1},ur.prototype.depend=function(){var t=this.deps.length;while(t--)this.deps[t].depend()},ur.prototype.teardown=function(){if(this.active){this.vm._isBeingDestroyed||y(this.vm._watchers,this);var t=this.deps.length;while(t--)this.deps[t].removeSub(this);this.active=!1}};var cr={enumerable:!0,configurable:!0,get:L,set:L};function hr(t,e,r){cr.get=function(){return this[e][r]},cr.set=function(t){this[e][r]=t},Object.defineProperty(t,r,cr)}function pr(t){t._watchers=[];var e=t.$options;e.props&&fr(t,e.props),e.methods&&br(t,e.methods),e.data?dr(t):Pt(t._data={},!0),e.computed&&yr(t,e.computed),e.watch&&e.watch!==rt&&wr(t,e.watch)}function fr(t,e){var r=t.$options.propsData||{},n=t._props={},i=t.$options._propKeys=[],o=!t.$parent;o||Tt(!1);var s=function(o){i.push(o);var s=Xt(o,e,r,t);kt(n,o,s),o in t||hr(t,"_props",o)};for(var a in e)s(a);Tt(!0)}function dr(t){var e=t.$options.data;e=t._data="function"===typeof e?mr(e,t):e||{},c(e)||(e={});var r=Object.keys(e),n=t.$options.props,i=(t.$options.methods,r.length);while(i--){var o=r[i];0,n&&v(n,o)||V(o)||hr(t,"_data",o)}Pt(e,!0)}function mr(t,e){dt();try{return t.call(e,e)}catch(as){return Kt(as,e,"data()"),{}}finally{mt()}}var gr={lazy:!0};function yr(t,e){var r=t._computedWatchers=Object.create(null),n=ot();for(var i in e){var o=e[i],s="function"===typeof o?o:o.get;0,n||(r[i]=new ur(t,s||L,L,gr)),i in t||_r(t,i,o)}}function _r(t,e,r){var n=!ot();"function"===typeof r?(cr.get=n?vr(e):xr(r),cr.set=L):(cr.get=r.get?n&&!1!==r.cache?vr(e):xr(r.get):L,cr.set=r.set||L),Object.defineProperty(t,e,cr)}function vr(t){return function(){var e=this._computedWatchers&&this._computedWatchers[t];if(e)return e.dirty&&e.evaluate(),pt.target&&e.depend(),e.value}}function xr(t){return function(){return t.call(this,this)}}function br(t,e){t.$options.props;for(var r in e)t[r]="function"!==typeof e[r]?L:M(e[r],t)}function wr(t,e){for(var r in e){var n=e[r];if(Array.isArray(n))for(var i=0;i<n.length;i++)Er(t,r,n[i]);else Er(t,r,n)}}function Er(t,e,r,n){return c(r)&&(n=r,r=r.handler),"string"===typeof r&&(r=t[r]),t.$watch(e,r,n)}function Sr(t){var e={get:function(){return this._data}},r={get:function(){return this._props}};Object.defineProperty(t.prototype,"$data",e),Object.defineProperty(t.prototype,"$props",r),t.prototype.$set=Lt,t.prototype.$delete=zt,t.prototype.$watch=function(t,e,r){var n=this;if(c(e))return Er(n,t,e,r);r=r||{},r.user=!0;var i=new ur(n,t,e,r);if(r.immediate)try{e.call(n,i.value)}catch(o){Kt(o,n,'callback for immediate watcher "'+i.expression+'"')}return function(){i.teardown()}}}function Ir(t){var e=t.$options.provide;e&&(t._provided="function"===typeof e?e.call(t):e)}function Tr(t){var e=Cr(t.$options.inject,t);e&&(Tt(!1),Object.keys(e).forEach(function(r){kt(t,r,e[r])}),Tt(!0))}function Cr(t,e){if(t){for(var r=Object.create(null),n=ut?Reflect.ownKeys(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}):Object.keys(t),i=0;i<n.length;i++){var o=n[i],s=t[o].from,a=e;while(a){if(a._provided&&v(a._provided,s)){r[o]=a._provided[s];break}a=a.$parent}if(!a)if("default"in t[o]){var l=t[o].default;r[o]="function"===typeof l?l.call(e):l}else 0}return r}}function Mr(t,e){var r,n,o,s,a;if(Array.isArray(t)||"string"===typeof t)for(r=new Array(t.length),n=0,o=t.length;n<o;n++)r[n]=e(t[n],n);else if("number"===typeof t)for(r=new Array(t),n=0;n<t;n++)r[n]=e(n+1,n);else if(l(t))for(s=Object.keys(t),r=new Array(s.length),n=0,o=s.length;n<o;n++)a=s[n],r[n]=e(t[a],a,n);return i(r)||(r=[]),r._isVList=!0,r}function Ar(t,e,r,n){var i,o=this.$scopedSlots[t];o?(r=r||{},n&&(r=P(P({},n),r)),i=o(r)||e):i=this.$slots[t]||e;var s=r&&r.slot;return s?this.$createElement("template",{slot:s},i):i}function Pr(t){return Zt(this.$options,"filters",t,!0)||D}function kr(t,e){return Array.isArray(t)?-1===t.indexOf(e):t!==e}function Lr(t,e,r,n,i){var o=U.keyCodes[e]||r;return i&&n&&!U.keyCodes[e]?kr(i,n):o?kr(o,t):n?I(n)!==e:void 0}function zr(t,e,r,n,i){if(r)if(l(r)){var o;Array.isArray(r)&&(r=k(r));var s=function(s){if("class"===s||"style"===s||g(s))o=t;else{var a=t.attrs&&t.attrs.type;o=n||U.mustUseProp(e,a,s)?t.domProps||(t.domProps={}):t.attrs||(t.attrs={})}var l=w(s);if(!(s in o)&&!(l in o)&&(o[s]=r[s],i)){var u=t.on||(t.on={});u["update:"+l]=function(t){r[s]=t}}};for(var a in r)s(a)}else;return t}function Dr(t,e){var r=this._staticTrees||(this._staticTrees=[]),n=r[t];return n&&!e?n:(n=r[t]=this.$options.staticRenderFns[t].call(this._renderProxy,null,this),Or(n,"__static__"+t,!1),n)}function Rr(t,e,r){return Or(t,"__once__"+e+(r?"_"+r:""),!0),t}function Or(t,e,r){if(Array.isArray(t))for(var n=0;n<t.length;n++)t[n]&&"string"!==typeof t[n]&&Nr(t[n],e+"_"+n,r);else Nr(t,e,r)}function Nr(t,e,r){t.isStatic=!0,t.key=e,t.isOnce=r}function Fr(t,e){if(e)if(c(e)){var r=t.on=t.on?P({},t.on):{};for(var n in e){var i=r[n],o=e[n];r[n]=i?[].concat(i,o):o}}else;return t}function Br(t){t._o=Rr,t._n=d,t._s=f,t._l=Mr,t._t=Ar,t._q=R,t._i=O,t._m=Dr,t._f=Pr,t._k=Lr,t._b=zr,t._v=vt,t._e=_t,t._u=Be,t._g=Fr}function jr(t,e,n,i,s){var a,l=s.options;v(i,"_uid")?(a=Object.create(i),a._original=i):(a=i,i=i._original);var u=o(l._compiled),c=!u;this.data=t,this.props=e,this.children=n,this.parent=i,this.listeners=t.on||r,this.injections=Cr(l.inject,i),this.slots=function(){return Ne(n,i)},u&&(this.$options=l,this.$slots=this.slots(),this.$scopedSlots=t.scopedSlots||r),l._scopeId?this._c=function(t,e,r,n){var o=Qr(a,t,e,r,n,c);return o&&!Array.isArray(o)&&(o.fnScopeId=l._scopeId,o.fnContext=i),o}:this._c=function(t,e,r,n){return Qr(a,t,e,r,n,c)}}function Ur(t,e,n,o,s){var a=t.options,l={},u=a.props;if(i(u))for(var c in u)l[c]=Xt(c,u,e||r);else i(n.attrs)&&Gr(l,n.attrs),i(n.props)&&Gr(l,n.props);var h=new jr(n,l,s,o,t),p=a.render.call(null,h._c,h);if(p instanceof gt)return Vr(p,n,h.parent,a,h);if(Array.isArray(p)){for(var f=Ee(p)||[],d=new Array(f.length),m=0;m<f.length;m++)d[m]=Vr(f[m],n,h.parent,a,h);return d}}function Vr(t,e,r,n,i){var o=xt(t);return o.fnContext=r,o.fnOptions=n,e.slot&&((o.data||(o.data={})).slot=e.slot),o}function Gr(t,e){for(var r in e)t[w(r)]=e[r]}Br(jr.prototype);var qr={init:function(t,e){if(t.componentInstance&&!t.componentInstance._isDestroyed&&t.data.keepAlive){var r=t;qr.prepatch(r,r)}else{var n=t.componentInstance=Xr(t,je);n.$mount(e?t.elm:void 0,e)}},prepatch:function(t,e){var r=e.componentOptions,n=e.componentInstance=t.componentInstance;$e(n,r.propsData,r.listeners,e,r.children)},insert:function(t){var e=t.context,r=t.componentInstance;r._isMounted||(r._isMounted=!0,Ye(r,"mounted")),t.data.keepAlive&&(e._isMounted?or(r):Xe(r,!0))},destroy:function(t){var e=t.componentInstance;e._isDestroyed||(t.data.keepAlive?We(e,!0):e.$destroy())}},$r=Object.keys(qr);function Zr(t,e,r,s,a){if(!n(t)){var u=r.$options._base;if(l(t)&&(t=u.extend(t)),"function"===typeof t){var c;if(n(t.cid)&&(c=t,t=Me(c,u,r),void 0===t))return Ce(c,e,r,s,a);e=e||{},un(t),i(e.model)&&Hr(t.options,e);var h=xe(e,t,a);if(o(t.options.functional))return Ur(t,h,e,r,s);var p=e.on;if(e.on=e.nativeOn,o(t.options.abstract)){var f=e.slot;e={},f&&(e.slot=f)}Wr(e);var d=t.options.name||a,m=new gt("vue-component-"+t.cid+(d?"-"+d:""),e,void 0,void 0,void 0,r,{Ctor:t,propsData:h,listeners:p,tag:a,children:s},c);return m}}}function Xr(t,e){var r={_isComponent:!0,_parentVnode:t,parent:e},n=t.data.inlineTemplate;return i(n)&&(r.render=n.render,r.staticRenderFns=n.staticRenderFns),new t.componentOptions.Ctor(r)}function Wr(t){for(var e=t.hook||(t.hook={}),r=0;r<$r.length;r++){var n=$r[r],i=e[n],o=qr[n];i===o||i&&i._merged||(e[n]=i?Yr(o,i):o)}}function Yr(t,e){var r=function(r,n){t(r,n),e(r,n)};return r._merged=!0,r}function Hr(t,e){var r=t.model&&t.model.prop||"value",n=t.model&&t.model.event||"input";(e.props||(e.props={}))[r]=e.model.value;var o=e.on||(e.on={}),s=o[n],a=e.model.callback;i(s)?(Array.isArray(s)?-1===s.indexOf(a):s!==a)&&(o[n]=[a].concat(s)):o[n]=a}var Jr=1,Kr=2;function Qr(t,e,r,n,i,s){return(Array.isArray(r)||a(r))&&(i=n,n=r,r=void 0),o(s)&&(i=Kr),tn(t,e,r,n,i)}function tn(t,e,r,n,o){if(i(r)&&i(r.__ob__))return _t();if(i(r)&&i(r.is)&&(e=r.is),!e)return _t();var s,a,l;(Array.isArray(n)&&"function"===typeof n[0]&&(r=r||{},r.scopedSlots={default:n[0]},n.length=0),o===Kr?n=Ee(n):o===Jr&&(n=we(n)),"string"===typeof e)?(a=t.$vnode&&t.$vnode.ns||U.getTagNamespace(e),s=U.isReservedTag(e)?new gt(U.parsePlatformTagName(e),r,n,void 0,void 0,t):r&&r.pre||!i(l=Zt(t.$options,"components",e))?new gt(e,r,n,void 0,void 0,t):Zr(l,r,t,n,e)):s=Zr(e,r,t,n);return Array.isArray(s)?s:i(s)?(i(a)&&en(s,a),i(r)&&rn(r),s):_t()}function en(t,e,r){if(t.ns=e,"foreignObject"===t.tag&&(e=void 0,r=!0),i(t.children))for(var s=0,a=t.children.length;s<a;s++){var l=t.children[s];i(l.tag)&&(n(l.ns)||o(r)&&"svg"!==l.tag)&&en(l,e,r)}}function rn(t){l(t.style)&&fe(t.style),l(t.class)&&fe(t.class)}function nn(t){t._vnode=null,t._staticTrees=null;var e=t.$options,n=t.$vnode=e._parentVnode,i=n&&n.context;t.$slots=Ne(e._renderChildren,i),t.$scopedSlots=r,t._c=function(e,r,n,i){return Qr(t,e,r,n,i,!1)},t.$createElement=function(e,r,n,i){return Qr(t,e,r,n,i,!0)};var o=n&&n.data;kt(t,"$attrs",o&&o.attrs||r,null,!0),kt(t,"$listeners",e._parentListeners||r,null,!0)}function on(t){Br(t.prototype),t.prototype.$nextTick=function(t){return he(t,this)},t.prototype._render=function(){var t,e=this,n=e.$options,i=n.render,o=n._parentVnode;o&&(e.$scopedSlots=o.data.scopedSlots||r),e.$vnode=o;try{t=i.call(e._renderProxy,e.$createElement)}catch(as){Kt(as,e,"render"),t=e._vnode}return t instanceof gt||(t=_t()),t.parent=o,t}}var sn=0;function an(t){t.prototype._init=function(t){var e=this;e._uid=sn++,e._isVue=!0,t&&t._isComponent?ln(e,t):e.$options=$t(un(e.constructor),t||{},e),e._renderProxy=e,e._self=e,Ve(e),ke(e),nn(e),Ye(e,"beforeCreate"),Tr(e),pr(e),Ir(e),Ye(e,"created"),e.$options.el&&e.$mount(e.$options.el)}}function ln(t,e){var r=t.$options=Object.create(t.constructor.options),n=e._parentVnode;r.parent=e.parent,r._parentVnode=n;var i=n.componentOptions;r.propsData=i.propsData,r._parentListeners=i.listeners,r._renderChildren=i.children,r._componentTag=i.tag,e.render&&(r.render=e.render,r.staticRenderFns=e.staticRenderFns)}function un(t){var e=t.options;if(t.super){var r=un(t.super),n=t.superOptions;if(r!==n){t.superOptions=r;var i=cn(t);i&&P(t.extendOptions,i),e=t.options=$t(r,t.extendOptions),e.name&&(e.components[e.name]=t)}}return e}function cn(t){var e,r=t.options,n=t.sealedOptions;for(var i in r)r[i]!==n[i]&&(e||(e={}),e[i]=r[i]);return e}function hn(t){this._init(t)}function pn(t){t.use=function(t){var e=this._installedPlugins||(this._installedPlugins=[]);if(e.indexOf(t)>-1)return this;var r=A(arguments,1);return r.unshift(this),"function"===typeof t.install?t.install.apply(t,r):"function"===typeof t&&t.apply(null,r),e.push(t),this}}function fn(t){t.mixin=function(t){return this.options=$t(this.options,t),this}}function dn(t){t.cid=0;var e=1;t.extend=function(t){t=t||{};var r=this,n=r.cid,i=t._Ctor||(t._Ctor={});if(i[n])return i[n];var o=t.name||r.options.name;var s=function(t){this._init(t)};return s.prototype=Object.create(r.prototype),s.prototype.constructor=s,s.cid=e++,s.options=$t(r.options,t),s["super"]=r,s.options.props&&mn(s),s.options.computed&&gn(s),s.extend=r.extend,s.mixin=r.mixin,s.use=r.use,B.forEach(function(t){s[t]=r[t]}),o&&(s.options.components[o]=s),s.superOptions=r.options,s.extendOptions=t,s.sealedOptions=P({},s.options),i[n]=s,s}}function mn(t){var e=t.options.props;for(var r in e)hr(t.prototype,"_props",r)}function gn(t){var e=t.options.computed;for(var r in e)_r(t.prototype,r,e[r])}function yn(t){B.forEach(function(e){t[e]=function(t,r){return r?("component"===e&&c(r)&&(r.name=r.name||t,r=this.options._base.extend(r)),"directive"===e&&"function"===typeof r&&(r={bind:r,update:r}),this.options[e+"s"][t]=r,r):this.options[e+"s"][t]}})}function _n(t){return t&&(t.Ctor.options.name||t.tag)}function vn(t,e){return Array.isArray(t)?t.indexOf(e)>-1:"string"===typeof t?t.split(",").indexOf(e)>-1:!!h(t)&&t.test(e)}function xn(t,e){var r=t.cache,n=t.keys,i=t._vnode;for(var o in r){var s=r[o];if(s){var a=_n(s.componentOptions);a&&!e(a)&&bn(r,o,n,i)}}}function bn(t,e,r,n){var i=t[e];!i||n&&i.tag===n.tag||i.componentInstance.$destroy(),t[e]=null,y(r,e)}an(hn),Sr(hn),Oe(hn),Ge(hn),on(hn);var wn=[String,RegExp,Array],En={name:"keep-alive",abstract:!0,props:{include:wn,exclude:wn,max:[String,Number]},created:function(){this.cache=Object.create(null),this.keys=[]},destroyed:function(){for(var t in this.cache)bn(this.cache,t,this.keys)},mounted:function(){var t=this;this.$watch("include",function(e){xn(t,function(t){return vn(e,t)})}),this.$watch("exclude",function(e){xn(t,function(t){return!vn(e,t)})})},render:function(){var t=this.$slots.default,e=Pe(t),r=e&&e.componentOptions;if(r){var n=_n(r),i=this,o=i.include,s=i.exclude;if(o&&(!n||!vn(o,n))||s&&n&&vn(s,n))return e;var a=this,l=a.cache,u=a.keys,c=null==e.key?r.Ctor.cid+(r.tag?"::"+r.tag:""):e.key;l[c]?(e.componentInstance=l[c].componentInstance,y(u,c),u.push(c)):(l[c]=e,u.push(c),this.max&&u.length>parseInt(this.max)&&bn(l,u[0],u,this._vnode)),e.data.keepAlive=!0}return e||t&&t[0]}},Sn={KeepAlive:En};function In(t){var e={get:function(){return U}};Object.defineProperty(t,"config",e),t.util={warn:ct,extend:P,mergeOptions:$t,defineReactive:kt},t.set=Lt,t.delete=zt,t.nextTick=he,t.options=Object.create(null),B.forEach(function(e){t.options[e+"s"]=Object.create(null)}),t.options._base=t,P(t.options.components,Sn),pn(t),fn(t),dn(t),yn(t)}In(hn),Object.defineProperty(hn.prototype,"$isServer",{get:ot}),Object.defineProperty(hn.prototype,"$ssrContext",{get:function(){return this.$vnode&&this.$vnode.ssrContext}}),Object.defineProperty(hn,"FunctionalRenderContext",{value:jr}),hn.version="2.5.22";var Tn=m("style,class"),Cn=m("input,textarea,option,select,progress"),Mn=function(t,e,r){return"value"===r&&Cn(t)&&"button"!==e||"selected"===r&&"option"===t||"checked"===r&&"input"===t||"muted"===r&&"video"===t},An=m("contenteditable,draggable,spellcheck"),Pn=m("allowfullscreen,async,autofocus,autoplay,checked,compact,controls,declare,default,defaultchecked,defaultmuted,defaultselected,defer,disabled,enabled,formnovalidate,hidden,indeterminate,inert,ismap,itemscope,loop,multiple,muted,nohref,noresize,noshade,novalidate,nowrap,open,pauseonexit,readonly,required,reversed,scoped,seamless,selected,sortable,translate,truespeed,typemustmatch,visible"),kn="http://www.w3.org/1999/xlink",Ln=function(t){return":"===t.charAt(5)&&"xlink"===t.slice(0,5)},zn=function(t){return Ln(t)?t.slice(6,t.length):""},Dn=function(t){return null==t||!1===t};function Rn(t){var e=t.data,r=t,n=t;while(i(n.componentInstance))n=n.componentInstance._vnode,n&&n.data&&(e=On(n.data,e));while(i(r=r.parent))r&&r.data&&(e=On(e,r.data));return Nn(e.staticClass,e.class)}function On(t,e){return{staticClass:Fn(t.staticClass,e.staticClass),class:i(t.class)?[t.class,e.class]:e.class}}function Nn(t,e){return i(t)||i(e)?Fn(t,Bn(e)):""}function Fn(t,e){return t?e?t+" "+e:t:e||""}function Bn(t){return Array.isArray(t)?jn(t):l(t)?Un(t):"string"===typeof t?t:""}function jn(t){for(var e,r="",n=0,o=t.length;n<o;n++)i(e=Bn(t[n]))&&""!==e&&(r&&(r+=" "),r+=e);return r}function Un(t){var e="";for(var r in t)t[r]&&(e&&(e+=" "),e+=r);return e}var Vn={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"},Gn=m("html,body,base,head,link,meta,style,title,address,article,aside,footer,header,h1,h2,h3,h4,h5,h6,hgroup,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,rtc,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,menuitem,summary,content,element,shadow,template,blockquote,iframe,tfoot"),qn=m("svg,animate,circle,clippath,cursor,defs,desc,ellipse,filter,font-face,foreignObject,g,glyph,image,line,marker,mask,missing-glyph,path,pattern,polygon,polyline,rect,switch,symbol,text,textpath,tspan,use,view",!0),$n=function(t){return Gn(t)||qn(t)};function Zn(t){return qn(t)?"svg":"math"===t?"math":void 0}var Xn=Object.create(null);function Wn(t){if(!W)return!0;if($n(t))return!1;if(t=t.toLowerCase(),null!=Xn[t])return Xn[t];var e=document.createElement(t);return t.indexOf("-")>-1?Xn[t]=e.constructor===window.HTMLUnknownElement||e.constructor===window.HTMLElement:Xn[t]=/HTMLUnknownElement/.test(e.toString())}var Yn=m("text,number,password,search,email,tel,url");function Hn(t){if("string"===typeof t){var e=document.querySelector(t);return e||document.createElement("div")}return t}function Jn(t,e){var r=document.createElement(t);return"select"!==t?r:(e.data&&e.data.attrs&&void 0!==e.data.attrs.multiple&&r.setAttribute("multiple","multiple"),r)}function Kn(t,e){return document.createElementNS(Vn[t],e)}function Qn(t){return document.createTextNode(t)}function ti(t){return document.createComment(t)}function ei(t,e,r){t.insertBefore(e,r)}function ri(t,e){t.removeChild(e)}function ni(t,e){t.appendChild(e)}function ii(t){return t.parentNode}function oi(t){return t.nextSibling}function si(t){return t.tagName}function ai(t,e){t.textContent=e}function li(t,e){t.setAttribute(e,"")}var ui=Object.freeze({createElement:Jn,createElementNS:Kn,createTextNode:Qn,createComment:ti,insertBefore:ei,removeChild:ri,appendChild:ni,parentNode:ii,nextSibling:oi,tagName:si,setTextContent:ai,setStyleScope:li}),ci={create:function(t,e){hi(e)},update:function(t,e){t.data.ref!==e.data.ref&&(hi(t,!0),hi(e))},destroy:function(t){hi(t,!0)}};function hi(t,e){var r=t.data.ref;if(i(r)){var n=t.context,o=t.componentInstance||t.elm,s=n.$refs;e?Array.isArray(s[r])?y(s[r],o):s[r]===o&&(s[r]=void 0):t.data.refInFor?Array.isArray(s[r])?s[r].indexOf(o)<0&&s[r].push(o):s[r]=[o]:s[r]=o}}var pi=new gt("",{},[]),fi=["create","activate","update","remove","destroy"];function di(t,e){return t.key===e.key&&(t.tag===e.tag&&t.isComment===e.isComment&&i(t.data)===i(e.data)&&mi(t,e)||o(t.isAsyncPlaceholder)&&t.asyncFactory===e.asyncFactory&&n(e.asyncFactory.error))}function mi(t,e){if("input"!==t.tag)return!0;var r,n=i(r=t.data)&&i(r=r.attrs)&&r.type,o=i(r=e.data)&&i(r=r.attrs)&&r.type;return n===o||Yn(n)&&Yn(o)}function gi(t,e,r){var n,o,s={};for(n=e;n<=r;++n)o=t[n].key,i(o)&&(s[o]=n);return s}function yi(t){var e,r,s={},l=t.modules,u=t.nodeOps;for(e=0;e<fi.length;++e)for(s[fi[e]]=[],r=0;r<l.length;++r)i(l[r][fi[e]])&&s[fi[e]].push(l[r][fi[e]]);function c(t){return new gt(u.tagName(t).toLowerCase(),{},[],void 0,t)}function h(t,e){function r(){0===--r.listeners&&p(t)}return r.listeners=e,r}function p(t){var e=u.parentNode(t);i(e)&&u.removeChild(e,t)}function f(t,e,r,n,s,a,l){if(i(t.elm)&&i(a)&&(t=a[l]=xt(t)),t.isRootInsert=!s,!d(t,e,r,n)){var c=t.data,h=t.children,p=t.tag;i(p)?(t.elm=t.ns?u.createElementNS(t.ns,p):u.createElement(p,t),w(t),v(t,h,e),i(c)&&b(t,e),_(r,t.elm,n)):o(t.isComment)?(t.elm=u.createComment(t.text),_(r,t.elm,n)):(t.elm=u.createTextNode(t.text),_(r,t.elm,n))}}function d(t,e,r,n){var s=t.data;if(i(s)){var a=i(t.componentInstance)&&s.keepAlive;if(i(s=s.hook)&&i(s=s.init)&&s(t,!1),i(t.componentInstance))return g(t,e),_(r,t.elm,n),o(a)&&y(t,e,r,n),!0}}function g(t,e){i(t.data.pendingInsert)&&(e.push.apply(e,t.data.pendingInsert),t.data.pendingInsert=null),t.elm=t.componentInstance.$el,x(t)?(b(t,e),w(t)):(hi(t),e.push(t))}function y(t,e,r,n){var o,a=t;while(a.componentInstance)if(a=a.componentInstance._vnode,i(o=a.data)&&i(o=o.transition)){for(o=0;o<s.activate.length;++o)s.activate[o](pi,a);e.push(a);break}_(r,t.elm,n)}function _(t,e,r){i(t)&&(i(r)?u.parentNode(r)===t&&u.insertBefore(t,e,r):u.appendChild(t,e))}function v(t,e,r){if(Array.isArray(e)){0;for(var n=0;n<e.length;++n)f(e[n],r,t.elm,null,!0,e,n)}else a(t.text)&&u.appendChild(t.elm,u.createTextNode(String(t.text)))}function x(t){while(t.componentInstance)t=t.componentInstance._vnode;return i(t.tag)}function b(t,r){for(var n=0;n<s.create.length;++n)s.create[n](pi,t);e=t.data.hook,i(e)&&(i(e.create)&&e.create(pi,t),i(e.insert)&&r.push(t))}function w(t){var e;if(i(e=t.fnScopeId))u.setStyleScope(t.elm,e);else{var r=t;while(r)i(e=r.context)&&i(e=e.$options._scopeId)&&u.setStyleScope(t.elm,e),r=r.parent}i(e=je)&&e!==t.context&&e!==t.fnContext&&i(e=e.$options._scopeId)&&u.setStyleScope(t.elm,e)}function E(t,e,r,n,i,o){for(;n<=i;++n)f(r[n],o,t,e,!1,r,n)}function S(t){var e,r,n=t.data;if(i(n))for(i(e=n.hook)&&i(e=e.destroy)&&e(t),e=0;e<s.destroy.length;++e)s.destroy[e](t);if(i(e=t.children))for(r=0;r<t.children.length;++r)S(t.children[r])}function I(t,e,r,n){for(;r<=n;++r){var o=e[r];i(o)&&(i(o.tag)?(T(o),S(o)):p(o.elm))}}function T(t,e){if(i(e)||i(t.data)){var r,n=s.remove.length+1;for(i(e)?e.listeners+=n:e=h(t.elm,n),i(r=t.componentInstance)&&i(r=r._vnode)&&i(r.data)&&T(r,e),r=0;r<s.remove.length;++r)s.remove[r](t,e);i(r=t.data.hook)&&i(r=r.remove)?r(t,e):e()}else p(t.elm)}function C(t,e,r,o,s){var a,l,c,h,p=0,d=0,m=e.length-1,g=e[0],y=e[m],_=r.length-1,v=r[0],x=r[_],b=!s;while(p<=m&&d<=_)n(g)?g=e[++p]:n(y)?y=e[--m]:di(g,v)?(A(g,v,o,r,d),g=e[++p],v=r[++d]):di(y,x)?(A(y,x,o,r,_),y=e[--m],x=r[--_]):di(g,x)?(A(g,x,o,r,_),b&&u.insertBefore(t,g.elm,u.nextSibling(y.elm)),g=e[++p],x=r[--_]):di(y,v)?(A(y,v,o,r,d),b&&u.insertBefore(t,y.elm,g.elm),y=e[--m],v=r[++d]):(n(a)&&(a=gi(e,p,m)),l=i(v.key)?a[v.key]:M(v,e,p,m),n(l)?f(v,o,t,g.elm,!1,r,d):(c=e[l],di(c,v)?(A(c,v,o,r,d),e[l]=void 0,b&&u.insertBefore(t,c.elm,g.elm)):f(v,o,t,g.elm,!1,r,d)),v=r[++d]);p>m?(h=n(r[_+1])?null:r[_+1].elm,E(t,h,r,d,_,o)):d>_&&I(t,e,p,m)}function M(t,e,r,n){for(var o=r;o<n;o++){var s=e[o];if(i(s)&&di(t,s))return o}}function A(t,e,r,a,l,c){if(t!==e){i(e.elm)&&i(a)&&(e=a[l]=xt(e));var h=e.elm=t.elm;if(o(t.isAsyncPlaceholder))i(e.asyncFactory.resolved)?L(t.elm,e,r):e.isAsyncPlaceholder=!0;else if(o(e.isStatic)&&o(t.isStatic)&&e.key===t.key&&(o(e.isCloned)||o(e.isOnce)))e.componentInstance=t.componentInstance;else{var p,f=e.data;i(f)&&i(p=f.hook)&&i(p=p.prepatch)&&p(t,e);var d=t.children,m=e.children;if(i(f)&&x(e)){for(p=0;p<s.update.length;++p)s.update[p](t,e);i(p=f.hook)&&i(p=p.update)&&p(t,e)}n(e.text)?i(d)&&i(m)?d!==m&&C(h,d,m,r,c):i(m)?(i(t.text)&&u.setTextContent(h,""),E(h,null,m,0,m.length-1,r)):i(d)?I(h,d,0,d.length-1):i(t.text)&&u.setTextContent(h,""):t.text!==e.text&&u.setTextContent(h,e.text),i(f)&&i(p=f.hook)&&i(p=p.postpatch)&&p(t,e)}}}function P(t,e,r){if(o(r)&&i(t.parent))t.parent.data.pendingInsert=e;else for(var n=0;n<e.length;++n)e[n].data.hook.insert(e[n])}var k=m("attrs,class,staticClass,staticStyle,key");function L(t,e,r,n){var s,a=e.tag,l=e.data,u=e.children;if(n=n||l&&l.pre,e.elm=t,o(e.isComment)&&i(e.asyncFactory))return e.isAsyncPlaceholder=!0,!0;if(i(l)&&(i(s=l.hook)&&i(s=s.init)&&s(e,!0),i(s=e.componentInstance)))return g(e,r),!0;if(i(a)){if(i(u))if(t.hasChildNodes())if(i(s=l)&&i(s=s.domProps)&&i(s=s.innerHTML)){if(s!==t.innerHTML)return!1}else{for(var c=!0,h=t.firstChild,p=0;p<u.length;p++){if(!h||!L(h,u[p],r,n)){c=!1;break}h=h.nextSibling}if(!c||h)return!1}else v(e,u,r);if(i(l)){var f=!1;for(var d in l)if(!k(d)){f=!0,b(e,r);break}!f&&l["class"]&&fe(l["class"])}}else t.data!==e.text&&(t.data=e.text);return!0}return function(t,e,r,a){if(!n(e)){var l=!1,h=[];if(n(t))l=!0,f(e,h);else{var p=i(t.nodeType);if(!p&&di(t,e))A(t,e,h,null,null,a);else{if(p){if(1===t.nodeType&&t.hasAttribute(F)&&(t.removeAttribute(F),r=!0),o(r)&&L(t,e,h))return P(e,h,!0),t;t=c(t)}var d=t.elm,m=u.parentNode(d);if(f(e,h,d._leaveCb?null:m,u.nextSibling(d)),i(e.parent)){var g=e.parent,y=x(e);while(g){for(var _=0;_<s.destroy.length;++_)s.destroy[_](g);if(g.elm=e.elm,y){for(var v=0;v<s.create.length;++v)s.create[v](pi,g);var b=g.data.hook.insert;if(b.merged)for(var w=1;w<b.fns.length;w++)b.fns[w]()}else hi(g);g=g.parent}}i(m)?I(m,[t],0,0):i(t.tag)&&S(t)}}return P(e,h,l),e.elm}i(t)&&S(t)}}var _i={create:vi,update:vi,destroy:function(t){vi(t,pi)}};function vi(t,e){(t.data.directives||e.data.directives)&&xi(t,e)}function xi(t,e){var r,n,i,o=t===pi,s=e===pi,a=wi(t.data.directives,t.context),l=wi(e.data.directives,e.context),u=[],c=[];for(r in l)n=a[r],i=l[r],n?(i.oldValue=n.value,Si(i,"update",e,t),i.def&&i.def.componentUpdated&&c.push(i)):(Si(i,"bind",e,t),i.def&&i.def.inserted&&u.push(i));if(u.length){var h=function(){for(var r=0;r<u.length;r++)Si(u[r],"inserted",e,t)};o?ve(e,"insert",h):h()}if(c.length&&ve(e,"postpatch",function(){for(var r=0;r<c.length;r++)Si(c[r],"componentUpdated",e,t)}),!o)for(r in a)l[r]||Si(a[r],"unbind",t,t,s)}var bi=Object.create(null);function wi(t,e){var r,n,i=Object.create(null);if(!t)return i;for(r=0;r<t.length;r++)n=t[r],n.modifiers||(n.modifiers=bi),i[Ei(n)]=n,n.def=Zt(e.$options,"directives",n.name,!0);return i}function Ei(t){return t.rawName||t.name+"."+Object.keys(t.modifiers||{}).join(".")}function Si(t,e,r,n,i){var o=t.def&&t.def[e];if(o)try{o(r.elm,t,r,n,i)}catch(as){Kt(as,r.context,"directive "+t.name+" "+e+" hook")}}var Ii=[ci,_i];function Ti(t,e){var r=e.componentOptions;if((!i(r)||!1!==r.Ctor.options.inheritAttrs)&&(!n(t.data.attrs)||!n(e.data.attrs))){var o,s,a,l=e.elm,u=t.data.attrs||{},c=e.data.attrs||{};for(o in i(c.__ob__)&&(c=e.data.attrs=P({},c)),c)s=c[o],a=u[o],a!==s&&Ci(l,o,s);for(o in(K||tt)&&c.value!==u.value&&Ci(l,"value",c.value),u)n(c[o])&&(Ln(o)?l.removeAttributeNS(kn,zn(o)):An(o)||l.removeAttribute(o))}}function Ci(t,e,r){t.tagName.indexOf("-")>-1?Mi(t,e,r):Pn(e)?Dn(r)?t.removeAttribute(e):(r="allowfullscreen"===e&&"EMBED"===t.tagName?"true":e,t.setAttribute(e,r)):An(e)?t.setAttribute(e,Dn(r)||"false"===r?"false":"true"):Ln(e)?Dn(r)?t.removeAttributeNS(kn,zn(e)):t.setAttributeNS(kn,e,r):Mi(t,e,r)}function Mi(t,e,r){if(Dn(r))t.removeAttribute(e);else{if(K&&!Q&&("TEXTAREA"===t.tagName||"INPUT"===t.tagName)&&"placeholder"===e&&!t.__ieph){var n=function(e){e.stopImmediatePropagation(),t.removeEventListener("input",n)};t.addEventListener("input",n),t.__ieph=!0}t.setAttribute(e,r)}}var Ai={create:Ti,update:Ti};function Pi(t,e){var r=e.elm,o=e.data,s=t.data;if(!(n(o.staticClass)&&n(o.class)&&(n(s)||n(s.staticClass)&&n(s.class)))){var a=Rn(e),l=r._transitionClasses;i(l)&&(a=Fn(a,Bn(l))),a!==r._prevClass&&(r.setAttribute("class",a),r._prevClass=a)}}var ki,Li={create:Pi,update:Pi},zi="__r",Di="__c";function Ri(t){if(i(t[zi])){var e=K?"change":"input";t[e]=[].concat(t[zi],t[e]||[]),delete t[zi]}i(t[Di])&&(t.change=[].concat(t[Di],t.change||[]),delete t[Di])}function Oi(t,e,r){var n=ki;return function i(){var o=e.apply(null,arguments);null!==o&&Fi(t,i,r,n)}}function Ni(t,e,r,n){e=ce(e),ki.addEventListener(t,e,nt?{capture:r,passive:n}:r)}function Fi(t,e,r,n){(n||ki).removeEventListener(t,e._withTask||e,r)}function Bi(t,e){if(!n(t.data.on)||!n(e.data.on)){var r=e.data.on||{},i=t.data.on||{};ki=e.elm,Ri(r),_e(r,i,Ni,Fi,Oi,e.context),ki=void 0}}var ji={create:Bi,update:Bi};function Ui(t,e){if(!n(t.data.domProps)||!n(e.data.domProps)){var r,o,s=e.elm,a=t.data.domProps||{},l=e.data.domProps||{};for(r in i(l.__ob__)&&(l=e.data.domProps=P({},l)),a)n(l[r])&&(s[r]="");for(r in l){if(o=l[r],"textContent"===r||"innerHTML"===r){if(e.children&&(e.children.length=0),o===a[r])continue;1===s.childNodes.length&&s.removeChild(s.childNodes[0])}if("value"===r){s._value=o;var u=n(o)?"":String(o);Vi(s,u)&&(s.value=u)}else s[r]=o}}}function Vi(t,e){return!t.composing&&("OPTION"===t.tagName||Gi(t,e)||qi(t,e))}function Gi(t,e){var r=!0;try{r=document.activeElement!==t}catch(as){}return r&&t.value!==e}function qi(t,e){var r=t.value,n=t._vModifiers;if(i(n)){if(n.lazy)return!1;if(n.number)return d(r)!==d(e);if(n.trim)return r.trim()!==e.trim()}return r!==e}var $i={create:Ui,update:Ui},Zi=x(function(t){var e={},r=/;(?![^(]*\))/g,n=/:(.+)/;return t.split(r).forEach(function(t){if(t){var r=t.split(n);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e});function Xi(t){var e=Wi(t.style);return t.staticStyle?P(t.staticStyle,e):e}function Wi(t){return Array.isArray(t)?k(t):"string"===typeof t?Zi(t):t}function Yi(t,e){var r,n={};if(e){var i=t;while(i.componentInstance)i=i.componentInstance._vnode,i&&i.data&&(r=Xi(i.data))&&P(n,r)}(r=Xi(t.data))&&P(n,r);var o=t;while(o=o.parent)o.data&&(r=Xi(o.data))&&P(n,r);return n}var Hi,Ji=/^--/,Ki=/\s*!important$/,Qi=function(t,e,r){if(Ji.test(e))t.style.setProperty(e,r);else if(Ki.test(r))t.style.setProperty(e,r.replace(Ki,""),"important");else{var n=eo(e);if(Array.isArray(r))for(var i=0,o=r.length;i<o;i++)t.style[n]=r[i];else t.style[n]=r}},to=["Webkit","Moz","ms"],eo=x(function(t){if(Hi=Hi||document.createElement("div").style,t=w(t),"filter"!==t&&t in Hi)return t;for(var e=t.charAt(0).toUpperCase()+t.slice(1),r=0;r<to.length;r++){var n=to[r]+e;if(n in Hi)return n}});function ro(t,e){var r=e.data,o=t.data;if(!(n(r.staticStyle)&&n(r.style)&&n(o.staticStyle)&&n(o.style))){var s,a,l=e.elm,u=o.staticStyle,c=o.normalizedStyle||o.style||{},h=u||c,p=Wi(e.data.style)||{};e.data.normalizedStyle=i(p.__ob__)?P({},p):p;var f=Yi(e,!0);for(a in h)n(f[a])&&Qi(l,a,"");for(a in f)s=f[a],s!==h[a]&&Qi(l,a,null==s?"":s)}}var no={create:ro,update:ro},io=/\s+/;function oo(t,e){if(e&&(e=e.trim()))if(t.classList)e.indexOf(" ")>-1?e.split(io).forEach(function(e){return t.classList.add(e)}):t.classList.add(e);else{var r=" "+(t.getAttribute("class")||"")+" ";r.indexOf(" "+e+" ")<0&&t.setAttribute("class",(r+e).trim())}}function so(t,e){if(e&&(e=e.trim()))if(t.classList)e.indexOf(" ")>-1?e.split(io).forEach(function(e){return t.classList.remove(e)}):t.classList.remove(e),t.classList.length||t.removeAttribute("class");else{var r=" "+(t.getAttribute("class")||"")+" ",n=" "+e+" ";while(r.indexOf(n)>=0)r=r.replace(n," ");r=r.trim(),r?t.setAttribute("class",r):t.removeAttribute("class")}}function ao(t){if(t){if("object"===typeof t){var e={};return!1!==t.css&&P(e,lo(t.name||"v")),P(e,t),e}return"string"===typeof t?lo(t):void 0}}var lo=x(function(t){return{enterClass:t+"-enter",enterToClass:t+"-enter-to",enterActiveClass:t+"-enter-active",leaveClass:t+"-leave",leaveToClass:t+"-leave-to",leaveActiveClass:t+"-leave-active"}}),uo=W&&!Q,co="transition",ho="animation",po="transition",fo="transitionend",mo="animation",go="animationend";uo&&(void 0===window.ontransitionend&&void 0!==window.onwebkittransitionend&&(po="WebkitTransition",fo="webkitTransitionEnd"),void 0===window.onanimationend&&void 0!==window.onwebkitanimationend&&(mo="WebkitAnimation",go="webkitAnimationEnd"));var yo=W?window.requestAnimationFrame?window.requestAnimationFrame.bind(window):setTimeout:function(t){return t()};function _o(t){yo(function(){yo(t)})}function vo(t,e){var r=t._transitionClasses||(t._transitionClasses=[]);r.indexOf(e)<0&&(r.push(e),oo(t,e))}function xo(t,e){t._transitionClasses&&y(t._transitionClasses,e),so(t,e)}function bo(t,e,r){var n=Eo(t,e),i=n.type,o=n.timeout,s=n.propCount;if(!i)return r();var a=i===co?fo:go,l=0,u=function(){t.removeEventListener(a,c),r()},c=function(e){e.target===t&&++l>=s&&u()};setTimeout(function(){l<s&&u()},o+1),t.addEventListener(a,c)}var wo=/\b(transform|all)(,|$)/;function Eo(t,e){var r,n=window.getComputedStyle(t),i=(n[po+"Delay"]||"").split(", "),o=(n[po+"Duration"]||"").split(", "),s=So(i,o),a=(n[mo+"Delay"]||"").split(", "),l=(n[mo+"Duration"]||"").split(", "),u=So(a,l),c=0,h=0;e===co?s>0&&(r=co,c=s,h=o.length):e===ho?u>0&&(r=ho,c=u,h=l.length):(c=Math.max(s,u),r=c>0?s>u?co:ho:null,h=r?r===co?o.length:l.length:0);var p=r===co&&wo.test(n[po+"Property"]);return{type:r,timeout:c,propCount:h,hasTransform:p}}function So(t,e){while(t.length<e.length)t=t.concat(t);return Math.max.apply(null,e.map(function(e,r){return Io(e)+Io(t[r])}))}function Io(t){return 1e3*Number(t.slice(0,-1).replace(",","."))}function To(t,e){var r=t.elm;i(r._leaveCb)&&(r._leaveCb.cancelled=!0,r._leaveCb());var o=ao(t.data.transition);if(!n(o)&&!i(r._enterCb)&&1===r.nodeType){var s=o.css,a=o.type,u=o.enterClass,c=o.enterToClass,h=o.enterActiveClass,p=o.appearClass,f=o.appearToClass,m=o.appearActiveClass,g=o.beforeEnter,y=o.enter,_=o.afterEnter,v=o.enterCancelled,x=o.beforeAppear,b=o.appear,w=o.afterAppear,E=o.appearCancelled,S=o.duration,I=je,T=je.$vnode;while(T&&T.parent)T=T.parent,I=T.context;var C=!I._isMounted||!t.isRootInsert;if(!C||b||""===b){var M=C&&p?p:u,A=C&&m?m:h,P=C&&f?f:c,k=C&&x||g,L=C&&"function"===typeof b?b:y,z=C&&w||_,D=C&&E||v,R=d(l(S)?S.enter:S);0;var O=!1!==s&&!Q,F=Ao(L),B=r._enterCb=N(function(){O&&(xo(r,P),xo(r,A)),B.cancelled?(O&&xo(r,M),D&&D(r)):z&&z(r),r._enterCb=null});t.data.show||ve(t,"insert",function(){var e=r.parentNode,n=e&&e._pending&&e._pending[t.key];n&&n.tag===t.tag&&n.elm._leaveCb&&n.elm._leaveCb(),L&&L(r,B)}),k&&k(r),O&&(vo(r,M),vo(r,A),_o(function(){xo(r,M),B.cancelled||(vo(r,P),F||(Mo(R)?setTimeout(B,R):bo(r,a,B)))})),t.data.show&&(e&&e(),L&&L(r,B)),O||F||B()}}}function Co(t,e){var r=t.elm;i(r._enterCb)&&(r._enterCb.cancelled=!0,r._enterCb());var o=ao(t.data.transition);if(n(o)||1!==r.nodeType)return e();if(!i(r._leaveCb)){var s=o.css,a=o.type,u=o.leaveClass,c=o.leaveToClass,h=o.leaveActiveClass,p=o.beforeLeave,f=o.leave,m=o.afterLeave,g=o.leaveCancelled,y=o.delayLeave,_=o.duration,v=!1!==s&&!Q,x=Ao(f),b=d(l(_)?_.leave:_);0;var w=r._leaveCb=N(function(){r.parentNode&&r.parentNode._pending&&(r.parentNode._pending[t.key]=null),v&&(xo(r,c),xo(r,h)),w.cancelled?(v&&xo(r,u),g&&g(r)):(e(),m&&m(r)),r._leaveCb=null});y?y(E):E()}function E(){w.cancelled||(!t.data.show&&r.parentNode&&((r.parentNode._pending||(r.parentNode._pending={}))[t.key]=t),p&&p(r),v&&(vo(r,u),vo(r,h),_o(function(){xo(r,u),w.cancelled||(vo(r,c),x||(Mo(b)?setTimeout(w,b):bo(r,a,w)))})),f&&f(r,w),v||x||w())}}function Mo(t){return"number"===typeof t&&!isNaN(t)}function Ao(t){if(n(t))return!1;var e=t.fns;return i(e)?Ao(Array.isArray(e)?e[0]:e):(t._length||t.length)>1}function Po(t,e){!0!==e.data.show&&To(e)}var ko=W?{create:Po,activate:Po,remove:function(t,e){!0!==t.data.show?Co(t,e):e()}}:{},Lo=[Ai,Li,ji,$i,no,ko],zo=Lo.concat(Ii),Do=yi({nodeOps:ui,modules:zo});Q&&document.addEventListener("selectionchange",function(){var t=document.activeElement;t&&t.vmodel&&Vo(t,"input")});var Ro={inserted:function(t,e,r,n){"select"===r.tag?(n.elm&&!n.elm._vOptions?ve(r,"postpatch",function(){Ro.componentUpdated(t,e,r)}):Oo(t,e,r.context),t._vOptions=[].map.call(t.options,Bo)):("textarea"===r.tag||Yn(t.type))&&(t._vModifiers=e.modifiers,e.modifiers.lazy||(t.addEventListener("compositionstart",jo),t.addEventListener("compositionend",Uo),t.addEventListener("change",Uo),Q&&(t.vmodel=!0)))},componentUpdated:function(t,e,r){if("select"===r.tag){Oo(t,e,r.context);var n=t._vOptions,i=t._vOptions=[].map.call(t.options,Bo);if(i.some(function(t,e){return!R(t,n[e])})){var o=t.multiple?e.value.some(function(t){return Fo(t,i)}):e.value!==e.oldValue&&Fo(e.value,i);o&&Vo(t,"change")}}}};function Oo(t,e,r){No(t,e,r),(K||tt)&&setTimeout(function(){No(t,e,r)},0)}function No(t,e,r){var n=e.value,i=t.multiple;if(!i||Array.isArray(n)){for(var o,s,a=0,l=t.options.length;a<l;a++)if(s=t.options[a],i)o=O(n,Bo(s))>-1,s.selected!==o&&(s.selected=o);else if(R(Bo(s),n))return void(t.selectedIndex!==a&&(t.selectedIndex=a));i||(t.selectedIndex=-1)}}function Fo(t,e){return e.every(function(e){return!R(e,t)})}function Bo(t){return"_value"in t?t._value:t.value}function jo(t){t.target.composing=!0}function Uo(t){t.target.composing&&(t.target.composing=!1,Vo(t.target,"input"))}function Vo(t,e){var r=document.createEvent("HTMLEvents");r.initEvent(e,!0,!0),t.dispatchEvent(r)}function Go(t){return!t.componentInstance||t.data&&t.data.transition?t:Go(t.componentInstance._vnode)}var qo={bind:function(t,e,r){var n=e.value;r=Go(r);var i=r.data&&r.data.transition,o=t.__vOriginalDisplay="none"===t.style.display?"":t.style.display;n&&i?(r.data.show=!0,To(r,function(){t.style.display=o})):t.style.display=n?o:"none"},update:function(t,e,r){var n=e.value,i=e.oldValue;if(!n!==!i){r=Go(r);var o=r.data&&r.data.transition;o?(r.data.show=!0,n?To(r,function(){t.style.display=t.__vOriginalDisplay}):Co(r,function(){t.style.display="none"})):t.style.display=n?t.__vOriginalDisplay:"none"}},unbind:function(t,e,r,n,i){i||(t.style.display=t.__vOriginalDisplay)}},$o={model:Ro,show:qo},Zo={name:String,appear:Boolean,css:Boolean,mode:String,type:String,enterClass:String,leaveClass:String,enterToClass:String,leaveToClass:String,enterActiveClass:String,leaveActiveClass:String,appearClass:String,appearActiveClass:String,appearToClass:String,duration:[Number,String,Object]};function Xo(t){var e=t&&t.componentOptions;return e&&e.Ctor.options.abstract?Xo(Pe(e.children)):t}function Wo(t){var e={},r=t.$options;for(var n in r.propsData)e[n]=t[n];var i=r._parentListeners;for(var o in i)e[w(o)]=i[o];return e}function Yo(t,e){if(/\d-keep-alive$/.test(e.tag))return t("keep-alive",{props:e.componentOptions.propsData})}function Ho(t){while(t=t.parent)if(t.data.transition)return!0}function Jo(t,e){return e.key===t.key&&e.tag===t.tag}var Ko=function(t){return t.tag||Ae(t)},Qo=function(t){return"show"===t.name},ts={name:"transition",props:Zo,abstract:!0,render:function(t){var e=this,r=this.$slots.default;if(r&&(r=r.filter(Ko),r.length)){0;var n=this.mode;0;var i=r[0];if(Ho(this.$vnode))return i;var o=Xo(i);if(!o)return i;if(this._leaving)return Yo(t,i);var s="__transition-"+this._uid+"-";o.key=null==o.key?o.isComment?s+"comment":s+o.tag:a(o.key)?0===String(o.key).indexOf(s)?o.key:s+o.key:o.key;var l=(o.data||(o.data={})).transition=Wo(this),u=this._vnode,c=Xo(u);if(o.data.directives&&o.data.directives.some(Qo)&&(o.data.show=!0),c&&c.data&&!Jo(o,c)&&!Ae(c)&&(!c.componentInstance||!c.componentInstance._vnode.isComment)){var h=c.data.transition=P({},l);if("out-in"===n)return this._leaving=!0,ve(h,"afterLeave",function(){e._leaving=!1,e.$forceUpdate()}),Yo(t,i);if("in-out"===n){if(Ae(o))return u;var p,f=function(){p()};ve(l,"afterEnter",f),ve(l,"enterCancelled",f),ve(h,"delayLeave",function(t){p=t})}}return i}}},es=P({tag:String,moveClass:String},Zo);delete es.mode;var rs={props:es,beforeMount:function(){var t=this,e=this._update;this._update=function(r,n){var i=Ue(t);t.__patch__(t._vnode,t.kept,!1,!0),t._vnode=t.kept,i(),e.call(t,r,n)}},render:function(t){for(var e=this.tag||this.$vnode.data.tag||"span",r=Object.create(null),n=this.prevChildren=this.children,i=this.$slots.default||[],o=this.children=[],s=Wo(this),a=0;a<i.length;a++){var l=i[a];if(l.tag)if(null!=l.key&&0!==String(l.key).indexOf("__vlist"))o.push(l),r[l.key]=l,(l.data||(l.data={})).transition=s;else;}if(n){for(var u=[],c=[],h=0;h<n.length;h++){var p=n[h];p.data.transition=s,p.data.pos=p.elm.getBoundingClientRect(),r[p.key]?u.push(p):c.push(p)}this.kept=t(e,null,u),this.removed=c}return t(e,null,o)},updated:function(){var t=this.prevChildren,e=this.moveClass||(this.name||"v")+"-move";t.length&&this.hasMove(t[0].elm,e)&&(t.forEach(ns),t.forEach(is),t.forEach(os),this._reflow=document.body.offsetHeight,t.forEach(function(t){if(t.data.moved){var r=t.elm,n=r.style;vo(r,e),n.transform=n.WebkitTransform=n.transitionDuration="",r.addEventListener(fo,r._moveCb=function t(n){n&&n.target!==r||n&&!/transform$/.test(n.propertyName)||(r.removeEventListener(fo,t),r._moveCb=null,xo(r,e))})}}))},methods:{hasMove:function(t,e){if(!uo)return!1;if(this._hasMove)return this._hasMove;var r=t.cloneNode();t._transitionClasses&&t._transitionClasses.forEach(function(t){so(r,t)}),oo(r,e),r.style.display="none",this.$el.appendChild(r);var n=Eo(r);return this.$el.removeChild(r),this._hasMove=n.hasTransform}}};function ns(t){t.elm._moveCb&&t.elm._moveCb(),t.elm._enterCb&&t.elm._enterCb()}function is(t){t.data.newPos=t.elm.getBoundingClientRect()}function os(t){var e=t.data.pos,r=t.data.newPos,n=e.left-r.left,i=e.top-r.top;if(n||i){t.data.moved=!0;var o=t.elm.style;o.transform=o.WebkitTransform="translate("+n+"px,"+i+"px)",o.transitionDuration="0s"}}var ss={Transition:ts,TransitionGroup:rs};hn.config.mustUseProp=Mn,hn.config.isReservedTag=$n,hn.config.isReservedAttr=Tn,hn.config.getTagNamespace=Zn,hn.config.isUnknownElement=Wn,P(hn.options.directives,$o),P(hn.options.components,ss),hn.prototype.__patch__=W?Do:L,hn.prototype.$mount=function(t,e){return t=t&&W?Hn(t):void 0,qe(this,t,e)},W&&setTimeout(function(){U.devtools&&st&&st.emit("init",hn)},0),e["a"]=hn}).call(this,r("c8ba"))},"2fcc":function(t,e,r){(function(t,r){(function(t,r){r(e)})(0,function(e){"use strict";var n=8,i={version:{required:!0,type:"enum",values:[8],doc:"Style specification version number. Must be 8.",example:8},name:{type:"string",doc:"A human-readable name for the style.",example:"Bright"},metadata:{type:"*",doc:"Arbitrary properties useful to track with the stylesheet, but do not influence rendering. Properties should be prefixed to avoid collisions, like 'mapbox:'."},center:{type:"array",value:"number",doc:"Default map center in longitude and latitude.  The style center will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:[-73.9749,40.7736]},zoom:{type:"number",doc:"Default zoom level.  The style zoom will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:12.5},bearing:{type:"number",default:0,period:360,units:"degrees",doc:'Default bearing, in degrees. The bearing is the compass direction that is "up"; for example, a bearing of 90° orients the map so that east is up. This value will be used only if the map has not been positioned by other means (e.g. map options or user interaction).',example:29},pitch:{type:"number",default:0,units:"degrees",doc:"Default pitch, in degrees. Zero is perpendicular to the surface, for a look straight down at the map, while a greater value like 60 looks ahead towards the horizon. The style pitch will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:50},light:{type:"light",doc:"The global light source.",example:{anchor:"viewport",color:"white",intensity:.4}},sources:{required:!0,type:"sources",doc:"Data source specifications.",example:{"mapbox-streets":{type:"vector",url:"mapbox://mapbox.mapbox-streets-v6"}}},sprite:{type:"string",doc:"A base URL for retrieving the sprite image and metadata. The extensions `.png`, `.json` and scale factor `@2x.png` will be automatically appended. This property is required if any layer uses the `background-pattern`, `fill-pattern`, `line-pattern`, `fill-extrusion-pattern`, or `icon-image` properties. The URL must be absolute, containing the [scheme, authority and path components](https://en.wikipedia.org/wiki/URL#Syntax).",example:"mapbox://sprites/mapbox/bright-v8"},glyphs:{type:"string",doc:"A URL template for loading signed-distance-field glyph sets in PBF format. The URL must include `{fontstack}` and `{range}` tokens. This property is required if any layer uses the `text-field` layout property. The URL must be absolute, containing the [scheme, authority and path components](https://en.wikipedia.org/wiki/URL#Syntax).",example:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},transition:{type:"transition",doc:"A global transition definition to use as a default across properties, to be used for timing transitions between one value and the next when no property-specific transition is set. Collision-based symbol fading is controlled independently of the style's `transition` property.",example:{duration:300,delay:0}},layers:{required:!0,type:"array",value:"layer",doc:"Layers will be drawn in the order of this array.",example:[{id:"water",source:"mapbox-streets","source-layer":"water",type:"fill",paint:{"fill-color":"#00ffff"}}]}},o={"*":{type:"source",doc:"Specification of a data source. For vector and raster sources, either TileJSON or a URL to a TileJSON must be provided. For image and video sources, a URL must be provided. For GeoJSON sources, a URL or inline GeoJSON must be provided."}},s=["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],a={type:{required:!0,type:"enum",values:{vector:{doc:"A vector tile source."}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},scheme:{type:"enum",values:{xyz:{doc:"Slippy map tilenames scheme."},tms:{doc:"OSGeo spec scheme."}},default:"xyz",doc:"Influences the y direction of the tile coordinates. The global-mercator (aka Spherical Mercator) profile is assumed."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},promoteId:{type:"promoteId",doc:"A property to use as a feature id (for feature state). Either a property name, or an object of the form `{<sourceLayer>: <propertyName>}`. If specified as a string for a vector tile source, the same property is used across all its source layers."},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source's tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},l={type:{required:!0,type:"enum",values:{raster:{doc:"A raster tile source."}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},tileSize:{type:"number",default:512,units:"pixels",doc:"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},scheme:{type:"enum",values:{xyz:{doc:"Slippy map tilenames scheme."},tms:{doc:"OSGeo spec scheme."}},default:"xyz",doc:"Influences the y direction of the tile coordinates. The global-mercator (aka Spherical Mercator) profile is assumed."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source's tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},u={type:{required:!0,type:"enum",values:{"raster-dem":{doc:"A RGB-encoded raster DEM source"}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},tileSize:{type:"number",default:512,units:"pixels",doc:"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},encoding:{type:"enum",values:{terrarium:{doc:"Terrarium format PNG tiles. See https://aws.amazon.com/es/public-datasets/terrain/ for more info."},mapbox:{doc:"Mapbox Terrain RGB tiles. See https://www.mapbox.com/help/access-elevation-data/#mapbox-terrain-rgb for more info."}},default:"mapbox",doc:"The encoding used by this source. Mapbox Terrain RGB is used by default"},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source's tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},c={type:{required:!0,type:"enum",values:{geojson:{doc:"A GeoJSON data source."}},doc:"The data type of the GeoJSON source."},data:{type:"*",doc:"A URL to a GeoJSON file, or inline GeoJSON."},maxzoom:{type:"number",default:18,doc:"Maximum zoom level at which to create vector tiles (higher means greater detail at high zoom levels)."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},buffer:{type:"number",default:128,maximum:512,minimum:0,doc:"Size of the tile buffer on each side. A value of 0 produces no buffer. A value of 512 produces a buffer as wide as the tile itself. Larger values produce fewer rendering artifacts near tile edges and slower performance."},filter:{type:"*",doc:"An expression for filtering features prior to processing them for rendering."},tolerance:{type:"number",default:.375,doc:"Douglas-Peucker simplification tolerance (higher means simpler geometries and faster performance)."},cluster:{type:"boolean",default:!1,doc:"If the data is a collection of point features, setting this to true clusters the points by radius into groups. Cluster groups become new `Point` features in the source with additional properties:\n * `cluster` Is `true` if the point is a cluster \n * `cluster_id` A unqiue id for the cluster to be used in conjunction with the [cluster inspection methods](https://www.mapbox.com/mapbox-gl-js/api/#geojsonsource#getclusterexpansionzoom)\n * `point_count` Number of original points grouped into this cluster\n * `point_count_abbreviated` An abbreviated point count"},clusterRadius:{type:"number",default:50,minimum:0,doc:"Radius of each cluster if clustering is enabled. A value of 512 indicates a radius equal to the width of a tile."},clusterMaxZoom:{type:"number",doc:"Max zoom on which to cluster points if clustering is enabled. Defaults to one zoom less than maxzoom (so that last zoom features are not clustered). Clusters are re-evaluated at integer zoom levels so setting clusterMaxZoom to 14 means the clusters will be displayed until z15."},clusterMinPoints:{type:"number",doc:"Minimum number of points necessary to form a cluster if clustering is enabled. Defaults to `2`."},clusterProperties:{type:"*",doc:'An object defining custom properties on the generated clusters if clustering is enabled, aggregating values from clustered points. Has the form `{"property_name": [operator, map_expression]}`. `operator` is any expression function that accepts at least 2 operands (e.g. `"+"` or `"max"`) — it accumulates the property value from clusters/points the cluster contains; `map_expression` produces the value of a single point.\n\nExample: `{"sum": ["+", ["get", "scalerank"]]}`.\n\nFor more advanced use cases, in place of `operator`, you can use a custom reduce expression that references a special `["accumulated"]` value, e.g.:\n`{"sum": [["+", ["accumulated"], ["get", "sum"]], ["get", "scalerank"]]}`'},lineMetrics:{type:"boolean",default:!1,doc:"Whether to calculate line distance metrics. This is required for line layers that specify `line-gradient` values."},generateId:{type:"boolean",default:!1,doc:"Whether to generate ids for the geojson features. When enabled, the `feature.id` property will be auto assigned based on its index in the `features` array, over-writing any previous values."},promoteId:{type:"promoteId",doc:"A property to use as a feature id (for feature state). Either a property name, or an object of the form `{<sourceLayer>: <propertyName>}`."}},h={type:{required:!0,type:"enum",values:{video:{doc:"A video data source."}},doc:"The data type of the video source."},urls:{required:!0,type:"array",value:"string",doc:"URLs to video content in order of preferred format."},coordinates:{required:!0,doc:"Corners of video specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number",doc:"A single longitude, latitude pair."}}},p={type:{required:!0,type:"enum",values:{image:{doc:"An image data source."}},doc:"The data type of the image source."},url:{required:!0,type:"string",doc:"URL that points to an image."},coordinates:{required:!0,doc:"Corners of image specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number",doc:"A single longitude, latitude pair."}}},f={id:{type:"string",doc:"Unique layer name.",required:!0},type:{type:"enum",values:{fill:{doc:"A filled polygon with an optional stroked border.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},line:{doc:"A stroked line.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},symbol:{doc:"An icon or a text label.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},circle:{doc:"A filled circle.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},heatmap:{doc:"A heatmap.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"fill-extrusion":{doc:"An extruded (3D) polygon.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},raster:{doc:"Raster map textures such as satellite imagery.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},hillshade:{doc:"Client-side hillshading visualization based on DEM data. Currently, the implementation only supports Mapbox Terrain RGB and Mapzen Terrarium tiles.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},background:{doc:"The background color or pattern of the map.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}}},doc:"Rendering type of this layer.",required:!0},metadata:{type:"*",doc:"Arbitrary properties useful to track with the layer, but do not influence rendering. Properties should be prefixed to avoid collisions, like 'mapbox:'."},source:{type:"string",doc:"Name of a source description to be used for this layer. Required for all layer types except `background`."},"source-layer":{type:"string",doc:"Layer to use from a vector tile source. Required for vector tile sources; prohibited for all other source types, including GeoJSON sources."},minzoom:{type:"number",minimum:0,maximum:24,doc:"The minimum zoom level for the layer. At zoom levels less than the minzoom, the layer will be hidden."},maxzoom:{type:"number",minimum:0,maximum:24,doc:"The maximum zoom level for the layer. At zoom levels equal to or greater than the maxzoom, the layer will be hidden."},filter:{type:"filter",doc:"A expression specifying conditions on source features. Only features that match the filter are displayed. Zoom expressions in filters are only evaluated at integer zoom levels. The `feature-state` expression is not supported in filter expressions."},layout:{type:"layout",doc:"Layout properties for the layer."},paint:{type:"paint",doc:"Default paint properties for this layer."}},d=["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],m={visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},g={"fill-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"},"data-driven styling":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},y={"circle-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.2.0",ios:"5.9.0",macos:"0.16.0"},"data-driven styling":{js:"1.2.0",android:"9.2.0",ios:"5.9.0",macos:"0.16.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},_={visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},"property-type":"constant"}},v={"line-cap":{type:"enum",values:{butt:{doc:"A cap with a squared-off end which is drawn to the exact endpoint of the line."},round:{doc:"A cap with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},square:{doc:"A cap with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."}},default:"butt",doc:"The display of line endings.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{doc:"A join with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."},round:{doc:"A join with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},miter:{doc:"A join with a sharp, angled corner which is drawn with the outer sides beyond the endpoint of the path until they meet."}},default:"miter",doc:"The display of lines when joining.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,doc:"Used to automatically convert miter joins to bevel joins for sharp angles.",requires:[{"line-join":"miter"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,doc:"Used to automatically convert round joins to miter joins for shallow angles.",requires:[{"line-join":"round"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"},"data-driven styling":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},x={"symbol-placement":{type:"enum",values:{point:{doc:"The label is placed at the point where the geometry is located."},line:{doc:"The label is placed along the line of the geometry. Can only be used on `LineString` and `Polygon` geometries."},"line-center":{doc:"The label is placed at the center of the line of the geometry. Can only be used on `LineString` and `Polygon` geometries. Note that a single feature in a vector tile may contain multiple line geometries."}},default:"point",doc:"Label placement relative to its geometry.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`line-center` value":{js:"0.47.0",android:"6.4.0",ios:"4.3.0",macos:"0.10.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",doc:"Distance between two symbol anchors.",requires:[{"symbol-placement":"line"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,doc:"If true, the symbols will not cross tile edges to avoid mutual collisions. Recommended in layers that don't have enough padding in the vector tile to prevent collisions, or if it is a point symbol layer placed after a line symbol layer. When using a client that supports global collision detection, like Mapbox GL JS version 0.42.0 or greater, enabling this property is not needed to prevent clipped labels at tile boundaries.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with lower sort keys are drawn and placed first.  When `icon-allow-overlap` or `text-allow-overlap` is `false`, features with a lower sort key will have priority during placement. When `icon-allow-overlap` or `text-allow-overlap` is set to `true`, features with a higher sort key will overlap over features with a lower sort key.","sdk-support":{"basic functionality":{js:"0.53.0",android:"7.4.0",ios:"4.11.0",macos:"0.14.0"},"data-driven styling":{js:"0.53.0",android:"7.4.0",ios:"4.11.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{doc:"Sorts symbols by `symbol-sort-key` if set. Otherwise, sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},"viewport-y":{doc:"Sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},source:{doc:"Sorts symbols by `symbol-sort-key` if set. Otherwise, no sorting is applied; symbols are rendered in the same order as the source data."}},default:"auto",doc:"Determines whether overlapping symbols in the same layer are rendered in the order that they appear in the data source or by their y-position relative to the viewport. To control the order and prioritization of symbols otherwise, use `symbol-sort-key`.","sdk-support":{"basic functionality":{js:"0.49.0",android:"6.6.0",ios:"4.5.0",macos:"0.12.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,doc:"If true, the icon will be visible even if it collides with other previously drawn symbols.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,doc:"If true, other symbols can be visible even if they collide with the icon.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,doc:"If true, text will display without their corresponding icons when the icon collides with other symbols and the text does not.",requires:["icon-image","text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{doc:"When `symbol-placement` is set to `point`, aligns icons east-west. When `symbol-placement` is set to `line` or `line-center`, aligns icon x-axes with the line."},viewport:{doc:"Produces icons whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{doc:"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto",doc:"In combination with `symbol-placement`, determines the rotation behavior of icons.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",doc:"Scales the original size of the icon by the provided factor. The new pixel size of the image will be the original pixel size multiplied by `icon-size`. 1 is the original size; 3 triples the size of the image.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{doc:"The icon is displayed at its intrinsic aspect ratio."},width:{doc:"The icon is scaled in the x-dimension to fit the width of the text."},height:{doc:"The icon is scaled in the y-dimension to fit the height of the text."},both:{doc:"The icon is scaled in both x- and y-dimensions."}},default:"none",doc:"Scales the icon to fit around the associated text.",requires:["icon-image","text-field"],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"},"stretchable icons":{js:"1.6.0",android:"9.2.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",doc:"Size of the additional area added to dimensions determined by `icon-text-fit`, in clockwise order: top, right, bottom, left.",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",doc:"Name of image in sprite to use for drawing an image background.",tokens:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",doc:"Rotates the icon clockwise.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.21.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",doc:"Size of the additional area around the icon bounding box used for detecting symbol collisions.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,doc:"If true, the icon may be flipped to prevent it from being rendered upside-down.",requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],doc:"Offset distance of icon from its anchor. Positive values indicate right and down, while negative values indicate left and up. Each component is multiplied by the value of `icon-size` to obtain the final offset in pixels. When combined with `icon-rotate` the offset will be as if the rotated direction was up.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{doc:"The center of the icon is placed closest to the anchor."},left:{doc:"The left side of the icon is placed closest to the anchor."},right:{doc:"The right side of the icon is placed closest to the anchor."},top:{doc:"The top of the icon is placed closest to the anchor."},bottom:{doc:"The bottom of the icon is placed closest to the anchor."},"top-left":{doc:"The top left corner of the icon is placed closest to the anchor."},"top-right":{doc:"The top right corner of the icon is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the icon is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the icon is placed closest to the anchor."}},default:"center",doc:"Part of the icon placed closest to the anchor.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{doc:"The icon is aligned to the plane of the map."},viewport:{doc:"The icon is aligned to the plane of the viewport."},auto:{doc:"Automatically matches the value of `icon-rotation-alignment`."}},default:"auto",doc:"Orientation of icon when map is pitched.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{doc:"The text is aligned to the plane of the map."},viewport:{doc:"The text is aligned to the plane of the viewport."},auto:{doc:"Automatically matches the value of `text-rotation-alignment`."}},default:"auto",doc:"Orientation of text when map is pitched.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{doc:"When `symbol-placement` is set to `point`, aligns text east-west. When `symbol-placement` is set to `line` or `line-center`, aligns text x-axes with the line."},viewport:{doc:"Produces glyphs whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{doc:"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto",doc:"In combination with `symbol-placement`, determines the rotation behavior of the individual glyphs forming the text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,doc:"Value to use for a text label. If a plain `string` is provided, it will be treated as a `formatted` with default/inherited formatting options.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],doc:"Font stack to use for displaying text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",doc:"Font size.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",doc:"The maximum line width for text wrapping.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",doc:"Text leading value for multi-line text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",doc:"Text tracking amount.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{doc:"The text is aligned towards the anchor position."},left:{doc:"The text is aligned to the left."},center:{doc:"The text is centered."},right:{doc:"The text is aligned to the right."}},default:"center",doc:"Text justification options.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"},auto:{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,doc:"Radial offset of text, in the direction of the symbol's anchor. Useful in combination with `text-variable-anchor`, which defaults to using the two-dimensional `text-offset` if present.","sdk-support":{"basic functionality":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"},"data-driven styling":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{doc:"The center of the text is placed closest to the anchor."},left:{doc:"The left side of the text is placed closest to the anchor."},right:{doc:"The right side of the text is placed closest to the anchor."},top:{doc:"The top of the text is placed closest to the anchor."},bottom:{doc:"The bottom of the text is placed closest to the anchor."},"top-left":{doc:"The top left corner of the text is placed closest to the anchor."},"top-right":{doc:"The top right corner of the text is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the text is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the text is placed closest to the anchor."}},requires:["text-field",{"symbol-placement":["point"]}],doc:"To increase the chance of placing high-priority labels on the map, you can provide an array of `text-anchor` locations: the renderer will attempt to place the label at each location, in order, before moving onto the next label. Use `text-justify: auto` to choose justification based on anchor position. To apply an offset, use the `text-radial-offset` or the two-dimensional `text-offset`.","sdk-support":{"basic functionality":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{doc:"The center of the text is placed closest to the anchor."},left:{doc:"The left side of the text is placed closest to the anchor."},right:{doc:"The right side of the text is placed closest to the anchor."},top:{doc:"The top of the text is placed closest to the anchor."},bottom:{doc:"The bottom of the text is placed closest to the anchor."},"top-left":{doc:"The top left corner of the text is placed closest to the anchor."},"top-right":{doc:"The top right corner of the text is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the text is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the text is placed closest to the anchor."}},default:"center",doc:"Part of the text placed closest to the anchor.",requires:["text-field",{"!":"text-variable-anchor"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",doc:"Maximum angle change between adjacent characters.",requires:["text-field",{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{doc:"If a text's language supports horizontal writing mode, symbols with point placement would be laid out horizontally."},vertical:{doc:"If a text's language supports vertical writing mode, symbols with point placement would be laid out vertically."}},doc:"The property allows control over a symbol's orientation. Note that the property values act as a hint, so that a symbol whose language doesn’t support the provided orientation will be laid out in its natural orientation. Example: English point symbol will be rendered horizontally even if array value contains single 'vertical' enum value. The order of elements in an array define priority order for the placement of an orientation variant.",requires:["text-field",{"symbol-placement":["point"]}],"sdk-support":{"basic functionality":{js:"1.3.0",android:"8.3.0",ios:"5.3.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",doc:"Rotates the text clockwise.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",doc:"Size of the additional area around the text bounding box used for detecting symbol collisions.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,doc:"If true, the text may be flipped vertically to prevent it from being rendered upside-down.",requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{doc:"The text is not altered."},uppercase:{doc:"Forces all letters to be displayed in uppercase."},lowercase:{doc:"Forces all letters to be displayed in lowercase."}},default:"none",doc:"Specifies how to capitalize text, similar to the CSS `text-transform` property.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",doc:"Offset distance of text from its anchor. Positive values indicate right and down, while negative values indicate left and up. If used with text-variable-anchor, input values will be taken as absolute values. Offsets along the x- and y-axis will be applied automatically based on the anchor position.",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,doc:"If true, the text will be visible even if it collides with other previously drawn symbols.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,doc:"If true, other symbols can be visible even if they collide with the text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,doc:"If true, icons will display without their corresponding text when the text collides with other symbols and the icon does not.",requires:["text-field","icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},b={visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},w={visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},"property-type":"constant"}},E={type:"array",value:"*",doc:"A filter selects specific features from a layer."},S={type:"enum",values:{"==":{doc:'`["==", key, value]` equality: `feature[key] = value`'},"!=":{doc:'`["!=", key, value]` inequality: `feature[key] ≠ value`'},">":{doc:'`[">", key, value]` greater than: `feature[key] > value`'},">=":{doc:'`[">=", key, value]` greater than or equal: `feature[key] ≥ value`'},"<":{doc:'`["<", key, value]` less than: `feature[key] < value`'},"<=":{doc:'`["<=", key, value]` less than or equal: `feature[key] ≤ value`'},in:{doc:'`["in", key, v0, ..., vn]` set inclusion: `feature[key] ∈ {v0, ..., vn}`'},"!in":{doc:'`["!in", key, v0, ..., vn]` set exclusion: `feature[key] ∉ {v0, ..., vn}`'},all:{doc:'`["all", f0, ..., fn]` logical `AND`: `f0 ∧ ... ∧ fn`'},any:{doc:'`["any", f0, ..., fn]` logical `OR`: `f0 ∨ ... ∨ fn`'},none:{doc:'`["none", f0, ..., fn]` logical `NOR`: `¬f0 ∧ ... ∧ ¬fn`'},has:{doc:'`["has", key]` `feature[key]` exists'},"!has":{doc:'`["!has", key]` `feature[key]` does not exist'},within:{doc:'`["within", object]` feature geometry is within object geometry'}},doc:"The filter operator."},I={type:"enum",values:{Point:{doc:"Filter to point geometries."},LineString:{doc:"Filter to line geometries."},Polygon:{doc:"Filter to polygon geometries."}},doc:"The geometry type for the filter to select."},T={type:"array",minimum:0,maximum:24,value:["number","color"],length:2,doc:"Zoom level and value pair."},C={type:"array",value:"*",minimum:1,doc:"An expression defines a function that can be used for data-driven style properties or feature filters."},M={doc:"",type:"enum",values:{let:{doc:'Binds expressions to named variables, which can then be referenced in the result expression using ["var", "variable_name"].',group:"Variable binding","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},var:{doc:'References variable bound using "let".',group:"Variable binding","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},literal:{doc:"Provides a literal array or object value.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},array:{doc:"Asserts that the input is an array (optionally with a specific item type and length).  If, when the input expression is evaluated, it is not of the asserted type, then this assertion will cause the whole expression to be aborted.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},at:{doc:"Retrieves an item from an array.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},in:{doc:"Determines whether an item exists in an array or a substring exists in a string.",group:"Lookup","sdk-support":{"basic functionality":{js:"1.6.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}}},"index-of":{doc:"Returns the first position at which an item can be found in an array or a substring can be found in a string, or `-1` if the input cannot be found. Accepts an optional index from where to begin the search.",group:"Lookup","sdk-support":{"basic functionality":{js:"1.10.0"}}},slice:{doc:"Returns an item from an array or a substring from a string from a specified start index, or between a start index and an end index if set. The return value is inclusive of the start index but not of the end index.",group:"Lookup","sdk-support":{"basic functionality":{js:"1.10.0"}}},case:{doc:"Selects the first output whose corresponding test condition evaluates to true, or the fallback value otherwise.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},match:{doc:'Selects the output whose label value matches the input value, or the fallback value if no match is found. The input can be any expression (e.g. `["get", "building_type"]`). Each label must be either:\n - a single literal value; or\n - an array of literal values, whose values must be all strings or all numbers (e.g. `[100, 101]` or `["c", "b"]`). The input matches if any of the values in the array matches, similar to the `"in"` operator.\nEach label must be unique. If the input type does not match the type of the labels, the result will be the fallback value.',group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},coalesce:{doc:"Evaluates each expression in turn until the first non-null value is obtained, and returns that value.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},step:{doc:'Produces discrete, stepped results by evaluating a piecewise-constant function defined by pairs of input and output values ("stops"). The `input` may be any numeric expression (e.g., `["get", "population"]`). Stop inputs must be numeric literals in strictly ascending order. Returns the output value of the stop just less than the input, or the first output if the input is less than the first stop.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},interpolate:{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). The `input` may be any numeric expression (e.g., `["get", "population"]`). Stop inputs must be numeric literals in strictly ascending order. The output type must be `number`, `array<number>`, or `color`.\n\nInterpolation types:\n- `["linear"]`: Interpolates linearly between the pair of stops just less than and just greater than the input.\n- `["exponential", base]`: Interpolates exponentially between the stops just less than and just greater than the input. `base` controls the rate at which the output increases: higher values make the output increase more towards the high end of the range. With values close to 1 the output increases linearly.\n- `["cubic-bezier", x1, y1, x2, y2]`: Interpolates using the cubic bezier curve defined by the given control points.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"interpolate-hcl":{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). Works like `interpolate`, but the output type must be `color`, and the interpolation is performed in the Hue-Chroma-Luminance color space.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.49.0"}}},"interpolate-lab":{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). Works like `interpolate`, but the output type must be `color`, and the interpolation is performed in the CIELAB color space.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.49.0"}}},ln2:{doc:"Returns mathematical constant ln(2).",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},pi:{doc:"Returns the mathematical constant pi.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},e:{doc:"Returns the mathematical constant e.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},typeof:{doc:"Returns a string describing the type of the given value.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},string:{doc:"Asserts that the input value is a string. If multiple values are provided, each one is evaluated in order until a string is obtained. If none of the inputs are strings, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},number:{doc:"Asserts that the input value is a number. If multiple values are provided, each one is evaluated in order until a number is obtained. If none of the inputs are numbers, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},boolean:{doc:"Asserts that the input value is a boolean. If multiple values are provided, each one is evaluated in order until a boolean is obtained. If none of the inputs are booleans, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},object:{doc:"Asserts that the input value is an object. If multiple values are provided, each one is evaluated in order until an object is obtained. If none of the inputs are objects, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},collator:{doc:"Returns a `collator` for use in locale-dependent comparison operations. The `case-sensitive` and `diacritic-sensitive` options default to `false`. The `locale` argument specifies the IETF language tag of the locale to use. If none is provided, the default locale is used. If the requested locale is not available, the `collator` will use a system-defined fallback locale. Use `resolved-locale` to test the results of locale fallback behavior.",group:"Types","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},format:{doc:'Returns a `formatted` string for displaying mixed-format text in the `text-field` property. The input may contain a string literal or expression, including an [`\'image\'`](#types-image) expression. Strings may be followed by a style override object that supports the following properties:\n- `"text-font"`: Overrides the font stack specified by the root layout property.\n- `"text-color"`: Overrides the color specified by the root paint property.\n- `"font-scale"`: Applies a scaling factor on `text-size` as specified by the root layout property.',group:"Types","sdk-support":{"basic functionality":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"text-font":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"font-scale":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"text-color":{js:"1.3.0",android:"7.3.0",ios:"4.10.0",macos:"0.14.0"},image:{js:"1.6.0",android:"8.6.0",ios:"5.7.0",macos:"0.15.0"}}},image:{doc:"Returns an `image` type for use in `icon-image`, `*-pattern` entries and as a section in the `format` expression. If set, the `image` argument will check that the requested image exists in the style and will return either the resolved image name or `null`, depending on whether or not the image is currently in the style. This validation process is synchronous and requires the image to have been added to the style before requesting it in the `image` argument.",group:"Types","sdk-support":{"basic functionality":{js:"1.4.0",android:"8.6.0",ios:"5.7.0",macos:"0.15.0"}}},"number-format":{doc:"Converts the input number into a string representation using the providing formatting rules. If set, the `locale` argument specifies the locale to use, as a BCP 47 language tag. If set, the `currency` argument specifies an ISO 4217 code to use for currency-style formatting. If set, the `min-fraction-digits` and `max-fraction-digits` arguments specify the minimum and maximum number of fractional digits to include.",group:"Types","sdk-support":{"basic functionality":{js:"0.54.0"}}},"to-string":{doc:'Converts the input value to a string. If the input is `null`, the result is `""`. If the input is a boolean, the result is `"true"` or `"false"`. If the input is a number, it is converted to a string as specified by the ["NumberToString" algorithm](https://tc39.github.io/ecma262/#sec-tostring-applied-to-the-number-type) of the ECMAScript Language Specification. If the input is a color, it is converted to a string of the form `"rgba(r,g,b,a)"`, where `r`, `g`, and `b` are numerals ranging from 0 to 255, and `a` ranges from 0 to 1. Otherwise, the input is converted to a string in the format specified by the [`JSON.stringify`](https://tc39.github.io/ecma262/#sec-json.stringify) function of the ECMAScript Language Specification.',group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-number":{doc:'Converts the input value to a number, if possible. If the input is `null` or `false`, the result is 0. If the input is `true`, the result is 1. If the input is a string, it is converted to a number as specified by the ["ToNumber Applied to the String Type" algorithm](https://tc39.github.io/ecma262/#sec-tonumber-applied-to-the-string-type) of the ECMAScript Language Specification. If multiple values are provided, each one is evaluated in order until the first successful conversion is obtained. If none of the inputs can be converted, the expression is an error.',group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-boolean":{doc:"Converts the input value to a boolean. The result is `false` when then input is an empty string, 0, `false`, `null`, or `NaN`; otherwise it is `true`.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-rgba":{doc:"Returns a four-element array containing the input color's red, green, blue, and alpha components, in that order.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-color":{doc:"Converts the input value to a color. If multiple values are provided, each one is evaluated in order until the first successful conversion is obtained. If none of the inputs can be converted, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},rgb:{doc:"Creates a color value from red, green, and blue components, which must range between 0 and 255, and an alpha component of 1. If any component is out of range, the expression is an error.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},rgba:{doc:"Creates a color value from red, green, blue components, which must range between 0 and 255, and an alpha component which must range between 0 and 1. If any component is out of range, the expression is an error.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},get:{doc:"Retrieves a property value from the current feature's properties, or from another object if a second argument is provided. Returns null if the requested property is missing.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},has:{doc:"Tests for the presence of an property value in the current feature's properties, or from another object if a second argument is provided.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},length:{doc:"Gets the length of an array or string.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},properties:{doc:'Gets the feature properties object.  Note that in some cases, it may be more efficient to use ["get", "property_name"] directly.',group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"feature-state":{doc:"Retrieves a property value from the current feature's state. Returns null if the requested property is not present on the feature's state. A feature's state is not part of the GeoJSON or vector tile data, and must be set programmatically on each feature. Features are identified by their `id` attribute, which must be an integer or a string that can be cast to an integer. Note that [\"feature-state\"] can only be used with paint properties that support data-driven styling.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.46.0"}}},"geometry-type":{doc:"Gets the feature's geometry type: `Point`, `MultiPoint`, `LineString`, `MultiLineString`, `Polygon`, `MultiPolygon`.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},id:{doc:"Gets the feature's id, if it has one.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},zoom:{doc:'Gets the current zoom level.  Note that in style layout and paint properties, ["zoom"] may only appear as the input to a top-level "step" or "interpolate" expression.',group:"Zoom","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"heatmap-density":{doc:"Gets the kernel density estimation of a pixel in a heatmap layer, which is a relative measure of how many data points are crowded around a particular pixel. Can only be used in the `heatmap-color` property.",group:"Heatmap","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"line-progress":{doc:"Gets the progress along a gradient line. Can only be used in the `line-gradient` property.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.6.0",macos:"0.12.0"}}},accumulated:{doc:"Gets the value of a cluster property accumulated so far. Can only be used in the `clusterProperties` option of a clustered GeoJSON source.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.53.0"}}},"+":{doc:"Returns the sum of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"*":{doc:"Returns the product of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"-":{doc:"For two inputs, returns the result of subtracting the second input from the first. For a single input, returns the result of subtracting it from 0.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"/":{doc:"Returns the result of floating point division of the first input by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"%":{doc:"Returns the remainder after integer division of the first input by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"^":{doc:"Returns the result of raising the first input to the power specified by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},sqrt:{doc:"Returns the square root of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},log10:{doc:"Returns the base-ten logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},ln:{doc:"Returns the natural logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},log2:{doc:"Returns the base-two logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},sin:{doc:"Returns the sine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},cos:{doc:"Returns the cosine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},tan:{doc:"Returns the tangent of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},asin:{doc:"Returns the arcsine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},acos:{doc:"Returns the arccosine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},atan:{doc:"Returns the arctangent of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},min:{doc:"Returns the minimum value of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},max:{doc:"Returns the maximum value of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},round:{doc:'Rounds the input to the nearest integer. Halfway values are rounded away from zero. For example, `["round", -1.5]` evaluates to -2.',group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},abs:{doc:"Returns the absolute value of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},ceil:{doc:"Returns the smallest integer that is greater than or equal to the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},floor:{doc:"Returns the largest integer that is less than or equal to the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},distance:{doc:"Returns the shortest distance in meters between the evaluated feature and the input geometry. The input value can be a valid GeoJSON of type `Point`, `MultiPoint`, `LineString`, `MultiLineString`, `Polygon`, `MultiPolygon`, `Feature`, or `FeatureCollection`. Distance values returned may vary in precision due to loss in precision from encoding geometries, particularly below zoom level 13.",group:"Math","sdk-support":{"basic functionality":{android:"9.2.0",ios:"5.9.0",macos:"0.16.0"}}},"==":{doc:"Returns `true` if the input values are equal, `false` otherwise. The comparison is strictly typed: values of different runtime types are always considered unequal. Cases where the types are known to be different at parse time are considered invalid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"!=":{doc:"Returns `true` if the input values are not equal, `false` otherwise. The comparison is strictly typed: values of different runtime types are always considered unequal. Cases where the types are known to be different at parse time are considered invalid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},">":{doc:"Returns `true` if the first input is strictly greater than the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"<":{doc:"Returns `true` if the first input is strictly less than the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},">=":{doc:"Returns `true` if the first input is greater than or equal to the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"<=":{doc:"Returns `true` if the first input is less than or equal to the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},all:{doc:"Returns `true` if all the inputs are `true`, `false` otherwise. The inputs are evaluated in order, and evaluation is short-circuiting: once an input expression evaluates to `false`, the result is `false` and no further input expressions are evaluated.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},any:{doc:"Returns `true` if any of the inputs are `true`, `false` otherwise. The inputs are evaluated in order, and evaluation is short-circuiting: once an input expression evaluates to `true`, the result is `true` and no further input expressions are evaluated.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"!":{doc:"Logical negation. Returns `true` if the input is `false`, and `false` if the input is `true`.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},within:{doc:"Returns `true` if the evaluated feature is fully contained inside a boundary of the input geometry, `false` otherwise. The input value can be a valid GeoJSON of type `Polygon`, `MultiPolygon`, `Feature`, or `FeatureCollection`. Supported features for evaluation:\n- `Point`: Returns `false` if a point is on the boundary or falls outside the boundary.\n- `LineString`: Returns `false` if any part of a line falls outside the boundary, the line intersects the boundary, or a line's endpoint is on the boundary.",group:"Decision","sdk-support":{"basic functionality":{js:"1.9.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}}},"is-supported-script":{doc:"Returns `true` if the input string is expected to render legibly. Returns `false` if the input string contains sections that cannot be rendered without potential loss of meaning (e.g. Indic scripts that require complex text shaping, or right-to-left scripts if the the `mapbox-gl-rtl-text` plugin is not in use in Mapbox GL JS).",group:"String","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.6.0"}}},upcase:{doc:"Returns the input string converted to uppercase. Follows the Unicode Default Case Conversion algorithm and the locale-insensitive case mappings in the Unicode Character Database.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},downcase:{doc:"Returns the input string converted to lowercase. Follows the Unicode Default Case Conversion algorithm and the locale-insensitive case mappings in the Unicode Character Database.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},concat:{doc:"Returns a `string` consisting of the concatenation of the inputs. Each input is converted to a string as if by `to-string`.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"resolved-locale":{doc:"Returns the IETF language tag of the locale being used by the provided `collator`. This can be used to determine the default system locale, or to determine if a requested locale was successfully loaded.",group:"String","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}}}},A={anchor:{type:"enum",default:"viewport",values:{map:{doc:"The position of the light source is aligned to the rotation of the map."},viewport:{doc:"The position of the light source is aligned to the rotation of the viewport."}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]},doc:"Whether extruded geometries are lit relative to the map or viewport.",example:"map","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},doc:"Position of the light source relative to lit (extruded) geometries, in [r radial coordinate, a azimuthal angle, p polar angle] where r indicates the distance from the center of the base of an object to its light, a indicates the position of the light relative to 0° (0° when `light.anchor` is set to `viewport` corresponds to the top of the viewport, or 0° when `light.anchor` is set to `map` corresponds to due north, and degrees proceed clockwise), and p indicates the height of the light (from 0°, directly above, to 180°, directly below).",example:[1.5,90,80],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Color tint for lighting extruded geometries.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Intensity of lighting (on a scale from 0 to 1). Higher numbers will present as more extreme contrast.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}}},P=["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],k={"fill-antialias":{type:"boolean",default:!0,doc:"Whether or not the fill should be antialiased.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire fill layer. In contrast to the `fill-color`, this value will also affect the 1px stroke around the fill, if the stroke is used.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.21.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",doc:"The color of the filled part of this layer. This color can be specified as `rgba` with an alpha component and the color's opacity will not affect the opacity of the 1px stroke, if it is used.",transition:!0,requires:[{"!":"fill-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.19.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",doc:"The outline color of the fill. Matches the value of `fill-color` if unspecified.",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.19.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{doc:"The fill is translated relative to the map."},viewport:{doc:"The fill is translated relative to the viewport."}},doc:"Controls the frame of reference for `fill-translate`.",default:"map",requires:["fill-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing image fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},L={"line-opacity":{type:"number",doc:"The opacity at which the line will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",doc:"The color with which the line will be drawn.",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.23.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{doc:"The line is translated relative to the map."},viewport:{doc:"The line is translated relative to the viewport."}},doc:"Controls the frame of reference for `line-translate`.",default:"map",requires:["line-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",doc:"Stroke thickness.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,doc:"Draws a line casing outside of a line's actual path. Value indicates the width of the inner gap.",transition:!0,units:"pixels","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,doc:"The line's offset. For linear features, a positive value offsets the line to the right, relative to the direction of the line, and a negative value to the left. For polygon features, a positive value results in an inset, and a negative value results in an outset.",transition:!0,units:"pixels","sdk-support":{"basic functionality":{js:"0.12.1",android:"3.0.0",ios:"3.1.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Blur applied to the line, in pixels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",doc:"Specifies the lengths of the alternating dashes and gaps that form the dash pattern. The lengths are later scaled by the line width. To convert a dash length to pixels, multiply the length by the current line width. Note that GeoJSON sources with `lineMetrics: true` specified won't render dashed lines to the expected scale. Also note that zoom-dependent expressions will be evaluated only at integer zoom levels.",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing image lines. For seamless patterns, image width must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",doc:'Defines a gradient with which to color a line feature. Can only be used with GeoJSON sources that specify `"lineMetrics": true`.',transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],"sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.4.0",macos:"0.11.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},z={"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",doc:"Circle radius.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.18.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",doc:"The fill color of the circle.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.18.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,doc:"Amount to blur the circle. 1 blurs the circle such that only the centerpoint is full opacity.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.20.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",doc:"The opacity at which the circle will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.20.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{doc:"The circle is translated relative to the map."},viewport:{doc:"The circle is translated relative to the viewport."}},doc:"Controls the frame of reference for `circle-translate`.",default:"map",requires:["circle-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{doc:"Circles are scaled according to their apparent distance to the camera."},viewport:{doc:"Circles are not scaled."}},default:"map",doc:"Controls the scaling behavior of the circle when the map is pitched.","sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{doc:"The circle is aligned to the plane of the map."},viewport:{doc:"The circle is aligned to the plane of the viewport."}},default:"viewport",doc:"Orientation of circle when map is pitched.","sdk-support":{"basic functionality":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"The width of the circle's stroke. Strokes are placed outside of the `circle-radius`.","sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",doc:"The stroke color of the circle.",transition:!0,"sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",doc:"The opacity of the circle's stroke.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},D={"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",doc:"Radius of influence of one heatmap point in pixels. Increasing the value makes the heatmap smoother, but less detailed.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,doc:"A measure of how much an individual point contributes to the heatmap. A value of 10 would be equivalent to having 10 points of weight 1 in the same spot. Especially useful when combined with clustering.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,doc:"Similar to `heatmap-weight` but controls the intensity of the heatmap globally. Primarily used for adjusting the heatmap based on zoom level.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],doc:'Defines the color of each pixel based on its density value in a heatmap.  Should be an expression that uses `["heatmap-density"]` as input.',transition:!1,"sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",doc:"The global opacity at which the heatmap layer will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},R={"icon-opacity":{doc:"The opacity at which the icon will be drawn.",type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,doc:"The color of the icon. This can only be used with sdf icons.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,doc:"The color of the icon's halo. Icon halos can only be used with SDF icons.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Distance of halo to the icon outline.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Fade out the halo towards the outside.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"Distance that the icon's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{doc:"Icons are translated relative to the map."},viewport:{doc:"Icons are translated relative to the viewport."}},doc:"Controls the frame of reference for `icon-translate`.",default:"map",requires:["icon-image","icon-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",doc:"The opacity at which the text will be drawn.",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",doc:"The color with which the text will be drawn.",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,doc:"The color of the text's halo, which helps it stand out from backgrounds.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Distance of halo to the font outline. Max text halo width is 1/4 of the font-size.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"The halo's fadeout distance towards the outside.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"Distance that the text's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{doc:"The text is translated relative to the map."},viewport:{doc:"The text is translated relative to the viewport."}},doc:"Controls the frame of reference for `text-translate`.",default:"map",requires:["text-field","text-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},O={"raster-opacity":{type:"number",doc:"The opacity at which the image will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",doc:"Rotates hues around the color wheel.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",doc:"Increase or reduce the brightness of the image. The value is the minimum brightness.",default:0,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",doc:"Increase or reduce the brightness of the image. The value is the maximum brightness.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",doc:"Increase or reduce the saturation of the image.",default:0,minimum:-1,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",doc:"Increase or reduce the contrast of the image.",default:0,minimum:-1,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",doc:"The resampling/interpolation method to use for overscaling, also known as texture magnification filter",values:{linear:{doc:"(Bi)linear filtering interpolates pixel values using the weighted average of the four closest original source pixels creating a smooth but blurry look when overscaled"},nearest:{doc:"Nearest neighbor filtering interpolates pixel values using the nearest original source pixel creating a sharp but pixelated look when overscaled"}},default:"linear","sdk-support":{"basic functionality":{js:"0.47.0",android:"6.3.0",ios:"4.2.0",macos:"0.9.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",doc:"Fade duration when a new tile is added.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},N={"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,doc:"The direction of the light source used to generate the hillshading with 0 as the top of the viewport if `hillshade-illumination-anchor` is set to `viewport` and due north if `hillshade-illumination-anchor` is set to `map`.",transition:!1,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{doc:"The hillshade illumination is relative to the north direction."},viewport:{doc:"The hillshade illumination is relative to the top of the viewport."}},default:"viewport",doc:"Direction of light source when map is rotated.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",doc:"Intensity of the hillshade",default:.5,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",doc:"The shading color of areas that face away from the light source.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",doc:"The shading color of areas that faces towards the light source.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",doc:"The shading color used to accentuate rugged terrain like sharp cliffs and gorges.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},F={"background-color":{type:"color",default:"#000000",doc:"The color with which the background will be drawn.",transition:!0,requires:[{"!":"background-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing an image background. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity at which the background will be drawn.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},B={duration:{type:"number",default:300,minimum:0,units:"milliseconds",doc:"Time allotted for transitions to complete."},delay:{type:"number",default:0,minimum:0,units:"milliseconds",doc:"Length of time before a transition begins."}},j={"*":{type:"string",doc:"A name of a feature property to use as ID for feature state."}},U={$version:n,$root:i,sources:o,source:s,source_vector:a,source_raster:l,source_raster_dem:u,source_geojson:c,source_video:h,source_image:p,layer:f,layout:d,layout_background:m,layout_fill:g,layout_circle:y,layout_heatmap:_,"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},"property-type":"constant"}},layout_line:v,layout_symbol:x,layout_raster:b,layout_hillshade:w,filter:E,filter_operator:S,geometry_type:I,function:{expression:{type:"expression",doc:"An expression."},stops:{type:"array",doc:"An array of stops.",value:"function_stop"},base:{type:"number",default:1,minimum:0,doc:"The exponential base of the interpolation curve. It controls the rate at which the result increases. Higher values make the result increase more towards the high end of the range. With `1` the stops are interpolated linearly."},property:{type:"string",doc:"The name of a feature property to use as the function input.",default:"$zoom"},type:{type:"enum",values:{identity:{doc:"Return the input value as the output value."},exponential:{doc:"Generate an output by interpolating between stops just less than and just greater than the function input."},interval:{doc:"Return the output value of the stop just less than the function input."},categorical:{doc:"Return the output value of the stop equal to the function input."}},doc:"The interpolation strategy to use in function evaluation.",default:"exponential"},colorSpace:{type:"enum",values:{rgb:{doc:"Use the RGB color space to interpolate color values"},lab:{doc:"Use the LAB color space to interpolate color values."},hcl:{doc:"Use the HCL color space to interpolate color values, interpolating the Hue, Chroma, and Luminance channels individually."}},doc:"The color space in which colors interpolated. Interpolating colors in perceptual color spaces like LAB and HCL tend to produce color ramps that look more consistent and produce colors that can be differentiated more easily than those interpolated in RGB space.",default:"rgb"},default:{type:"*",required:!1,doc:"A value to serve as a fallback function result when a value isn't otherwise available. It is used in the following circumstances:\n* In categorical functions, when the feature value does not match any of the stop domain values.\n* In property and zoom-and-property functions, when a feature does not contain a value for the specified property.\n* In identity functions, when the feature value is not valid for the style property (for example, if the function is being used for a `circle-color` property but the feature property value is not a string or not a valid color).\n* In interval or exponential property and zoom-and-property functions, when the feature value is not numeric.\nIf no default is provided, the style property's default is used in these circumstances."}},function_stop:T,expression:C,expression_name:M,light:A,paint:P,paint_fill:k,"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire fill extrusion layer. This is rendered on a per-layer, not per-feature, basis, and data-driven styling is not available.",transition:!0,"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",doc:"The base color of the extruded fill. The extrusion's surfaces will be shaded differently based on this color in combination with the root `light` settings. If this color is specified as `rgba` with an alpha component, the alpha component will be ignored; use `fill-extrusion-opacity` to set layer opacity.",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up (on the flat plane), respectively.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{doc:"The fill extrusion is translated relative to the map."},viewport:{doc:"The fill extrusion is translated relative to the viewport."}},doc:"Controls the frame of reference for `fill-extrusion-translate`.",default:"map",requires:["fill-extrusion-translate"],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing images on extruded fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",doc:"The height with which to extrude this layer.",transition:!0,"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",doc:"The height with which to extrude the base of this layer. Must be less than or equal to `fill-extrusion-height`.",transition:!0,requires:["fill-extrusion-height"],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,doc:"Whether to apply a vertical gradient to the sides of a fill-extrusion layer. If true, sides will be shaded slightly darker farther down.",transition:!1,"sdk-support":{"basic functionality":{js:"0.50.0",ios:"4.7.0",macos:"0.13.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:L,paint_circle:z,paint_heatmap:D,paint_symbol:R,paint_raster:O,paint_hillshade:N,paint_background:F,transition:B,"property-type":{"data-driven":{type:"property-type",doc:"Property is interpolable and can be represented using a property expression."},"cross-faded":{type:"property-type",doc:"Property is non-interpolable; rather, its values will be cross-faded to smoothly transition between integer zooms."},"cross-faded-data-driven":{type:"property-type",doc:"Property is non-interpolable; rather, its values will be cross-faded to smoothly transition between integer zooms. It can be represented using a property expression."},"color-ramp":{type:"property-type",doc:"Property should be specified using a color ramp from which the output color can be sampled based on a property calculation."},"data-constant":{type:"property-type",doc:"Property is interpolable but cannot be represented using a property expression."},constant:{type:"property-type",doc:"Property is constant across all zoom levels and property values."}},promoteId:j},V=/("(?:[^\\"]|\\.)*")|[:,]/g,G=function(t,e){var r,n,i;return e=e||{},r=JSON.stringify([1],void 0,void 0===e.indent?2:e.indent).slice(2,-3),n=""===r?1/0:void 0===e.maxLength?80:e.maxLength,i=e.replacer,function t(e,o,s){var a,l,u,c,h,p,f,d,m,g,y,_;if(e&&"function"===typeof e.toJSON&&(e=e.toJSON()),y=JSON.stringify(e,i),void 0===y)return y;if(f=n-o.length-s,y.length<=f&&(m=y.replace(V,function(t,e){return e||t+" "}),m.length<=f))return m;if(null!=i&&(e=JSON.parse(y),i=void 0),"object"===typeof e&&null!==e){if(d=o+r,u=[],l=0,Array.isArray(e))for(g="[",a="]",f=e.length;l<f;l++)u.push(t(e[l],d,l===f-1?0:1)||"null");else for(g="{",a="}",p=Object.keys(e),f=p.length;l<f;l++)c=p[l],h=JSON.stringify(c)+": ",_=t(e[c],d,h.length+(l===f-1?0:1)),void 0!==_&&u.push(h+_);if(u.length>0)return[g,r+u.join(",\n"+d),a].join("\n"+o)}return y}(t,"",0)};function q(t,e){var r={};for(var n in e)void 0!==t[n]&&(r[n]=t[n]);for(var i in t)void 0===r[i]&&(r[i]=t[i]);return r}function $(t,e){return void 0===e&&(e=2),t=q(t,U.$root),t.layers&&(t.layers=t.layers.map(function(t){return q(t,U.layer)})),G(t,{indent:e})}var Z="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof t?t:"undefined"!==typeof self?self:{};function X(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function W(t,e){return e={exports:{}},t(e,e.exports),e.exports}var Y=W(function(t,e){(function(r){var n=e&&!e.nodeType&&e,i=t&&!t.nodeType&&t,o="object"==typeof Z&&Z;o.global!==o&&o.window!==o&&o.self!==o||(r=o);var s,a,l=2147483647,u=36,c=1,h=26,p=38,f=700,d=72,m=128,g="-",y=/^xn--/,_=/[^\x20-\x7E]/,v=/[\x2E\u3002\uFF0E\uFF61]/g,x={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},b=u-c,w=Math.floor,E=String.fromCharCode;function S(t){throw RangeError(x[t])}function I(t,e){var r=t.length,n=[];while(r--)n[r]=e(t[r]);return n}function T(t,e){var r=t.split("@"),n="";r.length>1&&(n=r[0]+"@",t=r[1]),t=t.replace(v,".");var i=t.split("."),o=I(i,e).join(".");return n+o}function C(t){var e,r,n=[],i=0,o=t.length;while(i<o)e=t.charCodeAt(i++),e>=55296&&e<=56319&&i<o?(r=t.charCodeAt(i++),56320==(64512&r)?n.push(((1023&e)<<10)+(1023&r)+65536):(n.push(e),i--)):n.push(e);return n}function M(t){return I(t,function(t){var e="";return t>65535&&(t-=65536,e+=E(t>>>10&1023|55296),t=56320|1023&t),e+=E(t),e}).join("")}function A(t){return t-48<10?t-22:t-65<26?t-65:t-97<26?t-97:u}function P(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function k(t,e,r){var n=0;for(t=r?w(t/f):t>>1,t+=w(t/e);t>b*h>>1;n+=u)t=w(t/b);return w(n+(b+1)*t/(t+p))}function L(t){var e,r,n,i,o,s,a,p,f,y,_=[],v=t.length,x=0,b=m,E=d;for(r=t.lastIndexOf(g),r<0&&(r=0),n=0;n<r;++n)t.charCodeAt(n)>=128&&S("not-basic"),_.push(t.charCodeAt(n));for(i=r>0?r+1:0;i<v;){for(o=x,s=1,a=u;;a+=u){if(i>=v&&S("invalid-input"),p=A(t.charCodeAt(i++)),(p>=u||p>w((l-x)/s))&&S("overflow"),x+=p*s,f=a<=E?c:a>=E+h?h:a-E,p<f)break;y=u-f,s>w(l/y)&&S("overflow"),s*=y}e=_.length+1,E=k(x-o,e,0==o),w(x/e)>l-b&&S("overflow"),b+=w(x/e),x%=e,_.splice(x++,0,b)}return M(_)}function z(t){var e,r,n,i,o,s,a,p,f,y,_,v,x,b,I,T=[];for(t=C(t),v=t.length,e=m,r=0,o=d,s=0;s<v;++s)_=t[s],_<128&&T.push(E(_));n=i=T.length,i&&T.push(g);while(n<v){for(a=l,s=0;s<v;++s)_=t[s],_>=e&&_<a&&(a=_);for(x=n+1,a-e>w((l-r)/x)&&S("overflow"),r+=(a-e)*x,e=a,s=0;s<v;++s)if(_=t[s],_<e&&++r>l&&S("overflow"),_==e){for(p=r,f=u;;f+=u){if(y=f<=o?c:f>=o+h?h:f-o,p<y)break;I=p-y,b=u-y,T.push(E(P(y+I%b,0))),p=w(I/b)}T.push(E(P(p,0))),o=k(r,x,n==i),r=0,++n}++r,++e}return T.join("")}function D(t){return T(t,function(t){return y.test(t)?L(t.slice(4).toLowerCase()):t})}function R(t){return T(t,function(t){return _.test(t)?"xn--"+z(t):t})}if(s={version:"1.3.2",ucs2:{decode:C,encode:M},decode:L,encode:z,toASCII:R,toUnicode:D},n&&i)if(t.exports==n)i.exports=s;else for(a in s)s.hasOwnProperty(a)&&(n[a]=s[a]);else r.punycode=s})(Z)}),H={isString:function(t){return"string"===typeof t},isObject:function(t){return"object"===typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}};function J(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var K=function(t,e,r,n){e=e||"&",r=r||"=";var i={};if("string"!==typeof t||0===t.length)return i;var o=/\+/g;t=t.split(e);var s=1e3;n&&"number"===typeof n.maxKeys&&(s=n.maxKeys);var a=t.length;s>0&&a>s&&(a=s);for(var l=0;l<a;++l){var u,c,h,p,f=t[l].replace(o,"%20"),d=f.indexOf(r);d>=0?(u=f.substr(0,d),c=f.substr(d+1)):(u=f,c=""),h=decodeURIComponent(u),p=decodeURIComponent(c),J(i,h)?Array.isArray(i[h])?i[h].push(p):i[h]=[i[h],p]:i[h]=p}return i},Q=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}},tt=function(t,e,r,n){return e=e||"&",r=r||"=",null===t&&(t=void 0),"object"===typeof t?Object.keys(t).map(function(n){var i=encodeURIComponent(Q(n))+r;return Array.isArray(t[n])?t[n].map(function(t){return i+encodeURIComponent(Q(t))}).join(e):i+encodeURIComponent(Q(t[n]))}).join(e):n?encodeURIComponent(Q(n))+r+encodeURIComponent(Q(t)):""},et=W(function(t,e){e.decode=e.parse=K,e.encode=e.stringify=tt}),rt=(et.decode,et.parse,et.encode,et.stringify,wt),nt=St,it=It,ot=Et,st=at;function at(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var lt=/^([a-z0-9.+-]+:)/i,ut=/:[0-9]*$/,ct=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,ht=["<",">",'"',"`"," ","\r","\n","\t"],pt=["{","}","|","\\","^","`"].concat(ht),ft=["'"].concat(pt),dt=["%","/","?",";","#"].concat(ft),mt=["/","?","#"],gt=255,yt=/^[+a-z0-9A-Z_-]{0,63}$/,_t=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,vt={javascript:!0,"javascript:":!0},xt={javascript:!0,"javascript:":!0},bt={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function wt(t,e,r){if(t&&H.isObject(t)&&t instanceof at)return t;var n=new at;return n.parse(t,e,r),n}function Et(t){return H.isString(t)&&(t=wt(t)),t instanceof at?t.format():at.prototype.format.call(t)}function St(t,e){return wt(t,!1,!0).resolve(e)}function It(t,e){return t?wt(t,!1,!0).resolveObject(e):e}at.prototype.parse=function(t,e,r){if(!H.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var n=t.indexOf("?"),i=-1!==n&&n<t.indexOf("#")?"?":"#",o=t.split(i),s=/\\/g;o[0]=o[0].replace(s,"/"),t=o.join(i);var a=t;if(a=a.trim(),!r&&1===t.split("#").length){var l=ct.exec(a);if(l)return this.path=a,this.href=a,this.pathname=l[1],l[2]?(this.search=l[2],this.query=e?et.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var u=lt.exec(a);if(u){u=u[0];var c=u.toLowerCase();this.protocol=c,a=a.substr(u.length)}if(r||u||a.match(/^\/\/[^@\/]+@[^@\/]+/)){var h="//"===a.substr(0,2);!h||u&&xt[u]||(a=a.substr(2),this.slashes=!0)}if(!xt[u]&&(h||u&&!bt[u])){for(var p,f,d=-1,m=0;m<mt.length;m++){var g=a.indexOf(mt[m]);-1!==g&&(-1===d||g<d)&&(d=g)}f=-1===d?a.lastIndexOf("@"):a.lastIndexOf("@",d),-1!==f&&(p=a.slice(0,f),a=a.slice(f+1),this.auth=decodeURIComponent(p)),d=-1;for(m=0;m<dt.length;m++){g=a.indexOf(dt[m]);-1!==g&&(-1===d||g<d)&&(d=g)}-1===d&&(d=a.length),this.host=a.slice(0,d),a=a.slice(d),this.parseHost(),this.hostname=this.hostname||"";var y="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!y)for(var _=this.hostname.split(/\./),v=(m=0,_.length);m<v;m++){var x=_[m];if(x&&!x.match(yt)){for(var b="",w=0,E=x.length;w<E;w++)x.charCodeAt(w)>127?b+="x":b+=x[w];if(!b.match(yt)){var S=_.slice(0,m),I=_.slice(m+1),T=x.match(_t);T&&(S.push(T[1]),I.unshift(T[2])),I.length&&(a="/"+I.join(".")+a),this.hostname=S.join(".");break}}}this.hostname.length>gt?this.hostname="":this.hostname=this.hostname.toLowerCase(),y||(this.hostname=Y.toASCII(this.hostname));var C=this.port?":"+this.port:"",M=this.hostname||"";this.host=M+C,this.href+=this.host,y&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==a[0]&&(a="/"+a))}if(!vt[c])for(m=0,v=ft.length;m<v;m++){var A=ft[m];if(-1!==a.indexOf(A)){var P=encodeURIComponent(A);P===A&&(P=escape(A)),a=a.split(A).join(P)}}var k=a.indexOf("#");-1!==k&&(this.hash=a.substr(k),a=a.slice(0,k));var L=a.indexOf("?");if(-1!==L?(this.search=a.substr(L),this.query=a.substr(L+1),e&&(this.query=et.parse(this.query)),a=a.slice(0,L)):e&&(this.search="",this.query={}),a&&(this.pathname=a),bt[c]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){C=this.pathname||"";var z=this.search||"";this.path=C+z}return this.href=this.format(),this},at.prototype.format=function(){var t=this.auth||"";t&&(t=encodeURIComponent(t),t=t.replace(/%3A/i,":"),t+="@");var e=this.protocol||"",r=this.pathname||"",n=this.hash||"",i=!1,o="";this.host?i=t+this.host:this.hostname&&(i=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&H.isObject(this.query)&&Object.keys(this.query).length&&(o=et.stringify(this.query));var s=this.search||o&&"?"+o||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||bt[e])&&!1!==i?(i="//"+(i||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):i||(i=""),n&&"#"!==n.charAt(0)&&(n="#"+n),s&&"?"!==s.charAt(0)&&(s="?"+s),r=r.replace(/[?#]/g,function(t){return encodeURIComponent(t)}),s=s.replace("#","%23"),e+i+r+s+n},at.prototype.resolve=function(t){return this.resolveObject(wt(t,!1,!0)).format()},at.prototype.resolveObject=function(t){if(H.isString(t)){var e=new at;e.parse(t,!1,!0),t=e}for(var r=new at,n=Object.keys(this),i=0;i<n.length;i++){var o=n[i];r[o]=this[o]}if(r.hash=t.hash,""===t.href)return r.href=r.format(),r;if(t.slashes&&!t.protocol){for(var s=Object.keys(t),a=0;a<s.length;a++){var l=s[a];"protocol"!==l&&(r[l]=t[l])}return bt[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(t.protocol&&t.protocol!==r.protocol){if(!bt[t.protocol]){for(var u=Object.keys(t),c=0;c<u.length;c++){var h=u[c];r[h]=t[h]}return r.href=r.format(),r}if(r.protocol=t.protocol,t.host||xt[t.protocol])r.pathname=t.pathname;else{var p=(t.pathname||"").split("/");while(p.length&&!(t.host=p.shift()));t.host||(t.host=""),t.hostname||(t.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),r.pathname=p.join("/")}if(r.search=t.search,r.query=t.query,r.host=t.host||"",r.auth=t.auth,r.hostname=t.hostname||t.host,r.port=t.port,r.pathname||r.search){var f=r.pathname||"",d=r.search||"";r.path=f+d}return r.slashes=r.slashes||t.slashes,r.href=r.format(),r}var m=r.pathname&&"/"===r.pathname.charAt(0),g=t.host||t.pathname&&"/"===t.pathname.charAt(0),y=g||m||r.host&&t.pathname,_=y,v=r.pathname&&r.pathname.split("/")||[],x=(p=t.pathname&&t.pathname.split("/")||[],r.protocol&&!bt[r.protocol]);if(x&&(r.hostname="",r.port=null,r.host&&(""===v[0]?v[0]=r.host:v.unshift(r.host)),r.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===p[0]?p[0]=t.host:p.unshift(t.host)),t.host=null),y=y&&(""===p[0]||""===v[0])),g)r.host=t.host||""===t.host?t.host:r.host,r.hostname=t.hostname||""===t.hostname?t.hostname:r.hostname,r.search=t.search,r.query=t.query,v=p;else if(p.length)v||(v=[]),v.pop(),v=v.concat(p),r.search=t.search,r.query=t.query;else if(!H.isNullOrUndefined(t.search)){if(x){r.hostname=r.host=v.shift();var b=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@");b&&(r.auth=b.shift(),r.host=r.hostname=b.shift())}return r.search=t.search,r.query=t.query,H.isNull(r.pathname)&&H.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r}if(!v.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var w=v.slice(-1)[0],E=(r.host||t.host||v.length>1)&&("."===w||".."===w)||""===w,S=0,I=v.length;I>=0;I--)w=v[I],"."===w?v.splice(I,1):".."===w?(v.splice(I,1),S++):S&&(v.splice(I,1),S--);if(!y&&!_)for(;S--;S)v.unshift("..");!y||""===v[0]||v[0]&&"/"===v[0].charAt(0)||v.unshift(""),E&&"/"!==v.join("/").substr(-1)&&v.push("");var T=""===v[0]||v[0]&&"/"===v[0].charAt(0);if(x){r.hostname=r.host=T?"":v.length?v.shift():"";b=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@");b&&(r.auth=b.shift(),r.host=r.hostname=b.shift())}return y=y||r.host&&v.length,y&&!T&&v.unshift(""),v.length?r.pathname=v.join("/"):(r.pathname=null,r.path=null),H.isNull(r.pathname)&&H.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=t.auth||r.auth,r.slashes=r.slashes||t.slashes,r.href=r.format(),r},at.prototype.parseHost=function(){var t=this.host,e=ut.exec(t);e&&(e=e[0],":"!==e&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)};var Tt={parse:rt,resolve:nt,resolveObject:it,format:ot,Url:st};function Ct(t){for(var e=0;e<U.layout.length;e++)for(var r in U[U.layout[e]])if(r===t)return U[U.layout[e]][r];for(var n=0;n<U.paint.length;n++)for(var i in U[U.paint[n]])if(i===t)return U[U.paint[n]][i];return null}function Mt(t,e){for(var r in t.sources)e(t.sources[r])}function At(t,e){for(var r=0,n=t.layers;r<n.length;r+=1){var i=n[r];e(i)}}function Pt(t,e,r){function n(t,e){var n=t[e];n&&Object.keys(n).forEach(function(i){r({path:[t.id,e,i],key:i,value:n[i],reference:Ct(i),set:function(t){n[i]=t}})})}At(t,function(t){e.paint&&n(t,"paint"),e.layout&&n(t,"layout")})}function kt(t,e){for(var r in t)0===r.indexOf("layout")&&e(t[r],r)}function Lt(t,e){for(var r in t)0===r.indexOf("paint")&&e(t[r],r)}function zt(t,e){return"string"===typeof e&&"@"===e[0]?zt(t,t.constants[e]):e}function Dt(t){return Array.isArray(t.stops)}function Rt(t,e,r){t[r]=t[e],delete t[e]}function Ot(t){function e(t){var e=Tt.parse(t),r=e.pathname.split("/");return"mapbox:"!==e.protocol?t:"fontstack"===e.hostname?"mapbox://fonts/mapbox/{fontstack}/{range}.pbf":"fonts"===e.hostname?"mapbox://fonts/"+r[2]+"/{fontstack}/{range}.pbf":void 0}function r(t){function e(t){return t.split(",").map(function(t){return t.trim()})}if(Array.isArray(t))return t;if("string"===typeof t)return e(t);if("object"===typeof t)return t.stops.forEach(function(t){t[1]=e(t[1])}),t;throw new Error("unexpected font value")}t.version=8,Mt(t,function(t){"video"===t.type&&void 0!==t.url&&Rt(t,"url","urls"),"video"===t.type&&t.coordinates.forEach(function(t){return t.reverse()})}),At(t,function(t){kt(t,function(t){void 0!==t["symbol-min-distance"]&&Rt(t,"symbol-min-distance","symbol-spacing")}),Lt(t,function(t){void 0!==t["background-image"]&&Rt(t,"background-image","background-pattern"),void 0!==t["line-image"]&&Rt(t,"line-image","line-pattern"),void 0!==t["fill-image"]&&Rt(t,"fill-image","fill-pattern")})}),Pt(t,{paint:!0,layout:!0},function(e){var r=zt(t,e.value);Dt(r)&&r.stops.forEach(function(e){e[1]=zt(t,e[1])}),e.set(r)}),delete t.constants,At(t,function(t){kt(t,function(t){delete t["text-max-size"],delete t["icon-max-size"]}),Lt(t,function(e){e["text-size"]&&(t.layout||(t.layout={}),t.layout["text-size"]=e["text-size"],delete e["text-size"]),e["icon-size"]&&(t.layout||(t.layout={}),t.layout["icon-size"]=e["icon-size"],delete e["icon-size"])})}),t.glyphs&&(t.glyphs=e(t.glyphs)),At(t,function(t){kt(t,function(t){t["text-font"]&&(t["text-font"]=r(t["text-font"]))})});for(var n=0,i=t.layers.length-1;i>=0;i--){var o=t.layers[i];if("symbol"!==o.type){n=i+1;break}}var s=t.layers.splice(n);return s.reverse(),t.layers=t.layers.concat(s),t}function Nt(t){var e=[],r=arguments.length-1;while(r-- >0)e[r]=arguments[r+1];for(var n=0,i=e;n<i.length;n+=1){var o=i[n];for(var s in o)t[s]=o[s]}return t}var Ft=function(t){function e(e,r){t.call(this,r),this.message=r,this.key=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),Bt=function(t,e){void 0===e&&(e=[]),this.parent=t,this.bindings={};for(var r=0,n=e;r<n.length;r+=1){var i=n[r],o=i[0],s=i[1];this.bindings[o]=s}};Bt.prototype.concat=function(t){return new Bt(this,t)},Bt.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},Bt.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var jt={kind:"null"},Ut={kind:"number"},Vt={kind:"string"},Gt={kind:"boolean"},qt={kind:"color"},$t={kind:"object"},Zt={kind:"value"},Xt={kind:"error"},Wt={kind:"collator"},Yt={kind:"formatted"},Ht={kind:"resolvedImage"};function Jt(t,e){return{kind:"array",itemType:t,N:e}}function Kt(t){if("array"===t.kind){var e=Kt(t.itemType);return"number"===typeof t.N?"array<"+e+", "+t.N+">":"value"===t.itemType.kind?"array":"array<"+e+">"}return t.kind}var Qt=[jt,Ut,Vt,Gt,qt,Yt,$t,Jt(Zt),Ht];function te(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!te(t.itemType,e.itemType))&&("number"!==typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(var r=0,n=Qt;r<n.length;r+=1){var i=n[r];if(!te(i,e))return null}}return"Expected "+Kt(t)+" but found "+Kt(e)+" instead."}function ee(t,e){return e.some(function(e){return e.kind===t.kind})}function re(t,e){return e.some(function(e){return"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"===typeof t:e===typeof t})}var ne=W(function(t,e){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(t){return t=Math.round(t),t<0?0:t>255?255:t}function i(t){return t<0?0:t>1?1:t}function o(t){return"%"===t[t.length-1]?n(parseFloat(t)/100*255):n(parseInt(t))}function s(t){return"%"===t[t.length-1]?i(parseFloat(t)/100):i(parseFloat(t))}function a(t,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?t+(e-t)*r*6:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}function l(t){var e=t.replace(/ /g,"").toLowerCase();if(e in r)return r[e].slice();if("#"===e[0]){if(4===e.length){var i=parseInt(e.substr(1),16);return i>=0&&i<=4095?[(3840&i)>>4|(3840&i)>>8,240&i|(240&i)>>4,15&i|(15&i)<<4,1]:null}if(7===e.length){i=parseInt(e.substr(1),16);return i>=0&&i<=16777215?[(16711680&i)>>16,(65280&i)>>8,255&i,1]:null}return null}var l=e.indexOf("("),u=e.indexOf(")");if(-1!==l&&u+1===e.length){var c=e.substr(0,l),h=e.substr(l+1,u-(l+1)).split(","),p=1;switch(c){case"rgba":if(4!==h.length)return null;p=s(h.pop());case"rgb":return 3!==h.length?null:[o(h[0]),o(h[1]),o(h[2]),p];case"hsla":if(4!==h.length)return null;p=s(h.pop());case"hsl":if(3!==h.length)return null;var f=(parseFloat(h[0])%360+360)%360/360,d=s(h[1]),m=s(h[2]),g=m<=.5?m*(d+1):m+d-m*d,y=2*m-g;return[n(255*a(y,g,f+1/3)),n(255*a(y,g,f)),n(255*a(y,g,f-1/3)),p];default:return null}}return null}try{e.parseCSSColor=l}catch(u){}}),ie=ne.parseCSSColor,oe=function(t,e,r,n){void 0===n&&(n=1),this.r=t,this.g=e,this.b=r,this.a=n};oe.parse=function(t){if(t){if(t instanceof oe)return t;if("string"===typeof t){var e=ie(t);if(e)return new oe(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3])}}},oe.prototype.toString=function(){var t=this.toArray(),e=t[0],r=t[1],n=t[2],i=t[3];return"rgba("+Math.round(e)+","+Math.round(r)+","+Math.round(n)+","+i+")"},oe.prototype.toArray=function(){var t=this,e=t.r,r=t.g,n=t.b,i=t.a;return 0===i?[0,0,0,0]:[255*e/i,255*r/i,255*n/i,i]},oe.black=new oe(0,0,0,1),oe.white=new oe(1,1,1,1),oe.transparent=new oe(0,0,0,0),oe.red=new oe(1,0,0,1);var se=function(t,e,r){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};se.prototype.compare=function(t,e){return this.collator.compare(t,e)},se.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var ae=function(t,e,r,n,i){this.text=t,this.image=e,this.scale=r,this.fontStack=n,this.textColor=i},le=function(t){this.sections=t};le.fromString=function(t){return new le([new ae(t,null,null,null,null)])},le.prototype.isEmpty=function(){return 0===this.sections.length||!this.sections.some(function(t){return 0!==t.text.length||t.image&&0!==t.image.name.length})},le.factory=function(t){return t instanceof le?t:le.fromString(t)},le.prototype.toString=function(){return 0===this.sections.length?"":this.sections.map(function(t){return t.text}).join("")},le.prototype.serialize=function(){for(var t=["format"],e=0,r=this.sections;e<r.length;e+=1){var n=r[e];if(n.image)t.push(["image",n.image.name]);else{t.push(n.text);var i={};n.fontStack&&(i["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(i["font-scale"]=n.scale),n.textColor&&(i["text-color"]=["rgba"].concat(n.textColor.toArray())),t.push(i)}}return t};var ue=function(t){this.name=t.name,this.available=t.available};function ce(t,e,r,n){if(!("number"===typeof t&&t>=0&&t<=255&&"number"===typeof e&&e>=0&&e<=255&&"number"===typeof r&&r>=0&&r<=255)){var i="number"===typeof n?[t,e,r,n]:[t,e,r];return"Invalid rgba value ["+i.join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}return"undefined"===typeof n||"number"===typeof n&&n>=0&&n<=1?null:"Invalid rgba value ["+[t,e,r,n].join(", ")+"]: 'a' must be between 0 and 1."}function he(t){if(null===t)return!0;if("string"===typeof t)return!0;if("boolean"===typeof t)return!0;if("number"===typeof t)return!0;if(t instanceof oe)return!0;if(t instanceof se)return!0;if(t instanceof le)return!0;if(t instanceof ue)return!0;if(Array.isArray(t)){for(var e=0,r=t;e<r.length;e+=1){var n=r[e];if(!he(n))return!1}return!0}if("object"===typeof t){for(var i in t)if(!he(t[i]))return!1;return!0}return!1}function pe(t){if(null===t)return jt;if("string"===typeof t)return Vt;if("boolean"===typeof t)return Gt;if("number"===typeof t)return Ut;if(t instanceof oe)return qt;if(t instanceof se)return Wt;if(t instanceof le)return Yt;if(t instanceof ue)return Ht;if(Array.isArray(t)){for(var e,r=t.length,n=0,i=t;n<i.length;n+=1){var o=i[n],s=pe(o);if(e){if(e===s)continue;e=Zt;break}e=s}return Jt(e||Zt,r)}return $t}function fe(t){var e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof oe||t instanceof le||t instanceof ue?t.toString():JSON.stringify(t)}ue.prototype.toString=function(){return this.name},ue.fromString=function(t){return t?new ue({name:t,available:!1}):null},ue.prototype.serialize=function(){return["image",this.name]};var de=function(t,e){this.type=t,this.value=e};de.parse=function(t,e){if(2!==t.length)return e.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!he(t[1]))return e.error("invalid value");var r=t[1],n=pe(r),i=e.expectedType;return"array"!==n.kind||0!==n.N||!i||"array"!==i.kind||"number"===typeof i.N&&0!==i.N||(n=i),new de(n,r)},de.prototype.evaluate=function(){return this.value},de.prototype.eachChild=function(){},de.prototype.outputDefined=function(){return!0},de.prototype.serialize=function(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof oe?["rgba"].concat(this.value.toArray()):this.value instanceof le?this.value.serialize():this.value};var me=function(t){this.name="ExpressionEvaluationError",this.message=t};me.prototype.toJSON=function(){return this.message};var ge={string:Vt,number:Ut,boolean:Gt,object:$t},ye=function(t,e){this.type=t,this.args=e};ye.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var r,n=1,i=t[0];if("array"===i){var o,s;if(t.length>2){var a=t[1];if("string"!==typeof a||!(a in ge)||"object"===a)return e.error('The item type argument of "array" must be one of string, number, boolean',1);o=ge[a],n++}else o=Zt;if(t.length>3){if(null!==t[2]&&("number"!==typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);s=t[2],n++}r=Jt(o,s)}else r=ge[i];for(var l=[];n<t.length;n++){var u=e.parse(t[n],n,Zt);if(!u)return null;l.push(u)}return new ye(r,l)},ye.prototype.evaluate=function(t){for(var e=0;e<this.args.length;e++){var r=this.args[e].evaluate(t),n=te(this.type,pe(r));if(!n)return r;if(e===this.args.length-1)throw new me("Expected value to be of type "+Kt(this.type)+", but found "+Kt(pe(r))+" instead.")}return null},ye.prototype.eachChild=function(t){this.args.forEach(t)},ye.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},ye.prototype.serialize=function(){var t=this.type,e=[t.kind];if("array"===t.kind){var r=t.itemType;if("string"===r.kind||"number"===r.kind||"boolean"===r.kind){e.push(r.kind);var n=t.N;("number"===typeof n||this.args.length>1)&&e.push(n)}}return e.concat(this.args.map(function(t){return t.serialize()}))};var _e=function(t){this.type=Yt,this.sections=t};_e.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var r=t[1];if(!Array.isArray(r)&&"object"===typeof r)return e.error("First argument must be an image or text section.");for(var n=[],i=!1,o=1;o<=t.length-1;++o){var s=t[o];if(i&&"object"===typeof s&&!Array.isArray(s)){i=!1;var a=null;if(s["font-scale"]&&(a=e.parse(s["font-scale"],1,Ut),!a))return null;var l=null;if(s["text-font"]&&(l=e.parse(s["text-font"],1,Jt(Vt)),!l))return null;var u=null;if(s["text-color"]&&(u=e.parse(s["text-color"],1,qt),!u))return null;var c=n[n.length-1];c.scale=a,c.font=l,c.textColor=u}else{var h=e.parse(t[o],1,Zt);if(!h)return null;var p=h.type.kind;if("string"!==p&&"value"!==p&&"null"!==p&&"resolvedImage"!==p)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");i=!0,n.push({content:h,scale:null,font:null,textColor:null})}}return new _e(n)},_e.prototype.evaluate=function(t){var e=function(e){var r=e.content.evaluate(t);return pe(r)===Ht?new ae("",r,null,null,null):new ae(fe(r),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)};return new le(this.sections.map(e))},_e.prototype.eachChild=function(t){for(var e=0,r=this.sections;e<r.length;e+=1){var n=r[e];t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor)}},_e.prototype.outputDefined=function(){return!1},_e.prototype.serialize=function(){for(var t=["format"],e=0,r=this.sections;e<r.length;e+=1){var n=r[e];t.push(n.content.serialize());var i={};n.scale&&(i["font-scale"]=n.scale.serialize()),n.font&&(i["text-font"]=n.font.serialize()),n.textColor&&(i["text-color"]=n.textColor.serialize()),t.push(i)}return t};var ve=function(t){this.type=Ht,this.input=t};ve.parse=function(t,e){if(2!==t.length)return e.error("Expected two arguments.");var r=e.parse(t[1],1,Vt);return r?new ve(r):e.error("No image name provided.")},ve.prototype.evaluate=function(t){var e=this.input.evaluate(t),r=ue.fromString(e);return r&&t.availableImages&&(r.available=t.availableImages.indexOf(e)>-1),r},ve.prototype.eachChild=function(t){t(this.input)},ve.prototype.outputDefined=function(){return!1},ve.prototype.serialize=function(){return["image",this.input.serialize()]};var xe={"to-boolean":Gt,"to-color":qt,"to-number":Ut,"to-string":Vt},be=function(t,e){this.type=t,this.args=e};be.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var r=t[0];if(("to-boolean"===r||"to-string"===r)&&2!==t.length)return e.error("Expected one argument.");for(var n=xe[r],i=[],o=1;o<t.length;o++){var s=e.parse(t[o],o,Zt);if(!s)return null;i.push(s)}return new be(n,i)},be.prototype.evaluate=function(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){for(var e,r,n=0,i=this.args;n<i.length;n+=1){var o=i[n];if(e=o.evaluate(t),r=null,e instanceof oe)return e;if("string"===typeof e){var s=t.parseColor(e);if(s)return s}else if(Array.isArray(e)&&(r=e.length<3||e.length>4?"Invalid rbga value "+JSON.stringify(e)+": expected an array containing either three or four numeric values.":ce(e[0],e[1],e[2],e[3]),!r))return new oe(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new me(r||"Could not parse color from value '"+("string"===typeof e?e:String(JSON.stringify(e)))+"'")}if("number"===this.type.kind){for(var a=null,l=0,u=this.args;l<u.length;l+=1){var c=u[l];if(a=c.evaluate(t),null===a)return 0;var h=Number(a);if(!isNaN(h))return h}throw new me("Could not convert "+JSON.stringify(a)+" to number.")}return"formatted"===this.type.kind?le.fromString(fe(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?ue.fromString(fe(this.args[0].evaluate(t))):fe(this.args[0].evaluate(t))},be.prototype.eachChild=function(t){this.args.forEach(t)},be.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},be.prototype.serialize=function(){if("formatted"===this.type.kind)return new _e([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new ve(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild(function(e){t.push(e.serialize())}),t};var we=["Unknown","Point","LineString","Polygon"],Ee=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};Ee.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},Ee.prototype.geometryType=function(){return this.feature?"number"===typeof this.feature.type?we[this.feature.type]:this.feature.type:null},Ee.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},Ee.prototype.canonicalID=function(){return this.canonical},Ee.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Ee.prototype.parseColor=function(t){var e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=oe.parse(t)),e};var Se=function(t,e,r,n){this.name=t,this.type=e,this._evaluate=r,this.args=n};function Ie(t){return Array.isArray(t)?"("+t.map(Kt).join(", ")+")":"("+Kt(t.type)+"...)"}Se.prototype.evaluate=function(t){return this._evaluate(t,this.args)},Se.prototype.eachChild=function(t){this.args.forEach(t)},Se.prototype.outputDefined=function(){return!1},Se.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},Se.parse=function(t,e){var r,n=t[0],i=Se.definitions[n];if(!i)return e.error('Unknown expression "'+n+'". If you wanted a literal array, use ["literal", [...]].',0);for(var o=Array.isArray(i)?i[0]:i.type,s=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,a=s.filter(function(e){var r=e[0];return!Array.isArray(r)||r.length===t.length-1}),l=null,u=0,c=a;u<c.length;u+=1){var h=c[u],p=h[0],f=h[1];l=new rr(e.registry,e.path,null,e.scope);for(var d=[],m=!1,g=1;g<t.length;g++){var y=t[g],_=Array.isArray(p)?p[g-1]:p.type,v=l.parse(y,1+d.length,_);if(!v){m=!0;break}d.push(v)}if(!m)if(Array.isArray(p)&&p.length!==d.length)l.error("Expected "+p.length+" arguments, but found "+d.length+" instead.");else{for(var x=0;x<d.length;x++){var b=Array.isArray(p)?p[x]:p.type,w=d[x];l.concat(x+1).checkSubtype(b,w.type)}if(0===l.errors.length)return new Se(n,o,f,d)}}if(1===a.length)(r=e.errors).push.apply(r,l.errors);else{for(var E=a.length?a:s,S=E.map(function(t){var e=t[0];return Ie(e)}).join(" | "),I=[],T=1;T<t.length;T++){var C=e.parse(t[T],1+I.length);if(!C)return null;I.push(Kt(C.type))}e.error("Expected arguments of type "+S+", but found ("+I.join(", ")+") instead.")}return null},Se.register=function(t,e){for(var r in Se.definitions=e,e)t[r]=Se};var Te=function(t,e,r){this.type=Wt,this.locale=r,this.caseSensitive=t,this.diacriticSensitive=e};Te.parse=function(t,e){if(2!==t.length)return e.error("Expected one argument.");var r=t[1];if("object"!==typeof r||Array.isArray(r))return e.error("Collator options argument must be an object.");var n=e.parse(void 0!==r["case-sensitive"]&&r["case-sensitive"],1,Gt);if(!n)return null;var i=e.parse(void 0!==r["diacritic-sensitive"]&&r["diacritic-sensitive"],1,Gt);if(!i)return null;var o=null;return r["locale"]&&(o=e.parse(r["locale"],1,Vt),!o)?null:new Te(n,i,o)},Te.prototype.evaluate=function(t){return new se(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},Te.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},Te.prototype.outputDefined=function(){return!1},Te.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t["locale"]=this.locale.serialize()),["collator",t]};var Ce=8192;function Me(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Ae(t){return(180+t)/360}function Pe(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function ke(t,e){return!(t[0]<=e[0])&&(!(t[2]>=e[2])&&(!(t[1]<=e[1])&&!(t[3]>=e[3])))}function Le(t,e){var r=Ae(t[0]),n=Pe(t[1]),i=Math.pow(2,e.z);return[Math.round(r*i*Ce),Math.round(n*i*Ce)]}function ze(t,e,r){var n=t[0]-e[0],i=t[1]-e[1],o=t[0]-r[0],s=t[1]-r[1];return n*s-o*i===0&&n*o<=0&&i*s<=0}function De(t,e,r){return e[1]>t[1]!==r[1]>t[1]&&t[0]<(r[0]-e[0])*(t[1]-e[1])/(r[1]-e[1])+e[0]}function Re(t,e){for(var r=!1,n=0,i=e.length;n<i;n++)for(var o=e[n],s=0,a=o.length;s<a-1;s++){if(ze(t,o[s],o[s+1]))return!1;De(t,o[s],o[s+1])&&(r=!r)}return r}function Oe(t,e){for(var r=0;r<e.length;r++)if(Re(t,e[r]))return!0;return!1}function Ne(t,e){return t[0]*e[1]-t[1]*e[0]}function Fe(t,e,r,n){var i=t[0]-r[0],o=t[1]-r[1],s=e[0]-r[0],a=e[1]-r[1],l=n[0]-r[0],u=n[1]-r[1],c=i*u-l*o,h=s*u-l*a;return c>0&&h<0||c<0&&h>0}function Be(t,e,r,n){var i=[e[0]-t[0],e[1]-t[1]],o=[n[0]-r[0],n[1]-r[1]];return 0!==Ne(o,i)&&!(!Fe(t,e,r,n)||!Fe(r,n,t,e))}function je(t,e,r){for(var n=0,i=r;n<i.length;n+=1)for(var o=i[n],s=0;s<o.length-1;++s)if(Be(t,e,o[s],o[s+1]))return!0;return!1}function Ue(t,e){for(var r=0;r<t.length;++r)if(!Re(t[r],e))return!1;for(var n=0;n<t.length-1;++n)if(je(t[n],t[n+1],e))return!1;return!0}function Ve(t,e){for(var r=0;r<e.length;r++)if(Ue(t,e[r]))return!0;return!1}function Ge(t,e,r){for(var n=[],i=0;i<t.length;i++){for(var o=[],s=0;s<t[i].length;s++){var a=Le(t[i][s],r);Me(e,a),o.push(a)}n.push(o)}return n}function qe(t,e,r){for(var n=[],i=0;i<t.length;i++){var o=Ge(t[i],e,r);n.push(o)}return n}function $e(t,e,r,n){if(t[0]<r[0]||t[0]>r[2]){var i=.5*n,o=t[0]-r[0]>i?-n:r[0]-t[0]>i?n:0;0===o&&(o=t[0]-r[2]>i?-n:r[2]-t[0]>i?n:0),t[0]+=o}Me(e,t)}function Ze(t){t[0]=t[1]=1/0,t[2]=t[3]=-1/0}function Xe(t,e,r,n){for(var i=Math.pow(2,n.z)*Ce,o=[n.x*Ce,n.y*Ce],s=[],a=0,l=t;a<l.length;a+=1)for(var u=l[a],c=0,h=u;c<h.length;c+=1){var p=h[c],f=[p.x+o[0],p.y+o[1]];$e(f,e,r,i),s.push(f)}return s}function We(t,e,r,n){for(var i=Math.pow(2,n.z)*Ce,o=[n.x*Ce,n.y*Ce],s=[],a=0,l=t;a<l.length;a+=1){for(var u=l[a],c=[],h=0,p=u;h<p.length;h+=1){var f=p[h],d=[f.x+o[0],f.y+o[1]];Me(e,d),c.push(d)}s.push(c)}if(e[2]-e[0]<=i/2){Ze(e);for(var m=0,g=s;m<g.length;m+=1)for(var y=g[m],_=0,v=y;_<v.length;_+=1){var x=v[_];$e(x,e,r,i)}}return s}function Ye(t,e){var r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if("Polygon"===e.type){var o=Ge(e.coordinates,n,i),s=Xe(t.geometry(),r,n,i);if(!ke(r,n))return!1;for(var a=0,l=s;a<l.length;a+=1){var u=l[a];if(!Re(u,o))return!1}}if("MultiPolygon"===e.type){var c=qe(e.coordinates,n,i),h=Xe(t.geometry(),r,n,i);if(!ke(r,n))return!1;for(var p=0,f=h;p<f.length;p+=1){var d=f[p];if(!Oe(d,c))return!1}}return!0}function He(t,e){var r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if("Polygon"===e.type){var o=Ge(e.coordinates,n,i),s=We(t.geometry(),r,n,i);if(!ke(r,n))return!1;for(var a=0,l=s;a<l.length;a+=1){var u=l[a];if(!Ue(u,o))return!1}}if("MultiPolygon"===e.type){var c=qe(e.coordinates,n,i),h=We(t.geometry(),r,n,i);if(!ke(r,n))return!1;for(var p=0,f=h;p<f.length;p+=1){var d=f[p];if(!Ve(d,c))return!1}}return!0}var Je=function(t,e){this.type=Gt,this.geojson=t,this.geometries=e};function Ke(t){if(t instanceof Se){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof Je)return!1;var e=!0;return t.eachChild(function(t){e&&!Ke(t)&&(e=!1)}),e}function Qe(t){if(t instanceof Se&&"feature-state"===t.name)return!1;var e=!0;return t.eachChild(function(t){e&&!Qe(t)&&(e=!1)}),e}function tr(t,e){if(t instanceof Se&&e.indexOf(t.name)>=0)return!1;var r=!0;return t.eachChild(function(t){r&&!tr(t,e)&&(r=!1)}),r}Je.parse=function(t,e){if(2!==t.length)return e.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(he(t[1])){var r=t[1];if("FeatureCollection"===r.type)for(var n=0;n<r.features.length;++n){var i=r.features[n].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new Je(r,r.features[n].geometry)}else if("Feature"===r.type){var o=r.geometry.type;if("Polygon"===o||"MultiPolygon"===o)return new Je(r,r.geometry)}else if("Polygon"===r.type||"MultiPolygon"===r.type)return new Je(r,r)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Je.prototype.evaluate=function(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return Ye(t,this.geometries);if("LineString"===t.geometryType())return He(t,this.geometries)}return!1},Je.prototype.eachChild=function(){},Je.prototype.outputDefined=function(){return!0},Je.prototype.serialize=function(){return["within",this.geojson]};var er=function(t,e){this.type=e.type,this.name=t,this.boundExpression=e};er.parse=function(t,e){if(2!==t.length||"string"!==typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");var r=t[1];return e.scope.has(r)?new er(r,e.scope.get(r)):e.error('Unknown variable "'+r+'". Make sure "'+r+'" has been bound in an enclosing "let" expression before using it.',1)},er.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},er.prototype.eachChild=function(){},er.prototype.outputDefined=function(){return!1},er.prototype.serialize=function(){return["var",this.name]};var rr=function(t,e,r,n,i){void 0===e&&(e=[]),void 0===n&&(n=new Bt),void 0===i&&(i=[]),this.registry=t,this.path=e,this.key=e.map(function(t){return"["+t+"]"}).join(""),this.scope=n,this.errors=i,this.expectedType=r};function nr(t){if(t instanceof er)return nr(t.boundExpression);if(t instanceof Se&&"error"===t.name)return!1;if(t instanceof Te)return!1;if(t instanceof Je)return!1;var e=t instanceof be||t instanceof ye,r=!0;return t.eachChild(function(t){r=e?r&&nr(t):r&&t instanceof de}),!!r&&(Ke(t)&&tr(t,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"]))}function ir(t,e){var r,n,i=t.length-1,o=0,s=i,a=0;while(o<=s)if(a=Math.floor((o+s)/2),r=t[a],n=t[a+1],r<=e){if(a===i||e<n)return a;o=a+1}else{if(!(r>e))throw new me("Input is not a number.");s=a-1}return 0}rr.prototype.parse=function(t,e,r,n,i){return void 0===i&&(i={}),e?this.concat(e,r,n)._parse(t,i):this._parse(t,i)},rr.prototype._parse=function(t,e){function r(t,e,r){return"assert"===r?new ye(e,[t]):"coerce"===r?new be(e,[t]):t}if(null!==t&&"string"!==typeof t&&"boolean"!==typeof t&&"number"!==typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var n=t[0];if("string"!==typeof n)return this.error("Expression name must be a string, but found "+typeof n+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var i=this.registry[n];if(i){var o=i.parse(t,this);if(!o)return null;if(this.expectedType){var s=this.expectedType,a=o.type;if("string"!==s.kind&&"number"!==s.kind&&"boolean"!==s.kind&&"object"!==s.kind&&"array"!==s.kind||"value"!==a.kind)if("color"!==s.kind&&"formatted"!==s.kind&&"resolvedImage"!==s.kind||"value"!==a.kind&&"string"!==a.kind){if(this.checkSubtype(s,a))return null}else o=r(o,s,e.typeAnnotation||"coerce");else o=r(o,s,e.typeAnnotation||"assert")}if(!(o instanceof de)&&"resolvedImage"!==o.type.kind&&nr(o)){var l=new Ee;try{o=new de(o.type,o.evaluate(l))}catch(u){return this.error(u.message),null}}return o}return this.error('Unknown expression "'+n+'". If you wanted a literal array, use ["literal", [...]].',0)}return"undefined"===typeof t?this.error("'undefined' value invalid. Use null instead."):"object"===typeof t?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error("Expected an array, but found "+typeof t+" instead.")},rr.prototype.concat=function(t,e,r){var n="number"===typeof t?this.path.concat(t):this.path,i=r?this.scope.concat(r):this.scope;return new rr(this.registry,n,e||null,i,this.errors)},rr.prototype.error=function(t){var e=[],r=arguments.length-1;while(r-- >0)e[r]=arguments[r+1];var n=""+this.key+e.map(function(t){return"["+t+"]"}).join("");this.errors.push(new Ft(n,t))},rr.prototype.checkSubtype=function(t,e){var r=te(t,e);return r&&this.error(r),r};var or=function(t,e,r){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(var n=0,i=r;n<i.length;n+=1){var o=i[n],s=o[0],a=o[1];this.labels.push(s),this.outputs.push(a)}};or.parse=function(t,e){if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!==0)return e.error("Expected an even number of arguments.");var r=e.parse(t[1],1,Ut);if(!r)return null;var n=[],i=null;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);for(var o=1;o<t.length;o+=2){var s=1===o?-1/0:t[o],a=t[o+1],l=o,u=o+1;if("number"!==typeof s)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',l);if(n.length&&n[n.length-1][0]>=s)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',l);var c=e.parse(a,u,i);if(!c)return null;i=i||c.type,n.push([s,c])}return new or(i,r,n)},or.prototype.evaluate=function(t){var e=this.labels,r=this.outputs;if(1===e.length)return r[0].evaluate(t);var n=this.input.evaluate(t);if(n<=e[0])return r[0].evaluate(t);var i=e.length;if(n>=e[i-1])return r[i-1].evaluate(t);var o=ir(e,n);return r[o].evaluate(t)},or.prototype.eachChild=function(t){t(this.input);for(var e=0,r=this.outputs;e<r.length;e+=1){var n=r[e];t(n)}},or.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},or.prototype.serialize=function(){for(var t=["step",this.input.serialize()],e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t};var sr=ar;function ar(t,e,r,n){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=r,this.p2y=n}function lr(t,e,r){return t*(1-r)+e*r}function ur(t,e,r){return new oe(lr(t.r,e.r,r),lr(t.g,e.g,r),lr(t.b,e.b,r),lr(t.a,e.a,r))}function cr(t,e,r){return t.map(function(t,n){return lr(t,e[n],r)})}ar.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},ar.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},ar.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},ar.prototype.solveCurveX=function(t,e){var r,n,i,o,s;for("undefined"===typeof e&&(e=1e-6),i=t,s=0;s<8;s++){if(o=this.sampleCurveX(i)-t,Math.abs(o)<e)return i;var a=this.sampleCurveDerivativeX(i);if(Math.abs(a)<1e-6)break;i-=o/a}if(r=0,n=1,i=t,i<r)return r;if(i>n)return n;while(r<n){if(o=this.sampleCurveX(i),Math.abs(o-t)<e)return i;t>o?r=i:n=i,i=.5*(n-r)+r}return i},ar.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var hr=Object.freeze({__proto__:null,number:lr,color:ur,array:cr}),pr=.95047,fr=1,dr=1.08883,mr=4/29,gr=6/29,yr=3*gr*gr,_r=gr*gr*gr,vr=Math.PI/180,xr=180/Math.PI;function br(t){return t>_r?Math.pow(t,1/3):t/yr+mr}function wr(t){return t>gr?t*t*t:yr*(t-mr)}function Er(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Sr(t){return t/=255,t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Ir(t){var e=Sr(t.r),r=Sr(t.g),n=Sr(t.b),i=br((.4124564*e+.3575761*r+.1804375*n)/pr),o=br((.2126729*e+.7151522*r+.072175*n)/fr),s=br((.0193339*e+.119192*r+.9503041*n)/dr);return{l:116*o-16,a:500*(i-o),b:200*(o-s),alpha:t.a}}function Tr(t){var e=(t.l+16)/116,r=isNaN(t.a)?e:e+t.a/500,n=isNaN(t.b)?e:e-t.b/200;return e=fr*wr(e),r=pr*wr(r),n=dr*wr(n),new oe(Er(3.2404542*r-1.5371385*e-.4985314*n),Er(-.969266*r+1.8760108*e+.041556*n),Er(.0556434*r-.2040259*e+1.0572252*n),t.alpha)}function Cr(t,e,r){return{l:lr(t.l,e.l,r),a:lr(t.a,e.a,r),b:lr(t.b,e.b,r),alpha:lr(t.alpha,e.alpha,r)}}function Mr(t){var e=Ir(t),r=e.l,n=e.a,i=e.b,o=Math.atan2(i,n)*xr;return{h:o<0?o+360:o,c:Math.sqrt(n*n+i*i),l:r,alpha:t.a}}function Ar(t){var e=t.h*vr,r=t.c,n=t.l;return Tr({l:n,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:t.alpha})}function Pr(t,e,r){var n=e-t;return t+r*(n>180||n<-180?n-360*Math.round(n/360):n)}function kr(t,e,r){return{h:Pr(t.h,e.h,r),c:lr(t.c,e.c,r),l:lr(t.l,e.l,r),alpha:lr(t.alpha,e.alpha,r)}}var Lr={forward:Ir,reverse:Tr,interpolate:Cr},zr={forward:Mr,reverse:Ar,interpolate:kr},Dr=Object.freeze({__proto__:null,lab:Lr,hcl:zr}),Rr=function(t,e,r,n,i){this.type=t,this.operator=e,this.interpolation=r,this.input=n,this.labels=[],this.outputs=[];for(var o=0,s=i;o<s.length;o+=1){var a=s[o],l=a[0],u=a[1];this.labels.push(l),this.outputs.push(u)}};function Or(t,e,r,n){var i=n-r,o=t-r;return 0===i?0:1===e?o/i:(Math.pow(e,o)-1)/(Math.pow(e,i)-1)}Rr.interpolationFactor=function(t,e,r,n){var i=0;if("exponential"===t.name)i=Or(e,t.base,r,n);else if("linear"===t.name)i=Or(e,1,r,n);else if("cubic-bezier"===t.name){var o=t.controlPoints,s=new sr(o[0],o[1],o[2],o[3]);i=s.solve(Or(e,1,r,n))}return i},Rr.parse=function(t,e){var r=t[0],n=t[1],i=t[2],o=t.slice(3);if(!Array.isArray(n)||0===n.length)return e.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){var s=n[1];if("number"!==typeof s)return e.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:s}}else{if("cubic-bezier"!==n[0])return e.error("Unknown interpolation type "+String(n[0]),1,0);var a=n.slice(1);if(4!==a.length||a.some(function(t){return"number"!==typeof t||t<0||t>1}))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:a}}if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!==0)return e.error("Expected an even number of arguments.");if(i=e.parse(i,2,Ut),!i)return null;var l=[],u=null;"interpolate-hcl"===r||"interpolate-lab"===r?u=qt:e.expectedType&&"value"!==e.expectedType.kind&&(u=e.expectedType);for(var c=0;c<o.length;c+=2){var h=o[c],p=o[c+1],f=c+3,d=c+4;if("number"!==typeof h)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',f);if(l.length&&l[l.length-1][0]>=h)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',f);var m=e.parse(p,d,u);if(!m)return null;u=u||m.type,l.push([h,m])}return"number"===u.kind||"color"===u.kind||"array"===u.kind&&"number"===u.itemType.kind&&"number"===typeof u.N?new Rr(u,r,n,i,l):e.error("Type "+Kt(u)+" is not interpolatable.")},Rr.prototype.evaluate=function(t){var e=this.labels,r=this.outputs;if(1===e.length)return r[0].evaluate(t);var n=this.input.evaluate(t);if(n<=e[0])return r[0].evaluate(t);var i=e.length;if(n>=e[i-1])return r[i-1].evaluate(t);var o=ir(e,n),s=e[o],a=e[o+1],l=Rr.interpolationFactor(this.interpolation,n,s,a),u=r[o].evaluate(t),c=r[o+1].evaluate(t);return"interpolate"===this.operator?hr[this.type.kind.toLowerCase()](u,c,l):"interpolate-hcl"===this.operator?zr.reverse(zr.interpolate(zr.forward(u),zr.forward(c),l)):Lr.reverse(Lr.interpolate(Lr.forward(u),Lr.forward(c),l))},Rr.prototype.eachChild=function(t){t(this.input);for(var e=0,r=this.outputs;e<r.length;e+=1){var n=r[e];t(n)}},Rr.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},Rr.prototype.serialize=function(){var t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var e=[this.operator,t,this.input.serialize()],r=0;r<this.labels.length;r++)e.push(this.labels[r],this.outputs[r].serialize());return e};var Nr=function(t,e){this.type=t,this.args=e};Nr.parse=function(t,e){if(t.length<2)return e.error("Expectected at least one argument.");var r=null,n=e.expectedType;n&&"value"!==n.kind&&(r=n);for(var i=[],o=0,s=t.slice(1);o<s.length;o+=1){var a=s[o],l=e.parse(a,1+i.length,r,void 0,{typeAnnotation:"omit"});if(!l)return null;r=r||l.type,i.push(l)}var u=n&&i.some(function(t){return te(n,t.type)});return new Nr(u?Zt:r,i)},Nr.prototype.evaluate=function(t){for(var e,r=null,n=0,i=0,o=this.args;i<o.length;i+=1){var s=o[i];if(n++,r=s.evaluate(t),r&&r instanceof ue&&!r.available&&(e||(e=r.name),r=null,n===this.args.length&&(r=e)),null!==r)break}return r},Nr.prototype.eachChild=function(t){this.args.forEach(t)},Nr.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},Nr.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(e){t.push(e.serialize())}),t};var Fr=function(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e};Fr.prototype.evaluate=function(t){return this.result.evaluate(t)},Fr.prototype.eachChild=function(t){for(var e=0,r=this.bindings;e<r.length;e+=1){var n=r[e];t(n[1])}t(this.result)},Fr.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var r=[],n=1;n<t.length-1;n+=2){var i=t[n];if("string"!==typeof i)return e.error("Expected string, but found "+typeof i+" instead.",n);if(/[^a-zA-Z0-9_]/.test(i))return e.error("Variable names must contain only alphanumeric characters or '_'.",n);var o=e.parse(t[n+1],n+1);if(!o)return null;r.push([i,o])}var s=e.parse(t[t.length-1],t.length-1,e.expectedType,r);return s?new Fr(r,s):null},Fr.prototype.outputDefined=function(){return this.result.outputDefined()},Fr.prototype.serialize=function(){for(var t=["let"],e=0,r=this.bindings;e<r.length;e+=1){var n=r[e],i=n[0],o=n[1];t.push(i,o.serialize())}return t.push(this.result.serialize()),t};var Br=function(t,e,r){this.type=t,this.index=e,this.input=r};Br.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,Ut),n=e.parse(t[2],2,Jt(e.expectedType||Zt));if(!r||!n)return null;var i=n.type;return new Br(i.itemType,r,n)},Br.prototype.evaluate=function(t){var e=this.index.evaluate(t),r=this.input.evaluate(t);if(e<0)throw new me("Array index out of bounds: "+e+" < 0.");if(e>=r.length)throw new me("Array index out of bounds: "+e+" > "+(r.length-1)+".");if(e!==Math.floor(e))throw new me("Array index must be an integer, but found "+e+" instead.");return r[e]},Br.prototype.eachChild=function(t){t(this.index),t(this.input)},Br.prototype.outputDefined=function(){return!1},Br.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var jr=function(t,e){this.type=Gt,this.needle=t,this.haystack=e};jr.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,Zt),n=e.parse(t[2],2,Zt);return r&&n?ee(r.type,[Gt,Vt,Ut,jt,Zt])?new jr(r,n):e.error("Expected first argument to be of type boolean, string, number or null, but found "+Kt(r.type)+" instead"):null},jr.prototype.evaluate=function(t){var e=this.needle.evaluate(t),r=this.haystack.evaluate(t);if(!r)return!1;if(!re(e,["boolean","string","number","null"]))throw new me("Expected first argument to be of type boolean, string, number or null, but found "+Kt(pe(e))+" instead.");if(!re(r,["string","array"]))throw new me("Expected second argument to be of type array or string, but found "+Kt(pe(r))+" instead.");return r.indexOf(e)>=0},jr.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},jr.prototype.outputDefined=function(){return!0},jr.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Ur=function(t,e,r){this.type=Ut,this.needle=t,this.haystack=e,this.fromIndex=r};Ur.parse=function(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,Zt),n=e.parse(t[2],2,Zt);if(!r||!n)return null;if(!ee(r.type,[Gt,Vt,Ut,jt,Zt]))return e.error("Expected first argument to be of type boolean, string, number or null, but found "+Kt(r.type)+" instead");if(4===t.length){var i=e.parse(t[3],3,Ut);return i?new Ur(r,n,i):null}return new Ur(r,n)},Ur.prototype.evaluate=function(t){var e=this.needle.evaluate(t),r=this.haystack.evaluate(t);if(!re(e,["boolean","string","number","null"]))throw new me("Expected first argument to be of type boolean, string, number or null, but found "+Kt(pe(e))+" instead.");if(!re(r,["string","array"]))throw new me("Expected second argument to be of type array or string, but found "+Kt(pe(r))+" instead.");if(this.fromIndex){var n=this.fromIndex.evaluate(t);return r.indexOf(e,n)}return r.indexOf(e)},Ur.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},Ur.prototype.outputDefined=function(){return!1},Ur.prototype.serialize=function(){if(null!=this.fromIndex&&void 0!==this.fromIndex){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Vr=function(t,e,r,n,i,o){this.inputType=t,this.type=e,this.input=r,this.cases=n,this.outputs=i,this.otherwise=o};Vr.parse=function(t,e){if(t.length<5)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!==1)return e.error("Expected an even number of arguments.");var r,n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);for(var i={},o=[],s=2;s<t.length-1;s+=2){var a=t[s],l=t[s+1];Array.isArray(a)||(a=[a]);var u=e.concat(s);if(0===a.length)return u.error("Expected at least one branch label.");for(var c=0,h=a;c<h.length;c+=1){var p=h[c];if("number"!==typeof p&&"string"!==typeof p)return u.error("Branch labels must be numbers or strings.");if("number"===typeof p&&Math.abs(p)>Number.MAX_SAFE_INTEGER)return u.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if("number"===typeof p&&Math.floor(p)!==p)return u.error("Numeric branch labels must be integer values.");if(r){if(u.checkSubtype(r,pe(p)))return null}else r=pe(p);if("undefined"!==typeof i[String(p)])return u.error("Branch labels must be unique.");i[String(p)]=o.length}var f=e.parse(l,s,n);if(!f)return null;n=n||f.type,o.push(f)}var d=e.parse(t[1],1,Zt);if(!d)return null;var m=e.parse(t[t.length-1],t.length-1,n);return m?"value"!==d.type.kind&&e.concat(1).checkSubtype(r,d.type)?null:new Vr(r,n,d,i,o,m):null},Vr.prototype.evaluate=function(t){var e=this.input.evaluate(t),r=pe(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise;return r.evaluate(t)},Vr.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},Vr.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})&&this.otherwise.outputDefined()},Vr.prototype.serialize=function(){for(var t=this,e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),n=[],i={},o=0,s=r;o<s.length;o+=1){var a=s[o],l=i[this.cases[a]];void 0===l?(i[this.cases[a]]=n.length,n.push([this.cases[a],[a]])):n[l][1].push(a)}for(var u=function(e){return"number"===t.inputType.kind?Number(e):e},c=0,h=n;c<h.length;c+=1){var p=h[c],f=(l=p[0],p[1]);1===f.length?e.push(u(f[0])):e.push(f.map(u)),e.push(this.outputs[outputIndex$1].serialize())}return e.push(this.otherwise.serialize()),e};var Gr=function(t,e,r){this.type=t,this.branches=e,this.otherwise=r};Gr.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!==0)return e.error("Expected an odd number of arguments.");var r;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(var n=[],i=1;i<t.length-1;i+=2){var o=e.parse(t[i],i,Gt);if(!o)return null;var s=e.parse(t[i+1],i+1,r);if(!s)return null;n.push([o,s]),r=r||s.type}var a=e.parse(t[t.length-1],t.length-1,r);return a?new Gr(r,n,a):null},Gr.prototype.evaluate=function(t){for(var e=0,r=this.branches;e<r.length;e+=1){var n=r[e],i=n[0],o=n[1];if(i.evaluate(t))return o.evaluate(t)}return this.otherwise.evaluate(t)},Gr.prototype.eachChild=function(t){for(var e=0,r=this.branches;e<r.length;e+=1){var n=r[e],i=n[0],o=n[1];t(i),t(o)}t(this.otherwise)},Gr.prototype.outputDefined=function(){return this.branches.every(function(t){t[0];var e=t[1];return e.outputDefined()})&&this.otherwise.outputDefined()},Gr.prototype.serialize=function(){var t=["case"];return this.eachChild(function(e){t.push(e.serialize())}),t};var qr=function(t,e,r,n){this.type=t,this.input=e,this.beginIndex=r,this.endIndex=n};function $r(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function Zr(t,e,r){return e===r}function Xr(t,e,r){return e!==r}function Wr(t,e,r){return e<r}function Yr(t,e,r){return e>r}function Hr(t,e,r){return e<=r}function Jr(t,e,r){return e>=r}function Kr(t,e,r,n){return 0===n.compare(e,r)}function Qr(t,e,r,n){return!Kr(t,e,r,n)}function tn(t,e,r,n){return n.compare(e,r)<0}function en(t,e,r,n){return n.compare(e,r)>0}function rn(t,e,r,n){return n.compare(e,r)<=0}function nn(t,e,r,n){return n.compare(e,r)>=0}function on(t,e,r){var n="=="!==t&&"!="!==t;return function(){function i(t,e,r){this.type=Gt,this.lhs=t,this.rhs=e,this.collator=r,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}return i.parse=function(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");var r=t[0],o=e.parse(t[1],1,Zt);if(!o)return null;if(!$r(r,o.type))return e.concat(1).error('"'+r+"\" comparisons are not supported for type '"+Kt(o.type)+"'.");var s=e.parse(t[2],2,Zt);if(!s)return null;if(!$r(r,s.type))return e.concat(2).error('"'+r+"\" comparisons are not supported for type '"+Kt(s.type)+"'.");if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return e.error("Cannot compare types '"+Kt(o.type)+"' and '"+Kt(s.type)+"'.");n&&("value"===o.type.kind&&"value"!==s.type.kind?o=new ye(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new ye(o.type,[s])));var a=null;if(4===t.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return e.error("Cannot use collator to compare non-string types.");if(a=e.parse(t[3],3,Wt),!a)return null}return new i(o,s,a)},i.prototype.evaluate=function(i){var o=this.lhs.evaluate(i),s=this.rhs.evaluate(i);if(n&&this.hasUntypedArgument){var a=pe(o),l=pe(s);if(a.kind!==l.kind||"string"!==a.kind&&"number"!==a.kind)throw new me('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+a.kind+", "+l.kind+") instead.")}if(this.collator&&!n&&this.hasUntypedArgument){var u=pe(o),c=pe(s);if("string"!==u.kind||"string"!==c.kind)return e(i,o,s)}return this.collator?r(i,o,s,this.collator.evaluate(i)):e(i,o,s)},i.prototype.eachChild=function(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)},i.prototype.outputDefined=function(){return!0},i.prototype.serialize=function(){var e=[t];return this.eachChild(function(t){e.push(t.serialize())}),e},i}()}qr.parse=function(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,Zt),n=e.parse(t[2],2,Ut);if(!r||!n)return null;if(!ee(r.type,[Jt(Zt),Vt,Zt]))return e.error("Expected first argument to be of type array or string, but found "+Kt(r.type)+" instead");if(4===t.length){var i=e.parse(t[3],3,Ut);return i?new qr(r.type,r,n,i):null}return new qr(r.type,r,n)},qr.prototype.evaluate=function(t){var e=this.input.evaluate(t),r=this.beginIndex.evaluate(t);if(!re(e,["string","array"]))throw new me("Expected first argument to be of type array or string, but found "+Kt(pe(e))+" instead.");if(this.endIndex){var n=this.endIndex.evaluate(t);return e.slice(r,n)}return e.slice(r)},qr.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},qr.prototype.outputDefined=function(){return!1},qr.prototype.serialize=function(){if(null!=this.endIndex&&void 0!==this.endIndex){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var sn=on("==",Zr,Kr),an=on("!=",Xr,Qr),ln=on("<",Wr,tn),un=on(">",Yr,en),cn=on("<=",Hr,rn),hn=on(">=",Jr,nn),pn=function(t,e,r,n,i){this.type=Vt,this.number=t,this.locale=e,this.currency=r,this.minFractionDigits=n,this.maxFractionDigits=i};pn.parse=function(t,e){if(3!==t.length)return e.error("Expected two arguments.");var r=e.parse(t[1],1,Ut);if(!r)return null;var n=t[2];if("object"!==typeof n||Array.isArray(n))return e.error("NumberFormat options argument must be an object.");var i=null;if(n["locale"]&&(i=e.parse(n["locale"],1,Vt),!i))return null;var o=null;if(n["currency"]&&(o=e.parse(n["currency"],1,Vt),!o))return null;var s=null;if(n["min-fraction-digits"]&&(s=e.parse(n["min-fraction-digits"],1,Ut),!s))return null;var a=null;return n["max-fraction-digits"]&&(a=e.parse(n["max-fraction-digits"],1,Ut),!a)?null:new pn(r,i,o,s,a)},pn.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},pn.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},pn.prototype.outputDefined=function(){return!1},pn.prototype.serialize=function(){var t={};return this.locale&&(t["locale"]=this.locale.serialize()),this.currency&&(t["currency"]=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var fn=function(t){this.type=Ut,this.input=t};fn.parse=function(t,e){if(2!==t.length)return e.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1);return r?"array"!==r.type.kind&&"string"!==r.type.kind&&"value"!==r.type.kind?e.error("Expected argument of type string or array, but found "+Kt(r.type)+" instead."):new fn(r):null},fn.prototype.evaluate=function(t){var e=this.input.evaluate(t);if("string"===typeof e)return e.length;if(Array.isArray(e))return e.length;throw new me("Expected value to be of type string or array, but found "+Kt(pe(e))+" instead.")},fn.prototype.eachChild=function(t){t(this.input)},fn.prototype.outputDefined=function(){return!1},fn.prototype.serialize=function(){var t=["length"];return this.eachChild(function(e){t.push(e.serialize())}),t};var dn={"==":sn,"!=":an,">":un,"<":ln,">=":hn,"<=":cn,array:ye,at:Br,boolean:ye,case:Gr,coalesce:Nr,collator:Te,format:_e,image:ve,in:jr,"index-of":Ur,interpolate:Rr,"interpolate-hcl":Rr,"interpolate-lab":Rr,length:fn,let:Fr,literal:de,match:Vr,number:ye,"number-format":pn,object:ye,slice:qr,step:or,string:ye,"to-boolean":be,"to-color":be,"to-number":be,"to-string":be,var:er,within:Je};function mn(t,e){var r=e[0],n=e[1],i=e[2],o=e[3];r=r.evaluate(t),n=n.evaluate(t),i=i.evaluate(t);var s=o?o.evaluate(t):1,a=ce(r,n,i,s);if(a)throw new me(a);return new oe(r/255*s,n/255*s,i/255*s,s)}function gn(t,e){return t in e}function yn(t,e){var r=e[t];return"undefined"===typeof r?null:r}function _n(t,e,r,n){while(r<=n){var i=r+n>>1;if(e[i]===t)return!0;e[i]>t?n=i-1:r=i+1}return!1}function vn(t){return{type:t}}function xn(t){return{result:"success",value:t}}function bn(t){return{result:"error",value:t}}function wn(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function En(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Sn(t){return!!t.expression&&t.expression.interpolated}function In(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function Tn(t){return"object"===typeof t&&null!==t&&!Array.isArray(t)}function Cn(t){return t}function Mn(t,e){var r,n,i,o="color"===e.type,s=t.stops&&"object"===typeof t.stops[0][0],a=s||void 0!==t.property,l=s||!a,u=t.type||(Sn(e)?"exponential":"interval");if(o&&(t=Nt({},t),t.stops&&(t.stops=t.stops.map(function(t){return[t[0],oe.parse(t[1])]})),t.default?t.default=oe.parse(t.default):t.default=oe.parse(e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!Dr[t.colorSpace])throw new Error("Unknown color space: "+t.colorSpace);if("exponential"===u)r=Ln;else if("interval"===u)r=kn;else if("categorical"===u){r=Pn,n=Object.create(null);for(var c=0,h=t.stops;c<h.length;c+=1){var p=h[c];n[p[0]]=p[1]}i=typeof t.stops[0][0]}else{if("identity"!==u)throw new Error('Unknown function type "'+u+'"');r=zn}if(s){for(var f={},d=[],m=0;m<t.stops.length;m++){var g=t.stops[m],y=g[0].zoom;void 0===f[y]&&(f[y]={zoom:y,type:t.type,property:t.property,default:t.default,stops:[]},d.push(y)),f[y].stops.push([g[0].value,g[1]])}for(var _=[],v=0,x=d;v<x.length;v+=1){var b=x[v];_.push([f[b].zoom,Mn(f[b],e)])}var w={name:"linear"};return{kind:"composite",interpolationType:w,interpolationFactor:Rr.interpolationFactor.bind(void 0,w),zoomStops:_.map(function(t){return t[0]}),evaluate:function(r,n){var i=r.zoom;return Ln({stops:_,base:t.base},e,i).evaluate(i,n)}}}if(l){var E="exponential"===u?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:Rr.interpolationFactor.bind(void 0,E),zoomStops:t.stops.map(function(t){return t[0]}),evaluate:function(o){var s=o.zoom;return r(t,e,s,n,i)}}}return{kind:"source",evaluate:function(o,s){var a=s&&s.properties?s.properties[t.property]:void 0;return void 0===a?An(t.default,e.default):r(t,e,a,n,i)}}}function An(t,e,r){return void 0!==t?t:void 0!==e?e:void 0!==r?r:void 0}function Pn(t,e,r,n,i){var o=typeof r===i?n[r]:void 0;return An(o,t.default,e.default)}function kn(t,e,r){if("number"!==In(r))return An(t.default,e.default);var n=t.stops.length;if(1===n)return t.stops[0][1];if(r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[n-1][0])return t.stops[n-1][1];var i=ir(t.stops.map(function(t){return t[0]}),r);return t.stops[i][1]}function Ln(t,e,r){var n=void 0!==t.base?t.base:1;if("number"!==In(r))return An(t.default,e.default);var i=t.stops.length;if(1===i)return t.stops[0][1];if(r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[i-1][0])return t.stops[i-1][1];var o=ir(t.stops.map(function(t){return t[0]}),r),s=Dn(r,n,t.stops[o][0],t.stops[o+1][0]),a=t.stops[o][1],l=t.stops[o+1][1],u=hr[e.type]||Cn;if(t.colorSpace&&"rgb"!==t.colorSpace){var c=Dr[t.colorSpace];u=function(t,e){return c.reverse(c.interpolate(c.forward(t),c.forward(e),s))}}return"function"===typeof a.evaluate?{evaluate:function(){var t=[],e=arguments.length;while(e--)t[e]=arguments[e];var r=a.evaluate.apply(void 0,t),n=l.evaluate.apply(void 0,t);if(void 0!==r&&void 0!==n)return u(r,n,s)}}:u(a,l,s)}function zn(t,e,r){return"color"===e.type?r=oe.parse(r):"formatted"===e.type?r=le.fromString(r.toString()):"resolvedImage"===e.type?r=ue.fromString(r.toString()):In(r)===e.type||"enum"===e.type&&e.values[r]||(r=void 0),An(r,t.default,e.default)}function Dn(t,e,r,n){var i=n-r,o=t-r;return 0===i?0:1===e?o/i:(Math.pow(e,o)-1)/(Math.pow(e,i)-1)}Se.register(dn,{error:[Xt,[Vt],function(t,e){var r=e[0];throw new me(r.evaluate(t))}],typeof:[Vt,[Zt],function(t,e){var r=e[0];return Kt(pe(r.evaluate(t)))}],"to-rgba":[Jt(Ut,4),[qt],function(t,e){var r=e[0];return r.evaluate(t).toArray()}],rgb:[qt,[Ut,Ut,Ut],mn],rgba:[qt,[Ut,Ut,Ut,Ut],mn],has:{type:Gt,overloads:[[[Vt],function(t,e){var r=e[0];return gn(r.evaluate(t),t.properties())}],[[Vt,$t],function(t,e){var r=e[0],n=e[1];return gn(r.evaluate(t),n.evaluate(t))}]]},get:{type:Zt,overloads:[[[Vt],function(t,e){var r=e[0];return yn(r.evaluate(t),t.properties())}],[[Vt,$t],function(t,e){var r=e[0],n=e[1];return yn(r.evaluate(t),n.evaluate(t))}]]},"feature-state":[Zt,[Vt],function(t,e){var r=e[0];return yn(r.evaluate(t),t.featureState||{})}],properties:[$t,[],function(t){return t.properties()}],"geometry-type":[Vt,[],function(t){return t.geometryType()}],id:[Zt,[],function(t){return t.id()}],zoom:[Ut,[],function(t){return t.globals.zoom}],"heatmap-density":[Ut,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Ut,[],function(t){return t.globals.lineProgress||0}],accumulated:[Zt,[],function(t){return void 0===t.globals.accumulated?null:t.globals.accumulated}],"+":[Ut,vn(Ut),function(t,e){for(var r=0,n=0,i=e;n<i.length;n+=1){var o=i[n];r+=o.evaluate(t)}return r}],"*":[Ut,vn(Ut),function(t,e){for(var r=1,n=0,i=e;n<i.length;n+=1){var o=i[n];r*=o.evaluate(t)}return r}],"-":{type:Ut,overloads:[[[Ut,Ut],function(t,e){var r=e[0],n=e[1];return r.evaluate(t)-n.evaluate(t)}],[[Ut],function(t,e){var r=e[0];return-r.evaluate(t)}]]},"/":[Ut,[Ut,Ut],function(t,e){var r=e[0],n=e[1];return r.evaluate(t)/n.evaluate(t)}],"%":[Ut,[Ut,Ut],function(t,e){var r=e[0],n=e[1];return r.evaluate(t)%n.evaluate(t)}],ln2:[Ut,[],function(){return Math.LN2}],pi:[Ut,[],function(){return Math.PI}],e:[Ut,[],function(){return Math.E}],"^":[Ut,[Ut,Ut],function(t,e){var r=e[0],n=e[1];return Math.pow(r.evaluate(t),n.evaluate(t))}],sqrt:[Ut,[Ut],function(t,e){var r=e[0];return Math.sqrt(r.evaluate(t))}],log10:[Ut,[Ut],function(t,e){var r=e[0];return Math.log(r.evaluate(t))/Math.LN10}],ln:[Ut,[Ut],function(t,e){var r=e[0];return Math.log(r.evaluate(t))}],log2:[Ut,[Ut],function(t,e){var r=e[0];return Math.log(r.evaluate(t))/Math.LN2}],sin:[Ut,[Ut],function(t,e){var r=e[0];return Math.sin(r.evaluate(t))}],cos:[Ut,[Ut],function(t,e){var r=e[0];return Math.cos(r.evaluate(t))}],tan:[Ut,[Ut],function(t,e){var r=e[0];return Math.tan(r.evaluate(t))}],asin:[Ut,[Ut],function(t,e){var r=e[0];return Math.asin(r.evaluate(t))}],acos:[Ut,[Ut],function(t,e){var r=e[0];return Math.acos(r.evaluate(t))}],atan:[Ut,[Ut],function(t,e){var r=e[0];return Math.atan(r.evaluate(t))}],min:[Ut,vn(Ut),function(t,e){return Math.min.apply(Math,e.map(function(e){return e.evaluate(t)}))}],max:[Ut,vn(Ut),function(t,e){return Math.max.apply(Math,e.map(function(e){return e.evaluate(t)}))}],abs:[Ut,[Ut],function(t,e){var r=e[0];return Math.abs(r.evaluate(t))}],round:[Ut,[Ut],function(t,e){var r=e[0],n=r.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[Ut,[Ut],function(t,e){var r=e[0];return Math.floor(r.evaluate(t))}],ceil:[Ut,[Ut],function(t,e){var r=e[0];return Math.ceil(r.evaluate(t))}],"filter-==":[Gt,[Vt,Zt],function(t,e){var r=e[0],n=e[1];return t.properties()[r.value]===n.value}],"filter-id-==":[Gt,[Zt],function(t,e){var r=e[0];return t.id()===r.value}],"filter-type-==":[Gt,[Vt],function(t,e){var r=e[0];return t.geometryType()===r.value}],"filter-<":[Gt,[Vt,Zt],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],o=n.value;return typeof i===typeof o&&i<o}],"filter-id-<":[Gt,[Zt],function(t,e){var r=e[0],n=t.id(),i=r.value;return typeof n===typeof i&&n<i}],"filter->":[Gt,[Vt,Zt],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],o=n.value;return typeof i===typeof o&&i>o}],"filter-id->":[Gt,[Zt],function(t,e){var r=e[0],n=t.id(),i=r.value;return typeof n===typeof i&&n>i}],"filter-<=":[Gt,[Vt,Zt],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],o=n.value;return typeof i===typeof o&&i<=o}],"filter-id-<=":[Gt,[Zt],function(t,e){var r=e[0],n=t.id(),i=r.value;return typeof n===typeof i&&n<=i}],"filter->=":[Gt,[Vt,Zt],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],o=n.value;return typeof i===typeof o&&i>=o}],"filter-id->=":[Gt,[Zt],function(t,e){var r=e[0],n=t.id(),i=r.value;return typeof n===typeof i&&n>=i}],"filter-has":[Gt,[Zt],function(t,e){var r=e[0];return r.value in t.properties()}],"filter-has-id":[Gt,[],function(t){return null!==t.id()&&void 0!==t.id()}],"filter-type-in":[Gt,[Jt(Vt)],function(t,e){var r=e[0];return r.value.indexOf(t.geometryType())>=0}],"filter-id-in":[Gt,[Jt(Zt)],function(t,e){var r=e[0];return r.value.indexOf(t.id())>=0}],"filter-in-small":[Gt,[Vt,Jt(Zt)],function(t,e){var r=e[0],n=e[1];return n.value.indexOf(t.properties()[r.value])>=0}],"filter-in-large":[Gt,[Vt,Jt(Zt)],function(t,e){var r=e[0],n=e[1];return _n(t.properties()[r.value],n.value,0,n.value.length-1)}],all:{type:Gt,overloads:[[[Gt,Gt],function(t,e){var r=e[0],n=e[1];return r.evaluate(t)&&n.evaluate(t)}],[vn(Gt),function(t,e){for(var r=0,n=e;r<n.length;r+=1){var i=n[r];if(!i.evaluate(t))return!1}return!0}]]},any:{type:Gt,overloads:[[[Gt,Gt],function(t,e){var r=e[0],n=e[1];return r.evaluate(t)||n.evaluate(t)}],[vn(Gt),function(t,e){for(var r=0,n=e;r<n.length;r+=1){var i=n[r];if(i.evaluate(t))return!0}return!1}]]},"!":[Gt,[Gt],function(t,e){var r=e[0];return!r.evaluate(t)}],"is-supported-script":[Gt,[Vt],function(t,e){var r=e[0],n=t.globals&&t.globals.isSupportedScript;return!n||n(r.evaluate(t))}],upcase:[Vt,[Vt],function(t,e){var r=e[0];return r.evaluate(t).toUpperCase()}],downcase:[Vt,[Vt],function(t,e){var r=e[0];return r.evaluate(t).toLowerCase()}],concat:[Vt,vn(Zt),function(t,e){return e.map(function(e){return fe(e.evaluate(t))}).join("")}],"resolved-locale":[Vt,[Wt],function(t,e){var r=e[0];return r.evaluate(t).resolvedLocale()}]});var Rn=function(t,e){this.expression=t,this._warningHistory={},this._evaluator=new Ee,this._defaultValue=e?$n(e):null,this._enumValues=e&&"enum"===e.type?e.values:null};function On(t){return Array.isArray(t)&&t.length>0&&"string"===typeof t[0]&&t[0]in dn}function Nn(t,e){var r=new rr(dn,[],e?qn(e):void 0),n=r.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return n?xn(new Rn(n,e)):bn(r.errors)}Rn.prototype.evaluateWithoutErrorHandling=function(t,e,r,n,i,o){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=r,this._evaluator.canonical=n,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o,this.expression.evaluate(this._evaluator)},Rn.prototype.evaluate=function(t,e,r,n,i,o){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=r||null,this._evaluator.canonical=n,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o||null;try{var s=this.expression.evaluate(this._evaluator);if(null===s||void 0===s||"number"===typeof s&&s!==s)return this._defaultValue;if(this._enumValues&&!(s in this._enumValues))throw new me("Expected value to be one of "+Object.keys(this._enumValues).map(function(t){return JSON.stringify(t)}).join(", ")+", but found "+JSON.stringify(s)+" instead.");return s}catch(a){return this._warningHistory[a.message]||(this._warningHistory[a.message]=!0,"undefined"!==typeof console&&console.warn(a.message)),this._defaultValue}};var Fn=function(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!Qe(e.expression)};Fn.prototype.evaluateWithoutErrorHandling=function(t,e,r,n,i,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r,n,i,o)},Fn.prototype.evaluate=function(t,e,r,n,i,o){return this._styleExpression.evaluate(t,e,r,n,i,o)};var Bn=function(t,e,r,n){this.kind=t,this.zoomStops=r,this._styleExpression=e,this.isStateDependent="camera"!==t&&!Qe(e.expression),this.interpolationType=n};function jn(t,e){if(t=Nn(t,e),"error"===t.result)return t;var r=t.value.expression,n=Ke(r);if(!n&&!wn(e))return bn([new Ft("","data expressions not supported")]);var i=tr(r,["zoom"]);if(!i&&!En(e))return bn([new Ft("","zoom expressions not supported")]);var o=Gn(r);if(!o&&!i)return bn([new Ft("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(o instanceof Ft)return bn([o]);if(o instanceof Rr&&!Sn(e))return bn([new Ft("",'"interpolate" expressions cannot be used with this property')]);if(!o)return xn(new Fn(n?"constant":"source",t.value));var s=o instanceof Rr?o.interpolation:void 0;return xn(new Bn(n?"camera":"composite",t.value,o.labels,s))}Bn.prototype.evaluateWithoutErrorHandling=function(t,e,r,n,i,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r,n,i,o)},Bn.prototype.evaluate=function(t,e,r,n,i,o){return this._styleExpression.evaluate(t,e,r,n,i,o)},Bn.prototype.interpolationFactor=function(t,e,r){return this.interpolationType?Rr.interpolationFactor(this.interpolationType,t,e,r):0};var Un=function(t,e){this._parameters=t,this._specification=e,Nt(this,Mn(this._parameters,this._specification))};function Vn(t,e){if(Tn(t))return new Un(t,e);if(On(t)){var r=jn(t,e);if("error"===r.result)throw new Error(r.value.map(function(t){return t.key+": "+t.message}).join(", "));return r.value}var n=t;return"string"===typeof t&&"color"===e.type&&(n=oe.parse(t)),{kind:"constant",evaluate:function(){return n}}}function Gn(t){var e=null;if(t instanceof Fr)e=Gn(t.result);else if(t instanceof Nr)for(var r=0,n=t.args;r<n.length;r+=1){var i=n[r];if(e=Gn(i),e)break}else(t instanceof or||t instanceof Rr)&&t.input instanceof Se&&"zoom"===t.input.name&&(e=t);return e instanceof Ft?e:(t.eachChild(function(t){var r=Gn(t);r instanceof Ft?e=r:!e&&r?e=new Ft("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&r&&e!==r&&(e=new Ft("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e)}function qn(t){var e={color:qt,string:Vt,number:Ut,enum:Vt,boolean:Gt,formatted:Yt,resolvedImage:Ht};return"array"===t.type?Jt(e[t.value]||Zt,t.length):e[t.type]}function $n(t){return"color"===t.type&&Tn(t.default)?new oe(0,0,0,0):"color"===t.type?oe.parse(t.default)||null:void 0===t.default?null:t.default}function Zn(t){return"object"===typeof t?["literal",t]:t}function Xn(t,e){var r=t.stops;if(!r)return Wn(t,e);var n=r&&"object"===typeof r[0][0],i=n||void 0!==t.property,o=n||!i;return r=r.map(function(t){return!i&&e.tokens&&"string"===typeof t[1]?[t[0],ii(t[1])]:[t[0],Zn(t[1])]}),n?Hn(t,e,r):o?ti(t,e,r):Qn(t,e,r)}function Wn(t,e){var r=["get",t.property];if(void 0===t.default)return"string"===e.type?["string",r]:r;if("enum"===e.type)return["match",r,Object.keys(e.values),r,t.default];var n=["color"===e.type?"to-color":e.type,r,Zn(t.default)];return"array"===e.type&&n.splice(1,0,e.value,e.length||null),n}function Yn(t){switch(t.colorSpace){case"hcl":return"interpolate-hcl";case"lab":return"interpolate-lab";default:return"interpolate"}}function Hn(t,e,r){for(var n={},i={},o=[],s=0;s<r.length;s++){var a=r[s],l=a[0].zoom;void 0===n[l]&&(n[l]={zoom:l,type:t.type,property:t.property,default:t.default},i[l]=[],o.push(l)),i[l].push([a[0].value,a[1]])}var u=ni({},e);if("exponential"===u){for(var c=[Yn(t),["linear"],["zoom"]],h=0,p=o;h<p.length;h+=1){var f=p[h],d=Qn(n[f],e,i[f]);ri(c,f,d,!1)}return c}for(var m=["step",["zoom"]],g=0,y=o;g<y.length;g+=1){var _=y[g],v=Qn(n[_],e,i[_]);ri(m,_,v,!0)}return ei(m),m}function Jn(t,e){return void 0!==t?t:void 0!==e?e:void 0}function Kn(t,e){var r=Zn(Jn(t.default,e.default));return void 0===r&&"resolvedImage"===e.type?"":r}function Qn(t,e,r){var n=ni(t,e),i=["get",t.property];if("categorical"===n&&"boolean"===typeof r[0][0]){for(var o=["case"],s=0,a=r;s<a.length;s+=1){var l=a[s];o.push(["==",i,l[0]],l[1])}return o.push(Kn(t,e)),o}if("categorical"===n){for(var u=["match",i],c=0,h=r;c<h.length;c+=1){var p=h[c];ri(u,p[0],p[1],!1)}return u.push(Kn(t,e)),u}if("interval"===n){for(var f=["step",["number",i]],d=0,m=r;d<m.length;d+=1){var g=m[d];ri(f,g[0],g[1],!0)}return ei(f),void 0===t.default?f:["case",["==",["typeof",i],"number"],f,Zn(t.default)]}if("exponential"===n){for(var y=void 0!==t.base?t.base:1,_=[Yn(t),1===y?["linear"]:["exponential",y],["number",i]],v=0,x=r;v<x.length;v+=1){var b=x[v];ri(_,b[0],b[1],!1)}return void 0===t.default?_:["case",["==",["typeof",i],"number"],_,Zn(t.default)]}throw new Error("Unknown property function type "+n)}function ti(t,e,r,n){void 0===n&&(n=["zoom"]);var i,o=ni(t,e),s=!1;if("interval"===o)i=["step",n],s=!0;else{if("exponential"!==o)throw new Error('Unknown zoom function type "'+o+'"');var a=void 0!==t.base?t.base:1;i=[Yn(t),1===a?["linear"]:["exponential",a],n]}for(var l=0,u=r;l<u.length;l+=1){var c=u[l];ri(i,c[0],c[1],s)}return ei(i),i}function ei(t){"step"===t[0]&&3===t.length&&(t.push(0),t.push(t[3]))}function ri(t,e,r,n){t.length>3&&e===t[t.length-2]||(n&&2===t.length||t.push(e),t.push(r))}function ni(t,e){return t.type?t.type:e.expression.interpolated?"exponential":"interval"}function ii(t){for(var e=["concat"],r=/{([^{}]+)}/g,n=0,i=r.exec(t);null!==i;i=r.exec(t)){var o=t.slice(n,r.lastIndex-i[0].length);n=r.lastIndex,o.length>0&&e.push(o),e.push(["get",i[1]])}if(1===e.length)return t;if(n<t.length)e.push(t.slice(n));else if(2===e.length)return["to-string",e[1]];return e}function oi(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!==typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var e=0,r=t.slice(1);e<r.length;e+=1){var n=r[e];if(!oi(n)&&"boolean"!==typeof n)return!1}return!0;default:return!0}}Un.deserialize=function(t){return new Un(t._parameters,t._specification)},Un.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var si={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ai(t){if(null===t||void 0===t)return{filter:function(){return!0},needGeometry:!1};oi(t)||(t=ci(t));var e=Nn(t,si);if("error"===e.result)throw new Error(e.value.map(function(t){return t.key+": "+t.message}).join(", "));var r=ui(t);return{filter:function(t,r,n){return e.value.evaluate(t,r,{},n)},needGeometry:r}}function li(t,e){return t<e?-1:t>e?1:0}function ui(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(var e=1;e<t.length;e++)if(ui(t[e]))return!0;return!1}function ci(t){if(!t)return!0;var e=t[0];if(t.length<=1)return"any"!==e;var r="=="===e?hi(t[1],t[2],"=="):"!="===e?mi(hi(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?hi(t[1],t[2],e):"any"===e?pi(t.slice(1)):"all"===e?["all"].concat(t.slice(1).map(ci)):"none"===e?["all"].concat(t.slice(1).map(ci).map(mi)):"in"===e?fi(t[1],t.slice(2)):"!in"===e?mi(fi(t[1],t.slice(2))):"has"===e?di(t[1]):"!has"===e?mi(di(t[1])):"within"!==e||t;return r}function hi(t,e,r){switch(t){case"$type":return["filter-type-"+r,e];case"$id":return["filter-id-"+r,e];default:return["filter-"+r,t,e]}}function pi(t){return["any"].concat(t.map(ci))}function fi(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(function(t){return typeof t!==typeof e[0]})?["filter-in-large",t,["literal",e.sort(li)]]:["filter-in-small",t,["literal",e]]}}function di(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function mi(t){return["!",t]}function gi(t){return yi(t,{})}function yi(t,e){var r;if(oi(t))return t;if(!t)return!0;var n,i=t[0];if(t.length<=1)return"any"!==i;if("=="===i||"!="===i||"<"===i||">"===i||"<="===i||">="===i){var o=t,s=o[1],a=o[2];n=vi(s,a,i,e)}else{if("any"===i){var l=t.slice(1).map(function(t){var e={},r=yi(t,e),n=_i(e);return!0===n?r:["case",n,r,!1]});return["any"].concat(l)}if("all"===i){var u=t.slice(1).map(function(t){return yi(t,e)});return u.length>1?["all"].concat(u):(r=[]).concat.apply(r,u)}if("none"===i)return["!",yi(["any"].concat(t.slice(1)),{})];n="in"===i?xi(t[1],t.slice(2)):"!in"===i?xi(t[1],t.slice(2),!0):"has"===i?bi(t[1]):"!has"!==i||["!",bi(t[1])]}return n}function _i(t){var e=[];for(var r in t){var n="$id"===r?["id"]:["get",r];e.push(["==",["typeof",n],t[r]])}return 0===e.length||(1===e.length?e[0]:["all"].concat(e))}function vi(t,e,r,n){var i;if("$type"===t)return[r,["geometry-type"],e];if(i="$id"===t?["id"]:["get",t],n&&null!==e){var o=typeof e;n[t]=o}return"=="===r&&"$id"!==t&&null===e?["all",["has",t],["==",i,null]]:"!="===r&&"$id"!==t&&null===e?["any",["!",["has",t]],["!=",i,null]]:[r,i,e]}function xi(t,e,r){if(void 0===r&&(r=!1),0===e.length)return r;var n;n="$type"===t?["geometry-type"]:"$id"===t?["id"]:["get",t];for(var i=!0,o=typeof e[0],s=0,a=e;s<a.length;s+=1){var l=a[s];if(typeof l!==o){i=!1;break}}if(i&&("string"===o||"number"===o)){var u=e.sort().filter(function(t,r){return 0===r||e[r-1]!==t});return["match",n,u,!r,r]}return[r?"all":"any"].concat(e.map(function(t){return[r?"!=":"==",n,t]}))}function bi(t){return"$type"===t||("$id"===t?["!=",["id"],null]:["has",t])}function wi(t){var e=[];return At(t,function(t){t.filter&&(t.filter=gi(t.filter))}),Pt(t,{paint:!0,layout:!0},function(t){var r=t.path,n=t.value,i=t.reference,o=t.set;On(n)||("object"!==typeof n||Array.isArray(n)?i.tokens&&"string"===typeof n&&o(ii(n)):(o(Xn(n,i)),e.push(r.join("."))))}),t}function Ei(t){var e=!1;if(7===t.version&&(t=Ot(t),e=!0),8===t.version&&(e=wi(t),e=!0),!e)throw new Error("cannot migrate from",t.version);return t}function Si(t){var e=[],r=[],n=[];for(var i in t.sources){var o=t.sources[i];if("vector"===o.type){var s=/^mapbox:\/\/(.*)/.exec(o.url);s&&(e.push(i),r.push(s[1]))}}if(e.length<2)return t;e.forEach(function(e){delete t.sources[e]});var a=r.join(",");return t.sources[a]={type:"vector",url:"mapbox://"+a},t.layers.forEach(function(t){if(e.indexOf(t.source)>=0&&(t.source=a,"source-layer"in t)){if(n.indexOf(t["source-layer"])>=0)throw new Error("Conflicting source layer names");n.push(t["source-layer"])}}),t}var Ii=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ti(t,e){var r={};for(var n in t)"ref"!==n&&(r[n]=t[n]);return Ii.forEach(function(t){t in e&&(r[t]=e[t])}),r}function Ci(t){t=t.slice();for(var e=Object.create(null),r=0;r<t.length;r++)e[t[r].id]=t[r];for(var n=0;n<t.length;n++)"ref"in t[n]&&(t[n]=Ti(t[n],e[t[n].ref]));return t}function Mi(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(var r=0;r<t.length;r++)if(!Mi(t[r],e[r]))return!1;return!0}if("object"===typeof t&&null!==t&&null!==e){if("object"!==typeof e)return!1;var n=Object.keys(t);if(n.length!==Object.keys(e).length)return!1;for(var i in t)if(!Mi(t[i],e[i]))return!1;return!0}return t===e}var Ai={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Pi(t,e,r){r.push({command:Ai.addSource,args:[t,e[t]]})}function ki(t,e,r){e.push({command:Ai.removeSource,args:[t]}),r[t]=!0}function Li(t,e,r,n){ki(t,r,n),Pi(t,e,r)}function zi(t,e,r){var n;for(n in t[r])if(t[r].hasOwnProperty(n)&&"data"!==n&&!Mi(t[r][n],e[r][n]))return!1;for(n in e[r])if(e[r].hasOwnProperty(n)&&"data"!==n&&!Mi(t[r][n],e[r][n]))return!1;return!0}function Di(t,e,r,n){var i;for(i in t=t||{},e=e||{},t)t.hasOwnProperty(i)&&(e.hasOwnProperty(i)||ki(i,r,n));for(i in e)e.hasOwnProperty(i)&&(t.hasOwnProperty(i)?Mi(t[i],e[i])||("geojson"===t[i].type&&"geojson"===e[i].type&&zi(t,e,i)?r.push({command:Ai.setGeoJSONSourceData,args:[i,e[i].data]}):Li(i,e,r,n)):Pi(i,e,r))}function Ri(t,e,r,n,i,o){var s;for(s in t=t||{},e=e||{},t)t.hasOwnProperty(s)&&(Mi(t[s],e[s])||r.push({command:o,args:[n,s,e[s],i]}));for(s in e)e.hasOwnProperty(s)&&!t.hasOwnProperty(s)&&(Mi(t[s],e[s])||r.push({command:o,args:[n,s,e[s],i]}))}function Oi(t){return t.id}function Ni(t,e){return t[e.id]=e,t}function Fi(t,e,r){t=t||[],e=e||[];var n,i,o,s,a,l,u,c=t.map(Oi),h=e.map(Oi),p=t.reduce(Ni,{}),f=e.reduce(Ni,{}),d=c.slice(),m=Object.create(null);for(n=0,i=0;n<c.length;n++)o=c[n],f.hasOwnProperty(o)?i++:(r.push({command:Ai.removeLayer,args:[o]}),d.splice(d.indexOf(o,i),1));for(n=0,i=0;n<h.length;n++)o=h[h.length-1-n],d[d.length-1-n]!==o&&(p.hasOwnProperty(o)?(r.push({command:Ai.removeLayer,args:[o]}),d.splice(d.lastIndexOf(o,d.length-i),1)):i++,l=d[d.length-n],r.push({command:Ai.addLayer,args:[f[o],l]}),d.splice(d.length-n,0,o),m[o]=!0);for(n=0;n<h.length;n++)if(o=h[n],s=p[o],a=f[o],!m[o]&&!Mi(s,a))if(Mi(s.source,a.source)&&Mi(s["source-layer"],a["source-layer"])&&Mi(s.type,a.type)){for(u in Ri(s.layout,a.layout,r,o,null,Ai.setLayoutProperty),Ri(s.paint,a.paint,r,o,null,Ai.setPaintProperty),Mi(s.filter,a.filter)||r.push({command:Ai.setFilter,args:[o,a.filter]}),Mi(s.minzoom,a.minzoom)&&Mi(s.maxzoom,a.maxzoom)||r.push({command:Ai.setLayerZoomRange,args:[o,a.minzoom,a.maxzoom]}),s)s.hasOwnProperty(u)&&"layout"!==u&&"paint"!==u&&"filter"!==u&&"metadata"!==u&&"minzoom"!==u&&"maxzoom"!==u&&(0===u.indexOf("paint.")?Ri(s[u],a[u],r,o,u.slice(6),Ai.setPaintProperty):Mi(s[u],a[u])||r.push({command:Ai.setLayerProperty,args:[o,u,a[u]]}));for(u in a)a.hasOwnProperty(u)&&!s.hasOwnProperty(u)&&"layout"!==u&&"paint"!==u&&"filter"!==u&&"metadata"!==u&&"minzoom"!==u&&"maxzoom"!==u&&(0===u.indexOf("paint.")?Ri(s[u],a[u],r,o,u.slice(6),Ai.setPaintProperty):Mi(s[u],a[u])||r.push({command:Ai.setLayerProperty,args:[o,u,a[u]]}))}else r.push({command:Ai.removeLayer,args:[o]}),l=d[d.lastIndexOf(o)+1],r.push({command:Ai.addLayer,args:[a,l]})}function Bi(t,e){if(!t)return[{command:Ai.setStyle,args:[e]}];var r=[];try{if(!Mi(t.version,e.version))return[{command:Ai.setStyle,args:[e]}];Mi(t.center,e.center)||r.push({command:Ai.setCenter,args:[e.center]}),Mi(t.zoom,e.zoom)||r.push({command:Ai.setZoom,args:[e.zoom]}),Mi(t.bearing,e.bearing)||r.push({command:Ai.setBearing,args:[e.bearing]}),Mi(t.pitch,e.pitch)||r.push({command:Ai.setPitch,args:[e.pitch]}),Mi(t.sprite,e.sprite)||r.push({command:Ai.setSprite,args:[e.sprite]}),Mi(t.glyphs,e.glyphs)||r.push({command:Ai.setGlyphs,args:[e.glyphs]}),Mi(t.transition,e.transition)||r.push({command:Ai.setTransition,args:[e.transition]}),Mi(t.light,e.light)||r.push({command:Ai.setLight,args:[e.light]});var n={},i=[];Di(t.sources,e.sources,i,n);var o=[];t.layers&&t.layers.forEach(function(t){n[t.source]?r.push({command:Ai.removeLayer,args:[t.id]}):o.push(t)}),r=r.concat(i),Fi(o,e.layers,r)}catch(s){console.warn("Unable to compute style diff:",s),r=[{command:Ai.setStyle,args:[e]}]}return r}var ji=function(t,e,r,n){this.message=(t?t+": ":"")+r,n&&(this.identifier=n),null!==e&&void 0!==e&&e.__line__&&(this.line=e.__line__)},Ui=function(t){this.error=t,this.message=t.message;var e=t.message.match(/line (\d+)/);this.line=e?parseInt(e[1],10):0};function Vi(t){var e=t.key,r=t.value;return r?[new ji(e,r,"constants have been deprecated as of v8")]:[]}function Gi(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function qi(t){if(Array.isArray(t))return t.map(qi);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var e={};for(var r in t)e[r]=qi(t[r]);return e}return Gi(t)}function $i(t){var e=t.key,r=t.value,n=t.valueSpec||{},i=t.objectElementValidators||{},o=t.style,s=t.styleSpec,a=[],l=In(r);if("object"!==l)return[new ji(e,r,"object expected, "+l+" found")];for(var u in r){var c=u.split(".")[0],h=n[c]||n["*"],p=void 0;if(i[c])p=i[c];else if(n[c])p=fo;else if(i["*"])p=i["*"];else{if(!n["*"]){a.push(new ji(e,r[u],'unknown property "'+u+'"'));continue}p=fo}a=a.concat(p({key:(e?e+".":e)+u,value:r[u],valueSpec:h,style:o,styleSpec:s,object:r,objectKey:u},r))}for(var f in n)i[f]||n[f].required&&void 0===n[f]["default"]&&void 0===r[f]&&a.push(new ji(e,r,'missing required property "'+f+'"'));return a}function Zi(t){var e=t.value,r=t.valueSpec,n=t.style,i=t.styleSpec,o=t.key,s=t.arrayElementValidator||fo;if("array"!==In(e))return[new ji(o,e,"array expected, "+In(e)+" found")];if(r.length&&e.length!==r.length)return[new ji(o,e,"array length "+r.length+" expected, length "+e.length+" found")];if(r["min-length"]&&e.length<r["min-length"])return[new ji(o,e,"array length at least "+r["min-length"]+" expected, length "+e.length+" found")];var a={type:r.value,values:r.values};i.$version<7&&(a.function=r.function),"object"===In(r.value)&&(a=r.value);for(var l=[],u=0;u<e.length;u++)l=l.concat(s({array:e,arrayIndex:u,value:e[u],valueSpec:a,style:n,styleSpec:i,key:o+"["+u+"]"}));return l}function Xi(t){var e=t.key,r=t.value,n=t.valueSpec,i=In(r);return"number"===i&&r!==r&&(i="NaN"),"number"!==i?[new ji(e,r,"number expected, "+i+" found")]:"minimum"in n&&r<n.minimum?[new ji(e,r,r+" is less than the minimum value "+n.minimum)]:"maximum"in n&&r>n.maximum?[new ji(e,r,r+" is greater than the maximum value "+n.maximum)]:[]}function Wi(t){var e,r,n,i=t.valueSpec,o=Gi(t.value.type),s={},a="categorical"!==o&&void 0===t.value.property,l=!a,u="array"===In(t.value.stops)&&"array"===In(t.value.stops[0])&&"object"===In(t.value.stops[0][0]),c=$i({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:h,default:d}});return"identity"===o&&a&&c.push(new ji(t.key,t.value,'missing required property "property"')),"identity"===o||t.value.stops||c.push(new ji(t.key,t.value,'missing required property "stops"')),"exponential"===o&&t.valueSpec.expression&&!Sn(t.valueSpec)&&c.push(new ji(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(l&&!wn(t.valueSpec)?c.push(new ji(t.key,t.value,"property functions not supported")):a&&!En(t.valueSpec)&&c.push(new ji(t.key,t.value,"zoom functions not supported"))),"categorical"!==o&&!u||void 0!==t.value.property||c.push(new ji(t.key,t.value,'"property" property is required')),c;function h(t){if("identity"===o)return[new ji(t.key,t.value,'identity function may not have a "stops" property')];var e=[],r=t.value;return e=e.concat(Zi({key:t.key,value:r,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:p})),"array"===In(r)&&0===r.length&&e.push(new ji(t.key,r,"array must have at least one stop")),e}function p(t){var e=[],o=t.value,a=t.key;if("array"!==In(o))return[new ji(a,o,"array expected, "+In(o)+" found")];if(2!==o.length)return[new ji(a,o,"array length 2 expected, length "+o.length+" found")];if(u){if("object"!==In(o[0]))return[new ji(a,o,"object expected, "+In(o[0])+" found")];if(void 0===o[0].zoom)return[new ji(a,o,"object stop key must have zoom")];if(void 0===o[0].value)return[new ji(a,o,"object stop key must have value")];if(n&&n>Gi(o[0].zoom))return[new ji(a,o[0].zoom,"stop zoom values must appear in ascending order")];Gi(o[0].zoom)!==n&&(n=Gi(o[0].zoom),r=void 0,s={}),e=e.concat($i({key:a+"[0]",value:o[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:Xi,value:f}}))}else e=e.concat(f({key:a+"[0]",value:o[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},o));return On(qi(o[1]))?e.concat([new ji(a+"[1]",o[1],"expressions are not allowed in function stops.")]):e.concat(fo({key:a+"[1]",value:o[1],valueSpec:i,style:t.style,styleSpec:t.styleSpec}))}function f(t,n){var a=In(t.value),l=Gi(t.value),u=null!==t.value?t.value:n;if(e){if(a!==e)return[new ji(t.key,u,a+" stop domain type must match previous stop domain type "+e)]}else e=a;if("number"!==a&&"string"!==a&&"boolean"!==a)return[new ji(t.key,u,"stop domain value must be a number, string, or boolean")];if("number"!==a&&"categorical"!==o){var c="number expected, "+a+" found";return wn(i)&&void 0===o&&(c+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ji(t.key,u,c)]}return"categorical"!==o||"number"!==a||isFinite(l)&&Math.floor(l)===l?"categorical"!==o&&"number"===a&&void 0!==r&&l<r?[new ji(t.key,u,"stop domain values must appear in ascending order")]:(r=l,"categorical"===o&&l in s?[new ji(t.key,u,"stop domain values must be unique")]:(s[l]=!0,[])):[new ji(t.key,u,"integer expected, found "+l)]}function d(t){return fo({key:t.key,value:t.value,valueSpec:i,style:t.style,styleSpec:t.styleSpec})}}function Yi(t){var e=("property"===t.expressionContext?jn:Nn)(qi(t.value),t.valueSpec);if("error"===e.result)return e.value.map(function(e){return new ji(""+t.key+e.key,t.value,e.message)});var r=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!r.outputDefined())return[new ji(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if("property"===t.expressionContext&&"layout"===t.propertyType&&!Qe(r))return[new ji(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext&&!Qe(r))return[new ji(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!tr(r,["zoom","feature-state"]))return[new ji(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!Ke(r))return[new ji(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Hi(t){var e=t.value,r=t.key,n=In(e);return"boolean"!==n?[new ji(r,e,"boolean expected, "+n+" found")]:[]}function Ji(t){var e=t.key,r=t.value,n=In(r);return"string"!==n?[new ji(e,r,"color expected, "+n+" found")]:null===ie(r)?[new ji(e,r,'color expected, "'+r+'" found')]:[]}function Ki(t){var e=t.key,r=t.value,n=t.valueSpec,i=[];return Array.isArray(n.values)?-1===n.values.indexOf(Gi(r))&&i.push(new ji(e,r,"expected one of ["+n.values.join(", ")+"], "+JSON.stringify(r)+" found")):-1===Object.keys(n.values).indexOf(Gi(r))&&i.push(new ji(e,r,"expected one of ["+Object.keys(n.values).join(", ")+"], "+JSON.stringify(r)+" found")),i}function Qi(t){return oi(qi(t.value))?Yi(Nt({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):to(t)}function to(t){var e=t.value,r=t.key;if("array"!==In(e))return[new ji(r,e,"array expected, "+In(e)+" found")];var n,i=t.styleSpec,o=[];if(e.length<1)return[new ji(r,e,"filter array must have at least 1 element")];switch(o=o.concat(Ki({key:r+"[0]",value:e[0],valueSpec:i.filter_operator,style:t.style,styleSpec:t.styleSpec})),Gi(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===Gi(e[1])&&o.push(new ji(r,e,'"$type" cannot be use with operator "'+e[0]+'"'));case"==":case"!=":3!==e.length&&o.push(new ji(r,e,'filter array for operator "'+e[0]+'" must have 3 elements'));case"in":case"!in":e.length>=2&&(n=In(e[1]),"string"!==n&&o.push(new ji(r+"[1]",e[1],"string expected, "+n+" found")));for(var s=2;s<e.length;s++)n=In(e[s]),"$type"===Gi(e[1])?o=o.concat(Ki({key:r+"["+s+"]",value:e[s],valueSpec:i.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==n&&"number"!==n&&"boolean"!==n&&o.push(new ji(r+"["+s+"]",e[s],"string, number, or boolean expected, "+n+" found"));break;case"any":case"all":case"none":for(var a=1;a<e.length;a++)o=o.concat(to({key:r+"["+a+"]",value:e[a],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":n=In(e[1]),2!==e.length?o.push(new ji(r,e,'filter array for "'+e[0]+'" operator must have 2 elements')):"string"!==n&&o.push(new ji(r+"[1]",e[1],"string expected, "+n+" found"));break;case"within":n=In(e[1]),2!==e.length?o.push(new ji(r,e,'filter array for "'+e[0]+'" operator must have 2 elements')):"object"!==n&&o.push(new ji(r+"[1]",e[1],"object expected, "+n+" found"));break}return o}function eo(t,e){var r=t.key,n=t.style,i=t.styleSpec,o=t.value,s=t.objectKey,a=i[e+"_"+t.layerType];if(!a)return[];var l=s.match(/^(.*)-transition$/);if("paint"===e&&l&&a[l[1]]&&a[l[1]].transition)return fo({key:r,value:o,valueSpec:i.transition,style:n,styleSpec:i});var u,c=t.valueSpec||a[s];if(!c)return[new ji(r,o,'unknown property "'+s+'"')];if("string"===In(o)&&wn(c)&&!c.tokens&&(u=/^{([^}]+)}$/.exec(o)))return[new ji(r,o,'"'+s+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(u[1])+" }`.")];var h=[];return"symbol"===t.layerType&&("text-field"===s&&n&&!n.glyphs&&h.push(new ji(r,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===s&&Tn(qi(o))&&"identity"===Gi(o.type)&&h.push(new ji(r,o,'"text-font" does not support identity functions'))),h.concat(fo({key:t.key,value:o,valueSpec:c,style:n,styleSpec:i,expressionContext:"property",propertyType:e,propertyKey:s}))}function ro(t){return eo(t,"paint")}function no(t){return eo(t,"layout")}function io(t){var e=[],r=t.value,n=t.key,i=t.style,o=t.styleSpec;r.type||r.ref||e.push(new ji(n,r,'either "type" or "ref" is required'));var s,a=Gi(r.type),l=Gi(r.ref);if(r.id)for(var u=Gi(r.id),c=0;c<t.arrayIndex;c++){var h=i.layers[c];Gi(h.id)===u&&e.push(new ji(n,r.id,'duplicate layer id "'+r.id+'", previously used at line '+h.id.__line__))}if("ref"in r)["type","source","source-layer","filter","layout"].forEach(function(t){t in r&&e.push(new ji(n,r[t],'"'+t+'" is prohibited for ref layers'))}),i.layers.forEach(function(t){Gi(t.id)===l&&(s=t)}),s?s.ref?e.push(new ji(n,r.ref,"ref cannot reference another ref layer")):a=Gi(s.type):e.push(new ji(n,r.ref,'ref layer "'+l+'" not found'));else if("background"!==a)if(r.source){var p=i.sources&&i.sources[r.source],f=p&&Gi(p.type);p?"vector"===f&&"raster"===a?e.push(new ji(n,r.source,'layer "'+r.id+'" requires a raster source')):"raster"===f&&"raster"!==a?e.push(new ji(n,r.source,'layer "'+r.id+'" requires a vector source')):"vector"!==f||r["source-layer"]?"raster-dem"===f&&"hillshade"!==a?e.push(new ji(n,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==a||!r.paint||!r.paint["line-gradient"]||"geojson"===f&&p.lineMetrics||e.push(new ji(n,r,'layer "'+r.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):e.push(new ji(n,r,'layer "'+r.id+'" must specify a "source-layer"')):e.push(new ji(n,r.source,'source "'+r.source+'" not found'))}else e.push(new ji(n,r,'missing required property "source"'));return e=e.concat($i({key:n,value:r,valueSpec:o.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return fo({key:n+".type",value:r.type,valueSpec:o.layer.type,style:t.style,styleSpec:t.styleSpec,object:r,objectKey:"type"})},filter:Qi,layout:function(t){return $i({layer:r,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return no(Nt({layerType:a},t))}}})},paint:function(t){return $i({layer:r,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return ro(Nt({layerType:a},t))}}})}}})),e}function oo(t){var e=t.value,r=t.key,n=In(e);return"string"!==n?[new ji(r,e,"string expected, "+n+" found")]:[]}var so={promoteId:lo};function ao(t){var e=t.value,r=t.key,n=t.styleSpec,i=t.style;if(!e.type)return[new ji(r,e,'"type" is required')];var o,s=Gi(e.type);switch(s){case"vector":case"raster":case"raster-dem":return o=$i({key:r,value:e,valueSpec:n["source_"+s.replace("-","_")],style:t.style,styleSpec:n,objectElementValidators:so}),o;case"geojson":if(o=$i({key:r,value:e,valueSpec:n.source_geojson,style:i,styleSpec:n,objectElementValidators:so}),e.cluster)for(var a in e.clusterProperties){var l=e.clusterProperties[a],u=l[0],c=l[1],h="string"===typeof u?[u,["accumulated"],["get",a]]:u;o.push.apply(o,Yi({key:r+"."+a+".map",value:c,expressionContext:"cluster-map"})),o.push.apply(o,Yi({key:r+"."+a+".reduce",value:h,expressionContext:"cluster-reduce"}))}return o;case"video":return $i({key:r,value:e,valueSpec:n.source_video,style:i,styleSpec:n});case"image":return $i({key:r,value:e,valueSpec:n.source_image,style:i,styleSpec:n});case"canvas":return[new ji(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ki({key:r+".type",value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:i,styleSpec:n})}}function lo(t){var e=t.key,r=t.value;if("string"===In(r))return oo({key:e,value:r});var n=[];for(var i in r)n.push.apply(n,oo({key:e+"."+i,value:r[i]}));return n}function uo(t){var e=t.value,r=t.styleSpec,n=r.light,i=t.style,o=[],s=In(e);if(void 0===e)return o;if("object"!==s)return o=o.concat([new ji("light",e,"object expected, "+s+" found")]),o;for(var a in e){var l=a.match(/^(.*)-transition$/);o=l&&n[l[1]]&&n[l[1]].transition?o.concat(fo({key:a,value:e[a],valueSpec:r.transition,style:i,styleSpec:r})):n[a]?o.concat(fo({key:a,value:e[a],valueSpec:n[a],style:i,styleSpec:r})):o.concat([new ji(a,e[a],'unknown property "'+a+'"')])}return o}function co(t){return 0===oo(t).length?[]:Yi(t)}function ho(t){return 0===oo(t).length?[]:Yi(t)}var po={"*":function(){return[]},array:Zi,boolean:Hi,number:Xi,color:Ji,constants:Vi,enum:Ki,filter:Qi,function:Wi,layer:io,object:$i,source:ao,light:uo,string:oo,formatted:co,resolvedImage:ho};function fo(t){var e=t.value,r=t.valueSpec,n=t.styleSpec;if(r.expression&&Tn(Gi(e)))return Wi(t);if(r.expression&&On(qi(e)))return Yi(t);if(r.type&&po[r.type])return po[r.type](t);var i=$i(Nt({},t,{valueSpec:r.type?n[r.type]:r}));return i}function mo(t){var e=t.value,r=t.key,n=oo(t);return n.length?n:(-1===e.indexOf("{fontstack}")&&n.push(new ji(r,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&n.push(new ji(r,e,'"glyphs" url must include a "{range}" token')),n)}function go(t,e){void 0===e&&(e=U);var r=[];return r=r.concat(fo({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:mo,"*":function(){return[]}}})),t.constants&&(r=r.concat(Vi({key:"constants",value:t.constants,style:t,styleSpec:e}))),yo(r)}function yo(t){return[].concat(t).sort(function(t,e){return t.line-e.line})}function _o(t){return function(){var e=[],r=arguments.length;while(r--)e[r]=arguments[r];return yo(t.apply(this,e))}}go.source=_o(ao),go.light=_o(uo),go.layer=_o(io),go.filter=_o(Qi),go.paintProperty=_o(ro),go.layoutProperty=_o(no);var vo=W(function(t,e){var r=function(){var t=function(t,e,r,n){for(r=r||{},n=t.length;n--;r[t[n]]=e);return r},e=[1,12],r=[1,13],n=[1,9],i=[1,10],o=[1,11],s=[1,14],a=[1,15],l=[14,18,22,24],u=[18,22],c=[22,24],h={trace:function(){},yy:{},symbols_:{error:2,JSONString:3,STRING:4,JSONNumber:5,NUMBER:6,JSONNullLiteral:7,NULL:8,JSONBooleanLiteral:9,TRUE:10,FALSE:11,JSONText:12,JSONValue:13,EOF:14,JSONObject:15,JSONArray:16,"{":17,"}":18,JSONMemberList:19,JSONMember:20,":":21,",":22,"[":23,"]":24,JSONElementList:25,$accept:0,$end:1},terminals_:{2:"error",4:"STRING",6:"NUMBER",8:"NULL",10:"TRUE",11:"FALSE",14:"EOF",17:"{",18:"}",21:":",22:",",23:"[",24:"]"},productions_:[0,[3,1],[5,1],[7,1],[9,1],[9,1],[12,2],[13,1],[13,1],[13,1],[13,1],[13,1],[13,1],[15,2],[15,3],[20,3],[19,1],[19,3],[16,2],[16,3],[25,1],[25,3]],performAction:function(t,e,r,n,i,o,s){var a=o.length-1;switch(i){case 1:this.$=new String(t.replace(/\\(\\|")/g,"$1").replace(/\\n/g,"\n").replace(/\\r/g,"\r").replace(/\\t/g,"\t").replace(/\\v/g,"\v").replace(/\\f/g,"\f").replace(/\\b/g,"\b")),this.$.__line__=this._$.first_line;break;case 2:this.$=new Number(t),this.$.__line__=this._$.first_line;break;case 3:this.$=null;break;case 4:this.$=new Boolean(!0),this.$.__line__=this._$.first_line;break;case 5:this.$=new Boolean(!1),this.$.__line__=this._$.first_line;break;case 6:return this.$=o[a-1];case 13:this.$={},Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 14:case 19:this.$=o[a-1],Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 15:this.$=[o[a-2],o[a]];break;case 16:this.$={},this.$[o[a][0]]=o[a][1];break;case 17:this.$=o[a-2],o[a-2][o[a][0]]=o[a][1];break;case 18:this.$=[],Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 20:this.$=[o[a]];break;case 21:this.$=o[a-2],o[a-2].push(o[a]);break}},table:[{3:5,4:e,5:6,6:r,7:3,8:n,9:4,10:i,11:o,12:1,13:2,15:7,16:8,17:s,23:a},{1:[3]},{14:[1,16]},t(l,[2,7]),t(l,[2,8]),t(l,[2,9]),t(l,[2,10]),t(l,[2,11]),t(l,[2,12]),t(l,[2,3]),t(l,[2,4]),t(l,[2,5]),t([14,18,21,22,24],[2,1]),t(l,[2,2]),{3:20,4:e,18:[1,17],19:18,20:19},{3:5,4:e,5:6,6:r,7:3,8:n,9:4,10:i,11:o,13:23,15:7,16:8,17:s,23:a,24:[1,21],25:22},{1:[2,6]},t(l,[2,13]),{18:[1,24],22:[1,25]},t(u,[2,16]),{21:[1,26]},t(l,[2,18]),{22:[1,28],24:[1,27]},t(c,[2,20]),t(l,[2,14]),{3:20,4:e,20:29},{3:5,4:e,5:6,6:r,7:3,8:n,9:4,10:i,11:o,13:30,15:7,16:8,17:s,23:a},t(l,[2,19]),{3:5,4:e,5:6,6:r,7:3,8:n,9:4,10:i,11:o,13:31,15:7,16:8,17:s,23:a},t(u,[2,17]),t(u,[2,15]),t(c,[2,21])],defaultActions:{16:[2,6]},parseError:function(t,e){if(!e.recoverable)throw new Error(t);this.trace(t)},parse:function(t){var e=this,r=[0],n=[null],i=[],o=this.table,s="",a=0,l=0,u=2,c=1,h=i.slice.call(arguments,1),p=Object.create(this.lexer),f={yy:{}};for(var d in this.yy)Object.prototype.hasOwnProperty.call(this.yy,d)&&(f.yy[d]=this.yy[d]);p.setInput(t,f.yy),f.yy.lexer=p,f.yy.parser=this,"undefined"==typeof p.yylloc&&(p.yylloc={});var m=p.yylloc;i.push(m);var g=p.options&&p.options.ranges;function y(){var t;return t=p.lex()||c,"number"!==typeof t&&(t=e.symbols_[t]||t),t}"function"===typeof f.yy.parseError?this.parseError=f.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;var _,v,x,b,w,E,S,I,T={};while(1){if(v=r[r.length-1],this.defaultActions[v]?x=this.defaultActions[v]:(null!==_&&"undefined"!=typeof _||(_=y()),x=o[v]&&o[v][_]),"undefined"===typeof x||!x.length||!x[0]){var C="";for(w in I=[],o[v])this.terminals_[w]&&w>u&&I.push("'"+this.terminals_[w]+"'");C=p.showPosition?"Parse error on line "+(a+1)+":\n"+p.showPosition()+"\nExpecting "+I.join(", ")+", got '"+(this.terminals_[_]||_)+"'":"Parse error on line "+(a+1)+": Unexpected "+(_==c?"end of input":"'"+(this.terminals_[_]||_)+"'"),this.parseError(C,{text:p.match,token:this.terminals_[_]||_,line:p.yylineno,loc:m,expected:I})}if(x[0]instanceof Array&&x.length>1)throw new Error("Parse Error: multiple actions possible at state: "+v+", token: "+_);switch(x[0]){case 1:r.push(_),n.push(p.yytext),i.push(p.yylloc),r.push(x[1]),_=null,l=p.yyleng,s=p.yytext,a=p.yylineno,m=p.yylloc;break;case 2:if(E=this.productions_[x[1]][1],T.$=n[n.length-E],T._$={first_line:i[i.length-(E||1)].first_line,last_line:i[i.length-1].last_line,first_column:i[i.length-(E||1)].first_column,last_column:i[i.length-1].last_column},g&&(T._$.range=[i[i.length-(E||1)].range[0],i[i.length-1].range[1]]),b=this.performAction.apply(T,[s,l,a,f.yy,x[1],n,i].concat(h)),"undefined"!==typeof b)return b;E&&(r=r.slice(0,-1*E*2),n=n.slice(0,-1*E),i=i.slice(0,-1*E)),r.push(this.productions_[x[1]][0]),n.push(T.$),i.push(T._$),S=o[r[r.length-2]][r[r.length-1]],r.push(S);break;case 3:return!0}}return!0}},p=function(){var t={EOF:1,parseError:function(t,e){if(!this.yy.parser)throw new Error(t);this.yy.parser.parseError(t,e)},setInput:function(t,e){return this.yy=e||this.yy||{},this._input=t,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var t=this._input[0];this.yytext+=t,this.yyleng++,this.offset++,this.match+=t,this.matched+=t;var e=t.match(/(?:\r\n?|\n).*/g);return e?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),t},unput:function(t){var e=t.length,r=t.split(/(?:\r\n?|\n)/g);this._input=t+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-e),this.offset-=e;var n=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),r.length-1&&(this.yylineno-=r.length-1);var i=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:r?(r.length===n.length?this.yylloc.first_column:0)+n[n.length-r.length].length-r[0].length:this.yylloc.first_column-e},this.options.ranges&&(this.yylloc.range=[i[0],i[0]+this.yyleng-e]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(t){this.unput(this.match.slice(t))},pastInput:function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return(t.length>20?"...":"")+t.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var t=this.match;return t.length<20&&(t+=this._input.substr(0,20-t.length)),(t.substr(0,20)+(t.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var t=this.pastInput(),e=new Array(t.length+1).join("-");return t+this.upcomingInput()+"\n"+e+"^"},test_match:function(t,e){var r,n,i;if(this.options.backtrack_lexer&&(i={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(i.yylloc.range=this.yylloc.range.slice(0))),n=t[0].match(/(?:\r\n?|\n).*/g),n&&(this.yylineno+=n.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:n?n[n.length-1].length-n[n.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],r=this.performAction.call(this,this.yy,this,e,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),r)return r;if(this._backtrack){for(var o in i)this[o]=i[o];return!1}return!1},next:function(){if(this.done)return this.EOF;var t,e,r,n;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var i=this._currentRules(),o=0;o<i.length;o++)if(r=this._input.match(this.rules[i[o]]),r&&(!e||r[0].length>e[0].length)){if(e=r,n=o,this.options.backtrack_lexer){if(t=this.test_match(r,i[o]),!1!==t)return t;if(this._backtrack){e=!1;continue}return!1}if(!this.options.flex)break}return e?(t=this.test_match(e,i[n]),!1!==t&&t):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return t||this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){var t=this.conditionStack.length-1;return t>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions["INITIAL"].rules},topState:function(t){return t=this.conditionStack.length-1-Math.abs(t||0),t>=0?this.conditionStack[t]:"INITIAL"},pushState:function(t){this.begin(t)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(t,e,r,n){switch(r){case 0:break;case 1:return 6;case 2:return e.yytext=e.yytext.substr(1,e.yyleng-2),4;case 3:return 17;case 4:return 18;case 5:return 23;case 6:return 24;case 7:return 22;case 8:return 21;case 9:return 10;case 10:return 11;case 11:return 8;case 12:return 14;case 13:return"INVALID"}},rules:[/^(?:\s+)/,/^(?:(-?([0-9]|[1-9][0-9]+))(\.[0-9]+)?([eE][-+]?[0-9]+)?\b)/,/^(?:"(?:\\[\\"bfnrt/]|\\u[a-fA-F0-9]{4}|[^\\\0-\x09\x0a-\x1f"])*")/,/^(?:\{)/,/^(?:\})/,/^(?:\[)/,/^(?:\])/,/^(?:,)/,/^(?::)/,/^(?:true\b)/,/^(?:false\b)/,/^(?:null\b)/,/^(?:$)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],inclusive:!0}}};return t}();function f(){this.yy={}}return h.lexer=p,f.prototype=h,h.Parser=f,new f}();"undefined"!==typeof X&&(e.parser=r,e.Parser=r.Parser,e.parse=function(){return r.parse.apply(r,arguments)})});vo.parser,vo.Parser,vo.parse;function xo(t){if(t instanceof String||"string"===typeof t||t instanceof r)try{return vo.parse(t.toString())}catch(e){throw new Ui(e)}return t}function bo(t,e){void 0===e&&(e=U);var r=t;try{r=xo(r)}catch(n){return[n]}return go(r,e)}var wo={StyleExpression:Rn,isExpression:On,isExpressionFilter:oi,createExpression:Nn,createPropertyExpression:jn,normalizePropertyExpression:Vn,ZoomConstantExpression:Fn,ZoomDependentExpression:Bn,StylePropertyFunction:Un},Eo={convertFunction:Xn,createFunction:Mn,isFunction:Tn},So={eachSource:Mt,eachLayer:At,eachProperty:Pt};bo.parsed=bo,bo.latest=bo,e.Color=oe,e.ParsingError=Ui,e.ValidationError=ji,e.composite=Si,e.convertFilter=gi,e.derefLayers=Ci,e.diff=Bi,e.expression=wo,e.featureFilter=ai,e.format=$,e.function=Eo,e.latest=U,e.migrate=Ei,e.v8=U,e.validate=bo,e.visit=So,Object.defineProperty(e,"__esModule",{value:!0})})}).call(this,r("c8ba"),r("b639").Buffer)},4362:function(t,e,r){e.nextTick=function(t){setTimeout(t,0)},e.platform=e.arch=e.execPath=e.title="browser",e.pid=1,e.browser=!0,e.env={},e.argv=[],e.binding=function(t){throw new Error("No such module. (Possibly not yet loaded)")},function(){var t,n="/";e.cwd=function(){return n},e.chdir=function(e){t||(t=r("df7c")),n=t.resolve(e,n)}}(),e.exit=e.kill=e.umask=e.dlopen=e.uptime=e.memoryUsage=e.uvCounters=function(){},e.features={}},"595b":function(t,e,r){(function(t){!function(t,r){r(e)}(0,function(e){"use strict";var r=6371008.8,n={centimeters:637100880,centimetres:637100880,degrees:57.22891354143274,feet:20902260.511392,inches:39.37*r,kilometers:6371.0088,kilometres:6371.0088,meters:r,metres:r,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:r/1852,radians:1,yards:6967335.223679999},i={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/r,yards:1.0936133},o={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:3.86e-7,millimeters:1e6,millimetres:1e6,yards:1.195990046};function s(t,e,r){void 0===r&&(r={});var n={type:"Feature"};return(0===r.id||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=e||{},n.geometry=t,n}function a(t,e,r){switch(t){case"Point":return l(e).geometry;case"LineString":return p(e).geometry;case"Polygon":return c(e).geometry;case"MultiPoint":return g(e).geometry;case"MultiLineString":return m(e).geometry;case"MultiPolygon":return y(e).geometry;default:throw new Error(t+" is invalid")}}function l(t,e,r){if(void 0===r&&(r={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!M(t[0])||!M(t[1]))throw new Error("coordinates must contain numbers");return s({type:"Point",coordinates:t},e,r)}function u(t,e,r){return void 0===r&&(r={}),d(t.map(function(t){return l(t,e)}),r)}function c(t,e,r){void 0===r&&(r={});for(var n=0,i=t;n<i.length;n++){var o=i[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<o[o.length-1].length;a++)if(o[o.length-1][a]!==o[0][a])throw new Error("First and last Position are not equivalent.")}return s({type:"Polygon",coordinates:t},e,r)}function h(t,e,r){return void 0===r&&(r={}),d(t.map(function(t){return c(t,e)}),r)}function p(t,e,r){if(void 0===r&&(r={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return s({type:"LineString",coordinates:t},e,r)}function f(t,e,r){return void 0===r&&(r={}),d(t.map(function(t){return p(t,e)}),r)}function d(t,e){void 0===e&&(e={});var r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}function m(t,e,r){return void 0===r&&(r={}),s({type:"MultiLineString",coordinates:t},e,r)}function g(t,e,r){return void 0===r&&(r={}),s({type:"MultiPoint",coordinates:t},e,r)}function y(t,e,r){return void 0===r&&(r={}),s({type:"MultiPolygon",coordinates:t},e,r)}function _(t,e,r){return void 0===r&&(r={}),s({type:"GeometryCollection",geometries:t},e,r)}function v(t,e){if(void 0===e&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,e||0);return Math.round(t*r)/r}function x(t,e){void 0===e&&(e="kilometers");var r=n[e];if(!r)throw new Error(e+" units is invalid");return t*r}function b(t,e){void 0===e&&(e="kilometers");var r=n[e];if(!r)throw new Error(e+" units is invalid");return t/r}function w(t,e){return S(b(t,e))}function E(t){var e=t%360;return e<0&&(e+=360),e}function S(t){return t%(2*Math.PI)*180/Math.PI}function I(t){return t%360*Math.PI/180}function T(t,e,r){if(void 0===e&&(e="kilometers"),void 0===r&&(r="kilometers"),!(t>=0))throw new Error("length must be a positive number");return x(b(t,e),r)}function C(t,e,r){if(void 0===e&&(e="meters"),void 0===r&&(r="kilometers"),!(t>=0))throw new Error("area must be a positive number");var n=o[e];if(!n)throw new Error("invalid original units");var i=o[r];if(!i)throw new Error("invalid final units");return t/n*i}function M(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function A(t){return!!t&&t.constructor===Object}function P(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(function(t){if(!M(t))throw new Error("bbox must only contain numbers")})}function k(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof t))throw new Error("id must be a number or a string")}var L=Object.freeze({__proto__:null,earthRadius:r,factors:n,unitsFactors:i,areaFactors:o,feature:s,geometry:a,point:l,points:u,polygon:c,polygons:h,lineString:p,lineStrings:f,featureCollection:d,multiLineString:m,multiPoint:g,multiPolygon:y,geometryCollection:_,round:v,radiansToLength:x,lengthToRadians:b,lengthToDegrees:w,bearingToAzimuth:E,radiansToDegrees:S,degreesToRadians:I,convertLength:T,convertArea:C,isNumber:M,isObject:A,validateBBox:P,validateId:k});function z(t,e,r){if(null!==t)for(var n,i,o,s,a,l,u,c,h=0,p=0,f=t.type,d="FeatureCollection"===f,m="Feature"===f,g=d?t.features.length:1,y=0;y<g;y++){a=(c=!!(u=d?t.features[y].geometry:m?t.geometry:t)&&"GeometryCollection"===u.type)?u.geometries.length:1;for(var _=0;_<a;_++){var v=0,x=0;if(null!==(s=c?u.geometries[_]:u)){l=s.coordinates;var b=s.type;switch(h=!r||"Polygon"!==b&&"MultiPolygon"!==b?0:1,b){case null:break;case"Point":if(!1===e(l,p,y,v,x))return!1;p++,v++;break;case"LineString":case"MultiPoint":for(n=0;n<l.length;n++){if(!1===e(l[n],p,y,v,x))return!1;p++,"MultiPoint"===b&&v++}"LineString"===b&&v++;break;case"Polygon":case"MultiLineString":for(n=0;n<l.length;n++){for(i=0;i<l[n].length-h;i++){if(!1===e(l[n][i],p,y,v,x))return!1;p++}"MultiLineString"===b&&v++,"Polygon"===b&&x++}"Polygon"===b&&v++;break;case"MultiPolygon":for(n=0;n<l.length;n++){for(x=0,i=0;i<l[n].length;i++){for(o=0;o<l[n][i].length-h;o++){if(!1===e(l[n][i][o],p,y,v,x))return!1;p++}x++}v++}break;case"GeometryCollection":for(n=0;n<s.geometries.length;n++)if(!1===z(s.geometries[n],e,r))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function D(t,e,r,n){var i=r;return z(t,function(t,n,o,s,a){i=0===n&&void 0===r?t:e(i,t,n,o,s,a)},n),i}function R(t,e){var r;switch(t.type){case"FeatureCollection":for(r=0;r<t.features.length&&!1!==e(t.features[r].properties,r);r++);break;case"Feature":e(t.properties,0)}}function O(t,e,r){var n=r;return R(t,function(t,i){n=0===i&&void 0===r?t:e(n,t,i)}),n}function N(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var r=0;r<t.features.length&&!1!==e(t.features[r],r);r++);}function F(t,e,r){var n=r;return N(t,function(t,i){n=0===i&&void 0===r?t:e(n,t,i)}),n}function B(t){var e=[];return z(t,function(t){e.push(t)}),e}function j(t,e){var r,n,i,o,s,a,l,u,c,h,p=0,f="FeatureCollection"===t.type,d="Feature"===t.type,m=f?t.features.length:1;for(r=0;r<m;r++){for(a=f?t.features[r].geometry:d?t.geometry:t,u=f?t.features[r].properties:d?t.properties:{},c=f?t.features[r].bbox:d?t.bbox:void 0,h=f?t.features[r].id:d?t.id:void 0,s=(l=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,i=0;i<s;i++)if(null!==(o=l?a.geometries[i]:a))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(o,p,u,c,h))return!1;break;case"GeometryCollection":for(n=0;n<o.geometries.length;n++)if(!1===e(o.geometries[n],p,u,c,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,p,u,c,h))return!1;p++}}function U(t,e,r){var n=r;return j(t,function(t,i,o,s,a){n=0===i&&void 0===r?t:e(n,t,i,o,s,a)}),n}function V(t,e){j(t,function(t,r,n,i,o){var a,l=null===t?null:t.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return!1!==e(s(t,n,{bbox:i,id:o}),r,0)&&void 0}switch(l){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon"}for(var u=0;u<t.coordinates.length;u++){var c=t.coordinates[u];if(!1===e(s({type:a,coordinates:c},n),r,u))return!1}})}function G(t,e,r){var n=r;return V(t,function(t,i,o){n=0===i&&0===o&&void 0===r?t:e(n,t,i,o)}),n}function q(t,e){V(t,function(t,r,n){var i=0;if(t.geometry){var o=t.geometry.type;if("Point"!==o&&"MultiPoint"!==o){var s,a=0,l=0,u=0;return!1!==z(t,function(o,c,h,f,d){if(void 0===s||r>a||f>l||d>u)return s=o,a=r,l=f,u=d,void(i=0);var m=p([s,o],t.properties);if(!1===e(m,r,n,d,i))return!1;i++,s=o})&&void 0}}})}function $(t,e,r){var n=r,i=!1;return q(t,function(t,o,s,a,l){n=!1===i&&void 0===r?t:e(n,t,o,s,a,l),i=!0}),n}function Z(t,e){if(!t)throw new Error("geojson is required");V(t,function(t,r,n){if(null!==t.geometry){var i=t.geometry.type,o=t.geometry.coordinates;switch(i){case"LineString":if(!1===e(t,r,n,0,0))return!1;break;case"Polygon":for(var s=0;s<o.length;s++)if(!1===e(p(o[s],t.properties),r,n,s))return!1}}})}function X(t,e,r){var n=r;return Z(t,function(t,i,o,s){n=0===i&&void 0===r?t:e(n,t,i,o,s)}),n}function W(t,e){if(!A(e=e||{}))throw new Error("options is invalid");var r,n=e.featureIndex||0,i=e.multiFeatureIndex||0,o=e.geometryIndex||0,s=e.segmentIndex||0,a=e.properties;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),a=a||t.features[n].properties,r=t.features[n].geometry;break;case"Feature":a=a||t.properties,r=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":r=t;break;default:throw new Error("geojson is invalid")}if(null===r)return null;var l=r.coordinates;switch(r.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=l.length+s-1),p([l[s],l[s+1]],a,e);case"Polygon":return o<0&&(o=l.length+o),s<0&&(s=l[o].length+s-1),p([l[o][s],l[o][s+1]],a,e);case"MultiLineString":return i<0&&(i=l.length+i),s<0&&(s=l[i].length+s-1),p([l[i][s],l[i][s+1]],a,e);case"MultiPolygon":return i<0&&(i=l.length+i),o<0&&(o=l[i].length+o),s<0&&(s=l[i][o].length-s-1),p([l[i][o][s],l[i][o][s+1]],a,e)}throw new Error("geojson is invalid")}function Y(t,e){if(!A(e=e||{}))throw new Error("options is invalid");var r,n=e.featureIndex||0,i=e.multiFeatureIndex||0,o=e.geometryIndex||0,s=e.coordIndex||0,a=e.properties;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),a=a||t.features[n].properties,r=t.features[n].geometry;break;case"Feature":a=a||t.properties,r=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":r=t;break;default:throw new Error("geojson is invalid")}if(null===r)return null;var u=r.coordinates;switch(r.type){case"Point":return l(u,a,e);case"MultiPoint":return i<0&&(i=u.length+i),l(u[i],a,e);case"LineString":return s<0&&(s=u.length+s),l(u[s],a,e);case"Polygon":return o<0&&(o=u.length+o),s<0&&(s=u[o].length+s),l(u[o][s],a,e);case"MultiLineString":return i<0&&(i=u.length+i),s<0&&(s=u[i].length+s),l(u[i][s],a,e);case"MultiPolygon":return i<0&&(i=u.length+i),o<0&&(o=u[i].length+o),s<0&&(s=u[i][o].length-s),l(u[i][o][s],a,e)}throw new Error("geojson is invalid")}var H=Object.freeze({__proto__:null,coordAll:B,coordEach:z,coordReduce:D,featureEach:N,featureReduce:F,findPoint:Y,findSegment:W,flattenEach:V,flattenReduce:G,geomEach:j,geomReduce:U,lineEach:Z,lineReduce:X,propEach:R,propReduce:O,segmentEach:q,segmentReduce:$});function J(t){var e=[1/0,1/0,-1/0,-1/0];return z(t,function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])}),e}function K(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return t.geometry.coordinates;if("Point"===t.type)return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Q(t){if(Array.isArray(t))return t;if("Feature"===t.type){if(null!==t.geometry)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function tt(t){if(t.length>1&&M(t[0])&&M(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return tt(t[0]);throw new Error("coordinates must only contain numbers")}function et(t,e,r){if(!e||!r)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.type)}function rt(t,e,r){if(!t)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!t||"Feature"!==t.type||!t.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.geometry.type)}function nt(t,e,r){if(!t)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!t||"FeatureCollection"!==t.type)throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0,i=t.features;n<i.length;n++){var o=i[n];if(!o||"Feature"!==o.type||!o.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!o.geometry||o.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+o.geometry.type)}}function it(t){return"Feature"===t.type?t.geometry:t}function ot(t,e){return"FeatureCollection"===t.type?"FeatureCollection":"GeometryCollection"===t.type?"GeometryCollection":"Feature"===t.type&&null!==t.geometry?t.geometry.type:t.type}J.default=J;var st=Object.freeze({__proto__:null,getCoord:K,getCoords:Q,containsNumber:tt,geojsonType:et,featureOf:rt,collectionOf:nt,getGeom:it,getType:ot}),at=Object.getOwnPropertySymbols,lt=Object.prototype.hasOwnProperty,ut=Object.prototype.propertyIsEnumerable;
/*
    object-assign
    (c) Sindre Sorhus
    @license MIT
    */function ct(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}var ht=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},r=0;r<10;r++)e["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(t){n[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var r,n,i=ct(t),o=1;o<arguments.length;o++){for(var s in r=Object(arguments[o]))lt.call(r,s)&&(i[s]=r[s]);if(at){n=at(r);for(var a=0;a<n.length;a++)ut.call(r,n[a])&&(i[n[a]]=r[n[a]])}}return i},pt={successCallback:null,verbose:!1},ft={};
/**
     * @license GNU Affero General Public License.
     * Copyright (c) 2015, 2015 Ronny Lorenz <ronny@tbi.univie.ac.at>
     * v. 1.2.0
     * https://github.com/RaumZeit/MarchingSquares.js
     *
     * MarchingSquaresJS is free software: you can redistribute it and/or modify
     * it under the terms of the GNU Affero General Public License as published by
     * the Free Software Foundation, either version 3 of the License, or
     * (at your option) any later version.
     *
     * MarchingSquaresJS is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
     * GNU Affero General Public License for more details.
     *
     * As additional permission under GNU Affero General Public License version 3
     * section 7, third-party projects (personal or commercial) may distribute,
     * include, or link against UNMODIFIED VERSIONS of MarchingSquaresJS without the
     * requirement that said third-party project for that reason alone becomes
     * subject to any requirement of the GNU Affero General Public License version 3.
     * Any modifications to MarchingSquaresJS, however, must be shared with the public
     * and made available.
     *
     * In summary this:
     * - allows you to use MarchingSquaresJS at no cost
     * - allows you to use MarchingSquaresJS for both personal and commercial purposes
     * - allows you to distribute UNMODIFIED VERSIONS of MarchingSquaresJS under any
     *   license as long as this license notice is included
     * - enables you to keep the source code of your program that uses MarchingSquaresJS
     *   undisclosed
     * - forces you to share any modifications you have made to MarchingSquaresJS,
     *   e.g. bug-fixes
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with MarchingSquaresJS.  If not, see <http://www.gnu.org/licenses/>.
     */function dt(t,e,r){r=r||{};for(var n=Object.keys(pt),i=0;i<n.length;i++){var o=n[i],s=r[o];s=null!=s?s:pt[o],ft[o]=s}ft.verbose&&console.log("MarchingSquaresJS-isoContours: computing isocontour for "+e);var a=function(t){var e=[],r=0,n=1e-7;return t.cells.forEach(function(i,o){i.forEach(function(i,s){if(void 0!==i&&5!==(f=i).cval&&10!==f.cval&&!gt(i)){var a=function(t,e,r){var n,i,o=t.length,s=[],a=[0,0,1,1,0,0,0,0,-1,0,1,1,-1,0,-1,0],l=[0,-1,0,0,1,1,1,1,0,-1,0,0,0,-1,0,0],u=["none","left","bottom","left","right","none","bottom","left","top","top","none","top","right","right","bottom","none"],c=["none","bottom","right","right","top","top","top","top","left","bottom","right","right","left","bottom","left","none"],h=t[e][r],p=h.cval,f=u[p],d=_t(h,f);s.push([r+d[0],e+d[1]]),f=c[p],d=_t(h,f),s.push([r+d[0],e+d[1]]),yt(h);for(var m=r+a[p],g=e+l[p],y=p;m>=0&&g>=0&&g<o&&(m!=r||g!=e)&&void 0!==(h=t[g][m]);){if(0===(p=h.cval)||15===p)return{path:s,info:"mergeable"};f=c[p],n=a[p],i=l[p],5!==p&&10!==p||(5===p?h.flipped?-1===l[y]?(f="left",n=-1,i=0):(f="right",n=1,i=0):-1===a[y]&&(f="bottom",n=0,i=-1):10===p&&(h.flipped?-1===a[y]?(f="top",n=0,i=1):(f="bottom",n=0,i=-1):1===l[y]&&(f="left",n=-1,i=0))),d=_t(h,f),s.push([m+d[0],g+d[1]]),yt(h),m+=n,g+=i,y=p}return{path:s,info:"closed"}}(t.cells,o,s),l=!1;if("mergeable"===a.info)for(var u=a.path[a.path.length-1][0],c=a.path[a.path.length-1][1],h=r-1;h>=0;h--)if(Math.abs(e[h][0][0]-u)<=n&&Math.abs(e[h][0][1]-c)<=n){for(var p=a.path.length-2;p>=0;--p)e[h].unshift(a.path[p]);l=!0;break}l||(e[r++]=a.path)}var f})}),e}(function(t,e){for(var r=t.length-1,n=t[0].length-1,i={rows:r,cols:n,cells:[]},o=0;o<r;++o){i.cells[o]=[];for(var s=0;s<n;++s){var a=0,l=t[o+1][s],u=t[o+1][s+1],c=t[o][s+1],h=t[o][s];if(!(isNaN(l)||isNaN(u)||isNaN(c)||isNaN(h))){a|=l>=e?8:0,a|=u>=e?4:0,a|=c>=e?2:0;var p,f,d,m,g=!1;if(5===(a|=h>=e?1:0)||10===a){var y=(l+u+c+h)/4;5===a&&y<e?(a=10,g=!0):10===a&&y<e&&(a=5,g=!0)}0!==a&&15!==a&&(p=f=d=m=.5,1===a?(d=1-mt(e,l,h),f=1-mt(e,c,h)):2===a?(f=mt(e,h,c),m=1-mt(e,u,c)):3===a?(d=1-mt(e,l,h),m=1-mt(e,u,c)):4===a?(p=mt(e,l,u),m=mt(e,c,u)):5===a?(p=mt(e,l,u),m=mt(e,c,u),f=1-mt(e,c,h),d=1-mt(e,l,h)):6===a?(f=mt(e,h,c),p=mt(e,l,u)):7===a?(d=1-mt(e,l,h),p=mt(e,l,u)):8===a?(d=mt(e,h,l),p=1-mt(e,u,l)):9===a?(f=1-mt(e,c,h),p=1-mt(e,u,l)):10===a?(p=1-mt(e,u,l),m=1-mt(e,u,c),f=mt(e,h,c),d=mt(e,h,l)):11===a?(p=1-mt(e,u,l),m=1-mt(e,u,c)):12===a?(d=mt(e,h,l),m=mt(e,c,u)):13===a?(f=1-mt(e,c,h),m=mt(e,c,u)):14===a?(d=mt(e,h,l),f=mt(e,h,c)):console.log("MarchingSquaresJS-isoContours: Illegal cval detected: "+a),i.cells[o][s]={cval:a,flipped:g,top:p,right:m,bottom:f,left:d})}}}return i}(t,e));return"function"==typeof ft.successCallback&&ft.successCallback(a),a}function mt(t,e,r){return(t-e)/(r-e)}function gt(t){return 0===t.cval||15===t.cval}function yt(t){gt(t)||5===t.cval||10===t.cval||(t.cval=15)}function _t(t,e){return"top"===e?[t.top,1]:"bottom"===e?[t.bottom,0]:"right"===e?[1,t.right]:"left"===e?[0,t.left]:void 0}function vt(t,e){if(!A(e=e||{}))throw new Error("options is invalid");var r=e.zProperty||"elevation",n=e.flip,i=e.flags;nt(t,"Point","input must contain Points");for(var o=function(t,e){var r={};return N(t,function(t){var e=Q(t)[1];r[e]||(r[e]=[]),r[e].push(t)}),Object.keys(r).map(function(t){return r[t].sort(function(t,e){return Q(t)[0]-Q(e)[0]})}).sort(function(t,r){return e?Q(t[0])[1]-Q(r[0])[1]:Q(r[0])[1]-Q(t[0])[1]})}(t,n),s=[],a=0;a<o.length;a++){for(var l=o[a],u=[],c=0;c<l.length;c++){var h=l[c];h.properties[r]?u.push(h.properties[r]):u.push(0),!0===i&&(h.properties.matrixPosition=[a,c])}s.push(u)}return s}var xt=wt,bt=wt;function wt(t,e,r,n,i){Et(t,e,r||0,n||t.length-1,i||It)}function Et(t,e,r,n,i){for(;n>r;){if(n-r>600){var o=n-r+1,s=e-r+1,a=Math.log(o),l=.5*Math.exp(2*a/3),u=.5*Math.sqrt(a*l*(o-l)/o)*(s-o/2<0?-1:1);Et(t,e,Math.max(r,Math.floor(e-s*l/o+u)),Math.min(n,Math.floor(e+(o-s)*l/o+u)),i)}var c=t[e],h=r,p=n;for(St(t,r,e),i(t[n],c)>0&&St(t,r,n);h<p;){for(St(t,h,p),h++,p--;i(t[h],c)<0;)h++;for(;i(t[p],c)>0;)p--}0===i(t[r],c)?St(t,r,p):St(t,++p,n),p<=e&&(r=p+1),e<=p&&(n=p-1)}}function St(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function It(t,e){return t<e?-1:t>e?1:0}xt.default=bt;var Tt=Mt,Ct=Mt;function Mt(t,e){if(!(this instanceof Mt))return new Mt(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function At(t,e,r){if(!r)return e.indexOf(t);for(var n=0;n<e.length;n++)if(r(t,e[n]))return n;return-1}function Pt(t,e){kt(t,0,t.children.length,e,t)}function kt(t,e,r,n,i){i||(i=Bt(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o,s=e;s<r;s++)o=t.children[s],Lt(i,t.leaf?n(o):o);return i}function Lt(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function zt(t,e){return t.minX-e.minX}function Dt(t,e){return t.minY-e.minY}function Rt(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function Ot(t){return t.maxX-t.minX+(t.maxY-t.minY)}function Nt(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function Ft(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function Bt(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function jt(t,e,r,n,i){for(var o,s=[e,r];s.length;)(r=s.pop())-(e=s.pop())<=n||(o=e+Math.ceil((r-e)/n/2)*n,xt(t,o,e,r,i),s.push(e,o,o,r))}function Ut(t){var e={exports:{}};return t(e,e.exports),e.exports}Mt.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,r=[],n=this.toBBox;if(!Ft(t,e))return r;for(var i,o,s,a,l=[];e;){for(i=0,o=e.children.length;i<o;i++)s=e.children[i],Ft(t,a=e.leaf?n(s):s)&&(e.leaf?r.push(s):Nt(t,a)?this._all(s,r):l.push(s));e=l.pop()}return r},collides:function(t){var e=this.data,r=this.toBBox;if(!Ft(t,e))return!1;for(var n,i,o,s,a=[];e;){for(n=0,i=e.children.length;n<i;n++)if(o=e.children[n],Ft(t,s=e.leaf?r(o):o)){if(e.leaf||Nt(t,s))return!0;a.push(o)}e=a.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,r=t.length;e<r;e++)this.insert(t[e]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var i=this.data;this.data=n,n=i}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=Bt([]),this},remove:function(t,e){if(!t)return this;for(var r,n,i,o,s=this.data,a=this.toBBox(t),l=[],u=[];s||l.length;){if(s||(s=l.pop(),n=l[l.length-1],r=u.pop(),o=!0),s.leaf&&-1!==(i=At(t,s.children,e)))return s.children.splice(i,1),l.push(s),this._condense(l),this;o||s.leaf||!Nt(s,a)?n?(r++,s=n.children[r],o=!1):s=null:(l.push(s),u.push(r),r=0,n=s,s=s.children[0])}return this},toBBox:function(t){return t},compareMinX:zt,compareMinY:Dt,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var r=[];t;)t.leaf?e.push.apply(e,t.children):r.push.apply(r,t.children),t=r.pop();return e},_build:function(t,e,r,n){var i,o=r-e+1,s=this._maxEntries;if(o<=s)return Pt(i=Bt(t.slice(e,r+1)),this.toBBox),i;n||(n=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,n-1))),(i=Bt([])).leaf=!1,i.height=n;var a,l,u,c,h=Math.ceil(o/s),p=h*Math.ceil(Math.sqrt(s));for(jt(t,e,r,p,this.compareMinX),a=e;a<=r;a+=p)for(jt(t,a,u=Math.min(a+p-1,r),h,this.compareMinY),l=a;l<=u;l+=h)c=Math.min(l+h-1,u),i.children.push(this._build(t,l,c,n-1));return Pt(i,this.toBBox),i},_chooseSubtree:function(t,e,r,n){for(var i,o,s,a,l,u,c,h,p,f;n.push(e),!e.leaf&&n.length-1!==r;){for(c=h=1/0,i=0,o=e.children.length;i<o;i++)l=Rt(s=e.children[i]),p=t,f=s,(u=(Math.max(f.maxX,p.maxX)-Math.min(f.minX,p.minX))*(Math.max(f.maxY,p.maxY)-Math.min(f.minY,p.minY))-l)<h?(h=u,c=l<c?l:c,a=s):u===h&&l<c&&(c=l,a=s);e=a||e.children[0]}return e},_insert:function(t,e,r){var n=this.toBBox,i=r?t:n(t),o=[],s=this._chooseSubtree(i,this.data,e,o);for(s.children.push(t),Lt(s,i);e>=0&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(i,o,e)},_split:function(t,e){var r=t[e],n=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,n);var o=this._chooseSplitIndex(r,i,n),s=Bt(r.children.splice(o,r.children.length-o));s.height=r.height,s.leaf=r.leaf,Pt(r,this.toBBox),Pt(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(r,s)},_splitRoot:function(t,e){this.data=Bt([t,e]),this.data.height=t.height+1,this.data.leaf=!1,Pt(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,r){var n,i,o,s,a,l,u,c,h,p,f,d,m,g;for(l=u=1/0,n=e;n<=r-e;n++)i=kt(t,0,n,this.toBBox),o=kt(t,n,r,this.toBBox),h=i,p=o,f=void 0,d=void 0,m=void 0,g=void 0,f=Math.max(h.minX,p.minX),d=Math.max(h.minY,p.minY),m=Math.min(h.maxX,p.maxX),g=Math.min(h.maxY,p.maxY),s=Math.max(0,m-f)*Math.max(0,g-d),a=Rt(i)+Rt(o),s<l?(l=s,c=n,u=a<u?a:u):s===l&&a<u&&(u=a,c=n);return c},_chooseSplitAxis:function(t,e,r){var n=t.leaf?this.compareMinX:zt,i=t.leaf?this.compareMinY:Dt;this._allDistMargin(t,e,r,n)<this._allDistMargin(t,e,r,i)&&t.children.sort(n)},_allDistMargin:function(t,e,r,n){t.children.sort(n);var i,o,s=this.toBBox,a=kt(t,0,e,s),l=kt(t,r-e,r,s),u=Ot(a)+Ot(l);for(i=e;i<r-e;i++)o=t.children[i],Lt(a,t.leaf?s(o):o),u+=Ot(a);for(i=r-e-1;i>=e;i--)o=t.children[i],Lt(l,t.leaf?s(o):o),u+=Ot(l);return u},_adjustParentBBoxes:function(t,e,r){for(var n=r;n>=0;n--)Lt(e[n],t)},_condense:function(t){for(var e,r=t.length-1;r>=0;r--)0===t[r].children.length?r>0?(e=t[r-1].children).splice(e.indexOf(t[r]),1):this.clear():Pt(t[r],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}},Tt.default=Ct;var Vt=function(t,e,r){var n=t*e,i=Gt*t,o=i-(i-t),s=t-o,a=Gt*e,l=a-(a-e),u=e-l,c=s*u-(n-o*l-s*l-o*u);return r?(r[0]=c,r[1]=n,r):[c,n]},Gt=+(Math.pow(2,27)+1),qt=function(t,e){var r=0|t.length,n=0|e.length;if(1===r&&1===n)return function(t,e){var r=t+e,n=r-t,i=t-(r-n)+(e-n);return i?[i,r]:[r]}(t[0],e[0]);var i,o,s=new Array(r+n),a=0,l=0,u=0,c=Math.abs,h=t[l],p=c(h),f=e[u],d=c(f);p<d?(o=h,(l+=1)<r&&(h=t[l],p=c(h))):(o=f,(u+=1)<n&&(f=e[u],d=c(f))),l<r&&p<d||u>=n?(i=h,(l+=1)<r&&(h=t[l],p=c(h))):(i=f,(u+=1)<n&&(f=e[u],d=c(f)));for(var m,g,y=i+o,_=y-i,v=o-_,x=v,b=y;l<r&&u<n;)p<d?(i=h,(l+=1)<r&&(h=t[l],p=c(h))):(i=f,(u+=1)<n&&(f=e[u],d=c(f))),(v=(o=x)-(_=(y=i+o)-i))&&(s[a++]=v),x=b-((m=b+y)-(g=m-b))+(y-g),b=m;for(;l<r;)(v=(o=x)-(_=(y=(i=h)+o)-i))&&(s[a++]=v),x=b-((m=b+y)-(g=m-b))+(y-g),b=m,(l+=1)<r&&(h=t[l]);for(;u<n;)(v=(o=x)-(_=(y=(i=f)+o)-i))&&(s[a++]=v),x=b-((m=b+y)-(g=m-b))+(y-g),b=m,(u+=1)<n&&(f=e[u]);return x&&(s[a++]=x),b&&(s[a++]=b),a||(s[a++]=0),s.length=a,s},$t=function(t,e,r){var n=t+e,i=n-t,o=e-i,s=t-(n-i);return r?(r[0]=s+o,r[1]=n,r):[s+o,n]},Zt=function(t,e){var r=t.length;if(1===r){var n=Vt(t[0],e);return n[0]?n:[n[1]]}var i=new Array(2*r),o=[.1,.1],s=[.1,.1],a=0;Vt(t[0],e,o),o[0]&&(i[a++]=o[0]);for(var l=1;l<r;++l){Vt(t[l],e,s);var u=o[1];$t(u,s[0],o),o[0]&&(i[a++]=o[0]);var c=s[1],h=o[1],p=c+h,f=h-(p-c);o[1]=p,f&&(i[a++]=f)}return o[1]&&(i[a++]=o[1]),0===a&&(i[a++]=0),i.length=a,i},Xt=function(t,e){var r=0|t.length,n=0|e.length;if(1===r&&1===n)return function(t,e){var r=t+e,n=r-t,i=t-(r-n)+(e-n);return i?[i,r]:[r]}(t[0],-e[0]);var i,o,s=new Array(r+n),a=0,l=0,u=0,c=Math.abs,h=t[l],p=c(h),f=-e[u],d=c(f);p<d?(o=h,(l+=1)<r&&(h=t[l],p=c(h))):(o=f,(u+=1)<n&&(f=-e[u],d=c(f))),l<r&&p<d||u>=n?(i=h,(l+=1)<r&&(h=t[l],p=c(h))):(i=f,(u+=1)<n&&(f=-e[u],d=c(f)));for(var m,g,y=i+o,_=y-i,v=o-_,x=v,b=y;l<r&&u<n;)p<d?(i=h,(l+=1)<r&&(h=t[l],p=c(h))):(i=f,(u+=1)<n&&(f=-e[u],d=c(f))),(v=(o=x)-(_=(y=i+o)-i))&&(s[a++]=v),x=b-((m=b+y)-(g=m-b))+(y-g),b=m;for(;l<r;)(v=(o=x)-(_=(y=(i=h)+o)-i))&&(s[a++]=v),x=b-((m=b+y)-(g=m-b))+(y-g),b=m,(l+=1)<r&&(h=t[l]);for(;u<n;)(v=(o=x)-(_=(y=(i=f)+o)-i))&&(s[a++]=v),x=b-((m=b+y)-(g=m-b))+(y-g),b=m,(u+=1)<n&&(f=-e[u]);return x&&(s[a++]=x),b&&(s[a++]=b),a||(s[a++]=0),s.length=a,s},Wt=Ut(function(t){function e(t,e){for(var r=new Array(t.length-1),n=1;n<t.length;++n)for(var i=r[n-1]=new Array(t.length-1),o=0,s=0;o<t.length;++o)o!==e&&(i[s++]=t[n][o]);return r}function r(t){if(1===t.length)return t[0];if(2===t.length)return["sum(",t[0],",",t[1],")"].join("");var e=t.length>>1;return["sum(",r(t.slice(0,e)),",",r(t.slice(e)),")"].join("")}function n(t){if(2===t.length)return[["sum(prod(",t[0][0],",",t[1][1],"),prod(-",t[0][1],",",t[1][0],"))"].join("")];for(var i=[],o=0;o<t.length;++o)i.push(["scale(",r(n(e(t,o))),",",(s=o,1&s?"-":""),t[0][o],")"].join(""));return i;var s}function i(t){for(var i=[],o=[],s=function(t){for(var e=new Array(t),r=0;r<t;++r){e[r]=new Array(t);for(var n=0;n<t;++n)e[r][n]=["m",n,"[",t-r-1,"]"].join("")}return e}(t),a=[],l=0;l<t;++l)0==(1&l)?i.push.apply(i,n(e(s,l))):o.push.apply(o,n(e(s,l))),a.push("m"+l);var u=r(i),c=r(o),h="orientation"+t+"Exact",p=["function ",h,"(",a.join(),"){var p=",u,",n=",c,",d=sub(p,n);return d[d.length-1];};return ",h].join("");return new Function("sum","prod","scale","sub",p)(qt,Vt,Zt,Xt)}var o=i(3),s=i(4),a=[function(){return 0},function(){return 0},function(t,e){return e[0]-t[0]},function(t,e,r){var n,i=(t[1]-r[1])*(e[0]-r[0]),s=(t[0]-r[0])*(e[1]-r[1]),a=i-s;if(i>0){if(s<=0)return a;n=i+s}else{if(!(i<0))return a;if(s>=0)return a;n=-(i+s)}var l=3.3306690738754716e-16*n;return a>=l||a<=-l?a:o(t,e,r)},function(t,e,r,n){var i=t[0]-n[0],o=e[0]-n[0],a=r[0]-n[0],l=t[1]-n[1],u=e[1]-n[1],c=r[1]-n[1],h=t[2]-n[2],p=e[2]-n[2],f=r[2]-n[2],d=o*c,m=a*u,g=a*l,y=i*c,_=i*u,v=o*l,x=h*(d-m)+p*(g-y)+f*(_-v),b=7.771561172376103e-16*((Math.abs(d)+Math.abs(m))*Math.abs(h)+(Math.abs(g)+Math.abs(y))*Math.abs(p)+(Math.abs(_)+Math.abs(v))*Math.abs(f));return x>b||-x>b?x:s(t,e,r,n)}];function l(t){var e=a[t.length];return e||(e=a[t.length]=i(t.length)),e.apply(void 0,t)}!function(){for(;a.length<=5;)a.push(i(a.length));for(var e=[],r=["slow"],n=0;n<=5;++n)e.push("a"+n),r.push("o"+n);var o=["function getOrientation(",e.join(),"){switch(arguments.length){case 0:case 1:return 0;"];for(n=2;n<=5;++n)o.push("case ",n,":return o",n,"(",e.slice(0,n).join(),");");o.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return getOrientation"),r.push(o.join(""));var s=Function.apply(void 0,r);for(t.exports=s.apply(void 0,[l].concat(a)),n=0;n<=5;++n)t.exports[n]=a[n]}()}),Yt=function(t){var e=t.length;if(e<3){for(var r=new Array(e),n=0;n<e;++n)r[n]=n;return 2===e&&t[0][0]===t[1][0]&&t[0][1]===t[1][1]?[0]:r}var i=new Array(e);for(n=0;n<e;++n)i[n]=n;i.sort(function(e,r){var n=t[e][0]-t[r][0];return n||t[e][1]-t[r][1]});var o=[i[0],i[1]],s=[i[0],i[1]];for(n=2;n<e;++n){for(var a=i[n],l=t[a],u=o.length;u>1&&Ht(t[o[u-2]],t[o[u-1]],l)<=0;)u-=1,o.pop();for(o.push(a),u=s.length;u>1&&Ht(t[s[u-2]],t[s[u-1]],l)>=0;)u-=1,s.pop();s.push(a)}r=new Array(s.length+o.length-2);for(var c=0,h=(n=0,o.length);n<h;++n)r[c++]=o[n];for(var p=s.length-2;p>0;--p)r[c++]=s[p];return r},Ht=Wt[3],Jt=Qt,Kt=Qt;function Qt(t,e){if(!(this instanceof Qt))return new Qt(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||te,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)}function te(t,e){return t<e?-1:t>e?1:0}Qt.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,r=this.compare,n=e[t];t>0;){var i=t-1>>1,o=e[i];if(r(n,o)>=0)break;e[t]=o,t=i}e[t]=n},_down:function(t){for(var e=this.data,r=this.compare,n=this.length>>1,i=e[t];t<n;){var o=1+(t<<1),s=o+1,a=e[o];if(s<this.length&&r(e[s],a)<0&&(o=s,a=e[s]),r(a,i)>=0)break;e[t]=a,t=o}e[t]=i}},Jt.default=Kt;var ee=function(t,e){for(var r=t[0],n=t[1],i=!1,o=0,s=e.length-1;o<e.length;s=o++){var a=e[o][0],l=e[o][1],u=e[s][0],c=e[s][1];l>n!=c>n&&r<(u-a)*(n-l)/(c-l)+a&&(i=!i)}return i},re=Wt[3],ne=oe,ie=oe;function oe(t,e,r){e=Math.max(0,void 0===e?2:e),r=r||0;for(var n,i=function(t){for(var e=t[0],r=t[0],n=t[0],i=t[0],o=0;o<t.length;o++){var s=t[o];s[0]<e[0]&&(e=s),s[0]>n[0]&&(n=s),s[1]<r[1]&&(r=s),s[1]>i[1]&&(i=s)}var a=[e,r,n,i],l=a.slice();for(o=0;o<t.length;o++)ee(t[o],a)||l.push(t[o]);var u=Yt(l),c=[];for(o=0;o<u.length;o++)c.push(l[u[o]]);return c}(t),o=Tt(16,["[0]","[1]","[0]","[1]"]).load(t),s=[],a=0;a<i.length;a++){var l=i[a];o.remove(l),n=pe(l,n),s.push(n)}var u=Tt(16);for(a=0;a<s.length;a++)u.insert(he(s[a]));for(var c=e*e,h=r*r;s.length;){var p=s.shift(),f=p.p,d=p.next.p,m=fe(f,d);if(!(m<h)){var g=m/c;(l=se(o,p.prev.p,f,d,p.next.next.p,g,u))&&Math.min(fe(l,f),fe(l,d))<=g&&(s.push(p),s.push(pe(l,p)),o.remove(l),u.remove(p),u.insert(he(p)),u.insert(he(p.next)))}}p=n;var y=[];do{y.push(p.p),p=p.next}while(p!==n);return y.push(p.p),y}function se(t,e,r,n,i,o,s){for(var a=new Jt(null,ae),l=t.data;l;){for(var u=0;u<l.children.length;u++){var c=l.children[u],h=l.leaf?de(c,r,n):le(r,n,c);h>o||a.push({node:c,dist:h})}for(;a.length&&!a.peek().node.children;){var p=a.pop(),f=p.node,d=de(f,e,r),m=de(f,n,i);if(p.dist<d&&p.dist<m&&ce(r,f,s)&&ce(n,f,s))return f}(l=a.pop())&&(l=l.node)}return null}function ae(t,e){return t.dist-e.dist}function le(t,e,r){if(ue(t,r)||ue(e,r))return 0;var n=me(t[0],t[1],e[0],e[1],r.minX,r.minY,r.maxX,r.minY);if(0===n)return 0;var i=me(t[0],t[1],e[0],e[1],r.minX,r.minY,r.minX,r.maxY);if(0===i)return 0;var o=me(t[0],t[1],e[0],e[1],r.maxX,r.minY,r.maxX,r.maxY);if(0===o)return 0;var s=me(t[0],t[1],e[0],e[1],r.minX,r.maxY,r.maxX,r.maxY);return 0===s?0:Math.min(n,i,o,s)}function ue(t,e){return t[0]>=e.minX&&t[0]<=e.maxX&&t[1]>=e.minY&&t[1]<=e.maxY}function ce(t,e,r){for(var n,i,o,s,a=Math.min(t[0],e[0]),l=Math.min(t[1],e[1]),u=Math.max(t[0],e[0]),c=Math.max(t[1],e[1]),h=r.search({minX:a,minY:l,maxX:u,maxY:c}),p=0;p<h.length;p++)if(n=h[p].p,i=h[p].next.p,o=t,n!==(s=e)&&i!==o&&re(n,i,o)>0!=re(n,i,s)>0&&re(o,s,n)>0!=re(o,s,i)>0)return!1;return!0}function he(t){var e=t.p,r=t.next.p;return t.minX=Math.min(e[0],r[0]),t.minY=Math.min(e[1],r[1]),t.maxX=Math.max(e[0],r[0]),t.maxY=Math.max(e[1],r[1]),t}function pe(t,e){var r={p:t,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return e?(r.next=e.next,r.prev=e,e.next.prev=r,e.next=r):(r.prev=r,r.next=r),r}function fe(t,e){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}function de(t,e,r){var n=e[0],i=e[1],o=r[0]-n,s=r[1]-i;if(0!==o||0!==s){var a=((t[0]-n)*o+(t[1]-i)*s)/(o*o+s*s);a>1?(n=r[0],i=r[1]):a>0&&(n+=o*a,i+=s*a)}return(o=t[0]-n)*o+(s=t[1]-i)*s}function me(t,e,r,n,i,o,s,a){var l,u,c,h,p=r-t,f=n-e,d=s-i,m=a-o,g=t-i,y=e-o,_=p*p+f*f,v=p*d+f*m,x=d*d+m*m,b=p*g+f*y,w=d*g+m*y,E=_*x-v*v,S=E,I=E;0===E?(u=0,S=1,h=w,I=x):(h=_*w-v*b,(u=v*w-x*b)<0?(u=0,h=w,I=x):u>S&&(u=S,h=w+v,I=x)),h<0?(h=0,-b<0?u=0:-b>_?u=S:(u=-b,S=_)):h>I&&(h=I,-b+v<0?u=0:-b+v>_?u=S:(u=-b+v,S=_));var T=(1-(c=0===h?0:h/I))*i+c*s-((1-(l=0===u?0:u/S))*t+l*r),C=(1-c)*o+c*a-((1-l)*e+l*n);return T*T+C*C}function ge(t,e){void 0===e&&(e={}),e.concavity=e.concavity||1/0;var r=[];if(z(t,function(t){r.push([t[0],t[1]])}),!r.length)return null;var n=ne(r,e.concavity);return n.length>3?c([n]):null}function ye(t,e,r){if(void 0===r&&(r={}),!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");var n=K(t),i=it(e),o=i.type,s=e.bbox,a=i.coordinates;if(s&&!1===function(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}(n,s))return!1;"Polygon"===o&&(a=[a]);for(var l=!1,u=0;u<a.length&&!l;u++)if(_e(n,a[u][0],r.ignoreBoundary)){for(var c=!1,h=1;h<a[u].length&&!c;)_e(n,a[u][h],!r.ignoreBoundary)&&(c=!0),h++;c||(l=!0)}return l}function _e(t,e,r){var n=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var i=0,o=e.length-1;i<e.length;o=i++){var s=e[i][0],a=e[i][1],l=e[o][0],u=e[o][1];if(t[1]*(s-l)+a*(l-t[0])+u*(t[0]-s)==0&&(s-t[0])*(l-t[0])<=0&&(a-t[1])*(u-t[1])<=0)return!r;a>t[1]!=u>t[1]&&t[0]<(l-s)*(t[1]-a)/(u-a)+s&&(n=!n)}return n}function ve(t,e){var r=[];return N(t,function(t){var n=!1;if("Point"===t.geometry.type)j(e,function(e){ye(t,e)&&(n=!0)}),n&&r.push(t);else{if("MultiPoint"!==t.geometry.type)throw new Error("Input geometry must be a Point or MultiPoint");var i=[];j(e,function(e){z(t,function(t){ye(t,e)&&(n=!0,i.push(t))})}),n&&r.push(g(i))}}),d(r)}function xe(t,e,r){void 0===r&&(r={});var n=K(t),i=K(e),o=I(i[1]-n[1]),s=I(i[0]-n[0]),a=I(n[1]),l=I(i[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return x(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),r.units)}function be(t,e){var r=!1;return d(function(t){if(t.length<3)return[];t.sort(Ee);for(var e,r,n,i,o,s,a=t.length-1,l=t[a].x,u=t[0].x,c=t[a].y,h=c,p=1e-12;a--;)t[a].y<c&&(c=t[a].y),t[a].y>h&&(h=t[a].y);var f,d=u-l,m=h-c,g=d>m?d:m,y=.5*(u+l),_=.5*(h+c),v=[new we({__sentinel:!0,x:y-20*g,y:_-g},{__sentinel:!0,x:y,y:_+20*g},{__sentinel:!0,x:y+20*g,y:_-g})],x=[],b=[];for(a=t.length;a--;){for(b.length=0,f=v.length;f--;)(d=t[a].x-v[f].x)>0&&d*d>v[f].r?(x.push(v[f]),v.splice(f,1)):d*d+(m=t[a].y-v[f].y)*m>v[f].r||(b.push(v[f].a,v[f].b,v[f].b,v[f].c,v[f].c,v[f].a),v.splice(f,1));for(Se(b),f=b.length;f;)r=b[--f],e=b[--f],n=t[a],i=r.x-e.x,o=r.y-e.y,s=2*(i*(n.y-r.y)-o*(n.x-r.x)),Math.abs(s)>p&&v.push(new we(e,r,n))}for(Array.prototype.push.apply(x,v),a=x.length;a--;)(x[a].a.__sentinel||x[a].b.__sentinel||x[a].c.__sentinel)&&x.splice(a,1);return x}(t.features.map(function(t){var n={x:t.geometry.coordinates[0],y:t.geometry.coordinates[1]};return e?n.z=t.properties[e]:3===t.geometry.coordinates.length&&(r=!0,n.z=t.geometry.coordinates[2]),n})).map(function(t){var e=[t.a.x,t.a.y],n=[t.b.x,t.b.y],i=[t.c.x,t.c.y],o={};return r?(e.push(t.a.z),n.push(t.b.z),i.push(t.c.z)):o={a:t.a.z,b:t.b.z,c:t.c.z},c([[e,n,i,e]],o)}))}ne.default=ie;var we=function(t,e,r){this.a=t,this.b=e,this.c=r;var n,i,o=e.x-t.x,s=e.y-t.y,a=r.x-t.x,l=r.y-t.y,u=o*(t.x+e.x)+s*(t.y+e.y),c=a*(t.x+r.x)+l*(t.y+r.y),h=2*(o*(r.y-e.y)-s*(r.x-e.x));this.x=(l*u-s*c)/h,this.y=(o*c-a*u)/h,n=this.x-t.x,i=this.y-t.y,this.r=n*n+i*i};function Ee(t,e){return e.x-t.x}function Se(t){var e,r,n,i,o,s=t.length;t:for(;s;)for(r=t[--s],e=t[--s],n=s;n;)if(o=t[--n],e===(i=t[--n])&&r===o||e===o&&r===i){t.splice(s,2),t.splice(n,2),s-=2;continue t}}function Ie(t){if(!t)throw new Error("geojson is required");switch(t.type){case"Feature":return Te(t);case"FeatureCollection":return function(t){var e={type:"FeatureCollection"};return Object.keys(t).forEach(function(r){switch(r){case"type":case"features":return;default:e[r]=t[r]}}),e.features=t.features.map(function(t){return Te(t)}),e}(t);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return Me(t);default:throw new Error("unknown GeoJSON type")}}function Te(t){var e={type:"Feature"};return Object.keys(t).forEach(function(r){switch(r){case"type":case"properties":case"geometry":return;default:e[r]=t[r]}}),e.properties=Ce(t.properties),e.geometry=Me(t.geometry),e}function Ce(t){var e={};return t?(Object.keys(t).forEach(function(r){var n=t[r];"object"==typeof n?null===n?e[r]=null:Array.isArray(n)?e[r]=n.map(function(t){return t}):e[r]=Ce(n):e[r]=n}),e):e}function Me(t){var e={type:t.type};return t.bbox&&(e.bbox=t.bbox),"GeometryCollection"===t.type?(e.geometries=t.geometries.map(function(t){return Me(t)}),e):(e.coordinates=Ae(t.coordinates),e)}function Ae(t){var e=t;return"object"!=typeof e[0]?e.slice():e.map(function(t){return Ae(t)})}function Pe(t,e){if(void 0===e&&(e={}),!A(e=e||{}))throw new Error("options is invalid");var r=e.mutate;if("FeatureCollection"!==ot(t))throw new Error("geojson must be a FeatureCollection");if(!t.features.length)throw new Error("geojson is empty");!1!==r&&void 0!==r||(t=Ie(t));var n=[],i=X(t,function(t,e){var r=function(t,e){var r,n=t.geometry.coordinates,i=e.geometry.coordinates,o=ke(n[0]),s=ke(n[n.length-1]),a=ke(i[0]),l=ke(i[i.length-1]);if(o===l)r=i.concat(n.slice(1));else if(a===s)r=n.concat(i.slice(1));else if(o===a)r=n.slice(1).reverse().concat(i);else{if(s!==l)return null;r=n.concat(i.reverse().slice(1))}return p(r)}(t,e);return r||(n.push(t),e)});return i&&n.push(i),n.length?1===n.length?n[0]:m(n.map(function(t){return t.coordinates})):null}function ke(t){return t[0].toString()+","+t[1].toString()}function Le(t){return t}function ze(t,e){var r=function(t){if(null==t)return Le;var e,r,n=t.scale[0],i=t.scale[1],o=t.translate[0],s=t.translate[1];return function(t,a){a||(e=r=0);var l=2,u=t.length,c=new Array(u);for(c[0]=(e+=t[0])*n+o,c[1]=(r+=t[1])*i+s;l<u;)c[l]=t[l],++l;return c}}(t.transform),n=t.arcs;function i(t,e){e.length&&e.pop();for(var i=n[t<0?~t:t],o=0,s=i.length;o<s;++o)e.push(r(i[o],o));t<0&&function(t,e){for(var r,n=t.length,i=n-e;i<--n;)r=t[i],t[i++]=t[n],t[n]=r}(e,s)}function o(t){return r(t)}function s(t){for(var e=[],r=0,n=t.length;r<n;++r)i(t[r],e);return e.length<2&&e.push(e[0]),e}function a(t){for(var e=s(t);e.length<4;)e.push(e[0]);return e}function l(t){return t.map(a)}return function t(e){var r,n=e.type;switch(n){case"GeometryCollection":return{type:n,geometries:e.geometries.map(t)};case"Point":r=o(e.coordinates);break;case"MultiPoint":r=e.coordinates.map(o);break;case"LineString":r=s(e.arcs);break;case"MultiLineString":r=e.arcs.map(s);break;case"Polygon":r=l(e.arcs);break;case"MultiPolygon":r=e.arcs.map(l);break;default:return null}return{type:n,coordinates:r}}(e)}function De(t,e){var r={},n={},i={},o=[],s=-1;function a(t,e){for(var n in t){var i=t[n];delete e[i.start],delete i.start,delete i.end,i.forEach(function(t){r[t<0?~t:t]=1}),o.push(i)}}return e.forEach(function(r,n){var i,o=t.arcs[r<0?~r:r];o.length<3&&!o[1][0]&&!o[1][1]&&(i=e[++s],e[s]=r,e[n]=i)}),e.forEach(function(e){var r,o,s=function(e){var r,n=t.arcs[e<0?~e:e],i=n[0];return t.transform?(r=[0,0],n.forEach(function(t){r[0]+=t[0],r[1]+=t[1]})):r=n[n.length-1],e<0?[r,i]:[i,r]}(e),a=s[0],l=s[1];if(r=i[a])if(delete i[r.end],r.push(e),r.end=l,o=n[l]){delete n[o.start];var u=o===r?r:r.concat(o);n[u.start=r.start]=i[u.end=o.end]=u}else n[r.start]=i[r.end]=r;else if(r=n[l])if(delete n[r.start],r.unshift(e),r.start=a,o=i[a]){delete i[o.end];var c=o===r?r:o.concat(r);n[c.start=o.start]=i[c.end=r.end]=c}else n[r.start]=i[r.end]=r;else n[(r=[e]).start=a]=i[r.end=l]=r}),a(i,n),a(n,i),e.forEach(function(t){r[t<0?~t:t]||o.push([t])}),o}function Re(t,e){var r={},n=[],i=[];function o(t){t.forEach(function(e){e.forEach(function(e){(r[e=e<0?~e:e]||(r[e]=[])).push(t)})}),n.push(t)}function s(e){return function(t){for(var e,r=-1,n=t.length,i=t[n-1],o=0;++r<n;)e=i,i=t[r],o+=e[0]*i[1]-e[1]*i[0];return Math.abs(o)}(ze(t,{type:"Polygon",arcs:[e]}).coordinates[0])}return e.forEach(function t(e){switch(e.type){case"GeometryCollection":e.geometries.forEach(t);break;case"Polygon":o(e.arcs);break;case"MultiPolygon":e.arcs.forEach(o)}}),n.forEach(function(t){if(!t._){var e=[],n=[t];for(t._=1,i.push(e);t=n.pop();)e.push(t),t.forEach(function(t){t.forEach(function(t){r[t<0?~t:t].forEach(function(t){t._||(t._=1,n.push(t))})})})}}),n.forEach(function(t){delete t._}),{type:"MultiPolygon",arcs:i.map(function(e){var n,i=[];if(e.forEach(function(t){t.forEach(function(t){t.forEach(function(t){r[t<0?~t:t].length<2&&i.push(t)})})}),(n=(i=De(t,i)).length)>1)for(var o,a,l=1,u=s(i[0]);l<n;++l)(o=s(i[l]))>u&&(a=i[0],i[0]=i[l],i[l]=a,u=o);return i}).filter(function(t){return t.length>0})}}var Oe=Object.prototype.hasOwnProperty;function Ne(t,e,r,n,i,o){3===arguments.length&&(n=o=Array,i=null);for(var s=new n(t=1<<Math.max(4,Math.ceil(Math.log(t)/Math.LN2))),a=new o(t),l=t-1,u=0;u<t;++u)s[u]=i;function c(n,o){for(var u=e(n)&l,c=s[u],h=0;c!=i;){if(r(c,n))return a[u]=o;if(++h>=t)throw new Error("full hashmap");c=s[u=u+1&l]}return s[u]=n,a[u]=o,o}function h(n,o){for(var u=e(n)&l,c=s[u],h=0;c!=i;){if(r(c,n))return a[u];if(++h>=t)throw new Error("full hashmap");c=s[u=u+1&l]}return s[u]=n,a[u]=o,o}function p(n,o){for(var u=e(n)&l,c=s[u],h=0;c!=i;){if(r(c,n))return a[u];if(++h>=t)break;c=s[u=u+1&l]}return o}function f(){for(var t=[],e=0,r=s.length;e<r;++e){var n=s[e];n!=i&&t.push(n)}return t}return{set:c,maybeSet:h,get:p,keys:f}}function Fe(t,e){return t[0]===e[0]&&t[1]===e[1]}var Be=new ArrayBuffer(16),je=new Float64Array(Be),Ue=new Uint32Array(Be);function Ve(t){je[0]=t[0],je[1]=t[1];var e=Ue[0]^Ue[1];return 2147483647&(e<<5^e>>7^Ue[2]^Ue[3])}function Ge(t){var e,r,n,i,o=t.coordinates,s=t.lines,a=t.rings,l=function(){for(var t=Ne(1.4*o.length,b,w,Int32Array,-1,Int32Array),e=new Int32Array(o.length),r=0,n=o.length;r<n;++r)e[r]=t.maybeSet(r,r);return e}(),u=new Int32Array(o.length),c=new Int32Array(o.length),h=new Int32Array(o.length),p=new Int8Array(o.length),f=0;for(e=0,r=o.length;e<r;++e)u[e]=c[e]=h[e]=-1;for(e=0,r=s.length;e<r;++e){var d=s[e],m=d[0],g=d[1];for(n=l[m],i=l[++m],++f,p[n]=1;++m<=g;)x(e,n,n=i,i=l[m]);++f,p[i]=1}for(e=0,r=o.length;e<r;++e)u[e]=-1;for(e=0,r=a.length;e<r;++e){var y=a[e],_=y[0]+1,v=y[1];for(x(e,l[v-1],n=l[_-1],i=l[_]);++_<=v;)x(e,n,n=i,i=l[_])}function x(t,e,r,n){if(u[r]!==t){u[r]=t;var i=c[r];if(i>=0){var o=h[r];i===e&&o===n||i===n&&o===e||(++f,p[r]=1)}else c[r]=e,h[r]=n}}function b(t){return Ve(o[t])}function w(t,e){return Fe(o[t],o[e])}u=c=h=null;var E,S=function(t,e,r,n,i){3===arguments.length&&(n=Array,i=null);for(var o=new n(t=1<<Math.max(4,Math.ceil(Math.log(t)/Math.LN2))),s=t-1,a=0;a<t;++a)o[a]=i;function l(n){for(var a=e(n)&s,l=o[a],u=0;l!=i;){if(r(l,n))return!0;if(++u>=t)throw new Error("full hashset");l=o[a=a+1&s]}return o[a]=n,!0}function u(n){for(var a=e(n)&s,l=o[a],u=0;l!=i;){if(r(l,n))return!0;if(++u>=t)break;l=o[a=a+1&s]}return!1}function c(){for(var t=[],e=0,r=o.length;e<r;++e){var n=o[e];n!=i&&t.push(n)}return t}return{add:l,has:u,values:c}}(1.4*f,Ve,Fe);for(e=0,r=o.length;e<r;++e)p[E=l[e]]&&S.add(o[E]);return S}function qe(t,e,r,n){$e(t,e,r),$e(t,e,e+n),$e(t,e+n,r)}function $e(t,e,r){for(var n,i=e+(r---e>>1);e<i;++e,--r)n=t[e],t[e]=t[r],t[r]=n}function Ze(t){var e,r,n={};for(e in t)n[e]=null==(r=t[e])?{type:null}:("FeatureCollection"===r.type?Xe:"Feature"===r.type?We:Ye)(r);return n}function Xe(t){var e={type:"GeometryCollection",geometries:t.features.map(We)};return null!=t.bbox&&(e.bbox=t.bbox),e}function We(t){var e,r=Ye(t.geometry);for(e in null!=t.id&&(r.id=t.id),null!=t.bbox&&(r.bbox=t.bbox),t.properties){r.properties=t.properties;break}return r}function Ye(t){if(null==t)return{type:null};var e="GeometryCollection"===t.type?{type:"GeometryCollection",geometries:t.geometries.map(Ye)}:"Point"===t.type||"MultiPoint"===t.type?{type:t.type,coordinates:t.coordinates}:{type:t.type,arcs:t.coordinates};return null!=t.bbox&&(e.bbox=t.bbox),e}function He(t,e){var r=function(t){var e=1/0,r=1/0,n=-1/0,i=-1/0;function o(t){null!=t&&Oe.call(s,t.type)&&s[t.type](t)}var s={GeometryCollection:function(t){t.geometries.forEach(o)},Point:function(t){a(t.coordinates)},MultiPoint:function(t){t.coordinates.forEach(a)},LineString:function(t){l(t.arcs)},MultiLineString:function(t){t.arcs.forEach(l)},Polygon:function(t){t.arcs.forEach(l)},MultiPolygon:function(t){t.arcs.forEach(u)}};function a(t){var o=t[0],s=t[1];o<e&&(e=o),o>n&&(n=o),s<r&&(r=s),s>i&&(i=s)}function l(t){t.forEach(a)}function u(t){t.forEach(l)}for(var c in t)o(t[c]);return n>=e&&i>=r?[e,r,n,i]:void 0}(t=Ze(t)),n=e>0&&r&&function(t,e,r){var n=e[0],i=e[1],o=e[2],s=e[3],a=o-n?(r-1)/(o-n):1,l=s-i?(r-1)/(s-i):1;function u(t){return[Math.round((t[0]-n)*a),Math.round((t[1]-i)*l)]}function c(t,e){for(var r,o,s,u,c,h=-1,p=0,f=t.length,d=new Array(f);++h<f;)r=t[h],u=Math.round((r[0]-n)*a),c=Math.round((r[1]-i)*l),u===o&&c===s||(d[p++]=[o=u,s=c]);for(d.length=p;p<e;)p=d.push([d[0][0],d[0][1]]);return d}function h(t){return c(t,2)}function p(t){return c(t,4)}function f(t){return t.map(p)}function d(t){null!=t&&Oe.call(m,t.type)&&m[t.type](t)}var m={GeometryCollection:function(t){t.geometries.forEach(d)},Point:function(t){t.coordinates=u(t.coordinates)},MultiPoint:function(t){t.coordinates=t.coordinates.map(u)},LineString:function(t){t.arcs=h(t.arcs)},MultiLineString:function(t){t.arcs=t.arcs.map(h)},Polygon:function(t){t.arcs=f(t.arcs)},MultiPolygon:function(t){t.arcs=t.arcs.map(f)}};for(var g in t)d(t[g]);return{scale:[1/a,1/l],translate:[n,i]}}(t,r,e),i=function(t){var e,r,n,i,o=t.coordinates,s=t.lines,a=t.rings,l=s.length+a.length;for(delete t.lines,delete t.rings,n=0,i=s.length;n<i;++n)for(e=s[n];e=e.next;)++l;for(n=0,i=a.length;n<i;++n)for(r=a[n];r=r.next;)++l;var u=Ne(2*l*1.4,Ve,Fe),c=t.arcs=[];for(n=0,i=s.length;n<i;++n){e=s[n];do{h(e)}while(e=e.next)}for(n=0,i=a.length;n<i;++n)if((r=a[n]).next)do{h(r)}while(r=r.next);else p(r);function h(t){var e,r,n,i,s,a,l,h;if(n=u.get(e=o[t[0]]))for(l=0,h=n.length;l<h;++l)if(f(i=n[l],t))return t[0]=i[0],void(t[1]=i[1]);if(s=u.get(r=o[t[1]]))for(l=0,h=s.length;l<h;++l)if(d(a=s[l],t))return t[1]=a[0],void(t[0]=a[1]);n?n.push(t):u.set(e,[t]),s?s.push(t):u.set(r,[t]),c.push(t)}function p(t){var e,r,n,i,s;if(r=u.get(o[t[0]]))for(i=0,s=r.length;i<s;++i){if(m(n=r[i],t))return t[0]=n[0],void(t[1]=n[1]);if(g(n,t))return t[0]=n[1],void(t[1]=n[0])}if(r=u.get(e=o[t[0]+y(t)]))for(i=0,s=r.length;i<s;++i){if(m(n=r[i],t))return t[0]=n[0],void(t[1]=n[1]);if(g(n,t))return t[0]=n[1],void(t[1]=n[0])}r?r.push(t):u.set(e,[t]),c.push(t)}function f(t,e){var r=t[0],n=e[0],i=t[1];if(r-i!=n-e[1])return!1;for(;r<=i;++r,++n)if(!Fe(o[r],o[n]))return!1;return!0}function d(t,e){var r=t[0],n=e[0],i=t[1],s=e[1];if(r-i!=n-s)return!1;for(;r<=i;++r,--s)if(!Fe(o[r],o[s]))return!1;return!0}function m(t,e){var r=t[0],n=e[0],i=t[1]-r;if(i!==e[1]-n)return!1;for(var s=y(t),a=y(e),l=0;l<i;++l)if(!Fe(o[r+(l+s)%i],o[n+(l+a)%i]))return!1;return!0}function g(t,e){var r=t[0],n=e[0],i=t[1],s=e[1],a=i-r;if(a!==s-n)return!1;for(var l=y(t),u=a-y(e),c=0;c<a;++c)if(!Fe(o[r+(c+l)%a],o[s-(c+u)%a]))return!1;return!0}function y(t){for(var e=t[0],r=t[1],n=e,i=n,s=o[n];++n<r;){var a=o[n];(a[0]<s[0]||a[0]===s[0]&&a[1]<s[1])&&(i=n,s=a)}return i-e}return t}(function(t){var e,r,n,i=Ge(t),o=t.coordinates,s=t.lines,a=t.rings;for(r=0,n=s.length;r<n;++r)for(var l=s[r],u=l[0],c=l[1];++u<c;)i.has(o[u])&&(e={0:u,1:l[1]},l[1]=u,l=l.next=e);for(r=0,n=a.length;r<n;++r)for(var h=a[r],p=h[0],f=p,d=h[1],m=i.has(o[p]);++f<d;)i.has(o[f])&&(m?(e={0:f,1:h[1]},h[1]=f,h=h.next=e):(qe(o,p,d,d-f),o[d]=o[p],m=!0,f=p));return t}(function(t){var e=-1,r=[],n=[],i=[];function o(t){t&&Oe.call(s,t.type)&&s[t.type](t)}var s={GeometryCollection:function(t){t.geometries.forEach(o)},LineString:function(t){t.arcs=a(t.arcs)},MultiLineString:function(t){t.arcs=t.arcs.map(a)},Polygon:function(t){t.arcs=t.arcs.map(l)},MultiPolygon:function(t){t.arcs=t.arcs.map(u)}};function a(t){for(var n=0,o=t.length;n<o;++n)i[++e]=t[n];var s={0:e-o+1,1:e};return r.push(s),s}function l(t){for(var r=0,o=t.length;r<o;++r)i[++e]=t[r];var s={0:e-o+1,1:e};return n.push(s),s}function u(t){return t.map(l)}for(var c in t)o(t[c]);return{type:"Topology",coordinates:i,lines:r,rings:n,objects:t}}(t))),o=i.coordinates,s=Ne(1.4*i.arcs.length,Je,Ke);function a(t){t&&Oe.call(l,t.type)&&l[t.type](t)}t=i.objects,i.bbox=r,i.arcs=i.arcs.map(function(t,e){return s.set(t,e),o.slice(t[0],t[1]+1)}),delete i.coordinates,o=null;var l={GeometryCollection:function(t){t.geometries.forEach(a)},LineString:function(t){t.arcs=u(t.arcs)},MultiLineString:function(t){t.arcs=t.arcs.map(u)},Polygon:function(t){t.arcs=t.arcs.map(u)},MultiPolygon:function(t){t.arcs=t.arcs.map(c)}};function u(t){var e=[];do{var r=s.get(t);e.push(t[0]<t[1]?r:~r)}while(t=t.next);return e}function c(t){return t.map(u)}for(var h in t)a(t[h]);return n&&(i.transform=n,i.arcs=function(t){for(var e=-1,r=t.length;++e<r;){for(var n,i,o=t[e],s=0,a=1,l=o.length,u=o[0],c=u[0],h=u[1];++s<l;)n=(u=o[s])[0],i=u[1],n===c&&i===h||(o[a++]=[n-c,i-h],c=n,h=i);1===a&&(o[a++]=[0,0]),o.length=a}return t}(i.arcs)),i}function Je(t){var e,r=t[0],n=t[1];return n<r&&(e=r,r=n,n=e),r+31*n}function Ke(t,e){var r,n=t[0],i=t[1],o=e[0],s=e[1];return i<n&&(r=n,n=i,i=r),s<o&&(r=o,o=s,s=r),n===o&&i===s}function Qe(t,e){if(void 0===e&&(e={}),"FeatureCollection"!==ot(t))throw new Error("geojson must be a FeatureCollection");if(!t.features.length)throw new Error("geojson is empty");!1!==e.mutate&&void 0!==e.mutate||(t=Ie(t));var r=[];V(t,function(t){r.push(t.geometry)});var n=He({geoms:_(r).geometry});return function(t){return ze(t,Re.apply(this,arguments))}(n,n.objects.geoms.geometries)}function tr(t,e){if(void 0===e&&(e={}),!A(e=e||{}))throw new Error("options is invalid");var r=e.mutate;if("FeatureCollection"!==ot(t))throw new Error("geojson must be a FeatureCollection");if(!t.features.length)throw new Error("geojson is empty");!1!==r&&void 0!==r||(t=Ie(t));var n=function(t){var e={};V(t,function(t){e[t.geometry.type]=!0});var r=Object.keys(e);return 1===r.length?r[0]:null}(t);if(!n)throw new Error("geojson must be homogenous");var i=t;switch(n){case"LineString":return Pe(i,e);case"Polygon":return Qe(i,e);default:throw new Error(n+" is not supported")}}function er(t,e){void 0===e&&(e={});var r="object"==typeof e?e.mutate:e;if(!t)throw new Error("geojson is required");var n=ot(t),i=[];switch(n){case"LineString":i=rr(t);break;case"MultiLineString":case"Polygon":Q(t).forEach(function(t){i.push(rr(t))});break;case"MultiPolygon":Q(t).forEach(function(t){var e=[];t.forEach(function(t){e.push(rr(t))}),i.push(e)});break;case"Point":return t;case"MultiPoint":var o={};Q(t).forEach(function(t){var e=t.join("-");Object.prototype.hasOwnProperty.call(o,e)||(i.push(t),o[e]=!0)});break;default:throw new Error(n+" geometry not supported")}return t.coordinates?!0===r?(t.coordinates=i,t):{type:n,coordinates:i}:!0===r?(t.geometry.coordinates=i,t):s({type:n,coordinates:i},t.properties,{bbox:t.bbox,id:t.id})}function rr(t){var e=Q(t);if(2===e.length&&!nr(e[0],e[1]))return e;var r=[],n=e.length-1,i=r.length;r.push(e[0]);for(var o=1;o<n;o++){var s=r[r.length-1];e[o][0]===s[0]&&e[o][1]===s[1]||(r.push(e[o]),(i=r.length)>2&&ir(r[i-3],r[i-1],r[i-2])&&r.splice(r.length-2,1))}if(r.push(e[e.length-1]),i=r.length,nr(e[0],e[e.length-1])&&i<4)throw new Error("invalid polygon");return ir(r[i-3],r[i-1],r[i-2])&&r.splice(r.length-2,1),r}function nr(t,e){return t[0]===e[0]&&t[1]===e[1]}function ir(t,e,r){var n=r[0],i=r[1],o=t[0],s=t[1],a=e[0],l=e[1],u=a-o,c=l-s;return 0===(n-o)*c-(i-s)*u&&(Math.abs(u)>=Math.abs(c)?u>0?o<=n&&n<=a:a<=n&&n<=o:c>0?s<=i&&i<=l:l<=i&&i<=s)}function or(t,e,r){var n=e.x,i=e.y,o=r.x-n,s=r.y-i;if(0!==o||0!==s){var a=((t.x-n)*o+(t.y-i)*s)/(o*o+s*s);a>1?(n=r.x,i=r.y):a>0&&(n+=o*a,i+=s*a)}return(o=t.x-n)*o+(s=t.y-i)*s}function sr(t,e,r,n,i){for(var o,s=n,a=e+1;a<r;a++){var l=or(t[a],t[e],t[r]);l>s&&(o=a,s=l)}s>n&&(o-e>1&&sr(t,e,o,n,i),i.push(t[o]),r-o>1&&sr(t,o,r,n,i))}function ar(t,e){var r=t.length-1,n=[t[0]];return sr(t,0,r,e,n),n.push(t[r]),n}function lr(t,e,r){if(t.length<=2)return t;var n=void 0!==e?e*e:1;return ar(t=r?t:function(t,e){for(var r,n,i,o,s,a=t[0],l=[a],u=1,c=t.length;u<c;u++)r=t[u],i=a,o=void 0,s=void 0,o=(n=r).x-i.x,s=n.y-i.y,o*o+s*s>e&&(l.push(r),a=r);return a!==r&&l.push(r),l}(t,n),n)}function ur(t,e,r){return lr(t.map(function(t){return{x:t[0],y:t[1],z:t[2]}}),e,r).map(function(t){return t.z?[t.x,t.y,t.z]:[t.x,t.y]})}function cr(t,e,r){return t.map(function(t){var n=t.map(function(t){return{x:t[0],y:t[1]}});if(n.length<4)throw new Error("invalid polygon");for(var i=lr(n,e,r).map(function(t){return[t.x,t.y]});!hr(i);)i=lr(n,e-=.01*e,r).map(function(t){return[t.x,t.y]});return i[i.length-1][0]===i[0][0]&&i[i.length-1][1]===i[0][1]||i.push(i[0]),i})}function hr(t){return!(t.length<3)&&!(3===t.length&&t[2][0]===t[0][0]&&t[2][1]===t[0][1])}var pr=function(){function t(t){this.points=t.points||[],this.duration=t.duration||1e4,this.sharpness=t.sharpness||.85,this.centers=[],this.controls=[],this.stepLength=t.stepLength||60,this.length=this.points.length,this.delay=0;for(var e=0;e<this.length;e++)this.points[e].z=this.points[e].z||0;for(e=0;e<this.length-1;e++){var r=this.points[e],n=this.points[e+1];this.centers.push({x:(r.x+n.x)/2,y:(r.y+n.y)/2,z:(r.z+n.z)/2})}for(this.controls.push([this.points[0],this.points[0]]),e=0;e<this.centers.length-1;e++){var i=this.points[e+1].x-(this.centers[e].x+this.centers[e+1].x)/2,o=this.points[e+1].y-(this.centers[e].y+this.centers[e+1].y)/2,s=this.points[e+1].z-(this.centers[e].y+this.centers[e+1].z)/2;this.controls.push([{x:(1-this.sharpness)*this.points[e+1].x+this.sharpness*(this.centers[e].x+i),y:(1-this.sharpness)*this.points[e+1].y+this.sharpness*(this.centers[e].y+o),z:(1-this.sharpness)*this.points[e+1].z+this.sharpness*(this.centers[e].z+s)},{x:(1-this.sharpness)*this.points[e+1].x+this.sharpness*(this.centers[e+1].x+i),y:(1-this.sharpness)*this.points[e+1].y+this.sharpness*(this.centers[e+1].y+o),z:(1-this.sharpness)*this.points[e+1].z+this.sharpness*(this.centers[e+1].z+s)}])}return this.controls.push([this.points[this.length-1],this.points[this.length-1]]),this.steps=this.cacheSteps(this.stepLength),this}return t.prototype.cacheSteps=function(t){var e=[],r=this.pos(0);e.push(0);for(var n=0;n<this.duration;n+=10){var i=this.pos(n);Math.sqrt((i.x-r.x)*(i.x-r.x)+(i.y-r.y)*(i.y-r.y)+(i.z-r.z)*(i.z-r.z))>t&&(e.push(n),r=i)}return e},t.prototype.vector=function(t){var e=this.pos(t+10),r=this.pos(t-10);return{angle:180*Math.atan2(e.y-r.y,e.x-r.x)/3.14,speed:Math.sqrt((r.x-e.x)*(r.x-e.x)+(r.y-e.y)*(r.y-e.y)+(r.z-e.z)*(r.z-e.z))}},t.prototype.pos=function(t){var e=t-this.delay;e<0&&(e=0),e>this.duration&&(e=this.duration-1);var r=e/this.duration;if(r>=1)return this.points[this.length-1];var n=Math.floor((this.points.length-1)*r);return function(t,e,r,n,i){var o=function(t){var e=t*t;return[e*t,3*e*(1-t),3*t*(1-t)*(1-t),(1-t)*(1-t)*(1-t)]}(t);return{x:i.x*o[0]+n.x*o[1]+r.x*o[2]+e.x*o[3],y:i.y*o[0]+n.y*o[1]+r.y*o[2]+e.y*o[3],z:i.z*o[0]+n.z*o[1]+r.z*o[2]+e.z*o[3]}}((this.length-1)*r-n,this.points[n],this.controls[n][1],this.controls[n+1][0],this.points[n+1])},t}();function fr(t,e){void 0===e&&(e={});for(var r=e.resolution||1e4,n=e.sharpness||.85,i=[],o=it(t).coordinates.map(function(t){return{x:t[0],y:t[1]}}),s=new pr({duration:r,points:o,sharpness:n}),a=function(t){var e=s.pos(t);Math.floor(t/100)%2==0&&i.push([e.x,e.y])},l=0;l<s.duration;l+=10)a(l);return a(s.duration),p(i,e.properties)}function dr(t,e){void 0===e&&(e={});var r=Number(t[0]),n=Number(t[1]),i=Number(t[2]),o=Number(t[3]);if(6===t.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var s=[r,n];return c([[s,[i,n],[i,o],[r,o],s]],e.properties,{bbox:t,id:e.id})}function mr(t){return dr(J(t))}function gr(t){var e=t[0],r=t[1],n=t[2],i=t[3];if(xe(t.slice(0,2),[n,r])>=xe(t.slice(0,2),[e,i])){var o=(r+i)/2;return[e,o-(n-e)/2,n,o+(n-e)/2]}var s=(e+n)/2;return[s-(i-r)/2,r,s+(i-r)/2,i]}function yr(t,e,r,n){void 0===n&&(n={});var i=K(t),o=I(i[0]),s=I(i[1]),a=I(r),u=b(e,n.units),c=Math.asin(Math.sin(s)*Math.cos(u)+Math.cos(s)*Math.sin(u)*Math.cos(a));return l([S(o+Math.atan2(Math.sin(a)*Math.sin(u)*Math.cos(s),Math.cos(u)-Math.sin(s)*Math.sin(c))),S(c)],n.properties)}function _r(t,e,r){void 0===r&&(r={});for(var n=r.steps||64,i=r.properties?r.properties:!Array.isArray(t)&&"Feature"===t.type&&t.properties?t.properties:{},o=[],s=0;s<n;s++)o.push(yr(t,e,-360*s/n,r).geometry.coordinates);return o.push(o[0]),c([o],i)}function vr(t,e,r){if(void 0===r&&(r={}),!0===r.final)return function(t,e){var r=vr(e,t);return(r+180)%360}(t,e);var n=K(t),i=K(e),o=I(n[0]),s=I(i[0]),a=I(n[1]),l=I(i[1]),u=Math.sin(s-o)*Math.cos(l),c=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-o);return S(Math.atan2(u,c))}function xr(t,e){void 0===e&&(e={});var r=J(t);return l([(r[0]+r[2])/2,(r[1]+r[3])/2],e.properties,e)}function br(t,e){void 0===e&&(e={});var r=0,n=0,i=0;return z(t,function(t){r+=t[0],n+=t[1],i++},!0),l([r/i,n/i],e.properties)}function wr(t){var e=[];return"FeatureCollection"===t.type?N(t,function(t){z(t,function(r){e.push(l(r,t.properties))})}):z(t,function(r){e.push(l(r,t.properties))}),d(e)}var Er=Ir,Sr=Ir;function Ir(t,e,r){r=r||2;var n,i,o,s,a,l,u,c=e&&e.length,h=c?e[0]*r:t.length,p=Tr(t,0,h,r,!0),f=[];if(!p)return f;if(c&&(p=function(t,e,r,n){var i,o,s,a=[];for(i=0,o=e.length;i<o;i++)(s=Tr(t,e[i]*n,i<o-1?e[i+1]*n:t.length,n,!1))===s.next&&(s.steiner=!0),a.push(Or(s));for(a.sort(zr),i=0;i<a.length;i++)Dr(a[i],r),r=Cr(r,r.next);return r}(t,e,p,r)),t.length>80*r){n=o=t[0],i=s=t[1];for(var d=r;d<h;d+=r)(a=t[d])<n&&(n=a),(l=t[d+1])<i&&(i=l),a>o&&(o=a),l>s&&(s=l);u=0!==(u=Math.max(o-n,s-i))?1/u:0}return Mr(p,f,r,n,i,u),f}function Tr(t,e,r,n,i){var o,s;if(i===Xr(t,e,r,n)>0)for(o=e;o<r;o+=n)s=qr(o,t[o],t[o+1],s);else for(o=r-n;o>=e;o-=n)s=qr(o,t[o],t[o+1],s);return s&&jr(s,s.next)&&($r(s),s=s.next),s}function Cr(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!jr(n,n.next)&&0!==Br(n.prev,n,n.next))n=n.next;else{if($r(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function Mr(t,e,r,n,i,o,s){if(t){!s&&o&&function(t,e,r,n){var i=t;do{null===i.z&&(i.z=Rr(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,r,n,i,o,s,a,l,u=1;do{for(r=t,t=null,o=null,s=0;r;){for(s++,n=r,a=0,e=0;e<u&&(a++,n=n.nextZ);e++);for(l=u;a>0||l>0&&n;)0!==a&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,a--):(i=n,n=n.nextZ,l--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;r=n}o.nextZ=null,u*=2}while(s>1)}(i)}(t,n,i,o);for(var a,l,u=t;t.prev!==t.next;)if(a=t.prev,l=t.next,o?Pr(t,n,i,o):Ar(t))e.push(a.i/r),e.push(t.i/r),e.push(l.i/r),$r(t),t=l.next,u=l.next;else if((t=l)===u){s?1===s?Mr(t=kr(t,e,r),e,r,n,i,o,2):2===s&&Lr(t,e,r,n,i,o):Mr(Cr(t),e,r,n,i,o,1);break}}}function Ar(t){var e=t.prev,r=t,n=t.next;if(Br(e,r,n)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(Nr(e.x,e.y,r.x,r.y,n.x,n.y,i.x,i.y)&&Br(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Pr(t,e,r,n){var i=t.prev,o=t,s=t.next;if(Br(i,o,s)>=0)return!1;for(var a=i.x<o.x?i.x<s.x?i.x:s.x:o.x<s.x?o.x:s.x,l=i.y<o.y?i.y<s.y?i.y:s.y:o.y<s.y?o.y:s.y,u=i.x>o.x?i.x>s.x?i.x:s.x:o.x>s.x?o.x:s.x,c=i.y>o.y?i.y>s.y?i.y:s.y:o.y>s.y?o.y:s.y,h=Rr(a,l,e,r,n),p=Rr(u,c,e,r,n),f=t.prevZ,d=t.nextZ;f&&f.z>=h&&d&&d.z<=p;){if(f!==t.prev&&f!==t.next&&Nr(i.x,i.y,o.x,o.y,s.x,s.y,f.x,f.y)&&Br(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,d!==t.prev&&d!==t.next&&Nr(i.x,i.y,o.x,o.y,s.x,s.y,d.x,d.y)&&Br(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;f&&f.z>=h;){if(f!==t.prev&&f!==t.next&&Nr(i.x,i.y,o.x,o.y,s.x,s.y,f.x,f.y)&&Br(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;d&&d.z<=p;){if(d!==t.prev&&d!==t.next&&Nr(i.x,i.y,o.x,o.y,s.x,s.y,d.x,d.y)&&Br(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function kr(t,e,r){var n=t;do{var i=n.prev,o=n.next.next;!jr(i,o)&&Ur(i,n,n.next,o)&&Vr(i,o)&&Vr(o,i)&&(e.push(i.i/r),e.push(n.i/r),e.push(o.i/r),$r(n),$r(n.next),n=t=o),n=n.next}while(n!==t);return n}function Lr(t,e,r,n,i,o){var s=t;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&Fr(s,a)){var l=Gr(s,a);return s=Cr(s,s.next),l=Cr(l,l.next),Mr(s,e,r,n,i,o),void Mr(l,e,r,n,i,o)}a=a.next}s=s.next}while(s!==t)}function zr(t,e){return t.x-e.x}function Dr(t,e){if(e=function(t,e){var r,n=e,i=t.x,o=t.y,s=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var a=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=i&&a>s){if(s=a,a===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!r)return null;if(i===s)return r.prev;var l,u=r,c=r.x,h=r.y,p=1/0;for(n=r.next;n!==u;)i>=n.x&&n.x>=c&&i!==n.x&&Nr(o<h?i:s,o,c,h,o<h?s:i,o,n.x,n.y)&&((l=Math.abs(o-n.y)/(i-n.x))<p||l===p&&n.x>r.x)&&Vr(n,t)&&(r=n,p=l),n=n.next;return r}(t,e)){var r=Gr(e,t);Cr(r,r.next)}}function Rr(t,e,r,n,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Or(t){var e=t,r=t;do{e.x<r.x&&(r=e),e=e.next}while(e!==t);return r}function Nr(t,e,r,n,i,o,s,a){return(i-s)*(e-a)-(t-s)*(o-a)>=0&&(t-s)*(n-a)-(r-s)*(e-a)>=0&&(r-s)*(o-a)-(i-s)*(n-a)>=0}function Fr(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&Ur(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&Vr(t,e)&&Vr(e,t)&&function(t,e){var r=t,n=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)}function Br(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function jr(t,e){return t.x===e.x&&t.y===e.y}function Ur(t,e,r,n){return!!(jr(t,e)&&jr(r,n)||jr(t,n)&&jr(r,e))||Br(t,e,r)>0!=Br(t,e,n)>0&&Br(r,n,t)>0!=Br(r,n,e)>0}function Vr(t,e){return Br(t.prev,t,t.next)<0?Br(t,e,t.next)>=0&&Br(t,t.prev,e)>=0:Br(t,e,t.prev)<0||Br(t,t.next,e)<0}function Gr(t,e){var r=new Zr(t.i,t.x,t.y),n=new Zr(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function qr(t,e,r,n){var i=new Zr(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function $r(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Zr(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Xr(t,e,r,n){for(var i=0,o=e,s=r-n;o<r;o+=n)i+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return i}function Wr(t){var e=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var s=0;s<e;s++)r.vertices.push(t[i][o][s]);i>0&&(n+=t[i-1].length,r.holes.push(n))}return r}(t),r=Er(e.vertices,e.holes,2),n=[],i=[];r.forEach(function(t,n){var o=r[n];i.push([e.vertices[2*o],e.vertices[2*o+1]])});for(var o=0;o<i.length;o+=3){var s=i.slice(o,o+3);s.push(i[o]),n.push(c([s]))}return n}function Yr(t,e){if(!t)throw new Error("targetPoint is required");if(!e)throw new Error("points is required");var r,n=1/0,i=0;return N(e,function(e,r){var o=xe(t,e);o<n&&(i=r,n=o)}),(r=Ie(e.features[i])).properties.featureIndex=i,r.properties.distanceToPoint=n,r}function Hr(t){if(!t)throw new Error("geojson is required");var e=[];return V(t,function(t){!function(t,e){var r=[],n=t.geometry;if(null!==n){switch(n.type){case"Polygon":r=Q(n);break;case"LineString":r=[Q(n)]}r.forEach(function(r){(function(t,e){var r=[];return t.reduce(function(t,n){var i=p([t,n],e);return i.bbox=function(t,e){var r=t[0],n=t[1],i=e[0],o=e[1];return[r<i?r:i,n<o?n:o,r>i?r:i,n>o?n:o]}(t,n),r.push(i),n}),r})(r,t.properties).forEach(function(t){t.id=e.length,e.push(t)})})}}(t,e)}),d(e)}Ir.deviation=function(t,e,r,n){var i=e&&e.length,o=i?e[0]*r:t.length,s=Math.abs(Xr(t,0,o,r));if(i)for(var a=0,l=e.length;a<l;a++){var u=e[a]*r,c=a<l-1?e[a+1]*r:t.length;s-=Math.abs(Xr(t,u,c,r))}var h=0;for(a=0;a<n.length;a+=3){var p=n[a]*r,f=n[a+1]*r,d=n[a+2]*r;h+=Math.abs((t[p]-t[d])*(t[f+1]-t[p+1])-(t[p]-t[f])*(t[d+1]-t[p+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},Ir.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var s=0;s<e;s++)r.vertices.push(t[i][o][s]);i>0&&(n+=t[i-1].length,r.holes.push(n))}return r},Er.default=Sr;var Jr=Ut(function(t,e){function r(t,e,r){void 0===r&&(r={});var n={type:"Feature"};return(0===r.id||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=e||{},n.geometry=t,n}function n(t,e,n){if(void 0===n&&(n={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!f(t[0])||!f(t[1]))throw new Error("coordinates must contain numbers");return r({type:"Point",coordinates:t},e,n)}function i(t,e,n){void 0===n&&(n={});for(var i=0,o=t;i<o.length;i++){var s=o[i];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<s[s.length-1].length;a++)if(s[s.length-1][a]!==s[0][a])throw new Error("First and last Position are not equivalent.")}return r({type:"Polygon",coordinates:t},e,n)}function o(t,e,n){if(void 0===n&&(n={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return r({type:"LineString",coordinates:t},e,n)}function s(t,e){void 0===e&&(e={});var r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}function a(t,e,n){return void 0===n&&(n={}),r({type:"MultiLineString",coordinates:t},e,n)}function l(t,e,n){return void 0===n&&(n={}),r({type:"MultiPoint",coordinates:t},e,n)}function u(t,e,n){return void 0===n&&(n={}),r({type:"MultiPolygon",coordinates:t},e,n)}function c(t,r){void 0===r&&(r="kilometers");var n=e.factors[r];if(!n)throw new Error(r+" units is invalid");return t*n}function h(t,r){void 0===r&&(r="kilometers");var n=e.factors[r];if(!n)throw new Error(r+" units is invalid");return t/n}function p(t){return t%(2*Math.PI)*180/Math.PI}function f(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.earthRadius=6371008.8,e.factors={centimeters:100*e.earthRadius,centimetres:100*e.earthRadius,degrees:e.earthRadius/111325,feet:3.28084*e.earthRadius,inches:39.37*e.earthRadius,kilometers:e.earthRadius/1e3,kilometres:e.earthRadius/1e3,meters:e.earthRadius,metres:e.earthRadius,miles:e.earthRadius/1609.344,millimeters:1e3*e.earthRadius,millimetres:1e3*e.earthRadius,nauticalmiles:e.earthRadius/1852,radians:1,yards:1.0936*e.earthRadius},e.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/e.earthRadius,yards:1.0936133},e.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:3.86e-7,millimeters:1e6,millimetres:1e6,yards:1.195990046},e.feature=r,e.geometry=function(t,e,r){switch(t){case"Point":return n(e).geometry;case"LineString":return o(e).geometry;case"Polygon":return i(e).geometry;case"MultiPoint":return l(e).geometry;case"MultiLineString":return a(e).geometry;case"MultiPolygon":return u(e).geometry;default:throw new Error(t+" is invalid")}},e.point=n,e.points=function(t,e,r){return void 0===r&&(r={}),s(t.map(function(t){return n(t,e)}),r)},e.polygon=i,e.polygons=function(t,e,r){return void 0===r&&(r={}),s(t.map(function(t){return i(t,e)}),r)},e.lineString=o,e.lineStrings=function(t,e,r){return void 0===r&&(r={}),s(t.map(function(t){return o(t,e)}),r)},e.featureCollection=s,e.multiLineString=a,e.multiPoint=l,e.multiPolygon=u,e.geometryCollection=function(t,e,n){return void 0===n&&(n={}),r({type:"GeometryCollection",geometries:t},e,n)},e.round=function(t,e){if(void 0===e&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,e||0);return Math.round(t*r)/r},e.radiansToLength=c,e.lengthToRadians=h,e.lengthToDegrees=function(t,e){return p(h(t,e))},e.bearingToAzimuth=function(t){var e=t%360;return e<0&&(e+=360),e},e.radiansToDegrees=p,e.degreesToRadians=function(t){return t%360*Math.PI/180},e.convertLength=function(t,e,r){if(void 0===e&&(e="kilometers"),void 0===r&&(r="kilometers"),!(t>=0))throw new Error("length must be a positive number");return c(h(t,e),r)},e.convertArea=function(t,r,n){if(void 0===r&&(r="meters"),void 0===n&&(n="kilometers"),!(t>=0))throw new Error("area must be a positive number");var i=e.areaFactors[r];if(!i)throw new Error("invalid original units");var o=e.areaFactors[n];if(!o)throw new Error("invalid final units");return t/i*o},e.isNumber=f,e.isObject=function(t){return!!t&&t.constructor===Object},e.validateBBox=function(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(function(t){if(!f(t))throw new Error("bbox must only contain numbers")})},e.validateId=function(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof t))throw new Error("id must be a number or a string")}});function Kr(t,e,r){if(null!==t)for(var n,i,o,s,a,l,u,c,h=0,p=0,f=t.type,d="FeatureCollection"===f,m="Feature"===f,g=d?t.features.length:1,y=0;y<g;y++){a=(c=!!(u=d?t.features[y].geometry:m?t.geometry:t)&&"GeometryCollection"===u.type)?u.geometries.length:1;for(var _=0;_<a;_++){var v=0,x=0;if(null!==(s=c?u.geometries[_]:u)){l=s.coordinates;var b=s.type;switch(h=!r||"Polygon"!==b&&"MultiPolygon"!==b?0:1,b){case null:break;case"Point":if(!1===e(l,p,y,v,x))return!1;p++,v++;break;case"LineString":case"MultiPoint":for(n=0;n<l.length;n++){if(!1===e(l[n],p,y,v,x))return!1;p++,"MultiPoint"===b&&v++}"LineString"===b&&v++;break;case"Polygon":case"MultiLineString":for(n=0;n<l.length;n++){for(i=0;i<l[n].length-h;i++){if(!1===e(l[n][i],p,y,v,x))return!1;p++}"MultiLineString"===b&&v++,"Polygon"===b&&x++}"Polygon"===b&&v++;break;case"MultiPolygon":for(n=0;n<l.length;n++){for(x=0,i=0;i<l[n].length;i++){for(o=0;o<l[n][i].length-h;o++){if(!1===e(l[n][i][o],p,y,v,x))return!1;p++}x++}v++}break;case"GeometryCollection":for(n=0;n<s.geometries.length;n++)if(!1===Kr(s.geometries[n],e,r))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Qr(t,e){var r;switch(t.type){case"FeatureCollection":for(r=0;r<t.features.length&&!1!==e(t.features[r].properties,r);r++);break;case"Feature":e(t.properties,0)}}function tn(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var r=0;r<t.features.length&&!1!==e(t.features[r],r);r++);}function en(t,e){var r,n,i,o,s,a,l,u,c,h,p=0,f="FeatureCollection"===t.type,d="Feature"===t.type,m=f?t.features.length:1;for(r=0;r<m;r++){for(a=f?t.features[r].geometry:d?t.geometry:t,u=f?t.features[r].properties:d?t.properties:{},c=f?t.features[r].bbox:d?t.bbox:void 0,h=f?t.features[r].id:d?t.id:void 0,s=(l=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,i=0;i<s;i++)if(null!==(o=l?a.geometries[i]:a))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(o,p,u,c,h))return!1;break;case"GeometryCollection":for(n=0;n<o.geometries.length;n++)if(!1===e(o.geometries[n],p,u,c,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,p,u,c,h))return!1;p++}}function rn(t,e){en(t,function(t,r,n,i,o){var s,a=null===t?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return!1!==e(Jr.feature(t,n,{bbox:i,id:o}),r,0)&&void 0}switch(a){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var l=0;l<t.coordinates.length;l++){var u={type:s,coordinates:t.coordinates[l]};if(!1===e(Jr.feature(u,n),r,l))return!1}})}function nn(t,e){rn(t,function(t,r,n){var i=0;if(t.geometry){var o=t.geometry.type;if("Point"!==o&&"MultiPoint"!==o){var s,a=0,l=0,u=0;return!1!==Kr(t,function(o,c,h,p,f){if(void 0===s||r>a||p>l||f>u)return s=o,a=r,l=p,u=f,void(i=0);var d=Jr.lineString([s,o],t.properties);if(!1===e(d,r,n,f,i))return!1;i++,s=o})&&void 0}}})}function on(t,e){if(!t)throw new Error("geojson is required");rn(t,function(t,r,n){if(null!==t.geometry){var i=t.geometry.type,o=t.geometry.coordinates;switch(i){case"LineString":if(!1===e(t,r,n,0,0))return!1;break;case"Polygon":for(var s=0;s<o.length;s++)if(!1===e(Jr.lineString(o[s],t.properties),r,n,s))return!1}}})}var sn=function(t){var e=[];return Kr(t,function(t){e.push(t)}),e},an=Kr,ln=function(t,e,r,n){var i=r;return Kr(t,function(t,n,o,s,a){i=0===n&&void 0===r?t:e(i,t,n,o,s,a)},n),i},un=tn,cn=function(t,e,r){var n=r;return tn(t,function(t,i){n=0===i&&void 0===r?t:e(n,t,i)}),n},hn=function(t,e){if(e=e||{},!Jr.isObject(e))throw new Error("options is invalid");var r,n=e.featureIndex||0,i=e.multiFeatureIndex||0,o=e.geometryIndex||0,s=e.coordIndex||0,a=e.properties;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),a=a||t.features[n].properties,r=t.features[n].geometry;break;case"Feature":a=a||t.properties,r=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":r=t;break;default:throw new Error("geojson is invalid")}if(null===r)return null;var l=r.coordinates;switch(r.type){case"Point":return Jr.point(l,a,e);case"MultiPoint":return i<0&&(i=l.length+i),Jr.point(l[i],a,e);case"LineString":return s<0&&(s=l.length+s),Jr.point(l[s],a,e);case"Polygon":return o<0&&(o=l.length+o),s<0&&(s=l[o].length+s),Jr.point(l[o][s],a,e);case"MultiLineString":return i<0&&(i=l.length+i),s<0&&(s=l[i].length+s),Jr.point(l[i][s],a,e);case"MultiPolygon":return i<0&&(i=l.length+i),o<0&&(o=l[i].length+o),s<0&&(s=l[i][o].length-s),Jr.point(l[i][o][s],a,e)}throw new Error("geojson is invalid")},pn=function(t,e){if(e=e||{},!Jr.isObject(e))throw new Error("options is invalid");var r,n=e.featureIndex||0,i=e.multiFeatureIndex||0,o=e.geometryIndex||0,s=e.segmentIndex||0,a=e.properties;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),a=a||t.features[n].properties,r=t.features[n].geometry;break;case"Feature":a=a||t.properties,r=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":r=t;break;default:throw new Error("geojson is invalid")}if(null===r)return null;var l=r.coordinates;switch(r.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=l.length+s-1),Jr.lineString([l[s],l[s+1]],a,e);case"Polygon":return o<0&&(o=l.length+o),s<0&&(s=l[o].length+s-1),Jr.lineString([l[o][s],l[o][s+1]],a,e);case"MultiLineString":return i<0&&(i=l.length+i),s<0&&(s=l[i].length+s-1),Jr.lineString([l[i][s],l[i][s+1]],a,e);case"MultiPolygon":return i<0&&(i=l.length+i),o<0&&(o=l[i].length+o),s<0&&(s=l[i][o].length-s-1),Jr.lineString([l[i][o][s],l[i][o][s+1]],a,e)}throw new Error("geojson is invalid")},fn=rn,dn=function(t,e,r){var n=r;return rn(t,function(t,i,o){n=0===i&&0===o&&void 0===r?t:e(n,t,i,o)}),n},mn=en,gn=function(t,e,r){var n=r;return en(t,function(t,i,o,s,a){n=0===i&&void 0===r?t:e(n,t,i,o,s,a)}),n},yn=on,_n=function(t,e,r){var n=r;return on(t,function(t,i,o,s){n=0===i&&void 0===r?t:e(n,t,i,o,s)}),n},vn=Qr,xn=function(t,e,r){var n=r;return Qr(t,function(t,i){n=0===i&&void 0===r?t:e(n,t,i)}),n},bn=nn,wn=function(t,e,r){var n=r,i=!1;return nn(t,function(t,o,s,a,l){n=!1===i&&void 0===r?t:e(n,t,o,s,a,l),i=!0}),n},En=Object.defineProperty({coordAll:sn,coordEach:an,coordReduce:ln,featureEach:un,featureReduce:cn,findPoint:hn,findSegment:pn,flattenEach:fn,flattenReduce:dn,geomEach:mn,geomReduce:gn,lineEach:yn,lineReduce:_n,propEach:vn,propReduce:xn,segmentEach:bn,segmentReduce:wn},"__esModule",{value:!0});function Sn(t){var e=[1/0,1/0,-1/0,-1/0];return En.coordEach(t,function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])}),e}Sn.default=Sn;var In=Sn,Tn=Object.defineProperty({default:In},"__esModule",{value:!0}).default,Cn=En.featureEach,Mn=(En.coordEach,Jr.polygon,Jr.featureCollection);function An(t){var e=Tt(t);return e.insert=function(t){if("Feature"!==t.type)throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:Tn(t),Tt.prototype.insert.call(this,t)},e.load=function(t){var e=[];return Array.isArray(t)?t.forEach(function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox?t.bbox:Tn(t),e.push(t)}):Cn(t,function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox?t.bbox:Tn(t),e.push(t)}),Tt.prototype.load.call(this,e)},e.remove=function(t,e){if("Feature"!==t.type)throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:Tn(t),Tt.prototype.remove.call(this,t,e)},e.clear=function(){return Tt.prototype.clear.call(this)},e.search=function(t){var e=Tt.prototype.search.call(this,this.toBBox(t));return Mn(e)},e.collides=function(t){return Tt.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Tt.prototype.all.call(this);return Mn(t)},e.toJSON=function(){return Tt.prototype.toJSON.call(this)},e.fromJSON=function(t){return Tt.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var e;if(t.bbox)e=t.bbox;else if(Array.isArray(t)&&4===t.length)e=t;else if(Array.isArray(t)&&6===t.length)e=[t[0],t[1],t[3],t[4]];else if("Feature"===t.type)e=Tn(t);else{if("FeatureCollection"!==t.type)throw new Error("invalid geojson");e=Tn(t)}return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}},e}var Pn=An,kn=An;function Ln(t,e){var r={},n=[];if("LineString"===t.type&&(t=s(t)),"LineString"===e.type&&(e=s(e)),"Feature"===t.type&&"Feature"===e.type&&null!==t.geometry&&null!==e.geometry&&"LineString"===t.geometry.type&&"LineString"===e.geometry.type&&2===t.geometry.coordinates.length&&2===e.geometry.coordinates.length){var i=zn(t,e);return i&&n.push(i),d(n)}var o=Pn();return o.load(Hr(e)),N(Hr(t),function(t){N(o.search(t),function(e){var i=zn(t,e);if(i){var o=Q(i).join(",");r[o]||(r[o]=!0,n.push(i))}})}),d(n)}function zn(t,e){var r=Q(t),n=Q(e);if(2!==r.length)throw new Error("<intersects> line1 must only contain 2 coordinates");if(2!==n.length)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=r[0][0],o=r[0][1],s=r[1][0],a=r[1][1],u=n[0][0],c=n[0][1],h=n[1][0],p=n[1][1],f=(p-c)*(s-i)-(h-u)*(a-o),d=(h-u)*(o-c)-(p-c)*(i-u),m=(s-i)*(o-c)-(a-o)*(i-u);if(0===f)return null;var g=d/f,y=m/f;return g>=0&&g<=1&&y>=0&&y<=1?l([i+g*(s-i),o+g*(a-o)]):null}function Dn(t,e,r){void 0===r&&(r={});var n=l([1/0,1/0],{dist:1/0}),i=0;return V(t,function(t){for(var o=Q(t),s=0;s<o.length-1;s++){var a=l(o[s]);a.properties.dist=xe(e,a,r);var u=l(o[s+1]);u.properties.dist=xe(e,u,r);var c=xe(a,u,r),h=Math.max(a.properties.dist,u.properties.dist),f=vr(a,u),d=yr(e,h,f+90,r),m=yr(e,h,f-90,r),g=Ln(p([d.geometry.coordinates,m.geometry.coordinates]),p([a.geometry.coordinates,u.geometry.coordinates])),y=null;g.features.length>0&&((y=g.features[0]).properties.dist=xe(e,y,r),y.properties.location=i+xe(a,y,r)),a.properties.dist<n.properties.dist&&((n=a).properties.index=s,n.properties.location=i),u.properties.dist<n.properties.dist&&((n=u).properties.index=s+1,n.properties.location=i+c),y&&y.properties.dist<n.properties.dist&&((n=y).properties.index=s),i+=c}}),n}function Rn(t,e,n){void 0===n&&(n={});var i=K(t),o=K(e);return o[0]+=o[0]-i[0]>180?-360:i[0]-o[0]>180?360:0,T(function(t,e,n){var i=n=void 0===n?r:Number(n),o=t[1]*Math.PI/180,s=e[1]*Math.PI/180,a=s-o,l=Math.abs(e[0]-t[0])*Math.PI/180;l>Math.PI&&(l-=2*Math.PI);var u=Math.log(Math.tan(s/2+Math.PI/4)/Math.tan(o/2+Math.PI/4)),c=Math.abs(u)>1e-11?a/u:Math.cos(o);return Math.sqrt(a*a+c*c*l*l)*i}(i,o),"meters",n.units)}function On(t,e,r){if(void 0===r&&(r={}),r.method||(r.method="geodesic"),r.units||(r.units="kilometers"),!t)throw new Error("pt is required");if(Array.isArray(t)?t=l(t):"Point"===t.type?t=s(t):rt(t,"Point","point"),!e)throw new Error("line is required");Array.isArray(e)?e=p(e):"LineString"===e.type?e=s(e):rt(e,"LineString","line");var n=1/0,i=t.geometry.coordinates;return q(e,function(t){var e=t.geometry.coordinates[0],o=t.geometry.coordinates[1],s=function(t,e,r,n){var i=[r[0]-e[0],r[1]-e[1]],o=Nn([t[0]-e[0],t[1]-e[1]],i);if(o<=0)return Fn(t,e,{method:n.method,units:"degrees"});var s=Nn(i,i);if(s<=o)return Fn(t,r,{method:n.method,units:"degrees"});var a=o/s,l=[e[0]+a*i[0],e[1]+a*i[1]];return Fn(t,l,{method:n.method,units:"degrees"})}(i,e,o,r);s<n&&(n=s)}),T(n,"degrees",r.units)}function Nn(t,e){return t[0]*e[0]+t[1]*e[1]}function Fn(t,e,r){return"planar"===r.method?Rn(t,e,r):xe(t,e,r)}function Bn(t,e,r,n,i,o,s,a){var l,u,c,h,p={x:null,y:null,onLine1:!1,onLine2:!1};return 0===(l=(a-o)*(r-t)-(s-i)*(n-e))?null!==p.x&&null!==p.y&&p:(h=(r-t)*(u=e-o)-(n-e)*(c=t-i),u=((s-i)*u-(a-o)*c)/l,c=h/l,p.x=t+u*(r-t),p.y=e+u*(n-e),u>=0&&u<=1&&(p.onLine1=!0),c>=0&&c<=1&&(p.onLine2=!0),!(!p.onLine1||!p.onLine2)&&[p.x,p.y])}function jn(t){for(var e=function(t){return"FeatureCollection"!==t.type?"Feature"!==t.type?d([s(t)]):d([t]):t}(t),r=xr(e),n=!1,i=0;!n&&i<e.features.length;){var o,a=e.features[i].geometry,u=!1;if("Point"===a.type)r.geometry.coordinates[0]===a.coordinates[0]&&r.geometry.coordinates[1]===a.coordinates[1]&&(n=!0);else if("MultiPoint"===a.type){var c=!1;for(o=0;!c&&o<a.coordinates.length;)r.geometry.coordinates[0]===a.coordinates[o][0]&&r.geometry.coordinates[1]===a.coordinates[o][1]&&(n=!0,c=!0),o++}else if("LineString"===a.type)for(o=0;!u&&o<a.coordinates.length-1;)Un(r.geometry.coordinates[0],r.geometry.coordinates[1],a.coordinates[o][0],a.coordinates[o][1],a.coordinates[o+1][0],a.coordinates[o+1][1])&&(u=!0,n=!0),o++;else if("MultiLineString"===a.type)for(var h=0;h<a.coordinates.length;){u=!1,o=0;for(var p=a.coordinates[h];!u&&o<p.length-1;)Un(r.geometry.coordinates[0],r.geometry.coordinates[1],p[o][0],p[o][1],p[o+1][0],p[o+1][1])&&(u=!0,n=!0),o++;h++}else"Polygon"!==a.type&&"MultiPolygon"!==a.type||ye(r,a)&&(n=!0);i++}if(n)return r;var f=d([]);for(i=0;i<e.features.length;i++)f.features=f.features.concat(wr(e.features[i]).features);return l(Yr(r,f).geometry.coordinates)}function Un(t,e,r,n,i,o){return Math.sqrt((i-r)*(i-r)+(o-n)*(o-n))===Math.sqrt((t-r)*(t-r)+(e-n)*(e-n))+Math.sqrt((i-t)*(i-t)+(o-e)*(o-e))}Pn.default=kn;var Vn=6378137;function Gn(t){return U(t,function(t,e){return t+function(t){var e,r=0;switch(t.type){case"Polygon":return qn(t.coordinates);case"MultiPolygon":for(e=0;e<t.coordinates.length;e++)r+=qn(t.coordinates[e]);return r;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}(e)},0)}function qn(t){var e=0;if(t&&t.length>0){e+=Math.abs($n(t[0]));for(var r=1;r<t.length;r++)e-=Math.abs($n(t[r]))}return e}function $n(t){var e,r,n,i,o,s,a=0,l=t.length;if(l>2){for(s=0;s<l;s++)s===l-2?(n=l-2,i=l-1,o=0):s===l-1?(n=l-1,i=0,o=1):(n=s,i=s+1,o=s+2),e=t[n],r=t[i],a+=(Zn(t[o][0])-Zn(e[0]))*Math.sin(Zn(r[1]));a=a*Vn*Vn/2}return a}function Zn(t){return t*Math.PI/180}function Xn(t,e){return void 0===e&&(e={}),$(t,function(t,r){var n=r.geometry.coordinates;return t+xe(n[0],n[1],e)},0)}function Wn(t,e,r,n){if(!A(n=n||{}))throw new Error("options is invalid");var i,o=[];if("Feature"===t.type)i=t.geometry.coordinates;else{if("LineString"!==t.type)throw new Error("input must be a LineString Feature or Geometry");i=t.coordinates}for(var s,a,l,u=i.length,c=0,h=0;h<i.length&&!(e>=c&&h===i.length-1);h++){if(c>e&&0===o.length){if(!(s=e-c))return o.push(i[h]),p(o);a=vr(i[h],i[h-1])-180,l=yr(i[h],s,a,n),o.push(l.geometry.coordinates)}if(c>=r)return(s=r-c)?(a=vr(i[h],i[h-1])-180,l=yr(i[h],s,a,n),o.push(l.geometry.coordinates),p(o)):(o.push(i[h]),p(o));if(c>=e&&o.push(i[h]),h===i.length-1)return p(o);c+=xe(i[h],i[h+1],n)}if(c<e&&i.length===u)throw new Error("Start position is beyond line");var f=i[i.length-1];return p([f,f])}function Yn(t,e,r){void 0===r&&(r={});for(var n=K(t),i=Q(e),o=0;o<i.length-1;o++){var s=!1;if(r.ignoreEndVertices&&(0===o&&(s="start"),o===i.length-2&&(s="end"),0===o&&o+1===i.length-1&&(s="both")),Hn(i[o],i[o+1],n,s,void 0===r.epsilon?null:r.epsilon))return!0}return!1}function Hn(t,e,r,n,i){var o=r[0],s=r[1],a=t[0],l=t[1],u=e[0],c=e[1],h=u-a,p=c-l,f=(r[0]-a)*p-(r[1]-l)*h;if(null!==i){if(Math.abs(f)>i)return!1}else if(0!==f)return!1;return n?"start"===n?Math.abs(h)>=Math.abs(p)?h>0?a<o&&o<=u:u<=o&&o<a:p>0?l<s&&s<=c:c<=s&&s<l:"end"===n?Math.abs(h)>=Math.abs(p)?h>0?a<=o&&o<u:u<o&&o<=a:p>0?l<=s&&s<c:c<s&&s<=l:"both"===n&&(Math.abs(h)>=Math.abs(p)?h>0?a<o&&o<u:u<o&&o<a:p>0?l<s&&s<c:c<s&&s<l):Math.abs(h)>=Math.abs(p)?h>0?a<=o&&o<=u:u<=o&&o<=a:p>0?l<=s&&s<=c:c<=s&&s<=l}function Jn(t,e){var r=it(t),n=it(e),i=r.type,o=n.type;switch(i){case"Point":switch(o){case"MultiPoint":return function(t,e){var r,n=!1;for(r=0;r<e.coordinates.length;r++)if(Qn(e.coordinates[r],t.coordinates)){n=!0;break}return n}(r,n);case"LineString":return Yn(r,n,{ignoreEndVertices:!0});case"Polygon":case"MultiPolygon":return ye(r,n,{ignoreBoundary:!0});default:throw new Error("feature2 "+o+" geometry not supported")}case"MultiPoint":switch(o){case"MultiPoint":return function(t,e){for(var r=0;r<t.coordinates.length;r++){for(var n=!1,i=0;i<e.coordinates.length;i++)Qn(t.coordinates[r],e.coordinates[i])&&(n=!0);if(!n)return!1}return!0}(r,n);case"LineString":return function(t,e){for(var r=!1,n=0;n<t.coordinates.length;n++){if(!Yn(t.coordinates[n],e))return!1;r||(r=Yn(t.coordinates[n],e,{ignoreEndVertices:!0}))}return r}(r,n);case"Polygon":case"MultiPolygon":return function(t,e){for(var r=!0,n=!1,i=0;i<t.coordinates.length;i++){if(!(n=ye(t.coordinates[1],e))){r=!1;break}n=ye(t.coordinates[1],e,{ignoreBoundary:!0})}return r&&n}(r,n);default:throw new Error("feature2 "+o+" geometry not supported")}case"LineString":switch(o){case"LineString":return function(t,e){for(var r=0;r<t.coordinates.length;r++)if(!Yn(t.coordinates[r],e))return!1;return!0}(r,n);case"Polygon":case"MultiPolygon":return function(t,e){var r=J(e),n=J(t);if(!Kn(r,n))return!1;for(var i=!1,o=0;o<t.coordinates.length-1;o++){if(!ye(t.coordinates[o],e))return!1;i||(i=ye(t.coordinates[o],e,{ignoreBoundary:!0})),i||(i=ye(ti(t.coordinates[o],t.coordinates[o+1]),e,{ignoreBoundary:!0}))}return i}(r,n);default:throw new Error("feature2 "+o+" geometry not supported")}case"Polygon":switch(o){case"Polygon":case"MultiPolygon":return function(t,e){var r=J(t);if(!Kn(J(e),r))return!1;for(var n=0;n<t.coordinates[0].length;n++)if(!ye(t.coordinates[0][n],e))return!1;return!0}(r,n);default:throw new Error("feature2 "+o+" geometry not supported")}default:throw new Error("feature1 "+i+" geometry not supported")}}function Kn(t,e){return!(t[0]>e[0])&&!(t[2]<e[2])&&!(t[1]>e[1])&&!(t[3]<e[3])}function Qn(t,e){return t[0]===e[0]&&t[1]===e[1]}function ti(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]}function ei(t,e,r){void 0===r&&(r={}),r.mask&&!r.units&&(r.units="kilometers");for(var n=[],i=t[0],o=t[1],s=t[2],a=t[3],u=e/xe([i,o],[s,o],r)*(s-i),c=e/xe([i,o],[i,a],r)*(a-o),h=s-i,p=a-o,f=Math.floor(h/u),m=(p-Math.floor(p/c)*c)/2,g=i+(h-f*u)/2;g<=s;){for(var y=o+m;y<=a;){var _=l([g,y],r.properties);r.mask?Jn(_,r.mask)&&n.push(_):n.push(_),y+=c}g+=u}return d(n)}function ri(t,e){void 0===e&&(e={});var r=e.precision,n=e.coordinates,i=e.mutate;if(r=null==r||isNaN(r)?6:r,n=null==n||isNaN(n)?3:n,!t)throw new Error("<geojson> is required");if("number"!=typeof r)throw new Error("<precision> must be a number");if("number"!=typeof n)throw new Error("<coordinates> must be a number");!1!==i&&void 0!==i||(t=JSON.parse(JSON.stringify(t)));var o=Math.pow(10,r);return z(t,function(t){!function(t,e,r){t.length>r&&t.splice(r,t.length);for(var n=0;n<t.length;n++)t[n]=Math.round(t[n]*e)/e}(t,o,n)}),t}function ni(t){if(!t)throw new Error("geojson is required");var e=[];return V(t,function(t){e.push(t)}),d(e)}function ii(t,e,r){if("Polygon"!==t.geometry.type)throw new Error("The input feature must be a Polygon");void 0===r&&(r=1);var n=t.geometry.coordinates,i=[],o={};if(r){for(var s=[],a=0;a<n.length;a++)for(var l=0;l<n[a].length-1;l++)s.push(m(a,l));var u=Tt();u.load(s)}for(var c=0;c<n.length;c++)for(var h=0;h<n[c].length-1;h++)if(r)u.search(m(c,h)).forEach(function(t){var e=t.ring,r=t.edge;d(c,h,e,r)});else for(var p=0;p<n.length;p++)for(var f=0;f<n[p].length-1;f++)d(c,h,p,f);return e||(i={type:"Feature",geometry:{type:"MultiPoint",coordinates:i}}),i;function d(t,r,s,a){var l,u,c=n[t][r],h=n[t][r+1],p=n[s][a],f=n[s][a+1],d=function(t,e,r,n){if(oi(t,r)||oi(t,n)||oi(e,r)||oi(n,r))return null;var i=t[0],o=t[1],s=e[0],a=e[1],l=r[0],u=r[1],c=n[0],h=n[1],p=(i-s)*(u-h)-(o-a)*(l-c);return 0===p?null:[((i*a-o*s)*(l-c)-(i-s)*(l*h-u*c))/p,((i*a-o*s)*(u-h)-(o-a)*(l*h-u*c))/p]}(c,h,p,f);if(null!==d&&(l=h[0]!==c[0]?(d[0]-c[0])/(h[0]-c[0]):(d[1]-c[1])/(h[1]-c[1]),u=f[0]!==p[0]?(d[0]-p[0])/(f[0]-p[0]):(d[1]-p[1])/(f[1]-p[1]),!(l>=1||l<=0||u>=1||u<=0))){var m=d,g=!o[m];g&&(o[m]=!0),e?i.push(e(d,t,r,c,h,l,s,a,p,f,u,g)):i.push(d)}}function m(t,e){var r,i,o,s,a=n[t][e],l=n[t][e+1];return a[0]<l[0]?(r=a[0],i=l[0]):(r=l[0],i=a[0]),a[1]<l[1]?(o=a[1],s=l[1]):(o=l[1],s=a[1]),{minX:r,minY:o,maxX:i,maxY:s,ring:t,edge:e}}}function oi(t,e){if(!t||!e)return!1;if(t.length!==e.length)return!1;for(var r=0,n=t.length;r<n;r++)if(t[r]instanceof Array&&e[r]instanceof Array){if(!oi(t[r],e[r]))return!1}else if(t[r]!==e[r])return!1;return!0}function si(t){if("Feature"!=t.type)throw new Error("The input must a geojson object of type Feature");if(void 0===t.geometry||null==t.geometry)throw new Error("The input must a geojson object with a non-empty geometry");if("Polygon"!=t.geometry.type)throw new Error("The input must be a geojson Polygon");for(var e=t.geometry.coordinates.length,r=[],n=0;n<e;n++){var i=t.geometry.coordinates[n];hi(i[0],i[i.length-1])||i.push(i[0]),r.push.apply(r,i.slice(0,i.length-1))}if(!function(t){for(var e={},r=1,n=0,i=t.length;n<i;++n){if(Object.prototype.hasOwnProperty.call(e,t[n])){r=0;break}e[t[n]]=1}return r}(r))throw new Error("The input polygon may not have duplicate vertices (except for the first and last vertex of each ring)");var o=r.length,s=ii(t,function(t,e,r,n,i,o,s,a,l,u,c,h){return[t,e,r,n,i,o,s,a,l,u,c,h]}),a=s.length;if(0==a){var l=[];for(n=0;n<e;n++)l.push(c([t.geometry.coordinates[n]],{parent:-1,winding:ci(t.geometry.coordinates[n])}));var u=d(l);return F(),B(),u}var h=[],p=[];for(n=0;n<e;n++){h.push([]);for(var f=0;f<t.geometry.coordinates[n].length-1;f++)h[n].push([new ai(t.geometry.coordinates[n][pi(f+1,t.geometry.coordinates[n].length-1)],1,[n,f],[n,pi(f+1,t.geometry.coordinates[n].length-1)],void 0)]),p.push(new li(t.geometry.coordinates[n][f],[n,pi(f-1,t.geometry.coordinates[n].length-1)],[n,f],void 0,void 0,!1,!0))}for(n=0;n<a;n++)h[s[n][1]][s[n][2]].push(new ai(s[n][0],s[n][5],[s[n][1],s[n][2]],[s[n][6],s[n][7]],void 0)),s[n][11]&&p.push(new li(s[n][0],[s[n][1],s[n][2]],[s[n][6],s[n][7]],void 0,void 0,!0,!0));var m=p.length;for(n=0;n<h.length;n++)for(f=0;f<h[n].length;f++)h[n][f].sort(function(t,e){return t.param<e.param?-1:1});var g=[];for(n=0;n<m;n++)g.push({minX:p[n].coord[0],minY:p[n].coord[1],maxX:p[n].coord[0],maxY:p[n].coord[1],index:n});var y=Tt();for(y.load(g),n=0;n<h.length;n++)for(f=0;f<h[n].length;f++)for(var _=0;_<h[n][f].length;_++){x=_==h[n][f].length-1?h[n][pi(f+1,t.geometry.coordinates[n].length-1)][0].coord:h[n][f][_+1].coord;var v=y.search({minX:x[0],minY:x[1],maxX:x[0],maxY:x[1]})[0];h[n][f][_].nxtIsectAlongEdgeIn=v.index}for(n=0;n<h.length;n++)for(f=0;f<h[n].length;f++)for(_=0;_<h[n][f].length;_++){var x=h[n][f][_].coord,b=(v=y.search({minX:x[0],minY:x[1],maxX:x[0],maxY:x[1]})[0]).index;b<o?p[b].nxtIsectAlongRingAndEdge2=h[n][f][_].nxtIsectAlongEdgeIn:hi(p[b].ringAndEdge1,h[n][f][_].ringAndEdgeIn)?p[b].nxtIsectAlongRingAndEdge1=h[n][f][_].nxtIsectAlongEdgeIn:p[b].nxtIsectAlongRingAndEdge2=h[n][f][_].nxtIsectAlongEdgeIn}var w=[];for(n=0,f=0;f<e;f++){var E=n;for(_=0;_<t.geometry.coordinates[f].length-1;_++)p[n].coord[0]<p[E].coord[0]&&(E=n),n++;var S=p[E].nxtIsectAlongRingAndEdge2;for(_=0;_<p.length;_++)if(p[_].nxtIsectAlongRingAndEdge1==E||p[_].nxtIsectAlongRingAndEdge2==E){var I=_;break}var T=ui([p[I].coord,p[E].coord,p[S].coord],!0)?1:-1;w.push({isect:E,parent:-1,winding:T})}for(w.sort(function(t,e){return p[t.isect].coord>p[e.isect].coord?-1:1}),l=[];w.length>0;){var C=w.pop(),M=C.isect,A=C.parent,P=C.winding,k=l.length,L=[p[M].coord],z=M;if(p[M].ringAndEdge1Walkable)var D=p[M].ringAndEdge1,R=p[M].nxtIsectAlongRingAndEdge1;else D=p[M].ringAndEdge2,R=p[M].nxtIsectAlongRingAndEdge2;for(;!hi(p[M].coord,p[R].coord);){L.push(p[R].coord);var O=void 0;for(n=0;n<w.length;n++)if(w[n].isect==R){O=n;break}if(null!=O&&w.splice(O,1),hi(D,p[R].ringAndEdge1)){if(D=p[R].ringAndEdge2,p[R].ringAndEdge2Walkable=!1,p[R].ringAndEdge1Walkable){var N={isect:R};ui([p[z].coord,p[R].coord,p[p[R].nxtIsectAlongRingAndEdge2].coord],1==P)?(N.parent=A,N.winding=-P):(N.parent=k,N.winding=P),w.push(N)}z=R,R=p[R].nxtIsectAlongRingAndEdge2}else D=p[R].ringAndEdge1,p[R].ringAndEdge1Walkable=!1,p[R].ringAndEdge2Walkable&&(N={isect:R},ui([p[z].coord,p[R].coord,p[p[R].nxtIsectAlongRingAndEdge1].coord],1==P)?(N.parent=A,N.winding=-P):(N.parent=k,N.winding=P),w.push(N)),z=R,R=p[R].nxtIsectAlongRingAndEdge1}L.push(p[R].coord),l.push(c([L],{index:k,parent:A,winding:P,netWinding:void 0}))}function F(){for(var t=[],e=0;e<u.features.length;e++)-1==u.features[e].properties.parent&&t.push(e);if(t.length>1)for(e=0;e<t.length;e++){for(var r=-1,n=0;n<u.features.length;n++)t[e]!=n&&ye(u.features[t[e]].geometry.coordinates[0][0],u.features[n],{ignoreBoundary:!0})&&Gn(u.features[n])<1/0&&(r=n);u.features[t[e]].properties.parent=r}}function B(){for(var t=0;t<u.features.length;t++)if(-1==u.features[t].properties.parent){var e=u.features[t].properties.winding;u.features[t].properties.netWinding=e,j(t,e)}}function j(t,e){for(var r=0;r<u.features.length;r++)if(u.features[r].properties.parent==t){var n=e+u.features[r].properties.winding;u.features[r].properties.netWinding=n,j(r,n)}}return u=d(l),F(),B(),u}var ai=function(t,e,r,n,i){this.coord=t,this.param=e,this.ringAndEdgeIn=r,this.ringAndEdgeOut=n,this.nxtIsectAlongEdgeIn=i},li=function(t,e,r,n,i,o,s){this.coord=t,this.ringAndEdge1=e,this.ringAndEdge2=r,this.nxtIsectAlongRingAndEdge1=n,this.nxtIsectAlongRingAndEdge2=i,this.ringAndEdge1Walkable=o,this.ringAndEdge2Walkable=s};function ui(t,e){if(void 0===e&&(e=!0),3!=t.length)throw new Error("This function requires an array of three points [x,y]");return(t[1][0]-t[0][0])*(t[2][1]-t[0][1])-(t[1][1]-t[0][1])*(t[2][0]-t[0][0])>=0==e}function ci(t){for(var e=0,r=0;r<t.length-1;r++)t[r][0]<t[e][0]&&(e=r);if(ui([t[pi(e-1,t.length-1)],t[e],t[pi(e+1,t.length-1)]],!0))var n=1;else n=-1;return n}function hi(t,e){if(!t||!e)return!1;if(t.length!=e.length)return!1;for(var r=0,n=t.length;r<n;r++)if(t[r]instanceof Array&&e[r]instanceof Array){if(!hi(t[r],e[r]))return!1}else if(t[r]!=e[r])return!1;return!0}function pi(t,e){return(t%e+e)%e}var fi=Math.PI/180,di=180/Math.PI,mi=function(t,e){this.lon=t,this.lat=e,this.x=fi*t,this.y=fi*e};mi.prototype.view=function(){return String(this.lon).slice(0,4)+","+String(this.lat).slice(0,4)},mi.prototype.antipode=function(){var t=-1*this.lat,e=this.lon<0?180+this.lon:-1*(180-this.lon);return new mi(e,t)};var gi=function(){this.coords=[],this.length=0};gi.prototype.move_to=function(t){this.length++,this.coords.push(t)};var yi=function(t){this.properties=t||{},this.geometries=[]};yi.prototype.json=function(){if(this.geometries.length<=0)return{geometry:{type:"LineString",coordinates:null},type:"Feature",properties:this.properties};if(1===this.geometries.length)return{geometry:{type:"LineString",coordinates:this.geometries[0].coords},type:"Feature",properties:this.properties};for(var t=[],e=0;e<this.geometries.length;e++)t.push(this.geometries[e].coords);return{geometry:{type:"MultiLineString",coordinates:t},type:"Feature",properties:this.properties}},yi.prototype.wkt=function(){for(var t="",e="LINESTRING(",r=function(t){e+=t[0]+" "+t[1]+","},n=0;n<this.geometries.length;n++){if(0===this.geometries[n].coords.length)return"LINESTRING(empty)";this.geometries[n].coords.forEach(r),t+=e.substring(0,e.length-1)+")"}return t};var _i=function(t,e,r){if(!t||void 0===t.x||void 0===t.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");if(!e||void 0===e.x||void 0===e.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");this.start=new mi(t.x,t.y),this.end=new mi(e.x,e.y),this.properties=r||{};var n=this.start.x-this.end.x,i=this.start.y-this.end.y,o=Math.pow(Math.sin(i/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin(n/2),2);if(this.g=2*Math.asin(Math.sqrt(o)),this.g===Math.PI)throw new Error("it appears "+t.view()+" and "+e.view()+" are 'antipodal', e.g diametrically opposite, thus there is no single route but rather infinite");if(isNaN(this.g))throw new Error("could not calculate great circle between "+t+" and "+e)};function vi(t,e){var r=[],n=Pn();return V(e,function(e){if(r.forEach(function(t,e){t.id=e}),r.length){var i=n.search(e);if(i.features.length){var o=bi(e,i);r=r.filter(function(t){return t.id!==o.id}),n.remove(o),N(xi(o,e),function(t){r.push(t),n.insert(t)})}}else(r=xi(t,e).features).forEach(function(t){t.bbox||(t.bbox=gr(J(t)))}),n.load(d(r))}),d(r)}function xi(t,e){var r=[],n=Q(t)[0],i=Q(t)[t.geometry.coordinates.length-1];if(wi(n,K(e))||wi(i,K(e)))return d([t]);var o=Pn(),s=Hr(t);o.load(s);var a=o.search(e);if(!a.features.length)return d([t]);var l=bi(e,a),u=F(s,function(t,n,i){var o=Q(n)[1],s=K(e);return i===l.id?(t.push(s),r.push(p(t)),wi(s,o)?[s]:[s,o]):(t.push(o),t)},[n]);return u.length>1&&r.push(p(u)),d(r)}function bi(t,e){if(!e.features.length)throw new Error("lines must contain features");if(1===e.features.length)return e.features[0];var r,n=1/0;return N(e,function(e){var i=Dn(e,t).properties.dist;i<n&&(r=e,n=i)}),r}function wi(t,e){return t[0]===e[0]&&t[1]===e[1]}function Ei(t,e,r,n,i){void 0===i&&(i={});var o=i.steps||64,s=Si(r),a=Si(n),l=Array.isArray(t)||"Feature"!==t.type?{}:t.properties;if(s===a)return p(_r(t,e,i).geometry.coordinates[0],l);for(var u=s,c=s<a?a:a+360,h=u,f=[],d=0;h<c;)f.push(yr(t,e,h,i).geometry.coordinates),h=u+360*++d/o;return h>c&&f.push(yr(t,e,c,i).geometry.coordinates),p(f,l)}function Si(t){var e=t%360;return e<0&&(e+=360),e}function Ii(t,e){void 0===e&&(e={});var r=it(t);switch(e.properties||"Feature"!==t.type||(e.properties=t.properties),r.type){case"Polygon":return Ti(r,e);case"MultiPolygon":return function(t,e){void 0===e&&(e={});var r=it(t).coordinates,n=e.properties?e.properties:"Feature"===t.type?t.properties:{},i=[];return r.forEach(function(t){i.push(Ci(t,n))}),d(i)}(r,e);default:throw new Error("invalid poly")}}function Ti(t,e){return void 0===e&&(e={}),Ci(it(t).coordinates,e.properties?e.properties:"Feature"===t.type?t.properties:{})}function Ci(t,e){return t.length>1?m(t,e):p(t[0],e)}function Mi(t,e){var r,n,i;void 0===e&&(e={});var o=e.properties,s=null===(r=e.autoComplete)||void 0===r||r,a=null===(n=e.orderCoords)||void 0===n||n;switch(null!==(i=e.mutate)&&void 0!==i&&i||(t=Ie(t)),t.type){case"FeatureCollection":var l=[];return t.features.forEach(function(t){l.push(Q(Ai(t,{},s,a)))}),y(l,o);default:return Ai(t,o,s,a)}}function Ai(t,e,r,n){e=e||("Feature"===t.type?t.properties:{});var i=it(t),o=i.coordinates,s=i.type;if(!o.length)throw new Error("line must contain coordinates");switch(s){case"LineString":return r&&(o=Pi(o)),c([o],e);case"MultiLineString":var a=[],l=0;return o.forEach(function(t){if(r&&(t=Pi(t)),n){var e=function(t){var e=t[0],r=t[1],n=t[2],i=t[3];return Math.abs(e-n)*Math.abs(r-i)}(J(p(t)));e>l?(a.unshift(t),l=e):a.push(t)}else a.push(t)}),c(a,e);default:throw new Error("geometry type "+s+" is not supported")}}function Pi(t){var e=t[0],r=e[0],n=e[1],i=t[t.length-1],o=i[0],s=i[1];return r===o&&n===s||t.push(e),t}function ki(t,e){var r,n,i,o,s,a,l;for(n=1;n<=8;n*=2){for(r=[],o=!(zi(i=t[t.length-1],e)&n),s=0;s<t.length;s++)(l=!(zi(a=t[s],e)&n))!==o&&r.push(Li(i,a,n,e)),l&&r.push(a),i=a,o=l;if(!(t=r).length)break}return r}function Li(t,e,r,n){return 8&r?[t[0]+(e[0]-t[0])*(n[3]-t[1])/(e[1]-t[1]),n[3]]:4&r?[t[0]+(e[0]-t[0])*(n[1]-t[1])/(e[1]-t[1]),n[1]]:2&r?[n[2],t[1]+(e[1]-t[1])*(n[2]-t[0])/(e[0]-t[0])]:1&r?[n[0],t[1]+(e[1]-t[1])*(n[0]-t[0])/(e[0]-t[0])]:null}function zi(t,e){var r=0;return t[0]<e[0]?r|=1:t[0]>e[2]&&(r|=2),t[1]<e[1]?r|=4:t[1]>e[3]&&(r|=8),r}function Di(t,e){for(var r=[],n=0,i=t;n<i.length;n++){var o=ki(i[n],e);o.length>0&&(o[0][0]===o[o.length-1][0]&&o[0][1]===o[o.length-1][1]||o.push(o[0]),o.length>=4&&r.push(o))}return r}_i.prototype.interpolate=function(t){var e=Math.sin((1-t)*this.g)/Math.sin(this.g),r=Math.sin(t*this.g)/Math.sin(this.g),n=e*Math.cos(this.start.y)*Math.cos(this.start.x)+r*Math.cos(this.end.y)*Math.cos(this.end.x),i=e*Math.cos(this.start.y)*Math.sin(this.start.x)+r*Math.cos(this.end.y)*Math.sin(this.end.x),o=e*Math.sin(this.start.y)+r*Math.sin(this.end.y),s=di*Math.atan2(o,Math.sqrt(Math.pow(n,2)+Math.pow(i,2)));return[di*Math.atan2(i,n),s]},_i.prototype.Arc=function(t,e){var r=[];if(!t||t<=2)r.push([this.start.lon,this.start.lat]),r.push([this.end.lon,this.end.lat]);else for(var n=1/(t-1),i=0;i<t;++i){var o=n*i,s=this.interpolate(o);r.push(s)}for(var a=!1,l=0,u=e&&e.offset?e.offset:10,c=180-u,h=-180+u,p=360-u,f=1;f<r.length;++f){var d=r[f-1][0],m=r[f][0],g=Math.abs(m-d);g>p&&(m>c&&d<h||d>c&&m<h)?a=!0:g>l&&(l=g)}var y=[];if(a&&l<u){var _=[];y.push(_);for(var v=0;v<r.length;++v){var x=parseFloat(r[v][0]);if(v>0&&Math.abs(x-r[v-1][0])>p){var b=parseFloat(r[v-1][0]),w=parseFloat(r[v-1][1]),E=parseFloat(r[v][0]),S=parseFloat(r[v][1]);if(b>-180&&b<h&&180===E&&v+1<r.length&&r[v-1][0]>-180&&r[v-1][0]<h){_.push([-180,r[v][1]]),v++,_.push([r[v][0],r[v][1]]);continue}if(b>c&&b<180&&-180===E&&v+1<r.length&&r[v-1][0]>c&&r[v-1][0]<180){_.push([180,r[v][1]]),v++,_.push([r[v][0],r[v][1]]);continue}if(b<h&&E>c){var I=b;b=E,E=I;var T=w;w=S,S=T}if(b>c&&E<h&&(E+=360),b<=180&&E>=180&&b<E){var C=(180-b)/(E-b),M=C*S+(1-C)*w;_.push([r[v-1][0]>c?180:-180,M]),(_=[]).push([r[v-1][0]>c?-180:180,M]),y.push(_)}else _=[],y.push(_);_.push([x,r[v][1]])}else _.push([r[v][0],r[v][1]])}}else{var A=[];y.push(A);for(var P=0;P<r.length;++P)A.push([r[P][0],r[P][1]])}for(var k=new yi(this.properties),L=0;L<y.length;++L){var z=new gi;k.geometries.push(z);for(var D=y[L],R=0;R<D.length;++R)z.move_to(D[R])}return k};var Ri=Ut(function(t,e){function r(t){var e=[];for(var r in t)e.push(r);return e}(t.exports="function"==typeof Object.keys?Object.keys:r).shim=r}),Oi=Ut(function(t,e){var r="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();function n(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function i(t){return t&&"object"==typeof t&&"number"==typeof t.length&&Object.prototype.hasOwnProperty.call(t,"callee")&&!Object.prototype.propertyIsEnumerable.call(t,"callee")||!1}(e=t.exports=r?n:i).supported=n,e.unsupported=i}),Ni=Ut(function(t){var e=Array.prototype.slice,r=t.exports=function(t,o,s){return s||(s={}),t===o||(t instanceof Date&&o instanceof Date?t.getTime()===o.getTime():!t||!o||"object"!=typeof t&&"object"!=typeof o?s.strict?t===o:t==o:function(t,o,s){var a,l;if(n(t)||n(o))return!1;if(t.prototype!==o.prototype)return!1;if(Oi(t))return!!Oi(o)&&(t=e.call(t),o=e.call(o),r(t,o,s));if(i(t)){if(!i(o))return!1;if(t.length!==o.length)return!1;for(a=0;a<t.length;a++)if(t[a]!==o[a])return!1;return!0}try{var u=Ri(t),c=Ri(o)}catch(t){return!1}if(u.length!=c.length)return!1;for(u.sort(),c.sort(),a=u.length-1;a>=0;a--)if(u[a]!=c[a])return!1;for(a=u.length-1;a>=0;a--)if(l=u[a],!r(t[l],o[l],s))return!1;return typeof t==typeof o}(t,o,s))};function n(t){return null==t}function i(t){return!(!t||"object"!=typeof t||"number"!=typeof t.length)&&"function"==typeof t.copy&&"function"==typeof t.slice&&!(t.length>0&&"number"!=typeof t[0])}});function Fi(t,e,r){if(void 0===r&&(r={}),!A(r=r||{}))throw new Error("options is invalid");var n,i=r.tolerance||0,o=[],s=Pn(),a=Hr(t);return s.load(a),q(e,function(t){var e=!1;t&&(N(s.search(t),function(r){if(!1===e){var o=Q(t).sort(),s=Q(r).sort();Ni(o,s)||(0===i?Yn(o[0],r)&&Yn(o[1],r):Dn(r,o[0]).properties.dist<=i&&Dn(r,o[1]).properties.dist<=i)?(e=!0,n=n?Bi(n,t):t):(0===i?Yn(s[0],t)&&Yn(s[1],t):Dn(t,s[0]).properties.dist<=i&&Dn(t,s[1]).properties.dist<=i)&&(n=n?Bi(n,r):r)}}),!1===e&&n&&(o.push(n),n=void 0))}),n&&o.push(n),d(o)}function Bi(t,e){var r=Q(e),n=Q(t),i=n[0],o=n[n.length-1],s=t.geometry.coordinates;return Ni(r[0],i)?s.unshift(r[1]):Ni(r[0],o)?s.push(r[1]):Ni(r[1],i)?s.unshift(r[0]):Ni(r[1],o)&&s.push(r[0]),t}function ji(t){var e=t%360;return e<0&&(e+=360),e}function Ui(t,e,r){var n;return void 0===r&&(r={}),(n=r.final?Vi(K(e),K(t)):Vi(K(t),K(e)))>180?-(360-n):n}function Vi(t,e){var r=I(t[1]),n=I(e[1]),i=I(e[0]-t[0]);i>Math.PI&&(i-=2*Math.PI),i<-Math.PI&&(i+=2*Math.PI);var o=Math.log(Math.tan(n/2+Math.PI/4)/Math.tan(r/2+Math.PI/4));return(S(Math.atan2(i,o))+360)%360}function Gi(t,e,n,i){void 0===i&&(i={});var o=e<0,s=T(Math.abs(e),i.units,"meters");o&&(s=-Math.abs(s));var a=K(t),u=function(t,e,n,i){i=void 0===i?r:Number(i);var o=e/i,s=t[0]*Math.PI/180,a=I(t[1]),l=I(n),u=o*Math.cos(l),c=a+u;Math.abs(c)>Math.PI/2&&(c=c>0?Math.PI-c:-Math.PI-c);var h=Math.log(Math.tan(c/2+Math.PI/4)/Math.tan(a/2+Math.PI/4)),p=Math.abs(h)>1e-11?u/h:Math.cos(a),f=o*Math.sin(l)/p;return[(180*(s+f)/Math.PI+540)%360-180,180*c/Math.PI]}(a,s,n);return u[0]+=u[0]-a[0]>180?-360:a[0]-u[0]>180?360:0,l(u,i.properties)}function qi(t,e,r,n,i,o){for(var s=0;s<t.length;s++){var a=t[s],l=t[s+1];s===t.length-1&&(l=t[0]),n=Zi(a,l,e),r<=0&&n>0?Zi(e,a,i)<0||(i=a):r>0&&n<=0&&($i(e,a,o)||(o=a)),r=n}return[i,o]}function $i(t,e,r){return Zi(t,e,r)>0}function Zi(t,e,r){return(e[0]-t[0])*(r[1]-t[1])-(r[0]-t[0])*(e[1]-t[1])}function Xi(t){for(var e,r,n=Q(t),i=0,o=1;o<n.length;)e=r||n[0],i+=((r=n[o])[0]-e[0])*(r[1]+e[1]),o++;return i>0}function Wi(t,e){switch("Feature"===t.type?t.geometry.type:t.type){case"GeometryCollection":return j(t,function(t){Wi(t,e)}),t;case"LineString":return Yi(Q(t),e),t;case"Polygon":return Hi(Q(t),e),t;case"MultiLineString":return Q(t).forEach(function(t){Yi(t,e)}),t;case"MultiPolygon":return Q(t).forEach(function(t){Hi(t,e)}),t;case"Point":case"MultiPoint":return t}}function Yi(t,e){Xi(t)===e&&t.reverse()}function Hi(t,e){Xi(t[0])!==e&&t[0].reverse();for(var r=1;r<t.length;r++)Xi(t[r])===e&&t[r].reverse()}function Ji(t,e){if(!A(e=e||{}))throw new Error("options is invalid");var r=e.zProperty||"elevation",n=e.flip,i=e.flags;nt(t,"Point","input must contain Points");for(var o=function(t,e){var r={};return N(t,function(t){var e=Q(t)[1];r[e]||(r[e]=[]),r[e].push(t)}),Object.keys(r).map(function(t){return r[t].sort(function(t,e){return Q(t)[0]-Q(e)[0]})}).sort(function(t,r){return e?Q(t[0])[1]-Q(r[0])[1]:Q(r[0])[1]-Q(t[0])[1]})}
/*!
     * @license GNU Affero General Public License.
     * Copyright (c) 2015, 2015 Ronny Lorenz <ronny@tbi.univie.ac.at>
     * v. 1.2.0
     * https://github.com/RaumZeit/MarchingSquares.js
     *
     * MarchingSquaresJS is free software: you can redistribute it and/or modify
     * it under the terms of the GNU Affero General Public License as published by
     * the Free Software Foundation, either version 3 of the License, or
     * (at your option) any later version.
     *
     * MarchingSquaresJS is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
     * GNU Affero General Public License for more details.
     *
     * As additional permission under GNU Affero General Public License version 3
     * section 7, third-party projects (personal or commercial) may distribute,
     * include, or link against UNMODIFIED VERSIONS of MarchingSquaresJS without the
     * requirement that said third-party project for that reason alone becomes
     * subject to any requirement of the GNU Affero General Public License version 3.
     * Any modifications to MarchingSquaresJS, however, must be shared with the public
     * and made available.
     *
     * In summary this:
     * - allows you to use MarchingSquaresJS at no cost
     * - allows you to use MarchingSquaresJS for both personal and commercial purposes
     * - allows you to distribute UNMODIFIED VERSIONS of MarchingSquaresJS under any
     *   license as long as this license notice is included
     * - enables you to keep the source code of your program that uses MarchingSquaresJS
     *   undisclosed
     * - forces you to share any modifications you have made to MarchingSquaresJS,
     *   e.g. bug-fixes
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with MarchingSquaresJS.  If not, see <http://www.gnu.org/licenses/>.
     */(t,n),s=[],a=0;a<o.length;a++){for(var l=o[a],u=[],c=0;c<l.length;c++){var h=l[c];h.properties[r]?u.push(h.properties[r]):u.push(0),!0===i&&(h.properties.matrixPosition=[a,c])}s.push(u)}return s}var Ki={successCallback:null,verbose:!1,polygons:!1},Qi={};function to(t,e,r,n){n=n||{};for(var i=Object.keys(Ki),o=0;o<i.length;o++){var s=i[o],a=n[s];a=null!=a?a:Ki[s],Qi[s]=a}Qi.verbose&&console.log("MarchingSquaresJS-isoBands: computing isobands for ["+e+":"+(e+r)+"]");var l,u=function(t,e,r){for(var n=t.length-1,i=t[0].length-1,o={rows:n,cols:i,cells:[]},s=e+Math.abs(r),a=0;a<n;++a){o.cells[a]=[];for(var l=0;l<i;++l){var u=0,c=t[a+1][l],h=t[a+1][l+1],p=t[a][l+1],f=t[a][l];if(!(isNaN(c)||isNaN(h)||isNaN(p)||isNaN(f))){u|=c<e?0:c>s?128:64,u|=h<e?0:h>s?32:16,u|=p<e?0:p>s?8:4;var d=+(u|=f<e?0:f>s?2:1),m=0;if(17===u||18===u||33===u||34===u||38===u||68===u||72===u||98===u||102===u||132===u||136===u||137===u||152===u||153===u){var g=(c+h+p+f)/4;m=g>s?2:g<e?0:1,34===u?1===m?u=35:0===m&&(u=136):136===u?1===m?(u=35,m=4):0===m&&(u=34):17===u?1===m?(u=155,m=4):0===m&&(u=153):68===u?1===m?(u=103,m=4):0===m&&(u=102):153===u?1===m&&(u=155):102===u?1===m&&(u=103):152===u?m<2&&(u=156,m=1):137===u?m<2&&(u=139,m=1):98===u?m<2&&(u=99,m=1):38===u?m<2&&(u=39,m=1):18===u?m>0?(u=156,m=4):u=152:33===u?m>0?(u=139,m=4):u=137:72===u?m>0?(u=99,m=4):u=98:132===u&&(m>0?(u=39,m=4):u=38)}if(0!=u&&170!=u){var y,_,v,x,b,w,E,S;y=_=v=x=b=w=E=S=.5;var I=[];1===u?(v=1-$o(e,p,f),S=1-$o(e,c,f),I.push(Bo[u])):169===u?(v=$o(s,f,p),S=$o(s,f,c),I.push(Bo[u])):4===u?(w=1-$o(e,h,p),x=$o(e,f,p),I.push(No[u])):166===u?(w=$o(s,p,h),x=1-$o(s,p,f),I.push(No[u])):16===u?(b=$o(e,p,h),_=$o(e,c,h),I.push(Oo[u])):154===u?(b=1-$o(s,h,p),_=1-$o(s,h,c),I.push(Oo[u])):64===u?(E=$o(e,f,c),y=1-$o(e,h,c),I.push(Uo[u])):106===u?(E=1-$o(s,c,f),y=$o(s,c,h),I.push(Uo[u])):168===u?(x=$o(s,f,p),v=$o(e,f,p),S=$o(e,f,c),E=$o(s,f,c),I.push(Fo[u]),I.push(Bo[u])):2===u?(x=1-$o(e,p,f),v=1-$o(s,p,f),S=1-$o(s,c,f),E=1-$o(e,c,f),I.push(Fo[u]),I.push(Bo[u])):162===u?(b=$o(s,p,h),w=$o(e,p,h),x=1-$o(e,p,f),v=1-$o(s,p,f),I.push(Fo[u]),I.push(Bo[u])):8===u?(b=1-$o(e,h,p),w=1-$o(s,h,p),x=$o(s,f,p),v=$o(e,f,p),I.push(Oo[u]),I.push(No[u])):138===u?(b=1-$o(e,h,p),w=1-$o(s,h,p),y=1-$o(s,h,c),_=1-$o(e,h,c),I.push(Oo[u]),I.push(No[u])):32===u?(b=$o(s,p,h),w=$o(e,p,h),y=$o(e,c,h),_=$o(s,c,h),I.push(Oo[u]),I.push(No[u])):42===u?(S=1-$o(s,c,f),E=1-$o(e,c,f),y=$o(e,c,h),_=$o(s,c,h),I.push(jo[u]),I.push(Uo[u])):128===u&&(S=$o(e,f,c),E=$o(s,f,c),y=1-$o(s,h,c),_=1-$o(e,h,c),I.push(jo[u]),I.push(Uo[u])),5===u?(w=1-$o(e,h,p),S=1-$o(e,c,f),I.push(No[u])):165===u?(w=$o(s,p,h),S=$o(s,f,c),I.push(No[u])):20===u?(x=$o(e,f,p),_=$o(e,c,h),I.push(Fo[u])):150===u?(x=1-$o(s,p,f),_=1-$o(s,h,c),I.push(Fo[u])):80===u?(b=$o(e,p,h),E=$o(e,f,c),I.push(Oo[u])):90===u?(b=1-$o(s,h,p),E=1-$o(s,c,f),I.push(Oo[u])):65===u?(v=1-$o(e,p,f),y=1-$o(e,h,c),I.push(Bo[u])):105===u?(v=$o(s,f,p),y=$o(s,c,h),I.push(Bo[u])):160===u?(b=$o(s,p,h),w=$o(e,p,h),S=$o(e,f,c),E=$o(s,f,c),I.push(Oo[u]),I.push(No[u])):10===u?(b=1-$o(e,h,p),w=1-$o(s,h,p),S=1-$o(s,c,f),E=1-$o(e,c,f),I.push(Oo[u]),I.push(No[u])):130===u?(x=1-$o(e,p,f),v=1-$o(s,p,f),y=1-$o(s,h,c),_=1-$o(e,h,c),I.push(Fo[u]),I.push(Bo[u])):40===u?(x=$o(s,f,p),v=$o(e,f,p),y=$o(e,c,h),_=$o(s,c,h),I.push(Fo[u]),I.push(Bo[u])):101===u?(w=$o(s,p,h),y=$o(s,c,h),I.push(No[u])):69===u?(w=1-$o(e,h,p),y=1-$o(e,h,c),I.push(No[u])):149===u?(S=$o(s,f,c),_=1-$o(s,h,c),I.push(jo[u])):21===u?(S=1-$o(e,c,f),_=$o(e,c,h),I.push(jo[u])):86===u?(x=1-$o(s,p,f),E=1-$o(s,c,f),I.push(Fo[u])):84===u?(x=$o(e,f,p),E=$o(e,f,c),I.push(Fo[u])):89===u?(b=1-$o(s,h,p),v=$o(s,f,p),I.push(Bo[u])):81===u?(b=$o(e,p,h),v=1-$o(e,p,f),I.push(Bo[u])):96===u?(b=$o(s,p,h),w=$o(e,p,h),E=$o(e,f,c),y=$o(s,c,h),I.push(Oo[u]),I.push(No[u])):74===u?(b=1-$o(e,h,p),w=1-$o(s,h,p),E=1-$o(s,c,f),y=1-$o(e,h,c),I.push(Oo[u]),I.push(No[u])):24===u?(b=1-$o(s,h,p),x=$o(s,f,p),v=$o(e,f,p),_=$o(e,c,h),I.push(Oo[u]),I.push(Bo[u])):146===u?(b=$o(e,p,h),x=1-$o(e,p,f),v=1-$o(s,p,f),_=1-$o(s,h,c),I.push(Oo[u]),I.push(Bo[u])):6===u?(w=1-$o(e,h,p),x=1-$o(s,p,f),S=1-$o(s,c,f),E=1-$o(e,c,f),I.push(No[u]),I.push(Fo[u])):164===u?(w=$o(s,p,h),x=$o(e,f,p),S=$o(e,f,c),E=$o(s,f,c),I.push(No[u]),I.push(Fo[u])):129===u?(v=1-$o(e,p,f),S=$o(s,f,c),y=1-$o(s,h,c),_=1-$o(e,h,c),I.push(Bo[u]),I.push(jo[u])):41===u?(v=$o(s,f,p),S=1-$o(e,c,f),y=$o(e,c,h),_=$o(s,c,h),I.push(Bo[u]),I.push(jo[u])):66===u?(x=1-$o(e,p,f),v=1-$o(s,p,f),E=1-$o(s,c,f),y=1-$o(e,h,c),I.push(Fo[u]),I.push(Bo[u])):104===u?(x=$o(s,f,p),v=$o(e,f,p),E=$o(e,f,c),y=$o(s,c,h),I.push(Bo[u]),I.push(Vo[u])):144===u?(b=$o(e,p,h),S=$o(e,f,c),E=$o(s,f,c),_=1-$o(s,h,c),I.push(Oo[u]),I.push(Uo[u])):26===u?(b=1-$o(s,h,p),S=1-$o(s,c,f),E=1-$o(e,c,f),_=$o(e,c,h),I.push(Oo[u]),I.push(Uo[u])):36===u?(w=$o(s,p,h),x=$o(e,f,p),y=$o(e,c,h),_=$o(s,c,h),I.push(No[u]),I.push(Fo[u])):134===u?(w=1-$o(e,h,p),x=1-$o(s,p,f),y=1-$o(s,h,c),_=1-$o(e,h,c),I.push(No[u]),I.push(Fo[u])):9===u?(b=1-$o(e,h,p),w=1-$o(s,h,p),v=$o(s,f,p),S=1-$o(e,c,f),I.push(Oo[u]),I.push(No[u])):161===u?(b=$o(s,p,h),w=$o(e,p,h),v=1-$o(e,p,f),S=$o(s,f,c),I.push(Oo[u]),I.push(No[u])):37===u?(w=$o(s,p,h),S=1-$o(e,c,f),y=$o(e,c,h),_=$o(s,c,h),I.push(No[u]),I.push(jo[u])):133===u?(w=1-$o(e,h,p),S=$o(s,f,c),y=1-$o(s,h,c),_=1-$o(e,h,c),I.push(No[u]),I.push(jo[u])):148===u?(x=$o(e,f,p),S=$o(e,f,c),E=$o(s,f,c),_=1-$o(s,h,c),I.push(Fo[u]),I.push(Uo[u])):22===u?(x=1-$o(s,p,f),S=1-$o(s,c,f),E=1-$o(e,c,f),_=$o(e,c,h),I.push(Fo[u]),I.push(Uo[u])):82===u?(b=$o(e,p,h),x=1-$o(e,p,f),v=1-$o(s,p,f),E=1-$o(s,c,f),I.push(Oo[u]),I.push(Bo[u])):88===u?(b=1-$o(s,h,p),x=$o(s,f,p),v=$o(e,f,p),E=$o(e,f,c),I.push(Oo[u]),I.push(Bo[u])):73===u?(b=1-$o(e,h,p),w=1-$o(s,h,p),v=$o(s,f,p),y=1-$o(e,h,c),I.push(Oo[u]),I.push(No[u])):97===u?(b=$o(s,p,h),w=$o(e,p,h),v=1-$o(e,p,f),y=$o(s,c,h),I.push(Oo[u]),I.push(No[u])):145===u?(b=$o(e,p,h),v=1-$o(e,p,f),S=$o(s,f,c),_=1-$o(s,h,c),I.push(Oo[u]),I.push(jo[u])):25===u?(b=1-$o(s,h,p),v=$o(s,f,p),S=1-$o(e,c,f),_=$o(e,c,h),I.push(Oo[u]),I.push(jo[u])):70===u?(w=1-$o(e,h,p),x=1-$o(s,p,f),E=1-$o(s,c,f),y=1-$o(e,h,c),I.push(No[u]),I.push(Fo[u])):100===u?(w=$o(s,p,h),x=$o(e,f,p),E=$o(e,f,c),y=$o(s,c,h),I.push(No[u]),I.push(Fo[u])):34===u?(0===m?(b=1-$o(e,h,p),w=1-$o(s,h,p),x=$o(s,f,p),v=$o(e,f,p),S=$o(e,f,c),E=$o(s,f,c),y=1-$o(s,h,c),_=1-$o(e,h,c)):(b=$o(s,p,h),w=$o(e,p,h),x=1-$o(e,p,f),v=1-$o(s,p,f),S=1-$o(s,c,f),E=1-$o(e,c,f),y=$o(e,c,h),_=$o(s,c,h)),I.push(Oo[u]),I.push(No[u]),I.push(jo[u]),I.push(Uo[u])):35===u?(4===m?(b=1-$o(e,h,p),w=1-$o(s,h,p),x=$o(s,f,p),v=$o(e,f,p),S=$o(e,f,c),E=$o(s,f,c),y=1-$o(s,h,c),_=1-$o(e,h,c)):(b=$o(s,p,h),w=$o(e,p,h),x=1-$o(e,p,f),v=1-$o(s,p,f),S=1-$o(s,c,f),E=1-$o(e,c,f),y=$o(e,c,h),_=$o(s,c,h)),I.push(Oo[u]),I.push(No[u]),I.push(Bo[u]),I.push(Uo[u])):136===u?(0===m?(b=$o(s,p,h),w=$o(e,p,h),x=1-$o(e,p,f),v=1-$o(s,p,f),S=1-$o(s,c,f),E=1-$o(e,c,f),y=$o(e,c,h),_=$o(s,c,h)):(b=1-$o(e,h,p),w=1-$o(s,h,p),x=$o(s,f,p),v=$o(e,f,p),S=$o(e,f,c),E=$o(s,f,c),y=1-$o(s,h,c),_=1-$o(e,h,c)),I.push(Oo[u]),I.push(No[u]),I.push(jo[u]),I.push(Uo[u])):153===u?(0===m?(b=$o(e,p,h),v=1-$o(e,p,f),S=1-$o(e,c,f),_=$o(e,c,h)):(b=1-$o(s,h,p),v=$o(s,f,p),S=$o(s,f,c),_=1-$o(s,h,c)),I.push(Oo[u]),I.push(Bo[u])):102===u?(0===m?(w=1-$o(e,h,p),x=$o(e,f,p),E=$o(e,f,c),y=1-$o(e,h,c)):(w=$o(s,p,h),x=1-$o(s,p,f),E=1-$o(s,c,f),y=$o(s,c,h)),I.push(No[u]),I.push(Uo[u])):155===u?(4===m?(b=$o(e,p,h),v=1-$o(e,p,f),S=1-$o(e,c,f),_=$o(e,c,h)):(b=1-$o(s,h,p),v=$o(s,f,p),S=$o(s,f,c),_=1-$o(s,h,c)),I.push(Oo[u]),I.push(jo[u])):103===u?(4===m?(w=1-$o(e,h,p),x=$o(e,f,p),E=$o(e,f,c),y=1-$o(e,h,c)):(w=$o(s,p,h),x=1-$o(s,p,f),E=1-$o(s,c,f),y=$o(s,c,h)),I.push(No[u]),I.push(Fo[u])):152===u?(0===m?(b=$o(e,p,h),x=1-$o(e,p,f),v=1-$o(s,p,f),S=1-$o(s,c,f),E=1-$o(e,c,f),_=$o(e,c,h)):(b=1-$o(s,h,p),x=$o(s,f,p),v=$o(e,f,p),S=$o(e,f,c),E=$o(s,f,c),_=1-$o(s,h,c)),I.push(Oo[u]),I.push(Fo[u]),I.push(Bo[u])):156===u?(4===m?(b=$o(e,p,h),x=1-$o(e,p,f),v=1-$o(s,p,f),S=1-$o(s,c,f),E=1-$o(e,c,f),_=$o(e,c,h)):(b=1-$o(s,h,p),x=$o(s,f,p),v=$o(e,f,p),S=$o(e,f,c),E=$o(s,f,c),_=1-$o(s,h,c)),I.push(Oo[u]),I.push(Bo[u]),I.push(Uo[u])):137===u?(0===m?(b=$o(s,p,h),w=$o(e,p,h),v=1-$o(e,p,f),S=1-$o(e,c,f),y=$o(e,c,h),_=$o(s,c,h)):(b=1-$o(e,h,p),w=1-$o(s,h,p),v=$o(s,f,p),S=$o(s,f,c),y=1-$o(s,h,c),_=1-$o(e,h,c)),I.push(Oo[u]),I.push(No[u]),I.push(Bo[u])):139===u?(4===m?(b=$o(s,p,h),w=$o(e,p,h),v=1-$o(e,p,f),S=1-$o(e,c,f),y=$o(e,c,h),_=$o(s,c,h)):(b=1-$o(e,h,p),w=1-$o(s,h,p),v=$o(s,f,p),S=$o(s,f,c),y=1-$o(s,h,c),_=1-$o(e,h,c)),I.push(Oo[u]),I.push(No[u]),I.push(jo[u])):98===u?(0===m?(b=1-$o(e,h,p),w=1-$o(s,h,p),x=$o(s,f,p),v=$o(e,f,p),E=$o(e,f,c),y=1-$o(e,h,c)):(b=$o(s,p,h),w=$o(e,p,h),x=1-$o(e,p,f),v=1-$o(s,p,f),E=1-$o(s,c,f),y=$o(s,c,h)),I.push(Oo[u]),I.push(No[u]),I.push(Uo[u])):99===u?(4===m?(b=1-$o(e,h,p),w=1-$o(s,h,p),x=$o(s,f,p),v=$o(e,f,p),E=$o(e,f,c),y=1-$o(e,h,c)):(b=$o(s,p,h),w=$o(e,p,h),x=1-$o(e,p,f),v=1-$o(s,p,f),E=1-$o(s,c,f),y=$o(s,c,h)),I.push(Oo[u]),I.push(No[u]),I.push(Bo[u])):38===u?(0===m?(w=1-$o(e,h,p),x=$o(e,f,p),S=$o(e,f,c),E=$o(s,f,c),y=1-$o(s,h,c),_=1-$o(e,h,c)):(w=$o(s,p,h),x=1-$o(s,p,f),S=1-$o(s,c,f),E=1-$o(e,c,f),y=$o(e,c,h),_=$o(s,c,h)),I.push(No[u]),I.push(jo[u]),I.push(Uo[u])):39===u?(4===m?(w=1-$o(e,h,p),x=$o(e,f,p),S=$o(e,f,c),E=$o(s,f,c),y=1-$o(s,h,c),_=1-$o(e,h,c)):(w=$o(s,p,h),x=1-$o(s,p,f),S=1-$o(s,c,f),E=1-$o(e,c,f),y=$o(e,c,h),_=$o(s,c,h)),I.push(No[u]),I.push(Fo[u]),I.push(Uo[u])):85===u&&(b=1,w=0,x=1,v=0,S=0,E=1,y=0,_=1),(y<0||y>1||_<0||_>1||b<0||b>1||x<0||x>1||S<0||S>1||E<0||E>1)&&console.log("MarchingSquaresJS-isoBands: "+u+" "+d+" "+c+","+h+","+p+","+f+" "+m+" "+y+" "+_+" "+b+" "+w+" "+x+" "+v+" "+S+" "+E),o.cells[a][l]={cval:u,cval_real:d,flipped:m,topleft:y,topright:_,righttop:b,rightbottom:w,bottomright:x,bottomleft:v,leftbottom:S,lefttop:E,edges:I}}}}}return o}(t,e,r);return Qi.polygons?(Qi.verbose&&console.log("MarchingSquaresJS-isoBands: returning single polygons for each grid cell"),l=function(t){var e=[],r=0;return t.cells.forEach(function(t,n){t.forEach(function(t,i){if(void 0!==t){var o=qo[t.cval](t);"object"==typeof o&&Zo(o)?"object"==typeof o[0]&&Zo(o[0])?"object"==typeof o[0][0]&&Zo(o[0][0])?o.forEach(function(t){t.forEach(function(t){t[0]+=i,t[1]+=n}),e[r++]=t}):(o.forEach(function(t){t[0]+=i,t[1]+=n}),e[r++]=o):console.log("MarchingSquaresJS-isoBands: bandcell polygon with malformed coordinates"):console.log("MarchingSquaresJS-isoBands: bandcell polygon with null coordinates")}})}),e}(u)):(Qi.verbose&&console.log("MarchingSquaresJS-isoBands: returning polygon paths for entire data grid"),l=function(t){for(var e=[],r=t.rows,n=t.cols,i=[],o=0;o<r;o++)for(var s=0;s<n;s++)if(void 0!==t.cells[o][s]&&t.cells[o][s].edges.length>0){var a=Wo(t.cells[o][s]),l=null,u=s,c=o;null!==a&&i.push([a.p[0]+u,a.p[1]+c]);do{if(null===(l=Yo(t.cells[c][u],a.x,a.y,a.o)))break;if(i.push([l.p[0]+u,l.p[1]+c]),u+=l.x,a=l,(c+=l.y)<0||c>=r||u<0||u>=n||void 0===t.cells[c][u]){var h=Xo(t,u-=l.x,c-=l.y,l.x,l.y,l.o);if(null===h)break;h.path.forEach(function(t){i.push(t)}),u=h.i,c=h.j,a=h}}while(void 0!==t.cells[c][u]&&t.cells[c][u].edges.length>0);e.push(i),i=[],t.cells[o][s].edges.length>0&&s--}return e}(u)),"function"==typeof Qi.successCallback&&Qi.successCallback(l),l}var eo=64,ro=16,no=[],io=[],oo=[],so=[],ao=[],lo=[],uo=[],co=[],ho=[],po=[],fo=[],mo=[],go=[],yo=[],_o=[],vo=[],xo=[],bo=[],wo=[],Eo=[],So=[],Io=[],To=[],Co=[];uo[85]=po[85]=-1,co[85]=fo[85]=0,ho[85]=mo[85]=1,wo[85]=Io[85]=1,Eo[85]=To[85]=0,So[85]=Co[85]=1,no[85]=so[85]=0,io[85]=ao[85]=-1,oo[85]=_o[85]=0,vo[85]=go[85]=0,xo[85]=yo[85]=1,lo[85]=bo[85]=1,Io[1]=Io[169]=0,To[1]=To[169]=-1,Co[1]=Co[169]=0,go[1]=go[169]=-1,yo[1]=yo[169]=0,_o[1]=_o[169]=0,po[4]=po[166]=0,fo[4]=fo[166]=-1,mo[4]=mo[166]=1,vo[4]=vo[166]=1,xo[4]=xo[166]=0,bo[4]=bo[166]=0,uo[16]=uo[154]=0,co[16]=co[154]=1,ho[16]=ho[154]=1,so[16]=so[154]=1,ao[16]=ao[154]=0,lo[16]=lo[154]=1,wo[64]=wo[106]=0,Eo[64]=Eo[106]=1,So[64]=So[106]=0,no[64]=no[106]=-1,io[64]=io[106]=0,oo[64]=oo[106]=1,wo[2]=wo[168]=0,Eo[2]=Eo[168]=-1,So[2]=So[168]=1,Io[2]=Io[168]=0,To[2]=To[168]=-1,Co[2]=Co[168]=0,go[2]=go[168]=-1,yo[2]=yo[168]=0,_o[2]=_o[168]=0,vo[2]=vo[168]=-1,xo[2]=xo[168]=0,bo[2]=bo[168]=1,uo[8]=uo[162]=0,co[8]=co[162]=-1,ho[8]=ho[162]=0,po[8]=po[162]=0,fo[8]=fo[162]=-1,mo[8]=mo[162]=1,go[8]=go[162]=1,yo[8]=yo[162]=0,_o[8]=_o[162]=1,vo[8]=vo[162]=1,xo[8]=xo[162]=0,bo[8]=bo[162]=0,uo[32]=uo[138]=0,co[32]=co[138]=1,ho[32]=ho[138]=1,po[32]=po[138]=0,fo[32]=fo[138]=1,mo[32]=mo[138]=0,no[32]=no[138]=1,io[32]=io[138]=0,oo[32]=oo[138]=0,so[32]=so[138]=1,ao[32]=ao[138]=0,lo[32]=lo[138]=1,Io[128]=Io[42]=0,To[128]=To[42]=1,Co[128]=Co[42]=1,wo[128]=wo[42]=0,Eo[128]=Eo[42]=1,So[128]=So[42]=0,no[128]=no[42]=-1,io[128]=io[42]=0,oo[128]=oo[42]=1,so[128]=so[42]=-1,ao[128]=ao[42]=0,lo[128]=lo[42]=0,po[5]=po[165]=-1,fo[5]=fo[165]=0,mo[5]=mo[165]=0,Io[5]=Io[165]=1,To[5]=To[165]=0,Co[5]=Co[165]=0,vo[20]=vo[150]=0,xo[20]=xo[150]=1,bo[20]=bo[150]=1,so[20]=so[150]=0,ao[20]=ao[150]=-1,lo[20]=lo[150]=1,uo[80]=uo[90]=-1,co[80]=co[90]=0,ho[80]=ho[90]=1,wo[80]=wo[90]=1,Eo[80]=Eo[90]=0,So[80]=So[90]=1,go[65]=go[105]=0,yo[65]=yo[105]=1,_o[65]=_o[105]=0,no[65]=no[105]=0,io[65]=io[105]=-1,oo[65]=oo[105]=0,uo[160]=uo[10]=-1,co[160]=co[10]=0,ho[160]=ho[10]=1,po[160]=po[10]=-1,fo[160]=fo[10]=0,mo[160]=mo[10]=0,Io[160]=Io[10]=1,To[160]=To[10]=0,Co[160]=Co[10]=0,wo[160]=wo[10]=1,Eo[160]=Eo[10]=0,So[160]=So[10]=1,vo[130]=vo[40]=0,xo[130]=xo[40]=1,bo[130]=bo[40]=1,go[130]=go[40]=0,yo[130]=yo[40]=1,_o[130]=_o[40]=0,no[130]=no[40]=0,io[130]=io[40]=-1,oo[130]=oo[40]=0,so[130]=so[40]=0,ao[130]=ao[40]=-1,lo[130]=lo[40]=1,po[37]=po[133]=0,fo[37]=fo[133]=1,mo[37]=mo[133]=1,Io[37]=Io[133]=0,To[37]=To[133]=1,Co[37]=Co[133]=0,no[37]=no[133]=-1,io[37]=io[133]=0,oo[37]=oo[133]=0,so[37]=so[133]=1,ao[37]=ao[133]=0,lo[37]=lo[133]=0,vo[148]=vo[22]=-1,xo[148]=xo[22]=0,bo[148]=bo[22]=0,Io[148]=Io[22]=0,To[148]=To[22]=-1,Co[148]=Co[22]=1,wo[148]=wo[22]=0,Eo[148]=Eo[22]=1,So[148]=So[22]=1,so[148]=so[22]=-1,ao[148]=ao[22]=0,lo[148]=lo[22]=1,uo[82]=uo[88]=0,co[82]=co[88]=-1,ho[82]=ho[88]=1,vo[82]=vo[88]=1,xo[82]=xo[88]=0,bo[82]=bo[88]=1,go[82]=go[88]=-1,yo[82]=yo[88]=0,_o[82]=_o[88]=1,wo[82]=wo[88]=0,Eo[82]=Eo[88]=-1,So[82]=So[88]=0,uo[73]=uo[97]=0,co[73]=co[97]=1,ho[73]=ho[97]=0,po[73]=po[97]=0,fo[73]=fo[97]=-1,mo[73]=mo[97]=0,go[73]=go[97]=1,yo[73]=yo[97]=0,_o[73]=_o[97]=0,no[73]=no[97]=1,io[73]=io[97]=0,oo[73]=oo[97]=1,uo[145]=uo[25]=0,co[145]=co[25]=-1,ho[145]=ho[25]=0,go[145]=go[25]=1,yo[145]=yo[25]=0,_o[145]=_o[25]=1,Io[145]=Io[25]=0,To[145]=To[25]=1,Co[145]=Co[25]=1,so[145]=so[25]=-1,ao[145]=ao[25]=0,lo[145]=lo[25]=0,po[70]=po[100]=0,fo[70]=fo[100]=1,mo[70]=mo[100]=0,vo[70]=vo[100]=-1,xo[70]=xo[100]=0,bo[70]=bo[100]=1,wo[70]=wo[100]=0,Eo[70]=Eo[100]=-1,So[70]=So[100]=1,no[70]=no[100]=1,io[70]=io[100]=0,oo[70]=oo[100]=0,po[101]=po[69]=0,fo[101]=fo[69]=1,mo[101]=mo[69]=0,no[101]=no[69]=1,io[101]=io[69]=0,oo[101]=oo[69]=0,Io[149]=Io[21]=0,To[149]=To[21]=1,Co[149]=Co[21]=1,so[149]=so[21]=-1,ao[149]=ao[21]=0,lo[149]=lo[21]=0,vo[86]=vo[84]=-1,xo[86]=xo[84]=0,bo[86]=bo[84]=1,wo[86]=wo[84]=0,Eo[86]=Eo[84]=-1,So[86]=So[84]=1,uo[89]=uo[81]=0,co[89]=co[81]=-1,ho[89]=ho[81]=0,go[89]=go[81]=1,yo[89]=yo[81]=0,_o[89]=_o[81]=1,uo[96]=uo[74]=0,co[96]=co[74]=1,ho[96]=ho[74]=0,po[96]=po[74]=-1,fo[96]=fo[74]=0,mo[96]=mo[74]=1,wo[96]=wo[74]=1,Eo[96]=Eo[74]=0,So[96]=So[74]=0,no[96]=no[74]=1,io[96]=io[74]=0,oo[96]=oo[74]=1,uo[24]=uo[146]=0,co[24]=co[146]=-1,ho[24]=ho[146]=1,vo[24]=vo[146]=1,xo[24]=xo[146]=0,bo[24]=bo[146]=1,go[24]=go[146]=0,yo[24]=yo[146]=1,_o[24]=_o[146]=1,so[24]=so[146]=0,ao[24]=ao[146]=-1,lo[24]=lo[146]=0,po[6]=po[164]=-1,fo[6]=fo[164]=0,mo[6]=mo[164]=1,vo[6]=vo[164]=-1,xo[6]=xo[164]=0,bo[6]=bo[164]=0,Io[6]=Io[164]=0,To[6]=To[164]=-1,Co[6]=Co[164]=1,wo[6]=wo[164]=1,Eo[6]=Eo[164]=0,So[6]=So[164]=0,go[129]=go[41]=0,yo[129]=yo[41]=1,_o[129]=_o[41]=1,Io[129]=Io[41]=0,To[129]=To[41]=1,Co[129]=Co[41]=0,no[129]=no[41]=-1,io[129]=io[41]=0,oo[129]=oo[41]=0,so[129]=so[41]=0,ao[129]=ao[41]=-1,lo[129]=lo[41]=0,vo[66]=vo[104]=0,xo[66]=xo[104]=1,bo[66]=bo[104]=0,go[66]=go[104]=-1,yo[66]=yo[104]=0,_o[66]=_o[104]=1,wo[66]=wo[104]=0,Eo[66]=Eo[104]=-1,So[66]=So[104]=0,no[66]=no[104]=0,io[66]=io[104]=-1,oo[66]=oo[104]=1,uo[144]=uo[26]=-1,co[144]=co[26]=0,ho[144]=ho[26]=0,Io[144]=Io[26]=1,To[144]=To[26]=0,Co[144]=Co[26]=1,wo[144]=wo[26]=0,Eo[144]=Eo[26]=1,So[144]=So[26]=1,so[144]=so[26]=-1,ao[144]=ao[26]=0,lo[144]=lo[26]=1,po[36]=po[134]=0,fo[36]=fo[134]=1,mo[36]=mo[134]=1,vo[36]=vo[134]=0,xo[36]=xo[134]=1,bo[36]=bo[134]=0,no[36]=no[134]=0,io[36]=io[134]=-1,oo[36]=oo[134]=1,so[36]=so[134]=1,ao[36]=ao[134]=0,lo[36]=lo[134]=0,uo[9]=uo[161]=-1,co[9]=co[161]=0,ho[9]=ho[161]=0,po[9]=po[161]=0,fo[9]=fo[161]=-1,mo[9]=mo[161]=0,go[9]=go[161]=1,yo[9]=yo[161]=0,_o[9]=_o[161]=0,Io[9]=Io[161]=1,To[9]=To[161]=0,Co[9]=Co[161]=1,uo[136]=0,co[136]=1,ho[136]=1,po[136]=0,fo[136]=1,mo[136]=0,vo[136]=-1,xo[136]=0,bo[136]=1,go[136]=-1,yo[136]=0,_o[136]=0,Io[136]=0,To[136]=-1,Co[136]=0,wo[136]=0,Eo[136]=-1,So[136]=1,no[136]=1,io[136]=0,oo[136]=0,so[136]=1,ao[136]=0,lo[136]=1,uo[34]=0,co[34]=-1,ho[34]=0,po[34]=0,fo[34]=-1,mo[34]=1,vo[34]=1,xo[34]=0,bo[34]=0,go[34]=1,yo[34]=0,_o[34]=1,Io[34]=0,To[34]=1,Co[34]=1,wo[34]=0,Eo[34]=1,So[34]=0,no[34]=-1,io[34]=0,oo[34]=1,so[34]=-1,ao[34]=0,lo[34]=0,uo[35]=0,co[35]=1,ho[35]=1,po[35]=0,fo[35]=-1,mo[35]=1,vo[35]=1,xo[35]=0,bo[35]=0,go[35]=-1,yo[35]=0,_o[35]=0,Io[35]=0,To[35]=-1,Co[35]=0,wo[35]=0,Eo[35]=1,So[35]=0,no[35]=-1,io[35]=0,oo[35]=1,so[35]=1,ao[35]=0,lo[35]=1,uo[153]=0,co[153]=1,ho[153]=1,go[153]=-1,yo[153]=0,_o[153]=0,Io[153]=0,To[153]=-1,Co[153]=0,so[153]=1,ao[153]=0,lo[153]=1,po[102]=0,fo[102]=-1,mo[102]=1,vo[102]=1,xo[102]=0,bo[102]=0,wo[102]=0,Eo[102]=1,So[102]=0,no[102]=-1,io[102]=0,oo[102]=1,uo[155]=0,co[155]=-1,ho[155]=0,go[155]=1,yo[155]=0,_o[155]=1,Io[155]=0,To[155]=1,Co[155]=1,so[155]=-1,ao[155]=0,lo[155]=0,po[103]=0,fo[103]=1,mo[103]=0,vo[103]=-1,xo[103]=0,bo[103]=1,wo[103]=0,Eo[103]=-1,So[103]=1,no[103]=1,io[103]=0,oo[103]=0,uo[152]=0,co[152]=1,ho[152]=1,vo[152]=-1,xo[152]=0,bo[152]=1,go[152]=-1,yo[152]=0,_o[152]=0,Io[152]=0,To[152]=-1,Co[152]=0,wo[152]=0,Eo[152]=-1,So[152]=1,so[152]=1,ao[152]=0,lo[152]=1,uo[156]=0,co[156]=-1,ho[156]=1,vo[156]=1,xo[156]=0,bo[156]=1,go[156]=-1,yo[156]=0,_o[156]=0,Io[156]=0,To[156]=-1,Co[156]=0,wo[156]=0,Eo[156]=1,So[156]=1,so[156]=-1,ao[156]=0,lo[156]=1,uo[137]=0,co[137]=1,ho[137]=1,po[137]=0,fo[137]=1,mo[137]=0,go[137]=-1,yo[137]=0,_o[137]=0,Io[137]=0,To[137]=-1,Co[137]=0,no[137]=1,io[137]=0,oo[137]=0,so[137]=1,ao[137]=0,lo[137]=1,uo[139]=0,co[139]=1,ho[139]=1,po[139]=0,fo[139]=-1,mo[139]=0,go[139]=1,yo[139]=0,_o[139]=0,Io[139]=0,To[139]=1,Co[139]=0,no[139]=-1,io[139]=0,oo[139]=0,so[139]=1,ao[139]=0,lo[139]=1,uo[98]=0,co[98]=-1,ho[98]=0,po[98]=0,fo[98]=-1,mo[98]=1,vo[98]=1,xo[98]=0,bo[98]=0,go[98]=1,yo[98]=0,_o[98]=1,wo[98]=0,Eo[98]=1,So[98]=0,no[98]=-1,io[98]=0,oo[98]=1,uo[99]=0,co[99]=1,ho[99]=0,po[99]=0,fo[99]=-1,mo[99]=1,vo[99]=1,xo[99]=0,bo[99]=0,go[99]=-1,yo[99]=0,_o[99]=1,wo[99]=0,Eo[99]=-1,So[99]=0,no[99]=1,io[99]=0,oo[99]=1,po[38]=0,fo[38]=-1,mo[38]=1,vo[38]=1,xo[38]=0,bo[38]=0,Io[38]=0,To[38]=1,Co[38]=1,wo[38]=0,Eo[38]=1,So[38]=0,no[38]=-1,io[38]=0,oo[38]=1,so[38]=-1,ao[38]=0,lo[38]=0,po[39]=0,fo[39]=1,mo[39]=1,vo[39]=-1,xo[39]=0,bo[39]=0,Io[39]=0,To[39]=-1,Co[39]=1,wo[39]=0,Eo[39]=1,So[39]=0,no[39]=-1,io[39]=0,oo[39]=1,so[39]=1,ao[39]=0,lo[39]=0;var Mo=function(t){return[[t.bottomleft,0],[0,0],[0,t.leftbottom]]},Ao=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0]]},Po=function(t){return[[t.topright,1],[1,1],[1,t.righttop]]},ko=function(t){return[[0,t.lefttop],[0,1],[t.topleft,1]]},Lo=function(t){return[[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop]]},zo=function(t){return[[t.bottomright,0],[t.bottomleft,0],[1,t.righttop],[1,t.rightbottom]]},Do=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.topleft,1],[t.topright,1]]},Ro=function(t){return[[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]},Oo=[],No=[],Fo=[],Bo=[],jo=[],Uo=[],Vo=[],Go=[];Bo[1]=jo[1]=18,Bo[169]=jo[169]=18,Fo[4]=No[4]=12,Fo[166]=No[166]=12,Oo[16]=Go[16]=4,Oo[154]=Go[154]=4,Uo[64]=Vo[64]=22,Uo[106]=Vo[106]=22,Fo[2]=Uo[2]=17,Bo[2]=jo[2]=18,Fo[168]=Uo[168]=17,Bo[168]=jo[168]=18,Oo[8]=Bo[8]=9,No[8]=Fo[8]=12,Oo[162]=Bo[162]=9,No[162]=Fo[162]=12,Oo[32]=Go[32]=4,No[32]=Vo[32]=1,Oo[138]=Go[138]=4,No[138]=Vo[138]=1,jo[128]=Go[128]=21,Uo[128]=Vo[128]=22,jo[42]=Go[42]=21,Uo[42]=Vo[42]=22,No[5]=jo[5]=14,No[165]=jo[165]=14,Fo[20]=Go[20]=6,Fo[150]=Go[150]=6,Oo[80]=Uo[80]=11,Oo[90]=Uo[90]=11,Bo[65]=Vo[65]=3,Bo[105]=Vo[105]=3,Oo[160]=Uo[160]=11,No[160]=jo[160]=14,Oo[10]=Uo[10]=11,No[10]=jo[10]=14,Fo[130]=Go[130]=6,Bo[130]=Vo[130]=3,Fo[40]=Go[40]=6,Bo[40]=Vo[40]=3,No[101]=Vo[101]=1,No[69]=Vo[69]=1,jo[149]=Go[149]=21,jo[21]=Go[21]=21,Fo[86]=Uo[86]=17,Fo[84]=Uo[84]=17,Oo[89]=Bo[89]=9,Oo[81]=Bo[81]=9,Oo[96]=Vo[96]=0,No[96]=Uo[96]=15,Oo[74]=Vo[74]=0,No[74]=Uo[74]=15,Oo[24]=Fo[24]=8,Bo[24]=Go[24]=7,Oo[146]=Fo[146]=8,Bo[146]=Go[146]=7,No[6]=Uo[6]=15,Fo[6]=jo[6]=16,No[164]=Uo[164]=15,Fo[164]=jo[164]=16,Bo[129]=Go[129]=7,jo[129]=Vo[129]=20,Bo[41]=Go[41]=7,jo[41]=Vo[41]=20,Fo[66]=Vo[66]=2,Bo[66]=Uo[66]=19,Fo[104]=Vo[104]=2,Bo[104]=Uo[104]=19,Oo[144]=jo[144]=10,Uo[144]=Go[144]=23,Oo[26]=jo[26]=10,Uo[26]=Go[26]=23,No[36]=Go[36]=5,Fo[36]=Vo[36]=2,No[134]=Go[134]=5,Fo[134]=Vo[134]=2,Oo[9]=jo[9]=10,No[9]=Bo[9]=13,Oo[161]=jo[161]=10,No[161]=Bo[161]=13,No[37]=Go[37]=5,jo[37]=Vo[37]=20,No[133]=Go[133]=5,jo[133]=Vo[133]=20,Fo[148]=jo[148]=16,Uo[148]=Go[148]=23,Fo[22]=jo[22]=16,Uo[22]=Go[22]=23,Oo[82]=Fo[82]=8,Bo[82]=Uo[82]=19,Oo[88]=Fo[88]=8,Bo[88]=Uo[88]=19,Oo[73]=Vo[73]=0,No[73]=Bo[73]=13,Oo[97]=Vo[97]=0,No[97]=Bo[97]=13,Oo[145]=Bo[145]=9,jo[145]=Go[145]=21,Oo[25]=Bo[25]=9,jo[25]=Go[25]=21,No[70]=Vo[70]=1,Fo[70]=Uo[70]=17,No[100]=Vo[100]=1,Fo[100]=Uo[100]=17,Oo[34]=Bo[34]=9,No[34]=Fo[34]=12,jo[34]=Go[34]=21,Uo[34]=Vo[34]=22,Oo[136]=Go[136]=4,No[136]=Vo[136]=1,Fo[136]=Uo[136]=17,Bo[136]=jo[136]=18,Oo[35]=Go[35]=4,No[35]=Fo[35]=12,Bo[35]=jo[35]=18,Uo[35]=Vo[35]=22,Oo[153]=Go[153]=4,Bo[153]=jo[153]=18,No[102]=Fo[102]=12,Uo[102]=Vo[102]=22,Oo[155]=Bo[155]=9,jo[155]=Go[155]=23,No[103]=Vo[103]=1,Fo[103]=Uo[103]=17,Oo[152]=Go[152]=4,Fo[152]=Uo[152]=17,Bo[152]=jo[152]=18,Oo[156]=Fo[156]=8,Bo[156]=jo[156]=18,Uo[156]=Go[156]=23,Oo[137]=Go[137]=4,No[137]=Vo[137]=1,Bo[137]=jo[137]=18,Oo[139]=Go[139]=4,No[139]=Bo[139]=13,jo[139]=Vo[139]=20,Oo[98]=Bo[98]=9,No[98]=Fo[98]=12,Uo[98]=Vo[98]=22,Oo[99]=Vo[99]=0,No[99]=Fo[99]=12,Bo[99]=Uo[99]=19,No[38]=Fo[38]=12,jo[38]=Go[38]=21,Uo[38]=Vo[38]=22,No[39]=Go[39]=5,Fo[39]=jo[39]=16,Uo[39]=Vo[39]=22;var qo=[];function $o(t,e,r){return(t-e)/(r-e)}function Zo(t){return t.constructor.toString().indexOf("Array")>-1}function Xo(t,e,r,n,i,o){for(var s=t.cells[r][e],a=s.cval_real,l=e+n,u=r+i,c=[],h=!1;!h;){if(void 0===t.cells[u]||void 0===t.cells[u][l])if(u-=i,l-=n,a=(s=t.cells[u][l]).cval_real,-1===i)if(0===o)if(1&a)c.push([l,u]),n=-1,i=0,o=0;else{if(!(4&a)){c.push([l+s.bottomright,u]),n=0,i=1,o=1,h=!0;break}c.push([l+1,u]),n=1,i=0,o=0}else{if(!(1&a)){if(4&a){c.push([l+s.bottomright,u]),n=0,i=1,o=1,h=!0;break}c.push([l+s.bottomleft,u]),n=0,i=1,o=0,h=!0;break}c.push([l,u]),n=-1,i=0,o=0}else if(1===i)if(0===o){if(!(a&ro)){if(a&eo){c.push([l+s.topleft,u+1]),n=0,i=-1,o=0,h=!0;break}c.push([l+s.topright,u+1]),n=0,i=-1,o=1,h=!0;break}c.push([l+1,u+1]),n=1,i=0,o=1}else c.push([l+1,u+1]),n=1,i=0,o=1;else if(-1===n)if(0===o){if(!(a&eo)){if(1&a){c.push([l,u+s.leftbottom]),n=1,i=0,o=0,h=!0;break}c.push([l,u+s.lefttop]),n=1,i=0,o=1,h=!0;break}c.push([l,u+1]),n=0,i=1,o=0}else{if(!(a&eo)){console.log("MarchingSquaresJS-isoBands: wtf");break}c.push([l,u+1]),n=0,i=1,o=0}else{if(1!==n){console.log("MarchingSquaresJS-isoBands: we came from nowhere!");break}if(0===o){if(!(4&a)){c.push([l+1,u+s.rightbottom]),n=-1,i=0,o=0,h=!0;break}c.push([l+1,u]),n=0,i=-1,o=1}else{if(!(4&a)){if(a&ro){c.push([l+1,u+s.righttop]),n=-1,i=0,o=1;break}c.push([l+1,u+s.rightbottom]),n=-1,i=0,o=0,h=!0;break}c.push([l+1,u]),n=0,i=-1,o=1}}else if(a=(s=t.cells[u][l]).cval_real,-1===n)if(0===o)if(void 0!==t.cells[u-1]&&void 0!==t.cells[u-1][l])n=0,i=-1,o=1;else{if(!(1&a)){c.push([l+s.bottomright,u]),n=0,i=1,o=1,h=!0;break}c.push([l,u])}else{if(!(a&eo)){console.log("MarchingSquaresJS-isoBands: found entry from top at "+l+","+u);break}console.log("MarchingSquaresJS-isoBands: proceeding in x-direction!")}else if(1===n){if(0===o){console.log("MarchingSquaresJS-isoBands: wtf");break}if(void 0!==t.cells[u+1]&&void 0!==t.cells[u+1][l])n=0,i=1,o=0;else{if(!(a&ro)){c.push([l+s.topleft,u+1]),n=0,i=-1,o=0,h=!0;break}c.push([l+1,u+1]),n=1,i=0,o=1}}else if(-1===i){if(1!==o){console.log("MarchingSquaresJS-isoBands: wtf");break}if(void 0!==t.cells[u][l+1])n=1,i=0,o=1;else{if(!(4&a)){c.push([l+1,u+s.righttop]),n=-1,i=0,o=1,h=!0;break}c.push([l+1,u]),n=0,i=-1,o=1}}else{if(1!==i){console.log("MarchingSquaresJS-isoBands: where did we came from???");break}if(0!==o){console.log("MarchingSquaresJS-isoBands: wtf");break}if(void 0!==t.cells[u][l-1])n=-1,i=0,o=0;else{if(!(a&eo)){c.push([l,u+s.leftbottom]),n=1,i=0,o=0,h=!0;break}c.push([l,u+1]),n=0,i=1,o=0}}if(u+=i,(l+=n)===e&&u===r)break}return{path:c,i:l,j:u,x:n,y:i,o:o}}function Wo(t){if(t.edges.length>0){var e=t.edges[t.edges.length-1],r=t.cval_real;switch(e){case 0:return r&ro?{p:[1,t.righttop],x:-1,y:0,o:1}:{p:[t.topleft,1],x:0,y:-1,o:0};case 1:return 4&r?{p:[t.topleft,1],x:0,y:-1,o:0}:{p:[1,t.rightbottom],x:-1,y:0,o:0};case 2:return 4&r?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[t.topleft,1],x:0,y:-1,o:0};case 3:return 1&r?{p:[t.topleft,1],x:0,y:-1,o:0}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 4:return r&ro?{p:[1,t.righttop],x:-1,y:0,o:1}:{p:[t.topright,1],x:0,y:-1,o:1};case 5:return 4&r?{p:[t.topright,1],x:0,y:-1,o:1}:{p:[1,t.rightbottom],x:-1,y:0,o:0};case 6:return 4&r?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[t.topright,1],x:0,y:-1,o:1};case 7:return 1&r?{p:[t.topright,1],x:0,y:-1,o:1}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 8:return 4&r?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[1,t.righttop],x:-1,y:0,o:1};case 9:return 1&r?{p:[1,t.righttop],x:-1,y:0,o:1}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 10:return 1&r?{p:[0,t.leftbottom],x:1,y:0,o:0}:{p:[1,t.righttop],x:-1,y:0,o:1};case 11:return r&eo?{p:[1,t.righttop],x:-1,y:0,o:1}:{p:[0,t.lefttop],x:1,y:0,o:1};case 12:return 4&r?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[1,t.rightbottom],x:-1,y:0,o:0};case 13:return 1&r?{p:[1,t.rightbottom],x:-1,y:0,o:0}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 14:return 1&r?{p:[0,t.leftbottom],x:1,y:0,o:0}:{p:[1,t.rightbottom],x:-1,y:0,o:0};case 15:return r&eo?{p:[1,t.rightbottom],x:-1,y:0,o:0}:{p:[0,t.lefttop],x:1,y:0,o:1};case 16:return 4&r?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[0,t.leftbottom],x:1,y:0,o:0};case 17:return r&eo?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[0,t.lefttop],x:1,y:0,o:1};case 18:return 1&r?{p:[0,t.leftbottom],x:1,y:0,o:0}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 19:return r&eo?{p:[t.bottomleft,0],x:0,y:1,o:0}:{p:[0,t.lefttop],x:1,y:0,o:1};case 20:return r&eo?{p:[t.topleft,1],x:0,y:-1,o:0}:{p:[0,t.leftbottom],x:1,y:0,o:0};case 21:return r&ro?{p:[0,t.leftbottom],x:1,y:0,o:0}:{p:[t.topright,1],x:0,y:-1,o:1};case 22:return r&eo?{p:[t.topleft,1],x:0,y:-1,o:0}:{p:[0,t.lefttop],x:1,y:0,o:1};case 23:return r&ro?{p:[0,t.lefttop],x:1,y:0,o:1}:{p:[t.topright,1],x:0,y:-1,o:1};default:console.log("MarchingSquaresJS-isoBands: edge index out of range!"),console.log(t)}}return null}function Yo(t,e,r,n){var i,o,s,a,l,u=t.cval;switch(e){case-1:switch(n){case 0:i=No[u],s=po[u],a=fo[u],l=mo[u];break;default:i=Oo[u],s=uo[u],a=co[u],l=ho[u]}break;case 1:switch(n){case 0:i=jo[u],s=Io[u],a=To[u],l=Co[u];break;default:i=Uo[u],s=wo[u],a=Eo[u],l=So[u]}break;default:switch(r){case-1:switch(n){case 0:i=Vo[u],s=no[u],a=io[u],l=oo[u];break;default:i=Go[u],s=so[u],a=ao[u],l=lo[u]}break;case 1:switch(n){case 0:i=Bo[u],s=go[u],a=yo[u],l=_o[u];break;default:i=Fo[u],s=vo[u],a=xo[u],l=bo[u]}}}if(o=t.edges.indexOf(i),void 0===t.edges[o])return null;switch(function(t,e){delete t.edges[e];for(var r=e+1;r<t.edges.length;r++)t.edges[r-1]=t.edges[r];t.edges.pop()}(t,o),u=t.cval_real,i){case 0:u&ro?(e=t.topleft,r=1):(e=1,r=t.righttop);break;case 1:4&u?(e=1,r=t.rightbottom):(e=t.topleft,r=1);break;case 2:4&u?(e=t.topleft,r=1):(e=t.bottomright,r=0);break;case 3:1&u?(e=t.bottomleft,r=0):(e=t.topleft,r=1);break;case 4:u&ro?(e=t.topright,r=1):(e=1,r=t.righttop);break;case 5:4&u?(e=1,r=t.rightbottom):(e=t.topright,r=1);break;case 6:4&u?(e=t.topright,r=1):(e=t.bottomright,r=0);break;case 7:1&u?(e=t.bottomleft,r=0):(e=t.topright,r=1);break;case 8:4&u?(e=1,r=t.righttop):(e=t.bottomright,r=0);break;case 9:1&u?(e=t.bottomleft,r=0):(e=1,r=t.righttop);break;case 10:1&u?(e=1,r=t.righttop):(e=0,r=t.leftbottom);break;case 11:u&eo?(e=0,r=t.lefttop):(e=1,r=t.righttop);break;case 12:4&u?(e=1,r=t.rightbottom):(e=t.bottomright,r=0);break;case 13:1&u?(e=t.bottomleft,r=0):(e=1,r=t.rightbottom);break;case 14:1&u?(e=1,r=t.rightbottom):(e=0,r=t.leftbottom);break;case 15:u&eo?(e=0,r=t.lefttop):(e=1,r=t.rightbottom);break;case 16:4&u?(e=0,r=t.leftbottom):(e=t.bottomright,r=0);break;case 17:u&eo?(e=0,r=t.lefttop):(e=t.bottomright,r=0);break;case 18:1&u?(e=t.bottomleft,r=0):(e=0,r=t.leftbottom);break;case 19:u&eo?(e=0,r=t.lefttop):(e=t.bottomleft,r=0);break;case 20:u&eo?(e=0,r=t.leftbottom):(e=t.topleft,r=1);break;case 21:u&ro?(e=t.topright,r=1):(e=0,r=t.leftbottom);break;case 22:u&eo?(e=0,r=t.lefttop):(e=t.topleft,r=1);break;case 23:u&ro?(e=t.topright,r=1):(e=0,r=t.lefttop);break;default:return console.log("MarchingSquaresJS-isoBands: edge index out of range!"),console.log(t),null}return void 0!==e&&void 0!==r&&void 0!==s&&void 0!==a&&void 0!==l||(console.log("MarchingSquaresJS-isoBands: undefined value!"),console.log(t),console.log(e+" "+r+" "+s+" "+a+" "+l)),{p:[e,r],x:s,y:a,o:l}}function Ho(t){var e=[],r=[];t.forEach(function(t){var n=Gn(c([t]));r.push(n),e.push({ring:t,area:n})}),r.sort(function(t,e){return e-t});var n=[];return r.forEach(function(t){for(var r=0;r<e.length;r++)if(e[r].area===t){n.push(e[r].ring),e.splice(r,1);break}}),n}function Jo(t){for(var e=t.map(function(t){return{lrCoordinates:t,grouped:!1}}),r=[];!Qo(e);)for(var n=0;n<e.length;n++)if(!e[n].grouped){var i=[];i.push(e[n].lrCoordinates),e[n].grouped=!0;for(var o=c([e[n].lrCoordinates]),s=n+1;s<e.length;s++)e[s].grouped||Ko(c([e[s].lrCoordinates]),o)&&(i.push(e[s].lrCoordinates),e[s].grouped=!0);r.push(i)}return r}function Ko(t,e){for(var r=wr(t),n=0;n<r.features.length;n++)if(!ye(r.features[n],e))return!1;return!0}function Qo(t){for(var e=0;e<t.length;e++)if(!1===t[e].grouped)return!1;return!0}function ts(t,e,r){if(!A(r=r||{}))throw new Error("options is invalid");var n=r.pivot,i=r.mutate;if(!t)throw new Error("geojson is required");if(null==e||isNaN(e))throw new Error("angle is required");return 0===e||(n||(n=br(t)),!1!==i&&void 0!==i||(t=Ie(t)),z(t,function(t){var r=Ui(n,t)+e,i=Rn(n,t),o=Q(Gi(n,i,r));t[0]=o[0],t[1]=o[1]})),t}function es(t,e,r){if(!A(r=r||{}))throw new Error("options is invalid");var n=r.origin,i=r.mutate;if(!t)throw new Error("geojson required");if("number"!=typeof e||0===e)throw new Error("invalid factor");var o=Array.isArray(n)||"object"==typeof n;return!0!==i&&(t=Ie(t)),"FeatureCollection"!==t.type||o?rs(t,e,n):(N(t,function(r,i){t.features[i]=rs(r,e,n)}),t)}function rs(t,e,r){var n="Point"===ot(t);return r=function(t,e){if(null==e&&(e="centroid"),Array.isArray(e)||"object"==typeof e)return K(e);var r=t.bbox?t.bbox:J(t),n=r[0],i=r[1],o=r[2],s=r[3];switch(e){case"sw":case"southwest":case"westsouth":case"bottomleft":return l([n,i]);case"se":case"southeast":case"eastsouth":case"bottomright":return l([o,i]);case"nw":case"northwest":case"westnorth":case"topleft":return l([n,s]);case"ne":case"northeast":case"eastnorth":case"topright":return l([o,s]);case"center":return xr(t);case void 0:case null:case"centroid":return br(t);default:throw new Error("invalid origin")}}(t,r),1===e||n||z(t,function(t){var n=Rn(r,t),i=Ui(r,t),o=Q(Gi(r,n*e,i));t[0]=o[0],t[1]=o[1],3===t.length&&(t[2]*=e)}),t}function ns(t){var e=t[0],r=t[1];return[r[0]-e[0],r[1]-e[1]]}function is(t,e){return t[0]*e[1]-e[0]*t[1]}function os(t,e){return!function(t,e){return 0===is(ns(t),ns(e))}(t,e)&&function(t,e){var r,n,i=t[0],o=ns(t),s=e[0],a=ns(e),l=is(o,a);return function(t,e){return[t[0]+e[0],t[1]+e[1]]}(i,function(t,e){return[t*e[0],t*e[1]]}(is((n=i,[(r=s)[0]-n[0],r[1]-n[1]]),a)/l,o))}(t,e)}function ss(t,e,r){var n=[],i=w(e,r),o=Q(t),s=[];return o.forEach(function(t,e){if(e!==o.length-1){var r=(u=t,c=o[e+1],h=i,p=Math.sqrt((u[0]-c[0])*(u[0]-c[0])+(u[1]-c[1])*(u[1]-c[1])),f=u[0]+h*(c[1]-u[1])/p,d=c[0]+h*(c[1]-u[1])/p,m=u[1]+h*(u[0]-c[0])/p,g=c[1]+h*(u[0]-c[0])/p,[[f,m],[d,g]]);if(n.push(r),e>0){var a=n[e-1],l=os(r,a);!1!==l&&(a[1]=l,r[0]=l),s.push(a[0]),e===o.length-2&&(s.push(r[0]),s.push(r[1]))}2===o.length&&(s.push(r[0]),s.push(r[1]))}var u,c,h,p,f,d,m,g}),p(s,t.properties)}function as(t,e,r){var n=e[0]-t[0],i=e[1]-t[1],o=r[0]-e[0];return function(t){return(t>0)-(t<0)||+t}(n*(r[1]-e[1])-o*i)}function ls(t,e){return e.geometry.coordinates[0].every(function(e){return ye(l(e),t)})}qo[1]=qo[169]=Mo,qo[4]=qo[166]=Ao,qo[16]=qo[154]=Po,qo[64]=qo[106]=ko,qo[168]=qo[2]=Lo,qo[162]=qo[8]=zo,qo[138]=qo[32]=Do,qo[42]=qo[128]=Ro,qo[5]=qo[165]=function(t){return[[0,0],[0,t.leftbottom],[1,t.rightbottom],[1,0]]},qo[20]=qo[150]=function(t){return[[1,0],[t.bottomright,0],[t.topright,1],[1,1]]},qo[80]=qo[90]=function(t){return[[1,1],[1,t.righttop],[0,t.lefttop],[0,1]]},qo[65]=qo[105]=function(t){return[[t.bottomleft,0],[0,0],[0,1],[t.topleft,1]]},qo[160]=qo[10]=function(t){return[[1,t.righttop],[1,t.rightbottom],[0,t.leftbottom],[0,t.lefttop]]},qo[130]=qo[40]=function(t){return[[t.topleft,1],[t.topright,1],[t.bottomright,0],[t.bottomleft,0]]},qo[85]=function(){return[[0,0],[0,1],[1,1],[1,0]]},qo[101]=qo[69]=function(t){return[[1,t.rightbottom],[1,0],[0,0],[0,1],[t.topleft,1]]},qo[149]=qo[21]=function(t){return[[t.topright,1],[1,1],[1,0],[0,0],[0,t.leftbottom]]},qo[86]=qo[84]=function(t){return[[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[1,1]]},qo[89]=qo[81]=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,1]]},qo[96]=qo[74]=function(t){return[[1,t.righttop],[1,t.rightbottom],[0,t.lefttop],[0,1],[t.topleft,1]]},qo[24]=qo[146]=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[t.topright,1]]},qo[6]=qo[164]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop]]},qo[129]=qo[41]=function(t){return[[t.topright,1],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topleft,1]]},qo[66]=qo[104]=function(t){return[[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1],[t.topleft,1]]},qo[144]=qo[26]=function(t){return[[1,1],[1,t.righttop],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},qo[36]=qo[134]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[t.topleft,1],[t.topright,1]]},qo[9]=qo[161]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,t.leftbottom]]},qo[37]=qo[133]=function(t){return[[1,t.rightbottom],[1,0],[0,0],[0,t.leftbottom],[t.topleft,1],[t.topright,1]]},qo[148]=qo[22]=function(t){return[[1,1],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},qo[82]=qo[88]=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1]]},qo[73]=qo[97]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,1],[t.topleft,1]]},qo[145]=qo[25]=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topright,1]]},qo[70]=qo[100]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[t.topleft,1]]},qo[34]=function(t){return[Ro(t),zo(t)]},qo[35]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]},qo[136]=function(t){return[Do(t),Lo(t)]},qo[153]=function(t){return[Po(t),Mo(t)]},qo[102]=function(t){return[Ao(t),ko(t)]},qo[155]=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topright,1]]},qo[103]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[t.topleft,1]]},qo[152]=function(t){return[Po(t),Lo(t)]},qo[156]=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},qo[137]=function(t){return[Do(t),Mo(t)]},qo[139]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topleft,1],[t.topright,1]]},qo[98]=function(t){return[zo(t),ko(t)]},qo[99]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1],[t.topleft,1]]},qo[38]=function(t){return[Ao(t),Ro(t)]},qo[39]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]};var us=function(){function t(e){this.id=t.buildId(e),this.coordinates=e,this.innerEdges=[],this.outerEdges=[],this.outerEdgesSorted=!1}return t.buildId=function(t){return t.join(",")},t.prototype.removeInnerEdge=function(t){this.innerEdges=this.innerEdges.filter(function(e){return e.from.id!==t.from.id})},t.prototype.removeOuterEdge=function(t){this.outerEdges=this.outerEdges.filter(function(e){return e.to.id!==t.to.id})},t.prototype.addOuterEdge=function(t){this.outerEdges.push(t),this.outerEdgesSorted=!1},t.prototype.sortOuterEdges=function(){var t=this;this.outerEdgesSorted||(this.outerEdges.sort(function(e,r){var n=e.to,i=r.to;if(n.coordinates[0]-t.coordinates[0]>=0&&i.coordinates[0]-t.coordinates[0]<0)return 1;if(n.coordinates[0]-t.coordinates[0]<0&&i.coordinates[0]-t.coordinates[0]>=0)return-1;if(n.coordinates[0]-t.coordinates[0]==0&&i.coordinates[0]-t.coordinates[0]==0)return n.coordinates[1]-t.coordinates[1]>=0||i.coordinates[1]-t.coordinates[1]>=0?n.coordinates[1]-i.coordinates[1]:i.coordinates[1]-n.coordinates[1];var o=as(t.coordinates,n.coordinates,i.coordinates);return o<0?1:o>0?-1:Math.pow(n.coordinates[0]-t.coordinates[0],2)+Math.pow(n.coordinates[1]-t.coordinates[1],2)-(Math.pow(i.coordinates[0]-t.coordinates[0],2)+Math.pow(i.coordinates[1]-t.coordinates[1],2))}),this.outerEdgesSorted=!0)},t.prototype.getOuterEdges=function(){return this.sortOuterEdges(),this.outerEdges},t.prototype.getOuterEdge=function(t){return this.sortOuterEdges(),this.outerEdges[t]},t.prototype.addInnerEdge=function(t){this.innerEdges.push(t)},t}(),cs=function(){function t(t,e){this.from=t,this.to=e,this.next=void 0,this.label=void 0,this.symetric=void 0,this.ring=void 0,this.from.addOuterEdge(this),this.to.addInnerEdge(this)}return t.prototype.getSymetric=function(){return this.symetric||(this.symetric=new t(this.to,this.from),this.symetric.symetric=this),this.symetric},t.prototype.deleteEdge=function(){this.from.removeOuterEdge(this),this.to.removeInnerEdge(this)},t.prototype.isEqual=function(t){return this.from.id===t.from.id&&this.to.id===t.to.id},t.prototype.toString=function(){return"Edge { "+this.from.id+" -> "+this.to.id+" }"},t.prototype.toLineString=function(){return p([this.from.coordinates,this.to.coordinates])},t.prototype.compareTo=function(t){return as(t.from.coordinates,t.to.coordinates,this.to.coordinates)},t}(),hs=function(){function t(){this.edges=[],this.polygon=void 0,this.envelope=void 0}return t.prototype.push=function(t){this.edges.push(t),this.polygon=this.envelope=void 0},t.prototype.get=function(t){return this.edges[t]},Object.defineProperty(t.prototype,"length",{get:function(){return this.edges.length},enumerable:!0,configurable:!0}),t.prototype.forEach=function(t){this.edges.forEach(t)},t.prototype.map=function(t){return this.edges.map(t)},t.prototype.some=function(t){return this.edges.some(t)},t.prototype.isValid=function(){return!0},t.prototype.isHole=function(){var t=this,e=this.edges.reduce(function(e,r,n){return r.from.coordinates[1]>t.edges[e].from.coordinates[1]&&(e=n),e},0),r=(0===e?this.length:e)-1,n=(e+1)%this.length,i=as(this.edges[r].from.coordinates,this.edges[e].from.coordinates,this.edges[n].from.coordinates);return 0===i?this.edges[r].from.coordinates[0]>this.edges[n].from.coordinates[0]:i>0},t.prototype.toMultiPoint=function(){return g(this.edges.map(function(t){return t.from.coordinates}))},t.prototype.toPolygon=function(){if(this.polygon)return this.polygon;var t=this.edges.map(function(t){return t.from.coordinates});return t.push(this.edges[0].from.coordinates),this.polygon=c([t])},t.prototype.getEnvelope=function(){return this.envelope?this.envelope:this.envelope=mr(this.toPolygon())},t.findEdgeRingContaining=function(t,e){var r,n,i=t.getEnvelope();return e.forEach(function(e){var o,s,a,u,c,h,p=e.getEnvelope();if(n&&(r=n.getEnvelope()),s=i,a=(o=p).geometry.coordinates[0].map(function(t){return t[0]}),u=o.geometry.coordinates[0].map(function(t){return t[1]}),c=s.geometry.coordinates[0].map(function(t){return t[0]}),h=s.geometry.coordinates[0].map(function(t){return t[1]}),(Math.max.apply(null,a)!==Math.max.apply(null,c)||Math.max.apply(null,u)!==Math.max.apply(null,h)||Math.min.apply(null,a)!==Math.min.apply(null,c)||Math.min.apply(null,u)!==Math.min.apply(null,h))&&ls(p,i)){for(var f=t.map(function(t){return t.from.coordinates}),d=void 0,m=function(t){e.some(function(e){return r=t,n=e.from.coordinates,r[0]===n[0]&&r[1]===n[1];var r,n})||(d=t)},g=0,y=f;g<y.length;g++)m(y[g]);d&&e.inside(l(d))&&(n&&!ls(r,p)||(n=e))}}),n},t.prototype.inside=function(t){return ye(t,this.toPolygon())},t}(),ps=function(){function t(){this.edges=[],this.nodes={}}return t.fromGeoJson=function(e){!function(t){if(!t)throw new Error("No geojson passed");if("FeatureCollection"!==t.type&&"GeometryCollection"!==t.type&&"MultiLineString"!==t.type&&"LineString"!==t.type&&"Feature"!==t.type)throw new Error("Invalid input type '"+t.type+"'. Geojson must be FeatureCollection, GeometryCollection, LineString, MultiLineString or Feature")}(e);var r=new t;return V(e,function(t){rt(t,"LineString","Graph::fromGeoJson"),D(t,function(t,e){if(t){var n=r.getNode(t),i=r.getNode(e);r.addEdge(n,i)}return e})}),r},t.prototype.getNode=function(t){var e=us.buildId(t),r=this.nodes[e];return r||(r=this.nodes[e]=new us(t)),r},t.prototype.addEdge=function(t,e){var r=new cs(t,e),n=r.getSymetric();this.edges.push(r),this.edges.push(n)},t.prototype.deleteDangles=function(){var t=this;Object.keys(this.nodes).map(function(e){return t.nodes[e]}).forEach(function(e){return t._removeIfDangle(e)})},t.prototype._removeIfDangle=function(t){var e=this;if(t.innerEdges.length<=1){var r=t.getOuterEdges().map(function(t){return t.to});this.removeNode(t),r.forEach(function(t){return e._removeIfDangle(t)})}},t.prototype.deleteCutEdges=function(){var t=this;this._computeNextCWEdges(),this._findLabeledEdgeRings(),this.edges.forEach(function(e){e.label===e.symetric.label&&(t.removeEdge(e.symetric),t.removeEdge(e))})},t.prototype._computeNextCWEdges=function(t){var e=this;void 0===t?Object.keys(this.nodes).forEach(function(t){return e._computeNextCWEdges(e.nodes[t])}):t.getOuterEdges().forEach(function(e,r){t.getOuterEdge((0===r?t.getOuterEdges().length:r)-1).symetric.next=e})},t.prototype._computeNextCCWEdges=function(t,e){for(var r,n,i=t.getOuterEdges(),o=i.length-1;o>=0;--o){var s=i[o],a=s.symetric,l=void 0,u=void 0;s.label===e&&(l=s),a.label===e&&(u=a),l&&u&&(u&&(n=u),l&&(n&&(n.next=l,n=void 0),r||(r=l)))}n&&(n.next=r)},t.prototype._findLabeledEdgeRings=function(){var t=[],e=0;return this.edges.forEach(function(r){if(!(r.label>=0)){t.push(r);var n=r;do{n.label=e,n=n.next}while(!r.isEqual(n));e++}}),t},t.prototype.getEdgeRings=function(){var t=this;this._computeNextCWEdges(),this.edges.forEach(function(t){t.label=void 0}),this._findLabeledEdgeRings().forEach(function(e){t._findIntersectionNodes(e).forEach(function(r){t._computeNextCCWEdges(r,e.label)})});var e=[];return this.edges.forEach(function(r){r.ring||e.push(t._findEdgeRing(r))}),e},t.prototype._findIntersectionNodes=function(t){var e=[],r=t,n=function(){var n=0;r.from.getOuterEdges().forEach(function(e){e.label===t.label&&++n}),n>1&&e.push(r.from),r=r.next};do{n()}while(!t.isEqual(r));return e},t.prototype._findEdgeRing=function(t){var e=t,r=new hs;do{r.push(e),e.ring=r,e=e.next}while(!t.isEqual(e));return r},t.prototype.removeNode=function(t){var e=this;t.getOuterEdges().forEach(function(t){return e.removeEdge(t)}),t.innerEdges.forEach(function(t){return e.removeEdge(t)}),delete this.nodes[t.id]},t.prototype.removeEdge=function(t){this.edges=this.edges.filter(function(e){return!e.isEqual(t)}),t.deleteEdge()},t}();function fs(t,e){var r=!0;return V(t,function(t){V(e,function(e){if(!1===r)return!1;r=function(t,e){switch(t.type){case"Point":switch(e.type){case"Point":return r=t.coordinates,n=e.coordinates,!(r[0]===n[0]&&r[1]===n[1]);case"LineString":return!ds(e,t);case"Polygon":return!ye(t,e)}break;case"LineString":switch(e.type){case"Point":return!ds(t,e);case"LineString":return!function(t,e){return Ln(t,e).features.length>0}(t,e);case"Polygon":return!ms(e,t)}break;case"Polygon":switch(e.type){case"Point":return!ye(e,t);case"LineString":return!ms(t,e);case"Polygon":return!function(t,e){for(var r=0,n=t.coordinates[0];r<n.length;r++)if(ye(n[r],e))return!0;for(var i=0,o=e.coordinates[0];i<o.length;i++)if(ye(o[i],t))return!0;return Ln(Ii(t),Ii(e)).features.length>0}(e,t)}}var r,n;return!1}(t.geometry,e.geometry)})}),r}function ds(t,e){for(var r=0;r<t.coordinates.length-1;r++)if(gs(t.coordinates[r],t.coordinates[r+1],e.coordinates))return!0;return!1}function ms(t,e){for(var r=0,n=e.coordinates;r<n.length;r++)if(ye(n[r],t))return!0;return Ln(e,Ii(t)).features.length>0}function gs(t,e,r){var n=r[0]-t[0],i=r[1]-t[1],o=e[0]-t[0],s=e[1]-t[1];return 0==n*s-i*o&&(Math.abs(o)>=Math.abs(s)?o>0?t[0]<=r[0]&&r[0]<=e[0]:e[0]<=r[0]&&r[0]<=t[0]:s>0?t[1]<=r[1]&&r[1]<=e[1]:e[1]<=r[1]&&r[1]<=t[1])}function ys(t,e){return!(t[0]>e[0])&&!(t[2]<e[2])&&!(t[1]>e[1])&&!(t[3]<e[3])}function _s(t,e){return t[0]===e[0]&&t[1]===e[1]}function vs(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]}function xs(t,e){for(var r=!1,n=!1,i=t.coordinates.length,o=0;o<i&&!r&&!n;){for(var s=0;s<e.coordinates.length-1;s++){var a=!0;0!==s&&s!==e.coordinates.length-2||(a=!1),Es(e.coordinates[s],e.coordinates[s+1],t.coordinates[o],a)?r=!0:n=!0}o++}return r&&n}function bs(t,e){return Ln(t,Ti(e)).features.length>0}function ws(t,e){for(var r=!1,n=!1,i=t.coordinates.length,o=0;o<i&&(!r||!n);o++)ye(l(t.coordinates[o]),e)?r=!0:n=!0;return n&&r}function Es(t,e,r,n){var i=r[0]-t[0],o=r[1]-t[1],s=e[0]-t[0],a=e[1]-t[1];return 0==i*a-o*s&&(n?Math.abs(s)>=Math.abs(a)?s>0?t[0]<=r[0]&&r[0]<=e[0]:e[0]<=r[0]&&r[0]<=t[0]:a>0?t[1]<=r[1]&&r[1]<=e[1]:e[1]<=r[1]&&r[1]<=t[1]:Math.abs(s)>=Math.abs(a)?s>0?t[0]<r[0]&&r[0]<e[0]:e[0]<r[0]&&r[0]<t[0]:a>0?t[1]<r[1]&&r[1]<e[1]:e[1]<r[1]&&r[1]<t[1])}var Ss=function(t){this.precision=t&&t.precision?t.precision:17,this.direction=!(!t||!t.direction)&&t.direction,this.pseudoNode=!(!t||!t.pseudoNode)&&t.pseudoNode,this.objectComparator=t&&t.objectComparator?t.objectComparator:Cs};function Is(t){return t.coordinates.map(function(e){return{type:t.type.replace("Multi",""),coordinates:e}})}function Ts(t,e){return t.hasOwnProperty("coordinates")?t.coordinates.length===e.coordinates.length:t.length===e.length}function Cs(t,e){return Ni(t,e,{strict:!0})}Ss.prototype.compare=function(t,e){if(t.type!==e.type||!Ts(t,e))return!1;switch(t.type){case"Point":return this.compareCoord(t.coordinates,e.coordinates);case"LineString":return this.compareLine(t.coordinates,e.coordinates,0,!1);case"Polygon":return this.comparePolygon(t,e);case"Feature":return this.compareFeature(t,e);default:if(0===t.type.indexOf("Multi")){var r=this,n=Is(t),i=Is(e);return n.every(function(t){return this.some(function(e){return r.compare(t,e)})},i)}}return!1},Ss.prototype.compareCoord=function(t,e){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r++)if(t[r].toFixed(this.precision)!==e[r].toFixed(this.precision))return!1;return!0},Ss.prototype.compareLine=function(t,e,r,n){if(!Ts(t,e))return!1;var i=this.pseudoNode?t:this.removePseudo(t),o=this.pseudoNode?e:this.removePseudo(e);if(!n||this.compareCoord(i[0],o[0])||(o=this.fixStartIndex(o,i))){var s=this.compareCoord(i[r],o[r]);return this.direction||s?this.comparePath(i,o):!!this.compareCoord(i[r],o[o.length-(1+r)])&&this.comparePath(i.slice().reverse(),o)}},Ss.prototype.fixStartIndex=function(t,e){for(var r,n=-1,i=0;i<t.length;i++)if(this.compareCoord(t[i],e[0])){n=i;break}return n>=0&&(r=[].concat(t.slice(n,t.length),t.slice(1,n+1))),r},Ss.prototype.comparePath=function(t,e){var r=this;return t.every(function(t,e){return r.compareCoord(t,this[e])},e)},Ss.prototype.comparePolygon=function(t,e){if(this.compareLine(t.coordinates[0],e.coordinates[0],1,!0)){var r=t.coordinates.slice(1,t.coordinates.length),n=e.coordinates.slice(1,e.coordinates.length),i=this;return r.every(function(t){return this.some(function(e){return i.compareLine(t,e,1,!0)})},n)}return!1},Ss.prototype.compareFeature=function(t,e){return!(t.id!==e.id||!this.objectComparator(t.properties,e.properties)||!this.compareBBox(t,e))&&this.compare(t.geometry,e.geometry)},Ss.prototype.compareBBox=function(t,e){return!!(!t.bbox&&!e.bbox||t.bbox&&e.bbox&&this.compareCoord(t.bbox,e.bbox))},Ss.prototype.removePseudo=function(t){return t};var Ms=Ss;function As(t,e){var r=!1;return V(t,function(t){V(e,function(e){if(!0===r)return!0;r=!fs(t.geometry,e.geometry)})}),r}var Ps=Ut(function(t){function e(t,e,r,n){this.dataset=[],this.epsilon=1,this.minPts=2,this.distance=this._euclideanDistance,this.clusters=[],this.noise=[],this._visited=[],this._assigned=[],this._datasetLength=0,this._init(t,e,r,n)}e.prototype.run=function(t,e,r,n){this._init(t,e,r,n);for(var i=0;i<this._datasetLength;i++)if(1!==this._visited[i]){this._visited[i]=1;var o=this._regionQuery(i);if(o.length<this.minPts)this.noise.push(i);else{var s=this.clusters.length;this.clusters.push([]),this._addToCluster(i,s),this._expandCluster(s,o)}}return this.clusters},e.prototype._init=function(t,e,r,n){if(t){if(!(t instanceof Array))throw Error("Dataset must be of type array, "+typeof t+" given");this.dataset=t,this.clusters=[],this.noise=[],this._datasetLength=t.length,this._visited=new Array(this._datasetLength),this._assigned=new Array(this._datasetLength)}e&&(this.epsilon=e),r&&(this.minPts=r),n&&(this.distance=n)},e.prototype._expandCluster=function(t,e){for(var r=0;r<e.length;r++){var n=e[r];if(1!==this._visited[n]){this._visited[n]=1;var i=this._regionQuery(n);i.length>=this.minPts&&(e=this._mergeArrays(e,i))}1!==this._assigned[n]&&this._addToCluster(n,t)}},e.prototype._addToCluster=function(t,e){this.clusters[e].push(t),this._assigned[t]=1},e.prototype._regionQuery=function(t){for(var e=[],r=0;r<this._datasetLength;r++)this.distance(this.dataset[t],this.dataset[r])<this.epsilon&&e.push(r);return e},e.prototype._mergeArrays=function(t,e){for(var r=e.length,n=0;n<r;n++){var i=e[n];t.indexOf(i)<0&&t.push(i)}return t},e.prototype._euclideanDistance=function(t,e){for(var r=0,n=Math.min(t.length,e.length);n--;)r+=(t[n]-e[n])*(t[n]-e[n]);return Math.sqrt(r)},t.exports&&(t.exports=e)}),ks=Ut(function(t){function e(t,e,r){this.k=3,this.dataset=[],this.assignments=[],this.centroids=[],this.init(t,e,r)}e.prototype.init=function(t,e,r){this.assignments=[],this.centroids=[],void 0!==t&&(this.dataset=t),void 0!==e&&(this.k=e),void 0!==r&&(this.distance=r)},e.prototype.run=function(t,e){this.init(t,e);for(var r=this.dataset.length,n=0;n<this.k;n++)this.centroids[n]=this.randomCentroid();for(var i=!0;i;){i=this.assign();for(var o=0;o<this.k;o++){for(var s=new Array(c),a=0,l=0;l<c;l++)s[l]=0;for(var u=0;u<r;u++){var c=this.dataset[u].length;if(o===this.assignments[u]){for(l=0;l<c;l++)s[l]+=this.dataset[u][l];a++}}if(a>0){for(l=0;l<c;l++)s[l]/=a;this.centroids[o]=s}else this.centroids[o]=this.randomCentroid(),i=!0}}return this.getClusters()},e.prototype.randomCentroid=function(){var t,e,r=this.dataset.length-1;do{e=Math.round(Math.random()*r),t=this.dataset[e]}while(this.centroids.indexOf(t)>=0);return t},e.prototype.assign=function(){for(var t,e=!1,r=this.dataset.length,n=0;n<r;n++)(t=this.argmin(this.dataset[n],this.centroids,this.distance))!=this.assignments[n]&&(this.assignments[n]=t,e=!0);return e},e.prototype.getClusters=function(){for(var t,e=new Array(this.k),r=0;r<this.assignments.length;r++)void 0===e[t=this.assignments[r]]&&(e[t]=[]),e[t].push(r);return e},e.prototype.argmin=function(t,e,r){for(var n,i=Number.MAX_VALUE,o=0,s=e.length,a=0;a<s;a++)(n=r(t,e[a]))<i&&(i=n,o=a);return o},e.prototype.distance=function(t,e){for(var r=0,n=Math.min(t.length,e.length);n--;){var i=t[n]-e[n];r+=i*i}return Math.sqrt(r)},t.exports&&(t.exports=e)}),Ls=Ut(function(t){function e(t,e,r){this._queue=[],this._priorities=[],this._sorting="desc",this._init(t,e,r)}e.prototype.insert=function(t,e){for(var r=this._queue.length,n=r;n--;){var i=this._priorities[n];"desc"===this._sorting?e>i&&(r=n):e<i&&(r=n)}this._insertAt(t,e,r)},e.prototype.remove=function(t){for(var e=this._queue.length;e--;)if(t===this._queue[e]){this._queue.splice(e,1),this._priorities.splice(e,1);break}},e.prototype.forEach=function(t){this._queue.forEach(t)},e.prototype.getElements=function(){return this._queue},e.prototype.getElementPriority=function(t){return this._priorities[t]},e.prototype.getPriorities=function(){return this._priorities},e.prototype.getElementsWithPriorities=function(){for(var t=[],e=0,r=this._queue.length;e<r;e++)t.push([this._queue[e],this._priorities[e]]);return t},e.prototype._init=function(t,e,r){if(t&&e){if(this._queue=[],this._priorities=[],t.length!==e.length)throw new Error("Arrays must have the same length");for(var n=0;n<t.length;n++)this.insert(t[n],e[n])}r&&(this._sorting=r)},e.prototype._insertAt=function(t,e,r){this._queue.length===r?(this._queue.push(t),this._priorities.push(e)):(this._queue.splice(r,0,t),this._priorities.splice(r,0,e))},t.exports&&(t.exports=e)}),zs=Ut(function(t){if(t.exports)var e=Ls;function r(t,e,r,n){this.epsilon=1,this.minPts=1,this.distance=this._euclideanDistance,this._reachability=[],this._processed=[],this._coreDistance=0,this._orderedList=[],this._init(t,e,r,n)}r.prototype.run=function(t,r,n,i){this._init(t,r,n,i);for(var o=0,s=this.dataset.length;o<s;o++)if(1!==this._processed[o]){this._processed[o]=1,this.clusters.push([o]);var a=this.clusters.length-1;this._orderedList.push(o);var l=new e(null,null,"asc"),u=this._regionQuery(o);void 0!==this._distanceToCore(o)&&(this._updateQueue(o,u,l),this._expandCluster(a,l))}return this.clusters},r.prototype.getReachabilityPlot=function(){for(var t=[],e=0,r=this._orderedList.length;e<r;e++){var n=this._orderedList[e],i=this._reachability[n];t.push([n,i])}return t},r.prototype._init=function(t,e,r,n){if(t){if(!(t instanceof Array))throw Error("Dataset must be of type array, "+typeof t+" given");this.dataset=t,this.clusters=[],this._reachability=new Array(this.dataset.length),this._processed=new Array(this.dataset.length),this._coreDistance=0,this._orderedList=[]}e&&(this.epsilon=e),r&&(this.minPts=r),n&&(this.distance=n)},r.prototype._updateQueue=function(t,e,r){var n=this;this._coreDistance=this._distanceToCore(t),e.forEach(function(e){if(void 0===n._processed[e]){var i=n.distance(n.dataset[t],n.dataset[e]),o=Math.max(n._coreDistance,i);void 0===n._reachability[e]?(n._reachability[e]=o,r.insert(e,o)):o<n._reachability[e]&&(n._reachability[e]=o,r.remove(e),r.insert(e,o))}})},r.prototype._expandCluster=function(t,e){for(var r=e.getElements(),n=0,i=r.length;n<i;n++){var o=r[n];if(void 0===this._processed[o]){var s=this._regionQuery(o);this._processed[o]=1,this.clusters[t].push(o),this._orderedList.push(o),void 0!==this._distanceToCore(o)&&(this._updateQueue(o,s,e),this._expandCluster(t,e))}}},r.prototype._distanceToCore=function(t){for(var e=this.epsilon,r=0;r<e;r++)if(this._regionQuery(t,r).length>=this.minPts)return r},r.prototype._regionQuery=function(t,e){e=e||this.epsilon;for(var r=[],n=0,i=this.dataset.length;n<i;n++)this.distance(this.dataset[t],this.dataset[n])<e&&r.push(n);return r},r.prototype._euclideanDistance=function(t,e){for(var r=0,n=Math.min(t.length,e.length);n--;)r+=(t[n]-e[n])*(t[n]-e[n]);return Math.sqrt(r)},t.exports&&(t.exports=r)}),Ds=Ut(function(t){t.exports&&(t.exports={DBSCAN:Ps,KMEANS:ks,OPTICS:zs,PriorityQueue:Ls})}),Rs=function(t,e,r){for(var n=t.length,i=0,o=0;o<n;o++){var s=(t[o]||0)-(e[o]||0);i+=s*s}return r?Math.sqrt(i):i},Os=Rs,Ns=function(t,e,r){var n=Math.abs(t-e);return r?n:n*n},Fs=Rs,Bs=function(t,e){for(var r={},n=[],i=e<<2,o=t.length,s=t[0].length>0;n.length<e&&i-- >0;){var a=t[Math.floor(Math.random()*o)],l=s?a.join("_"):""+a;r[l]||(r[l]=!0,n.push(a))}if(n.length<e)throw new Error("Error initializating clusters");return n},js=function(t,e){var r=t[0].length?Os:Ns,n=[],i=t.length,o=t[0].length>0,s=t[Math.floor(Math.random()*i)];for(o&&s.join("_"),n.push(s);n.length<e;){for(var a=[],l=n.length,u=0,c=[],h=0;h<i;h++){for(var p=1/0,f=0;f<l;f++){var d=r(t[h],n[f]);d<=p&&(p=d)}a[h]=p}for(var m=0;m<i;m++)u+=a[m];for(var g=0;g<i;g++)c[g]={i:g,v:t[g],pr:a[g]/u,cs:0};c.sort(function(t,e){return t.pr-e.pr}),c[0].cs=c[0].pr;for(var y=1;y<i;y++)c[y].cs=c[y-1].cs+c[y].pr;for(var _=Math.random(),v=0;v<i-1&&c[v++].cs<_;);n.push(c[v-1].v)}return n};function Us(t,e,r){r=r||[];for(var n=0;n<t;n++)r[n]=e;return r}var Vs=function(t,e,r,n){var i=[],o=[],s=[],a=[],l=!1,u=n||1e4,c=t.length,h=t[0].length,p=h>0,f=[];if(r)i="kmrand"==r?Bs(t,e):"kmpp"==r?js(t,e):r;else for(var d={};i.length<e;){var m=Math.floor(Math.random()*c);d[m]||(d[m]=!0,i.push(t[m]))}do{Us(e,0,f);for(var g=0;g<c;g++){for(var y=1/0,_=0,v=0;v<e;v++)(a=p?Fs(t[g],i[v]):Math.abs(t[g]-i[v]))<=y&&(y=a,_=v);s[g]=_,f[_]++}for(var x=[],b=(o=[],0);b<e;b++)x[b]=p?Us(h,0,x[b]):0,o[b]=i[b];if(p){for(var w=0;w<e;w++)i[w]=[];for(var E=0;E<c;E++)for(var S=x[s[E]],I=t[E],T=0;T<h;T++)S[T]+=I[T];l=!0;for(var C=0;C<e;C++){for(var M=i[C],A=x[C],P=o[C],k=f[C],L=0;L<h;L++)M[L]=A[L]/k||0;if(l)for(var z=0;z<h;z++)if(P[z]!=M[z]){l=!1;break}}}else{for(var D=0;D<c;D++)x[s[D]]+=t[D];for(var R=0;R<e;R++)i[R]=x[R]/f[R]||0;l=!0;for(var O=0;O<e;O++)if(o[O]!=i[O]){l=!1;break}}l=l||--u<=0}while(!l);return{it:1e4-u,k:e,idxs:s,centroids:i}};function Gs(t,e){return E(Ui(t[0],t[1]))===E(Ui(e[0],e[1]))}function qs(t,e){if(t.geometry&&t.geometry.type)return t.geometry.type;if(t.type)return t.type;throw new Error("Invalid GeoJSON object for "+e)}function $s(t){for(var e=t,r=[];e.parent;)r.unshift(e),e=e.parent;return r}var Zs={search:function(t,e,r,n){t.cleanDirty();var i=(n=n||{}).heuristic||Zs.heuristics.manhattan,o=n.closest||!1,s=new Ys(function(t){return t.f}),a=e;for(e.h=i(e,r),s.push(e);s.size()>0;){var l=s.pop();if(l===r)return $s(l);l.closed=!0;for(var u=t.neighbors(l),c=0,h=u.length;c<h;++c){var p=u[c];if(!p.closed&&!p.isWall()){var f=l.g+p.getCost(l),d=p.visited;(!d||f<p.g)&&(p.visited=!0,p.parent=l,p.h=p.h||i(p,r),p.g=f,p.f=p.g+p.h,t.markDirty(p),o&&(p.h<a.h||p.h===a.h&&p.g<a.g)&&(a=p),d?s.rescoreElement(p):s.push(p))}}}return o?$s(a):[]},heuristics:{manhattan:function(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)},diagonal:function(t,e){var r=Math.sqrt(2),n=Math.abs(e.x-t.x),i=Math.abs(e.y-t.y);return 1*(n+i)+(r-2)*Math.min(n,i)}},cleanNode:function(t){t.f=0,t.g=0,t.h=0,t.visited=!1,t.closed=!1,t.parent=null}};function Xs(t,e){e=e||{},this.nodes=[],this.diagonal=!!e.diagonal,this.grid=[];for(var r=0;r<t.length;r++){this.grid[r]=[];for(var n=0,i=t[r];n<i.length;n++){var o=new Ws(r,n,i[n]);this.grid[r][n]=o,this.nodes.push(o)}}this.init()}function Ws(t,e,r){this.x=t,this.y=e,this.weight=r}function Ys(t){this.content=[],this.scoreFunction=t}function Hs(t,e){for(var r=0;r<e.features.length;r++)if(ye(t,e.features[r]))return!0;return!1}function Js(t){return function(){return t}}function Ks(t){return t[0]}function Qs(t){return t[1]}function ta(){this._=null}function ea(t){t.U=t.C=t.L=t.R=t.P=t.N=null}function ra(t,e){var r=e,n=e.R,i=r.U;i?i.L===r?i.L=n:i.R=n:t._=n,n.U=i,r.U=n,r.R=n.L,r.R&&(r.R.U=r),n.L=r}function na(t,e){var r=e,n=e.L,i=r.U;i?i.L===r?i.L=n:i.R=n:t._=n,n.U=i,r.U=n,r.L=n.R,r.L&&(r.L.U=r),n.R=r}function ia(t){for(;t.L;)t=t.L;return t}function oa(t,e,r,n){var i=[null,null],o=Aa.push(i)-1;return i.left=t,i.right=e,r&&aa(i,t,e,r),n&&aa(i,e,t,n),Ca[t.index].halfedges.push(o),Ca[e.index].halfedges.push(o),i}function sa(t,e,r){var n=[e,r];return n.left=t,n}function aa(t,e,r,n){t[0]||t[1]?t.left===r?t[1]=n:t[0]=n:(t[0]=n,t.left=e,t.right=r)}function la(t,e,r,n,i){var o,s=t[0],a=t[1],l=s[0],u=s[1],c=0,h=1,p=a[0]-l,f=a[1]-u;if(o=e-l,p||!(o>0)){if(o/=p,p<0){if(o<c)return;o<h&&(h=o)}else if(p>0){if(o>h)return;o>c&&(c=o)}if(o=n-l,p||!(o<0)){if(o/=p,p<0){if(o>h)return;o>c&&(c=o)}else if(p>0){if(o<c)return;o<h&&(h=o)}if(o=r-u,f||!(o>0)){if(o/=f,f<0){if(o<c)return;o<h&&(h=o)}else if(f>0){if(o>h)return;o>c&&(c=o)}if(o=i-u,f||!(o<0)){if(o/=f,f<0){if(o>h)return;o>c&&(c=o)}else if(f>0){if(o<c)return;o<h&&(h=o)}return!(c>0||h<1)||(c>0&&(t[0]=[l+c*p,u+c*f]),h<1&&(t[1]=[l+h*p,u+h*f]),!0)}}}}}function ua(t,e,r,n,i){var o=t[1];if(o)return!0;var s,a,l=t[0],u=t.left,c=t.right,h=u[0],p=u[1],f=c[0],d=c[1],m=(h+f)/2,g=(p+d)/2;if(d===p){if(m<e||m>=n)return;if(h>f){if(l){if(l[1]>=i)return}else l=[m,r];o=[m,i]}else{if(l){if(l[1]<r)return}else l=[m,i];o=[m,r]}}else if(a=g-(s=(h-f)/(d-p))*m,s<-1||s>1)if(h>f){if(l){if(l[1]>=i)return}else l=[(r-a)/s,r];o=[(i-a)/s,i]}else{if(l){if(l[1]<r)return}else l=[(i-a)/s,i];o=[(r-a)/s,r]}else if(p<d){if(l){if(l[0]>=n)return}else l=[e,s*e+a];o=[n,s*n+a]}else{if(l){if(l[0]<e)return}else l=[n,s*n+a];o=[e,s*e+a]}return t[0]=l,t[1]=o,!0}function ca(t,e){var r=t.site,n=e.left,i=e.right;return r===i&&(i=n,n=r),i?Math.atan2(i[1]-n[1],i[0]-n[0]):(r===n?(n=e[1],i=e[0]):(n=e[0],i=e[1]),Math.atan2(n[0]-i[0],i[1]-n[1]))}function ha(t,e){return e[+(e.left!==t.site)]}function pa(t,e){return e[+(e.left===t.site)]}Xs.prototype.init=function(){this.dirtyNodes=[];for(var t=0;t<this.nodes.length;t++)Zs.cleanNode(this.nodes[t])},Xs.prototype.cleanDirty=function(){for(var t=0;t<this.dirtyNodes.length;t++)Zs.cleanNode(this.dirtyNodes[t]);this.dirtyNodes=[]},Xs.prototype.markDirty=function(t){this.dirtyNodes.push(t)},Xs.prototype.neighbors=function(t){var e=[],r=t.x,n=t.y,i=this.grid;return i[r-1]&&i[r-1][n]&&e.push(i[r-1][n]),i[r+1]&&i[r+1][n]&&e.push(i[r+1][n]),i[r]&&i[r][n-1]&&e.push(i[r][n-1]),i[r]&&i[r][n+1]&&e.push(i[r][n+1]),this.diagonal&&(i[r-1]&&i[r-1][n-1]&&e.push(i[r-1][n-1]),i[r+1]&&i[r+1][n-1]&&e.push(i[r+1][n-1]),i[r-1]&&i[r-1][n+1]&&e.push(i[r-1][n+1]),i[r+1]&&i[r+1][n+1]&&e.push(i[r+1][n+1])),e},Xs.prototype.toString=function(){for(var t,e,r,n,i=[],o=this.grid,s=0,a=o.length;s<a;s++){for(t=[],r=0,n=(e=o[s]).length;r<n;r++)t.push(e[r].weight);i.push(t.join(" "))}return i.join("\n")},Ws.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},Ws.prototype.getCost=function(t){return t&&t.x!==this.x&&t.y!==this.y?1.41421*this.weight:this.weight},Ws.prototype.isWall=function(){return 0===this.weight},Ys.prototype={push:function(t){this.content.push(t),this.sinkDown(this.content.length-1)},pop:function(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.bubbleUp(0)),t},remove:function(t){var e=this.content.indexOf(t),r=this.content.pop();e!==this.content.length-1&&(this.content[e]=r,this.scoreFunction(r)<this.scoreFunction(t)?this.sinkDown(e):this.bubbleUp(e))},size:function(){return this.content.length},rescoreElement:function(t){this.sinkDown(this.content.indexOf(t))},sinkDown:function(t){for(var e=this.content[t];t>0;){var r=(t+1>>1)-1,n=this.content[r];if(!(this.scoreFunction(e)<this.scoreFunction(n)))break;this.content[r]=e,this.content[t]=n,t=r}},bubbleUp:function(t){for(var e=this.content.length,r=this.content[t],n=this.scoreFunction(r);;){var i,o=t+1<<1,s=o-1,a=null;if(s<e){var l=this.content[s];(i=this.scoreFunction(l))<n&&(a=s)}if(o<e){var u=this.content[o];this.scoreFunction(u)<(null===a?n:i)&&(a=o)}if(null===a)break;this.content[t]=this.content[a],this.content[a]=r,t=a}}},ta.prototype={constructor:ta,insert:function(t,e){var r,n,i;if(t){if(e.P=t,e.N=t.N,t.N&&(t.N.P=e),t.N=e,t.R){for(t=t.R;t.L;)t=t.L;t.L=e}else t.R=e;r=t}else this._?(t=ia(this._),e.P=null,e.N=t,t.P=t.L=e,r=t):(e.P=e.N=null,this._=e,r=null);for(e.L=e.R=null,e.U=r,e.C=!0,t=e;r&&r.C;)r===(n=r.U).L?(i=n.R)&&i.C?(r.C=i.C=!1,n.C=!0,t=n):(t===r.R&&(ra(this,r),r=(t=r).U),r.C=!1,n.C=!0,na(this,n)):(i=n.L)&&i.C?(r.C=i.C=!1,n.C=!0,t=n):(t===r.L&&(na(this,r),r=(t=r).U),r.C=!1,n.C=!0,ra(this,n)),r=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var e,r,n,i=t.U,o=t.L,s=t.R;if(r=o?s?ia(s):o:s,i?i.L===t?i.L=r:i.R=r:this._=r,o&&s?(n=r.C,r.C=t.C,r.L=o,o.U=r,r!==s?(i=r.U,r.U=t.U,t=r.R,i.L=t,r.R=s,s.U=r):(r.U=i,i=r,t=r.R)):(n=t.C,t=r),t&&(t.U=i),!n)if(t&&t.C)t.C=!1;else{do{if(t===this._)break;if(t===i.L){if((e=i.R).C&&(e.C=!1,i.C=!0,ra(this,i),e=i.R),e.L&&e.L.C||e.R&&e.R.C){e.R&&e.R.C||(e.L.C=!1,e.C=!0,na(this,e),e=i.R),e.C=i.C,i.C=e.R.C=!1,ra(this,i),t=this._;break}}else if((e=i.L).C&&(e.C=!1,i.C=!0,na(this,i),e=i.L),e.L&&e.L.C||e.R&&e.R.C){e.L&&e.L.C||(e.R.C=!1,e.C=!0,ra(this,e),e=i.L),e.C=i.C,i.C=e.L.C=!1,na(this,i),t=this._;break}e.C=!0,t=i,i=i.U}while(!t.C);t&&(t.C=!1)}}};var fa,da=[];function ma(){ea(this),this.x=this.y=this.arc=this.site=this.cy=null}function ga(t){var e=t.P,r=t.N;if(e&&r){var n=e.site,i=t.site,o=r.site;if(n!==o){var s=i[0],a=i[1],l=n[0]-s,u=n[1]-a,c=o[0]-s,h=o[1]-a,p=2*(l*h-u*c);if(!(p>=-ka)){var f=l*l+u*u,d=c*c+h*h,m=(h*f-u*d)/p,g=(l*d-c*f)/p,y=da.pop()||new ma;y.arc=t,y.site=i,y.x=m+s,y.y=(y.cy=g+a)+Math.sqrt(m*m+g*g),t.circle=y;for(var _=null,v=Ma._;v;)if(y.y<v.y||y.y===v.y&&y.x<=v.x){if(!v.L){_=v.P;break}v=v.L}else{if(!v.R){_=v;break}v=v.R}Ma.insert(_,y),_||(fa=y)}}}}function ya(t){var e=t.circle;e&&(e.P||(fa=e.N),Ma.remove(e),da.push(e),ea(e),t.circle=null)}var _a=[];function va(){ea(this),this.edge=this.site=this.circle=null}function xa(t){var e=_a.pop()||new va;return e.site=t,e}function ba(t){ya(t),Ta.remove(t),_a.push(t),ea(t)}function wa(t){var e=t.circle,r=e.x,n=e.cy,i=[r,n],o=t.P,s=t.N,a=[t];ba(t);for(var l=o;l.circle&&Math.abs(r-l.circle.x)<Pa&&Math.abs(n-l.circle.cy)<Pa;)o=l.P,a.unshift(l),ba(l),l=o;a.unshift(l),ya(l);for(var u=s;u.circle&&Math.abs(r-u.circle.x)<Pa&&Math.abs(n-u.circle.cy)<Pa;)s=u.N,a.push(u),ba(u),u=s;a.push(u),ya(u);var c,h=a.length;for(c=1;c<h;++c)u=a[c],l=a[c-1],aa(u.edge,l.site,u.site,i);l=a[0],(u=a[h-1]).edge=oa(l.site,u.site,null,i),ga(l),ga(u)}function Ea(t){for(var e,r,n,i,o=t[0],s=t[1],a=Ta._;a;)if((n=Sa(a,s)-o)>Pa)a=a.L;else{if(!((i=o-Ia(a,s))>Pa)){n>-Pa?(e=a.P,r=a):i>-Pa?(e=a,r=a.N):e=r=a;break}if(!a.R){e=a;break}a=a.R}!function(t){Ca[t.index]={site:t,halfedges:[]}}(t);var l=xa(t);if(Ta.insert(e,l),e||r){if(e===r)return ya(e),r=xa(e.site),Ta.insert(l,r),l.edge=r.edge=oa(e.site,l.site),ga(e),void ga(r);if(r){ya(e),ya(r);var u=e.site,c=u[0],h=u[1],p=t[0]-c,f=t[1]-h,d=r.site,m=d[0]-c,g=d[1]-h,y=2*(p*g-f*m),_=p*p+f*f,v=m*m+g*g,x=[(g*_-f*v)/y+c,(p*v-m*_)/y+h];aa(r.edge,u,d,x),l.edge=oa(u,t,null,x),r.edge=oa(t,d,null,x),ga(e),ga(r)}else l.edge=oa(e.site,l.site)}}function Sa(t,e){var r=t.site,n=r[0],i=r[1],o=i-e;if(!o)return n;var s=t.P;if(!s)return-1/0;var a=(r=s.site)[0],l=r[1],u=l-e;if(!u)return a;var c=a-n,h=1/o-1/u,p=c/u;return h?(-p+Math.sqrt(p*p-2*h*(c*c/(-2*u)-l+u/2+i-o/2)))/h+n:(n+a)/2}function Ia(t,e){var r=t.N;if(r)return Sa(r,e);var n=t.site;return n[1]===e?n[0]:1/0}var Ta,Ca,Ma,Aa,Pa=1e-6,ka=1e-12;function La(t,e){return e[1]-t[1]||e[0]-t[0]}function za(t,e){var r,n,i,o=t.sort(La).pop();for(Aa=[],Ca=new Array(t.length),Ta=new ta,Ma=new ta;;)if(i=fa,o&&(!i||o[1]<i.y||o[1]===i.y&&o[0]<i.x))o[0]===r&&o[1]===n||(Ea(o),r=o[0],n=o[1]),o=t.pop();else{if(!i)break;wa(i.arc)}if(function(){for(var t,e,r,n,i=0,o=Ca.length;i<o;++i)if((t=Ca[i])&&(n=(e=t.halfedges).length)){var s=new Array(n),a=new Array(n);for(r=0;r<n;++r)s[r]=r,a[r]=ca(t,Aa[e[r]]);for(s.sort(function(t,e){return a[e]-a[t]}),r=0;r<n;++r)a[r]=e[s[r]];for(r=0;r<n;++r)e[r]=a[r]}}(),e){var s=+e[0][0],a=+e[0][1],l=+e[1][0],u=+e[1][1];!function(t,e,r,n){for(var i,o=Aa.length;o--;)ua(i=Aa[o],t,e,r,n)&&la(i,t,e,r,n)&&(Math.abs(i[0][0]-i[1][0])>Pa||Math.abs(i[0][1]-i[1][1])>Pa)||delete Aa[o]}(s,a,l,u),function(t,e,r,n){var i,o,s,a,l,u,c,h,p,f,d,m,g=Ca.length,y=!0;for(i=0;i<g;++i)if(o=Ca[i]){for(s=o.site,a=(l=o.halfedges).length;a--;)Aa[l[a]]||l.splice(a,1);for(a=0,u=l.length;a<u;)d=(f=pa(o,Aa[l[a]]))[0],m=f[1],h=(c=ha(o,Aa[l[++a%u]]))[0],p=c[1],(Math.abs(d-h)>Pa||Math.abs(m-p)>Pa)&&(l.splice(a,0,Aa.push(sa(s,f,Math.abs(d-t)<Pa&&n-m>Pa?[t,Math.abs(h-t)<Pa?p:n]:Math.abs(m-n)<Pa&&r-d>Pa?[Math.abs(p-n)<Pa?h:r,n]:Math.abs(d-r)<Pa&&m-e>Pa?[r,Math.abs(h-r)<Pa?p:e]:Math.abs(m-e)<Pa&&d-t>Pa?[Math.abs(p-e)<Pa?h:t,e]:null))-1),++u);u&&(y=!1)}if(y){var _,v,x,b=1/0;for(i=0,y=null;i<g;++i)(o=Ca[i])&&(x=(_=(s=o.site)[0]-t)*_+(v=s[1]-e)*v)<b&&(b=x,y=o);if(y){var w=[t,e],E=[t,n],S=[r,n],I=[r,e];y.halfedges.push(Aa.push(sa(s=y.site,w,E))-1,Aa.push(sa(s,E,S))-1,Aa.push(sa(s,S,I))-1,Aa.push(sa(s,I,w))-1)}}for(i=0;i<g;++i)(o=Ca[i])&&(o.halfedges.length||delete Ca[i])}(s,a,l,u)}this.edges=Aa,this.cells=Ca,Ta=Ma=Aa=Ca=null}function Da(t){return(t=t.slice()).push(t[0]),c([t])}function Ra(t,e,r,n){var i=(n=n||{}).steps||64,o=n.units||"kilometers",s=n.angle||0,a=n.pivot||t,l=n.properties||t.properties||{};if(!t)throw new Error("center is required");if(!e)throw new Error("xSemiAxis is required");if(!r)throw new Error("ySemiAxis is required");if(!A(n))throw new Error("options must be an object");if(!M(i))throw new Error("steps must be a number");if(!M(s))throw new Error("angle must be a number");var u=K(t);if("degrees"===o)var h=I(s);else e=Gi(t,e,90,{units:o}),r=Gi(t,r,0,{units:o}),e=K(e)[0]-u[0],r=K(r)[1]-u[1];for(var p=[],f=0;f<i;f+=1){var d=-360*f/i,m=e*r/Math.sqrt(Math.pow(r,2)+Math.pow(e,2)*Math.pow(Oa(d),2)),g=e*r/Math.sqrt(Math.pow(e,2)+Math.pow(r,2)/Math.pow(Oa(d),2));if(d<-90&&d>=-270&&(m=-m),d<-180&&d>=-360&&(g=-g),"degrees"===o){var y=m*Math.cos(h)+g*Math.sin(h),_=g*Math.cos(h)-m*Math.sin(h);m=y,g=_}p.push([m+u[0],g+u[1]])}return p.push(p[0]),"degrees"===o?c([p],l):ts(c([p],l),s,{pivot:a})}function Oa(t){var e=t*Math.PI/180;return Math.tan(e)}function Na(t,e){void 0===e&&(e={});var r=0,n=0,i=0;return j(t,function(t,o,s){var a=e.weight?null==s?void 0:s[e.weight]:void 0;if(!M(a=null==a?1:a))throw new Error("weight value must be a number for feature index "+o);(a=Number(a))>0&&z(t,function(t){r+=t[0]*a,n+=t[1]*a,i+=a})}),l([r/i,n/i],e.properties,e)}function Fa(t,e,r,n,i){var o=n.tolerance||.001,s=0,a=0,u=0,c=0;if(N(r,function(e){var r,n=null===(r=e.properties)||void 0===r?void 0:r.weight,i=null==n?1:n;if(!M(i=Number(i)))throw new Error("weight value must be a number");if(i>0){c+=1;var o=i*xe(e,t);0===o&&(o=1);var l=i/o;s+=e.geometry.coordinates[0]*l,a+=e.geometry.coordinates[1]*l,u+=l}}),c<1)throw new Error("no features to measure");var h=s/u,p=a/u;return 1===c||0===i||Math.abs(h-e[0])<o&&Math.abs(p-e[1])<o?l([h,p],{medianCandidates:n.medianCandidates}):(n.medianCandidates.push([h,p]),Fa([h,p],t,r,n,i-1))}function Ba(t,e){return{x:t[0]-e[0],y:t[1]-e[1]}}function ja(t,e){var r=0,n=0;z(t,function(i,o,s,a,l){l>r&&(r=l,n=o,e.push([]));var u=o-n,c=t.coordinates[l][u+1],h=i[0],p=i[1],f=c[0],d=c[1];e[l].push([.75*h+.25*f,.75*p+.25*d]),e[l].push([.25*h+.75*f,.25*p+.75*d])},!0),e.forEach(function(t){t.push(t[0])})}function Ua(t,e){var r=0,n=0,i=0;z(t,function(o,s,a,l,u){l>i&&(i=l,n=s,e.push([[]])),u>r&&(r=u,n=s,e[l].push([]));var c=s-n,h=t.coordinates[l][u][c+1],p=o[0],f=o[1],d=h[0],m=h[1];e[l][u].push([.75*p+.25*d,.75*f+.25*m]),e[l][u].push([.25*p+.75*d,.25*f+.75*m])},!0),e.forEach(function(t){t.forEach(function(t){t.push(t[0])})})}function Va(t,e,r){void 0===r&&(r=2);var n=K(t),i=K(e),o=n[0]-i[0],s=n[1]-i[1];return 1===r?Math.abs(o)+Math.abs(s):Math.pow(Math.pow(o,r)+Math.pow(s,r),1/r)}function Ga(t,e){var r=(e=e||{}).threshold||1e4,n=e.p||2,i=e.binary||!1,o=e.alpha||-1,s=e.standardization||!1,a=[];N(t,function(t){a.push(br(t))});for(var l=[],u=0;u<a.length;u++)l[u]=[];for(u=0;u<a.length;u++)for(var c=u;c<a.length;c++){u===c&&(l[u][c]=0);var h=Va(a[u],a[c],n);l[u][c]=h,l[c][u]=h}for(u=0;u<a.length;u++)for(c=0;c<a.length;c++)0!==(h=l[u][c])&&(l[u][c]=i?h<=r?1:0:h<=r?Math.pow(h,o):0);if(s)for(u=0;u<a.length;u++){var p=l[u].reduce(function(t,e){return t+e},0);for(c=0;c<a.length;c++)l[u][c]=l[u][c]/p}return l}function qa(t){for(var e=0,r=0,n=t;r<n.length;r++)e+=n[r];return e/t.length}function $a(t,e){return void 0===e&&(e={}),Xa(t,"mercator",e)}function Za(t,e){return void 0===e&&(e={}),Xa(t,"wgs84",e)}function Xa(t,e,r){void 0===r&&(r={});var n=(r=r||{}).mutate;if(!t)throw new Error("geojson is required");return Array.isArray(t)&&M(t[0])?t="mercator"===e?Wa(t):Ya(t):(!0!==n&&(t=Ie(t)),z(t,function(t){var r="mercator"===e?Wa(t):Ya(t);t[0]=r[0],t[1]=r[1]})),t}function Wa(t){var e=Math.PI/180,r=6378137,n=20037508.342789244,i=[r*(Math.abs(t[0])<=180?t[0]:t[0]-360*function(t){return t<0?-1:t>0?1:0}(t[0]))*e,r*Math.log(Math.tan(.25*Math.PI+.5*t[1]*e))];return i[0]>n&&(i[0]=n),i[0]<-n&&(i[0]=-n),i[1]>n&&(i[1]=n),i[1]<-n&&(i[1]=-n),i}function Ya(t){var e=180/Math.PI,r=6378137;return[t[0]*e/r,(.5*Math.PI-2*Math.atan(Math.exp(-t[1]/r)))*e]}za.prototype={constructor:za,polygons:function(){var t=this.edges;return this.cells.map(function(e){var r=e.halfedges.map(function(r){return ha(e,t[r])});return r.data=e.site.data,r})},triangles:function(){var t=[],e=this.edges;return this.cells.forEach(function(r,n){if(o=(i=r.halfedges).length)for(var i,o,s,a,l,u,c=r.site,h=-1,p=e[i[o-1]],f=p.left===c?p.right:p.left;++h<o;)s=f,f=(p=e[i[h]]).left===c?p.right:p.left,s&&f&&n<s.index&&n<f.index&&(l=s,u=f,((a=c)[0]-u[0])*(l[1]-a[1])-(a[0]-l[0])*(u[1]-a[1])<0)&&t.push([c.data,s.data,f.data])}),t},links:function(){return this.edges.filter(function(t){return t.right}).map(function(t){return{source:t.left.data,target:t.right.data}})},find:function(t,e,r){for(var n,i,o=this,s=o._found||0,a=o.cells.length;!(i=o.cells[s]);)if(++s>=a)return null;var l=t-i.site[0],u=e-i.site[1],c=l*l+u*u;do{i=o.cells[n=s],s=null,i.halfedges.forEach(function(r){var n=o.edges[r],a=n.left;if(a!==i.site&&a||(a=n.right)){var l=t-a[0],u=e-a[1],h=l*l+u*u;h<c&&(c=h,s=a.index)}})}while(null!==s);return o._found=n,null==r||c<=r*r?i.site:null}};var Ha=Object.freeze({__proto__:null,toMercator:$a,toWgs84:Za}),Ja=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),i=0;for(e=0;e<r;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)n[i]=o[s];return n};function Ka(t){return Array.isArray(t)?nl(t):t&&t.bbox?nl(t.bbox):[360*rl(),180*rl()]}function Qa(t,e){void 0===e&&(e={}),null==t&&(t=1);for(var r=[],n=0;n<t;n++)r.push(l(Ka(e.bbox)));return d(r)}function tl(t,e){void 0===e&&(e={}),null==t&&(t=1),M(e.num_vertices)&&void 0!==e.num_vertices||(e.num_vertices=10),M(e.max_radial_length)&&void 0!==e.max_radial_length||(e.max_radial_length=10);for(var r=[],n=function(t){var n,i=[],o=Ja(Array(e.num_vertices+1)).map(Math.random);o.forEach(function(t,e,r){r[e]=e>0?t+r[e-1]:t}),o.forEach(function(t){t=2*t*Math.PI/o[o.length-1];var r=Math.random();i.push([r*(e.max_radial_length||10)*Math.sin(t),r*(e.max_radial_length||10)*Math.cos(t)])}),i[i.length-1]=i[0],i=i.map((n=Ka(e.bbox),function(t){return[t[0]+n[0],t[1]+n[1]]})),r.push(c([i]))},i=0;i<t;i++)n();return d(r)}function el(t,e){if(void 0===e&&(e={}),!A(e=e||{}))throw new Error("options is invalid");var r=e.bbox,n=e.num_vertices,i=e.max_length,o=e.max_rotation;null==t&&(t=1),(!M(n)||void 0===n||n<2)&&(n=10),M(i)&&void 0!==i||(i=1e-4),M(o)&&void 0!==o||(o=Math.PI/8);for(var s=[],a=0;a<t;a++){for(var l=[Ka(r)],u=0;u<n-1;u++){var c=(0===u?2*Math.random()*Math.PI:Math.tan((l[u][1]-l[u-1][1])/(l[u][0]-l[u-1][0])))+(Math.random()-.5)*o*2,h=Math.random()*i;l.push([l[u][0]+h*Math.cos(c),l[u][1]+h*Math.sin(c)])}s.push(p(l))}return d(s)}function rl(){return Math.random()-.5}function nl(t){return[Math.random()*(t[2]-t[0])+t[0],Math.random()*(t[3]-t[1])+t[1]]}var il=Object.freeze({__proto__:null,randomPosition:Ka,randomPoint:Qa,randomPolygon:tl,randomLineString:el});function ol(t,e){if(!t)throw new Error("geojson is required");if("FeatureCollection"!==t.type)throw new Error("geojson must be a FeatureCollection");if(null==e)throw new Error("filter is required");var r=[];return N(t,function(t){ul(t.properties,e)&&r.push(t)}),d(r)}function sl(t,e,r){if(!t)throw new Error("geojson is required");if("FeatureCollection"!==t.type)throw new Error("geojson must be a FeatureCollection");if(null==e)throw new Error("property is required");for(var n=ll(t,e),i=Object.keys(n),o=0;o<i.length;o++){for(var s=i[o],a=n[s],l=[],u=0;u<a.length;u++)l.push(t.features[a[u]]);r(d(l),s,o)}}function al(t,e,r,n){var i=n;return sl(t,e,function(t,e,o){i=0===o&&void 0===n?t:r(i,t,e,o)}),i}function ll(t,e){var r={};return N(t,function(t,n){var i=t.properties||{};if(Object.prototype.hasOwnProperty.call(i,String(e))){var o=i[e];Object.prototype.hasOwnProperty.call(r,o)?r[o].push(n):r[o]=[n]}}),r}function ul(t,e){if(void 0===t)return!1;var r=typeof e;if("number"===r||"string"===r)return Object.prototype.hasOwnProperty.call(t,e);if(Array.isArray(e)){for(var n=0;n<e.length;n++)if(!ul(t,e[n]))return!1;return!0}return cl(t,e)}function cl(t,e){for(var r=Object.keys(e),n=0;n<r.length;n++){var i=r[n];if(t[i]!==e[i])return!1}return!0}function hl(t,e){if(!e)return{};if(!e.length)return{};for(var r={},n=0;n<e.length;n++){var i=e[n];Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r}var pl=Object.freeze({__proto__:null,getCluster:ol,clusterEach:sl,clusterReduce:al,createBins:ll,applyFilter:ul,propertiesContainsFilter:cl,filterProperties:hl}),fl=function(t,e){this.next=null,this.key=t,this.data=e,this.left=null,this.right=null
/**
     * splaytree v3.1.0
     * Fast Splay tree for Node and browser
     *
     * @author Alexander Milevski <info@w8r.name>
     * @license MIT
     * @preserve
     */};function dl(t,e){return t>e?1:t<e?-1:0}function ml(t,e,r){for(var n=new fl(null,null),i=n,o=n;;){var s=r(t,e.key);if(s<0){if(null===e.left)break;if(r(t,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,null===(e=a).left)break}o.left=e,o=e,e=e.left}else{if(!(s>0))break;if(null===e.right)break;if(r(t,e.right.key)>0&&(a=e.right,e.right=a.left,a.left=e,null===(e=a).right))break;i.right=e,i=e,e=e.right}}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function gl(t,e,r,n){var i=new fl(t,e);if(null===r)return i.left=i.right=null,i;var o=n(t,(r=ml(t,r,n)).key);return o<0?(i.left=r.left,i.right=r,r.left=null):o>=0&&(i.right=r.right,i.left=r,r.right=null),i}function yl(t,e,r){var n=null,i=null;if(e){var o=r((e=ml(t,e,r)).key,t);0===o?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function _l(t,e,r,n,i){if(t){n(e+(r?"└── ":"├── ")+i(t)+"\n");var o=e+(r?"    ":"│   ");t.left&&_l(t.left,o,!1,n,i),t.right&&_l(t.right,o,!0,n,i)}}var vl=function(){function t(t){void 0===t&&(t=dl),this._root=null,this._size=0,this._comparator=t}return t.prototype.insert=function(t,e){return this._size++,this._root=gl(t,e,this._root,this._comparator)},t.prototype.add=function(t,e){var r=new fl(t,e);null===this._root&&(r.left=r.right=null,this._size++,this._root=r);var n=this._comparator,i=ml(t,this._root,n),o=n(t,i.key);return 0===o?this._root=i:(o<0?(r.left=i.left,r.right=i,i.left=null):o>0&&(r.right=i.right,r.left=i,i.right=null),this._size++,this._root=r),this._root},t.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},t.prototype._remove=function(t,e,r){var n;return null===e?null:0===r(t,(e=ml(t,e,r)).key)?(null===e.left?n=e.right:(n=ml(t,e.left,r)).right=e.right,this._size--,n):e},t.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=ml(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},t.prototype.findStatic=function(t){for(var e=this._root,r=this._comparator;e;){var n=r(t,e.key);if(0===n)return e;e=n<0?e.left:e.right}return null},t.prototype.find=function(t){return this._root&&(this._root=ml(t,this._root,this._comparator),0!==this._comparator(t,this._root.key))?null:this._root},t.prototype.contains=function(t){for(var e=this._root,r=this._comparator;e;){var n=r(t,e.key);if(0===n)return!0;e=n<0?e.left:e.right}return!1},t.prototype.forEach=function(t,e){for(var r=this._root,n=[],i=!1;!i;)null!==r?(n.push(r),r=r.left):0!==n.length?(r=n.pop(),t.call(e,r),r=r.right):i=!0;return this},t.prototype.range=function(t,e,r,n){for(var i=[],o=this._comparator,s=this._root;0!==i.length||s;)if(s)i.push(s),s=s.left;else{if(o((s=i.pop()).key,e)>0)break;if(o(s.key,t)>=0&&r.call(n,s))return this;s=s.right}return this},t.prototype.keys=function(){var t=[];return this.forEach(function(e){var r=e.key;return t.push(r)}),t},t.prototype.values=function(){var t=[];return this.forEach(function(e){var r=e.data;return t.push(r)}),t},t.prototype.min=function(){return this._root?this.minNode(this._root).key:null},t.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},t.prototype.minNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.left;)t=t.left;return t},t.prototype.maxNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.right;)t=t.right;return t},t.prototype.at=function(t){for(var e=this._root,r=!1,n=0,i=[];!r;)if(e)i.push(e),e=e.left;else if(i.length>0){if(e=i.pop(),n===t)return e;n++,e=e.right}else r=!0;return null},t.prototype.next=function(t){var e=this._root,r=null;if(t.right){for(r=t.right;r.left;)r=r.left;return r}for(var n=this._comparator;e;){var i=n(t.key,e.key);if(0===i)break;i<0?(r=e,e=e.left):e=e.right}return r},t.prototype.prev=function(t){var e=this._root,r=null;if(null!==t.left){for(r=t.left;r.right;)r=r.right;return r}for(var n=this._comparator;e;){var i=n(t.key,e.key);if(0===i)break;i<0?e=e.left:(r=e,e=e.right)}return r},t.prototype.clear=function(){return this._root=null,this._size=0,this},t.prototype.toList=function(){return function(t){for(var e=t,r=[],n=!1,i=new fl(null,null),o=i;!n;)e?(r.push(e),e=e.left):r.length>0?e=(e=o=o.next=r.pop()).right:n=!0;return o.next=null,i.next}(this._root)},t.prototype.load=function(t,e,r){void 0===e&&(e=[]),void 0===r&&(r=!1);var n=t.length,i=this._comparator;if(r&&wl(t,e,0,n-1,i),null===this._root)this._root=xl(t,e,0,n),this._size=n;else{var o=function(t,e,r){for(var n=new fl(null,null),i=n,o=t,s=e;null!==o&&null!==s;)r(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;return null!==o?i.next=o:null!==s&&(i.next=s),n.next}(this.toList(),function(t,e){for(var r=new fl(null,null),n=r,i=0;i<t.length;i++)n=n.next=new fl(t[i],e[i]);return n.next=null,r.next}(t,e),i);n=this._size+n,this._root=bl({head:o},0,n)}return this},t.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),t.prototype.toString=function(t){void 0===t&&(t=function(t){return String(t.key)});var e=[];return _l(this._root,"",!0,function(t){return e.push(t)},t),e.join("")},t.prototype.update=function(t,e,r){var n=this._comparator,i=yl(t,this._root,n),o=i.left,s=i.right;n(t,e)<0?s=gl(e,r,s,n):o=gl(e,r,o,n),this._root=function(t,e,r){return null===e?t:(null===t||((e=ml(t.key,e,r)).left=t),e)}(o,s,n)},t.prototype.split=function(t){return yl(t,this._root,this._comparator)},t}();function xl(t,e,r,n){var i=n-r;if(i>0){var o=r+Math.floor(i/2),s=t[o],a=e[o],l=new fl(s,a);return l.left=xl(t,e,r,o),l.right=xl(t,e,o+1,n),l}return null}function bl(t,e,r){var n=r-e;if(n>0){var i=e+Math.floor(n/2),o=bl(t,e,i),s=t.head;return s.left=o,t.head=t.head.next,s.right=bl(t,i+1,r),s}return null}function wl(t,e,r,n,i){if(!(r>=n)){for(var o=t[r+n>>1],s=r-1,a=n+1;;){do{s++}while(i(t[s],o)<0);do{a--}while(i(t[a],o)>0);if(s>=a)break;var l=t[s];t[s]=t[a],t[a]=l,l=e[s],e[s]=e[a],e[a]=l}wl(t,e,r,a,i),wl(t,e,a+1,n,i)}}function El(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Sl(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Il(t,e,r){return e&&Sl(t.prototype,e),r&&Sl(t,r),t}var Tl=function(t,e){return t.ll.x<=e.x&&e.x<=t.ur.x&&t.ll.y<=e.y&&e.y<=t.ur.y},Cl=function(t,e){if(e.ur.x<t.ll.x||t.ur.x<e.ll.x||e.ur.y<t.ll.y||t.ur.y<e.ll.y)return null;var r=t.ll.x<e.ll.x?e.ll.x:t.ll.x,n=t.ur.x<e.ur.x?t.ur.x:e.ur.x;return{ll:{x:r,y:t.ll.y<e.ll.y?e.ll.y:t.ll.y},ur:{x:n,y:t.ur.y<e.ur.y?t.ur.y:e.ur.y}}},Ml=Number.EPSILON;void 0===Ml&&(Ml=Math.pow(2,-52));var Al=Ml*Ml,Pl=function(t,e){if(-Ml<t&&t<Ml&&-Ml<e&&e<Ml)return 0;var r=t-e;return r*r<Al*t*e?0:t<e?-1:1},kl=function(){function t(){El(this,t),this.reset()}return Il(t,[{key:"reset",value:function(){this.xRounder=new Ll,this.yRounder=new Ll}},{key:"round",value:function(t,e){return{x:this.xRounder.round(t),y:this.yRounder.round(e)}}}]),t}(),Ll=function(){function t(){El(this,t),this.tree=new vl,this.round(0)}return Il(t,[{key:"round",value:function(t){var e=this.tree.add(t),r=this.tree.prev(e);if(null!==r&&0===Pl(e.key,r.key))return this.tree.remove(t),r.key;var n=this.tree.next(e);return null!==n&&0===Pl(e.key,n.key)?(this.tree.remove(t),n.key):t}}]),t}(),zl=new kl,Dl=function(t,e){return t.x*e.y-t.y*e.x},Rl=function(t,e){return t.x*e.x+t.y*e.y},Ol=function(t,e,r){var n={x:e.x-t.x,y:e.y-t.y},i={x:r.x-t.x,y:r.y-t.y},o=Dl(n,i);return Pl(o,0)},Nl=function(t){return Math.sqrt(Rl(t,t))},Fl=function(t,e,r){var n={x:e.x-t.x,y:e.y-t.y},i={x:r.x-t.x,y:r.y-t.y};return Rl(i,n)/Nl(i)/Nl(n)},Bl=function(t,e,r){return 0===e.y?null:{x:t.x+e.x/e.y*(r-t.y),y:r}},jl=function(t,e,r){return 0===e.x?null:{x:r,y:t.y+e.y/e.x*(r-t.x)}},Ul=function(){function t(e,r){El(this,t),void 0===e.events?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=r}return Il(t,null,[{key:"compare",value:function(e,r){var n=t.comparePoints(e.point,r.point);return 0!==n?n:(e.point!==r.point&&e.link(r),e.isLeft!==r.isLeft?e.isLeft?1:-1:Gl.compare(e.segment,r.segment))}},{key:"comparePoints",value:function(t,e){return t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y>e.y?1:0}}]),Il(t,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var e=t.point.events,r=0,n=e.length;r<n;r++){var i=e[r];this.point.events.push(i),i.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,e=0;e<t;e++){var r=this.point.events[e];if(void 0===r.segment.consumedBy)for(var n=e+1;n<t;n++){var i=this.point.events[n];void 0===i.consumedBy&&r.otherSE.point.events===i.otherSE.point.events&&r.segment.consume(i.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],e=0,r=this.point.events.length;e<r;e++){var n=this.point.events[e];n!==this&&!n.segment.ringOut&&n.segment.isInResult()&&t.push(n)}return t}},{key:"getLeftmostComparator",value:function(t){var e=this,r=new Map,n=function(n){var i,o,s,a,l,u=n.otherSE;r.set(n,{sine:(i=e.point,o=t.point,s=u.point,a={x:o.x-i.x,y:o.y-i.y},l={x:s.x-i.x,y:s.y-i.y},Dl(l,a)/Nl(l)/Nl(a)),cosine:Fl(e.point,t.point,u.point)})};return function(t,e){r.has(t)||n(t),r.has(e)||n(e);var i=r.get(t),o=i.sine,s=i.cosine,a=r.get(e),l=a.sine,u=a.cosine;return o>=0&&l>=0?s<u?1:s>u?-1:0:o<0&&l<0?s<u?-1:s>u?1:0:l<o?-1:l>o?1:0}}}]),t}(),Vl=0,Gl=function(){function t(e,r,n,i){El(this,t),this.id=++Vl,this.leftSE=e,e.segment=this,e.otherSE=r,this.rightSE=r,r.segment=this,r.otherSE=e,this.rings=n,this.windings=i}return Il(t,null,[{key:"compare",value:function(t,e){var r=t.leftSE.point.x,n=e.leftSE.point.x,i=t.rightSE.point.x,o=e.rightSE.point.x;if(o<r)return 1;if(i<n)return-1;var s=t.leftSE.point.y,a=e.leftSE.point.y,l=t.rightSE.point.y,u=e.rightSE.point.y;if(r<n){if(a<s&&a<l)return 1;if(a>s&&a>l)return-1;var c=t.comparePoint(e.leftSE.point);if(c<0)return 1;if(c>0)return-1;var h=e.comparePoint(t.rightSE.point);return 0!==h?h:-1}if(r>n){if(s<a&&s<u)return-1;if(s>a&&s>u)return 1;var p=e.comparePoint(t.leftSE.point);if(0!==p)return p;var f=t.comparePoint(e.rightSE.point);return f<0?1:f>0?-1:1}if(s<a)return-1;if(s>a)return 1;if(i<o){var d=e.comparePoint(t.rightSE.point);if(0!==d)return d}if(i>o){var m=t.comparePoint(e.rightSE.point);if(m<0)return 1;if(m>0)return-1}if(i!==o){var g=l-s,y=i-r,_=u-a,v=o-n;if(g>y&&_<v)return 1;if(g<y&&_>v)return-1}return i>o?1:i<o||l<u?-1:l>u?1:t.id<e.id?-1:t.id>e.id?1:0}}]),Il(t,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<e?t:e},ur:{x:this.rightSE.point.x,y:t>e?t:e}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var e=this.leftSE.point,r=this.rightSE.point,n=this.vector();if(e.x===r.x)return t.x===e.x?0:t.x<e.x?1:-1;var i=(t.y-e.y)/n.y,o=e.x+i*n.x;if(t.x===o)return 0;var s=(t.x-e.x)/n.x,a=e.y+s*n.y;return t.y===a?0:t.y<a?-1:1}},{key:"getIntersection",value:function(t){var e=this.bbox(),r=t.bbox(),n=Cl(e,r);if(null===n)return null;var i=this.leftSE.point,o=this.rightSE.point,s=t.leftSE.point,a=t.rightSE.point,l=Tl(e,s)&&0===this.comparePoint(s),u=Tl(r,i)&&0===t.comparePoint(i),c=Tl(e,a)&&0===this.comparePoint(a),h=Tl(r,o)&&0===t.comparePoint(o);if(u&&l)return h&&!c?o:!h&&c?a:null;if(u)return c&&i.x===a.x&&i.y===a.y?null:i;if(l)return h&&o.x===s.x&&o.y===s.y?null:s;if(h&&c)return null;if(h)return o;if(c)return a;var p=function(t,e,r,n){if(0===e.x)return jl(r,n,t.x);if(0===n.x)return jl(t,e,r.x);if(0===e.y)return Bl(r,n,t.y);if(0===n.y)return Bl(t,e,r.y);var i=Dl(e,n);if(0==i)return null;var o={x:r.x-t.x,y:r.y-t.y},s=Dl(o,e)/i,a=Dl(o,n)/i;return{x:(t.x+a*e.x+(r.x+s*n.x))/2,y:(t.y+a*e.y+(r.y+s*n.y))/2}}(i,this.vector(),s,t.vector());return null===p?null:Tl(n,p)?zl.round(p.x,p.y):null}},{key:"split",value:function(e){var r=[],n=void 0!==e.events,i=new Ul(e,!0),o=new Ul(e,!1),s=this.rightSE;this.replaceRightSE(o),r.push(o),r.push(i);var a=new t(i,s,this.rings.slice(),this.windings.slice());return Ul.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),Ul.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),n&&(i.checkForConsuming(),o.checkForConsuming()),r}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var e=0,r=this.windings.length;e<r;e++)this.windings[e]*=-1}},{key:"consume",value:function(e){for(var r=this,n=e;r.consumedBy;)r=r.consumedBy;for(;n.consumedBy;)n=n.consumedBy;var i=t.compare(r,n);if(0!==i){if(i>0){var o=r;r=n,n=o}if(r.prev===n){var s=r;r=n,n=s}for(var a=0,l=n.rings.length;a<l;a++){var u=n.rings[a],c=n.windings[a],h=r.rings.indexOf(u);-1===h?(r.rings.push(u),r.windings.push(c)):r.windings[h]+=c}n.rings=null,n.windings=null,n.consumedBy=r,n.leftSE.consumedBy=r.leftSE,n.rightSE.consumedBy=r.rightSE}}},{key:"prevInResult",value:function(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}},{key:"beforeState",value:function(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}},{key:"afterState",value:function(){if(void 0!==this._afterState)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var e=this._afterState.rings,r=this._afterState.windings,n=this._afterState.multiPolys,i=0,o=this.rings.length;i<o;i++){var s=this.rings[i],a=this.windings[i],l=e.indexOf(s);-1===l?(e.push(s),r.push(a)):r[l]+=a}for(var u=[],c=[],h=0,p=e.length;h<p;h++)if(0!==r[h]){var f=e[h],d=f.poly;if(-1===c.indexOf(d))if(f.isExterior)u.push(d);else{-1===c.indexOf(d)&&c.push(d);var m=u.indexOf(f.poly);-1!==m&&u.splice(m,1)}}for(var g=0,y=u.length;g<y;g++){var _=u[g].multiPoly;-1===n.indexOf(_)&&n.push(_)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;var t=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch(Ql.type){case"union":var r=0===t.length,n=0===e.length;this._isInResult=r!==n;break;case"intersection":var i,o;t.length<e.length?(i=t.length,o=e.length):(i=e.length,o=t.length),this._isInResult=o===Ql.numMultiPolys&&i<o;break;case"xor":var s=Math.abs(t.length-e.length);this._isInResult=s%2==1;break;case"difference":var a=function(t){return 1===t.length&&t[0].isSubject};this._isInResult=a(t)!==a(e);break;default:throw new Error("Unrecognized operation type found ".concat(Ql.type))}return this._isInResult}}],[{key:"fromRing",value:function(e,r,n){var i,o,s,a=Ul.comparePoints(e,r);if(a<0)i=e,o=r,s=1;else{if(!(a>0))throw new Error("Tried to create degenerate segment at [".concat(e.x,", ").concat(e.y,"]"));i=r,o=e,s=-1}return new t(new Ul(i,!0),new Ul(o,!1),[n],[s])}}]),t}(),ql=function(){function t(e,r,n){if(El(this,t),!Array.isArray(e)||0===e.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=r,this.isExterior=n,this.segments=[],"number"!=typeof e[0][0]||"number"!=typeof e[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=zl.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,s=1,a=e.length;s<a;s++){if("number"!=typeof e[s][0]||"number"!=typeof e[s][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=zl.round(e[s][0],e[s][1]);l.x===o.x&&l.y===o.y||(this.segments.push(Gl.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}i.x===o.x&&i.y===o.y||this.segments.push(Gl.fromRing(o,i,this))}return Il(t,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,r=this.segments.length;e<r;e++){var n=this.segments[e];t.push(n.leftSE),t.push(n.rightSE)}return t}}]),t}(),$l=function(){function t(e,r){if(El(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new ql(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,i=e.length;n<i;n++){var o=new ql(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=r}return Il(t,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),e=0,r=this.interiorRings.length;e<r;e++)for(var n=this.interiorRings[e].getSweepEvents(),i=0,o=n.length;i<o;i++)t.push(n[i]);return t}}]),t}(),Zl=function(){function t(e,r){if(El(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof e[0][0][0]&&(e=[e])}catch(t){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,i=e.length;n<i;n++){var o=new $l(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=r}return Il(t,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,r=this.polys.length;e<r;e++)for(var n=this.polys[e].getSweepEvents(),i=0,o=n.length;i<o;i++)t.push(n[i]);return t}}]),t}(),Xl=function(){function t(e){El(this,t),this.events=e;for(var r=0,n=e.length;r<n;r++)e[r].segment.ringOut=this;this.poly=null}return Il(t,null,[{key:"factory",value:function(e){for(var r=[],n=0,i=e.length;n<i;n++){var o=e[n];if(o.isInResult()&&!o.ringOut){for(var s=null,a=o.leftSE,l=o.rightSE,u=[a],c=a.point,h=[];s=a,a=l,u.push(a),a.point!==c;)for(;;){var p=a.getAvailableLinkedEvents();if(0===p.length){var f=u[0].point,d=u[u.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(f.x,",")+" ".concat(f.y,"]. Last matching segment found ends at")+" [".concat(d.x,", ").concat(d.y,"]."))}if(1===p.length){l=p[0].otherSE;break}for(var m=null,g=0,y=h.length;g<y;g++)if(h[g].point===a.point){m=g;break}if(null===m){h.push({index:u.length,point:a.point});var _=a.getLeftmostComparator(s);l=p.sort(_)[0].otherSE;break}var v=h.splice(m)[0],x=u.splice(v.index);x.unshift(x[0].otherSE),r.push(new t(x.reverse()))}r.push(new t(u))}}return r}}]),Il(t,[{key:"getGeom",value:function(){for(var t=this.events[0].point,e=[t],r=1,n=this.events.length-1;r<n;r++){var i=this.events[r].point,o=this.events[r+1].point;0!==Ol(i,t,o)&&(e.push(i),t=i)}if(1===e.length)return null;var s=e[0],a=e[1];0===Ol(s,t,a)&&e.shift(),e.push(e[0]);for(var l=this.isExteriorRing()?1:-1,u=this.isExteriorRing()?0:e.length-1,c=this.isExteriorRing()?e.length:-1,h=[],p=u;p!=c;p+=l)h.push([e[p].x,e[p].y]);return h}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var t=this.enclosingRing();this._isExteriorRing=!t||!t.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],e=1,r=this.events.length;e<r;e++){var n=this.events[e];Ul.compare(t,n)>0&&(t=n)}for(var i=t.segment.prevInResult(),o=i?i.prevInResult():null;;){if(!i)return null;if(!o)return i.ringOut;if(o.ringOut!==i.ringOut)return o.ringOut.enclosingRing()!==i.ringOut?i.ringOut:i.ringOut.enclosingRing();i=o.prevInResult(),o=i?i.prevInResult():null}}}]),t}(),Wl=function(){function t(e){El(this,t),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return Il(t,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(null===t[0])return null;for(var e=0,r=this.interiorRings.length;e<r;e++){var n=this.interiorRings[e].getGeom();null!==n&&t.push(n)}return t}}]),t}(),Yl=function(){function t(e){El(this,t),this.rings=e,this.polys=this._composePolys(e)}return Il(t,[{key:"getGeom",value:function(){for(var t=[],e=0,r=this.polys.length;e<r;e++){var n=this.polys[e].getGeom();null!==n&&t.push(n)}return t}},{key:"_composePolys",value:function(t){for(var e=[],r=0,n=t.length;r<n;r++){var i=t[r];if(!i.poly)if(i.isExteriorRing())e.push(new Wl(i));else{var o=i.enclosingRing();o.poly||e.push(new Wl(o)),o.poly.addInterior(i)}}return e}}]),t}(),Hl=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Gl.compare;El(this,t),this.queue=e,this.tree=new vl(r),this.segments=[]}return Il(t,[{key:"process",value:function(t){var e=t.segment,r=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(e),r;var n=t.isLeft?this.tree.insert(e):this.tree.find(e);if(!n)throw new Error("Unable to find segment #".concat(e.id," ")+"[".concat(e.leftSE.point.x,", ").concat(e.leftSE.point.y,"] -> ")+"[".concat(e.rightSE.point.x,", ").concat(e.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var i=n,o=n,s=void 0,a=void 0;void 0===s;)null===(i=this.tree.prev(i))?s=null:void 0===i.key.consumedBy&&(s=i.key);for(;void 0===a;)null===(o=this.tree.next(o))?a=null:void 0===o.key.consumedBy&&(a=o.key);if(t.isLeft){var l=null;if(s){var u=s.getIntersection(e);if(null!==u&&(e.isAnEndpoint(u)||(l=u),!s.isAnEndpoint(u)))for(var c=this._splitSafely(s,u),h=0,p=c.length;h<p;h++)r.push(c[h])}var f=null;if(a){var d=a.getIntersection(e);if(null!==d&&(e.isAnEndpoint(d)||(f=d),!a.isAnEndpoint(d)))for(var m=this._splitSafely(a,d),g=0,y=m.length;g<y;g++)r.push(m[g])}if(null!==l||null!==f){var _=null;_=null===l?f:null===f?l:Ul.comparePoints(l,f)<=0?l:f,this.queue.remove(e.rightSE),r.push(e.rightSE);for(var v=e.split(_),x=0,b=v.length;x<b;x++)r.push(v[x])}r.length>0?(this.tree.remove(e),r.push(t)):(this.segments.push(e),e.prev=s)}else{if(s&&a){var w=s.getIntersection(a);if(null!==w){if(!s.isAnEndpoint(w))for(var E=this._splitSafely(s,w),S=0,I=E.length;S<I;S++)r.push(E[S]);if(!a.isAnEndpoint(w))for(var T=this._splitSafely(a,w),C=0,M=T.length;C<M;C++)r.push(T[C])}}this.tree.remove(e)}return r}},{key:"_splitSafely",value:function(t,e){this.tree.remove(t);var r=t.rightSE;this.queue.remove(r);var n=t.split(e);return n.push(r),void 0===t.consumedBy&&this.tree.insert(t),n}}]),t}(),Jl="undefined"!=typeof t&&Object({NODE_ENV:"production",BASE_URL:""}).POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Kl="undefined"!=typeof t&&Object({NODE_ENV:"production",BASE_URL:""}).POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,Ql=new(function(){function t(){El(this,t)}return Il(t,[{key:"run",value:function(t,e,r){Ql.type=t,zl.reset();for(var n=[new Zl(e,!0)],i=0,o=r.length;i<o;i++)n.push(new Zl(r[i],!1));if(Ql.numMultiPolys=n.length,"difference"===Ql.type)for(var s=n[0],a=1;a<n.length;)null!==Cl(n[a].bbox,s.bbox)?a++:n.splice(a,1);if("intersection"===Ql.type)for(var l=0,u=n.length;l<u;l++)for(var c=n[l],h=l+1,p=n.length;h<p;h++)if(null===Cl(c.bbox,n[h].bbox))return[];for(var f=new vl(Ul.compare),d=0,m=n.length;d<m;d++)for(var g=n[d].getSweepEvents(),y=0,_=g.length;y<_;y++)if(f.insert(g[y]),f.size>Jl)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var v=new Hl(f),x=f.size,b=f.pop();b;){var w=b.key;if(f.size===x){var E=w.segment;throw new Error("Unable to pop() ".concat(w.isLeft?"left":"right"," SweepEvent ")+"[".concat(w.point.x,", ").concat(w.point.y,"] from segment #").concat(E.id," ")+"[".concat(E.leftSE.point.x,", ").concat(E.leftSE.point.y,"] -> ")+"[".concat(E.rightSE.point.x,", ").concat(E.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(f.size>Jl)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(v.segments.length>Kl)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var S=v.process(w),I=0,T=S.length;I<T;I++){var C=S[I];void 0===C.consumedBy&&f.insert(C)}x=f.size,b=f.pop()}zl.reset();var M=Xl.factory(v.segments);return new Yl(M).getGeom()}}]),t}()),tu={union:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return Ql.run("union",t,r)},intersection:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return Ql.run("intersection",t,r)},xor:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return Ql.run("xor",t,r)},difference:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return Ql.run("difference",t,r)}};"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(t){if(null==this)throw new TypeError(this+" is not an object");var e=Object(this),r=Math.max(Math.min(e.length,9007199254740991),0)||0,n=1 in arguments&&parseInt(Number(arguments[1]),10)||0;n=n<0?Math.max(r+n,0):Math.min(n,r);var i=2 in arguments&&void 0!==arguments[2]?parseInt(Number(arguments[2]),10)||0:r;for(i=i<0?Math.max(r+arguments[2],0):Math.min(i,r);n<i;)e[n]=t,++n;return e},writable:!0}),Number.isFinite=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)},Number.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},Number.parseFloat=Number.parseFloat||parseFloat,Number.isNaN=Number.isNaN||function(t){return t!=t},Math.trunc=Math.trunc||function(t){return t<0?Math.ceil(t):Math.floor(t)};var eu=function(){};eu.prototype.interfaces_=function(){return[]},eu.prototype.getClass=function(){return eu},eu.prototype.equalsWithTolerance=function(t,e,r){return Math.abs(t-e)<=r};var ru=function(t){function e(e){t.call(this,e),this.name="IllegalArgumentException",this.message=e,this.stack=(new t).stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),nu=function(){},iu={MAX_VALUE:{configurable:!0}};nu.isNaN=function(t){return Number.isNaN(t)},nu.doubleToLongBits=function(t){return t},nu.longBitsToDouble=function(t){return t},nu.isInfinite=function(t){return!Number.isFinite(t)},iu.MAX_VALUE.get=function(){return Number.MAX_VALUE},Object.defineProperties(nu,iu);var ou=function(){},su=function(){},au=function(){};function lu(){}var uu=function t(){if(this.x=null,this.y=null,this.z=null,0===arguments.length)this.x=0,this.y=0,this.z=t.NULL_ORDINATE;else if(1===arguments.length){var e=arguments[0];this.x=e.x,this.y=e.y,this.z=e.z}else 2===arguments.length?(this.x=arguments[0],this.y=arguments[1],this.z=t.NULL_ORDINATE):3===arguments.length&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},cu={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};uu.prototype.setOrdinate=function(t,e){switch(t){case uu.X:this.x=e;break;case uu.Y:this.y=e;break;case uu.Z:this.z=e;break;default:throw new ru("Invalid ordinate index: "+t)}},uu.prototype.equals2D=function(){if(1===arguments.length){var t=arguments[0];return this.x===t.x&&this.y===t.y}if(2===arguments.length){var e=arguments[0],r=arguments[1];return!!eu.equalsWithTolerance(this.x,e.x,r)&&!!eu.equalsWithTolerance(this.y,e.y,r)}},uu.prototype.getOrdinate=function(t){switch(t){case uu.X:return this.x;case uu.Y:return this.y;case uu.Z:return this.z}throw new ru("Invalid ordinate index: "+t)},uu.prototype.equals3D=function(t){return this.x===t.x&&this.y===t.y&&(this.z===t.z||nu.isNaN(this.z))&&nu.isNaN(t.z)},uu.prototype.equals=function(t){return t instanceof uu&&this.equals2D(t)},uu.prototype.equalInZ=function(t,e){return eu.equalsWithTolerance(this.z,t.z,e)},uu.prototype.compareTo=function(t){var e=t;return this.x<e.x?-1:this.x>e.x?1:this.y<e.y?-1:this.y>e.y?1:0},uu.prototype.clone=function(){},uu.prototype.copy=function(){return new uu(this)},uu.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},uu.prototype.distance3D=function(t){var e=this.x-t.x,r=this.y-t.y,n=this.z-t.z;return Math.sqrt(e*e+r*r+n*n)},uu.prototype.distance=function(t){var e=this.x-t.x,r=this.y-t.y;return Math.sqrt(e*e+r*r)},uu.prototype.hashCode=function(){var t=17;return 37*(t=37*t+uu.hashCode(this.x))+uu.hashCode(this.y)},uu.prototype.setCoordinate=function(t){this.x=t.x,this.y=t.y,this.z=t.z},uu.prototype.interfaces_=function(){return[ou,su,lu]},uu.prototype.getClass=function(){return uu},uu.hashCode=function(){if(1===arguments.length){var t=arguments[0],e=nu.doubleToLongBits(t);return Math.trunc((e^e)>>>32)}},cu.DimensionalComparator.get=function(){return hu},cu.serialVersionUID.get=function(){return 0x5cbf2c235c7e5800},cu.NULL_ORDINATE.get=function(){return nu.NaN},cu.X.get=function(){return 0},cu.Y.get=function(){return 1},cu.Z.get=function(){return 2},Object.defineProperties(uu,cu);var hu=function(t){if(this._dimensionsToTest=2,0===arguments.length);else if(1===arguments.length){var e=arguments[0];if(2!==e&&3!==e)throw new ru("only 2 or 3 dimensions may be specified");this._dimensionsToTest=e}};hu.prototype.compare=function(t,e){var r=t,n=e,i=hu.compare(r.x,n.x);if(0!==i)return i;var o=hu.compare(r.y,n.y);return 0!==o?o:this._dimensionsToTest<=2?0:hu.compare(r.z,n.z)},hu.prototype.interfaces_=function(){return[au]},hu.prototype.getClass=function(){return hu},hu.compare=function(t,e){return t<e?-1:t>e?1:nu.isNaN(t)?nu.isNaN(e)?0:-1:nu.isNaN(e)?1:0};var pu=function(){};pu.prototype.create=function(){},pu.prototype.interfaces_=function(){return[]},pu.prototype.getClass=function(){return pu};var fu=function(){},du={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};fu.prototype.interfaces_=function(){return[]},fu.prototype.getClass=function(){return fu},fu.toLocationSymbol=function(t){switch(t){case fu.EXTERIOR:return"e";case fu.BOUNDARY:return"b";case fu.INTERIOR:return"i";case fu.NONE:return"-"}throw new ru("Unknown location value: "+t)},du.INTERIOR.get=function(){return 0},du.BOUNDARY.get=function(){return 1},du.EXTERIOR.get=function(){return 2},du.NONE.get=function(){return-1},Object.defineProperties(fu,du);var mu=function(t,e){return t.interfaces_&&t.interfaces_().indexOf(e)>-1},gu=function(){},yu={LOG_10:{configurable:!0}};gu.prototype.interfaces_=function(){return[]},gu.prototype.getClass=function(){return gu},gu.log10=function(t){var e=Math.log(t);return nu.isInfinite(e)||nu.isNaN(e)?e:e/gu.LOG_10},gu.min=function(t,e,r,n){var i=t;return e<i&&(i=e),r<i&&(i=r),n<i&&(i=n),i},gu.clamp=function(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1],r=arguments[2];return t<e?e:t>r?r:t}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var n=arguments[0],i=arguments[1],o=arguments[2];return n<i?i:n>o?o:n}},gu.wrap=function(t,e){return t<0?e- -t%e:t%e},gu.max=function(){if(3===arguments.length){var t=arguments[0],e=arguments[1],r=arguments[2],n=t;return e>n&&(n=e),r>n&&(n=r),n}if(4===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3],l=i;return o>l&&(l=o),s>l&&(l=s),a>l&&(l=a),l}},gu.average=function(t,e){return(t+e)/2},yu.LOG_10.get=function(){return Math.log(10)},Object.defineProperties(gu,yu);var _u=function(t){this.str=t};_u.prototype.append=function(t){this.str+=t},_u.prototype.setCharAt=function(t,e){this.str=this.str.substr(0,t)+e+this.str.substr(t+1)},_u.prototype.toString=function(t){return this.str};var vu=function(t){this.value=t};vu.prototype.intValue=function(){return this.value},vu.prototype.compareTo=function(t){return this.value<t?-1:this.value>t?1:0},vu.isNaN=function(t){return Number.isNaN(t)};var xu=function(){};xu.isWhitespace=function(t){return t<=32&&t>=0||127===t},xu.toUpperCase=function(t){return t.toUpperCase()};var bu=function t(){if(this._hi=0,this._lo=0,0===arguments.length)this.init(0);else if(1===arguments.length){if("number"==typeof arguments[0]){var e=arguments[0];this.init(e)}else if(arguments[0]instanceof t){var r=arguments[0];this.init(r)}else if("string"==typeof arguments[0]){var n=arguments[0];t.call(this,t.parse(n))}}else if(2===arguments.length){var i=arguments[0],o=arguments[1];this.init(i,o)}},wu={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};bu.prototype.le=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<=t._lo},bu.prototype.extractSignificantDigits=function(t,e){var r=this.abs(),n=bu.magnitude(r._hi),i=bu.TEN.pow(n);(r=r.divide(i)).gt(bu.TEN)?(r=r.divide(bu.TEN),n+=1):r.lt(bu.ONE)&&(r=r.multiply(bu.TEN),n-=1);for(var o=n+1,s=new _u,a=bu.MAX_PRINT_DIGITS-1,l=0;l<=a;l++){t&&l===o&&s.append(".");var u=Math.trunc(r._hi);if(u<0)break;var c=!1,h=0;u>9?(c=!0,h="9"):h="0"+u,s.append(h),r=r.subtract(bu.valueOf(u)).multiply(bu.TEN),c&&r.selfAdd(bu.TEN);var p=!0,f=bu.magnitude(r._hi);if(f<0&&Math.abs(f)>=a-l&&(p=!1),!p)break}return e[0]=n,s.toString()},bu.prototype.sqr=function(){return this.multiply(this)},bu.prototype.doubleValue=function(){return this._hi+this._lo},bu.prototype.subtract=function(){if(arguments[0]instanceof bu){var t=arguments[0];return this.add(t.negate())}if("number"==typeof arguments[0]){var e=arguments[0];return this.add(-e)}},bu.prototype.equals=function(){if(1===arguments.length){var t=arguments[0];return this._hi===t._hi&&this._lo===t._lo}},bu.prototype.isZero=function(){return 0===this._hi&&0===this._lo},bu.prototype.selfSubtract=function(){if(arguments[0]instanceof bu){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t._hi,-t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e,0)}},bu.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null},bu.prototype.min=function(t){return this.le(t)?this:t},bu.prototype.selfDivide=function(){if(1===arguments.length){if(arguments[0]instanceof bu){var t=arguments[0];return this.selfDivide(t._hi,t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.selfDivide(e,0)}}else if(2===arguments.length){var r=arguments[0],n=arguments[1],i=null,o=null,s=null,a=null,l=null,u=null,c=null,h=null;return l=this._hi/r,h=(i=(u=bu.SPLIT*l)-(i=u-l))*(s=(h=bu.SPLIT*r)-(s=h-r))-(c=l*r)+i*(a=r-s)+(o=l-i)*s+o*a,h=l+(u=(this._hi-c-h+this._lo-l*n)/r),this._hi=h,this._lo=l-h+u,this}},bu.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"},bu.prototype.divide=function(){if(arguments[0]instanceof bu){var t=arguments[0],e=null,r=null,n=null,i=null,o=null,s=null,a=null,l=null;r=(o=this._hi/t._hi)-(e=(s=bu.SPLIT*o)-(e=s-o)),l=e*(n=(l=bu.SPLIT*t._hi)-(n=l-t._hi))-(a=o*t._hi)+e*(i=t._hi-n)+r*n+r*i;var u=l=o+(s=(this._hi-a-l+this._lo-o*t._lo)/t._hi),c=o-l+s;return new bu(u,c)}if("number"==typeof arguments[0]){var h=arguments[0];return nu.isNaN(h)?bu.createNaN():bu.copy(this).selfDivide(h,0)}},bu.prototype.ge=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>=t._lo},bu.prototype.pow=function(t){if(0===t)return bu.valueOf(1);var e=new bu(this),r=bu.valueOf(1),n=Math.abs(t);if(n>1)for(;n>0;)n%2==1&&r.selfMultiply(e),(n/=2)>0&&(e=e.sqr());else r=e;return t<0?r.reciprocal():r},bu.prototype.ceil=function(){if(this.isNaN())return bu.NaN;var t=Math.ceil(this._hi),e=0;return t===this._hi&&(e=Math.ceil(this._lo)),new bu(t,e)},bu.prototype.compareTo=function(t){var e=t;return this._hi<e._hi?-1:this._hi>e._hi?1:this._lo<e._lo?-1:this._lo>e._lo?1:0},bu.prototype.rint=function(){return this.isNaN()?this:this.add(.5).floor()},bu.prototype.setValue=function(){if(arguments[0]instanceof bu){var t=arguments[0];return this.init(t),this}if("number"==typeof arguments[0]){var e=arguments[0];return this.init(e),this}},bu.prototype.max=function(t){return this.ge(t)?this:t},bu.prototype.sqrt=function(){if(this.isZero())return bu.valueOf(0);if(this.isNegative())return bu.NaN;var t=1/Math.sqrt(this._hi),e=this._hi*t,r=bu.valueOf(e),n=this.subtract(r.sqr())._hi*(.5*t);return r.add(n)},bu.prototype.selfAdd=function(){if(1===arguments.length){if(arguments[0]instanceof bu){var t=arguments[0];return this.selfAdd(t._hi,t._lo)}if("number"==typeof arguments[0]){var e=arguments[0],r=null,n=null,i=null,o=null,s=null,a=null;return o=(i=this._hi+e)-(s=i-this._hi),n=(a=(o=e-s+(this._hi-o))+this._lo)+(i-(r=i+a)),this._hi=r+n,this._lo=n+(r-this._hi),this}}else if(2===arguments.length){var l=arguments[0],u=arguments[1],c=null,h=null,p=null,f=null,d=null,m=null,g=null;f=this._hi+l,h=this._lo+u,d=f-(m=f-this._hi),p=h-(g=h-this._lo);var y=(c=f+(m=(d=l-m+(this._hi-d))+h))+(m=(p=u-g+(this._lo-p))+(m+(f-c))),_=m+(c-y);return this._hi=y,this._lo=_,this}},bu.prototype.selfMultiply=function(){if(1===arguments.length){if(arguments[0]instanceof bu){var t=arguments[0];return this.selfMultiply(t._hi,t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.selfMultiply(e,0)}}else if(2===arguments.length){var r=arguments[0],n=arguments[1],i=null,o=null,s=null,a=null,l=null,u=null;i=(l=bu.SPLIT*this._hi)-this._hi,u=bu.SPLIT*r,i=l-i,o=this._hi-i,s=u-r;var c=(l=this._hi*r)+(u=i*(s=u-s)-l+i*(a=r-s)+o*s+o*a+(this._hi*n+this._lo*r)),h=u+(i=l-c);return this._hi=c,this._lo=h,this}},bu.prototype.selfSqr=function(){return this.selfMultiply(this)},bu.prototype.floor=function(){if(this.isNaN())return bu.NaN;var t=Math.floor(this._hi),e=0;return t===this._hi&&(e=Math.floor(this._lo)),new bu(t,e)},bu.prototype.negate=function(){return this.isNaN()?this:new bu(-this._hi,-this._lo)},bu.prototype.clone=function(){},bu.prototype.multiply=function(){if(arguments[0]instanceof bu){var t=arguments[0];return t.isNaN()?bu.createNaN():bu.copy(this).selfMultiply(t)}if("number"==typeof arguments[0]){var e=arguments[0];return nu.isNaN(e)?bu.createNaN():bu.copy(this).selfMultiply(e,0)}},bu.prototype.isNaN=function(){return nu.isNaN(this._hi)},bu.prototype.intValue=function(){return Math.trunc(this._hi)},bu.prototype.toString=function(){var t=bu.magnitude(this._hi);return t>=-3&&t<=20?this.toStandardNotation():this.toSciNotation()},bu.prototype.toStandardNotation=function(){var t=this.getSpecialNumberString();if(null!==t)return t;var e=new Array(1).fill(null),r=this.extractSignificantDigits(!0,e),n=e[0]+1,i=r;if("."===r.charAt(0))i="0"+r;else if(n<0)i="0."+bu.stringOfChar("0",-n)+r;else if(-1===r.indexOf(".")){var o=n-r.length;i=r+bu.stringOfChar("0",o)+".0"}return this.isNegative()?"-"+i:i},bu.prototype.reciprocal=function(){var t,e,r,n,i=null,o=null,s=null,a=null;t=(r=1/this._hi)-(i=(s=bu.SPLIT*r)-(i=s-r)),o=(a=bu.SPLIT*this._hi)-this._hi;var l=r+(s=(1-(n=r*this._hi)-(a=i*(o=a-o)-n+i*(e=this._hi-o)+t*o+t*e)-r*this._lo)/this._hi);return new bu(l,r-l+s)},bu.prototype.toSciNotation=function(){if(this.isZero())return bu.SCI_NOT_ZERO;var t=this.getSpecialNumberString();if(null!==t)return t;var e=new Array(1).fill(null),r=this.extractSignificantDigits(!1,e),n=bu.SCI_NOT_EXPONENT_CHAR+e[0];if("0"===r.charAt(0))throw new Error("Found leading zero: "+r);var i="";r.length>1&&(i=r.substring(1));var o=r.charAt(0)+"."+i;return this.isNegative()?"-"+o+n:o+n},bu.prototype.abs=function(){return this.isNaN()?bu.NaN:this.isNegative()?this.negate():new bu(this)},bu.prototype.isPositive=function(){return(this._hi>0||0===this._hi)&&this._lo>0},bu.prototype.lt=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<t._lo},bu.prototype.add=function(){if(arguments[0]instanceof bu){var t=arguments[0];return bu.copy(this).selfAdd(t)}if("number"==typeof arguments[0]){var e=arguments[0];return bu.copy(this).selfAdd(e)}},bu.prototype.init=function(){if(1===arguments.length){if("number"==typeof arguments[0]){var t=arguments[0];this._hi=t,this._lo=0}else if(arguments[0]instanceof bu){var e=arguments[0];this._hi=e._hi,this._lo=e._lo}}else if(2===arguments.length){var r=arguments[0],n=arguments[1];this._hi=r,this._lo=n}},bu.prototype.gt=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>t._lo},bu.prototype.isNegative=function(){return(this._hi<0||0===this._hi)&&this._lo<0},bu.prototype.trunc=function(){return this.isNaN()?bu.NaN:this.isPositive()?this.floor():this.ceil()},bu.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0},bu.prototype.interfaces_=function(){return[lu,ou,su]},bu.prototype.getClass=function(){return bu},bu.sqr=function(t){return bu.valueOf(t).selfMultiply(t)},bu.valueOf=function(){if("string"==typeof arguments[0]){var t=arguments[0];return bu.parse(t)}if("number"==typeof arguments[0]){var e=arguments[0];return new bu(e)}},bu.sqrt=function(t){return bu.valueOf(t).sqrt()},bu.parse=function(t){for(var e=0,r=t.length;xu.isWhitespace(t.charAt(e));)e++;var n=!1;if(e<r){var i=t.charAt(e);"-"!==i&&"+"!==i||(e++,"-"===i&&(n=!0))}for(var o=new bu,s=0,a=0,l=0;!(e>=r);){var u=t.charAt(e);if(e++,xu.isDigit(u)){var c=u-"0";o.selfMultiply(bu.TEN),o.selfAdd(c),s++}else{if("."!==u){if("e"===u||"E"===u){var h=t.substring(e);try{l=vu.parseInt(h)}catch(e){throw e instanceof Error?new Error("Invalid exponent "+h+" in string "+t):e}break}throw new Error("Unexpected character '"+u+"' at position "+e+" in string "+t)}a=s}}var p=o,f=s-a-l;if(0===f)p=o;else if(f>0){var d=bu.TEN.pow(f);p=o.divide(d)}else if(f<0){var m=bu.TEN.pow(-f);p=o.multiply(m)}return n?p.negate():p},bu.createNaN=function(){return new bu(nu.NaN,nu.NaN)},bu.copy=function(t){return new bu(t)},bu.magnitude=function(t){var e=Math.abs(t),r=Math.log(e)/Math.log(10),n=Math.trunc(Math.floor(r));return 10*Math.pow(10,n)<=e&&(n+=1),n},bu.stringOfChar=function(t,e){for(var r=new _u,n=0;n<e;n++)r.append(t);return r.toString()},wu.PI.get=function(){return new bu(3.141592653589793,1.2246467991473532e-16)},wu.TWO_PI.get=function(){return new bu(6.283185307179586,2.4492935982947064e-16)},wu.PI_2.get=function(){return new bu(1.5707963267948966,6.123233995736766e-17)},wu.E.get=function(){return new bu(2.718281828459045,1.4456468917292502e-16)},wu.NaN.get=function(){return new bu(nu.NaN,nu.NaN)},wu.EPS.get=function(){return 1.23259516440783e-32},wu.SPLIT.get=function(){return 134217729},wu.MAX_PRINT_DIGITS.get=function(){return 32},wu.TEN.get=function(){return bu.valueOf(10)},wu.ONE.get=function(){return bu.valueOf(1)},wu.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"},wu.SCI_NOT_ZERO.get=function(){return"0.0E0"},Object.defineProperties(bu,wu);var Eu=function(){},Su={DP_SAFE_EPSILON:{configurable:!0}};Eu.prototype.interfaces_=function(){return[]},Eu.prototype.getClass=function(){return Eu},Eu.orientationIndex=function(t,e,r){var n=Eu.orientationIndexFilter(t,e,r);if(n<=1)return n;var i=bu.valueOf(e.x).selfAdd(-t.x),o=bu.valueOf(e.y).selfAdd(-t.y),s=bu.valueOf(r.x).selfAdd(-e.x),a=bu.valueOf(r.y).selfAdd(-e.y);return i.selfMultiply(a).selfSubtract(o.selfMultiply(s)).signum()},Eu.signOfDet2x2=function(t,e,r,n){return t.multiply(n).selfSubtract(e.multiply(r)).signum()},Eu.intersection=function(t,e,r,n){var i=bu.valueOf(n.y).selfSubtract(r.y).selfMultiply(bu.valueOf(e.x).selfSubtract(t.x)),o=bu.valueOf(n.x).selfSubtract(r.x).selfMultiply(bu.valueOf(e.y).selfSubtract(t.y)),s=i.subtract(o),a=bu.valueOf(n.x).selfSubtract(r.x).selfMultiply(bu.valueOf(t.y).selfSubtract(r.y)),l=bu.valueOf(n.y).selfSubtract(r.y).selfMultiply(bu.valueOf(t.x).selfSubtract(r.x)),u=a.subtract(l).selfDivide(s).doubleValue(),c=bu.valueOf(t.x).selfAdd(bu.valueOf(e.x).selfSubtract(t.x).selfMultiply(u)).doubleValue(),h=bu.valueOf(e.x).selfSubtract(t.x).selfMultiply(bu.valueOf(t.y).selfSubtract(r.y)),p=bu.valueOf(e.y).selfSubtract(t.y).selfMultiply(bu.valueOf(t.x).selfSubtract(r.x)),f=h.subtract(p).selfDivide(s).doubleValue(),d=bu.valueOf(r.y).selfAdd(bu.valueOf(n.y).selfSubtract(r.y).selfMultiply(f)).doubleValue();return new uu(c,d)},Eu.orientationIndexFilter=function(t,e,r){var n=null,i=(t.x-r.x)*(e.y-r.y),o=(t.y-r.y)*(e.x-r.x),s=i-o;if(i>0){if(o<=0)return Eu.signum(s);n=i+o}else{if(!(i<0))return Eu.signum(s);if(o>=0)return Eu.signum(s);n=-i-o}var a=Eu.DP_SAFE_EPSILON*n;return s>=a||-s>=a?Eu.signum(s):2},Eu.signum=function(t){return t>0?1:t<0?-1:0},Su.DP_SAFE_EPSILON.get=function(){return 1e-15},Object.defineProperties(Eu,Su);var Iu=function(){},Tu={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};Tu.X.get=function(){return 0},Tu.Y.get=function(){return 1},Tu.Z.get=function(){return 2},Tu.M.get=function(){return 3},Iu.prototype.setOrdinate=function(t,e,r){},Iu.prototype.size=function(){},Iu.prototype.getOrdinate=function(t,e){},Iu.prototype.getCoordinate=function(){},Iu.prototype.getCoordinateCopy=function(t){},Iu.prototype.getDimension=function(){},Iu.prototype.getX=function(t){},Iu.prototype.clone=function(){},Iu.prototype.expandEnvelope=function(t){},Iu.prototype.copy=function(){},Iu.prototype.getY=function(t){},Iu.prototype.toCoordinateArray=function(){},Iu.prototype.interfaces_=function(){return[su]},Iu.prototype.getClass=function(){return Iu},Object.defineProperties(Iu,Tu);var Cu=function(){},Mu=function(t){function e(){t.call(this,"Projective point not representable on the Cartesian plane.")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Cu),Au=function(){};Au.arraycopy=function(t,e,r,n,i){for(var o=0,s=e;s<e+i;s++)r[n+o]=t[s],o++},Au.getProperty=function(t){return{"line.separator":"\n"}[t]};var Pu=function t(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.x=0,this.y=0,this.w=1;else if(1===arguments.length){var e=arguments[0];this.x=e.x,this.y=e.y,this.w=1}else if(2===arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var r=arguments[0],n=arguments[1];this.x=r,this.y=n,this.w=1}else if(arguments[0]instanceof t&&arguments[1]instanceof t){var i=arguments[0],o=arguments[1];this.x=i.y*o.w-o.y*i.w,this.y=o.x*i.w-i.x*o.w,this.w=i.x*o.y-o.x*i.y}else if(arguments[0]instanceof uu&&arguments[1]instanceof uu){var s=arguments[0],a=arguments[1];this.x=s.y-a.y,this.y=a.x-s.x,this.w=s.x*a.y-a.x*s.y}}else if(3===arguments.length){var l=arguments[0],u=arguments[1],c=arguments[2];this.x=l,this.y=u,this.w=c}else if(4===arguments.length){var h=arguments[0],p=arguments[1],f=arguments[2],d=arguments[3],m=h.y-p.y,g=p.x-h.x,y=h.x*p.y-p.x*h.y,_=f.y-d.y,v=d.x-f.x,x=f.x*d.y-d.x*f.y;this.x=g*x-v*y,this.y=_*y-m*x,this.w=m*v-_*g}};Pu.prototype.getY=function(){var t=this.y/this.w;if(nu.isNaN(t)||nu.isInfinite(t))throw new Mu;return t},Pu.prototype.getX=function(){var t=this.x/this.w;if(nu.isNaN(t)||nu.isInfinite(t))throw new Mu;return t},Pu.prototype.getCoordinate=function(){var t=new uu;return t.x=this.getX(),t.y=this.getY(),t},Pu.prototype.interfaces_=function(){return[]},Pu.prototype.getClass=function(){return Pu},Pu.intersection=function(t,e,r,n){var i=t.y-e.y,o=e.x-t.x,s=t.x*e.y-e.x*t.y,a=r.y-n.y,l=n.x-r.x,u=r.x*n.y-n.x*r.y,c=i*l-a*o,h=(o*u-l*s)/c,p=(a*s-i*u)/c;if(nu.isNaN(h)||nu.isInfinite(h)||nu.isNaN(p)||nu.isInfinite(p))throw new Mu;return new uu(h,p)};var ku=function t(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,0===arguments.length)this.init();else if(1===arguments.length){if(arguments[0]instanceof uu){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof t){var r=arguments[0];this.init(r)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.init(n.x,i.x,n.y,i.y)}else if(4===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2],l=arguments[3];this.init(o,s,a,l)}},Lu={serialVersionUID:{configurable:!0}};ku.prototype.getArea=function(){return this.getWidth()*this.getHeight()},ku.prototype.equals=function(t){if(!(t instanceof ku))return!1;var e=t;return this.isNull()?e.isNull():this._maxx===e.getMaxX()&&this._maxy===e.getMaxY()&&this._minx===e.getMinX()&&this._miny===e.getMinY()},ku.prototype.intersection=function(t){if(this.isNull()||t.isNull()||!this.intersects(t))return new ku;var e=this._minx>t._minx?this._minx:t._minx,r=this._miny>t._miny?this._miny:t._miny,n=this._maxx<t._maxx?this._maxx:t._maxx,i=this._maxy<t._maxy?this._maxy:t._maxy;return new ku(e,n,r,i)},ku.prototype.isNull=function(){return this._maxx<this._minx},ku.prototype.getMaxX=function(){return this._maxx},ku.prototype.covers=function(){if(1===arguments.length){if(arguments[0]instanceof uu){var t=arguments[0];return this.covers(t.x,t.y)}if(arguments[0]instanceof ku){var e=arguments[0];return!this.isNull()&&!e.isNull()&&e.getMinX()>=this._minx&&e.getMaxX()<=this._maxx&&e.getMinY()>=this._miny&&e.getMaxY()<=this._maxy}}else if(2===arguments.length){var r=arguments[0],n=arguments[1];return!this.isNull()&&r>=this._minx&&r<=this._maxx&&n>=this._miny&&n<=this._maxy}},ku.prototype.intersects=function(){if(1===arguments.length){if(arguments[0]instanceof ku){var t=arguments[0];return!this.isNull()&&!t.isNull()&&!(t._minx>this._maxx||t._maxx<this._minx||t._miny>this._maxy||t._maxy<this._miny)}if(arguments[0]instanceof uu){var e=arguments[0];return this.intersects(e.x,e.y)}}else if(2===arguments.length){var r=arguments[0],n=arguments[1];return!this.isNull()&&!(r>this._maxx||r<this._minx||n>this._maxy||n<this._miny)}},ku.prototype.getMinY=function(){return this._miny},ku.prototype.getMinX=function(){return this._minx},ku.prototype.expandToInclude=function(){if(1===arguments.length){if(arguments[0]instanceof uu){var t=arguments[0];this.expandToInclude(t.x,t.y)}else if(arguments[0]instanceof ku){var e=arguments[0];if(e.isNull())return null;this.isNull()?(this._minx=e.getMinX(),this._maxx=e.getMaxX(),this._miny=e.getMinY(),this._maxy=e.getMaxY()):(e._minx<this._minx&&(this._minx=e._minx),e._maxx>this._maxx&&(this._maxx=e._maxx),e._miny<this._miny&&(this._miny=e._miny),e._maxy>this._maxy&&(this._maxy=e._maxy))}}else if(2===arguments.length){var r=arguments[0],n=arguments[1];this.isNull()?(this._minx=r,this._maxx=r,this._miny=n,this._maxy=n):(r<this._minx&&(this._minx=r),r>this._maxx&&(this._maxx=r),n<this._miny&&(this._miny=n),n>this._maxy&&(this._maxy=n))}},ku.prototype.minExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t<e?t:e},ku.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx},ku.prototype.compareTo=function(t){var e=t;return this.isNull()?e.isNull()?0:-1:e.isNull()?1:this._minx<e._minx?-1:this._minx>e._minx?1:this._miny<e._miny?-1:this._miny>e._miny?1:this._maxx<e._maxx?-1:this._maxx>e._maxx?1:this._maxy<e._maxy?-1:this._maxy>e._maxy?1:0},ku.prototype.translate=function(t,e){if(this.isNull())return null;this.init(this.getMinX()+t,this.getMaxX()+t,this.getMinY()+e,this.getMaxY()+e)},ku.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"},ku.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1},ku.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny},ku.prototype.maxExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t>e?t:e},ku.prototype.expandBy=function(){if(1===arguments.length){var t=arguments[0];this.expandBy(t,t)}else if(2===arguments.length){var e=arguments[0],r=arguments[1];if(this.isNull())return null;this._minx-=e,this._maxx+=e,this._miny-=r,this._maxy+=r,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}},ku.prototype.contains=function(){if(1===arguments.length){if(arguments[0]instanceof ku){var t=arguments[0];return this.covers(t)}if(arguments[0]instanceof uu){var e=arguments[0];return this.covers(e)}}else if(2===arguments.length){var r=arguments[0],n=arguments[1];return this.covers(r,n)}},ku.prototype.centre=function(){return this.isNull()?null:new uu((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)},ku.prototype.init=function(){if(0===arguments.length)this.setToNull();else if(1===arguments.length){if(arguments[0]instanceof uu){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof ku){var e=arguments[0];this._minx=e._minx,this._maxx=e._maxx,this._miny=e._miny,this._maxy=e._maxy}}else if(2===arguments.length){var r=arguments[0],n=arguments[1];this.init(r.x,n.x,r.y,n.y)}else if(4===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3];i<o?(this._minx=i,this._maxx=o):(this._minx=o,this._maxx=i),s<a?(this._miny=s,this._maxy=a):(this._miny=a,this._maxy=s)}},ku.prototype.getMaxY=function(){return this._maxy},ku.prototype.distance=function(t){if(this.intersects(t))return 0;var e=0;this._maxx<t._minx?e=t._minx-this._maxx:this._minx>t._maxx&&(e=this._minx-t._maxx);var r=0;return this._maxy<t._miny?r=t._miny-this._maxy:this._miny>t._maxy&&(r=this._miny-t._maxy),0===e?r:0===r?e:Math.sqrt(e*e+r*r)},ku.prototype.hashCode=function(){var t=17;return 37*(t=37*(t=37*(t=37*t+uu.hashCode(this._minx))+uu.hashCode(this._maxx))+uu.hashCode(this._miny))+uu.hashCode(this._maxy)},ku.prototype.interfaces_=function(){return[ou,lu]},ku.prototype.getClass=function(){return ku},ku.intersects=function(){if(3===arguments.length){var t=arguments[0],e=arguments[1],r=arguments[2];return r.x>=(t.x<e.x?t.x:e.x)&&r.x<=(t.x>e.x?t.x:e.x)&&r.y>=(t.y<e.y?t.y:e.y)&&r.y<=(t.y>e.y?t.y:e.y)}if(4===arguments.length){var n=arguments[0],i=arguments[1],o=arguments[2],s=arguments[3],a=Math.min(o.x,s.x),l=Math.max(o.x,s.x),u=Math.min(n.x,i.x),c=Math.max(n.x,i.x);return!(u>l)&&!(c<a)&&(a=Math.min(o.y,s.y),l=Math.max(o.y,s.y),u=Math.min(n.y,i.y),c=Math.max(n.y,i.y),!(u>l)&&!(c<a))}},Lu.serialVersionUID.get=function(){return 0x51845cd552189800},Object.defineProperties(ku,Lu);var zu={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},Du=function(t){this.geometryFactory=t||new vh};Du.prototype.read=function(t){var e,r,n;t=t.replace(/[\n\r]/g," ");var i=zu.typeStr.exec(t);if(-1!==t.search("EMPTY")&&((i=zu.emptyTypeStr.exec(t))[2]=void 0),i&&(r=i[1].toLowerCase(),n=i[2],Ou[r]&&(e=Ou[r].apply(this,[n]))),void 0===e)throw new Error("Could not parse WKT "+t);return e},Du.prototype.write=function(t){return this.extractGeometry(t)},Du.prototype.extractGeometry=function(t){var e=t.getGeometryType().toLowerCase();if(!Ru[e])return null;var r=e.toUpperCase();return t.isEmpty()?r+" EMPTY":r+"("+Ru[e].apply(this,[t])+")"};var Ru={coordinate:function(t){return t.x+" "+t.y},point:function(t){return Ru.coordinate.call(this,t._coordinates._coordinates[0])},multipoint:function(t){for(var e=[],r=0,n=t._geometries.length;r<n;++r)e.push("("+Ru.point.apply(this,[t._geometries[r]])+")");return e.join(",")},linestring:function(t){for(var e=[],r=0,n=t._points._coordinates.length;r<n;++r)e.push(Ru.coordinate.apply(this,[t._points._coordinates[r]]));return e.join(",")},linearring:function(t){for(var e=[],r=0,n=t._points._coordinates.length;r<n;++r)e.push(Ru.coordinate.apply(this,[t._points._coordinates[r]]));return e.join(",")},multilinestring:function(t){for(var e=[],r=0,n=t._geometries.length;r<n;++r)e.push("("+Ru.linestring.apply(this,[t._geometries[r]])+")");return e.join(",")},polygon:function(t){var e=[];e.push("("+Ru.linestring.apply(this,[t._shell])+")");for(var r=0,n=t._holes.length;r<n;++r)e.push("("+Ru.linestring.apply(this,[t._holes[r]])+")");return e.join(",")},multipolygon:function(t){for(var e=[],r=0,n=t._geometries.length;r<n;++r)e.push("("+Ru.polygon.apply(this,[t._geometries[r]])+")");return e.join(",")},geometrycollection:function(t){for(var e=[],r=0,n=t._geometries.length;r<n;++r)e.push(this.extractGeometry(t._geometries[r]));return e.join(",")}},Ou={point:function(t){if(void 0===t)return this.geometryFactory.createPoint();var e=t.trim().split(zu.spaces);return this.geometryFactory.createPoint(new uu(Number.parseFloat(e[0]),Number.parseFloat(e[1])))},multipoint:function(t){var e;if(void 0===t)return this.geometryFactory.createMultiPoint();for(var r=t.trim().split(","),n=[],i=0,o=r.length;i<o;++i)e=r[i].replace(zu.trimParens,"$1"),n.push(Ou.point.apply(this,[e]));return this.geometryFactory.createMultiPoint(n)},linestring:function(t){if(void 0===t)return this.geometryFactory.createLineString();for(var e,r=t.trim().split(","),n=[],i=0,o=r.length;i<o;++i)e=r[i].trim().split(zu.spaces),n.push(new uu(Number.parseFloat(e[0]),Number.parseFloat(e[1])));return this.geometryFactory.createLineString(n)},linearring:function(t){if(void 0===t)return this.geometryFactory.createLinearRing();for(var e,r=t.trim().split(","),n=[],i=0,o=r.length;i<o;++i)e=r[i].trim().split(zu.spaces),n.push(new uu(Number.parseFloat(e[0]),Number.parseFloat(e[1])));return this.geometryFactory.createLinearRing(n)},multilinestring:function(t){var e;if(void 0===t)return this.geometryFactory.createMultiLineString();for(var r=t.trim().split(zu.parenComma),n=[],i=0,o=r.length;i<o;++i)e=r[i].replace(zu.trimParens,"$1"),n.push(Ou.linestring.apply(this,[e]));return this.geometryFactory.createMultiLineString(n)},polygon:function(t){var e,r,n;if(void 0===t)return this.geometryFactory.createPolygon();for(var i,o=t.trim().split(zu.parenComma),s=[],a=0,l=o.length;a<l;++a)e=o[a].replace(zu.trimParens,"$1"),r=Ou.linestring.apply(this,[e]),n=this.geometryFactory.createLinearRing(r._points),0===a?i=n:s.push(n);return this.geometryFactory.createPolygon(i,s)},multipolygon:function(t){var e;if(void 0===t)return this.geometryFactory.createMultiPolygon();for(var r=t.trim().split(zu.doubleParenComma),n=[],i=0,o=r.length;i<o;++i)e=r[i].replace(zu.trimParens,"$1"),n.push(Ou.polygon.apply(this,[e]));return this.geometryFactory.createMultiPolygon(n)},geometrycollection:function(t){if(void 0===t)return this.geometryFactory.createGeometryCollection();for(var e=(t=t.replace(/,\s*([A-Za-z])/g,"|$1")).trim().split("|"),r=[],n=0,i=e.length;n<i;++n)r.push(this.read(e[n]));return this.geometryFactory.createGeometryCollection(r)}},Nu=function(t){this.parser=new Du(t)};Nu.prototype.write=function(t){return this.parser.write(t)},Nu.toLineString=function(t,e){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+t.x+" "+t.y+", "+e.x+" "+e.y+" )"};var Fu=function(t){function e(e){t.call(this,e),this.name="RuntimeException",this.message=e,this.stack=(new t).stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),Bu=function(t){function e(){if(t.call(this),0===arguments.length)t.call(this);else if(1===arguments.length){var e=arguments[0];t.call(this,e)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Fu),ju=function(){};ju.prototype.interfaces_=function(){return[]},ju.prototype.getClass=function(){return ju},ju.shouldNeverReachHere=function(){if(0===arguments.length)ju.shouldNeverReachHere(null);else if(1===arguments.length){var t=arguments[0];throw new Bu("Should never reach here"+(null!==t?": "+t:""))}},ju.isTrue=function(){var t;if(1===arguments.length)ju.isTrue(arguments[0],null);else if(2===arguments.length&&(t=arguments[1],!arguments[0]))throw null===t?new Bu:new Bu(t)},ju.equals=function(){var t,e,r;if(2===arguments.length)ju.equals(t=arguments[0],e=arguments[1],null);else if(3===arguments.length&&(t=arguments[0],r=arguments[2],!(e=arguments[1]).equals(t)))throw new Bu("Expected "+t+" but encountered "+e+(null!==r?": "+r:""))};var Uu=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new uu,this._intPt[1]=new uu,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},Vu={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};Uu.prototype.getIndexAlongSegment=function(t,e){return this.computeIntLineIndex(),this._intLineIndex[t][e]},Uu.prototype.getTopologySummary=function(){var t=new _u;return this.isEndPoint()&&t.append(" endpoint"),this._isProper&&t.append(" proper"),this.isCollinear()&&t.append(" collinear"),t.toString()},Uu.prototype.computeIntersection=function(t,e,r,n){this._inputLines[0][0]=t,this._inputLines[0][1]=e,this._inputLines[1][0]=r,this._inputLines[1][1]=n,this._result=this.computeIntersect(t,e,r,n)},Uu.prototype.getIntersectionNum=function(){return this._result},Uu.prototype.computeIntLineIndex=function(){if(0===arguments.length)null===this._intLineIndex&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){var t=arguments[0],e=this.getEdgeDistance(t,0),r=this.getEdgeDistance(t,1);e>r?(this._intLineIndex[t][0]=0,this._intLineIndex[t][1]=1):(this._intLineIndex[t][0]=1,this._intLineIndex[t][1]=0)}},Uu.prototype.isProper=function(){return this.hasIntersection()&&this._isProper},Uu.prototype.setPrecisionModel=function(t){this._precisionModel=t},Uu.prototype.isInteriorIntersection=function(){var t=this;if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var e=arguments[0],r=0;r<this._result;r++)if(!t._intPt[r].equals2D(t._inputLines[e][0])&&!t._intPt[r].equals2D(t._inputLines[e][1]))return!0;return!1}},Uu.prototype.getIntersection=function(t){return this._intPt[t]},Uu.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper},Uu.prototype.hasIntersection=function(){return this._result!==Uu.NO_INTERSECTION},Uu.prototype.getEdgeDistance=function(t,e){return Uu.computeEdgeDistance(this._intPt[e],this._inputLines[t][0],this._inputLines[t][1])},Uu.prototype.isCollinear=function(){return this._result===Uu.COLLINEAR_INTERSECTION},Uu.prototype.toString=function(){return Nu.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+Nu.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()},Uu.prototype.getEndpoint=function(t,e){return this._inputLines[t][e]},Uu.prototype.isIntersection=function(t){for(var e=0;e<this._result;e++)if(this._intPt[e].equals2D(t))return!0;return!1},Uu.prototype.getIntersectionAlongSegment=function(t,e){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[t][e]]},Uu.prototype.interfaces_=function(){return[]},Uu.prototype.getClass=function(){return Uu},Uu.computeEdgeDistance=function(t,e,r){var n=Math.abs(r.x-e.x),i=Math.abs(r.y-e.y),o=-1;if(t.equals(e))o=0;else if(t.equals(r))o=n>i?n:i;else{var s=Math.abs(t.x-e.x),a=Math.abs(t.y-e.y);0!==(o=n>i?s:a)||t.equals(e)||(o=Math.max(s,a))}return ju.isTrue(!(0===o&&!t.equals(e)),"Bad distance calculation"),o},Uu.nonRobustComputeEdgeDistance=function(t,e,r){var n=t.x-e.x,i=t.y-e.y,o=Math.sqrt(n*n+i*i);return ju.isTrue(!(0===o&&!t.equals(e)),"Invalid distance calculation"),o},Vu.DONT_INTERSECT.get=function(){return 0},Vu.DO_INTERSECT.get=function(){return 1},Vu.COLLINEAR.get=function(){return 2},Vu.NO_INTERSECTION.get=function(){return 0},Vu.POINT_INTERSECTION.get=function(){return 1},Vu.COLLINEAR_INTERSECTION.get=function(){return 2},Object.defineProperties(Uu,Vu);var Gu=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isInSegmentEnvelopes=function(t){var e=new ku(this._inputLines[0][0],this._inputLines[0][1]),r=new ku(this._inputLines[1][0],this._inputLines[1][1]);return e.contains(t)&&r.contains(t)},e.prototype.computeIntersection=function(){if(3!==arguments.length)return t.prototype.computeIntersection.apply(this,arguments);var e=arguments[0],r=arguments[1],n=arguments[2];if(this._isProper=!1,ku.intersects(r,n,e)&&0===Zu.orientationIndex(r,n,e)&&0===Zu.orientationIndex(n,r,e))return this._isProper=!0,(e.equals(r)||e.equals(n))&&(this._isProper=!1),this._result=t.POINT_INTERSECTION,null;this._result=t.NO_INTERSECTION},e.prototype.normalizeToMinimum=function(t,e,r,n,i){i.x=this.smallestInAbsValue(t.x,e.x,r.x,n.x),i.y=this.smallestInAbsValue(t.y,e.y,r.y,n.y),t.x-=i.x,t.y-=i.y,e.x-=i.x,e.y-=i.y,r.x-=i.x,r.y-=i.y,n.x-=i.x,n.y-=i.y},e.prototype.safeHCoordinateIntersection=function(t,r,n,i){var o=null;try{o=Pu.intersection(t,r,n,i)}catch(a){if(!(a instanceof Mu))throw a;o=e.nearestEndpoint(t,r,n,i)}return o},e.prototype.intersection=function(t,r,n,i){var o=this.intersectionWithNormalization(t,r,n,i);return this.isInSegmentEnvelopes(o)||(o=new uu(e.nearestEndpoint(t,r,n,i))),null!==this._precisionModel&&this._precisionModel.makePrecise(o),o},e.prototype.smallestInAbsValue=function(t,e,r,n){var i=t,o=Math.abs(i);return Math.abs(e)<o&&(i=e,o=Math.abs(e)),Math.abs(r)<o&&(i=r,o=Math.abs(r)),Math.abs(n)<o&&(i=n),i},e.prototype.checkDD=function(t,e,r,n,i){var o=Eu.intersection(t,e,r,n),s=this.isInSegmentEnvelopes(o);Au.out.println("DD in env = "+s+"  --------------------- "+o),i.distance(o)>1e-4&&Au.out.println("Distance = "+i.distance(o))},e.prototype.intersectionWithNormalization=function(t,e,r,n){var i=new uu(t),o=new uu(e),s=new uu(r),a=new uu(n),l=new uu;this.normalizeToEnvCentre(i,o,s,a,l);var u=this.safeHCoordinateIntersection(i,o,s,a);return u.x+=l.x,u.y+=l.y,u},e.prototype.computeCollinearIntersection=function(e,r,n,i){var o=ku.intersects(e,r,n),s=ku.intersects(e,r,i),a=ku.intersects(n,i,e),l=ku.intersects(n,i,r);return o&&s?(this._intPt[0]=n,this._intPt[1]=i,t.COLLINEAR_INTERSECTION):a&&l?(this._intPt[0]=e,this._intPt[1]=r,t.COLLINEAR_INTERSECTION):o&&a?(this._intPt[0]=n,this._intPt[1]=e,!n.equals(e)||s||l?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):o&&l?(this._intPt[0]=n,this._intPt[1]=r,!n.equals(r)||s||a?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):s&&a?(this._intPt[0]=i,this._intPt[1]=e,!i.equals(e)||o||l?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):s&&l?(this._intPt[0]=i,this._intPt[1]=r,!i.equals(r)||o||a?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):t.NO_INTERSECTION},e.prototype.normalizeToEnvCentre=function(t,e,r,n,i){var o=t.x<e.x?t.x:e.x,s=t.y<e.y?t.y:e.y,a=t.x>e.x?t.x:e.x,l=t.y>e.y?t.y:e.y,u=r.x<n.x?r.x:n.x,c=r.y<n.y?r.y:n.y,h=r.x>n.x?r.x:n.x,p=r.y>n.y?r.y:n.y,f=((o>u?o:u)+(a<h?a:h))/2,d=((s>c?s:c)+(l<p?l:p))/2;i.x=f,i.y=d,t.x-=i.x,t.y-=i.y,e.x-=i.x,e.y-=i.y,r.x-=i.x,r.y-=i.y,n.x-=i.x,n.y-=i.y},e.prototype.computeIntersect=function(e,r,n,i){if(this._isProper=!1,!ku.intersects(e,r,n,i))return t.NO_INTERSECTION;var o=Zu.orientationIndex(e,r,n),s=Zu.orientationIndex(e,r,i);if(o>0&&s>0||o<0&&s<0)return t.NO_INTERSECTION;var a=Zu.orientationIndex(n,i,e),l=Zu.orientationIndex(n,i,r);return a>0&&l>0||a<0&&l<0?t.NO_INTERSECTION:0===o&&0===s&&0===a&&0===l?this.computeCollinearIntersection(e,r,n,i):(0===o||0===s||0===a||0===l?(this._isProper=!1,e.equals2D(n)||e.equals2D(i)?this._intPt[0]=e:r.equals2D(n)||r.equals2D(i)?this._intPt[0]=r:0===o?this._intPt[0]=new uu(n):0===s?this._intPt[0]=new uu(i):0===a?this._intPt[0]=new uu(e):0===l&&(this._intPt[0]=new uu(r))):(this._isProper=!0,this._intPt[0]=this.intersection(e,r,n,i)),t.POINT_INTERSECTION)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.nearestEndpoint=function(t,e,r,n){var i=t,o=Zu.distancePointLine(t,r,n),s=Zu.distancePointLine(e,r,n);return s<o&&(o=s,i=e),(s=Zu.distancePointLine(r,t,e))<o&&(o=s,i=r),(s=Zu.distancePointLine(n,t,e))<o&&(o=s,i=n),i},e}(Uu),qu=function(){};qu.prototype.interfaces_=function(){return[]},qu.prototype.getClass=function(){return qu},qu.orientationIndex=function(t,e,r){var n=e.x-t.x,i=e.y-t.y,o=r.x-e.x,s=r.y-e.y;return qu.signOfDet2x2(n,i,o,s)},qu.signOfDet2x2=function(t,e,r,n){var i=null,o=null,s=null;if(i=1,0===t||0===n)return 0===e||0===r?0:e>0?r>0?-i:i:r>0?i:-i;if(0===e||0===r)return n>0?t>0?i:-i:t>0?-i:i;if(e>0?n>0?e<=n||(i=-i,o=t,t=r,r=o,o=e,e=n,n=o):e<=-n?(i=-i,r=-r,n=-n):(o=t,t=-r,r=o,o=e,e=-n,n=o):n>0?-e<=n?(i=-i,t=-t,e=-e):(o=-t,t=r,r=o,o=-e,e=n,n=o):e>=n?(t=-t,e=-e,r=-r,n=-n):(i=-i,o=-t,t=-r,r=o,o=-e,e=-n,n=o),t>0){if(!(r>0))return i;if(!(t<=r))return i}else{if(r>0)return-i;if(!(t>=r))return-i;i=-i,t=-t,r=-r}for(;;){if((n-=(s=Math.floor(r/t))*e)<0)return-i;if(n>e)return i;if(t>(r-=s*t)+r){if(e<n+n)return i}else{if(e>n+n)return-i;r=t-r,n=e-n,i=-i}if(0===n)return 0===r?0:-i;if(0===r)return i;if((e-=(s=Math.floor(t/r))*n)<0)return i;if(e>n)return-i;if(r>(t-=s*r)+t){if(n<e+e)return-i}else{if(n>e+e)return i;t=r-t,e=n-e,i=-i}if(0===e)return 0===t?0:i;if(0===t)return-i}};var $u=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var t=arguments[0];this._p=t};$u.prototype.countSegment=function(t,e){if(t.x<this._p.x&&e.x<this._p.x)return null;if(this._p.x===e.x&&this._p.y===e.y)return this._isPointOnSegment=!0,null;if(t.y===this._p.y&&e.y===this._p.y){var r=t.x,n=e.x;return r>n&&(r=e.x,n=t.x),this._p.x>=r&&this._p.x<=n&&(this._isPointOnSegment=!0),null}if(t.y>this._p.y&&e.y<=this._p.y||e.y>this._p.y&&t.y<=this._p.y){var i=t.x-this._p.x,o=t.y-this._p.y,s=e.x-this._p.x,a=e.y-this._p.y,l=qu.signOfDet2x2(i,o,s,a);if(0===l)return this._isPointOnSegment=!0,null;a<o&&(l=-l),l>0&&this._crossingCount++}},$u.prototype.isPointInPolygon=function(){return this.getLocation()!==fu.EXTERIOR},$u.prototype.getLocation=function(){return this._isPointOnSegment?fu.BOUNDARY:this._crossingCount%2==1?fu.INTERIOR:fu.EXTERIOR},$u.prototype.isOnSegment=function(){return this._isPointOnSegment},$u.prototype.interfaces_=function(){return[]},$u.prototype.getClass=function(){return $u},$u.locatePointInRing=function(){if(arguments[0]instanceof uu&&mu(arguments[1],Iu)){for(var t=arguments[0],e=arguments[1],r=new $u(t),n=new uu,i=new uu,o=1;o<e.size();o++)if(e.getCoordinate(o,n),e.getCoordinate(o-1,i),r.countSegment(n,i),r.isOnSegment())return r.getLocation();return r.getLocation()}if(arguments[0]instanceof uu&&arguments[1]instanceof Array){for(var s=arguments[0],a=arguments[1],l=new $u(s),u=1;u<a.length;u++){var c=a[u],h=a[u-1];if(l.countSegment(c,h),l.isOnSegment())return l.getLocation()}return l.getLocation()}};var Zu=function(){},Xu={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};Zu.prototype.interfaces_=function(){return[]},Zu.prototype.getClass=function(){return Zu},Zu.orientationIndex=function(t,e,r){return Eu.orientationIndex(t,e,r)},Zu.signedArea=function(){if(arguments[0]instanceof Array){var t=arguments[0];if(t.length<3)return 0;for(var e=0,r=t[0].x,n=1;n<t.length-1;n++){var i=t[n].x-r,o=t[n+1].y,s=t[n-1].y;e+=i*(s-o)}return e/2}if(mu(arguments[0],Iu)){var a=arguments[0],l=a.size();if(l<3)return 0;var u=new uu,c=new uu,h=new uu;a.getCoordinate(0,c),a.getCoordinate(1,h);var p=c.x;h.x-=p;for(var f=0,d=1;d<l-1;d++)u.y=c.y,c.x=h.x,c.y=h.y,a.getCoordinate(d+1,h),h.x-=p,f+=c.x*(u.y-h.y);return f/2}},Zu.distanceLineLine=function(t,e,r,n){if(t.equals(e))return Zu.distancePointLine(t,r,n);if(r.equals(n))return Zu.distancePointLine(n,t,e);var i=!1;if(ku.intersects(t,e,r,n)){var o=(e.x-t.x)*(n.y-r.y)-(e.y-t.y)*(n.x-r.x);if(0===o)i=!0;else{var s=(t.y-r.y)*(n.x-r.x)-(t.x-r.x)*(n.y-r.y),a=((t.y-r.y)*(e.x-t.x)-(t.x-r.x)*(e.y-t.y))/o,l=s/o;(l<0||l>1||a<0||a>1)&&(i=!0)}}else i=!0;return i?gu.min(Zu.distancePointLine(t,r,n),Zu.distancePointLine(e,r,n),Zu.distancePointLine(r,t,e),Zu.distancePointLine(n,t,e)):0},Zu.isPointInRing=function(t,e){return Zu.locatePointInRing(t,e)!==fu.EXTERIOR},Zu.computeLength=function(t){var e=t.size();if(e<=1)return 0;var r=0,n=new uu;t.getCoordinate(0,n);for(var i=n.x,o=n.y,s=1;s<e;s++){t.getCoordinate(s,n);var a=n.x,l=n.y,u=a-i,c=l-o;r+=Math.sqrt(u*u+c*c),i=a,o=l}return r},Zu.isCCW=function(t){var e=t.length-1;if(e<3)throw new ru("Ring has fewer than 4 points, so orientation cannot be determined");for(var r=t[0],n=0,i=1;i<=e;i++){var o=t[i];o.y>r.y&&(r=o,n=i)}var s=n;do{(s-=1)<0&&(s=e)}while(t[s].equals2D(r)&&s!==n);var a=n;do{a=(a+1)%e}while(t[a].equals2D(r)&&a!==n);var l=t[s],u=t[a];if(l.equals2D(r)||u.equals2D(r)||l.equals2D(u))return!1;var c=Zu.computeOrientation(l,r,u),h=!1;return h=0===c?l.x>u.x:c>0,h},Zu.locatePointInRing=function(t,e){return $u.locatePointInRing(t,e)},Zu.distancePointLinePerpendicular=function(t,e,r){var n=(r.x-e.x)*(r.x-e.x)+(r.y-e.y)*(r.y-e.y),i=((e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y))/n;return Math.abs(i)*Math.sqrt(n)},Zu.computeOrientation=function(t,e,r){return Zu.orientationIndex(t,e,r)},Zu.distancePointLine=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(0===e.length)throw new ru("Line array must contain at least one vertex");for(var r=t.distance(e[0]),n=0;n<e.length-1;n++){var i=Zu.distancePointLine(t,e[n],e[n+1]);i<r&&(r=i)}return r}if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];if(s.x===a.x&&s.y===a.y)return o.distance(s);var l=(a.x-s.x)*(a.x-s.x)+(a.y-s.y)*(a.y-s.y),u=((o.x-s.x)*(a.x-s.x)+(o.y-s.y)*(a.y-s.y))/l;if(u<=0)return o.distance(s);if(u>=1)return o.distance(a);var c=((s.y-o.y)*(a.x-s.x)-(s.x-o.x)*(a.y-s.y))/l;return Math.abs(c)*Math.sqrt(l)}},Zu.isOnLine=function(t,e){for(var r=new Gu,n=1;n<e.length;n++){var i=e[n-1],o=e[n];if(r.computeIntersection(t,i,o),r.hasIntersection())return!0}return!1},Xu.CLOCKWISE.get=function(){return-1},Xu.RIGHT.get=function(){return Zu.CLOCKWISE},Xu.COUNTERCLOCKWISE.get=function(){return 1},Xu.LEFT.get=function(){return Zu.COUNTERCLOCKWISE},Xu.COLLINEAR.get=function(){return 0},Xu.STRAIGHT.get=function(){return Zu.COLLINEAR},Object.defineProperties(Zu,Xu);var Wu=function(){};Wu.prototype.filter=function(t){},Wu.prototype.interfaces_=function(){return[]},Wu.prototype.getClass=function(){return Wu};var Yu=function(){var t=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=t,this._SRID=t.getSRID()},Hu={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};Yu.prototype.isGeometryCollection=function(){return this.getSortIndex()===Yu.SORTINDEX_GEOMETRYCOLLECTION},Yu.prototype.getFactory=function(){return this._factory},Yu.prototype.getGeometryN=function(t){return this},Yu.prototype.getArea=function(){return 0},Yu.prototype.isRectangle=function(){return!1},Yu.prototype.equals=function(){if(arguments[0]instanceof Yu){var t=arguments[0];return null!==t&&this.equalsTopo(t)}if(arguments[0]instanceof Object){var e=arguments[0];if(!(e instanceof Yu))return!1;var r=e;return this.equalsExact(r)}},Yu.prototype.equalsExact=function(t){return this===t||this.equalsExact(t,0)},Yu.prototype.geometryChanged=function(){this.apply(Yu.geometryChangedFilter)},Yu.prototype.geometryChangedAction=function(){this._envelope=null},Yu.prototype.equalsNorm=function(t){return null!==t&&this.norm().equalsExact(t.norm())},Yu.prototype.getLength=function(){return 0},Yu.prototype.getNumGeometries=function(){return 1},Yu.prototype.compareTo=function(){if(1===arguments.length){var t=arguments[0],e=t;return this.getSortIndex()!==e.getSortIndex()?this.getSortIndex()-e.getSortIndex():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(t)}if(2===arguments.length){var r=arguments[0],n=arguments[1];return this.getSortIndex()!==r.getSortIndex()?this.getSortIndex()-r.getSortIndex():this.isEmpty()&&r.isEmpty()?0:this.isEmpty()?-1:r.isEmpty()?1:this.compareToSameClass(r,n)}},Yu.prototype.getUserData=function(){return this._userData},Yu.prototype.getSRID=function(){return this._SRID},Yu.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())},Yu.prototype.checkNotGeometryCollection=function(t){if(t.getSortIndex()===Yu.SORTINDEX_GEOMETRYCOLLECTION)throw new ru("This method does not support GeometryCollection arguments")},Yu.prototype.equal=function(t,e,r){return 0===r?t.equals(e):t.distance(e)<=r},Yu.prototype.norm=function(){var t=this.copy();return t.normalize(),t},Yu.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()},Yu.prototype.getEnvelopeInternal=function(){return null===this._envelope&&(this._envelope=this.computeEnvelopeInternal()),new ku(this._envelope)},Yu.prototype.setSRID=function(t){this._SRID=t},Yu.prototype.setUserData=function(t){this._userData=t},Yu.prototype.compare=function(t,e){for(var r=t.iterator(),n=e.iterator();r.hasNext()&&n.hasNext();){var i=r.next(),o=n.next(),s=i.compareTo(o);if(0!==s)return s}return r.hasNext()?1:n.hasNext()?-1:0},Yu.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()},Yu.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===Yu.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===Yu.SORTINDEX_MULTIPOINT||this.getSortIndex()===Yu.SORTINDEX_MULTILINESTRING||this.getSortIndex()===Yu.SORTINDEX_MULTIPOLYGON},Yu.prototype.interfaces_=function(){return[su,ou,lu]},Yu.prototype.getClass=function(){return Yu},Yu.hasNonEmptyElements=function(t){for(var e=0;e<t.length;e++)if(!t[e].isEmpty())return!0;return!1},Yu.hasNullElements=function(t){for(var e=0;e<t.length;e++)if(null===t[e])return!0;return!1},Hu.serialVersionUID.get=function(){return 0x799ea46522854c00},Hu.SORTINDEX_POINT.get=function(){return 0},Hu.SORTINDEX_MULTIPOINT.get=function(){return 1},Hu.SORTINDEX_LINESTRING.get=function(){return 2},Hu.SORTINDEX_LINEARRING.get=function(){return 3},Hu.SORTINDEX_MULTILINESTRING.get=function(){return 4},Hu.SORTINDEX_POLYGON.get=function(){return 5},Hu.SORTINDEX_MULTIPOLYGON.get=function(){return 6},Hu.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7},Hu.geometryChangedFilter.get=function(){return Ju},Object.defineProperties(Yu,Hu);var Ju=function(){};Ju.interfaces_=function(){return[Wu]},Ju.filter=function(t){t.geometryChangedAction()};var Ku=function(){};Ku.prototype.filter=function(t){},Ku.prototype.interfaces_=function(){return[]},Ku.prototype.getClass=function(){return Ku};var Qu=function(){},tc={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};Qu.prototype.isInBoundary=function(t){},Qu.prototype.interfaces_=function(){return[]},Qu.prototype.getClass=function(){return Qu},tc.Mod2BoundaryNodeRule.get=function(){return ec},tc.EndPointBoundaryNodeRule.get=function(){return rc},tc.MultiValentEndPointBoundaryNodeRule.get=function(){return nc},tc.MonoValentEndPointBoundaryNodeRule.get=function(){return ic},tc.MOD2_BOUNDARY_RULE.get=function(){return new ec},tc.ENDPOINT_BOUNDARY_RULE.get=function(){return new rc},tc.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new nc},tc.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new ic},tc.OGC_SFS_BOUNDARY_RULE.get=function(){return Qu.MOD2_BOUNDARY_RULE},Object.defineProperties(Qu,tc);var ec=function(){};ec.prototype.isInBoundary=function(t){return t%2==1},ec.prototype.interfaces_=function(){return[Qu]},ec.prototype.getClass=function(){return ec};var rc=function(){};rc.prototype.isInBoundary=function(t){return t>0},rc.prototype.interfaces_=function(){return[Qu]},rc.prototype.getClass=function(){return rc};var nc=function(){};nc.prototype.isInBoundary=function(t){return t>1},nc.prototype.interfaces_=function(){return[Qu]},nc.prototype.getClass=function(){return nc};var ic=function(){};ic.prototype.isInBoundary=function(t){return 1===t},ic.prototype.interfaces_=function(){return[Qu]},ic.prototype.getClass=function(){return ic};var oc=function(){};function sc(t){this.message=t||""}oc.prototype.add=function(){},oc.prototype.addAll=function(){},oc.prototype.isEmpty=function(){},oc.prototype.iterator=function(){},oc.prototype.size=function(){},oc.prototype.toArray=function(){},oc.prototype.remove=function(){},sc.prototype=new Error,sc.prototype.name="IndexOutOfBoundsException";var ac=function(){};ac.prototype.hasNext=function(){},ac.prototype.next=function(){},ac.prototype.remove=function(){};var lc=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(){},e.prototype.set=function(){},e.prototype.isEmpty=function(){},e}(oc);function uc(t){this.message=t||""}uc.prototype=new Error,uc.prototype.name="NoSuchElementException";var cc=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof oc&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.ensureCapacity=function(){},e.prototype.interfaces_=function(){return[t,oc]},e.prototype.add=function(t){return 1===arguments.length?this.array_.push(t):this.array_.splice(arguments[0],arguments[1]),!0},e.prototype.clear=function(){this.array_=[]},e.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},e.prototype.set=function(t,e){var r=this.array_[t];return this.array_[t]=e,r},e.prototype.iterator=function(){return new hc(this)},e.prototype.get=function(t){if(t<0||t>=this.size())throw new sc;return this.array_[t]},e.prototype.isEmpty=function(){return 0===this.array_.length},e.prototype.size=function(){return this.array_.length},e.prototype.toArray=function(){for(var t=[],e=0,r=this.array_.length;e<r;e++)t.push(this.array_[e]);return t},e.prototype.remove=function(t){for(var e=!1,r=0,n=this.array_.length;r<n;r++)if(this.array_[r]===t){this.array_.splice(r,1),e=!0;break}return e},e}(lc),hc=function(t){function e(e){t.call(this),this.arrayList_=e,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new uc;return this.arrayList_.get(this.position_++)},e.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},e.prototype.set=function(t){return this.arrayList_.set(this.position_-1,t)},e.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},e}(ac),pc=function(t){function e(){if(t.call(this),0===arguments.length);else if(1===arguments.length){var e=arguments[0];this.ensureCapacity(e.length),this.add(e,!0)}else if(2===arguments.length){var r=arguments[0],n=arguments[1];this.ensureCapacity(r.length),this.add(r,n)}}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={coordArrayType:{configurable:!0}};return r.coordArrayType.get=function(){return new Array(0).fill(null)},e.prototype.getCoordinate=function(t){return this.get(t)},e.prototype.addAll=function(){var e=this;if(2===arguments.length){for(var r=arguments[0],n=arguments[1],i=!1,o=r.iterator();o.hasNext();)e.add(o.next(),n),i=!0;return i}return t.prototype.addAll.apply(this,arguments)},e.prototype.clone=function(){for(var e=t.prototype.clone.call(this),r=0;r<this.size();r++)e.add(r,this.get(r).copy());return e},e.prototype.toCoordinateArray=function(){return this.toArray(e.coordArrayType)},e.prototype.add=function(){var e=this;if(1===arguments.length){var r=arguments[0];t.prototype.add.call(this,r)}else if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var n=arguments[0],i=arguments[1];return this.add(n,i,!0),!0}if(arguments[0]instanceof uu&&"boolean"==typeof arguments[1]){var o=arguments[0],s=arguments[1];if(!s&&this.size()>=1){var a=this.get(this.size()-1);if(a.equals2D(o))return null}t.prototype.add.call(this,o)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1]){var l=arguments[0],u=arguments[1];return this.add(l,u),!0}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var c=arguments[0],h=arguments[1],p=arguments[2];if(p)for(var f=0;f<c.length;f++)e.add(c[f],h);else for(var d=c.length-1;d>=0;d--)e.add(c[d],h);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof uu){var m=arguments[0],g=arguments[1],y=arguments[2];if(!y){var _=this.size();if(_>0){if(m>0){var v=this.get(m-1);if(v.equals2D(g))return null}if(m<_){var x=this.get(m);if(x.equals2D(g))return null}}}t.prototype.add.call(this,m,g)}}else if(4===arguments.length){var b=arguments[0],w=arguments[1],E=arguments[2],S=arguments[3],I=1;E>S&&(I=-1);for(var T=E;T!==S;T+=I)e.add(b[T],w);return!0}},e.prototype.closeRing=function(){this.size()>0&&this.add(new uu(this.get(0)),!1)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},Object.defineProperties(e,r),e}(cc),fc=function(){},dc={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};dc.ForwardComparator.get=function(){return mc},dc.BidirectionalComparator.get=function(){return gc},dc.coordArrayType.get=function(){return new Array(0).fill(null)},fc.prototype.interfaces_=function(){return[]},fc.prototype.getClass=function(){return fc},fc.isRing=function(t){return!(t.length<4)&&!!t[0].equals2D(t[t.length-1])},fc.ptNotInList=function(t,e){for(var r=0;r<t.length;r++){var n=t[r];if(fc.indexOf(n,e)<0)return n}return null},fc.scroll=function(t,e){var r=fc.indexOf(e,t);if(r<0)return null;var n=new Array(t.length).fill(null);Au.arraycopy(t,r,n,0,t.length-r),Au.arraycopy(t,0,n,t.length-r,r),Au.arraycopy(n,0,t,0,t.length)},fc.equals=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(t===e)return!0;if(null===t||null===e)return!1;if(t.length!==e.length)return!1;for(var r=0;r<t.length;r++)if(!t[r].equals(e[r]))return!1;return!0}if(3===arguments.length){var n=arguments[0],i=arguments[1],o=arguments[2];if(n===i)return!0;if(null===n||null===i)return!1;if(n.length!==i.length)return!1;for(var s=0;s<n.length;s++)if(0!==o.compare(n[s],i[s]))return!1;return!0}},fc.intersection=function(t,e){for(var r=new pc,n=0;n<t.length;n++)e.intersects(t[n])&&r.add(t[n],!0);return r.toCoordinateArray()},fc.hasRepeatedPoints=function(t){for(var e=1;e<t.length;e++)if(t[e-1].equals(t[e]))return!0;return!1},fc.removeRepeatedPoints=function(t){return fc.hasRepeatedPoints(t)?new pc(t,!1).toCoordinateArray():t},fc.reverse=function(t){for(var e=t.length-1,r=Math.trunc(e/2),n=0;n<=r;n++){var i=t[n];t[n]=t[e-n],t[e-n]=i}},fc.removeNull=function(t){for(var e=0,r=0;r<t.length;r++)null!==t[r]&&e++;var n=new Array(e).fill(null);if(0===e)return n;for(var i=0,o=0;o<t.length;o++)null!==t[o]&&(n[i++]=t[o]);return n},fc.copyDeep=function(){if(1===arguments.length){for(var t=arguments[0],e=new Array(t.length).fill(null),r=0;r<t.length;r++)e[r]=new uu(t[r]);return e}if(5===arguments.length)for(var n=arguments[0],i=arguments[1],o=arguments[2],s=arguments[3],a=arguments[4],l=0;l<a;l++)o[s+l]=new uu(n[i+l])},fc.isEqualReversed=function(t,e){for(var r=0;r<t.length;r++){var n=t[r],i=e[t.length-r-1];if(0!==n.compareTo(i))return!1}return!0},fc.envelope=function(t){for(var e=new ku,r=0;r<t.length;r++)e.expandToInclude(t[r]);return e},fc.toCoordinateArray=function(t){return t.toArray(fc.coordArrayType)},fc.atLeastNCoordinatesOrNothing=function(t,e){return e.length>=t?e:[]},fc.indexOf=function(t,e){for(var r=0;r<e.length;r++)if(t.equals(e[r]))return r;return-1},fc.increasingDirection=function(t){for(var e=0;e<Math.trunc(t.length/2);e++){var r=t.length-1-e,n=t[e].compareTo(t[r]);if(0!==n)return n}return 1},fc.compare=function(t,e){for(var r=0;r<t.length&&r<e.length;){var n=t[r].compareTo(e[r]);if(0!==n)return n;r++}return r<e.length?-1:r<t.length?1:0},fc.minCoordinate=function(t){for(var e=null,r=0;r<t.length;r++)(null===e||e.compareTo(t[r])>0)&&(e=t[r]);return e},fc.extract=function(t,e,r){e=gu.clamp(e,0,t.length);var n=(r=gu.clamp(r,-1,t.length))-e+1;r<0&&(n=0),e>=t.length&&(n=0),r<e&&(n=0);var i=new Array(n).fill(null);if(0===n)return i;for(var o=0,s=e;s<=r;s++)i[o++]=t[s];return i},Object.defineProperties(fc,dc);var mc=function(){};mc.prototype.compare=function(t,e){return fc.compare(t,e)},mc.prototype.interfaces_=function(){return[au]},mc.prototype.getClass=function(){return mc};var gc=function(){};gc.prototype.compare=function(t,e){var r=t,n=e;if(r.length<n.length)return-1;if(r.length>n.length)return 1;if(0===r.length)return 0;var i=fc.compare(r,n);return fc.isEqualReversed(r,n)?0:i},gc.prototype.OLDcompare=function(t,e){var r=t,n=e;if(r.length<n.length)return-1;if(r.length>n.length)return 1;if(0===r.length)return 0;for(var i=fc.increasingDirection(r),o=fc.increasingDirection(n),s=i>0?0:r.length-1,a=o>0?0:r.length-1,l=0;l<r.length;l++){var u=r[s].compareTo(n[a]);if(0!==u)return u;s+=i,a+=o}return 0},gc.prototype.interfaces_=function(){return[au]},gc.prototype.getClass=function(){return gc};var yc=function(){};yc.prototype.get=function(){},yc.prototype.put=function(){},yc.prototype.size=function(){},yc.prototype.values=function(){},yc.prototype.entrySet=function(){};var _c=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(yc);function vc(t){this.message=t||""}function xc(){}vc.prototype=new Error,vc.prototype.name="OperationNotSupported",xc.prototype=new oc,xc.prototype.contains=function(){};var bc=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof oc&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.contains=function(t){for(var e=0,r=this.array_.length;e<r;e++)if(this.array_[e]===t)return!0;return!1},e.prototype.add=function(t){return!this.contains(t)&&(this.array_.push(t),!0)},e.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},e.prototype.remove=function(t){throw new Error},e.prototype.size=function(){return this.array_.length},e.prototype.isEmpty=function(){return 0===this.array_.length},e.prototype.toArray=function(){for(var t=[],e=0,r=this.array_.length;e<r;e++)t.push(this.array_[e]);return t},e.prototype.iterator=function(){return new wc(this)},e}(xc),wc=function(t){function e(e){t.call(this),this.hashSet_=e,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new uc;return this.hashSet_.array_[this.position_++]},e.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},e.prototype.remove=function(){throw new vc},e}(ac);function Ec(t){return null===t?0:t.color}function Sc(t){return null===t?null:t.parent}function Ic(t,e){null!==t&&(t.color=e)}function Tc(t){return null===t?null:t.left}function Cc(t){return null===t?null:t.right}function Mc(){this.root_=null,this.size_=0}Mc.prototype=new _c,Mc.prototype.get=function(t){for(var e=this.root_;null!==e;){var r=t.compareTo(e.key);if(r<0)e=e.left;else{if(!(r>0))return e.value;e=e.right}}return null},Mc.prototype.put=function(t,e){if(null===this.root_)return this.root_={key:t,value:e,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var r,n,i=this.root_;do{if(r=i,(n=t.compareTo(i.key))<0)i=i.left;else{if(!(n>0)){var o=i.value;return i.value=e,o}i=i.right}}while(null!==i);var s={key:t,left:null,right:null,value:e,parent:r,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return n<0?r.left=s:r.right=s,this.fixAfterInsertion(s),this.size_++,null},Mc.prototype.fixAfterInsertion=function(t){var e=this;for(t.color=1;null!=t&&t!==this.root_&&1===t.parent.color;)if(Sc(t)===Tc(Sc(Sc(t)))){var r=Cc(Sc(Sc(t)));1===Ec(r)?(Ic(Sc(t),0),Ic(r,0),Ic(Sc(Sc(t)),1),t=Sc(Sc(t))):(t===Cc(Sc(t))&&(t=Sc(t),e.rotateLeft(t)),Ic(Sc(t),0),Ic(Sc(Sc(t)),1),e.rotateRight(Sc(Sc(t))))}else{var n=Tc(Sc(Sc(t)));1===Ec(n)?(Ic(Sc(t),0),Ic(n,0),Ic(Sc(Sc(t)),1),t=Sc(Sc(t))):(t===Tc(Sc(t))&&(t=Sc(t),e.rotateRight(t)),Ic(Sc(t),0),Ic(Sc(Sc(t)),1),e.rotateLeft(Sc(Sc(t))))}this.root_.color=0},Mc.prototype.values=function(){var t=new cc,e=this.getFirstEntry();if(null!==e)for(t.add(e.value);null!==(e=Mc.successor(e));)t.add(e.value);return t},Mc.prototype.entrySet=function(){var t=new bc,e=this.getFirstEntry();if(null!==e)for(t.add(e);null!==(e=Mc.successor(e));)t.add(e);return t},Mc.prototype.rotateLeft=function(t){if(null!=t){var e=t.right;t.right=e.left,null!=e.left&&(e.left.parent=t),e.parent=t.parent,null===t.parent?this.root_=e:t.parent.left===t?t.parent.left=e:t.parent.right=e,e.left=t,t.parent=e}},Mc.prototype.rotateRight=function(t){if(null!=t){var e=t.left;t.left=e.right,null!=e.right&&(e.right.parent=t),e.parent=t.parent,null===t.parent?this.root_=e:t.parent.right===t?t.parent.right=e:t.parent.left=e,e.right=t,t.parent=e}},Mc.prototype.getFirstEntry=function(){var t=this.root_;if(null!=t)for(;null!=t.left;)t=t.left;return t},Mc.successor=function(t){if(null===t)return null;if(null!==t.right){for(var e=t.right;null!==e.left;)e=e.left;return e}for(var r=t.parent,n=t;null!==r&&n===r.right;)n=r,r=r.parent;return r},Mc.prototype.size=function(){return this.size_};var Ac=function(){};function Pc(){}function kc(){this.array_=[],arguments[0]instanceof oc&&this.addAll(arguments[0])}Ac.prototype.interfaces_=function(){return[]},Ac.prototype.getClass=function(){return Ac},Pc.prototype=new xc,kc.prototype=new Pc,kc.prototype.contains=function(t){for(var e=0,r=this.array_.length;e<r;e++)if(0===this.array_[e].compareTo(t))return!0;return!1},kc.prototype.add=function(t){if(this.contains(t))return!1;for(var e=0,r=this.array_.length;e<r;e++)if(1===this.array_[e].compareTo(t))return this.array_.splice(e,0,t),!0;return this.array_.push(t),!0},kc.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},kc.prototype.remove=function(t){throw new vc},kc.prototype.size=function(){return this.array_.length},kc.prototype.isEmpty=function(){return 0===this.array_.length},kc.prototype.toArray=function(){for(var t=[],e=0,r=this.array_.length;e<r;e++)t.push(this.array_[e]);return t},kc.prototype.iterator=function(){return new Lc(this)};var Lc=function(t){this.treeSet_=t,this.position_=0};Lc.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new uc;return this.treeSet_.array_[this.position_++]},Lc.prototype.hasNext=function(){return this.position_<this.treeSet_.size()},Lc.prototype.remove=function(){throw new vc};var zc=function(){};zc.sort=function(){var t,e,r,n,i=arguments[0];if(1===arguments.length)n=function(t,e){return t.compareTo(e)},i.sort(n);else if(2===arguments.length)r=arguments[1],n=function(t,e){return r.compare(t,e)},i.sort(n);else if(3===arguments.length){(e=i.slice(arguments[1],arguments[2])).sort();var o=i.slice(0,arguments[1]).concat(e,i.slice(arguments[2],i.length));for(i.splice(0,i.length),t=0;t<o.length;t++)i.push(o[t])}else if(4===arguments.length)for(e=i.slice(arguments[1],arguments[2]),r=arguments[3],n=function(t,e){return r.compare(t,e)},e.sort(n),o=i.slice(0,arguments[1]).concat(e,i.slice(arguments[2],i.length)),i.splice(0,i.length),t=0;t<o.length;t++)i.push(o[t])},zc.asList=function(t){for(var e=new cc,r=0,n=t.length;r<n;r++)e.add(t[r]);return e};var Dc=function(){},Rc={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};Rc.P.get=function(){return 0},Rc.L.get=function(){return 1},Rc.A.get=function(){return 2},Rc.FALSE.get=function(){return-1},Rc.TRUE.get=function(){return-2},Rc.DONTCARE.get=function(){return-3},Rc.SYM_FALSE.get=function(){return"F"},Rc.SYM_TRUE.get=function(){return"T"},Rc.SYM_DONTCARE.get=function(){return"*"},Rc.SYM_P.get=function(){return"0"},Rc.SYM_L.get=function(){return"1"},Rc.SYM_A.get=function(){return"2"},Dc.prototype.interfaces_=function(){return[]},Dc.prototype.getClass=function(){return Dc},Dc.toDimensionSymbol=function(t){switch(t){case Dc.FALSE:return Dc.SYM_FALSE;case Dc.TRUE:return Dc.SYM_TRUE;case Dc.DONTCARE:return Dc.SYM_DONTCARE;case Dc.P:return Dc.SYM_P;case Dc.L:return Dc.SYM_L;case Dc.A:return Dc.SYM_A}throw new ru("Unknown dimension value: "+t)},Dc.toDimensionValue=function(t){switch(xu.toUpperCase(t)){case Dc.SYM_FALSE:return Dc.FALSE;case Dc.SYM_TRUE:return Dc.TRUE;case Dc.SYM_DONTCARE:return Dc.DONTCARE;case Dc.SYM_P:return Dc.P;case Dc.SYM_L:return Dc.L;case Dc.SYM_A:return Dc.A}throw new ru("Unknown dimension symbol: "+t)},Object.defineProperties(Dc,Rc);var Oc=function(){};Oc.prototype.filter=function(t){},Oc.prototype.interfaces_=function(){return[]},Oc.prototype.getClass=function(){return Oc};var Nc=function(){};Nc.prototype.filter=function(t,e){},Nc.prototype.isDone=function(){},Nc.prototype.isGeometryChanged=function(){},Nc.prototype.interfaces_=function(){return[]},Nc.prototype.getClass=function(){return Nc};var Fc=function(t){function e(e,r){if(t.call(this,r),this._geometries=e||[],t.hasNullElements(this._geometries))throw new ru("geometries must not contain null elements")}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){for(var t=new ku,e=0;e<this._geometries.length;e++)t.expandToInclude(this._geometries[e].getEnvelopeInternal());return t},e.prototype.getGeometryN=function(t){return this._geometries[t]},e.prototype.getSortIndex=function(){return t.SORTINDEX_GEOMETRYCOLLECTION},e.prototype.getCoordinates=function(){for(var t=new Array(this.getNumPoints()).fill(null),e=-1,r=0;r<this._geometries.length;r++)for(var n=this._geometries[r].getCoordinates(),i=0;i<n.length;i++)t[++e]=n[i];return t},e.prototype.getArea=function(){for(var t=0,e=0;e<this._geometries.length;e++)t+=this._geometries[e].getArea();return t},e.prototype.equalsExact=function(){var e=this;if(2===arguments.length){var r=arguments[0],n=arguments[1];if(!this.isEquivalentClass(r))return!1;var i=r;if(this._geometries.length!==i._geometries.length)return!1;for(var o=0;o<this._geometries.length;o++)if(!e._geometries[o].equalsExact(i._geometries[o],n))return!1;return!0}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var t=0;t<this._geometries.length;t++)this._geometries[t].normalize();zc.sort(this._geometries)},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},e.prototype.getBoundaryDimension=function(){for(var t=Dc.FALSE,e=0;e<this._geometries.length;e++)t=Math.max(t,this._geometries[e].getBoundaryDimension());return t},e.prototype.getDimension=function(){for(var t=Dc.FALSE,e=0;e<this._geometries.length;e++)t=Math.max(t,this._geometries[e].getDimension());return t},e.prototype.getLength=function(){for(var t=0,e=0;e<this._geometries.length;e++)t+=this._geometries[e].getLength();return t},e.prototype.getNumPoints=function(){for(var t=0,e=0;e<this._geometries.length;e++)t+=this._geometries[e].getNumPoints();return t},e.prototype.getNumGeometries=function(){return this._geometries.length},e.prototype.reverse=function(){for(var t=this._geometries.length,e=new Array(t).fill(null),r=0;r<this._geometries.length;r++)e[r]=this._geometries[r].reverse();return this.getFactory().createGeometryCollection(e)},e.prototype.compareToSameClass=function(){var t=this;if(1===arguments.length){var e=arguments[0],r=new kc(zc.asList(this._geometries)),n=new kc(zc.asList(e._geometries));return this.compare(r,n)}if(2===arguments.length){for(var i=arguments[0],o=arguments[1],s=i,a=this.getNumGeometries(),l=s.getNumGeometries(),u=0;u<a&&u<l;){var c=t.getGeometryN(u),h=s.getGeometryN(u),p=c.compareToSameClass(h,o);if(0!==p)return p;u++}return u<a?1:u<l?-1:0}},e.prototype.apply=function(){var t=this;if(mu(arguments[0],Ku))for(var e=arguments[0],r=0;r<this._geometries.length;r++)t._geometries[r].apply(e);else if(mu(arguments[0],Nc)){var n=arguments[0];if(0===this._geometries.length)return null;for(var i=0;i<this._geometries.length&&(t._geometries[i].apply(n),!n.isDone());i++);n.isGeometryChanged()&&this.geometryChanged()}else if(mu(arguments[0],Oc)){var o=arguments[0];o.filter(this);for(var s=0;s<this._geometries.length;s++)t._geometries[s].apply(o)}else if(mu(arguments[0],Wu)){var a=arguments[0];a.filter(this);for(var l=0;l<this._geometries.length;l++)t._geometries[l].apply(a)}},e.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),ju.shouldNeverReachHere(),null},e.prototype.clone=function(){var e=t.prototype.clone.call(this);e._geometries=new Array(this._geometries.length).fill(null);for(var r=0;r<this._geometries.length;r++)e._geometries[r]=this._geometries[r].clone();return e},e.prototype.getGeometryType=function(){return"GeometryCollection"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),r=0;r<t.length;r++)t[r]=this._geometries[r].copy();return new e(t,this._factory)},e.prototype.isEmpty=function(){for(var t=0;t<this._geometries.length;t++)if(!this._geometries[t].isEmpty())return!1;return!0},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},r.serialVersionUID.get=function(){return-0x4f07bcb1f857d800},Object.defineProperties(e,r),e}(Yu),Bc=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return Yu.SORTINDEX_MULTILINESTRING},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],r=arguments[1];return!!this.isEquivalentClass(e)&&t.prototype.equalsExact.call(this,e,r)}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?Dc.FALSE:0},e.prototype.isClosed=function(){if(this.isEmpty())return!1;for(var t=0;t<this._geometries.length;t++)if(!this._geometries[t].isClosed())return!1;return!0},e.prototype.getDimension=function(){return 1},e.prototype.reverse=function(){for(var t=this._geometries.length,e=new Array(t).fill(null),r=0;r<this._geometries.length;r++)e[t-1-r]=this._geometries[r].reverse();return this.getFactory().createMultiLineString(e)},e.prototype.getBoundary=function(){return new jc(this).getBoundary()},e.prototype.getGeometryType=function(){return"MultiLineString"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),r=0;r<t.length;r++)t[r]=this._geometries[r].copy();return new e(t,this._factory)},e.prototype.interfaces_=function(){return[Ac]},e.prototype.getClass=function(){return e},r.serialVersionUID.get=function(){return 0x7155d2ab4afa8000},Object.defineProperties(e,r),e}(Fc),jc=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,1===arguments.length){var t=arguments[0],e=Qu.MOD2_BOUNDARY_RULE;this._geom=t,this._geomFact=t.getFactory(),this._bnRule=e}else if(2===arguments.length){var r=arguments[0],n=arguments[1];this._geom=r,this._geomFact=r.getFactory(),this._bnRule=n}};jc.prototype.boundaryMultiLineString=function(t){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var e=this.computeBoundaryCoordinates(t);return 1===e.length?this._geomFact.createPoint(e[0]):this._geomFact.createMultiPointFromCoords(e)},jc.prototype.getBoundary=function(){return this._geom instanceof Jc?this.boundaryLineString(this._geom):this._geom instanceof Bc?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()},jc.prototype.boundaryLineString=function(t){return this._geom.isEmpty()?this.getEmptyMultiPoint():t.isClosed()?this._bnRule.isInBoundary(2)?t.getStartPoint():this._geomFact.createMultiPoint():this._geomFact.createMultiPoint([t.getStartPoint(),t.getEndPoint()])},jc.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()},jc.prototype.computeBoundaryCoordinates=function(t){var e=this,r=new cc;this._endpointMap=new Mc;for(var n=0;n<t.getNumGeometries();n++){var i=t.getGeometryN(n);0!==i.getNumPoints()&&(e.addEndpoint(i.getCoordinateN(0)),e.addEndpoint(i.getCoordinateN(i.getNumPoints()-1)))}for(var o=this._endpointMap.entrySet().iterator();o.hasNext();){var s=o.next(),a=s.getValue().count;e._bnRule.isInBoundary(a)&&r.add(s.getKey())}return fc.toCoordinateArray(r)},jc.prototype.addEndpoint=function(t){var e=this._endpointMap.get(t);null===e&&(e=new Uc,this._endpointMap.put(t,e)),e.count++},jc.prototype.interfaces_=function(){return[]},jc.prototype.getClass=function(){return jc},jc.getBoundary=function(){if(1===arguments.length){var t=arguments[0],e=new jc(t);return e.getBoundary()}if(2===arguments.length){var r=arguments[0],n=arguments[1],i=new jc(r,n);return i.getBoundary()}};var Uc=function(){this.count=null};function Vc(){}function Gc(){}Uc.prototype.interfaces_=function(){return[]},Uc.prototype.getClass=function(){return Uc};var qc=function(){};function $c(){}function Zc(){}function Xc(){}var Wc=function(){},Yc={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};Wc.prototype.interfaces_=function(){return[]},Wc.prototype.getClass=function(){return Wc},Wc.chars=function(t,e){for(var r=new Array(e).fill(null),n=0;n<e;n++)r[n]=t;return String(r)},Wc.getStackTrace=function(){if(1===arguments.length){var t=arguments[0],e=new $c,r=new Vc(e);return t.printStackTrace(r),e.toString()}if(2===arguments.length){for(var n=arguments[0],i=arguments[1],o="",s=new Gc(Wc.getStackTrace(n)),a=new Xc(s),l=0;l<i;l++)try{o+=a.readLine()+Wc.NEWLINE}catch(t){if(!(t instanceof Zc))throw t;ju.shouldNeverReachHere()}return o}},Wc.split=function(t,e){for(var r=e.length,n=new cc,i=""+t,o=i.indexOf(e);o>=0;){var s=i.substring(0,o);n.add(s),o=(i=i.substring(o+r)).indexOf(e)}i.length>0&&n.add(i);for(var a=new Array(n.size()).fill(null),l=0;l<a.length;l++)a[l]=n.get(l);return a},Wc.toString=function(){if(1===arguments.length){var t=arguments[0];return Wc.SIMPLE_ORDINATE_FORMAT.format(t)}},Wc.spaces=function(t){return Wc.chars(" ",t)},Yc.NEWLINE.get=function(){return Au.getProperty("line.separator")},Yc.SIMPLE_ORDINATE_FORMAT.get=function(){return new qc("0.#")},Object.defineProperties(Wc,Yc);var Hc=function(){};Hc.prototype.interfaces_=function(){return[]},Hc.prototype.getClass=function(){return Hc},Hc.copyCoord=function(t,e,r,n){for(var i=Math.min(t.getDimension(),r.getDimension()),o=0;o<i;o++)r.setOrdinate(n,o,t.getOrdinate(e,o))},Hc.isRing=function(t){var e=t.size();return 0===e||!(e<=3)&&t.getOrdinate(0,Iu.X)===t.getOrdinate(e-1,Iu.X)&&t.getOrdinate(0,Iu.Y)===t.getOrdinate(e-1,Iu.Y)},Hc.isEqual=function(t,e){var r=t.size();if(r!==e.size())return!1;for(var n=Math.min(t.getDimension(),e.getDimension()),i=0;i<r;i++)for(var o=0;o<n;o++){var s=t.getOrdinate(i,o),a=e.getOrdinate(i,o);if(t.getOrdinate(i,o)!==e.getOrdinate(i,o)&&(!nu.isNaN(s)||!nu.isNaN(a)))return!1}return!0},Hc.extend=function(t,e,r){var n=t.create(r,e.getDimension()),i=e.size();if(Hc.copy(e,0,n,0,i),i>0)for(var o=i;o<r;o++)Hc.copy(e,i-1,n,o,1);return n},Hc.reverse=function(t){for(var e=t.size()-1,r=Math.trunc(e/2),n=0;n<=r;n++)Hc.swap(t,n,e-n)},Hc.swap=function(t,e,r){if(e===r)return null;for(var n=0;n<t.getDimension();n++){var i=t.getOrdinate(e,n);t.setOrdinate(e,n,t.getOrdinate(r,n)),t.setOrdinate(r,n,i)}},Hc.copy=function(t,e,r,n,i){for(var o=0;o<i;o++)Hc.copyCoord(t,e+o,r,n+o)},Hc.toString=function(){if(1===arguments.length){var t=arguments[0],e=t.size();if(0===e)return"()";var r=t.getDimension(),n=new _u;n.append("(");for(var i=0;i<e;i++){i>0&&n.append(" ");for(var o=0;o<r;o++)o>0&&n.append(","),n.append(Wc.toString(t.getOrdinate(i,o)))}return n.append(")"),n.toString()}},Hc.ensureValidRing=function(t,e){var r=e.size();return 0===r?e:r<=3?Hc.createClosedRing(t,e,4):e.getOrdinate(0,Iu.X)===e.getOrdinate(r-1,Iu.X)&&e.getOrdinate(0,Iu.Y)===e.getOrdinate(r-1,Iu.Y)?e:Hc.createClosedRing(t,e,r+1)},Hc.createClosedRing=function(t,e,r){var n=t.create(r,e.getDimension()),i=e.size();Hc.copy(e,0,n,0,i);for(var o=i;o<r;o++)Hc.copy(e,0,n,o,1);return n};var Jc=function(t){function e(e,r){t.call(this,r),this._points=null,this.init(e)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new ku:this._points.expandEnvelope(new ku)},e.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},e.prototype.getSortIndex=function(){return t.SORTINDEX_LINESTRING},e.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},e.prototype.equalsExact=function(){var e=this;if(2===arguments.length){var r=arguments[0],n=arguments[1];if(!this.isEquivalentClass(r))return!1;var i=r;if(this._points.size()!==i._points.size())return!1;for(var o=0;o<this._points.size();o++)if(!e.equal(e._points.getCoordinate(o),i._points.getCoordinate(o),n))return!1;return!0}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var t=this,e=0;e<Math.trunc(this._points.size()/2);e++){var r=t._points.size()-1-e;if(!t._points.getCoordinate(e).equals(t._points.getCoordinate(r)))return t._points.getCoordinate(e).compareTo(t._points.getCoordinate(r))>0&&Hc.reverse(t._points),null}},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?Dc.FALSE:0},e.prototype.isClosed=function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},e.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},e.prototype.getDimension=function(){return 1},e.prototype.getLength=function(){return Zu.computeLength(this._points)},e.prototype.getNumPoints=function(){return this._points.size()},e.prototype.reverse=function(){var t=this._points.copy();return Hc.reverse(t),this.getFactory().createLineString(t)},e.prototype.compareToSameClass=function(){var t=this;if(1===arguments.length){for(var e=arguments[0],r=e,n=0,i=0;n<this._points.size()&&i<r._points.size();){var o=t._points.getCoordinate(n).compareTo(r._points.getCoordinate(i));if(0!==o)return o;n++,i++}return n<this._points.size()?1:i<r._points.size()?-1:0}if(2===arguments.length){var s=arguments[0],a=arguments[1],l=s;return a.compare(this._points,l._points)}},e.prototype.apply=function(){var t=this;if(mu(arguments[0],Ku))for(var e=arguments[0],r=0;r<this._points.size();r++)e.filter(t._points.getCoordinate(r));else if(mu(arguments[0],Nc)){var n=arguments[0];if(0===this._points.size())return null;for(var i=0;i<this._points.size()&&(n.filter(t._points,i),!n.isDone());i++);n.isGeometryChanged()&&this.geometryChanged()}else if(mu(arguments[0],Oc)){var o=arguments[0];o.filter(this)}else if(mu(arguments[0],Wu)){var s=arguments[0];s.filter(this)}},e.prototype.getBoundary=function(){return new jc(this).getBoundary()},e.prototype.isEquivalentClass=function(t){return t instanceof e},e.prototype.clone=function(){var e=t.prototype.clone.call(this);return e._points=this._points.clone(),e},e.prototype.getCoordinateN=function(t){return this._points.getCoordinate(t)},e.prototype.getGeometryType=function(){return"LineString"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._points},e.prototype.isEmpty=function(){return 0===this._points.size()},e.prototype.init=function(t){if(null===t&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),1===t.size())throw new ru("Invalid number of points in LineString (found "+t.size()+" - must be 0 or >= 2)");this._points=t},e.prototype.isCoordinate=function(t){for(var e=0;e<this._points.size();e++)if(this._points.getCoordinate(e).equals(t))return!0;return!1},e.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},e.prototype.getPointN=function(t){return this.getFactory().createPoint(this._points.getCoordinate(t))},e.prototype.interfaces_=function(){return[Ac]},e.prototype.getClass=function(){return e},r.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(e,r),e}(Yu),Kc=function(){};Kc.prototype.interfaces_=function(){return[]},Kc.prototype.getClass=function(){return Kc};var Qc=function(t){function e(e,r){t.call(this,r),this._coordinates=e||null,this.init(this._coordinates)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new ku;var t=new ku;return t.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),t},e.prototype.getSortIndex=function(){return t.SORTINDEX_POINT},e.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],r=arguments[1];return!!this.isEquivalentClass(e)&&(!(!this.isEmpty()||!e.isEmpty())||this.isEmpty()===e.isEmpty()&&this.equal(e.getCoordinate(),this.getCoordinate(),r))}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){},e.prototype.getCoordinate=function(){return 0!==this._coordinates.size()?this._coordinates.getCoordinate(0):null},e.prototype.getBoundaryDimension=function(){return Dc.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getNumPoints=function(){return this.isEmpty()?0:1},e.prototype.reverse=function(){return this.copy()},e.prototype.getX=function(){if(null===this.getCoordinate())throw new Error("getX called on empty Point");return this.getCoordinate().x},e.prototype.compareToSameClass=function(){if(1===arguments.length){var t=arguments[0],e=t;return this.getCoordinate().compareTo(e.getCoordinate())}if(2===arguments.length){var r=arguments[0],n=arguments[1],i=r;return n.compare(this._coordinates,i._coordinates)}},e.prototype.apply=function(){if(mu(arguments[0],Ku)){var t=arguments[0];if(this.isEmpty())return null;t.filter(this.getCoordinate())}else if(mu(arguments[0],Nc)){var e=arguments[0];if(this.isEmpty())return null;e.filter(this._coordinates,0),e.isGeometryChanged()&&this.geometryChanged()}else if(mu(arguments[0],Oc)){var r=arguments[0];r.filter(this)}else if(mu(arguments[0],Wu)){var n=arguments[0];n.filter(this)}},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.clone=function(){var e=t.prototype.clone.call(this);return e._coordinates=this._coordinates.clone(),e},e.prototype.getGeometryType=function(){return"Point"},e.prototype.copy=function(){return new e(this._coordinates.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._coordinates},e.prototype.getY=function(){if(null===this.getCoordinate())throw new Error("getY called on empty Point");return this.getCoordinate().y},e.prototype.isEmpty=function(){return 0===this._coordinates.size()},e.prototype.init=function(t){null===t&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),ju.isTrue(t.size()<=1),this._coordinates=t},e.prototype.isSimple=function(){return!0},e.prototype.interfaces_=function(){return[Kc]},e.prototype.getClass=function(){return e},r.serialVersionUID.get=function(){return 0x44077bad161cbc00},Object.defineProperties(e,r),e}(Yu),th=function(){};th.prototype.interfaces_=function(){return[]},th.prototype.getClass=function(){return th};var eh=function(t){function e(e,r,n){if(t.call(this,n),this._shell=null,this._holes=null,null===e&&(e=this.getFactory().createLinearRing()),null===r&&(r=[]),t.hasNullElements(r))throw new ru("holes must not contain null elements");if(e.isEmpty()&&t.hasNonEmptyElements(r))throw new ru("shell is empty but holes are not");this._shell=e,this._holes=r}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},e.prototype.getSortIndex=function(){return t.SORTINDEX_POLYGON},e.prototype.getCoordinates=function(){if(this.isEmpty())return[];for(var t=new Array(this.getNumPoints()).fill(null),e=-1,r=this._shell.getCoordinates(),n=0;n<r.length;n++)t[++e]=r[n];for(var i=0;i<this._holes.length;i++)for(var o=this._holes[i].getCoordinates(),s=0;s<o.length;s++)t[++e]=o[s];return t},e.prototype.getArea=function(){var t=0;t+=Math.abs(Zu.signedArea(this._shell.getCoordinateSequence()));for(var e=0;e<this._holes.length;e++)t-=Math.abs(Zu.signedArea(this._holes[e].getCoordinateSequence()));return t},e.prototype.isRectangle=function(){if(0!==this.getNumInteriorRing())return!1;if(null===this._shell)return!1;if(5!==this._shell.getNumPoints())return!1;for(var t=this._shell.getCoordinateSequence(),e=this.getEnvelopeInternal(),r=0;r<5;r++){var n=t.getX(r);if(n!==e.getMinX()&&n!==e.getMaxX())return!1;var i=t.getY(r);if(i!==e.getMinY()&&i!==e.getMaxY())return!1}for(var o=t.getX(0),s=t.getY(0),a=1;a<=4;a++){var l=t.getX(a),u=t.getY(a);if(l!==o===(u!==s))return!1;o=l,s=u}return!0},e.prototype.equalsExact=function(){var e=this;if(2===arguments.length){var r=arguments[0],n=arguments[1];if(!this.isEquivalentClass(r))return!1;var i=r,o=this._shell,s=i._shell;if(!o.equalsExact(s,n))return!1;if(this._holes.length!==i._holes.length)return!1;for(var a=0;a<this._holes.length;a++)if(!e._holes[a].equalsExact(i._holes[a],n))return!1;return!0}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){var t=this;if(0===arguments.length){this.normalize(this._shell,!0);for(var e=0;e<this._holes.length;e++)t.normalize(t._holes[e],!1);zc.sort(this._holes)}else if(2===arguments.length){var r=arguments[0],n=arguments[1];if(r.isEmpty())return null;var i=new Array(r.getCoordinates().length-1).fill(null);Au.arraycopy(r.getCoordinates(),0,i,0,i.length);var o=fc.minCoordinate(r.getCoordinates());fc.scroll(i,o),Au.arraycopy(i,0,r.getCoordinates(),0,i.length),r.getCoordinates()[i.length]=i[0],Zu.isCCW(r.getCoordinates())===n&&fc.reverse(r.getCoordinates())}},e.prototype.getCoordinate=function(){return this._shell.getCoordinate()},e.prototype.getNumInteriorRing=function(){return this._holes.length},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.getLength=function(){var t=0;t+=this._shell.getLength();for(var e=0;e<this._holes.length;e++)t+=this._holes[e].getLength();return t},e.prototype.getNumPoints=function(){for(var t=this._shell.getNumPoints(),e=0;e<this._holes.length;e++)t+=this._holes[e].getNumPoints();return t},e.prototype.reverse=function(){var t=this.copy();t._shell=this._shell.copy().reverse(),t._holes=new Array(this._holes.length).fill(null);for(var e=0;e<this._holes.length;e++)t._holes[e]=this._holes[e].copy().reverse();return t},e.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},e.prototype.compareToSameClass=function(){var t=this;if(1===arguments.length){var e=arguments[0],r=this._shell,n=e._shell;return r.compareToSameClass(n)}if(2===arguments.length){var i=arguments[0],o=arguments[1],s=i,a=this._shell,l=s._shell,u=a.compareToSameClass(l,o);if(0!==u)return u;for(var c=this.getNumInteriorRing(),h=s.getNumInteriorRing(),p=0;p<c&&p<h;){var f=t.getInteriorRingN(p),d=s.getInteriorRingN(p),m=f.compareToSameClass(d,o);if(0!==m)return m;p++}return p<c?1:p<h?-1:0}},e.prototype.apply=function(t){var e=this;if(mu(t,Ku)){this._shell.apply(t);for(var r=0;r<this._holes.length;r++)e._holes[r].apply(t)}else if(mu(t,Nc)){if(this._shell.apply(t),!t.isDone())for(var n=0;n<this._holes.length&&(e._holes[n].apply(t),!t.isDone());n++);t.isGeometryChanged()&&this.geometryChanged()}else if(mu(t,Oc))t.filter(this);else if(mu(t,Wu)){t.filter(this),this._shell.apply(t);for(var i=0;i<this._holes.length;i++)e._holes[i].apply(t)}},e.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var t=new Array(this._holes.length+1).fill(null);t[0]=this._shell;for(var e=0;e<this._holes.length;e++)t[e+1]=this._holes[e];return t.length<=1?this.getFactory().createLinearRing(t[0].getCoordinateSequence()):this.getFactory().createMultiLineString(t)},e.prototype.clone=function(){var e=t.prototype.clone.call(this);e._shell=this._shell.clone(),e._holes=new Array(this._holes.length).fill(null);for(var r=0;r<this._holes.length;r++)e._holes[r]=this._holes[r].clone();return e},e.prototype.getGeometryType=function(){return"Polygon"},e.prototype.copy=function(){for(var t=this._shell.copy(),r=new Array(this._holes.length).fill(null),n=0;n<r.length;n++)r[n]=this._holes[n].copy();return new e(t,r,this._factory)},e.prototype.getExteriorRing=function(){return this._shell},e.prototype.isEmpty=function(){return this._shell.isEmpty()},e.prototype.getInteriorRingN=function(t){return this._holes[t]},e.prototype.interfaces_=function(){return[th]},e.prototype.getClass=function(){return e},r.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(e,r),e}(Yu),rh=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return Yu.SORTINDEX_MULTIPOINT},e.prototype.isValid=function(){return!0},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],r=arguments[1];return!!this.isEquivalentClass(e)&&t.prototype.equalsExact.call(this,e,r)}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getCoordinate=function(){if(1===arguments.length){var e=arguments[0];return this._geometries[e].getCoordinate()}return t.prototype.getCoordinate.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return Dc.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.getGeometryType=function(){return"MultiPoint"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),r=0;r<t.length;r++)t[r]=this._geometries[r].copy();return new e(t,this._factory)},e.prototype.interfaces_=function(){return[Kc]},e.prototype.getClass=function(){return e},r.serialVersionUID.get=function(){return-0x6fb1ed4162e0fc00},Object.defineProperties(e,r),e}(Fc),nh=function(t){function e(e,r){e instanceof uu&&r instanceof vh&&(e=r.getCoordinateSequenceFactory().create(e)),t.call(this,e,r),this.validateConstruction()}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return Yu.SORTINDEX_LINEARRING},e.prototype.getBoundaryDimension=function(){return Dc.FALSE},e.prototype.isClosed=function(){return!!this.isEmpty()||t.prototype.isClosed.call(this)},e.prototype.reverse=function(){var t=this._points.copy();return Hc.reverse(t),this.getFactory().createLinearRing(t)},e.prototype.validateConstruction=function(){if(!this.isEmpty()&&!t.prototype.isClosed.call(this))throw new ru("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<e.MINIMUM_VALID_SIZE)throw new ru("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},e.prototype.getGeometryType=function(){return"LinearRing"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},r.MINIMUM_VALID_SIZE.get=function(){return 4},r.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(e,r),e}(Jc),ih=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return Yu.SORTINDEX_MULTIPOLYGON},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],r=arguments[1];return!!this.isEquivalentClass(e)&&t.prototype.equalsExact.call(this,e,r)}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.reverse=function(){for(var t=this._geometries.length,e=new Array(t).fill(null),r=0;r<this._geometries.length;r++)e[r]=this._geometries[r].reverse();return this.getFactory().createMultiPolygon(e)},e.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var t=new cc,e=0;e<this._geometries.length;e++)for(var r=this._geometries[e].getBoundary(),n=0;n<r.getNumGeometries();n++)t.add(r.getGeometryN(n));var i=new Array(t.size()).fill(null);return this.getFactory().createMultiLineString(t.toArray(i))},e.prototype.getGeometryType=function(){return"MultiPolygon"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),r=0;r<t.length;r++)t[r]=this._geometries[r].copy();return new e(t,this._factory)},e.prototype.interfaces_=function(){return[th]},e.prototype.getClass=function(){return e},r.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(e,r),e}(Fc),oh=function(t){this._factory=t||null,this._isUserDataCopied=!1},sh={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};oh.prototype.setCopyUserData=function(t){this._isUserDataCopied=t},oh.prototype.edit=function(t,e){if(null===t)return null;var r=this.editInternal(t,e);return this._isUserDataCopied&&r.setUserData(t.getUserData()),r},oh.prototype.editInternal=function(t,e){return null===this._factory&&(this._factory=t.getFactory()),t instanceof Fc?this.editGeometryCollection(t,e):t instanceof eh?this.editPolygon(t,e):t instanceof Qc||t instanceof Jc?e.edit(t,this._factory):(ju.shouldNeverReachHere("Unsupported Geometry class: "+t.getClass().getName()),null)},oh.prototype.editGeometryCollection=function(t,e){for(var r=e.edit(t,this._factory),n=new cc,i=0;i<r.getNumGeometries();i++){var o=this.edit(r.getGeometryN(i),e);null===o||o.isEmpty()||n.add(o)}return r.getClass()===rh?this._factory.createMultiPoint(n.toArray([])):r.getClass()===Bc?this._factory.createMultiLineString(n.toArray([])):r.getClass()===ih?this._factory.createMultiPolygon(n.toArray([])):this._factory.createGeometryCollection(n.toArray([]))},oh.prototype.editPolygon=function(t,e){var r=e.edit(t,this._factory);if(null===r&&(r=this._factory.createPolygon(null)),r.isEmpty())return r;var n=this.edit(r.getExteriorRing(),e);if(null===n||n.isEmpty())return this._factory.createPolygon();for(var i=new cc,o=0;o<r.getNumInteriorRing();o++){var s=this.edit(r.getInteriorRingN(o),e);null===s||s.isEmpty()||i.add(s)}return this._factory.createPolygon(n,i.toArray([]))},oh.prototype.interfaces_=function(){return[]},oh.prototype.getClass=function(){return oh},oh.GeometryEditorOperation=function(){},sh.NoOpGeometryOperation.get=function(){return ah},sh.CoordinateOperation.get=function(){return lh},sh.CoordinateSequenceOperation.get=function(){return uh},Object.defineProperties(oh,sh);var ah=function(){};ah.prototype.edit=function(t,e){return t},ah.prototype.interfaces_=function(){return[oh.GeometryEditorOperation]},ah.prototype.getClass=function(){return ah};var lh=function(){};lh.prototype.edit=function(t,e){var r=this.editCoordinates(t.getCoordinates(),t);return null===r?t:t instanceof nh?e.createLinearRing(r):t instanceof Jc?e.createLineString(r):t instanceof Qc?r.length>0?e.createPoint(r[0]):e.createPoint():t},lh.prototype.interfaces_=function(){return[oh.GeometryEditorOperation]},lh.prototype.getClass=function(){return lh};var uh=function(){};uh.prototype.edit=function(t,e){return t instanceof nh?e.createLinearRing(this.edit(t.getCoordinateSequence(),t)):t instanceof Jc?e.createLineString(this.edit(t.getCoordinateSequence(),t)):t instanceof Qc?e.createPoint(this.edit(t.getCoordinateSequence(),t)):t},uh.prototype.interfaces_=function(){return[oh.GeometryEditorOperation]},uh.prototype.getClass=function(){return uh};var ch=function(){var t=this;if(this._dimension=3,this._coordinates=null,1===arguments.length){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var e=arguments[0];this._coordinates=new Array(e).fill(null);for(var r=0;r<e;r++)t._coordinates[r]=new uu}else if(mu(arguments[0],Iu)){var n=arguments[0];if(null===n)return this._coordinates=new Array(0).fill(null),null;this._dimension=n.getDimension(),this._coordinates=new Array(n.size()).fill(null);for(var i=0;i<this._coordinates.length;i++)t._coordinates[i]=n.getCoordinateCopy(i)}}else if(2===arguments.length)if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var o=arguments[0],s=arguments[1];this._coordinates=o,this._dimension=s,null===o&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var a=arguments[0],l=arguments[1];this._coordinates=new Array(a).fill(null),this._dimension=l;for(var u=0;u<a;u++)t._coordinates[u]=new uu}},hh={serialVersionUID:{configurable:!0}};ch.prototype.setOrdinate=function(t,e,r){switch(e){case Iu.X:this._coordinates[t].x=r;break;case Iu.Y:this._coordinates[t].y=r;break;case Iu.Z:this._coordinates[t].z=r;break;default:throw new ru("invalid ordinateIndex")}},ch.prototype.size=function(){return this._coordinates.length},ch.prototype.getOrdinate=function(t,e){switch(e){case Iu.X:return this._coordinates[t].x;case Iu.Y:return this._coordinates[t].y;case Iu.Z:return this._coordinates[t].z}return nu.NaN},ch.prototype.getCoordinate=function(){if(1===arguments.length){var t=arguments[0];return this._coordinates[t]}if(2===arguments.length){var e=arguments[0],r=arguments[1];r.x=this._coordinates[e].x,r.y=this._coordinates[e].y,r.z=this._coordinates[e].z}},ch.prototype.getCoordinateCopy=function(t){return new uu(this._coordinates[t])},ch.prototype.getDimension=function(){return this._dimension},ch.prototype.getX=function(t){return this._coordinates[t].x},ch.prototype.clone=function(){for(var t=new Array(this.size()).fill(null),e=0;e<this._coordinates.length;e++)t[e]=this._coordinates[e].clone();return new ch(t,this._dimension)},ch.prototype.expandEnvelope=function(t){for(var e=0;e<this._coordinates.length;e++)t.expandToInclude(this._coordinates[e]);return t},ch.prototype.copy=function(){for(var t=new Array(this.size()).fill(null),e=0;e<this._coordinates.length;e++)t[e]=this._coordinates[e].copy();return new ch(t,this._dimension)},ch.prototype.toString=function(){if(this._coordinates.length>0){var t=new _u(17*this._coordinates.length);t.append("("),t.append(this._coordinates[0]);for(var e=1;e<this._coordinates.length;e++)t.append(", "),t.append(this._coordinates[e]);return t.append(")"),t.toString()}return"()"},ch.prototype.getY=function(t){return this._coordinates[t].y},ch.prototype.toCoordinateArray=function(){return this._coordinates},ch.prototype.interfaces_=function(){return[Iu,lu]},ch.prototype.getClass=function(){return ch},hh.serialVersionUID.get=function(){return-0xcb44a778db18e00},Object.defineProperties(ch,hh);var ph=function(){},fh={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};ph.prototype.readResolve=function(){return ph.instance()},ph.prototype.create=function(){if(1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];return new ch(t)}if(mu(arguments[0],Iu)){var e=arguments[0];return new ch(e)}}else if(2===arguments.length){var r=arguments[0],n=arguments[1];return n>3&&(n=3),n<2?new ch(r):new ch(r,n)}},ph.prototype.interfaces_=function(){return[pu,lu]},ph.prototype.getClass=function(){return ph},ph.instance=function(){return ph.instanceObject},fh.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00},fh.instanceObject.get=function(){return new ph},Object.defineProperties(ph,fh);var dh=function(t){function e(){t.call(this),this.map_=new Map}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return this.map_.get(t)||null},e.prototype.put=function(t,e){return this.map_.set(t,e),e},e.prototype.values=function(){for(var t=new cc,e=this.map_.values(),r=e.next();!r.done;)t.add(r.value),r=e.next();return t},e.prototype.entrySet=function(){var t=new bc;return this.map_.entries().forEach(function(e){return t.add(e)}),t},e.prototype.size=function(){return this.map_.size()},e}(yc),mh=function t(){if(this._modelType=null,this._scale=null,0===arguments.length)this._modelType=t.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof yh){var e=arguments[0];this._modelType=e,e===t.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){var r=arguments[0];this._modelType=t.FIXED,this.setScale(r)}else if(arguments[0]instanceof t){var n=arguments[0];this._modelType=n._modelType,this._scale=n._scale}},gh={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};mh.prototype.equals=function(t){if(!(t instanceof mh))return!1;var e=t;return this._modelType===e._modelType&&this._scale===e._scale},mh.prototype.compareTo=function(t){var e=t,r=this.getMaximumSignificantDigits(),n=e.getMaximumSignificantDigits();return new vu(r).compareTo(new vu(n))},mh.prototype.getScale=function(){return this._scale},mh.prototype.isFloating=function(){return this._modelType===mh.FLOATING||this._modelType===mh.FLOATING_SINGLE},mh.prototype.getType=function(){return this._modelType},mh.prototype.toString=function(){var t="UNKNOWN";return this._modelType===mh.FLOATING?t="Floating":this._modelType===mh.FLOATING_SINGLE?t="Floating-Single":this._modelType===mh.FIXED&&(t="Fixed (Scale="+this.getScale()+")"),t},mh.prototype.makePrecise=function(){if("number"==typeof arguments[0]){var t=arguments[0];return nu.isNaN(t)?t:this._modelType===mh.FLOATING_SINGLE?t:this._modelType===mh.FIXED?Math.round(t*this._scale)/this._scale:t}if(arguments[0]instanceof uu){var e=arguments[0];if(this._modelType===mh.FLOATING)return null;e.x=this.makePrecise(e.x),e.y=this.makePrecise(e.y)}},mh.prototype.getMaximumSignificantDigits=function(){var t=16;return this._modelType===mh.FLOATING?t=16:this._modelType===mh.FLOATING_SINGLE?t=6:this._modelType===mh.FIXED&&(t=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),t},mh.prototype.setScale=function(t){this._scale=Math.abs(t)},mh.prototype.interfaces_=function(){return[lu,ou]},mh.prototype.getClass=function(){return mh},mh.mostPrecise=function(t,e){return t.compareTo(e)>=0?t:e},gh.serialVersionUID.get=function(){return 0x6bee6404e9a25c00},gh.maximumPreciseValue.get=function(){return 9007199254740992},Object.defineProperties(mh,gh);var yh=function t(e){this._name=e||null,t.nameToTypeMap.put(e,this)},_h={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};yh.prototype.readResolve=function(){return yh.nameToTypeMap.get(this._name)},yh.prototype.toString=function(){return this._name},yh.prototype.interfaces_=function(){return[lu]},yh.prototype.getClass=function(){return yh},_h.serialVersionUID.get=function(){return-552860263173159e4},_h.nameToTypeMap.get=function(){return new dh},Object.defineProperties(yh,_h),mh.Type=yh,mh.FIXED=new yh("FIXED"),mh.FLOATING=new yh("FLOATING"),mh.FLOATING_SINGLE=new yh("FLOATING SINGLE");var vh=function t(){this._precisionModel=new mh,this._SRID=0,this._coordinateSequenceFactory=t.getDefaultCoordinateSequenceFactory(),0===arguments.length||(1===arguments.length?mu(arguments[0],pu)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof mh&&(this._precisionModel=arguments[0]):2===arguments.length?(this._precisionModel=arguments[0],this._SRID=arguments[1]):3===arguments.length&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},xh={serialVersionUID:{configurable:!0}};vh.prototype.toGeometry=function(t){return t.isNull()?this.createPoint(null):t.getMinX()===t.getMaxX()&&t.getMinY()===t.getMaxY()?this.createPoint(new uu(t.getMinX(),t.getMinY())):t.getMinX()===t.getMaxX()||t.getMinY()===t.getMaxY()?this.createLineString([new uu(t.getMinX(),t.getMinY()),new uu(t.getMaxX(),t.getMaxY())]):this.createPolygon(this.createLinearRing([new uu(t.getMinX(),t.getMinY()),new uu(t.getMinX(),t.getMaxY()),new uu(t.getMaxX(),t.getMaxY()),new uu(t.getMaxX(),t.getMinY()),new uu(t.getMinX(),t.getMinY())]),null)},vh.prototype.createLineString=function(t){return t?t instanceof Array?new Jc(this.getCoordinateSequenceFactory().create(t),this):mu(t,Iu)?new Jc(t,this):void 0:new Jc(this.getCoordinateSequenceFactory().create([]),this)},vh.prototype.createMultiLineString=function(){if(0===arguments.length)return new Bc(null,this);if(1===arguments.length){var t=arguments[0];return new Bc(t,this)}},vh.prototype.buildGeometry=function(t){for(var e=null,r=!1,n=!1,i=t.iterator();i.hasNext();){var o=i.next(),s=o.getClass();null===e&&(e=s),s!==e&&(r=!0),o.isGeometryCollectionOrDerived()&&(n=!0)}if(null===e)return this.createGeometryCollection();if(r||n)return this.createGeometryCollection(vh.toGeometryArray(t));var a=t.iterator().next();if(t.size()>1){if(a instanceof eh)return this.createMultiPolygon(vh.toPolygonArray(t));if(a instanceof Jc)return this.createMultiLineString(vh.toLineStringArray(t));if(a instanceof Qc)return this.createMultiPoint(vh.toPointArray(t));ju.shouldNeverReachHere("Unhandled class: "+a.getClass().getName())}return a},vh.prototype.createMultiPointFromCoords=function(t){return this.createMultiPoint(null!==t?this.getCoordinateSequenceFactory().create(t):null)},vh.prototype.createPoint=function(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof uu){var t=arguments[0];return this.createPoint(null!==t?this.getCoordinateSequenceFactory().create([t]):null)}if(mu(arguments[0],Iu)){var e=arguments[0];return new Qc(e,this)}}},vh.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory},vh.prototype.createPolygon=function(){if(0===arguments.length)return new eh(null,null,this);if(1===arguments.length){if(mu(arguments[0],Iu)){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}if(arguments[0]instanceof Array){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}if(arguments[0]instanceof nh){var r=arguments[0];return this.createPolygon(r,null)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];return new eh(n,i,this)}},vh.prototype.getSRID=function(){return this._SRID},vh.prototype.createGeometryCollection=function(){if(0===arguments.length)return new Fc(null,this);if(1===arguments.length){var t=arguments[0];return new Fc(t,this)}},vh.prototype.createGeometry=function(t){return new oh(this).edit(t,{edit:function(){if(2===arguments.length){var t=arguments[0];return this._coordinateSequenceFactory.create(t)}}})},vh.prototype.getPrecisionModel=function(){return this._precisionModel},vh.prototype.createLinearRing=function(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];return this.createLinearRing(null!==t?this.getCoordinateSequenceFactory().create(t):null)}if(mu(arguments[0],Iu)){var e=arguments[0];return new nh(e,this)}}},vh.prototype.createMultiPolygon=function(){if(0===arguments.length)return new ih(null,this);if(1===arguments.length){var t=arguments[0];return new ih(t,this)}},vh.prototype.createMultiPoint=function(){var t=this;if(0===arguments.length)return new rh(null,this);if(1===arguments.length){if(arguments[0]instanceof Array){var e=arguments[0];return new rh(e,this)}if(arguments[0]instanceof Array){var r=arguments[0];return this.createMultiPoint(null!==r?this.getCoordinateSequenceFactory().create(r):null)}if(mu(arguments[0],Iu)){var n=arguments[0];if(null===n)return this.createMultiPoint(new Array(0).fill(null));for(var i=new Array(n.size()).fill(null),o=0;o<n.size();o++){var s=t.getCoordinateSequenceFactory().create(1,n.getDimension());Hc.copy(n,o,s,0,1),i[o]=t.createPoint(s)}return this.createMultiPoint(i)}}},vh.prototype.interfaces_=function(){return[lu]},vh.prototype.getClass=function(){return vh},vh.toMultiPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},vh.toGeometryArray=function(t){if(null===t)return null;var e=new Array(t.size()).fill(null);return t.toArray(e)},vh.getDefaultCoordinateSequenceFactory=function(){return ph.instance()},vh.toMultiLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},vh.toLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},vh.toMultiPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},vh.toLinearRingArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},vh.toPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},vh.toPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},vh.createPointFromInternalCoord=function(t,e){return e.getPrecisionModel().makePrecise(t),e.getFactory().createPoint(t)},xh.serialVersionUID.get=function(){return-0x5ea75f2051eeb400},Object.defineProperties(vh,xh);var bh=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],wh=function(t){this.geometryFactory=t||new vh};wh.prototype.read=function(t){var e,r=(e="string"==typeof t?JSON.parse(t):t).type;if(!Eh[r])throw new Error("Unknown GeoJSON type: "+e.type);return-1!==bh.indexOf(r)?Eh[r].apply(this,[e.coordinates]):"GeometryCollection"===r?Eh[r].apply(this,[e.geometries]):Eh[r].apply(this,[e])},wh.prototype.write=function(t){var e=t.getGeometryType();if(!Sh[e])throw new Error("Geometry is not supported");return Sh[e].apply(this,[t])};var Eh={Feature:function(t){var e={};for(var r in t)e[r]=t[r];if(t.geometry){var n=t.geometry.type;if(!Eh[n])throw new Error("Unknown GeoJSON type: "+t.type);e.geometry=this.read(t.geometry)}return t.bbox&&(e.bbox=Eh.bbox.apply(this,[t.bbox])),e},FeatureCollection:function(t){var e={};if(t.features){e.features=[];for(var r=0;r<t.features.length;++r)e.features.push(this.read(t.features[r]))}return t.bbox&&(e.bbox=this.parse.bbox.apply(this,[t.bbox])),e},coordinates:function(t){for(var e=[],r=0;r<t.length;++r){var n=t[r];e.push(new uu(n[0],n[1]))}return e},bbox:function(t){return this.geometryFactory.createLinearRing([new uu(t[0],t[1]),new uu(t[2],t[1]),new uu(t[2],t[3]),new uu(t[0],t[3]),new uu(t[0],t[1])])},Point:function(t){var e=new uu(t[0],t[1]);return this.geometryFactory.createPoint(e)},MultiPoint:function(t){for(var e=[],r=0;r<t.length;++r)e.push(Eh.Point.apply(this,[t[r]]));return this.geometryFactory.createMultiPoint(e)},LineString:function(t){var e=Eh.coordinates.apply(this,[t]);return this.geometryFactory.createLineString(e)},MultiLineString:function(t){for(var e=[],r=0;r<t.length;++r)e.push(Eh.LineString.apply(this,[t[r]]));return this.geometryFactory.createMultiLineString(e)},Polygon:function(t){for(var e=Eh.coordinates.apply(this,[t[0]]),r=this.geometryFactory.createLinearRing(e),n=[],i=1;i<t.length;++i){var o=t[i],s=Eh.coordinates.apply(this,[o]),a=this.geometryFactory.createLinearRing(s);n.push(a)}return this.geometryFactory.createPolygon(r,n)},MultiPolygon:function(t){for(var e=[],r=0;r<t.length;++r){var n=t[r];e.push(Eh.Polygon.apply(this,[n]))}return this.geometryFactory.createMultiPolygon(e)},GeometryCollection:function(t){for(var e=[],r=0;r<t.length;++r){var n=t[r];e.push(this.read(n))}return this.geometryFactory.createGeometryCollection(e)}},Sh={coordinate:function(t){return[t.x,t.y]},Point:function(t){return{type:"Point",coordinates:Sh.coordinate.apply(this,[t.getCoordinate()])}},MultiPoint:function(t){for(var e=[],r=0;r<t._geometries.length;++r){var n=t._geometries[r],i=Sh.Point.apply(this,[n]);e.push(i.coordinates)}return{type:"MultiPoint",coordinates:e}},LineString:function(t){for(var e=[],r=t.getCoordinates(),n=0;n<r.length;++n){var i=r[n];e.push(Sh.coordinate.apply(this,[i]))}return{type:"LineString",coordinates:e}},MultiLineString:function(t){for(var e=[],r=0;r<t._geometries.length;++r){var n=t._geometries[r],i=Sh.LineString.apply(this,[n]);e.push(i.coordinates)}return{type:"MultiLineString",coordinates:e}},Polygon:function(t){var e=[],r=Sh.LineString.apply(this,[t._shell]);e.push(r.coordinates);for(var n=0;n<t._holes.length;++n){var i=t._holes[n],o=Sh.LineString.apply(this,[i]);e.push(o.coordinates)}return{type:"Polygon",coordinates:e}},MultiPolygon:function(t){for(var e=[],r=0;r<t._geometries.length;++r){var n=t._geometries[r],i=Sh.Polygon.apply(this,[n]);e.push(i.coordinates)}return{type:"MultiPolygon",coordinates:e}},GeometryCollection:function(t){for(var e=[],r=0;r<t._geometries.length;++r){var n=t._geometries[r],i=n.getGeometryType();e.push(Sh[i].apply(this,[n]))}return{type:"GeometryCollection",geometries:e}}},Ih=function(t){this.geometryFactory=t||new vh,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new wh(this.geometryFactory)};Ih.prototype.read=function(t){var e=this.parser.read(t);return this.precisionModel.getType()===mh.FIXED&&this.reducePrecision(e),e},Ih.prototype.reducePrecision=function(t){var e,r;if(t.coordinate)this.precisionModel.makePrecise(t.coordinate);else if(t.points)for(e=0,r=t.points.length;e<r;e++)this.precisionModel.makePrecise(t.points[e]);else if(t.geometries)for(e=0,r=t.geometries.length;e<r;e++)this.reducePrecision(t.geometries[e])};var Th=function(){this.parser=new wh(this.geometryFactory)};Th.prototype.write=function(t){return this.parser.write(t)};var Ch=function(){},Mh={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};function Ah(t){this.message=t||""}function Ph(){this.array_=[]}Ch.prototype.interfaces_=function(){return[]},Ch.prototype.getClass=function(){return Ch},Ch.opposite=function(t){return t===Ch.LEFT?Ch.RIGHT:t===Ch.RIGHT?Ch.LEFT:t},Mh.ON.get=function(){return 0},Mh.LEFT.get=function(){return 1},Mh.RIGHT.get=function(){return 2},Object.defineProperties(Ch,Mh),Ah.prototype=new Error,Ah.prototype.name="EmptyStackException",Ph.prototype=new lc,Ph.prototype.add=function(t){return this.array_.push(t),!0},Ph.prototype.get=function(t){if(t<0||t>=this.size())throw new Error;return this.array_[t]},Ph.prototype.push=function(t){return this.array_.push(t),t},Ph.prototype.pop=function(t){if(0===this.array_.length)throw new Ah;return this.array_.pop()},Ph.prototype.peek=function(){if(0===this.array_.length)throw new Ah;return this.array_[this.array_.length-1]},Ph.prototype.empty=function(){return 0===this.array_.length},Ph.prototype.isEmpty=function(){return this.empty()},Ph.prototype.search=function(t){return this.array_.indexOf(t)},Ph.prototype.size=function(){return this.array_.length},Ph.prototype.toArray=function(){for(var t=[],e=0,r=this.array_.length;e<r;e++)t.push(this.array_[e]);return t};var kh=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};kh.prototype.getCoordinate=function(){return this._minCoord},kh.prototype.getRightmostSide=function(t,e){var r=this.getRightmostSideOfSegment(t,e);return r<0&&(r=this.getRightmostSideOfSegment(t,e-1)),r<0&&(this._minCoord=null,this.checkForRightmostCoordinate(t)),r},kh.prototype.findRightmostEdgeAtVertex=function(){var t=this._minDe.getEdge().getCoordinates();ju.isTrue(this._minIndex>0&&this._minIndex<t.length,"rightmost point expected to be interior vertex of edge");var e=t[this._minIndex-1],r=t[this._minIndex+1],n=Zu.computeOrientation(this._minCoord,r,e),i=!1;(e.y<this._minCoord.y&&r.y<this._minCoord.y&&n===Zu.COUNTERCLOCKWISE||e.y>this._minCoord.y&&r.y>this._minCoord.y&&n===Zu.CLOCKWISE)&&(i=!0),i&&(this._minIndex=this._minIndex-1)},kh.prototype.getRightmostSideOfSegment=function(t,e){var r=t.getEdge().getCoordinates();if(e<0||e+1>=r.length)return-1;if(r[e].y===r[e+1].y)return-1;var n=Ch.LEFT;return r[e].y<r[e+1].y&&(n=Ch.RIGHT),n},kh.prototype.getEdge=function(){return this._orientedDe},kh.prototype.checkForRightmostCoordinate=function(t){for(var e=this,r=t.getEdge().getCoordinates(),n=0;n<r.length-1;n++)(null===e._minCoord||r[n].x>e._minCoord.x)&&(e._minDe=t,e._minIndex=n,e._minCoord=r[n])},kh.prototype.findRightmostEdgeAtNode=function(){var t=this._minDe.getNode().getEdges();this._minDe=t.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)},kh.prototype.findEdge=function(t){for(var e=t.iterator();e.hasNext();){var r=e.next();r.isForward()&&this.checkForRightmostCoordinate(r)}ju.isTrue(0!==this._minIndex||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),0===this._minIndex?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===Ch.LEFT&&(this._orientedDe=this._minDe.getSym())},kh.prototype.interfaces_=function(){return[]},kh.prototype.getClass=function(){return kh};var Lh=function(t){function e(r,n){t.call(this,e.msgWithCoord(r,n)),this.pt=n?new uu(n):null,this.name="TopologyException"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCoordinate=function(){return this.pt},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.msgWithCoord=function(t,e){return e?t:t+" [ "+e+" ]"},e}(Fu),zh=function(){this.array_=[]};zh.prototype.addLast=function(t){this.array_.push(t)},zh.prototype.removeFirst=function(){return this.array_.shift()},zh.prototype.isEmpty=function(){return 0===this.array_.length};var Dh=function(){this._finder=null,this._dirEdgeList=new cc,this._nodes=new cc,this._rightMostCoord=null,this._env=null,this._finder=new kh};Dh.prototype.clearVisitedEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();)t.next().setVisited(!1)},Dh.prototype.getRightmostCoordinate=function(){return this._rightMostCoord},Dh.prototype.computeNodeDepth=function(t){for(var e=null,r=t.getEdges().iterator();r.hasNext();){var n=r.next();if(n.isVisited()||n.getSym().isVisited()){e=n;break}}if(null===e)throw new Lh("unable to find edge to compute depths at "+t.getCoordinate());t.getEdges().computeDepths(e);for(var i=t.getEdges().iterator();i.hasNext();){var o=i.next();o.setVisited(!0),this.copySymDepths(o)}},Dh.prototype.computeDepth=function(t){this.clearVisitedEdges();var e=this._finder.getEdge();e.setEdgeDepths(Ch.RIGHT,t),this.copySymDepths(e),this.computeDepths(e)},Dh.prototype.create=function(t){this.addReachable(t),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()},Dh.prototype.findResultEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();){var e=t.next();e.getDepth(Ch.RIGHT)>=1&&e.getDepth(Ch.LEFT)<=0&&!e.isInteriorAreaEdge()&&e.setInResult(!0)}},Dh.prototype.computeDepths=function(t){var e=new bc,r=new zh,n=t.getNode();for(r.addLast(n),e.add(n),t.setVisited(!0);!r.isEmpty();){var i=r.removeFirst();e.add(i),this.computeNodeDepth(i);for(var o=i.getEdges().iterator();o.hasNext();){var s=o.next().getSym();if(!s.isVisited()){var a=s.getNode();e.contains(a)||(r.addLast(a),e.add(a))}}}},Dh.prototype.compareTo=function(t){var e=t;return this._rightMostCoord.x<e._rightMostCoord.x?-1:this._rightMostCoord.x>e._rightMostCoord.x?1:0},Dh.prototype.getEnvelope=function(){if(null===this._env){for(var t=new ku,e=this._dirEdgeList.iterator();e.hasNext();)for(var r=e.next().getEdge().getCoordinates(),n=0;n<r.length-1;n++)t.expandToInclude(r[n]);this._env=t}return this._env},Dh.prototype.addReachable=function(t){var e=new Ph;for(e.add(t);!e.empty();){var r=e.pop();this.add(r,e)}},Dh.prototype.copySymDepths=function(t){var e=t.getSym();e.setDepth(Ch.LEFT,t.getDepth(Ch.RIGHT)),e.setDepth(Ch.RIGHT,t.getDepth(Ch.LEFT))},Dh.prototype.add=function(t,e){t.setVisited(!0),this._nodes.add(t);for(var r=t.getEdges().iterator();r.hasNext();){var n=r.next();this._dirEdgeList.add(n);var i=n.getSym().getNode();i.isVisited()||e.push(i)}},Dh.prototype.getNodes=function(){return this._nodes},Dh.prototype.getDirectedEdges=function(){return this._dirEdgeList},Dh.prototype.interfaces_=function(){return[ou]},Dh.prototype.getClass=function(){return Dh};var Rh=function t(){var e=this;if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array){var r=arguments[0];this.init(r.length)}else if(Number.isInteger(arguments[0])){var n=arguments[0];this.init(1),this.location[Ch.ON]=n}else if(arguments[0]instanceof t){var i=arguments[0];if(this.init(i.location.length),null!==i)for(var o=0;o<this.location.length;o++)e.location[o]=i.location[o]}}else if(3===arguments.length){var s=arguments[0],a=arguments[1],l=arguments[2];this.init(3),this.location[Ch.ON]=s,this.location[Ch.LEFT]=a,this.location[Ch.RIGHT]=l}};Rh.prototype.setAllLocations=function(t){for(var e=0;e<this.location.length;e++)this.location[e]=t},Rh.prototype.isNull=function(){for(var t=0;t<this.location.length;t++)if(this.location[t]!==fu.NONE)return!1;return!0},Rh.prototype.setAllLocationsIfNull=function(t){for(var e=0;e<this.location.length;e++)this.location[e]===fu.NONE&&(this.location[e]=t)},Rh.prototype.isLine=function(){return 1===this.location.length},Rh.prototype.merge=function(t){if(t.location.length>this.location.length){var e=new Array(3).fill(null);e[Ch.ON]=this.location[Ch.ON],e[Ch.LEFT]=fu.NONE,e[Ch.RIGHT]=fu.NONE,this.location=e}for(var r=0;r<this.location.length;r++)this.location[r]===fu.NONE&&r<t.location.length&&(this.location[r]=t.location[r])},Rh.prototype.getLocations=function(){return this.location},Rh.prototype.flip=function(){if(this.location.length<=1)return null;var t=this.location[Ch.LEFT];this.location[Ch.LEFT]=this.location[Ch.RIGHT],this.location[Ch.RIGHT]=t},Rh.prototype.toString=function(){var t=new _u;return this.location.length>1&&t.append(fu.toLocationSymbol(this.location[Ch.LEFT])),t.append(fu.toLocationSymbol(this.location[Ch.ON])),this.location.length>1&&t.append(fu.toLocationSymbol(this.location[Ch.RIGHT])),t.toString()},Rh.prototype.setLocations=function(t,e,r){this.location[Ch.ON]=t,this.location[Ch.LEFT]=e,this.location[Ch.RIGHT]=r},Rh.prototype.get=function(t){return t<this.location.length?this.location[t]:fu.NONE},Rh.prototype.isArea=function(){return this.location.length>1},Rh.prototype.isAnyNull=function(){for(var t=0;t<this.location.length;t++)if(this.location[t]===fu.NONE)return!0;return!1},Rh.prototype.setLocation=function(){if(1===arguments.length){var t=arguments[0];this.setLocation(Ch.ON,t)}else if(2===arguments.length){var e=arguments[0],r=arguments[1];this.location[e]=r}},Rh.prototype.init=function(t){this.location=new Array(t).fill(null),this.setAllLocations(fu.NONE)},Rh.prototype.isEqualOnSide=function(t,e){return this.location[e]===t.location[e]},Rh.prototype.allPositionsEqual=function(t){for(var e=0;e<this.location.length;e++)if(this.location[e]!==t)return!1;return!0},Rh.prototype.interfaces_=function(){return[]},Rh.prototype.getClass=function(){return Rh};var Oh=function t(){if(this.elt=new Array(2).fill(null),1===arguments.length){if(Number.isInteger(arguments[0])){var e=arguments[0];this.elt[0]=new Rh(e),this.elt[1]=new Rh(e)}else if(arguments[0]instanceof t){var r=arguments[0];this.elt[0]=new Rh(r.elt[0]),this.elt[1]=new Rh(r.elt[1])}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.elt[0]=new Rh(fu.NONE),this.elt[1]=new Rh(fu.NONE),this.elt[n].setLocation(i)}else if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];this.elt[0]=new Rh(o,s,a),this.elt[1]=new Rh(o,s,a)}else if(4===arguments.length){var l=arguments[0],u=arguments[1],c=arguments[2],h=arguments[3];this.elt[0]=new Rh(fu.NONE,fu.NONE,fu.NONE),this.elt[1]=new Rh(fu.NONE,fu.NONE,fu.NONE),this.elt[l].setLocations(u,c,h)}};Oh.prototype.getGeometryCount=function(){var t=0;return this.elt[0].isNull()||t++,this.elt[1].isNull()||t++,t},Oh.prototype.setAllLocations=function(t,e){this.elt[t].setAllLocations(e)},Oh.prototype.isNull=function(t){return this.elt[t].isNull()},Oh.prototype.setAllLocationsIfNull=function(){if(1===arguments.length){var t=arguments[0];this.setAllLocationsIfNull(0,t),this.setAllLocationsIfNull(1,t)}else if(2===arguments.length){var e=arguments[0],r=arguments[1];this.elt[e].setAllLocationsIfNull(r)}},Oh.prototype.isLine=function(t){return this.elt[t].isLine()},Oh.prototype.merge=function(t){for(var e=this,r=0;r<2;r++)null===e.elt[r]&&null!==t.elt[r]?e.elt[r]=new Rh(t.elt[r]):e.elt[r].merge(t.elt[r])},Oh.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()},Oh.prototype.getLocation=function(){if(1===arguments.length){var t=arguments[0];return this.elt[t].get(Ch.ON)}if(2===arguments.length){var e=arguments[0],r=arguments[1];return this.elt[e].get(r)}},Oh.prototype.toString=function(){var t=new _u;return null!==this.elt[0]&&(t.append("A:"),t.append(this.elt[0].toString())),null!==this.elt[1]&&(t.append(" B:"),t.append(this.elt[1].toString())),t.toString()},Oh.prototype.isArea=function(){if(0===arguments.length)return this.elt[0].isArea()||this.elt[1].isArea();if(1===arguments.length){var t=arguments[0];return this.elt[t].isArea()}},Oh.prototype.isAnyNull=function(t){return this.elt[t].isAnyNull()},Oh.prototype.setLocation=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];this.elt[t].setLocation(Ch.ON,e)}else if(3===arguments.length){var r=arguments[0],n=arguments[1],i=arguments[2];this.elt[r].setLocation(n,i)}},Oh.prototype.isEqualOnSide=function(t,e){return this.elt[0].isEqualOnSide(t.elt[0],e)&&this.elt[1].isEqualOnSide(t.elt[1],e)},Oh.prototype.allPositionsEqual=function(t,e){return this.elt[t].allPositionsEqual(e)},Oh.prototype.toLine=function(t){this.elt[t].isArea()&&(this.elt[t]=new Rh(this.elt[t].location[0]))},Oh.prototype.interfaces_=function(){return[]},Oh.prototype.getClass=function(){return Oh},Oh.toLineLabel=function(t){for(var e=new Oh(fu.NONE),r=0;r<2;r++)e.setLocation(r,t.getLocation(r));return e};var Nh=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new cc,this._pts=new cc,this._label=new Oh(fu.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new cc,this._geometryFactory=null;var t=arguments[0],e=arguments[1];this._geometryFactory=e,this.computePoints(t),this.computeRing()};Nh.prototype.computeRing=function(){if(null!==this._ring)return null;for(var t=new Array(this._pts.size()).fill(null),e=0;e<this._pts.size();e++)t[e]=this._pts.get(e);this._ring=this._geometryFactory.createLinearRing(t),this._isHole=Zu.isCCW(this._ring.getCoordinates())},Nh.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},Nh.prototype.computePoints=function(t){var e=this;this._startDe=t;var r=t,n=!0;do{if(null===r)throw new Lh("Found null DirectedEdge");if(r.getEdgeRing()===e)throw new Lh("Directed Edge visited twice during ring-building at "+r.getCoordinate());e._edges.add(r);var i=r.getLabel();ju.isTrue(i.isArea()),e.mergeLabel(i),e.addPoints(r.getEdge(),r.isForward(),n),n=!1,e.setEdgeRing(r,e),r=e.getNext(r)}while(r!==this._startDe)},Nh.prototype.getLinearRing=function(){return this._ring},Nh.prototype.getCoordinate=function(t){return this._pts.get(t)},Nh.prototype.computeMaxNodeDegree=function(){var t=this;this._maxNodeDegree=0;var e=this._startDe;do{var r=e.getNode().getEdges().getOutgoingDegree(t);r>t._maxNodeDegree&&(t._maxNodeDegree=r),e=t.getNext(e)}while(e!==this._startDe);this._maxNodeDegree*=2},Nh.prototype.addPoints=function(t,e,r){var n=t.getCoordinates();if(e){var i=1;r&&(i=0);for(var o=i;o<n.length;o++)this._pts.add(n[o])}else{var s=n.length-2;r&&(s=n.length-1);for(var a=s;a>=0;a--)this._pts.add(n[a])}},Nh.prototype.isHole=function(){return this._isHole},Nh.prototype.setInResult=function(){var t=this._startDe;do{t.getEdge().setInResult(!0),t=t.getNext()}while(t!==this._startDe)},Nh.prototype.containsPoint=function(t){var e=this.getLinearRing();if(!e.getEnvelopeInternal().contains(t))return!1;if(!Zu.isPointInRing(t,e.getCoordinates()))return!1;for(var r=this._holes.iterator();r.hasNext();)if(r.next().containsPoint(t))return!1;return!0},Nh.prototype.addHole=function(t){this._holes.add(t)},Nh.prototype.isShell=function(){return null===this._shell},Nh.prototype.getLabel=function(){return this._label},Nh.prototype.getEdges=function(){return this._edges},Nh.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree},Nh.prototype.getShell=function(){return this._shell},Nh.prototype.mergeLabel=function(){if(1===arguments.length){var t=arguments[0];this.mergeLabel(t,0),this.mergeLabel(t,1)}else if(2===arguments.length){var e=arguments[0],r=arguments[1],n=e.getLocation(r,Ch.RIGHT);if(n===fu.NONE)return null;if(this._label.getLocation(r)===fu.NONE)return this._label.setLocation(r,n),null}},Nh.prototype.setShell=function(t){this._shell=t,null!==t&&t.addHole(this)},Nh.prototype.toPolygon=function(t){for(var e=new Array(this._holes.size()).fill(null),r=0;r<this._holes.size();r++)e[r]=this._holes.get(r).getLinearRing();return t.createPolygon(this.getLinearRing(),e)},Nh.prototype.interfaces_=function(){return[]},Nh.prototype.getClass=function(){return Nh};var Fh=function(t){function e(){var e=arguments[0],r=arguments[1];t.call(this,e,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setEdgeRing=function(t,e){t.setMinEdgeRing(e)},e.prototype.getNext=function(t){return t.getNextMin()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Nh),Bh=function(t){function e(){var e=arguments[0],r=arguments[1];t.call(this,e,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildMinimalRings=function(){var t=new cc,e=this._startDe;do{if(null===e.getMinEdgeRing()){var r=new Fh(e,this._geometryFactory);t.add(r)}e=e.getNext()}while(e!==this._startDe);return t},e.prototype.setEdgeRing=function(t,e){t.setEdgeRing(e)},e.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var t=this._startDe;do{t.getNode().getEdges().linkMinimalDirectedEdges(this),t=t.getNext()}while(t!==this._startDe)},e.prototype.getNext=function(t){return t.getNext()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Nh),jh=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this._label=t}};jh.prototype.setVisited=function(t){this._isVisited=t},jh.prototype.setInResult=function(t){this._isInResult=t},jh.prototype.isCovered=function(){return this._isCovered},jh.prototype.isCoveredSet=function(){return this._isCoveredSet},jh.prototype.setLabel=function(t){this._label=t},jh.prototype.getLabel=function(){return this._label},jh.prototype.setCovered=function(t){this._isCovered=t,this._isCoveredSet=!0},jh.prototype.updateIM=function(t){ju.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(t)},jh.prototype.isInResult=function(){return this._isInResult},jh.prototype.isVisited=function(){return this._isVisited},jh.prototype.interfaces_=function(){return[]},jh.prototype.getClass=function(){return jh};var Uh=function(t){function e(){t.call(this),this._coord=null,this._edges=null;var e=arguments[0],r=arguments[1];this._coord=e,this._edges=r,this._label=new Oh(0,fu.NONE)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isIncidentEdgeInResult=function(){for(var t=this.getEdges().getEdges().iterator();t.hasNext();)if(t.next().getEdge().isInResult())return!0;return!1},e.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},e.prototype.getCoordinate=function(){return this._coord},e.prototype.print=function(t){t.println("node "+this._coord+" lbl: "+this._label)},e.prototype.computeIM=function(t){},e.prototype.computeMergedLocation=function(t,e){var r=fu.NONE;if(r=this._label.getLocation(e),!t.isNull(e)){var n=t.getLocation(e);r!==fu.BOUNDARY&&(r=n)}return r},e.prototype.setLabel=function(){if(2!==arguments.length)return t.prototype.setLabel.apply(this,arguments);var e=arguments[0],r=arguments[1];null===this._label?this._label=new Oh(e,r):this._label.setLocation(e,r)},e.prototype.getEdges=function(){return this._edges},e.prototype.mergeLabel=function(){var t=this;if(arguments[0]instanceof e){var r=arguments[0];this.mergeLabel(r._label)}else if(arguments[0]instanceof Oh)for(var n=arguments[0],i=0;i<2;i++){var o=t.computeMergedLocation(n,i),s=t._label.getLocation(i);s===fu.NONE&&t._label.setLocation(i,o)}},e.prototype.add=function(t){this._edges.insert(t),t.setNode(this)},e.prototype.setLabelBoundary=function(t){if(null===this._label)return null;var e=fu.NONE;null!==this._label&&(e=this._label.getLocation(t));var r=null;switch(e){case fu.BOUNDARY:r=fu.INTERIOR;break;case fu.INTERIOR:default:r=fu.BOUNDARY}this._label.setLocation(t,r)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(jh),Vh=function(){this.nodeMap=new Mc,this.nodeFact=null;var t=arguments[0];this.nodeFact=t};Vh.prototype.find=function(t){return this.nodeMap.get(t)},Vh.prototype.addNode=function(){if(arguments[0]instanceof uu){var t=arguments[0],e=this.nodeMap.get(t);return null===e&&(e=this.nodeFact.createNode(t),this.nodeMap.put(t,e)),e}if(arguments[0]instanceof Uh){var r=arguments[0],n=this.nodeMap.get(r.getCoordinate());return null===n?(this.nodeMap.put(r.getCoordinate(),r),r):(n.mergeLabel(r),n)}},Vh.prototype.print=function(t){for(var e=this.iterator();e.hasNext();)e.next().print(t)},Vh.prototype.iterator=function(){return this.nodeMap.values().iterator()},Vh.prototype.values=function(){return this.nodeMap.values()},Vh.prototype.getBoundaryNodes=function(t){for(var e=new cc,r=this.iterator();r.hasNext();){var n=r.next();n.getLabel().getLocation(t)===fu.BOUNDARY&&e.add(n)}return e},Vh.prototype.add=function(t){var e=t.getCoordinate();this.addNode(e).add(t)},Vh.prototype.interfaces_=function(){return[]},Vh.prototype.getClass=function(){return Vh};var Gh=function(){},qh={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};Gh.prototype.interfaces_=function(){return[]},Gh.prototype.getClass=function(){return Gh},Gh.isNorthern=function(t){return t===Gh.NE||t===Gh.NW},Gh.isOpposite=function(t,e){return t!==e&&2===(t-e+4)%4},Gh.commonHalfPlane=function(t,e){if(t===e)return t;if(2===(t-e+4)%4)return-1;var r=t<e?t:e;return 0===r&&3===(t>e?t:e)?3:r},Gh.isInHalfPlane=function(t,e){return e===Gh.SE?t===Gh.SE||t===Gh.SW:t===e||t===e+1},Gh.quadrant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1];if(0===t&&0===e)throw new ru("Cannot compute the quadrant for point ( "+t+", "+e+" )");return t>=0?e>=0?Gh.NE:Gh.SE:e>=0?Gh.NW:Gh.SW}if(arguments[0]instanceof uu&&arguments[1]instanceof uu){var r=arguments[0],n=arguments[1];if(n.x===r.x&&n.y===r.y)throw new ru("Cannot compute the quadrant for two identical points "+r);return n.x>=r.x?n.y>=r.y?Gh.NE:Gh.SE:n.y>=r.y?Gh.NW:Gh.SW}},qh.NE.get=function(){return 0},qh.NW.get=function(){return 1},qh.SW.get=function(){return 2},qh.SE.get=function(){return 3},Object.defineProperties(Gh,qh);var $h=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,1===arguments.length){var t=arguments[0];this._edge=t}else if(3===arguments.length){var e=arguments[0],r=arguments[1],n=arguments[2],i=null;this._edge=e,this.init(r,n),this._label=i}else if(4===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2],l=arguments[3];this._edge=o,this.init(s,a),this._label=l}};$h.prototype.compareDirection=function(t){return this._dx===t._dx&&this._dy===t._dy?0:this._quadrant>t._quadrant?1:this._quadrant<t._quadrant?-1:Zu.computeOrientation(t._p0,t._p1,this._p1)},$h.prototype.getDy=function(){return this._dy},$h.prototype.getCoordinate=function(){return this._p0},$h.prototype.setNode=function(t){this._node=t},$h.prototype.print=function(t){var e=Math.atan2(this._dy,this._dx),r=this.getClass().getName(),n=r.lastIndexOf("."),i=r.substring(n+1);t.print("  "+i+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label)},$h.prototype.compareTo=function(t){var e=t;return this.compareDirection(e)},$h.prototype.getDirectedCoordinate=function(){return this._p1},$h.prototype.getDx=function(){return this._dx},$h.prototype.getLabel=function(){return this._label},$h.prototype.getEdge=function(){return this._edge},$h.prototype.getQuadrant=function(){return this._quadrant},$h.prototype.getNode=function(){return this._node},$h.prototype.toString=function(){var t=Math.atan2(this._dy,this._dx),e=this.getClass().getName(),r=e.lastIndexOf(".");return"  "+e.substring(r+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label},$h.prototype.computeLabel=function(t){},$h.prototype.init=function(t,e){this._p0=t,this._p1=e,this._dx=e.x-t.x,this._dy=e.y-t.y,this._quadrant=Gh.quadrant(this._dx,this._dy),ju.isTrue(!(0===this._dx&&0===this._dy),"EdgeEnd with identical endpoints found")},$h.prototype.interfaces_=function(){return[ou]},$h.prototype.getClass=function(){return $h};var Zh=function(t){function e(){var e=arguments[0],r=arguments[1];if(t.call(this,e),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=r,r)this.init(e.getCoordinate(0),e.getCoordinate(1));else{var n=e.getNumPoints()-1;this.init(e.getCoordinate(n),e.getCoordinate(n-1))}this.computeDirectedLabel()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getNextMin=function(){return this._nextMin},e.prototype.getDepth=function(t){return this._depth[t]},e.prototype.setVisited=function(t){this._isVisited=t},e.prototype.computeDirectedLabel=function(){this._label=new Oh(this._edge.getLabel()),this._isForward||this._label.flip()},e.prototype.getNext=function(){return this._next},e.prototype.setDepth=function(t,e){if(-999!==this._depth[t]&&this._depth[t]!==e)throw new Lh("assigned depths do not match",this.getCoordinate());this._depth[t]=e},e.prototype.isInteriorAreaEdge=function(){for(var t=this,e=!0,r=0;r<2;r++)t._label.isArea(r)&&t._label.getLocation(r,Ch.LEFT)===fu.INTERIOR&&t._label.getLocation(r,Ch.RIGHT)===fu.INTERIOR||(e=!1);return e},e.prototype.setNextMin=function(t){this._nextMin=t},e.prototype.print=function(e){t.prototype.print.call(this,e),e.print(" "+this._depth[Ch.LEFT]+"/"+this._depth[Ch.RIGHT]),e.print(" ("+this.getDepthDelta()+")"),this._isInResult&&e.print(" inResult")},e.prototype.setMinEdgeRing=function(t){this._minEdgeRing=t},e.prototype.isLineEdge=function(){var t=this._label.isLine(0)||this._label.isLine(1),e=!this._label.isArea(0)||this._label.allPositionsEqual(0,fu.EXTERIOR),r=!this._label.isArea(1)||this._label.allPositionsEqual(1,fu.EXTERIOR);return t&&e&&r},e.prototype.setEdgeRing=function(t){this._edgeRing=t},e.prototype.getMinEdgeRing=function(){return this._minEdgeRing},e.prototype.getDepthDelta=function(){var t=this._edge.getDepthDelta();return this._isForward||(t=-t),t},e.prototype.setInResult=function(t){this._isInResult=t},e.prototype.getSym=function(){return this._sym},e.prototype.isForward=function(){return this._isForward},e.prototype.getEdge=function(){return this._edge},e.prototype.printEdge=function(t){this.print(t),t.print(" "),this._isForward?this._edge.print(t):this._edge.printReverse(t)},e.prototype.setSym=function(t){this._sym=t},e.prototype.setVisitedEdge=function(t){this.setVisited(t),this._sym.setVisited(t)},e.prototype.setEdgeDepths=function(t,e){var r=this.getEdge().getDepthDelta();this._isForward||(r=-r);var n=1;t===Ch.LEFT&&(n=-1);var i=Ch.opposite(t),o=e+r*n;this.setDepth(t,e),this.setDepth(i,o)},e.prototype.getEdgeRing=function(){return this._edgeRing},e.prototype.isInResult=function(){return this._isInResult},e.prototype.setNext=function(t){this._next=t},e.prototype.isVisited=function(){return this._isVisited},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.depthFactor=function(t,e){return t===fu.EXTERIOR&&e===fu.INTERIOR?1:t===fu.INTERIOR&&e===fu.EXTERIOR?-1:0},e}($h),Xh=function(){};Xh.prototype.createNode=function(t){return new Uh(t,null)},Xh.prototype.interfaces_=function(){return[]},Xh.prototype.getClass=function(){return Xh};var Wh=function(){if(this._edges=new cc,this._nodes=null,this._edgeEndList=new cc,0===arguments.length)this._nodes=new Vh(new Xh);else if(1===arguments.length){var t=arguments[0];this._nodes=new Vh(t)}};Wh.prototype.printEdges=function(t){t.println("Edges:");for(var e=0;e<this._edges.size();e++){t.println("edge "+e+":");var r=this._edges.get(e);r.print(t),r.eiList.print(t)}},Wh.prototype.find=function(t){return this._nodes.find(t)},Wh.prototype.addNode=function(){if(arguments[0]instanceof Uh){var t=arguments[0];return this._nodes.addNode(t)}if(arguments[0]instanceof uu){var e=arguments[0];return this._nodes.addNode(e)}},Wh.prototype.getNodeIterator=function(){return this._nodes.iterator()},Wh.prototype.linkResultDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();)t.next().getEdges().linkResultDirectedEdges()},Wh.prototype.debugPrintln=function(t){Au.out.println(t)},Wh.prototype.isBoundaryNode=function(t,e){var r=this._nodes.find(e);if(null===r)return!1;var n=r.getLabel();return null!==n&&n.getLocation(t)===fu.BOUNDARY},Wh.prototype.linkAllDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();)t.next().getEdges().linkAllDirectedEdges()},Wh.prototype.matchInSameDirection=function(t,e,r,n){return!!t.equals(r)&&Zu.computeOrientation(t,e,n)===Zu.COLLINEAR&&Gh.quadrant(t,e)===Gh.quadrant(r,n)},Wh.prototype.getEdgeEnds=function(){return this._edgeEndList},Wh.prototype.debugPrint=function(t){Au.out.print(t)},Wh.prototype.getEdgeIterator=function(){return this._edges.iterator()},Wh.prototype.findEdgeInSameDirection=function(t,e){for(var r=this,n=0;n<this._edges.size();n++){var i=r._edges.get(n),o=i.getCoordinates();if(r.matchInSameDirection(t,e,o[0],o[1]))return i;if(r.matchInSameDirection(t,e,o[o.length-1],o[o.length-2]))return i}return null},Wh.prototype.insertEdge=function(t){this._edges.add(t)},Wh.prototype.findEdgeEnd=function(t){for(var e=this.getEdgeEnds().iterator();e.hasNext();){var r=e.next();if(r.getEdge()===t)return r}return null},Wh.prototype.addEdges=function(t){for(var e=this,r=t.iterator();r.hasNext();){var n=r.next();e._edges.add(n);var i=new Zh(n,!0),o=new Zh(n,!1);i.setSym(o),o.setSym(i),e.add(i),e.add(o)}},Wh.prototype.add=function(t){this._nodes.add(t),this._edgeEndList.add(t)},Wh.prototype.getNodes=function(){return this._nodes.values()},Wh.prototype.findEdge=function(t,e){for(var r=0;r<this._edges.size();r++){var n=this._edges.get(r),i=n.getCoordinates();if(t.equals(i[0])&&e.equals(i[1]))return n}return null},Wh.prototype.interfaces_=function(){return[]},Wh.prototype.getClass=function(){return Wh},Wh.linkResultDirectedEdges=function(t){for(var e=t.iterator();e.hasNext();)e.next().getEdges().linkResultDirectedEdges()};var Yh=function(){this._geometryFactory=null,this._shellList=new cc;var t=arguments[0];this._geometryFactory=t};Yh.prototype.sortShellsAndHoles=function(t,e,r){for(var n=t.iterator();n.hasNext();){var i=n.next();i.isHole()?r.add(i):e.add(i)}},Yh.prototype.computePolygons=function(t){for(var e=new cc,r=t.iterator();r.hasNext();){var n=r.next().toPolygon(this._geometryFactory);e.add(n)}return e},Yh.prototype.placeFreeHoles=function(t,e){for(var r=e.iterator();r.hasNext();){var n=r.next();if(null===n.getShell()){var i=this.findEdgeRingContaining(n,t);if(null===i)throw new Lh("unable to assign hole to a shell",n.getCoordinate(0));n.setShell(i)}}},Yh.prototype.buildMinimalEdgeRings=function(t,e,r){for(var n=new cc,i=t.iterator();i.hasNext();){var o=i.next();if(o.getMaxNodeDegree()>2){o.linkDirectedEdgesForMinimalEdgeRings();var s=o.buildMinimalRings(),a=this.findShell(s);null!==a?(this.placePolygonHoles(a,s),e.add(a)):r.addAll(s)}else n.add(o)}return n},Yh.prototype.containsPoint=function(t){for(var e=this._shellList.iterator();e.hasNext();)if(e.next().containsPoint(t))return!0;return!1},Yh.prototype.buildMaximalEdgeRings=function(t){for(var e=new cc,r=t.iterator();r.hasNext();){var n=r.next();if(n.isInResult()&&n.getLabel().isArea()&&null===n.getEdgeRing()){var i=new Bh(n,this._geometryFactory);e.add(i),i.setInResult()}}return e},Yh.prototype.placePolygonHoles=function(t,e){for(var r=e.iterator();r.hasNext();){var n=r.next();n.isHole()&&n.setShell(t)}},Yh.prototype.getPolygons=function(){return this.computePolygons(this._shellList)},Yh.prototype.findEdgeRingContaining=function(t,e){for(var r=t.getLinearRing(),n=r.getEnvelopeInternal(),i=r.getCoordinateN(0),o=null,s=null,a=e.iterator();a.hasNext();){var l=a.next(),u=l.getLinearRing(),c=u.getEnvelopeInternal();null!==o&&(s=o.getLinearRing().getEnvelopeInternal());var h=!1;c.contains(n)&&Zu.isPointInRing(i,u.getCoordinates())&&(h=!0),h&&(null===o||s.contains(c))&&(o=l)}return o},Yh.prototype.findShell=function(t){for(var e=0,r=null,n=t.iterator();n.hasNext();){var i=n.next();i.isHole()||(r=i,e++)}return ju.isTrue(e<=1,"found two shells in MinimalEdgeRing list"),r},Yh.prototype.add=function(){if(1===arguments.length){var t=arguments[0];this.add(t.getEdgeEnds(),t.getNodes())}else if(2===arguments.length){var e=arguments[0],r=arguments[1];Wh.linkResultDirectedEdges(r);var n=this.buildMaximalEdgeRings(e),i=new cc,o=this.buildMinimalEdgeRings(n,this._shellList,i);this.sortShellsAndHoles(o,this._shellList,i),this.placeFreeHoles(this._shellList,i)}},Yh.prototype.interfaces_=function(){return[]},Yh.prototype.getClass=function(){return Yh};var Hh=function(){};Hh.prototype.getBounds=function(){},Hh.prototype.interfaces_=function(){return[]},Hh.prototype.getClass=function(){return Hh};var Jh=function(){this._bounds=null,this._item=null;var t=arguments[0],e=arguments[1];this._bounds=t,this._item=e};Jh.prototype.getItem=function(){return this._item},Jh.prototype.getBounds=function(){return this._bounds},Jh.prototype.interfaces_=function(){return[Hh,lu]},Jh.prototype.getClass=function(){return Jh};var Kh=function(){this._size=null,this._items=null,this._size=0,this._items=new cc,this._items.add(null)};Kh.prototype.poll=function(){if(this.isEmpty())return null;var t=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),t},Kh.prototype.size=function(){return this._size},Kh.prototype.reorder=function(t){for(var e=this,r=null,n=this._items.get(t);2*t<=this._size&&((r=2*t)!==e._size&&e._items.get(r+1).compareTo(e._items.get(r))<0&&r++,e._items.get(r).compareTo(n)<0);t=r)e._items.set(t,e._items.get(r));this._items.set(t,n)},Kh.prototype.clear=function(){this._size=0,this._items.clear()},Kh.prototype.isEmpty=function(){return 0===this._size},Kh.prototype.add=function(t){this._items.add(null),this._size+=1;var e=this._size;for(this._items.set(0,t);t.compareTo(this._items.get(Math.trunc(e/2)))<0;e/=2)this._items.set(e,this._items.get(Math.trunc(e/2)));this._items.set(e,t)},Kh.prototype.interfaces_=function(){return[]},Kh.prototype.getClass=function(){return Kh};var Qh=function(){};Qh.prototype.visitItem=function(t){},Qh.prototype.interfaces_=function(){return[]},Qh.prototype.getClass=function(){return Qh};var tp=function(){};tp.prototype.insert=function(t,e){},tp.prototype.remove=function(t,e){},tp.prototype.query=function(){},tp.prototype.interfaces_=function(){return[]},tp.prototype.getClass=function(){return tp};var ep=function(){if(this._childBoundables=new cc,this._bounds=null,this._level=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this._level=t}},rp={serialVersionUID:{configurable:!0}};ep.prototype.getLevel=function(){return this._level},ep.prototype.size=function(){return this._childBoundables.size()},ep.prototype.getChildBoundables=function(){return this._childBoundables},ep.prototype.addChildBoundable=function(t){ju.isTrue(null===this._bounds),this._childBoundables.add(t)},ep.prototype.isEmpty=function(){return this._childBoundables.isEmpty()},ep.prototype.getBounds=function(){return null===this._bounds&&(this._bounds=this.computeBounds()),this._bounds},ep.prototype.interfaces_=function(){return[Hh,lu]},ep.prototype.getClass=function(){return ep},rp.serialVersionUID.get=function(){return 0x5a1e55ec41369800},Object.defineProperties(ep,rp);var np=function(){};np.reverseOrder=function(){return{compare:function(t,e){return e.compareTo(t)}}},np.min=function(t){return np.sort(t),t.get(0)},np.sort=function(t,e){var r=t.toArray();e?zc.sort(r,e):zc.sort(r);for(var n=t.iterator(),i=0,o=r.length;i<o;i++)n.next(),n.set(r[i])},np.singletonList=function(t){var e=new cc;return e.add(t),e};var ip=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var t=arguments[0],e=arguments[1],r=arguments[2];this._boundable1=t,this._boundable2=e,this._itemDistance=r,this._distance=this.distance()};ip.prototype.expandToQueue=function(t,e){var r=ip.isComposite(this._boundable1),n=ip.isComposite(this._boundable2);if(r&&n)return ip.area(this._boundable1)>ip.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,t,e),null):(this.expand(this._boundable2,this._boundable1,t,e),null);if(r)return this.expand(this._boundable1,this._boundable2,t,e),null;if(n)return this.expand(this._boundable2,this._boundable1,t,e),null;throw new ru("neither boundable is composite")},ip.prototype.isLeaves=function(){return!(ip.isComposite(this._boundable1)||ip.isComposite(this._boundable2))},ip.prototype.compareTo=function(t){var e=t;return this._distance<e._distance?-1:this._distance>e._distance?1:0},ip.prototype.expand=function(t,e,r,n){for(var i=t.getChildBoundables().iterator();i.hasNext();){var o=i.next(),s=new ip(o,e,this._itemDistance);s.getDistance()<n&&r.add(s)}},ip.prototype.getBoundable=function(t){return 0===t?this._boundable1:this._boundable2},ip.prototype.getDistance=function(){return this._distance},ip.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())},ip.prototype.interfaces_=function(){return[ou]},ip.prototype.getClass=function(){return ip},ip.area=function(t){return t.getBounds().getArea()},ip.isComposite=function(t){return t instanceof ep};var op=function t(){if(this._root=null,this._built=!1,this._itemBoundables=new cc,this._nodeCapacity=null,0===arguments.length){var e=t.DEFAULT_NODE_CAPACITY;this._nodeCapacity=e}else if(1===arguments.length){var r=arguments[0];ju.isTrue(r>1,"Node capacity must be greater than 1"),this._nodeCapacity=r}},sp={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};op.prototype.getNodeCapacity=function(){return this._nodeCapacity},op.prototype.lastNode=function(t){return t.get(t.size()-1)},op.prototype.size=function(){var t=this;if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this._root));if(1===arguments.length){for(var e=arguments[0],r=0,n=e.getChildBoundables().iterator();n.hasNext();){var i=n.next();i instanceof ep?r+=t.size(i):i instanceof Jh&&(r+=1)}return r}},op.prototype.removeItem=function(t,e){for(var r=null,n=t.getChildBoundables().iterator();n.hasNext();){var i=n.next();i instanceof Jh&&i.getItem()===e&&(r=i)}return null!==r&&(t.getChildBoundables().remove(r),!0)},op.prototype.itemsTree=function(){var t=this;if(0===arguments.length){this.build();var e=this.itemsTree(this._root);return null===e?new cc:e}if(1===arguments.length){for(var r=arguments[0],n=new cc,i=r.getChildBoundables().iterator();i.hasNext();){var o=i.next();if(o instanceof ep){var s=t.itemsTree(o);null!==s&&n.add(s)}else o instanceof Jh?n.add(o.getItem()):ju.shouldNeverReachHere()}return n.size()<=0?null:n}},op.prototype.insert=function(t,e){ju.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Jh(t,e))},op.prototype.boundablesAtLevel=function(){var t=this;if(1===arguments.length){var e=arguments[0],r=new cc;return this.boundablesAtLevel(e,this._root,r),r}if(3===arguments.length){var n=arguments[0],i=arguments[1],o=arguments[2];if(ju.isTrue(n>-2),i.getLevel()===n)return o.add(i),null;for(var s=i.getChildBoundables().iterator();s.hasNext();){var a=s.next();a instanceof ep?t.boundablesAtLevel(n,a,o):(ju.isTrue(a instanceof Jh),-1===n&&o.add(a))}return null}},op.prototype.query=function(){var t=this;if(1===arguments.length){var e=arguments[0];this.build();var r=new cc;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),e)&&this.query(e,this._root,r),r}if(2===arguments.length){var n=arguments[0],i=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),n)&&this.query(n,this._root,i)}else if(3===arguments.length)if(mu(arguments[2],Qh)&&arguments[0]instanceof Object&&arguments[1]instanceof ep)for(var o=arguments[0],s=arguments[1],a=arguments[2],l=s.getChildBoundables(),u=0;u<l.size();u++){var c=l.get(u);t.getIntersectsOp().intersects(c.getBounds(),o)&&(c instanceof ep?t.query(o,c,a):c instanceof Jh?a.visitItem(c.getItem()):ju.shouldNeverReachHere())}else if(mu(arguments[2],lc)&&arguments[0]instanceof Object&&arguments[1]instanceof ep)for(var h=arguments[0],p=arguments[1],f=arguments[2],d=p.getChildBoundables(),m=0;m<d.size();m++){var g=d.get(m);t.getIntersectsOp().intersects(g.getBounds(),h)&&(g instanceof ep?t.query(h,g,f):g instanceof Jh?f.add(g.getItem()):ju.shouldNeverReachHere())}},op.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0},op.prototype.getRoot=function(){return this.build(),this._root},op.prototype.remove=function(){var t=this;if(2===arguments.length){var e=arguments[0],r=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),e)&&this.remove(e,this._root,r)}if(3===arguments.length){var n=arguments[0],i=arguments[1],o=arguments[2],s=this.removeItem(i,o);if(s)return!0;for(var a=null,l=i.getChildBoundables().iterator();l.hasNext();){var u=l.next();if(t.getIntersectsOp().intersects(u.getBounds(),n)&&u instanceof ep&&(s=t.remove(n,u,o))){a=u;break}}return null!==a&&a.getChildBoundables().isEmpty()&&i.getChildBoundables().remove(a),s}},op.prototype.createHigherLevels=function(t,e){ju.isTrue(!t.isEmpty());var r=this.createParentBoundables(t,e+1);return 1===r.size()?r.get(0):this.createHigherLevels(r,e+1)},op.prototype.depth=function(){var t=this;if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(1===arguments.length){for(var e=arguments[0],r=0,n=e.getChildBoundables().iterator();n.hasNext();){var i=n.next();if(i instanceof ep){var o=t.depth(i);o>r&&(r=o)}}return r+1}},op.prototype.createParentBoundables=function(t,e){var r=this;ju.isTrue(!t.isEmpty());var n=new cc;n.add(this.createNode(e));var i=new cc(t);np.sort(i,this.getComparator());for(var o=i.iterator();o.hasNext();){var s=o.next();r.lastNode(n).getChildBoundables().size()===r.getNodeCapacity()&&n.add(r.createNode(e)),r.lastNode(n).addChildBoundable(s)}return n},op.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()},op.prototype.interfaces_=function(){return[lu]},op.prototype.getClass=function(){return op},op.compareDoubles=function(t,e){return t>e?1:t<e?-1:0},sp.IntersectsOp.get=function(){return ap},sp.serialVersionUID.get=function(){return-0x35ef64c82d4c5400},sp.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(op,sp);var ap=function(){},lp=function(){};lp.prototype.distance=function(t,e){},lp.prototype.interfaces_=function(){return[]},lp.prototype.getClass=function(){return lp};var up=function(t){function e(r){r=r||e.DEFAULT_NODE_CAPACITY,t.call(this,r)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return e.prototype.createParentBoundablesFromVerticalSlices=function(t,e){ju.isTrue(t.length>0);for(var r=new cc,n=0;n<t.length;n++)r.addAll(this.createParentBoundablesFromVerticalSlice(t[n],e));return r},e.prototype.createNode=function(t){return new cp(t)},e.prototype.size=function(){return 0===arguments.length?t.prototype.size.call(this):t.prototype.size.apply(this,arguments)},e.prototype.insert=function(){if(2!==arguments.length)return t.prototype.insert.apply(this,arguments);var e=arguments[0],r=arguments[1];if(e.isNull())return null;t.prototype.insert.call(this,e,r)},e.prototype.getIntersectsOp=function(){return e.intersectsOp},e.prototype.verticalSlices=function(t,e){for(var r=Math.trunc(Math.ceil(t.size()/e)),n=new Array(e).fill(null),i=t.iterator(),o=0;o<e;o++){n[o]=new cc;for(var s=0;i.hasNext()&&s<r;){var a=i.next();n[o].add(a),s++}}return n},e.prototype.query=function(){if(1===arguments.length){var e=arguments[0];return t.prototype.query.call(this,e)}if(2===arguments.length){var r=arguments[0],n=arguments[1];t.prototype.query.call(this,r,n)}else if(3===arguments.length)if(mu(arguments[2],Qh)&&arguments[0]instanceof Object&&arguments[1]instanceof ep){var i=arguments[0],o=arguments[1],s=arguments[2];t.prototype.query.call(this,i,o,s)}else if(mu(arguments[2],lc)&&arguments[0]instanceof Object&&arguments[1]instanceof ep){var a=arguments[0],l=arguments[1],u=arguments[2];t.prototype.query.call(this,a,l,u)}},e.prototype.getComparator=function(){return e.yComparator},e.prototype.createParentBoundablesFromVerticalSlice=function(e,r){return t.prototype.createParentBoundables.call(this,e,r)},e.prototype.remove=function(){if(2===arguments.length){var e=arguments[0],r=arguments[1];return t.prototype.remove.call(this,e,r)}return t.prototype.remove.apply(this,arguments)},e.prototype.depth=function(){return 0===arguments.length?t.prototype.depth.call(this):t.prototype.depth.apply(this,arguments)},e.prototype.createParentBoundables=function(t,r){ju.isTrue(!t.isEmpty());var n=Math.trunc(Math.ceil(t.size()/this.getNodeCapacity())),i=new cc(t);np.sort(i,e.xComparator);var o=this.verticalSlices(i,Math.trunc(Math.ceil(Math.sqrt(n))));return this.createParentBoundablesFromVerticalSlices(o,r)},e.prototype.nearestNeighbour=function(){if(1===arguments.length){if(mu(arguments[0],lp)){var t=arguments[0],r=new ip(this.getRoot(),this.getRoot(),t);return this.nearestNeighbour(r)}if(arguments[0]instanceof ip){var n=arguments[0];return this.nearestNeighbour(n,nu.POSITIVE_INFINITY)}}else if(2===arguments.length){if(arguments[0]instanceof e&&mu(arguments[1],lp)){var i=arguments[0],o=arguments[1],s=new ip(this.getRoot(),i.getRoot(),o);return this.nearestNeighbour(s)}if(arguments[0]instanceof ip&&"number"==typeof arguments[1]){var a=arguments[0],l=arguments[1],u=l,c=null,h=new Kh;for(h.add(a);!h.isEmpty()&&u>0;){var p=h.poll(),f=p.getDistance();if(f>=u)break;p.isLeaves()?(u=f,c=p):p.expandToQueue(h,u)}return[c.getBoundable(0).getItem(),c.getBoundable(1).getItem()]}}else if(3===arguments.length){var d=arguments[0],m=arguments[1],g=arguments[2],y=new Jh(d,m),_=new ip(this.getRoot(),y,g);return this.nearestNeighbour(_)[0]}},e.prototype.interfaces_=function(){return[tp,lu]},e.prototype.getClass=function(){return e},e.centreX=function(t){return e.avg(t.getMinX(),t.getMaxX())},e.avg=function(t,e){return(t+e)/2},e.centreY=function(t){return e.avg(t.getMinY(),t.getMaxY())},r.STRtreeNode.get=function(){return cp},r.serialVersionUID.get=function(){return 0x39920f7d5f261e0},r.xComparator.get=function(){return{interfaces_:function(){return[au]},compare:function(r,n){return t.compareDoubles(e.centreX(r.getBounds()),e.centreX(n.getBounds()))}}},r.yComparator.get=function(){return{interfaces_:function(){return[au]},compare:function(r,n){return t.compareDoubles(e.centreY(r.getBounds()),e.centreY(n.getBounds()))}}},r.intersectsOp.get=function(){return{interfaces_:function(){return[t.IntersectsOp]},intersects:function(t,e){return t.intersects(e)}}},r.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(e,r),e}(op),cp=function(t){function e(){var e=arguments[0];t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.computeBounds=function(){for(var t=null,e=this.getChildBoundables().iterator();e.hasNext();){var r=e.next();null===t?t=new ku(r.getBounds()):t.expandToInclude(r.getBounds())}return t},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(ep),hp=function(){};hp.prototype.interfaces_=function(){return[]},hp.prototype.getClass=function(){return hp},hp.relativeSign=function(t,e){return t<e?-1:t>e?1:0},hp.compare=function(t,e,r){if(e.equals2D(r))return 0;var n=hp.relativeSign(e.x,r.x),i=hp.relativeSign(e.y,r.y);switch(t){case 0:return hp.compareValue(n,i);case 1:return hp.compareValue(i,n);case 2:return hp.compareValue(i,-n);case 3:return hp.compareValue(-n,i);case 4:return hp.compareValue(-n,-i);case 5:return hp.compareValue(-i,-n);case 6:return hp.compareValue(-i,n);case 7:return hp.compareValue(n,-i)}return ju.shouldNeverReachHere("invalid octant value"),0},hp.compareValue=function(t,e){return t<0?-1:t>0?1:e<0?-1:e>0?1:0};var pp=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var t=arguments[0],e=arguments[1],r=arguments[2],n=arguments[3];this._segString=t,this.coord=new uu(e),this.segmentIndex=r,this._segmentOctant=n,this._isInterior=!e.equals2D(t.getCoordinate(r))};pp.prototype.getCoordinate=function(){return this.coord},pp.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex)},pp.prototype.compareTo=function(t){var e=t;return this.segmentIndex<e.segmentIndex?-1:this.segmentIndex>e.segmentIndex?1:this.coord.equals2D(e.coord)?0:hp.compare(this._segmentOctant,this.coord,e.coord)},pp.prototype.isEndPoint=function(t){return 0===this.segmentIndex&&!this._isInterior||this.segmentIndex===t},pp.prototype.isInterior=function(){return this._isInterior},pp.prototype.interfaces_=function(){return[ou]},pp.prototype.getClass=function(){return pp};var fp=function(){this._nodeMap=new Mc,this._edge=null;var t=arguments[0];this._edge=t};fp.prototype.getSplitCoordinates=function(){var t=new pc;this.addEndpoints();for(var e=this.iterator(),r=e.next();e.hasNext();){var n=e.next();this.addEdgeCoordinates(r,n,t),r=n}return t.toCoordinateArray()},fp.prototype.addCollapsedNodes=function(){var t=new cc;this.findCollapsesFromInsertedNodes(t),this.findCollapsesFromExistingVertices(t);for(var e=t.iterator();e.hasNext();){var r=e.next().intValue();this.add(this._edge.getCoordinate(r),r)}},fp.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();)e.next().print(t)},fp.prototype.findCollapsesFromExistingVertices=function(t){for(var e=0;e<this._edge.size()-2;e++){var r=this._edge.getCoordinate(e),n=this._edge.getCoordinate(e+2);r.equals2D(n)&&t.add(new vu(e+1))}},fp.prototype.addEdgeCoordinates=function(t,e,r){var n=this._edge.getCoordinate(e.segmentIndex),i=e.isInterior()||!e.coord.equals2D(n);r.add(new uu(t.coord),!1);for(var o=t.segmentIndex+1;o<=e.segmentIndex;o++)r.add(this._edge.getCoordinate(o));i&&r.add(new uu(e.coord))},fp.prototype.iterator=function(){return this._nodeMap.values().iterator()},fp.prototype.addSplitEdges=function(t){this.addEndpoints(),this.addCollapsedNodes();for(var e=this.iterator(),r=e.next();e.hasNext();){var n=e.next(),i=this.createSplitEdge(r,n);t.add(i),r=n}},fp.prototype.findCollapseIndex=function(t,e,r){if(!t.coord.equals2D(e.coord))return!1;var n=e.segmentIndex-t.segmentIndex;return e.isInterior()||n--,1===n&&(r[0]=t.segmentIndex+1,!0)},fp.prototype.findCollapsesFromInsertedNodes=function(t){for(var e=new Array(1).fill(null),r=this.iterator(),n=r.next();r.hasNext();){var i=r.next();this.findCollapseIndex(n,i,e)&&t.add(new vu(e[0])),n=i}},fp.prototype.getEdge=function(){return this._edge},fp.prototype.addEndpoints=function(){var t=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(t),t)},fp.prototype.createSplitEdge=function(t,e){var r=e.segmentIndex-t.segmentIndex+2,n=this._edge.getCoordinate(e.segmentIndex),i=e.isInterior()||!e.coord.equals2D(n);i||r--;var o=new Array(r).fill(null),s=0;o[s++]=new uu(t.coord);for(var a=t.segmentIndex+1;a<=e.segmentIndex;a++)o[s++]=this._edge.getCoordinate(a);return i&&(o[s]=new uu(e.coord)),new yp(o,this._edge.getData())},fp.prototype.add=function(t,e){var r=new pp(this._edge,t,e,this._edge.getSegmentOctant(e)),n=this._nodeMap.get(r);return null!==n?(ju.isTrue(n.coord.equals2D(t),"Found equal nodes with different coordinates"),n):(this._nodeMap.put(r,r),r)},fp.prototype.checkSplitEdgesCorrectness=function(t){var e=this._edge.getCoordinates(),r=t.get(0).getCoordinate(0);if(!r.equals2D(e[0]))throw new Fu("bad split edge start point at "+r);var n=t.get(t.size()-1).getCoordinates(),i=n[n.length-1];if(!i.equals2D(e[e.length-1]))throw new Fu("bad split edge end point at "+i)},fp.prototype.interfaces_=function(){return[]},fp.prototype.getClass=function(){return fp};var dp=function(){};dp.prototype.interfaces_=function(){return[]},dp.prototype.getClass=function(){return dp},dp.octant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1];if(0===t&&0===e)throw new ru("Cannot compute the octant for point ( "+t+", "+e+" )");var r=Math.abs(t),n=Math.abs(e);return t>=0?e>=0?r>=n?0:1:r>=n?7:6:e>=0?r>=n?3:2:r>=n?4:5}if(arguments[0]instanceof uu&&arguments[1]instanceof uu){var i=arguments[0],o=arguments[1],s=o.x-i.x,a=o.y-i.y;if(0===s&&0===a)throw new ru("Cannot compute the octant for two identical points "+i);return dp.octant(s,a)}};var mp=function(){};mp.prototype.getCoordinates=function(){},mp.prototype.size=function(){},mp.prototype.getCoordinate=function(t){},mp.prototype.isClosed=function(){},mp.prototype.setData=function(t){},mp.prototype.getData=function(){},mp.prototype.interfaces_=function(){return[]},mp.prototype.getClass=function(){return mp};var gp=function(){};gp.prototype.addIntersection=function(t,e){},gp.prototype.interfaces_=function(){return[mp]},gp.prototype.getClass=function(){return gp};var yp=function(){this._nodeList=new fp(this),this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e};yp.prototype.getCoordinates=function(){return this._pts},yp.prototype.size=function(){return this._pts.length},yp.prototype.getCoordinate=function(t){return this._pts[t]},yp.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},yp.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(t),this.getCoordinate(t+1))},yp.prototype.setData=function(t){this._data=t},yp.prototype.safeOctant=function(t,e){return t.equals2D(e)?0:dp.octant(t,e)},yp.prototype.getData=function(){return this._data},yp.prototype.addIntersection=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];this.addIntersectionNode(t,e)}else if(4===arguments.length){var r=arguments[0],n=arguments[1],i=arguments[3],o=new uu(r.getIntersection(i));this.addIntersection(o,n)}},yp.prototype.toString=function(){return Nu.toLineString(new ch(this._pts))},yp.prototype.getNodeList=function(){return this._nodeList},yp.prototype.addIntersectionNode=function(t,e){var r=e,n=r+1;if(n<this._pts.length){var i=this._pts[n];t.equals2D(i)&&(r=n)}return this._nodeList.add(t,r)},yp.prototype.addIntersections=function(t,e,r){for(var n=0;n<t.getIntersectionNum();n++)this.addIntersection(t,e,r,n)},yp.prototype.interfaces_=function(){return[gp]},yp.prototype.getClass=function(){return yp},yp.getNodedSubstrings=function(){if(1===arguments.length){var t=arguments[0],e=new cc;return yp.getNodedSubstrings(t,e),e}if(2===arguments.length)for(var r=arguments[0],n=arguments[1],i=r.iterator();i.hasNext();){var o=i.next();o.getNodeList().addSplitEdges(n)}};var _p=function(){if(this.p0=null,this.p1=null,0===arguments.length)this.p0=new uu,this.p1=new uu;else if(1===arguments.length){var t=arguments[0];this.p0=new uu(t.p0),this.p1=new uu(t.p1)}else if(2===arguments.length)this.p0=arguments[0],this.p1=arguments[1];else if(4===arguments.length){var e=arguments[0],r=arguments[1],n=arguments[2],i=arguments[3];this.p0=new uu(e,r),this.p1=new uu(n,i)}},vp={serialVersionUID:{configurable:!0}};_p.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)},_p.prototype.orientationIndex=function(){if(arguments[0]instanceof _p){var t=arguments[0],e=Zu.orientationIndex(this.p0,this.p1,t.p0),r=Zu.orientationIndex(this.p0,this.p1,t.p1);return e>=0&&r>=0||e<=0&&r<=0?Math.max(e,r):0}if(arguments[0]instanceof uu){var n=arguments[0];return Zu.orientationIndex(this.p0,this.p1,n)}},_p.prototype.toGeometry=function(t){return t.createLineString([this.p0,this.p1])},_p.prototype.isVertical=function(){return this.p0.x===this.p1.x},_p.prototype.equals=function(t){if(!(t instanceof _p))return!1;var e=t;return this.p0.equals(e.p0)&&this.p1.equals(e.p1)},_p.prototype.intersection=function(t){var e=new Gu;return e.computeIntersection(this.p0,this.p1,t.p0,t.p1),e.hasIntersection()?e.getIntersection(0):null},_p.prototype.project=function(){if(arguments[0]instanceof uu){var t=arguments[0];if(t.equals(this.p0)||t.equals(this.p1))return new uu(t);var e=this.projectionFactor(t),r=new uu;return r.x=this.p0.x+e*(this.p1.x-this.p0.x),r.y=this.p0.y+e*(this.p1.y-this.p0.y),r}if(arguments[0]instanceof _p){var n=arguments[0],i=this.projectionFactor(n.p0),o=this.projectionFactor(n.p1);if(i>=1&&o>=1)return null;if(i<=0&&o<=0)return null;var s=this.project(n.p0);i<0&&(s=this.p0),i>1&&(s=this.p1);var a=this.project(n.p1);return o<0&&(a=this.p0),o>1&&(a=this.p1),new _p(s,a)}},_p.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()},_p.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)},_p.prototype.getCoordinate=function(t){return 0===t?this.p0:this.p1},_p.prototype.distancePerpendicular=function(t){return Zu.distancePointLinePerpendicular(t,this.p0,this.p1)},_p.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)},_p.prototype.midPoint=function(){return _p.midPoint(this.p0,this.p1)},_p.prototype.projectionFactor=function(t){if(t.equals(this.p0))return 0;if(t.equals(this.p1))return 1;var e=this.p1.x-this.p0.x,r=this.p1.y-this.p0.y,n=e*e+r*r;return n<=0?nu.NaN:((t.x-this.p0.x)*e+(t.y-this.p0.y)*r)/n},_p.prototype.closestPoints=function(t){var e=this.intersection(t);if(null!==e)return[e,e];var r=new Array(2).fill(null),n=nu.MAX_VALUE,i=null,o=this.closestPoint(t.p0);n=o.distance(t.p0),r[0]=o,r[1]=t.p0;var s=this.closestPoint(t.p1);(i=s.distance(t.p1))<n&&(n=i,r[0]=s,r[1]=t.p1);var a=t.closestPoint(this.p0);(i=a.distance(this.p0))<n&&(n=i,r[0]=this.p0,r[1]=a);var l=t.closestPoint(this.p1);return(i=l.distance(this.p1))<n&&(n=i,r[0]=this.p1,r[1]=l),r},_p.prototype.closestPoint=function(t){var e=this.projectionFactor(t);return e>0&&e<1?this.project(t):this.p0.distance(t)<this.p1.distance(t)?this.p0:this.p1},_p.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)},_p.prototype.getLength=function(){return this.p0.distance(this.p1)},_p.prototype.compareTo=function(t){var e=t,r=this.p0.compareTo(e.p0);return 0!==r?r:this.p1.compareTo(e.p1)},_p.prototype.reverse=function(){var t=this.p0;this.p0=this.p1,this.p1=t},_p.prototype.equalsTopo=function(t){return this.p0.equals(t.p0)&&(this.p1.equals(t.p1)||this.p0.equals(t.p1))&&this.p1.equals(t.p0)},_p.prototype.lineIntersection=function(t){try{return Pu.intersection(this.p0,this.p1,t.p0,t.p1)}catch(t){if(!(t instanceof Mu))throw t}return null},_p.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)},_p.prototype.pointAlongOffset=function(t,e){var r=this.p0.x+t*(this.p1.x-this.p0.x),n=this.p0.y+t*(this.p1.y-this.p0.y),i=this.p1.x-this.p0.x,o=this.p1.y-this.p0.y,s=Math.sqrt(i*i+o*o),a=0,l=0;if(0!==e){if(s<=0)throw new Error("Cannot compute offset from zero-length line segment");a=e*i/s,l=e*o/s}return new uu(r-l,n+a)},_p.prototype.setCoordinates=function(){if(1===arguments.length){var t=arguments[0];this.setCoordinates(t.p0,t.p1)}else if(2===arguments.length){var e=arguments[0],r=arguments[1];this.p0.x=e.x,this.p0.y=e.y,this.p1.x=r.x,this.p1.y=r.y}},_p.prototype.segmentFraction=function(t){var e=this.projectionFactor(t);return e<0?e=0:(e>1||nu.isNaN(e))&&(e=1),e},_p.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"},_p.prototype.isHorizontal=function(){return this.p0.y===this.p1.y},_p.prototype.distance=function(){if(arguments[0]instanceof _p){var t=arguments[0];return Zu.distanceLineLine(this.p0,this.p1,t.p0,t.p1)}if(arguments[0]instanceof uu){var e=arguments[0];return Zu.distancePointLine(e,this.p0,this.p1)}},_p.prototype.pointAlong=function(t){var e=new uu;return e.x=this.p0.x+t*(this.p1.x-this.p0.x),e.y=this.p0.y+t*(this.p1.y-this.p0.y),e},_p.prototype.hashCode=function(){var t=nu.doubleToLongBits(this.p0.x);t^=31*nu.doubleToLongBits(this.p0.y);var e=Math.trunc(t)^Math.trunc(t>>32),r=nu.doubleToLongBits(this.p1.x);return r^=31*nu.doubleToLongBits(this.p1.y),e^Math.trunc(r)^Math.trunc(r>>32)},_p.prototype.interfaces_=function(){return[ou,lu]},_p.prototype.getClass=function(){return _p},_p.midPoint=function(t,e){return new uu((t.x+e.x)/2,(t.y+e.y)/2)},vp.serialVersionUID.get=function(){return 0x2d2172135f411c00},Object.defineProperties(_p,vp);var xp=function(){this.tempEnv1=new ku,this.tempEnv2=new ku,this._overlapSeg1=new _p,this._overlapSeg2=new _p};xp.prototype.overlap=function(){if(2===arguments.length);else if(4===arguments.length){var t=arguments[0],e=arguments[1],r=arguments[2],n=arguments[3];t.getLineSegment(e,this._overlapSeg1),r.getLineSegment(n,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}},xp.prototype.interfaces_=function(){return[]},xp.prototype.getClass=function(){return xp};var bp=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var t=arguments[0],e=arguments[1],r=arguments[2],n=arguments[3];this._pts=t,this._start=e,this._end=r,this._context=n};bp.prototype.getLineSegment=function(t,e){e.p0=this._pts[t],e.p1=this._pts[t+1]},bp.prototype.computeSelect=function(t,e,r,n){var i=this._pts[e],o=this._pts[r];if(n.tempEnv1.init(i,o),r-e==1)return n.select(this,e),null;if(!t.intersects(n.tempEnv1))return null;var s=Math.trunc((e+r)/2);e<s&&this.computeSelect(t,e,s,n),s<r&&this.computeSelect(t,s,r,n)},bp.prototype.getCoordinates=function(){for(var t=new Array(this._end-this._start+1).fill(null),e=0,r=this._start;r<=this._end;r++)t[e++]=this._pts[r];return t},bp.prototype.computeOverlaps=function(t,e){this.computeOverlapsInternal(this._start,this._end,t,t._start,t._end,e)},bp.prototype.setId=function(t){this._id=t},bp.prototype.select=function(t,e){this.computeSelect(t,this._start,this._end,e)},bp.prototype.getEnvelope=function(){if(null===this._env){var t=this._pts[this._start],e=this._pts[this._end];this._env=new ku(t,e)}return this._env},bp.prototype.getEndIndex=function(){return this._end},bp.prototype.getStartIndex=function(){return this._start},bp.prototype.getContext=function(){return this._context},bp.prototype.getId=function(){return this._id},bp.prototype.computeOverlapsInternal=function(t,e,r,n,i,o){var s=this._pts[t],a=this._pts[e],l=r._pts[n],u=r._pts[i];if(e-t==1&&i-n==1)return o.overlap(this,t,r,n),null;if(o.tempEnv1.init(s,a),o.tempEnv2.init(l,u),!o.tempEnv1.intersects(o.tempEnv2))return null;var c=Math.trunc((t+e)/2),h=Math.trunc((n+i)/2);t<c&&(n<h&&this.computeOverlapsInternal(t,c,r,n,h,o),h<i&&this.computeOverlapsInternal(t,c,r,h,i,o)),c<e&&(n<h&&this.computeOverlapsInternal(c,e,r,n,h,o),h<i&&this.computeOverlapsInternal(c,e,r,h,i,o))},bp.prototype.interfaces_=function(){return[]},bp.prototype.getClass=function(){return bp};var wp=function(){};wp.prototype.interfaces_=function(){return[]},wp.prototype.getClass=function(){return wp},wp.getChainStartIndices=function(t){var e=0,r=new cc;r.add(new vu(e));do{var n=wp.findChainEnd(t,e);r.add(new vu(n)),e=n}while(e<t.length-1);return wp.toIntArray(r)},wp.findChainEnd=function(t,e){for(var r=e;r<t.length-1&&t[r].equals2D(t[r+1]);)r++;if(r>=t.length-1)return t.length-1;for(var n=Gh.quadrant(t[r],t[r+1]),i=e+1;i<t.length;){if(!t[i-1].equals2D(t[i])&&Gh.quadrant(t[i-1],t[i])!==n)break;i++}return i-1},wp.getChains=function(){if(1===arguments.length){var t=arguments[0];return wp.getChains(t,null)}if(2===arguments.length){for(var e=arguments[0],r=arguments[1],n=new cc,i=wp.getChainStartIndices(e),o=0;o<i.length-1;o++){var s=new bp(e,i[o],i[o+1],r);n.add(s)}return n}},wp.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),r=0;r<e.length;r++)e[r]=t.get(r).intValue();return e};var Ep=function(){};Ep.prototype.computeNodes=function(t){},Ep.prototype.getNodedSubstrings=function(){},Ep.prototype.interfaces_=function(){return[]},Ep.prototype.getClass=function(){return Ep};var Sp=function(){if(this._segInt=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.setSegmentIntersector(t)}};Sp.prototype.setSegmentIntersector=function(t){this._segInt=t},Sp.prototype.interfaces_=function(){return[Ep]},Sp.prototype.getClass=function(){return Sp};var Ip=function(t){function e(e){e?t.call(this,e):t.call(this),this._monoChains=new cc,this._index=new up,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={SegmentOverlapAction:{configurable:!0}};return e.prototype.getMonotoneChains=function(){return this._monoChains},e.prototype.getNodedSubstrings=function(){return yp.getNodedSubstrings(this._nodedSegStrings)},e.prototype.getIndex=function(){return this._index},e.prototype.add=function(t){for(var e=this,r=wp.getChains(t.getCoordinates(),t).iterator();r.hasNext();){var n=r.next();n.setId(e._idCounter++),e._index.insert(n.getEnvelope(),n),e._monoChains.add(n)}},e.prototype.computeNodes=function(t){this._nodedSegStrings=t;for(var e=t.iterator();e.hasNext();)this.add(e.next());this.intersectChains()},e.prototype.intersectChains=function(){for(var t=this,e=new Tp(this._segInt),r=this._monoChains.iterator();r.hasNext();)for(var n=r.next(),i=t._index.query(n.getEnvelope()).iterator();i.hasNext();){var o=i.next();if(o.getId()>n.getId()&&(n.computeOverlaps(o,e),t._nOverlaps++),t._segInt.isDone())return null}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},r.SegmentOverlapAction.get=function(){return Tp},Object.defineProperties(e,r),e}(Sp),Tp=function(t){function e(){t.call(this),this._si=null;var e=arguments[0];this._si=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.overlap=function(){if(4!==arguments.length)return t.prototype.overlap.apply(this,arguments);var e=arguments[0],r=arguments[1],n=arguments[2],i=arguments[3],o=e.getContext(),s=n.getContext();this._si.processIntersections(o,r,s,i)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(xp),Cp=function t(){if(this._quadrantSegments=t.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=t.CAP_ROUND,this._joinStyle=t.JOIN_ROUND,this._mitreLimit=t.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=t.DEFAULT_SIMPLIFY_FACTOR,0===arguments.length);else if(1===arguments.length){var e=arguments[0];this.setQuadrantSegments(e)}else if(2===arguments.length){var r=arguments[0],n=arguments[1];this.setQuadrantSegments(r),this.setEndCapStyle(n)}else if(4===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3];this.setQuadrantSegments(i),this.setEndCapStyle(o),this.setJoinStyle(s),this.setMitreLimit(a)}},Mp={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};Cp.prototype.getEndCapStyle=function(){return this._endCapStyle},Cp.prototype.isSingleSided=function(){return this._isSingleSided},Cp.prototype.setQuadrantSegments=function(t){this._quadrantSegments=t,0===this._quadrantSegments&&(this._joinStyle=Cp.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=Cp.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),t<=0&&(this._quadrantSegments=1),this._joinStyle!==Cp.JOIN_ROUND&&(this._quadrantSegments=Cp.DEFAULT_QUADRANT_SEGMENTS)},Cp.prototype.getJoinStyle=function(){return this._joinStyle},Cp.prototype.setJoinStyle=function(t){this._joinStyle=t},Cp.prototype.setSimplifyFactor=function(t){this._simplifyFactor=t<0?0:t},Cp.prototype.getSimplifyFactor=function(){return this._simplifyFactor},Cp.prototype.getQuadrantSegments=function(){return this._quadrantSegments},Cp.prototype.setEndCapStyle=function(t){this._endCapStyle=t},Cp.prototype.getMitreLimit=function(){return this._mitreLimit},Cp.prototype.setMitreLimit=function(t){this._mitreLimit=t},Cp.prototype.setSingleSided=function(t){this._isSingleSided=t},Cp.prototype.interfaces_=function(){return[]},Cp.prototype.getClass=function(){return Cp},Cp.bufferDistanceError=function(t){var e=Math.PI/2/t;return 1-Math.cos(e/2)},Mp.CAP_ROUND.get=function(){return 1},Mp.CAP_FLAT.get=function(){return 2},Mp.CAP_SQUARE.get=function(){return 3},Mp.JOIN_ROUND.get=function(){return 1},Mp.JOIN_MITRE.get=function(){return 2},Mp.JOIN_BEVEL.get=function(){return 3},Mp.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8},Mp.DEFAULT_MITRE_LIMIT.get=function(){return 5},Mp.DEFAULT_SIMPLIFY_FACTOR.get=function(){return.01},Object.defineProperties(Cp,Mp);var Ap=function(t){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=Zu.COUNTERCLOCKWISE,this._inputLine=t||null},Pp={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};Ap.prototype.isDeletable=function(t,e,r,n){var i=this._inputLine[t],o=this._inputLine[e],s=this._inputLine[r];return!!this.isConcave(i,o,s)&&!!this.isShallow(i,o,s,n)&&this.isShallowSampled(i,o,t,r,n)},Ap.prototype.deleteShallowConcavities=function(){for(var t=this,e=1,r=this.findNextNonDeletedIndex(e),n=this.findNextNonDeletedIndex(r),i=!1;n<this._inputLine.length;){var o=!1;t.isDeletable(e,r,n,t._distanceTol)&&(t._isDeleted[r]=Ap.DELETE,o=!0,i=!0),e=o?n:r,r=t.findNextNonDeletedIndex(e),n=t.findNextNonDeletedIndex(r)}return i},Ap.prototype.isShallowConcavity=function(t,e,r,n){return Zu.computeOrientation(t,e,r)===this._angleOrientation&&Zu.distancePointLine(e,t,r)<n},Ap.prototype.isShallowSampled=function(t,e,r,n,i){var o=Math.trunc((n-r)/Ap.NUM_PTS_TO_CHECK);o<=0&&(o=1);for(var s=r;s<n;s+=o)if(!this.isShallow(t,e,this._inputLine[s],i))return!1;return!0},Ap.prototype.isConcave=function(t,e,r){var n=Zu.computeOrientation(t,e,r)===this._angleOrientation;return n},Ap.prototype.simplify=function(t){this._distanceTol=Math.abs(t),t<0&&(this._angleOrientation=Zu.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var e=!1;do{e=this.deleteShallowConcavities()}while(e);return this.collapseLine()},Ap.prototype.findNextNonDeletedIndex=function(t){for(var e=t+1;e<this._inputLine.length&&this._isDeleted[e]===Ap.DELETE;)e++;return e},Ap.prototype.isShallow=function(t,e,r,n){return Zu.distancePointLine(e,t,r)<n},Ap.prototype.collapseLine=function(){for(var t=new pc,e=0;e<this._inputLine.length;e++)this._isDeleted[e]!==Ap.DELETE&&t.add(this._inputLine[e]);return t.toCoordinateArray()},Ap.prototype.interfaces_=function(){return[]},Ap.prototype.getClass=function(){return Ap},Ap.simplify=function(t,e){return new Ap(t).simplify(e)},Pp.INIT.get=function(){return 0},Pp.DELETE.get=function(){return 1},Pp.KEEP.get=function(){return 1},Pp.NUM_PTS_TO_CHECK.get=function(){return 10},Object.defineProperties(Ap,Pp);var kp=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new cc},Lp={COORDINATE_ARRAY_TYPE:{configurable:!0}};kp.prototype.getCoordinates=function(){return this._ptList.toArray(kp.COORDINATE_ARRAY_TYPE)},kp.prototype.setPrecisionModel=function(t){this._precisionModel=t},kp.prototype.addPt=function(t){var e=new uu(t);if(this._precisionModel.makePrecise(e),this.isRedundant(e))return null;this._ptList.add(e)},kp.prototype.revere=function(){},kp.prototype.addPts=function(t,e){if(e)for(var r=0;r<t.length;r++)this.addPt(t[r]);else for(var n=t.length-1;n>=0;n--)this.addPt(t[n])},kp.prototype.isRedundant=function(t){if(this._ptList.size()<1)return!1;var e=this._ptList.get(this._ptList.size()-1);return t.distance(e)<this._minimimVertexDistance},kp.prototype.toString=function(){return(new vh).createLineString(this.getCoordinates()).toString()},kp.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var t=new uu(this._ptList.get(0)),e=this._ptList.get(this._ptList.size()-1);if(t.equals(e))return null;this._ptList.add(t)},kp.prototype.setMinimumVertexDistance=function(t){this._minimimVertexDistance=t},kp.prototype.interfaces_=function(){return[]},kp.prototype.getClass=function(){return kp},Lp.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)},Object.defineProperties(kp,Lp);var zp=function(){},Dp={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};zp.prototype.interfaces_=function(){return[]},zp.prototype.getClass=function(){return zp},zp.toDegrees=function(t){return 180*t/Math.PI},zp.normalize=function(t){for(;t>Math.PI;)t-=zp.PI_TIMES_2;for(;t<=-Math.PI;)t+=zp.PI_TIMES_2;return t},zp.angle=function(){if(1===arguments.length){var t=arguments[0];return Math.atan2(t.y,t.x)}if(2===arguments.length){var e=arguments[0],r=arguments[1],n=r.x-e.x,i=r.y-e.y;return Math.atan2(i,n)}},zp.isAcute=function(t,e,r){var n=t.x-e.x,i=t.y-e.y;return n*(r.x-e.x)+i*(r.y-e.y)>0},zp.isObtuse=function(t,e,r){var n=t.x-e.x,i=t.y-e.y;return n*(r.x-e.x)+i*(r.y-e.y)<0},zp.interiorAngle=function(t,e,r){var n=zp.angle(e,t),i=zp.angle(e,r);return Math.abs(i-n)},zp.normalizePositive=function(t){if(t<0){for(;t<0;)t+=zp.PI_TIMES_2;t>=zp.PI_TIMES_2&&(t=0)}else{for(;t>=zp.PI_TIMES_2;)t-=zp.PI_TIMES_2;t<0&&(t=0)}return t},zp.angleBetween=function(t,e,r){var n=zp.angle(e,t),i=zp.angle(e,r);return zp.diff(n,i)},zp.diff=function(t,e){var r=null;return(r=t<e?e-t:t-e)>Math.PI&&(r=2*Math.PI-r),r},zp.toRadians=function(t){return t*Math.PI/180},zp.getTurn=function(t,e){var r=Math.sin(e-t);return r>0?zp.COUNTERCLOCKWISE:r<0?zp.CLOCKWISE:zp.NONE},zp.angleBetweenOriented=function(t,e,r){var n=zp.angle(e,t),i=zp.angle(e,r)-n;return i<=-Math.PI?i+zp.PI_TIMES_2:i>Math.PI?i-zp.PI_TIMES_2:i},Dp.PI_TIMES_2.get=function(){return 2*Math.PI},Dp.PI_OVER_2.get=function(){return Math.PI/2},Dp.PI_OVER_4.get=function(){return Math.PI/4},Dp.COUNTERCLOCKWISE.get=function(){return Zu.COUNTERCLOCKWISE},Dp.CLOCKWISE.get=function(){return Zu.CLOCKWISE},Dp.NONE.get=function(){return Zu.COLLINEAR},Object.defineProperties(zp,Dp);var Rp=function t(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new _p,this._seg1=new _p,this._offset0=new _p,this._offset1=new _p,this._side=0,this._hasNarrowConcaveAngle=!1;var e=arguments[0],r=arguments[1],n=arguments[2];this._precisionModel=e,this._bufParams=r,this._li=new Gu,this._filletAngleQuantum=Math.PI/2/r.getQuadrantSegments(),r.getQuadrantSegments()>=8&&r.getJoinStyle()===Cp.JOIN_ROUND&&(this._closingSegLengthFactor=t.MAX_CLOSING_SEG_LEN_FACTOR),this.init(n)},Op={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};Rp.prototype.addNextSegment=function(t,e){if(this._s0=this._s1,this._s1=this._s2,this._s2=t,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var r=Zu.computeOrientation(this._s0,this._s1,this._s2),n=r===Zu.CLOCKWISE&&this._side===Ch.LEFT||r===Zu.COUNTERCLOCKWISE&&this._side===Ch.RIGHT;0===r?this.addCollinear(e):n?this.addOutsideTurn(r,e):this.addInsideTurn(r,e)},Rp.prototype.addLineEndCap=function(t,e){var r=new _p(t,e),n=new _p;this.computeOffsetSegment(r,Ch.LEFT,this._distance,n);var i=new _p;this.computeOffsetSegment(r,Ch.RIGHT,this._distance,i);var o=e.x-t.x,s=e.y-t.y,a=Math.atan2(s,o);switch(this._bufParams.getEndCapStyle()){case Cp.CAP_ROUND:this._segList.addPt(n.p1),this.addFilletArc(e,a+Math.PI/2,a-Math.PI/2,Zu.CLOCKWISE,this._distance),this._segList.addPt(i.p1);break;case Cp.CAP_FLAT:this._segList.addPt(n.p1),this._segList.addPt(i.p1);break;case Cp.CAP_SQUARE:var l=new uu;l.x=Math.abs(this._distance)*Math.cos(a),l.y=Math.abs(this._distance)*Math.sin(a);var u=new uu(n.p1.x+l.x,n.p1.y+l.y),c=new uu(i.p1.x+l.x,i.p1.y+l.y);this._segList.addPt(u),this._segList.addPt(c)}},Rp.prototype.getCoordinates=function(){return this._segList.getCoordinates()},Rp.prototype.addMitreJoin=function(t,e,r,n){var i=!0,o=null;try{o=Pu.intersection(e.p0,e.p1,r.p0,r.p1),(n<=0?1:o.distance(t)/Math.abs(n))>this._bufParams.getMitreLimit()&&(i=!1)}catch(t){if(!(t instanceof Mu))throw t;o=new uu(0,0),i=!1}i?this._segList.addPt(o):this.addLimitedMitreJoin(e,r,n,this._bufParams.getMitreLimit())},Rp.prototype.addFilletCorner=function(t,e,r,n,i){var o=e.x-t.x,s=e.y-t.y,a=Math.atan2(s,o),l=r.x-t.x,u=r.y-t.y,c=Math.atan2(u,l);n===Zu.CLOCKWISE?a<=c&&(a+=2*Math.PI):a>=c&&(a-=2*Math.PI),this._segList.addPt(e),this.addFilletArc(t,a,c,n,i),this._segList.addPt(r)},Rp.prototype.addOutsideTurn=function(t,e){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*Rp.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===Cp.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===Cp.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(e&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,t,this._distance),this._segList.addPt(this._offset1.p0))},Rp.prototype.createSquare=function(t){this._segList.addPt(new uu(t.x+this._distance,t.y+this._distance)),this._segList.addPt(new uu(t.x+this._distance,t.y-this._distance)),this._segList.addPt(new uu(t.x-this._distance,t.y-this._distance)),this._segList.addPt(new uu(t.x-this._distance,t.y+this._distance)),this._segList.closeRing()},Rp.prototype.addSegments=function(t,e){this._segList.addPts(t,e)},Rp.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)},Rp.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)},Rp.prototype.initSideSegments=function(t,e,r){this._s1=t,this._s2=e,this._side=r,this._seg1.setCoordinates(t,e),this.computeOffsetSegment(this._seg1,r,this._distance,this._offset1)},Rp.prototype.addLimitedMitreJoin=function(t,e,r,n){var i=this._seg0.p1,o=zp.angle(i,this._seg0.p0),s=zp.angleBetweenOriented(this._seg0.p0,i,this._seg1.p1)/2,a=zp.normalize(o+s),l=zp.normalize(a+Math.PI),u=n*r,c=r-u*Math.abs(Math.sin(s)),h=i.x+u*Math.cos(l),p=i.y+u*Math.sin(l),f=new uu(h,p),d=new _p(i,f),m=d.pointAlongOffset(1,c),g=d.pointAlongOffset(1,-c);this._side===Ch.LEFT?(this._segList.addPt(m),this._segList.addPt(g)):(this._segList.addPt(g),this._segList.addPt(m))},Rp.prototype.computeOffsetSegment=function(t,e,r,n){var i=e===Ch.LEFT?1:-1,o=t.p1.x-t.p0.x,s=t.p1.y-t.p0.y,a=Math.sqrt(o*o+s*s),l=i*r*o/a,u=i*r*s/a;n.p0.x=t.p0.x-u,n.p0.y=t.p0.y+l,n.p1.x=t.p1.x-u,n.p1.y=t.p1.y+l},Rp.prototype.addFilletArc=function(t,e,r,n,i){var o=n===Zu.CLOCKWISE?-1:1,s=Math.abs(e-r),a=Math.trunc(s/this._filletAngleQuantum+.5);if(a<1)return null;for(var l=s/a,u=0,c=new uu;u<s;){var h=e+o*u;c.x=t.x+i*Math.cos(h),c.y=t.y+i*Math.sin(h),this._segList.addPt(c),u+=l}},Rp.prototype.addInsideTurn=function(t,e){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*Rp.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var r=new uu((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(r);var n=new uu((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(n)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}},Rp.prototype.createCircle=function(t){var e=new uu(t.x+this._distance,t.y);this._segList.addPt(e),this.addFilletArc(t,0,2*Math.PI,-1,this._distance),this._segList.closeRing()},Rp.prototype.addBevelJoin=function(t,e){this._segList.addPt(t.p1),this._segList.addPt(e.p0)},Rp.prototype.init=function(t){this._distance=t,this._maxCurveSegmentError=t*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new kp,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(t*Rp.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)},Rp.prototype.addCollinear=function(t){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===Cp.JOIN_BEVEL||this._bufParams.getJoinStyle()===Cp.JOIN_MITRE?(t&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,Zu.CLOCKWISE,this._distance))},Rp.prototype.closeRing=function(){this._segList.closeRing()},Rp.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle},Rp.prototype.interfaces_=function(){return[]},Rp.prototype.getClass=function(){return Rp},Op.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return.001},Op.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return.001},Op.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6},Op.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80},Object.defineProperties(Rp,Op);var Np=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var t=arguments[0],e=arguments[1];this._precisionModel=t,this._bufParams=e};Np.prototype.getOffsetCurve=function(t,e){if(this._distance=e,0===e)return null;var r=e<0,n=Math.abs(e),i=this.getSegGen(n);t.length<=1?this.computePointCurve(t[0],i):this.computeOffsetCurve(t,r,i);var o=i.getCoordinates();return r&&fc.reverse(o),o},Np.prototype.computeSingleSidedBufferCurve=function(t,e,r){var n=this.simplifyTolerance(this._distance);if(e){r.addSegments(t,!0);var i=Ap.simplify(t,-n),o=i.length-1;r.initSideSegments(i[o],i[o-1],Ch.LEFT),r.addFirstSegment();for(var s=o-2;s>=0;s--)r.addNextSegment(i[s],!0)}else{r.addSegments(t,!1);var a=Ap.simplify(t,n),l=a.length-1;r.initSideSegments(a[0],a[1],Ch.LEFT),r.addFirstSegment();for(var u=2;u<=l;u++)r.addNextSegment(a[u],!0)}r.addLastSegment(),r.closeRing()},Np.prototype.computeRingBufferCurve=function(t,e,r){var n=this.simplifyTolerance(this._distance);e===Ch.RIGHT&&(n=-n);var i=Ap.simplify(t,n),o=i.length-1;r.initSideSegments(i[o-1],i[0],e);for(var s=1;s<=o;s++){var a=1!==s;r.addNextSegment(i[s],a)}r.closeRing()},Np.prototype.computeLineBufferCurve=function(t,e){var r=this.simplifyTolerance(this._distance),n=Ap.simplify(t,r),i=n.length-1;e.initSideSegments(n[0],n[1],Ch.LEFT);for(var o=2;o<=i;o++)e.addNextSegment(n[o],!0);e.addLastSegment(),e.addLineEndCap(n[i-1],n[i]);var s=Ap.simplify(t,-r),a=s.length-1;e.initSideSegments(s[a],s[a-1],Ch.LEFT);for(var l=a-2;l>=0;l--)e.addNextSegment(s[l],!0);e.addLastSegment(),e.addLineEndCap(s[1],s[0]),e.closeRing()},Np.prototype.computePointCurve=function(t,e){switch(this._bufParams.getEndCapStyle()){case Cp.CAP_ROUND:e.createCircle(t);break;case Cp.CAP_SQUARE:e.createSquare(t)}},Np.prototype.getLineCurve=function(t,e){if(this._distance=e,e<0&&!this._bufParams.isSingleSided())return null;if(0===e)return null;var r=Math.abs(e),n=this.getSegGen(r);if(t.length<=1)this.computePointCurve(t[0],n);else if(this._bufParams.isSingleSided()){var i=e<0;this.computeSingleSidedBufferCurve(t,i,n)}else this.computeLineBufferCurve(t,n);return n.getCoordinates()},Np.prototype.getBufferParameters=function(){return this._bufParams},Np.prototype.simplifyTolerance=function(t){return t*this._bufParams.getSimplifyFactor()},Np.prototype.getRingCurve=function(t,e,r){if(this._distance=r,t.length<=2)return this.getLineCurve(t,r);if(0===r)return Np.copyCoordinates(t);var n=this.getSegGen(r);return this.computeRingBufferCurve(t,e,n),n.getCoordinates()},Np.prototype.computeOffsetCurve=function(t,e,r){var n=this.simplifyTolerance(this._distance);if(e){var i=Ap.simplify(t,-n),o=i.length-1;r.initSideSegments(i[o],i[o-1],Ch.LEFT),r.addFirstSegment();for(var s=o-2;s>=0;s--)r.addNextSegment(i[s],!0)}else{var a=Ap.simplify(t,n),l=a.length-1;r.initSideSegments(a[0],a[1],Ch.LEFT),r.addFirstSegment();for(var u=2;u<=l;u++)r.addNextSegment(a[u],!0)}r.addLastSegment()},Np.prototype.getSegGen=function(t){return new Rp(this._precisionModel,this._bufParams,t)},Np.prototype.interfaces_=function(){return[]},Np.prototype.getClass=function(){return Np},Np.copyCoordinates=function(t){for(var e=new Array(t.length).fill(null),r=0;r<e.length;r++)e[r]=new uu(t[r]);return e};var Fp=function(){this._subgraphs=null,this._seg=new _p,this._cga=new Zu;var t=arguments[0];this._subgraphs=t},Bp={DepthSegment:{configurable:!0}};Fp.prototype.findStabbedSegments=function(){var t=this;if(1===arguments.length){for(var e=arguments[0],r=new cc,n=this._subgraphs.iterator();n.hasNext();){var i=n.next(),o=i.getEnvelope();e.y<o.getMinY()||e.y>o.getMaxY()||t.findStabbedSegments(e,i.getDirectedEdges(),r)}return r}if(3===arguments.length)if(mu(arguments[2],lc)&&arguments[0]instanceof uu&&arguments[1]instanceof Zh)for(var s=arguments[0],a=arguments[1],l=arguments[2],u=a.getEdge().getCoordinates(),c=0;c<u.length-1;c++){t._seg.p0=u[c],t._seg.p1=u[c+1],t._seg.p0.y>t._seg.p1.y&&t._seg.reverse();var h=Math.max(t._seg.p0.x,t._seg.p1.x);if(!(h<s.x)&&!(t._seg.isHorizontal()||s.y<t._seg.p0.y||s.y>t._seg.p1.y||Zu.computeOrientation(t._seg.p0,t._seg.p1,s)===Zu.RIGHT)){var p=a.getDepth(Ch.LEFT);t._seg.p0.equals(u[c])||(p=a.getDepth(Ch.RIGHT));var f=new jp(t._seg,p);l.add(f)}}else if(mu(arguments[2],lc)&&arguments[0]instanceof uu&&mu(arguments[1],lc))for(var d=arguments[0],m=arguments[1],g=arguments[2],y=m.iterator();y.hasNext();){var _=y.next();_.isForward()&&t.findStabbedSegments(d,_,g)}},Fp.prototype.getDepth=function(t){var e=this.findStabbedSegments(t);return 0===e.size()?0:np.min(e)._leftDepth},Fp.prototype.interfaces_=function(){return[]},Fp.prototype.getClass=function(){return Fp},Bp.DepthSegment.get=function(){return jp},Object.defineProperties(Fp,Bp);var jp=function(){this._upwardSeg=null,this._leftDepth=null;var t=arguments[0],e=arguments[1];this._upwardSeg=new _p(t),this._leftDepth=e};jp.prototype.compareTo=function(t){var e=t;if(this._upwardSeg.minX()>=e._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=e._upwardSeg.minX())return-1;var r=this._upwardSeg.orientationIndex(e._upwardSeg);return 0!==r||0!==(r=-1*e._upwardSeg.orientationIndex(this._upwardSeg))?r:this._upwardSeg.compareTo(e._upwardSeg)},jp.prototype.compareX=function(t,e){var r=t.p0.compareTo(e.p0);return 0!==r?r:t.p1.compareTo(e.p1)},jp.prototype.toString=function(){return this._upwardSeg.toString()},jp.prototype.interfaces_=function(){return[ou]},jp.prototype.getClass=function(){return jp};var Up=function(t,e,r){this.p0=t||null,this.p1=e||null,this.p2=r||null};Up.prototype.area=function(){return Up.area(this.p0,this.p1,this.p2)},Up.prototype.signedArea=function(){return Up.signedArea(this.p0,this.p1,this.p2)},Up.prototype.interpolateZ=function(t){if(null===t)throw new ru("Supplied point is null.");return Up.interpolateZ(t,this.p0,this.p1,this.p2)},Up.prototype.longestSideLength=function(){return Up.longestSideLength(this.p0,this.p1,this.p2)},Up.prototype.isAcute=function(){return Up.isAcute(this.p0,this.p1,this.p2)},Up.prototype.circumcentre=function(){return Up.circumcentre(this.p0,this.p1,this.p2)},Up.prototype.area3D=function(){return Up.area3D(this.p0,this.p1,this.p2)},Up.prototype.centroid=function(){return Up.centroid(this.p0,this.p1,this.p2)},Up.prototype.inCentre=function(){return Up.inCentre(this.p0,this.p1,this.p2)},Up.prototype.interfaces_=function(){return[]},Up.prototype.getClass=function(){return Up},Up.area=function(t,e,r){return Math.abs(((r.x-t.x)*(e.y-t.y)-(e.x-t.x)*(r.y-t.y))/2)},Up.signedArea=function(t,e,r){return((r.x-t.x)*(e.y-t.y)-(e.x-t.x)*(r.y-t.y))/2},Up.det=function(t,e,r,n){return t*n-e*r},Up.interpolateZ=function(t,e,r,n){var i=e.x,o=e.y,s=r.x-i,a=n.x-i,l=r.y-o,u=n.y-o,c=s*u-a*l,h=t.x-i,p=t.y-o,f=(u*h-a*p)/c,d=(-l*h+s*p)/c;return e.z+f*(r.z-e.z)+d*(n.z-e.z)},Up.longestSideLength=function(t,e,r){var n=t.distance(e),i=e.distance(r),o=r.distance(t),s=n;return i>s&&(s=i),o>s&&(s=o),s},Up.isAcute=function(t,e,r){return!!zp.isAcute(t,e,r)&&!!zp.isAcute(e,r,t)&&!!zp.isAcute(r,t,e)},Up.circumcentre=function(t,e,r){var n=r.x,i=r.y,o=t.x-n,s=t.y-i,a=e.x-n,l=e.y-i,u=2*Up.det(o,s,a,l),c=Up.det(s,o*o+s*s,l,a*a+l*l),h=Up.det(o,o*o+s*s,a,a*a+l*l);return new uu(n-c/u,i+h/u)},Up.perpendicularBisector=function(t,e){var r=e.x-t.x,n=e.y-t.y,i=new Pu(t.x+r/2,t.y+n/2,1),o=new Pu(t.x-n+r/2,t.y+r+n/2,1);return new Pu(i,o)},Up.angleBisector=function(t,e,r){var n=e.distance(t),i=n/(n+e.distance(r)),o=r.x-t.x,s=r.y-t.y;return new uu(t.x+i*o,t.y+i*s)},Up.area3D=function(t,e,r){var n=e.x-t.x,i=e.y-t.y,o=e.z-t.z,s=r.x-t.x,a=r.y-t.y,l=r.z-t.z,u=i*l-o*a,c=o*s-n*l,h=n*a-i*s,p=u*u+c*c+h*h,f=Math.sqrt(p)/2;return f},Up.centroid=function(t,e,r){var n=(t.x+e.x+r.x)/3,i=(t.y+e.y+r.y)/3;return new uu(n,i)},Up.inCentre=function(t,e,r){var n=e.distance(r),i=t.distance(r),o=t.distance(e),s=n+i+o,a=(n*t.x+i*e.x+o*r.x)/s,l=(n*t.y+i*e.y+o*r.y)/s;return new uu(a,l)};var Vp=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new cc;var t=arguments[0],e=arguments[1],r=arguments[2];this._inputGeom=t,this._distance=e,this._curveBuilder=r};Vp.prototype.addPoint=function(t){if(this._distance<=0)return null;var e=t.getCoordinates(),r=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(r,fu.EXTERIOR,fu.INTERIOR)},Vp.prototype.addPolygon=function(t){var e=this,r=this._distance,n=Ch.LEFT;this._distance<0&&(r=-this._distance,n=Ch.RIGHT);var i=t.getExteriorRing(),o=fc.removeRepeatedPoints(i.getCoordinates());if(this._distance<0&&this.isErodedCompletely(i,this._distance))return null;if(this._distance<=0&&o.length<3)return null;this.addPolygonRing(o,r,n,fu.EXTERIOR,fu.INTERIOR);for(var s=0;s<t.getNumInteriorRing();s++){var a=t.getInteriorRingN(s),l=fc.removeRepeatedPoints(a.getCoordinates());e._distance>0&&e.isErodedCompletely(a,-e._distance)||e.addPolygonRing(l,r,Ch.opposite(n),fu.INTERIOR,fu.EXTERIOR)}},Vp.prototype.isTriangleErodedCompletely=function(t,e){var r=new Up(t[0],t[1],t[2]),n=r.inCentre();return Zu.distancePointLine(n,r.p0,r.p1)<Math.abs(e)},Vp.prototype.addLineString=function(t){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var e=fc.removeRepeatedPoints(t.getCoordinates()),r=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(r,fu.EXTERIOR,fu.INTERIOR)},Vp.prototype.addCurve=function(t,e,r){if(null===t||t.length<2)return null;var n=new yp(t,new Oh(0,fu.BOUNDARY,e,r));this._curveList.add(n)},Vp.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList},Vp.prototype.addPolygonRing=function(t,e,r,n,i){if(0===e&&t.length<nh.MINIMUM_VALID_SIZE)return null;var o=n,s=i;t.length>=nh.MINIMUM_VALID_SIZE&&Zu.isCCW(t)&&(o=i,s=n,r=Ch.opposite(r));var a=this._curveBuilder.getRingCurve(t,r,e);this.addCurve(a,o,s)},Vp.prototype.add=function(t){if(t.isEmpty())return null;t instanceof eh?this.addPolygon(t):t instanceof Jc?this.addLineString(t):t instanceof Qc?this.addPoint(t):(t instanceof rh||t instanceof Bc||t instanceof ih||t instanceof Fc)&&this.addCollection(t)},Vp.prototype.isErodedCompletely=function(t,e){var r=t.getCoordinates();if(r.length<4)return e<0;if(4===r.length)return this.isTriangleErodedCompletely(r,e);var n=t.getEnvelopeInternal(),i=Math.min(n.getHeight(),n.getWidth());return e<0&&2*Math.abs(e)>i},Vp.prototype.addCollection=function(t){for(var e=0;e<t.getNumGeometries();e++){var r=t.getGeometryN(e);this.add(r)}},Vp.prototype.interfaces_=function(){return[]},Vp.prototype.getClass=function(){return Vp};var Gp=function(){};Gp.prototype.locate=function(t){},Gp.prototype.interfaces_=function(){return[]},Gp.prototype.getClass=function(){return Gp};var qp=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var t=arguments[0];this._parent=t,this._atStart=!0,this._index=0,this._max=t.getNumGeometries()};qp.prototype.next=function(){if(this._atStart)return this._atStart=!1,qp.isAtomic(this._parent)&&this._index++,this._parent;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new uc;var t=this._parent.getGeometryN(this._index++);return t instanceof Fc?(this._subcollectionIterator=new qp(t),this._subcollectionIterator.next()):t},qp.prototype.remove=function(){throw new Error(this.getClass().getName())},qp.prototype.hasNext=function(){if(this._atStart)return!0;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)},qp.prototype.interfaces_=function(){return[ac]},qp.prototype.getClass=function(){return qp},qp.isAtomic=function(t){return!(t instanceof Fc)};var $p=function(){this._geom=null;var t=arguments[0];this._geom=t};$p.prototype.locate=function(t){return $p.locate(t,this._geom)},$p.prototype.interfaces_=function(){return[Gp]},$p.prototype.getClass=function(){return $p},$p.isPointInRing=function(t,e){return!!e.getEnvelopeInternal().intersects(t)&&Zu.isPointInRing(t,e.getCoordinates())},$p.containsPointInPolygon=function(t,e){if(e.isEmpty())return!1;var r=e.getExteriorRing();if(!$p.isPointInRing(t,r))return!1;for(var n=0;n<e.getNumInteriorRing();n++){var i=e.getInteriorRingN(n);if($p.isPointInRing(t,i))return!1}return!0},$p.containsPoint=function(t,e){if(e instanceof eh)return $p.containsPointInPolygon(t,e);if(e instanceof Fc)for(var r=new qp(e);r.hasNext();){var n=r.next();if(n!==e&&$p.containsPoint(t,n))return!0}return!1},$p.locate=function(t,e){return e.isEmpty()?fu.EXTERIOR:$p.containsPoint(t,e)?fu.INTERIOR:fu.EXTERIOR};var Zp=function(){this._edgeMap=new Mc,this._edgeList=null,this._ptInAreaLocation=[fu.NONE,fu.NONE]};Zp.prototype.getNextCW=function(t){this.getEdges();var e=this._edgeList.indexOf(t),r=e-1;return 0===e&&(r=this._edgeList.size()-1),this._edgeList.get(r)},Zp.prototype.propagateSideLabels=function(t){for(var e=fu.NONE,r=this.iterator();r.hasNext();){var n=r.next().getLabel();n.isArea(t)&&n.getLocation(t,Ch.LEFT)!==fu.NONE&&(e=n.getLocation(t,Ch.LEFT))}if(e===fu.NONE)return null;for(var i=e,o=this.iterator();o.hasNext();){var s=o.next(),a=s.getLabel();if(a.getLocation(t,Ch.ON)===fu.NONE&&a.setLocation(t,Ch.ON,i),a.isArea(t)){var l=a.getLocation(t,Ch.LEFT),u=a.getLocation(t,Ch.RIGHT);if(u!==fu.NONE){if(u!==i)throw new Lh("side location conflict",s.getCoordinate());l===fu.NONE&&ju.shouldNeverReachHere("found single null side (at "+s.getCoordinate()+")"),i=l}else ju.isTrue(a.getLocation(t,Ch.LEFT)===fu.NONE,"found single null side"),a.setLocation(t,Ch.RIGHT,i),a.setLocation(t,Ch.LEFT,i)}}},Zp.prototype.getCoordinate=function(){var t=this.iterator();return t.hasNext()?t.next().getCoordinate():null},Zp.prototype.print=function(t){Au.out.println("EdgeEndStar:   "+this.getCoordinate());for(var e=this.iterator();e.hasNext();)e.next().print(t)},Zp.prototype.isAreaLabelsConsistent=function(t){return this.computeEdgeEndLabels(t.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)},Zp.prototype.checkAreaLabelsConsistent=function(t){var e=this.getEdges();if(e.size()<=0)return!0;var r=e.size()-1,n=e.get(r).getLabel().getLocation(t,Ch.LEFT);ju.isTrue(n!==fu.NONE,"Found unlabelled area edge");for(var i=n,o=this.iterator();o.hasNext();){var s=o.next().getLabel();ju.isTrue(s.isArea(t),"Found non-area edge");var a=s.getLocation(t,Ch.LEFT),l=s.getLocation(t,Ch.RIGHT);if(a===l)return!1;if(l!==i)return!1;i=a}return!0},Zp.prototype.findIndex=function(t){this.iterator();for(var e=0;e<this._edgeList.size();e++)if(this._edgeList.get(e)===t)return e;return-1},Zp.prototype.iterator=function(){return this.getEdges().iterator()},Zp.prototype.getEdges=function(){return null===this._edgeList&&(this._edgeList=new cc(this._edgeMap.values())),this._edgeList},Zp.prototype.getLocation=function(t,e,r){return this._ptInAreaLocation[t]===fu.NONE&&(this._ptInAreaLocation[t]=$p.locate(e,r[t].getGeometry())),this._ptInAreaLocation[t]},Zp.prototype.toString=function(){var t=new _u;t.append("EdgeEndStar:   "+this.getCoordinate()),t.append("\n");for(var e=this.iterator();e.hasNext();){var r=e.next();t.append(r),t.append("\n")}return t.toString()},Zp.prototype.computeEdgeEndLabels=function(t){for(var e=this.iterator();e.hasNext();)e.next().computeLabel(t)},Zp.prototype.computeLabelling=function(t){this.computeEdgeEndLabels(t[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var e=[!1,!1],r=this.iterator();r.hasNext();)for(var n=r.next().getLabel(),i=0;i<2;i++)n.isLine(i)&&n.getLocation(i)===fu.BOUNDARY&&(e[i]=!0);for(var o=this.iterator();o.hasNext();)for(var s=o.next(),a=s.getLabel(),l=0;l<2;l++)if(a.isAnyNull(l)){var u=fu.NONE;if(e[l])u=fu.EXTERIOR;else{var c=s.getCoordinate();u=this.getLocation(l,c,t)}a.setAllLocationsIfNull(l,u)}},Zp.prototype.getDegree=function(){return this._edgeMap.size()},Zp.prototype.insertEdgeEnd=function(t,e){this._edgeMap.put(t,e),this._edgeList=null},Zp.prototype.interfaces_=function(){return[]},Zp.prototype.getClass=function(){return Zp};var Xp=function(t){function e(){t.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.linkResultDirectedEdges=function(){var t=this;this.getResultAreaEdges();for(var e=null,r=null,n=this._SCANNING_FOR_INCOMING,i=0;i<this._resultAreaEdgeList.size();i++){var o=t._resultAreaEdgeList.get(i),s=o.getSym();if(o.getLabel().isArea())switch(null===e&&o.isInResult()&&(e=o),n){case t._SCANNING_FOR_INCOMING:if(!s.isInResult())continue;r=s,n=t._LINKING_TO_OUTGOING;break;case t._LINKING_TO_OUTGOING:if(!o.isInResult())continue;r.setNext(o),n=t._SCANNING_FOR_INCOMING}}if(n===this._LINKING_TO_OUTGOING){if(null===e)throw new Lh("no outgoing dirEdge found",this.getCoordinate());ju.isTrue(e.isInResult(),"unable to link last incoming dirEdge"),r.setNext(e)}},e.prototype.insert=function(t){var e=t;this.insertEdgeEnd(e,e)},e.prototype.getRightmostEdge=function(){var t=this.getEdges(),e=t.size();if(e<1)return null;var r=t.get(0);if(1===e)return r;var n=t.get(e-1),i=r.getQuadrant(),o=n.getQuadrant();return Gh.isNorthern(i)&&Gh.isNorthern(o)?r:Gh.isNorthern(i)||Gh.isNorthern(o)?0!==r.getDy()?r:0!==n.getDy()?n:(ju.shouldNeverReachHere("found two horizontal edges incident on node"),null):n},e.prototype.print=function(t){Au.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var e=this.iterator();e.hasNext();){var r=e.next();t.print("out "),r.print(t),t.println(),t.print("in "),r.getSym().print(t),t.println()}},e.prototype.getResultAreaEdges=function(){if(null!==this._resultAreaEdgeList)return this._resultAreaEdgeList;this._resultAreaEdgeList=new cc;for(var t=this.iterator();t.hasNext();){var e=t.next();(e.isInResult()||e.getSym().isInResult())&&this._resultAreaEdgeList.add(e)}return this._resultAreaEdgeList},e.prototype.updateLabelling=function(t){for(var e=this.iterator();e.hasNext();){var r=e.next().getLabel();r.setAllLocationsIfNull(0,t.getLocation(0)),r.setAllLocationsIfNull(1,t.getLocation(1))}},e.prototype.linkAllDirectedEdges=function(){this.getEdges();for(var t=null,e=null,r=this._edgeList.size()-1;r>=0;r--){var n=this._edgeList.get(r),i=n.getSym();null===e&&(e=i),null!==t&&i.setNext(t),t=n}e.setNext(t)},e.prototype.computeDepths=function(){var t=this;if(1===arguments.length){var e=arguments[0],r=this.findIndex(e),n=e.getDepth(Ch.LEFT),i=e.getDepth(Ch.RIGHT),o=this.computeDepths(r+1,this._edgeList.size(),n),s=this.computeDepths(0,r,o);if(s!==i)throw new Lh("depth mismatch at "+e.getCoordinate())}else if(3===arguments.length){for(var a=arguments[0],l=arguments[1],u=arguments[2],c=u,h=a;h<l;h++){var p=t._edgeList.get(h);p.setEdgeDepths(Ch.RIGHT,c),c=p.getDepth(Ch.LEFT)}return c}},e.prototype.mergeSymLabels=function(){for(var t=this.iterator();t.hasNext();){var e=t.next();e.getLabel().merge(e.getSym().getLabel())}},e.prototype.linkMinimalDirectedEdges=function(t){for(var e=this,r=null,n=null,i=this._SCANNING_FOR_INCOMING,o=this._resultAreaEdgeList.size()-1;o>=0;o--){var s=e._resultAreaEdgeList.get(o),a=s.getSym();switch(null===r&&s.getEdgeRing()===t&&(r=s),i){case e._SCANNING_FOR_INCOMING:if(a.getEdgeRing()!==t)continue;n=a,i=e._LINKING_TO_OUTGOING;break;case e._LINKING_TO_OUTGOING:if(s.getEdgeRing()!==t)continue;n.setNextMin(s),i=e._SCANNING_FOR_INCOMING}}i===this._LINKING_TO_OUTGOING&&(ju.isTrue(null!==r,"found null for first outgoing dirEdge"),ju.isTrue(r.getEdgeRing()===t,"unable to link last incoming dirEdge"),n.setNextMin(r))},e.prototype.getOutgoingDegree=function(){if(0===arguments.length){for(var t=0,e=this.iterator();e.hasNext();){var r=e.next();r.isInResult()&&t++}return t}if(1===arguments.length){for(var n=arguments[0],i=0,o=this.iterator();o.hasNext();){var s=o.next();s.getEdgeRing()===n&&i++}return i}},e.prototype.getLabel=function(){return this._label},e.prototype.findCoveredLineEdges=function(){for(var t=fu.NONE,e=this.iterator();e.hasNext();){var r=e.next(),n=r.getSym();if(!r.isLineEdge()){if(r.isInResult()){t=fu.INTERIOR;break}if(n.isInResult()){t=fu.EXTERIOR;break}}}if(t===fu.NONE)return null;for(var i=t,o=this.iterator();o.hasNext();){var s=o.next(),a=s.getSym();s.isLineEdge()?s.getEdge().setCovered(i===fu.INTERIOR):(s.isInResult()&&(i=fu.EXTERIOR),a.isInResult()&&(i=fu.INTERIOR))}},e.prototype.computeLabelling=function(e){t.prototype.computeLabelling.call(this,e),this._label=new Oh(fu.NONE);for(var r=this.iterator();r.hasNext();)for(var n=r.next().getEdge().getLabel(),i=0;i<2;i++){var o=n.getLocation(i);o!==fu.INTERIOR&&o!==fu.BOUNDARY||this._label.setLocation(i,fu.INTERIOR)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Zp),Wp=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createNode=function(t){return new Uh(t,new Xp)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Xh),Yp=function t(){this._pts=null,this._orientation=null;var e=arguments[0];this._pts=e,this._orientation=t.orientation(e)};Yp.prototype.compareTo=function(t){var e=t;return Yp.compareOriented(this._pts,this._orientation,e._pts,e._orientation)},Yp.prototype.interfaces_=function(){return[ou]},Yp.prototype.getClass=function(){return Yp},Yp.orientation=function(t){return 1===fc.increasingDirection(t)},Yp.compareOriented=function(t,e,r,n){for(var i=e?1:-1,o=n?1:-1,s=e?t.length:-1,a=n?r.length:-1,l=e?0:t.length-1,u=n?0:r.length-1;;){var c=t[l].compareTo(r[u]);if(0!==c)return c;var h=(l+=i)===s,p=(u+=o)===a;if(h&&!p)return-1;if(!h&&p)return 1;if(h&&p)return 0}};var Hp=function(){this._edges=new cc,this._ocaMap=new Mc};Hp.prototype.print=function(t){t.print("MULTILINESTRING ( ");for(var e=0;e<this._edges.size();e++){var r=this._edges.get(e);e>0&&t.print(","),t.print("(");for(var n=r.getCoordinates(),i=0;i<n.length;i++)i>0&&t.print(","),t.print(n[i].x+" "+n[i].y);t.println(")")}t.print(")  ")},Hp.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next())},Hp.prototype.findEdgeIndex=function(t){for(var e=0;e<this._edges.size();e++)if(this._edges.get(e).equals(t))return e;return-1},Hp.prototype.iterator=function(){return this._edges.iterator()},Hp.prototype.getEdges=function(){return this._edges},Hp.prototype.get=function(t){return this._edges.get(t)},Hp.prototype.findEqualEdge=function(t){var e=new Yp(t.getCoordinates());return this._ocaMap.get(e)},Hp.prototype.add=function(t){this._edges.add(t);var e=new Yp(t.getCoordinates());this._ocaMap.put(e,t)},Hp.prototype.interfaces_=function(){return[]},Hp.prototype.getClass=function(){return Hp};var Jp=function(){};Jp.prototype.processIntersections=function(t,e,r,n){},Jp.prototype.isDone=function(){},Jp.prototype.interfaces_=function(){return[]},Jp.prototype.getClass=function(){return Jp};var Kp=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var t=arguments[0];this._li=t};Kp.prototype.isTrivialIntersection=function(t,e,r,n){if(t===r&&1===this._li.getIntersectionNum()){if(Kp.isAdjacentSegments(e,n))return!0;if(t.isClosed()){var i=t.size()-1;if(0===e&&n===i||0===n&&e===i)return!0}}return!1},Kp.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},Kp.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},Kp.prototype.getLineIntersector=function(){return this._li},Kp.prototype.hasProperIntersection=function(){return this._hasProper},Kp.prototype.processIntersections=function(t,e,r,n){if(t===r&&e===n)return null;this.numTests++;var i=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=r.getCoordinates()[n],a=r.getCoordinates()[n+1];this._li.computeIntersection(i,o,s,a),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(t,e,r,n)||(this._hasIntersection=!0,t.addIntersections(this._li,e,0),r.addIntersections(this._li,n,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))},Kp.prototype.hasIntersection=function(){return this._hasIntersection},Kp.prototype.isDone=function(){return!1},Kp.prototype.hasInteriorIntersection=function(){return this._hasInterior},Kp.prototype.interfaces_=function(){return[Jp]},Kp.prototype.getClass=function(){return Kp},Kp.isAdjacentSegments=function(t,e){return 1===Math.abs(t-e)};var Qp=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var t=arguments[0],e=arguments[1],r=arguments[2];this.coord=new uu(t),this.segmentIndex=e,this.dist=r};Qp.prototype.getSegmentIndex=function(){return this.segmentIndex},Qp.prototype.getCoordinate=function(){return this.coord},Qp.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex),t.println(" dist = "+this.dist)},Qp.prototype.compareTo=function(t){var e=t;return this.compare(e.segmentIndex,e.dist)},Qp.prototype.isEndPoint=function(t){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===t},Qp.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist},Qp.prototype.getDistance=function(){return this.dist},Qp.prototype.compare=function(t,e){return this.segmentIndex<t?-1:this.segmentIndex>t?1:this.dist<e?-1:this.dist>e?1:0},Qp.prototype.interfaces_=function(){return[ou]},Qp.prototype.getClass=function(){return Qp};var tf=function(){this._nodeMap=new Mc,this.edge=null;var t=arguments[0];this.edge=t};tf.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();)e.next().print(t)},tf.prototype.iterator=function(){return this._nodeMap.values().iterator()},tf.prototype.addSplitEdges=function(t){this.addEndpoints();for(var e=this.iterator(),r=e.next();e.hasNext();){var n=e.next(),i=this.createSplitEdge(r,n);t.add(i),r=n}},tf.prototype.addEndpoints=function(){var t=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[t],t,0)},tf.prototype.createSplitEdge=function(t,e){var r=e.segmentIndex-t.segmentIndex+2,n=this.edge.pts[e.segmentIndex],i=e.dist>0||!e.coord.equals2D(n);i||r--;var o=new Array(r).fill(null),s=0;o[s++]=new uu(t.coord);for(var a=t.segmentIndex+1;a<=e.segmentIndex;a++)o[s++]=this.edge.pts[a];return i&&(o[s]=e.coord),new sf(o,new Oh(this.edge._label))},tf.prototype.add=function(t,e,r){var n=new Qp(t,e,r),i=this._nodeMap.get(n);return null!==i?i:(this._nodeMap.put(n,n),n)},tf.prototype.isIntersection=function(t){for(var e=this.iterator();e.hasNext();)if(e.next().coord.equals(t))return!0;return!1},tf.prototype.interfaces_=function(){return[]},tf.prototype.getClass=function(){return tf};var ef=function(){};ef.prototype.getChainStartIndices=function(t){var e=0,r=new cc;r.add(new vu(e));do{var n=this.findChainEnd(t,e);r.add(new vu(n)),e=n}while(e<t.length-1);return ef.toIntArray(r)},ef.prototype.findChainEnd=function(t,e){for(var r=Gh.quadrant(t[e],t[e+1]),n=e+1;n<t.length;){if(Gh.quadrant(t[n-1],t[n])!==r)break;n++}return n-1},ef.prototype.interfaces_=function(){return[]},ef.prototype.getClass=function(){return ef},ef.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),r=0;r<e.length;r++)e[r]=t.get(r).intValue();return e};var rf=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new ku,this.env2=new ku;var t=arguments[0];this.e=t,this.pts=t.getCoordinates();var e=new ef;this.startIndex=e.getChainStartIndices(this.pts)};rf.prototype.getCoordinates=function(){return this.pts},rf.prototype.getMaxX=function(t){var e=this.pts[this.startIndex[t]].x,r=this.pts[this.startIndex[t+1]].x;return e>r?e:r},rf.prototype.getMinX=function(t){var e=this.pts[this.startIndex[t]].x,r=this.pts[this.startIndex[t+1]].x;return e<r?e:r},rf.prototype.computeIntersectsForChain=function(){if(4===arguments.length){var t=arguments[0],e=arguments[1],r=arguments[2],n=arguments[3];this.computeIntersectsForChain(this.startIndex[t],this.startIndex[t+1],e,e.startIndex[r],e.startIndex[r+1],n)}else if(6===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3],l=arguments[4],u=arguments[5],c=this.pts[i],h=this.pts[o],p=s.pts[a],f=s.pts[l];if(o-i==1&&l-a==1)return u.addIntersections(this.e,i,s.e,a),null;if(this.env1.init(c,h),this.env2.init(p,f),!this.env1.intersects(this.env2))return null;var d=Math.trunc((i+o)/2),m=Math.trunc((a+l)/2);i<d&&(a<m&&this.computeIntersectsForChain(i,d,s,a,m,u),m<l&&this.computeIntersectsForChain(i,d,s,m,l,u)),d<o&&(a<m&&this.computeIntersectsForChain(d,o,s,a,m,u),m<l&&this.computeIntersectsForChain(d,o,s,m,l,u))}},rf.prototype.getStartIndexes=function(){return this.startIndex},rf.prototype.computeIntersects=function(t,e){for(var r=0;r<this.startIndex.length-1;r++)for(var n=0;n<t.startIndex.length-1;n++)this.computeIntersectsForChain(r,t,n,e)},rf.prototype.interfaces_=function(){return[]},rf.prototype.getClass=function(){return rf};var nf=function t(){this._depth=Array(2).fill().map(function(){return Array(3)});for(var e=0;e<2;e++)for(var r=0;r<3;r++)this._depth[e][r]=t.NULL_VALUE},of={NULL_VALUE:{configurable:!0}};nf.prototype.getDepth=function(t,e){return this._depth[t][e]},nf.prototype.setDepth=function(t,e,r){this._depth[t][e]=r},nf.prototype.isNull=function(){var t=this;if(0===arguments.length){for(var e=0;e<2;e++)for(var r=0;r<3;r++)if(t._depth[e][r]!==nf.NULL_VALUE)return!1;return!0}if(1===arguments.length){var n=arguments[0];return this._depth[n][1]===nf.NULL_VALUE}if(2===arguments.length){var i=arguments[0],o=arguments[1];return this._depth[i][o]===nf.NULL_VALUE}},nf.prototype.normalize=function(){for(var t=this,e=0;e<2;e++)if(!t.isNull(e)){var r=t._depth[e][1];t._depth[e][2]<r&&(r=t._depth[e][2]),r<0&&(r=0);for(var n=1;n<3;n++){var i=0;t._depth[e][n]>r&&(i=1),t._depth[e][n]=i}}},nf.prototype.getDelta=function(t){return this._depth[t][Ch.RIGHT]-this._depth[t][Ch.LEFT]},nf.prototype.getLocation=function(t,e){return this._depth[t][e]<=0?fu.EXTERIOR:fu.INTERIOR},nf.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]},nf.prototype.add=function(){var t=this;if(1===arguments.length)for(var e=arguments[0],r=0;r<2;r++)for(var n=1;n<3;n++){var i=e.getLocation(r,n);i!==fu.EXTERIOR&&i!==fu.INTERIOR||(t.isNull(r,n)?t._depth[r][n]=nf.depthAtLocation(i):t._depth[r][n]+=nf.depthAtLocation(i))}else if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];a===fu.INTERIOR&&this._depth[o][s]++}},nf.prototype.interfaces_=function(){return[]},nf.prototype.getClass=function(){return nf},nf.depthAtLocation=function(t){return t===fu.EXTERIOR?0:t===fu.INTERIOR?1:nf.NULL_VALUE},of.NULL_VALUE.get=function(){return-1},Object.defineProperties(nf,of);var sf=function(t){function e(){if(t.call(this),this.pts=null,this._env=null,this.eiList=new tf(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new nf,this._depthDelta=0,1===arguments.length){var r=arguments[0];e.call(this,r,null)}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.pts=n,this._label=i}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDepth=function(){return this._depth},e.prototype.getCollapsedEdge=function(){var t=new Array(2).fill(null);return t[0]=this.pts[0],t[1]=this.pts[1],new e(t,Oh.toLineLabel(this._label))},e.prototype.isIsolated=function(){return this._isIsolated},e.prototype.getCoordinates=function(){return this.pts},e.prototype.setIsolated=function(t){this._isIsolated=t},e.prototype.setName=function(t){this._name=t},e.prototype.equals=function(t){if(!(t instanceof e))return!1;var r=t;if(this.pts.length!==r.pts.length)return!1;for(var n=!0,i=!0,o=this.pts.length,s=0;s<this.pts.length;s++)if(this.pts[s].equals2D(r.pts[s])||(n=!1),this.pts[s].equals2D(r.pts[--o])||(i=!1),!n&&!i)return!1;return!0},e.prototype.getCoordinate=function(){if(0===arguments.length)return this.pts.length>0?this.pts[0]:null;if(1===arguments.length){var t=arguments[0];return this.pts[t]}},e.prototype.print=function(t){t.print("edge "+this._name+": "),t.print("LINESTRING (");for(var e=0;e<this.pts.length;e++)e>0&&t.print(","),t.print(this.pts[e].x+" "+this.pts[e].y);t.print(")  "+this._label+" "+this._depthDelta)},e.prototype.computeIM=function(t){e.updateIM(this._label,t)},e.prototype.isCollapsed=function(){return!!this._label.isArea()&&3===this.pts.length&&!!this.pts[0].equals(this.pts[2])},e.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},e.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},e.prototype.getDepthDelta=function(){return this._depthDelta},e.prototype.getNumPoints=function(){return this.pts.length},e.prototype.printReverse=function(t){t.print("edge "+this._name+": ");for(var e=this.pts.length-1;e>=0;e--)t.print(this.pts[e]+" ");t.println("")},e.prototype.getMonotoneChainEdge=function(){return null===this._mce&&(this._mce=new rf(this)),this._mce},e.prototype.getEnvelope=function(){if(null===this._env){this._env=new ku;for(var t=0;t<this.pts.length;t++)this._env.expandToInclude(this.pts[t])}return this._env},e.prototype.addIntersection=function(t,e,r,n){var i=new uu(t.getIntersection(n)),o=e,s=t.getEdgeDistance(r,n),a=o+1;if(a<this.pts.length){var l=this.pts[a];i.equals2D(l)&&(o=a,s=0)}this.eiList.add(i,o,s)},e.prototype.toString=function(){var t=new _u;t.append("edge "+this._name+": "),t.append("LINESTRING (");for(var e=0;e<this.pts.length;e++)e>0&&t.append(","),t.append(this.pts[e].x+" "+this.pts[e].y);return t.append(")  "+this._label+" "+this._depthDelta),t.toString()},e.prototype.isPointwiseEqual=function(t){if(this.pts.length!==t.pts.length)return!1;for(var e=0;e<this.pts.length;e++)if(!this.pts[e].equals2D(t.pts[e]))return!1;return!0},e.prototype.setDepthDelta=function(t){this._depthDelta=t},e.prototype.getEdgeIntersectionList=function(){return this.eiList},e.prototype.addIntersections=function(t,e,r){for(var n=0;n<t.getIntersectionNum();n++)this.addIntersection(t,e,r,n)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.updateIM=function(){if(2!==arguments.length)return t.prototype.updateIM.apply(this,arguments);var e=arguments[0],r=arguments[1];r.setAtLeastIfValid(e.getLocation(0,Ch.ON),e.getLocation(1,Ch.ON),1),e.isArea()&&(r.setAtLeastIfValid(e.getLocation(0,Ch.LEFT),e.getLocation(1,Ch.LEFT),2),r.setAtLeastIfValid(e.getLocation(0,Ch.RIGHT),e.getLocation(1,Ch.RIGHT),2))},e}(jh),af=function(t){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new Hp,this._bufParams=t||null};af.prototype.setWorkingPrecisionModel=function(t){this._workingPrecisionModel=t},af.prototype.insertUniqueEdge=function(t){var e=this._edgeList.findEqualEdge(t);if(null!==e){var r=e.getLabel(),n=t.getLabel();e.isPointwiseEqual(t)||(n=new Oh(t.getLabel())).flip(),r.merge(n);var i=af.depthDelta(n),o=e.getDepthDelta()+i;e.setDepthDelta(o)}else this._edgeList.add(t),t.setDepthDelta(af.depthDelta(t.getLabel()))},af.prototype.buildSubgraphs=function(t,e){for(var r=new cc,n=t.iterator();n.hasNext();){var i=n.next(),o=i.getRightmostCoordinate(),s=new Fp(r).getDepth(o);i.computeDepth(s),i.findResultEdges(),r.add(i),e.add(i.getDirectedEdges(),i.getNodes())}},af.prototype.createSubgraphs=function(t){for(var e=new cc,r=t.getNodes().iterator();r.hasNext();){var n=r.next();if(!n.isVisited()){var i=new Dh;i.create(n),e.add(i)}}return np.sort(e,np.reverseOrder()),e},af.prototype.createEmptyResultGeometry=function(){return this._geomFact.createPolygon()},af.prototype.getNoder=function(t){if(null!==this._workingNoder)return this._workingNoder;var e=new Ip,r=new Gu;return r.setPrecisionModel(t),e.setSegmentIntersector(new Kp(r)),e},af.prototype.buffer=function(t,e){var r=this._workingPrecisionModel;null===r&&(r=t.getPrecisionModel()),this._geomFact=t.getFactory();var n=new Np(r,this._bufParams),i=new Vp(t,e,n).getCurves();if(i.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(i,r),this._graph=new Wh(new Wp),this._graph.addEdges(this._edgeList.getEdges());var o=this.createSubgraphs(this._graph),s=new Yh(this._geomFact);this.buildSubgraphs(o,s);var a=s.getPolygons();return a.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(a)},af.prototype.computeNodedEdges=function(t,e){var r=this.getNoder(e);r.computeNodes(t);for(var n=r.getNodedSubstrings().iterator();n.hasNext();){var i=n.next(),o=i.getCoordinates();if(2!==o.length||!o[0].equals2D(o[1])){var s=i.getData(),a=new sf(i.getCoordinates(),new Oh(s));this.insertUniqueEdge(a)}}},af.prototype.setNoder=function(t){this._workingNoder=t},af.prototype.interfaces_=function(){return[]},af.prototype.getClass=function(){return af},af.depthDelta=function(t){var e=t.getLocation(0,Ch.LEFT),r=t.getLocation(0,Ch.RIGHT);return e===fu.INTERIOR&&r===fu.EXTERIOR?1:e===fu.EXTERIOR&&r===fu.INTERIOR?-1:0},af.convertSegStrings=function(t){for(var e=new vh,r=new cc;t.hasNext();){var n=t.next(),i=e.createLineString(n.getCoordinates());r.add(i)}return e.buildGeometry(r)};var lf=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,2===arguments.length){var t=arguments[0],e=arguments[1];this._noder=t,this._scaleFactor=e,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(4===arguments.length){var r=arguments[0],n=arguments[1],i=arguments[2],o=arguments[3];this._noder=r,this._scaleFactor=n,this._offsetX=i,this._offsetY=o,this._isScaled=!this.isIntegerPrecision()}};lf.prototype.rescale=function(){var t=this;if(mu(arguments[0],oc))for(var e=arguments[0],r=e.iterator();r.hasNext();){var n=r.next();t.rescale(n.getCoordinates())}else if(arguments[0]instanceof Array){for(var i=arguments[0],o=0;o<i.length;o++)i[o].x=i[o].x/t._scaleFactor+t._offsetX,i[o].y=i[o].y/t._scaleFactor+t._offsetY;2===i.length&&i[0].equals2D(i[1])&&Au.out.println(i)}},lf.prototype.scale=function(){var t=this;if(mu(arguments[0],oc)){for(var e=arguments[0],r=new cc,n=e.iterator();n.hasNext();){var i=n.next();r.add(new yp(t.scale(i.getCoordinates()),i.getData()))}return r}if(arguments[0]instanceof Array){for(var o=arguments[0],s=new Array(o.length).fill(null),a=0;a<o.length;a++)s[a]=new uu(Math.round((o[a].x-t._offsetX)*t._scaleFactor),Math.round((o[a].y-t._offsetY)*t._scaleFactor),o[a].z);var l=fc.removeRepeatedPoints(s);return l}},lf.prototype.isIntegerPrecision=function(){return 1===this._scaleFactor},lf.prototype.getNodedSubstrings=function(){var t=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(t),t},lf.prototype.computeNodes=function(t){var e=t;this._isScaled&&(e=this.scale(t)),this._noder.computeNodes(e)},lf.prototype.interfaces_=function(){return[Ep]},lf.prototype.getClass=function(){return lf};var uf=function(){this._li=new Gu,this._segStrings=null;var t=arguments[0];this._segStrings=t},cf={fact:{configurable:!0}};uf.prototype.checkEndPtVertexIntersections=function(){var t=this;if(0===arguments.length)for(var e=this._segStrings.iterator();e.hasNext();){var r=e.next(),n=r.getCoordinates();t.checkEndPtVertexIntersections(n[0],t._segStrings),t.checkEndPtVertexIntersections(n[n.length-1],t._segStrings)}else if(2===arguments.length)for(var i=arguments[0],o=arguments[1],s=o.iterator();s.hasNext();)for(var a=s.next(),l=a.getCoordinates(),u=1;u<l.length-1;u++)if(l[u].equals(i))throw new Fu("found endpt/interior pt intersection at index "+u+" :pt "+i)},uf.prototype.checkInteriorIntersections=function(){var t=this;if(0===arguments.length)for(var e=this._segStrings.iterator();e.hasNext();)for(var r=e.next(),n=this._segStrings.iterator();n.hasNext();){var i=n.next();t.checkInteriorIntersections(r,i)}else if(2===arguments.length)for(var o=arguments[0],s=arguments[1],a=o.getCoordinates(),l=s.getCoordinates(),u=0;u<a.length-1;u++)for(var c=0;c<l.length-1;c++)t.checkInteriorIntersections(o,u,s,c);else if(4===arguments.length){var h=arguments[0],p=arguments[1],f=arguments[2],d=arguments[3];if(h===f&&p===d)return null;var m=h.getCoordinates()[p],g=h.getCoordinates()[p+1],y=f.getCoordinates()[d],_=f.getCoordinates()[d+1];if(this._li.computeIntersection(m,g,y,_),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,m,g)||this.hasInteriorIntersection(this._li,y,_)))throw new Fu("found non-noded intersection at "+m+"-"+g+" and "+y+"-"+_)}},uf.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()},uf.prototype.checkCollapses=function(){var t=this;if(0===arguments.length)for(var e=this._segStrings.iterator();e.hasNext();){var r=e.next();t.checkCollapses(r)}else if(1===arguments.length)for(var n=arguments[0],i=n.getCoordinates(),o=0;o<i.length-2;o++)t.checkCollapse(i[o],i[o+1],i[o+2])},uf.prototype.hasInteriorIntersection=function(t,e,r){for(var n=0;n<t.getIntersectionNum();n++){var i=t.getIntersection(n);if(!i.equals(e)&&!i.equals(r))return!0}return!1},uf.prototype.checkCollapse=function(t,e,r){if(t.equals(r))throw new Fu("found non-noded collapse at "+uf.fact.createLineString([t,e,r]))},uf.prototype.interfaces_=function(){return[]},uf.prototype.getClass=function(){return uf},cf.fact.get=function(){return new vh},Object.defineProperties(uf,cf);var hf=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var t=arguments[0],e=arguments[1],r=arguments[2];if(this._originalPt=t,this._pt=t,this._scaleFactor=e,this._li=r,e<=0)throw new ru("Scale factor must be non-zero");1!==e&&(this._pt=new uu(this.scale(t.x),this.scale(t.y)),this._p0Scaled=new uu,this._p1Scaled=new uu),this.initCorners(this._pt)},pf={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};hf.prototype.intersectsScaled=function(t,e){var r=Math.min(t.x,e.x),n=Math.max(t.x,e.x),i=Math.min(t.y,e.y),o=Math.max(t.y,e.y),s=this._maxx<r||this._minx>n||this._maxy<i||this._miny>o;if(s)return!1;var a=this.intersectsToleranceSquare(t,e);return ju.isTrue(!(s&&a),"Found bad envelope test"),a},hf.prototype.initCorners=function(t){var e=.5;this._minx=t.x-e,this._maxx=t.x+e,this._miny=t.y-e,this._maxy=t.y+e,this._corner[0]=new uu(this._maxx,this._maxy),this._corner[1]=new uu(this._minx,this._maxy),this._corner[2]=new uu(this._minx,this._miny),this._corner[3]=new uu(this._maxx,this._miny)},hf.prototype.intersects=function(t,e){return 1===this._scaleFactor?this.intersectsScaled(t,e):(this.copyScaled(t,this._p0Scaled),this.copyScaled(e,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))},hf.prototype.scale=function(t){return Math.round(t*this._scaleFactor)},hf.prototype.getCoordinate=function(){return this._originalPt},hf.prototype.copyScaled=function(t,e){e.x=this.scale(t.x),e.y=this.scale(t.y)},hf.prototype.getSafeEnvelope=function(){if(null===this._safeEnv){var t=hf.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new ku(this._originalPt.x-t,this._originalPt.x+t,this._originalPt.y-t,this._originalPt.y+t)}return this._safeEnv},hf.prototype.intersectsPixelClosure=function(t,e){return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),!!this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),!!this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),!!this._li.hasIntersection())))},hf.prototype.intersectsToleranceSquare=function(t,e){var r=!1,n=!1;return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!this._li.isProper()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),!!this._li.isProper()||(this._li.hasIntersection()&&(r=!0),this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),!!this._li.isProper()||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),!!this._li.isProper()||!(!r||!n)||!!t.equals(this._pt)||!!e.equals(this._pt))))},hf.prototype.addSnappedNode=function(t,e){var r=t.getCoordinate(e),n=t.getCoordinate(e+1);return!!this.intersects(r,n)&&(t.addIntersection(this.getCoordinate(),e),!0)},hf.prototype.interfaces_=function(){return[]},hf.prototype.getClass=function(){return hf},pf.SAFE_ENV_EXPANSION_FACTOR.get=function(){return.75},Object.defineProperties(hf,pf);var ff=function(){this.tempEnv1=new ku,this.selectedSegment=new _p};ff.prototype.select=function(){if(1===arguments.length);else if(2===arguments.length){var t=arguments[0],e=arguments[1];t.getLineSegment(e,this.selectedSegment),this.select(this.selectedSegment)}},ff.prototype.interfaces_=function(){return[]},ff.prototype.getClass=function(){return ff};var df=function(){this._index=null;var t=arguments[0];this._index=t},mf={HotPixelSnapAction:{configurable:!0}};df.prototype.snap=function(){if(1===arguments.length){var t=arguments[0];return this.snap(t,null,-1)}if(3===arguments.length){var e=arguments[0],r=arguments[1],n=arguments[2],i=e.getSafeEnvelope(),o=new gf(e,r,n);return this._index.query(i,{interfaces_:function(){return[Qh]},visitItem:function(t){t.select(i,o)}}),o.isNodeAdded()}},df.prototype.interfaces_=function(){return[]},df.prototype.getClass=function(){return df},mf.HotPixelSnapAction.get=function(){return gf},Object.defineProperties(df,mf);var gf=function(t){function e(){t.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var e=arguments[0],r=arguments[1],n=arguments[2];this._hotPixel=e,this._parentEdge=r,this._hotPixelVertexIndex=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isNodeAdded=function(){return this._isNodeAdded},e.prototype.select=function(){if(2!==arguments.length)return t.prototype.select.apply(this,arguments);var e=arguments[0],r=arguments[1],n=e.getContext();if(null!==this._parentEdge&&n===this._parentEdge&&r===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(n,r)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(ff),yf=function(){this._li=null,this._interiorIntersections=null;var t=arguments[0];this._li=t,this._interiorIntersections=new cc};yf.prototype.processIntersections=function(t,e,r,n){if(t===r&&e===n)return null;var i=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=r.getCoordinates()[n],a=r.getCoordinates()[n+1];if(this._li.computeIntersection(i,o,s,a),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var l=0;l<this._li.getIntersectionNum();l++)this._interiorIntersections.add(this._li.getIntersection(l));t.addIntersections(this._li,e,0),r.addIntersections(this._li,n,1)}},yf.prototype.isDone=function(){return!1},yf.prototype.getInteriorIntersections=function(){return this._interiorIntersections},yf.prototype.interfaces_=function(){return[Jp]},yf.prototype.getClass=function(){return yf};var _f=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var t=arguments[0];this._pm=t,this._li=new Gu,this._li.setPrecisionModel(t),this._scaleFactor=t.getScale()};_f.prototype.checkCorrectness=function(t){var e=yp.getNodedSubstrings(t),r=new uf(e);try{r.checkValid()}catch(t){if(!(t instanceof Cu))throw t;t.printStackTrace()}},_f.prototype.getNodedSubstrings=function(){return yp.getNodedSubstrings(this._nodedSegStrings)},_f.prototype.snapRound=function(t,e){var r=this.findInteriorIntersections(t,e);this.computeIntersectionSnaps(r),this.computeVertexSnaps(t)},_f.prototype.findInteriorIntersections=function(t,e){var r=new yf(e);return this._noder.setSegmentIntersector(r),this._noder.computeNodes(t),r.getInteriorIntersections()},_f.prototype.computeVertexSnaps=function(){var t=this;if(mu(arguments[0],oc))for(var e=arguments[0],r=e.iterator();r.hasNext();){var n=r.next();t.computeVertexSnaps(n)}else if(arguments[0]instanceof yp)for(var i=arguments[0],o=i.getCoordinates(),s=0;s<o.length;s++){var a=new hf(o[s],t._scaleFactor,t._li),l=t._pointSnapper.snap(a,i,s);l&&i.addIntersection(o[s],s)}},_f.prototype.computeNodes=function(t){this._nodedSegStrings=t,this._noder=new Ip,this._pointSnapper=new df(this._noder.getIndex()),this.snapRound(t,this._li)},_f.prototype.computeIntersectionSnaps=function(t){for(var e=this,r=t.iterator();r.hasNext();){var n=r.next(),i=new hf(n,e._scaleFactor,e._li);e._pointSnapper.snap(i)}},_f.prototype.interfaces_=function(){return[Ep]},_f.prototype.getClass=function(){return _f};var vf=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new Cp,this._resultGeometry=null,this._saveException=null,1===arguments.length){var t=arguments[0];this._argGeom=t}else if(2===arguments.length){var e=arguments[0],r=arguments[1];this._argGeom=e,this._bufParams=r}},xf={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};vf.prototype.bufferFixedPrecision=function(t){var e=new lf(new _f(new mh(1)),t.getScale()),r=new af(this._bufParams);r.setWorkingPrecisionModel(t),r.setNoder(e),this._resultGeometry=r.buffer(this._argGeom,this._distance)},vf.prototype.bufferReducedPrecision=function(){var t=this;if(0===arguments.length){for(var e=vf.MAX_PRECISION_DIGITS;e>=0;e--){try{t.bufferReducedPrecision(e)}catch(e){if(!(e instanceof Lh))throw e;t._saveException=e}if(null!==t._resultGeometry)return null}throw this._saveException}if(1===arguments.length){var r=arguments[0],n=vf.precisionScaleFactor(this._argGeom,this._distance,r),i=new mh(n);this.bufferFixedPrecision(i)}},vf.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),null!==this._resultGeometry)return null;var t=this._argGeom.getFactory().getPrecisionModel();t.getType()===mh.FIXED?this.bufferFixedPrecision(t):this.bufferReducedPrecision()},vf.prototype.setQuadrantSegments=function(t){this._bufParams.setQuadrantSegments(t)},vf.prototype.bufferOriginalPrecision=function(){try{var t=new af(this._bufParams);this._resultGeometry=t.buffer(this._argGeom,this._distance)}catch(t){if(!(t instanceof Fu))throw t;this._saveException=t}},vf.prototype.getResultGeometry=function(t){return this._distance=t,this.computeGeometry(),this._resultGeometry},vf.prototype.setEndCapStyle=function(t){this._bufParams.setEndCapStyle(t)},vf.prototype.interfaces_=function(){return[]},vf.prototype.getClass=function(){return vf},vf.bufferOp=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],r=new vf(t),n=r.getResultGeometry(e);return n}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Yu&&"number"==typeof arguments[1]){var i=arguments[0],o=arguments[1],s=arguments[2],a=new vf(i);a.setQuadrantSegments(s);var l=a.getResultGeometry(o);return l}if(arguments[2]instanceof Cp&&arguments[0]instanceof Yu&&"number"==typeof arguments[1]){var u=arguments[0],c=arguments[1],h=arguments[2],p=new vf(u,h),f=p.getResultGeometry(c);return f}}else if(4===arguments.length){var d=arguments[0],m=arguments[1],g=arguments[2],y=arguments[3],_=new vf(d);_.setQuadrantSegments(g),_.setEndCapStyle(y);var v=_.getResultGeometry(m);return v}},vf.precisionScaleFactor=function(t,e,r){var n=t.getEnvelopeInternal(),i=gu.max(Math.abs(n.getMaxX()),Math.abs(n.getMaxY()),Math.abs(n.getMinX()),Math.abs(n.getMinY()))+2*(e>0?e:0),o=r-Math.trunc(Math.log(i)/Math.log(10)+1);return Math.pow(10,o)},xf.CAP_ROUND.get=function(){return Cp.CAP_ROUND},xf.CAP_BUTT.get=function(){return Cp.CAP_FLAT},xf.CAP_FLAT.get=function(){return Cp.CAP_FLAT},xf.CAP_SQUARE.get=function(){return Cp.CAP_SQUARE},xf.MAX_PRECISION_DIGITS.get=function(){return 12},Object.defineProperties(vf,xf);var bf=function(){this._pt=[new uu,new uu],this._distance=nu.NaN,this._isNull=!0};bf.prototype.getCoordinates=function(){return this._pt},bf.prototype.getCoordinate=function(t){return this._pt[t]},bf.prototype.setMinimum=function(){if(1===arguments.length){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],r=arguments[1];if(this._isNull)return this.initialize(e,r),null;var n=e.distance(r);n<this._distance&&this.initialize(e,r,n)}},bf.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(3===arguments.length){var r=arguments[0],n=arguments[1],i=arguments[2];this._pt[0].setCoordinate(r),this._pt[1].setCoordinate(n),this._distance=i,this._isNull=!1}},bf.prototype.getDistance=function(){return this._distance},bf.prototype.setMaximum=function(){if(1===arguments.length){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],r=arguments[1];if(this._isNull)return this.initialize(e,r),null;var n=e.distance(r);n>this._distance&&this.initialize(e,r,n)}},bf.prototype.interfaces_=function(){return[]},bf.prototype.getClass=function(){return bf};var wf=function(){};wf.prototype.interfaces_=function(){return[]},wf.prototype.getClass=function(){return wf},wf.computeDistance=function(){if(arguments[2]instanceof bf&&arguments[0]instanceof Jc&&arguments[1]instanceof uu)for(var t=arguments[0],e=arguments[1],r=arguments[2],n=t.getCoordinates(),i=new _p,o=0;o<n.length-1;o++){i.setCoordinates(n[o],n[o+1]);var s=i.closestPoint(e);r.setMinimum(s,e)}else if(arguments[2]instanceof bf&&arguments[0]instanceof eh&&arguments[1]instanceof uu){var a=arguments[0],l=arguments[1],u=arguments[2];wf.computeDistance(a.getExteriorRing(),l,u);for(var c=0;c<a.getNumInteriorRing();c++)wf.computeDistance(a.getInteriorRingN(c),l,u)}else if(arguments[2]instanceof bf&&arguments[0]instanceof Yu&&arguments[1]instanceof uu){var h=arguments[0],p=arguments[1],f=arguments[2];if(h instanceof Jc)wf.computeDistance(h,p,f);else if(h instanceof eh)wf.computeDistance(h,p,f);else if(h instanceof Fc)for(var d=h,m=0;m<d.getNumGeometries();m++){var g=d.getGeometryN(m);wf.computeDistance(g,p,f)}else f.setMinimum(h.getCoordinate(),p)}else if(arguments[2]instanceof bf&&arguments[0]instanceof _p&&arguments[1]instanceof uu){var y=arguments[0],_=arguments[1],v=arguments[2],x=y.closestPoint(_);v.setMinimum(x,_)}};var Ef=function(t){this._maxPtDist=new bf,this._inputGeom=t||null},Sf={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};Ef.prototype.computeMaxMidpointDistance=function(t){var e=new Tf(this._inputGeom);t.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())},Ef.prototype.computeMaxVertexDistance=function(t){var e=new If(this._inputGeom);t.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())},Ef.prototype.findDistance=function(t){return this.computeMaxVertexDistance(t),this.computeMaxMidpointDistance(t),this._maxPtDist.getDistance()},Ef.prototype.getDistancePoints=function(){return this._maxPtDist},Ef.prototype.interfaces_=function(){return[]},Ef.prototype.getClass=function(){return Ef},Sf.MaxPointDistanceFilter.get=function(){return If},Sf.MaxMidpointDistanceFilter.get=function(){return Tf},Object.defineProperties(Ef,Sf);var If=function(t){this._maxPtDist=new bf,this._minPtDist=new bf,this._geom=t||null};If.prototype.filter=function(t){this._minPtDist.initialize(),wf.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},If.prototype.getMaxPointDistance=function(){return this._maxPtDist},If.prototype.interfaces_=function(){return[Ku]},If.prototype.getClass=function(){return If};var Tf=function(t){this._maxPtDist=new bf,this._minPtDist=new bf,this._geom=t||null};Tf.prototype.filter=function(t,e){if(0===e)return null;var r=t.getCoordinate(e-1),n=t.getCoordinate(e),i=new uu((r.x+n.x)/2,(r.y+n.y)/2);this._minPtDist.initialize(),wf.computeDistance(this._geom,i,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},Tf.prototype.isDone=function(){return!1},Tf.prototype.isGeometryChanged=function(){return!1},Tf.prototype.getMaxPointDistance=function(){return this._maxPtDist},Tf.prototype.interfaces_=function(){return[Nc]},Tf.prototype.getClass=function(){return Tf};var Cf=function(t){this._comps=t||null};Cf.prototype.filter=function(t){t instanceof eh&&this._comps.add(t)},Cf.prototype.interfaces_=function(){return[Oc]},Cf.prototype.getClass=function(){return Cf},Cf.getPolygons=function(){if(1===arguments.length){var t=arguments[0];return Cf.getPolygons(t,new cc)}if(2===arguments.length){var e=arguments[0],r=arguments[1];return e instanceof eh?r.add(e):e instanceof Fc&&e.apply(new Cf(r)),r}};var Mf=function(){if(this._lines=null,this._isForcedToLineString=!1,1===arguments.length){var t=arguments[0];this._lines=t}else if(2===arguments.length){var e=arguments[0],r=arguments[1];this._lines=e,this._isForcedToLineString=r}};Mf.prototype.filter=function(t){if(this._isForcedToLineString&&t instanceof nh){var e=t.getFactory().createLineString(t.getCoordinateSequence());return this._lines.add(e),null}t instanceof Jc&&this._lines.add(t)},Mf.prototype.setForceToLineString=function(t){this._isForcedToLineString=t},Mf.prototype.interfaces_=function(){return[Wu]},Mf.prototype.getClass=function(){return Mf},Mf.getGeometry=function(){if(1===arguments.length){var t=arguments[0];return t.getFactory().buildGeometry(Mf.getLines(t))}if(2===arguments.length){var e=arguments[0],r=arguments[1];return e.getFactory().buildGeometry(Mf.getLines(e,r))}},Mf.getLines=function(){if(1===arguments.length){var t=arguments[0];return Mf.getLines(t,!1)}if(2===arguments.length){if(mu(arguments[0],oc)&&mu(arguments[1],oc)){for(var e=arguments[0],r=arguments[1],n=e.iterator();n.hasNext();){var i=n.next();Mf.getLines(i,r)}return r}if(arguments[0]instanceof Yu&&"boolean"==typeof arguments[1]){var o=arguments[0],s=arguments[1],a=new cc;return o.apply(new Mf(a,s)),a}if(arguments[0]instanceof Yu&&mu(arguments[1],oc)){var l=arguments[0],u=arguments[1];return l instanceof Jc?u.add(l):l.apply(new Mf(u)),u}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&mu(arguments[0],oc)&&mu(arguments[1],oc)){for(var c=arguments[0],h=arguments[1],p=arguments[2],f=c.iterator();f.hasNext();){var d=f.next();Mf.getLines(d,h,p)}return h}if("boolean"==typeof arguments[2]&&arguments[0]instanceof Yu&&mu(arguments[1],oc)){var m=arguments[0],g=arguments[1],y=arguments[2];return m.apply(new Mf(g,y)),g}}};var Af=function(){if(this._boundaryRule=Qu.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];if(null===t)throw new ru("Rule must be non-null");this._boundaryRule=t}};Af.prototype.locateInternal=function(){var t=this;if(arguments[0]instanceof uu&&arguments[1]instanceof eh){var e=arguments[0],r=arguments[1];if(r.isEmpty())return fu.EXTERIOR;var n=r.getExteriorRing(),i=this.locateInPolygonRing(e,n);if(i===fu.EXTERIOR)return fu.EXTERIOR;if(i===fu.BOUNDARY)return fu.BOUNDARY;for(var o=0;o<r.getNumInteriorRing();o++){var s=r.getInteriorRingN(o),a=t.locateInPolygonRing(e,s);if(a===fu.INTERIOR)return fu.EXTERIOR;if(a===fu.BOUNDARY)return fu.BOUNDARY}return fu.INTERIOR}if(arguments[0]instanceof uu&&arguments[1]instanceof Jc){var l=arguments[0],u=arguments[1];if(!u.getEnvelopeInternal().intersects(l))return fu.EXTERIOR;var c=u.getCoordinates();return u.isClosed()||!l.equals(c[0])&&!l.equals(c[c.length-1])?Zu.isOnLine(l,c)?fu.INTERIOR:fu.EXTERIOR:fu.BOUNDARY}if(arguments[0]instanceof uu&&arguments[1]instanceof Qc){var h=arguments[0],p=arguments[1],f=p.getCoordinate();return f.equals2D(h)?fu.INTERIOR:fu.EXTERIOR}},Af.prototype.locateInPolygonRing=function(t,e){return e.getEnvelopeInternal().intersects(t)?Zu.locatePointInRing(t,e.getCoordinates()):fu.EXTERIOR},Af.prototype.intersects=function(t,e){return this.locate(t,e)!==fu.EXTERIOR},Af.prototype.updateLocationInfo=function(t){t===fu.INTERIOR&&(this._isIn=!0),t===fu.BOUNDARY&&this._numBoundaries++},Af.prototype.computeLocation=function(t,e){var r=this;if(e instanceof Qc&&this.updateLocationInfo(this.locateInternal(t,e)),e instanceof Jc)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof eh)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof Bc)for(var n=e,i=0;i<n.getNumGeometries();i++){var o=n.getGeometryN(i);r.updateLocationInfo(r.locateInternal(t,o))}else if(e instanceof ih)for(var s=e,a=0;a<s.getNumGeometries();a++){var l=s.getGeometryN(a);r.updateLocationInfo(r.locateInternal(t,l))}else if(e instanceof Fc)for(var u=new qp(e);u.hasNext();){var c=u.next();c!==e&&r.computeLocation(t,c)}},Af.prototype.locate=function(t,e){return e.isEmpty()?fu.EXTERIOR:e instanceof Jc||e instanceof eh?this.locateInternal(t,e):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(t,e),this._boundaryRule.isInBoundary(this._numBoundaries)?fu.BOUNDARY:this._numBoundaries>0||this._isIn?fu.INTERIOR:fu.EXTERIOR)},Af.prototype.interfaces_=function(){return[]},Af.prototype.getClass=function(){return Af};var Pf=function t(){if(this._component=null,this._segIndex=null,this._pt=null,2===arguments.length){var e=arguments[0],r=arguments[1];t.call(this,e,t.INSIDE_AREA,r)}else if(3===arguments.length){var n=arguments[0],i=arguments[1],o=arguments[2];this._component=n,this._segIndex=i,this._pt=o}},kf={INSIDE_AREA:{configurable:!0}};Pf.prototype.isInsideArea=function(){return this._segIndex===Pf.INSIDE_AREA},Pf.prototype.getCoordinate=function(){return this._pt},Pf.prototype.getGeometryComponent=function(){return this._component},Pf.prototype.getSegmentIndex=function(){return this._segIndex},Pf.prototype.interfaces_=function(){return[]},Pf.prototype.getClass=function(){return Pf},kf.INSIDE_AREA.get=function(){return-1},Object.defineProperties(Pf,kf);var Lf=function(t){this._pts=t||null};Lf.prototype.filter=function(t){t instanceof Qc&&this._pts.add(t)},Lf.prototype.interfaces_=function(){return[Oc]},Lf.prototype.getClass=function(){return Lf},Lf.getPoints=function(){if(1===arguments.length){var t=arguments[0];return t instanceof Qc?np.singletonList(t):Lf.getPoints(t,new cc)}if(2===arguments.length){var e=arguments[0],r=arguments[1];return e instanceof Qc?r.add(e):e instanceof Fc&&e.apply(new Lf(r)),r}};var zf=function(){this._locations=null;var t=arguments[0];this._locations=t};zf.prototype.filter=function(t){(t instanceof Qc||t instanceof Jc||t instanceof eh)&&this._locations.add(new Pf(t,0,t.getCoordinate()))},zf.prototype.interfaces_=function(){return[Oc]},zf.prototype.getClass=function(){return zf},zf.getLocations=function(t){var e=new cc;return t.apply(new zf(e)),e};var Df=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new Af,this._minDistanceLocation=null,this._minDistance=nu.MAX_VALUE,2===arguments.length){var t=arguments[0],e=arguments[1];this._geom=[t,e],this._terminateDistance=0}else if(3===arguments.length){var r=arguments[0],n=arguments[1],i=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=r,this._geom[1]=n,this._terminateDistance=i}};Df.prototype.computeContainmentDistance=function(){var t=this;if(0===arguments.length){var e=new Array(2).fill(null);if(this.computeContainmentDistance(0,e),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,e)}else if(2===arguments.length){var r=arguments[0],n=arguments[1],i=1-r,o=Cf.getPolygons(this._geom[r]);if(o.size()>0){var s=zf.getLocations(this._geom[i]);if(this.computeContainmentDistance(s,o,n),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[i]=n[0],this._minDistanceLocation[r]=n[1],null}}else if(3===arguments.length)if(arguments[2]instanceof Array&&mu(arguments[0],lc)&&mu(arguments[1],lc)){for(var a=arguments[0],l=arguments[1],u=arguments[2],c=0;c<a.size();c++)for(var h=a.get(c),p=0;p<l.size();p++)if(t.computeContainmentDistance(h,l.get(p),u),t._minDistance<=t._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof Pf&&arguments[1]instanceof eh){var f=arguments[0],d=arguments[1],m=arguments[2],g=f.getCoordinate();if(fu.EXTERIOR!==this._ptLocator.locate(g,d))return this._minDistance=0,m[0]=f,m[1]=new Pf(d,g),null}},Df.prototype.computeMinDistanceLinesPoints=function(t,e,r){for(var n=this,i=0;i<t.size();i++)for(var o=t.get(i),s=0;s<e.size();s++){var a=e.get(s);if(n.computeMinDistance(o,a,r),n._minDistance<=n._terminateDistance)return null}},Df.prototype.computeFacetDistance=function(){var t=new Array(2).fill(null),e=Mf.getLines(this._geom[0]),r=Mf.getLines(this._geom[1]),n=Lf.getPoints(this._geom[0]),i=Lf.getPoints(this._geom[1]);return this.computeMinDistanceLines(e,r,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(e,i,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(r,n,t),this.updateMinDistance(t,!0),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistancePoints(n,i,t),void this.updateMinDistance(t,!1))))},Df.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation},Df.prototype.updateMinDistance=function(t,e){if(null===t[0])return null;e?(this._minDistanceLocation[0]=t[1],this._minDistanceLocation[1]=t[0]):(this._minDistanceLocation[0]=t[0],this._minDistanceLocation[1]=t[1])},Df.prototype.nearestPoints=function(){return this.computeMinDistance(),[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()]},Df.prototype.computeMinDistance=function(){var t=this;if(0===arguments.length){if(null!==this._minDistanceLocation)return null;if(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance)return null;this.computeFacetDistance()}else if(3===arguments.length)if(arguments[2]instanceof Array&&arguments[0]instanceof Jc&&arguments[1]instanceof Qc){var e=arguments[0],r=arguments[1],n=arguments[2];if(e.getEnvelopeInternal().distance(r.getEnvelopeInternal())>this._minDistance)return null;for(var i=e.getCoordinates(),o=r.getCoordinate(),s=0;s<i.length-1;s++){var a=Zu.distancePointLine(o,i[s],i[s+1]);if(a<t._minDistance){t._minDistance=a;var l=new _p(i[s],i[s+1]),u=l.closestPoint(o);n[0]=new Pf(e,s,u),n[1]=new Pf(r,0,o)}if(t._minDistance<=t._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof Jc&&arguments[1]instanceof Jc){var c=arguments[0],h=arguments[1],p=arguments[2];if(c.getEnvelopeInternal().distance(h.getEnvelopeInternal())>this._minDistance)return null;for(var f=c.getCoordinates(),d=h.getCoordinates(),m=0;m<f.length-1;m++)for(var g=0;g<d.length-1;g++){var y=Zu.distanceLineLine(f[m],f[m+1],d[g],d[g+1]);if(y<t._minDistance){t._minDistance=y;var _=new _p(f[m],f[m+1]),v=new _p(d[g],d[g+1]),x=_.closestPoints(v);p[0]=new Pf(c,m,x[0]),p[1]=new Pf(h,g,x[1])}if(t._minDistance<=t._terminateDistance)return null}}},Df.prototype.computeMinDistancePoints=function(t,e,r){for(var n=this,i=0;i<t.size();i++)for(var o=t.get(i),s=0;s<e.size();s++){var a=e.get(s),l=o.getCoordinate().distance(a.getCoordinate());if(l<n._minDistance&&(n._minDistance=l,r[0]=new Pf(o,0,o.getCoordinate()),r[1]=new Pf(a,0,a.getCoordinate())),n._minDistance<=n._terminateDistance)return null}},Df.prototype.distance=function(){if(null===this._geom[0]||null===this._geom[1])throw new ru("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)},Df.prototype.computeMinDistanceLines=function(t,e,r){for(var n=this,i=0;i<t.size();i++)for(var o=t.get(i),s=0;s<e.size();s++){var a=e.get(s);if(n.computeMinDistance(o,a,r),n._minDistance<=n._terminateDistance)return null}},Df.prototype.interfaces_=function(){return[]},Df.prototype.getClass=function(){return Df},Df.distance=function(t,e){return new Df(t,e).distance()},Df.isWithinDistance=function(t,e,r){return new Df(t,e,r).distance()<=r},Df.nearestPoints=function(t,e){return new Df(t,e).nearestPoints()};var Rf=function(){this._pt=[new uu,new uu],this._distance=nu.NaN,this._isNull=!0};Rf.prototype.getCoordinates=function(){return this._pt},Rf.prototype.getCoordinate=function(t){return this._pt[t]},Rf.prototype.setMinimum=function(){if(1===arguments.length){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],r=arguments[1];if(this._isNull)return this.initialize(e,r),null;var n=e.distance(r);n<this._distance&&this.initialize(e,r,n)}},Rf.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(3===arguments.length){var r=arguments[0],n=arguments[1],i=arguments[2];this._pt[0].setCoordinate(r),this._pt[1].setCoordinate(n),this._distance=i,this._isNull=!1}},Rf.prototype.toString=function(){return Nu.toLineString(this._pt[0],this._pt[1])},Rf.prototype.getDistance=function(){return this._distance},Rf.prototype.setMaximum=function(){if(1===arguments.length){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],r=arguments[1];if(this._isNull)return this.initialize(e,r),null;var n=e.distance(r);n>this._distance&&this.initialize(e,r,n)}},Rf.prototype.interfaces_=function(){return[]},Rf.prototype.getClass=function(){return Rf};var Of=function(){};Of.prototype.interfaces_=function(){return[]},Of.prototype.getClass=function(){return Of},Of.computeDistance=function(){if(arguments[2]instanceof Rf&&arguments[0]instanceof Jc&&arguments[1]instanceof uu)for(var t=arguments[0],e=arguments[1],r=arguments[2],n=new _p,i=t.getCoordinates(),o=0;o<i.length-1;o++){n.setCoordinates(i[o],i[o+1]);var s=n.closestPoint(e);r.setMinimum(s,e)}else if(arguments[2]instanceof Rf&&arguments[0]instanceof eh&&arguments[1]instanceof uu){var a=arguments[0],l=arguments[1],u=arguments[2];Of.computeDistance(a.getExteriorRing(),l,u);for(var c=0;c<a.getNumInteriorRing();c++)Of.computeDistance(a.getInteriorRingN(c),l,u)}else if(arguments[2]instanceof Rf&&arguments[0]instanceof Yu&&arguments[1]instanceof uu){var h=arguments[0],p=arguments[1],f=arguments[2];if(h instanceof Jc)Of.computeDistance(h,p,f);else if(h instanceof eh)Of.computeDistance(h,p,f);else if(h instanceof Fc)for(var d=h,m=0;m<d.getNumGeometries();m++){var g=d.getGeometryN(m);Of.computeDistance(g,p,f)}else f.setMinimum(h.getCoordinate(),p)}else if(arguments[2]instanceof Rf&&arguments[0]instanceof _p&&arguments[1]instanceof uu){var y=arguments[0],_=arguments[1],v=arguments[2],x=y.closestPoint(_);v.setMinimum(x,_)}};var Nf=function(){this._g0=null,this._g1=null,this._ptDist=new Rf,this._densifyFrac=0;var t=arguments[0],e=arguments[1];this._g0=t,this._g1=e},Ff={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};Nf.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()},Nf.prototype.setDensifyFraction=function(t){if(t>1||t<=0)throw new ru("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=t},Nf.prototype.compute=function(t,e){this.computeOrientedDistance(t,e,this._ptDist),this.computeOrientedDistance(e,t,this._ptDist)},Nf.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()},Nf.prototype.computeOrientedDistance=function(t,e,r){var n=new Bf(e);if(t.apply(n),r.setMaximum(n.getMaxPointDistance()),this._densifyFrac>0){var i=new jf(e,this._densifyFrac);t.apply(i),r.setMaximum(i.getMaxPointDistance())}},Nf.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()},Nf.prototype.interfaces_=function(){return[]},Nf.prototype.getClass=function(){return Nf},Nf.distance=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],r=new Nf(t,e);return r.distance()}if(3===arguments.length){var n=arguments[0],i=arguments[1],o=arguments[2],s=new Nf(n,i);return s.setDensifyFraction(o),s.distance()}},Ff.MaxPointDistanceFilter.get=function(){return Bf},Ff.MaxDensifiedByFractionDistanceFilter.get=function(){return jf},Object.defineProperties(Nf,Ff);var Bf=function(){this._maxPtDist=new Rf,this._minPtDist=new Rf,this._euclideanDist=new Of,this._geom=null;var t=arguments[0];this._geom=t};Bf.prototype.filter=function(t){this._minPtDist.initialize(),Of.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},Bf.prototype.getMaxPointDistance=function(){return this._maxPtDist},Bf.prototype.interfaces_=function(){return[Ku]},Bf.prototype.getClass=function(){return Bf};var jf=function(){this._maxPtDist=new Rf,this._minPtDist=new Rf,this._geom=null,this._numSubSegs=0;var t=arguments[0],e=arguments[1];this._geom=t,this._numSubSegs=Math.trunc(Math.round(1/e))};jf.prototype.filter=function(t,e){var r=this;if(0===e)return null;for(var n=t.getCoordinate(e-1),i=t.getCoordinate(e),o=(i.x-n.x)/this._numSubSegs,s=(i.y-n.y)/this._numSubSegs,a=0;a<this._numSubSegs;a++){var l=n.x+a*o,u=n.y+a*s,c=new uu(l,u);r._minPtDist.initialize(),Of.computeDistance(r._geom,c,r._minPtDist),r._maxPtDist.setMaximum(r._minPtDist)}},jf.prototype.isDone=function(){return!1},jf.prototype.isGeometryChanged=function(){return!1},jf.prototype.getMaxPointDistance=function(){return this._maxPtDist},jf.prototype.interfaces_=function(){return[Nc]},jf.prototype.getClass=function(){return jf};var Uf=function(t,e,r){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._bufDistance=e||null,this._result=r||null},Vf={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};Uf.prototype.checkMaximumDistance=function(t,e,r){var n=new Nf(e,t);if(n.setDensifyFraction(.25),this._maxDistanceFound=n.orientedDistance(),this._maxDistanceFound>r){this._isValid=!1;var i=n.getCoordinates();this._errorLocation=i[1],this._errorIndicator=t.getFactory().createLineString(i),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+Nu.toLineString(i[0],i[1])+")"}},Uf.prototype.isValid=function(){var t=Math.abs(this._bufDistance),e=Uf.MAX_DISTANCE_DIFF_FRAC*t;return this._minValidDistance=t-e,this._maxValidDistance=t+e,!(!this._input.isEmpty()&&!this._result.isEmpty())||(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),Uf.VERBOSE&&Au.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)},Uf.prototype.checkNegativeValid=function(){if(!(this._input instanceof eh||this._input instanceof ih||this._input instanceof Fc))return null;var t=this.getPolygonLines(this._input);if(this.checkMinimumDistance(t,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(t,this._result,this._maxValidDistance)},Uf.prototype.getErrorIndicator=function(){return this._errorIndicator},Uf.prototype.checkMinimumDistance=function(t,e,r){var n=new Df(t,e,r);if(this._minDistanceFound=n.distance(),this._minDistanceFound<r){this._isValid=!1;var i=n.nearestPoints();this._errorLocation=n.nearestPoints()[1],this._errorIndicator=t.getFactory().createLineString(i),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+Nu.toLineString(i[0],i[1])+" )"}},Uf.prototype.checkPositiveValid=function(){var t=this._result.getBoundary();if(this.checkMinimumDistance(this._input,t,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,t,this._maxValidDistance)},Uf.prototype.getErrorLocation=function(){return this._errorLocation},Uf.prototype.getPolygonLines=function(t){for(var e=new cc,r=new Mf(e),n=Cf.getPolygons(t).iterator();n.hasNext();)n.next().apply(r);return t.getFactory().buildGeometry(e)},Uf.prototype.getErrorMessage=function(){return this._errMsg},Uf.prototype.interfaces_=function(){return[]},Uf.prototype.getClass=function(){return Uf},Vf.VERBOSE.get=function(){return!1},Vf.MAX_DISTANCE_DIFF_FRAC.get=function(){return.012},Object.defineProperties(Uf,Vf);var Gf=function(t,e,r){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._distance=e||null,this._result=r||null},qf={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};Gf.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid},Gf.prototype.checkEnvelope=function(){if(this._distance<0)return null;var t=this._distance*Gf.MAX_ENV_DIFF_FRAC;0===t&&(t=.001);var e=new ku(this._input.getEnvelopeInternal());e.expandBy(this._distance);var r=new ku(this._result.getEnvelopeInternal());r.expandBy(t),r.contains(e)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(r)),this.report("Envelope")},Gf.prototype.checkDistance=function(){var t=new Uf(this._input,this._distance,this._result);t.isValid()||(this._isValid=!1,this._errorMsg=t.getErrorMessage(),this._errorLocation=t.getErrorLocation(),this._errorIndicator=t.getErrorIndicator()),this.report("Distance")},Gf.prototype.checkArea=function(){var t=this._input.getArea(),e=this._result.getArea();this._distance>0&&t>e&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&t<e&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")},Gf.prototype.checkPolygonal=function(){this._result instanceof eh||this._result instanceof ih||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")},Gf.prototype.getErrorIndicator=function(){return this._errorIndicator},Gf.prototype.getErrorLocation=function(){return this._errorLocation},Gf.prototype.checkExpectedEmpty=function(){return this._input.getDimension()>=2||this._distance>0?null:(this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),void this.report("ExpectedEmpty"))},Gf.prototype.report=function(t){if(!Gf.VERBOSE)return null;Au.out.println("Check "+t+": "+(this._isValid?"passed":"FAILED"))},Gf.prototype.getErrorMessage=function(){return this._errorMsg},Gf.prototype.interfaces_=function(){return[]},Gf.prototype.getClass=function(){return Gf},Gf.isValidMsg=function(t,e,r){var n=new Gf(t,e,r);return n.isValid()?null:n.getErrorMessage()},Gf.isValid=function(t,e,r){return!!new Gf(t,e,r).isValid()},qf.VERBOSE.get=function(){return!1},qf.MAX_ENV_DIFF_FRAC.get=function(){return.012},Object.defineProperties(Gf,qf);var $f=function(){this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e};$f.prototype.getCoordinates=function(){return this._pts},$f.prototype.size=function(){return this._pts.length},$f.prototype.getCoordinate=function(t){return this._pts[t]},$f.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},$f.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:dp.octant(this.getCoordinate(t),this.getCoordinate(t+1))},$f.prototype.setData=function(t){this._data=t},$f.prototype.getData=function(){return this._data},$f.prototype.toString=function(){return Nu.toLineString(new ch(this._pts))},$f.prototype.interfaces_=function(){return[mp]},$f.prototype.getClass=function(){return $f};var Zf=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new cc,this._intersectionCount=0,this._keepIntersections=!0;var t=arguments[0];this._li=t,this._interiorIntersection=null};Zf.prototype.getInteriorIntersection=function(){return this._interiorIntersection},Zf.prototype.setCheckEndSegmentsOnly=function(t){this._isCheckEndSegmentsOnly=t},Zf.prototype.getIntersectionSegments=function(){return this._intSegments},Zf.prototype.count=function(){return this._intersectionCount},Zf.prototype.getIntersections=function(){return this._intersections},Zf.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t},Zf.prototype.setKeepIntersections=function(t){this._keepIntersections=t},Zf.prototype.processIntersections=function(t,e,r,n){if(!this._findAllIntersections&&this.hasIntersection())return null;if(t===r&&e===n)return null;if(this._isCheckEndSegmentsOnly&&!this.isEndSegment(t,e)&&!this.isEndSegment(r,n))return null;var i=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=r.getCoordinates()[n],a=r.getCoordinates()[n+1];this._li.computeIntersection(i,o,s,a),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=i,this._intSegments[1]=o,this._intSegments[2]=s,this._intSegments[3]=a,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)},Zf.prototype.isEndSegment=function(t,e){return 0===e||e>=t.size()-2},Zf.prototype.hasIntersection=function(){return null!==this._interiorIntersection},Zf.prototype.isDone=function(){return!this._findAllIntersections&&null!==this._interiorIntersection},Zf.prototype.interfaces_=function(){return[Jp]},Zf.prototype.getClass=function(){return Zf},Zf.createAllIntersectionsFinder=function(t){var e=new Zf(t);return e.setFindAllIntersections(!0),e},Zf.createAnyIntersectionFinder=function(t){return new Zf(t)},Zf.createIntersectionCounter=function(t){var e=new Zf(t);return e.setFindAllIntersections(!0),e.setKeepIntersections(!1),e};var Xf=function(){this._li=new Gu,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var t=arguments[0];this._segStrings=t};Xf.prototype.execute=function(){if(null!==this._segInt)return null;this.checkInteriorIntersections()},Xf.prototype.getIntersections=function(){return this._segInt.getIntersections()},Xf.prototype.isValid=function(){return this.execute(),this._isValid},Xf.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t},Xf.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new Zf(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var t=new Ip;if(t.setSegmentIntersector(this._segInt),t.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null},Xf.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new Lh(this.getErrorMessage(),this._segInt.getInteriorIntersection())},Xf.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var t=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+Nu.toLineString(t[0],t[1])+" and "+Nu.toLineString(t[2],t[3])},Xf.prototype.interfaces_=function(){return[]},Xf.prototype.getClass=function(){return Xf},Xf.computeIntersections=function(t){var e=new Xf(t);return e.setFindAllIntersections(!0),e.isValid(),e.getIntersections()};var Wf=function t(){this._nv=null;var e=arguments[0];this._nv=new Xf(t.toSegmentStrings(e))};Wf.prototype.checkValid=function(){this._nv.checkValid()},Wf.prototype.interfaces_=function(){return[]},Wf.prototype.getClass=function(){return Wf},Wf.toSegmentStrings=function(t){for(var e=new cc,r=t.iterator();r.hasNext();){var n=r.next();e.add(new $f(n.getCoordinates(),n))}return e},Wf.checkValid=function(t){new Wf(t).checkValid()};var Yf=function(t){this._mapOp=t};Yf.prototype.map=function(t){for(var e=new cc,r=0;r<t.getNumGeometries();r++){var n=this._mapOp.map(t.getGeometryN(r));n.isEmpty()||e.add(n)}return t.getFactory().createGeometryCollection(vh.toGeometryArray(e))},Yf.prototype.interfaces_=function(){return[]},Yf.prototype.getClass=function(){return Yf},Yf.map=function(t,e){return new Yf(e).map(t)};var Hf=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new cc,this._resultLineList=new cc;var t=arguments[0],e=arguments[1],r=arguments[2];this._op=t,this._geometryFactory=e,this._ptLocator=r};Hf.prototype.collectLines=function(t){for(var e=this,r=this._op.getGraph().getEdgeEnds().iterator();r.hasNext();){var n=r.next();e.collectLineEdge(n,t,e._lineEdgesList),e.collectBoundaryTouchEdge(n,t,e._lineEdgesList)}},Hf.prototype.labelIsolatedLine=function(t,e){var r=this._ptLocator.locate(t.getCoordinate(),this._op.getArgGeometry(e));t.getLabel().setLocation(e,r)},Hf.prototype.build=function(t){return this.findCoveredLineEdges(),this.collectLines(t),this.buildLines(t),this._resultLineList},Hf.prototype.collectLineEdge=function(t,e,r){var n=t.getLabel(),i=t.getEdge();t.isLineEdge()&&(t.isVisited()||!Pd.isResultOfOp(n,e)||i.isCovered()||(r.add(i),t.setVisitedEdge(!0)))},Hf.prototype.findCoveredLineEdges=function(){for(var t=this._op.getGraph().getNodes().iterator();t.hasNext();)t.next().getEdges().findCoveredLineEdges();for(var e=this._op.getGraph().getEdgeEnds().iterator();e.hasNext();){var r=e.next(),n=r.getEdge();if(r.isLineEdge()&&!n.isCoveredSet()){var i=this._op.isCoveredByA(r.getCoordinate());n.setCovered(i)}}},Hf.prototype.labelIsolatedLines=function(t){for(var e=t.iterator();e.hasNext();){var r=e.next(),n=r.getLabel();r.isIsolated()&&(n.isNull(0)?this.labelIsolatedLine(r,0):this.labelIsolatedLine(r,1))}},Hf.prototype.buildLines=function(t){for(var e=this._lineEdgesList.iterator();e.hasNext();){var r=e.next(),n=this._geometryFactory.createLineString(r.getCoordinates());this._resultLineList.add(n),r.setInResult(!0)}},Hf.prototype.collectBoundaryTouchEdge=function(t,e,r){var n=t.getLabel();return t.isLineEdge()||t.isVisited()||t.isInteriorAreaEdge()||t.getEdge().isInResult()?null:(ju.isTrue(!(t.isInResult()||t.getSym().isInResult())||!t.getEdge().isInResult()),void(Pd.isResultOfOp(n,e)&&e===Pd.INTERSECTION&&(r.add(t.getEdge()),t.setVisitedEdge(!0))))},Hf.prototype.interfaces_=function(){return[]},Hf.prototype.getClass=function(){return Hf};var Jf=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new cc;var t=arguments[0],e=arguments[1];this._op=t,this._geometryFactory=e};Jf.prototype.filterCoveredNodeToPoint=function(t){var e=t.getCoordinate();if(!this._op.isCoveredByLA(e)){var r=this._geometryFactory.createPoint(e);this._resultPointList.add(r)}},Jf.prototype.extractNonCoveredResultNodes=function(t){for(var e=this._op.getGraph().getNodes().iterator();e.hasNext();){var r=e.next();if(!r.isInResult()&&!r.isIncidentEdgeInResult()&&(0===r.getEdges().getDegree()||t===Pd.INTERSECTION)){var n=r.getLabel();Pd.isResultOfOp(n,t)&&this.filterCoveredNodeToPoint(r)}}},Jf.prototype.build=function(t){return this.extractNonCoveredResultNodes(t),this._resultPointList},Jf.prototype.interfaces_=function(){return[]},Jf.prototype.getClass=function(){return Jf};var Kf=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};Kf.prototype.transformPoint=function(t,e){return this._factory.createPoint(this.transformCoordinates(t.getCoordinateSequence(),t))},Kf.prototype.transformPolygon=function(t,e){var r=!0,n=this.transformLinearRing(t.getExteriorRing(),t);null!==n&&n instanceof nh&&!n.isEmpty()||(r=!1);for(var i=new cc,o=0;o<t.getNumInteriorRing();o++){var s=this.transformLinearRing(t.getInteriorRingN(o),t);null===s||s.isEmpty()||(s instanceof nh||(r=!1),i.add(s))}if(r)return this._factory.createPolygon(n,i.toArray([]));var a=new cc;return null!==n&&a.add(n),a.addAll(i),this._factory.buildGeometry(a)},Kf.prototype.createCoordinateSequence=function(t){return this._factory.getCoordinateSequenceFactory().create(t)},Kf.prototype.getInputGeometry=function(){return this._inputGeom},Kf.prototype.transformMultiLineString=function(t,e){for(var r=new cc,n=0;n<t.getNumGeometries();n++){var i=this.transformLineString(t.getGeometryN(n),t);null!==i&&(i.isEmpty()||r.add(i))}return this._factory.buildGeometry(r)},Kf.prototype.transformCoordinates=function(t,e){return this.copy(t)},Kf.prototype.transformLineString=function(t,e){return this._factory.createLineString(this.transformCoordinates(t.getCoordinateSequence(),t))},Kf.prototype.transformMultiPoint=function(t,e){for(var r=new cc,n=0;n<t.getNumGeometries();n++){var i=this.transformPoint(t.getGeometryN(n),t);null!==i&&(i.isEmpty()||r.add(i))}return this._factory.buildGeometry(r)},Kf.prototype.transformMultiPolygon=function(t,e){for(var r=new cc,n=0;n<t.getNumGeometries();n++){var i=this.transformPolygon(t.getGeometryN(n),t);null!==i&&(i.isEmpty()||r.add(i))}return this._factory.buildGeometry(r)},Kf.prototype.copy=function(t){return t.copy()},Kf.prototype.transformGeometryCollection=function(t,e){for(var r=new cc,n=0;n<t.getNumGeometries();n++){var i=this.transform(t.getGeometryN(n));null!==i&&(this._pruneEmptyGeometry&&i.isEmpty()||r.add(i))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(vh.toGeometryArray(r)):this._factory.buildGeometry(r)},Kf.prototype.transform=function(t){if(this._inputGeom=t,this._factory=t.getFactory(),t instanceof Qc)return this.transformPoint(t,null);if(t instanceof rh)return this.transformMultiPoint(t,null);if(t instanceof nh)return this.transformLinearRing(t,null);if(t instanceof Jc)return this.transformLineString(t,null);if(t instanceof Bc)return this.transformMultiLineString(t,null);if(t instanceof eh)return this.transformPolygon(t,null);if(t instanceof ih)return this.transformMultiPolygon(t,null);if(t instanceof Fc)return this.transformGeometryCollection(t,null);throw new ru("Unknown Geometry subtype: "+t.getClass().getName())},Kf.prototype.transformLinearRing=function(t,e){var r=this.transformCoordinates(t.getCoordinateSequence(),t);if(null===r)return this._factory.createLinearRing(null);var n=r.size();return n>0&&n<4&&!this._preserveType?this._factory.createLineString(r):this._factory.createLinearRing(r)},Kf.prototype.interfaces_=function(){return[]},Kf.prototype.getClass=function(){return Kf};var Qf=function t(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new _p,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof Jc&&"number"==typeof arguments[1]){var e=arguments[0],r=arguments[1];t.call(this,e.getCoordinates(),r)}else if(arguments[0]instanceof Array&&"number"==typeof arguments[1]){var n=arguments[0],i=arguments[1];this._srcPts=n,this._isClosed=t.isClosed(n),this._snapTolerance=i}};Qf.prototype.snapVertices=function(t,e){for(var r=this._isClosed?t.size()-1:t.size(),n=0;n<r;n++){var i=t.get(n),o=this.findSnapForVertex(i,e);null!==o&&(t.set(n,new uu(o)),0===n&&this._isClosed&&t.set(t.size()-1,new uu(o)))}},Qf.prototype.findSnapForVertex=function(t,e){for(var r=0;r<e.length;r++){if(t.equals2D(e[r]))return null;if(t.distance(e[r])<this._snapTolerance)return e[r]}return null},Qf.prototype.snapTo=function(t){var e=new pc(this._srcPts);return this.snapVertices(e,t),this.snapSegments(e,t),e.toCoordinateArray()},Qf.prototype.snapSegments=function(t,e){if(0===e.length)return null;var r=e.length;e[0].equals2D(e[e.length-1])&&(r=e.length-1);for(var n=0;n<r;n++){var i=e[n],o=this.findSegmentIndexToSnap(i,t);o>=0&&t.add(o+1,new uu(i),!1)}},Qf.prototype.findSegmentIndexToSnap=function(t,e){for(var r=this,n=nu.MAX_VALUE,i=-1,o=0;o<e.size()-1;o++){if(r._seg.p0=e.get(o),r._seg.p1=e.get(o+1),r._seg.p0.equals2D(t)||r._seg.p1.equals2D(t)){if(r._allowSnappingToSourceVertices)continue;return-1}var s=r._seg.distance(t);s<r._snapTolerance&&s<n&&(n=s,i=o)}return i},Qf.prototype.setAllowSnappingToSourceVertices=function(t){this._allowSnappingToSourceVertices=t},Qf.prototype.interfaces_=function(){return[]},Qf.prototype.getClass=function(){return Qf},Qf.isClosed=function(t){return!(t.length<=1)&&t[0].equals2D(t[t.length-1])};var td=function(t){this._srcGeom=t||null},ed={SNAP_PRECISION_FACTOR:{configurable:!0}};td.prototype.snapTo=function(t,e){var r=this.extractTargetCoordinates(t);return new rd(e,r).transform(this._srcGeom)},td.prototype.snapToSelf=function(t,e){var r=this.extractTargetCoordinates(this._srcGeom),n=new rd(t,r,!0).transform(this._srcGeom),i=n;return e&&mu(i,th)&&(i=n.buffer(0)),i},td.prototype.computeSnapTolerance=function(t){return this.computeMinimumSegmentLength(t)/10},td.prototype.extractTargetCoordinates=function(t){for(var e=new kc,r=t.getCoordinates(),n=0;n<r.length;n++)e.add(r[n]);return e.toArray(new Array(0).fill(null))},td.prototype.computeMinimumSegmentLength=function(t){for(var e=nu.MAX_VALUE,r=0;r<t.length-1;r++){var n=t[r].distance(t[r+1]);n<e&&(e=n)}return e},td.prototype.interfaces_=function(){return[]},td.prototype.getClass=function(){return td},td.snap=function(t,e,r){var n=new Array(2).fill(null),i=new td(t);n[0]=i.snapTo(e,r);var o=new td(e);return n[1]=o.snapTo(n[0],r),n},td.computeOverlaySnapTolerance=function(){if(1===arguments.length){var t=arguments[0],e=td.computeSizeBasedSnapTolerance(t),r=t.getPrecisionModel();if(r.getType()===mh.FIXED){var n=1/r.getScale()*2/1.415;n>e&&(e=n)}return e}if(2===arguments.length){var i=arguments[0],o=arguments[1];return Math.min(td.computeOverlaySnapTolerance(i),td.computeOverlaySnapTolerance(o))}},td.computeSizeBasedSnapTolerance=function(t){var e=t.getEnvelopeInternal();return Math.min(e.getHeight(),e.getWidth())*td.SNAP_PRECISION_FACTOR},td.snapToSelf=function(t,e,r){return new td(t).snapToSelf(e,r)},ed.SNAP_PRECISION_FACTOR.get=function(){return 1e-9},Object.defineProperties(td,ed);var rd=function(t){function e(e,r,n){t.call(this),this._snapTolerance=e||null,this._snapPts=r||null,this._isSelfSnap=void 0!==n&&n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.snapLine=function(t,e){var r=new Qf(t,this._snapTolerance);return r.setAllowSnappingToSourceVertices(this._isSelfSnap),r.snapTo(e)},e.prototype.transformCoordinates=function(t,e){var r=t.toCoordinateArray(),n=this.snapLine(r,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(n)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Kf),nd=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};nd.prototype.getCommon=function(){return nu.longBitsToDouble(this._commonBits)},nd.prototype.add=function(t){var e=nu.doubleToLongBits(t);return this._isFirst?(this._commonBits=e,this._commonSignExp=nd.signExpBits(this._commonBits),this._isFirst=!1,null):nd.signExpBits(e)!==this._commonSignExp?(this._commonBits=0,null):(this._commonMantissaBitsCount=nd.numCommonMostSigMantissaBits(this._commonBits,e),void(this._commonBits=nd.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))))},nd.prototype.toString=function(){if(1===arguments.length){var t=arguments[0],e=nu.longBitsToDouble(t),r=nu.toBinaryString(t),n="0000000000000000000000000000000000000000000000000000000000000000"+r,i=n.substring(n.length-64),o=i.substring(0,1)+"  "+i.substring(1,12)+"(exp) "+i.substring(12)+" [ "+e+" ]";return o}},nd.prototype.interfaces_=function(){return[]},nd.prototype.getClass=function(){return nd},nd.getBit=function(t,e){return 0!=(t&1<<e)?1:0},nd.signExpBits=function(t){return t>>52},nd.zeroLowerBits=function(t,e){return t&~((1<<e)-1)},nd.numCommonMostSigMantissaBits=function(t,e){for(var r=0,n=52;n>=0;n--){if(nd.getBit(t,n)!==nd.getBit(e,n))return r;r++}return 52};var id=function(){this._commonCoord=null,this._ccFilter=new sd},od={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};id.prototype.addCommonBits=function(t){var e=new ad(this._commonCoord);t.apply(e),t.geometryChanged()},id.prototype.removeCommonBits=function(t){if(0===this._commonCoord.x&&0===this._commonCoord.y)return t;var e=new uu(this._commonCoord);e.x=-e.x,e.y=-e.y;var r=new ad(e);return t.apply(r),t.geometryChanged(),t},id.prototype.getCommonCoordinate=function(){return this._commonCoord},id.prototype.add=function(t){t.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()},id.prototype.interfaces_=function(){return[]},id.prototype.getClass=function(){return id},od.CommonCoordinateFilter.get=function(){return sd},od.Translater.get=function(){return ad},Object.defineProperties(id,od);var sd=function(){this._commonBitsX=new nd,this._commonBitsY=new nd};sd.prototype.filter=function(t){this._commonBitsX.add(t.x),this._commonBitsY.add(t.y)},sd.prototype.getCommonCoordinate=function(){return new uu(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())},sd.prototype.interfaces_=function(){return[Ku]},sd.prototype.getClass=function(){return sd};var ad=function(){this.trans=null;var t=arguments[0];this.trans=t};ad.prototype.filter=function(t,e){var r=t.getOrdinate(e,0)+this.trans.x,n=t.getOrdinate(e,1)+this.trans.y;t.setOrdinate(e,0,r),t.setOrdinate(e,1,n)},ad.prototype.isDone=function(){return!1},ad.prototype.isGeometryChanged=function(){return!0},ad.prototype.interfaces_=function(){return[Nc]},ad.prototype.getClass=function(){return ad};var ld=function(t,e){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=t,this._geom[1]=e,this.computeSnapTolerance()};ld.prototype.selfSnap=function(t){return new td(t).snapTo(t,this._snapTolerance)},ld.prototype.removeCommonBits=function(t){this._cbr=new id,this._cbr.add(t[0]),this._cbr.add(t[1]);var e=new Array(2).fill(null);return e[0]=this._cbr.removeCommonBits(t[0].copy()),e[1]=this._cbr.removeCommonBits(t[1].copy()),e},ld.prototype.prepareResult=function(t){return this._cbr.addCommonBits(t),t},ld.prototype.getResultGeometry=function(t){var e=this.snap(this._geom),r=Pd.overlayOp(e[0],e[1],t);return this.prepareResult(r)},ld.prototype.checkValid=function(t){t.isValid()||Au.out.println("Snapped geometry is invalid")},ld.prototype.computeSnapTolerance=function(){this._snapTolerance=td.computeOverlaySnapTolerance(this._geom[0],this._geom[1])},ld.prototype.snap=function(t){var e=this.removeCommonBits(t);return td.snap(e[0],e[1],this._snapTolerance)},ld.prototype.interfaces_=function(){return[]},ld.prototype.getClass=function(){return ld},ld.overlayOp=function(t,e,r){return new ld(t,e).getResultGeometry(r)},ld.union=function(t,e){return ld.overlayOp(t,e,Pd.UNION)},ld.intersection=function(t,e){return ld.overlayOp(t,e,Pd.INTERSECTION)},ld.symDifference=function(t,e){return ld.overlayOp(t,e,Pd.SYMDIFFERENCE)},ld.difference=function(t,e){return ld.overlayOp(t,e,Pd.DIFFERENCE)};var ud=function(t,e){this._geom=new Array(2).fill(null),this._geom[0]=t,this._geom[1]=e};ud.prototype.getResultGeometry=function(t){var e=null,r=!1,n=null;try{e=Pd.overlayOp(this._geom[0],this._geom[1],t),r=!0}catch(t){if(!(t instanceof Fu))throw t;n=t}if(!r)try{e=ld.overlayOp(this._geom[0],this._geom[1],t)}catch(t){throw t instanceof Fu?n:t}return e},ud.prototype.interfaces_=function(){return[]},ud.prototype.getClass=function(){return ud},ud.overlayOp=function(t,e,r){return new ud(t,e).getResultGeometry(r)},ud.union=function(t,e){return ud.overlayOp(t,e,Pd.UNION)},ud.intersection=function(t,e){return ud.overlayOp(t,e,Pd.INTERSECTION)},ud.symDifference=function(t,e){return ud.overlayOp(t,e,Pd.SYMDIFFERENCE)},ud.difference=function(t,e){return ud.overlayOp(t,e,Pd.DIFFERENCE)};var cd=function(){this.mce=null,this.chainIndex=null;var t=arguments[0],e=arguments[1];this.mce=t,this.chainIndex=e};cd.prototype.computeIntersections=function(t,e){this.mce.computeIntersectsForChain(this.chainIndex,t.mce,t.chainIndex,e)},cd.prototype.interfaces_=function(){return[]},cd.prototype.getClass=function(){return cd};var hd=function t(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,2===arguments.length){var e=arguments[0],r=arguments[1];this._eventType=t.DELETE,this._xValue=e,this._insertEvent=r}else if(3===arguments.length){var n=arguments[0],i=arguments[1],o=arguments[2];this._eventType=t.INSERT,this._label=n,this._xValue=i,this._obj=o}},pd={INSERT:{configurable:!0},DELETE:{configurable:!0}};hd.prototype.isDelete=function(){return this._eventType===hd.DELETE},hd.prototype.setDeleteEventIndex=function(t){this._deleteEventIndex=t},hd.prototype.getObject=function(){return this._obj},hd.prototype.compareTo=function(t){var e=t;return this._xValue<e._xValue?-1:this._xValue>e._xValue?1:this._eventType<e._eventType?-1:this._eventType>e._eventType?1:0},hd.prototype.getInsertEvent=function(){return this._insertEvent},hd.prototype.isInsert=function(){return this._eventType===hd.INSERT},hd.prototype.isSameLabel=function(t){return null!==this._label&&this._label===t._label},hd.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex},hd.prototype.interfaces_=function(){return[ou]},hd.prototype.getClass=function(){return hd},pd.INSERT.get=function(){return 1},pd.DELETE.get=function(){return 2},Object.defineProperties(hd,pd);var fd=function(){};fd.prototype.interfaces_=function(){return[]},fd.prototype.getClass=function(){return fd};var dd=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var t=arguments[0],e=arguments[1],r=arguments[2];this._li=t,this._includeProper=e,this._recordIsolated=r};dd.prototype.isTrivialIntersection=function(t,e,r,n){if(t===r&&1===this._li.getIntersectionNum()){if(dd.isAdjacentSegments(e,n))return!0;if(t.isClosed()){var i=t.getNumPoints()-1;if(0===e&&n===i||0===n&&e===i)return!0}}return!1},dd.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},dd.prototype.setIsDoneIfProperInt=function(t){this._isDoneWhenProperInt=t},dd.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},dd.prototype.isBoundaryPointInternal=function(t,e){for(var r=e.iterator();r.hasNext();){var n=r.next().getCoordinate();if(t.isIntersection(n))return!0}return!1},dd.prototype.hasProperIntersection=function(){return this._hasProper},dd.prototype.hasIntersection=function(){return this._hasIntersection},dd.prototype.isDone=function(){return this._isDone},dd.prototype.isBoundaryPoint=function(t,e){return null!==e&&(!!this.isBoundaryPointInternal(t,e[0])||!!this.isBoundaryPointInternal(t,e[1]))},dd.prototype.setBoundaryNodes=function(t,e){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=t,this._bdyNodes[1]=e},dd.prototype.addIntersections=function(t,e,r,n){if(t===r&&e===n)return null;this.numTests++;var i=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=r.getCoordinates()[n],a=r.getCoordinates()[n+1];this._li.computeIntersection(i,o,s,a),this._li.hasIntersection()&&(this._recordIsolated&&(t.setIsolated(!1),r.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(t,e,r,n)||(this._hasIntersection=!0,!this._includeProper&&this._li.isProper()||(t.addIntersections(this._li,e,0),r.addIntersections(this._li,n,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))},dd.prototype.interfaces_=function(){return[]},dd.prototype.getClass=function(){return dd},dd.isAdjacentSegments=function(t,e){return 1===Math.abs(t-e)};var md=function(t){function e(){t.call(this),this.events=new cc,this.nOverlaps=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.prepareEvents=function(){np.sort(this.events);for(var t=0;t<this.events.size();t++){var e=this.events.get(t);e.isDelete()&&e.getInsertEvent().setDeleteEventIndex(t)}},e.prototype.computeIntersections=function(){var t=this;if(1===arguments.length){var e=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var r=0;r<this.events.size();r++){var n=t.events.get(r);if(n.isInsert()&&t.processOverlaps(r,n.getDeleteEventIndex(),n,e),e.isDone())break}}else if(3===arguments.length)if(arguments[2]instanceof dd&&mu(arguments[0],lc)&&mu(arguments[1],lc)){var i=arguments[0],o=arguments[1],s=arguments[2];this.addEdges(i,i),this.addEdges(o,o),this.computeIntersections(s)}else if("boolean"==typeof arguments[2]&&mu(arguments[0],lc)&&arguments[1]instanceof dd){var a=arguments[0],l=arguments[1],u=arguments[2];u?this.addEdges(a,null):this.addEdges(a),this.computeIntersections(l)}},e.prototype.addEdge=function(t,e){for(var r=t.getMonotoneChainEdge(),n=r.getStartIndexes(),i=0;i<n.length-1;i++){var o=new cd(r,i),s=new hd(e,r.getMinX(i),o);this.events.add(s),this.events.add(new hd(r.getMaxX(i),s))}},e.prototype.processOverlaps=function(t,e,r,n){for(var i=r.getObject(),o=t;o<e;o++){var s=this.events.get(o);if(s.isInsert()){var a=s.getObject();r.isSameLabel(s)||(i.computeIntersections(a,n),this.nOverlaps++)}}},e.prototype.addEdges=function(){var t=this;if(1===arguments.length)for(var e=arguments[0],r=e.iterator();r.hasNext();){var n=r.next();t.addEdge(n,n)}else if(2===arguments.length)for(var i=arguments[0],o=arguments[1],s=i.iterator();s.hasNext();){var a=s.next();t.addEdge(a,o)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(fd),gd=function(){this._min=nu.POSITIVE_INFINITY,this._max=nu.NEGATIVE_INFINITY},yd={NodeComparator:{configurable:!0}};gd.prototype.getMin=function(){return this._min},gd.prototype.intersects=function(t,e){return!(this._min>e||this._max<t)},gd.prototype.getMax=function(){return this._max},gd.prototype.toString=function(){return Nu.toLineString(new uu(this._min,0),new uu(this._max,0))},gd.prototype.interfaces_=function(){return[]},gd.prototype.getClass=function(){return gd},yd.NodeComparator.get=function(){return _d},Object.defineProperties(gd,yd);var _d=function(){};_d.prototype.compare=function(t,e){var r=t,n=e,i=(r._min+r._max)/2,o=(n._min+n._max)/2;return i<o?-1:i>o?1:0},_d.prototype.interfaces_=function(){return[au]},_d.prototype.getClass=function(){return _d};var vd=function(t){function e(){t.call(this),this._item=null;var e=arguments[0],r=arguments[1],n=arguments[2];this._min=e,this._max=r,this._item=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.query=function(t,e,r){if(!this.intersects(t,e))return null;r.visitItem(this._item)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(gd),xd=function(t){function e(){t.call(this),this._node1=null,this._node2=null;var e=arguments[0],r=arguments[1];this._node1=e,this._node2=r,this.buildExtent(this._node1,this._node2)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildExtent=function(t,e){this._min=Math.min(t._min,e._min),this._max=Math.max(t._max,e._max)},e.prototype.query=function(t,e,r){if(!this.intersects(t,e))return null;null!==this._node1&&this._node1.query(t,e,r),null!==this._node2&&this._node2.query(t,e,r)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(gd),bd=function(){this._leaves=new cc,this._root=null,this._level=0};bd.prototype.buildTree=function(){np.sort(this._leaves,new gd.NodeComparator);for(var t=this._leaves,e=null,r=new cc;;){if(this.buildLevel(t,r),1===r.size())return r.get(0);e=t,t=r,r=e}},bd.prototype.insert=function(t,e,r){if(null!==this._root)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new vd(t,e,r))},bd.prototype.query=function(t,e,r){this.init(),this._root.query(t,e,r)},bd.prototype.buildRoot=function(){if(null!==this._root)return null;this._root=this.buildTree()},bd.prototype.printNode=function(t){Au.out.println(Nu.toLineString(new uu(t._min,this._level),new uu(t._max,this._level)))},bd.prototype.init=function(){if(null!==this._root)return null;this.buildRoot()},bd.prototype.buildLevel=function(t,e){this._level++,e.clear();for(var r=0;r<t.size();r+=2){var n=t.get(r);if(null===(r+1<t.size()?t.get(r):null))e.add(n);else{var i=new xd(t.get(r),t.get(r+1));e.add(i)}}},bd.prototype.interfaces_=function(){return[]},bd.prototype.getClass=function(){return bd};var wd=function(){this._items=new cc};wd.prototype.visitItem=function(t){this._items.add(t)},wd.prototype.getItems=function(){return this._items},wd.prototype.interfaces_=function(){return[Qh]},wd.prototype.getClass=function(){return wd};var Ed=function(){this._index=null;var t=arguments[0];if(!mu(t,th))throw new ru("Argument must be Polygonal");this._index=new Td(t)},Sd={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};Ed.prototype.locate=function(t){var e=new $u(t),r=new Id(e);return this._index.query(t.y,t.y,r),e.getLocation()},Ed.prototype.interfaces_=function(){return[Gp]},Ed.prototype.getClass=function(){return Ed},Sd.SegmentVisitor.get=function(){return Id},Sd.IntervalIndexedGeometry.get=function(){return Td},Object.defineProperties(Ed,Sd);var Id=function(){this._counter=null;var t=arguments[0];this._counter=t};Id.prototype.visitItem=function(t){var e=t;this._counter.countSegment(e.getCoordinate(0),e.getCoordinate(1))},Id.prototype.interfaces_=function(){return[Qh]},Id.prototype.getClass=function(){return Id};var Td=function(){this._index=new bd;var t=arguments[0];this.init(t)};Td.prototype.init=function(t){for(var e=Mf.getLines(t).iterator();e.hasNext();){var r=e.next().getCoordinates();this.addLine(r)}},Td.prototype.addLine=function(t){for(var e=1;e<t.length;e++){var r=new _p(t[e-1],t[e]),n=Math.min(r.p0.y,r.p1.y),i=Math.max(r.p0.y,r.p1.y);this._index.insert(n,i,r)}},Td.prototype.query=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],r=new wd;return this._index.query(t,e,r),r.getItems()}if(3===arguments.length){var n=arguments[0],i=arguments[1],o=arguments[2];this._index.query(n,i,o)}},Td.prototype.interfaces_=function(){return[]},Td.prototype.getClass=function(){return Td};var Cd=function(t){function e(){if(t.call(this),this._parentGeom=null,this._lineEdgeMap=new dh,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new Af,2===arguments.length){var e=arguments[0],r=arguments[1],n=Qu.OGC_SFS_BOUNDARY_RULE;this._argIndex=e,this._parentGeom=r,this._boundaryNodeRule=n,null!==r&&this.add(r)}else if(3===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2];this._argIndex=i,this._parentGeom=o,this._boundaryNodeRule=s,null!==o&&this.add(o)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertBoundaryPoint=function(t,r){var n=this._nodes.addNode(r).getLabel(),i=1;n.getLocation(t,Ch.ON)===fu.BOUNDARY&&i++;var o=e.determineBoundary(this._boundaryNodeRule,i);n.setLocation(t,o)},e.prototype.computeSelfNodes=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return this.computeSelfNodes(t,e,!1)}if(3===arguments.length){var r=arguments[0],n=arguments[1],i=arguments[2],o=new dd(r,!0,!1);o.setIsDoneIfProperInt(i);var s=this.createEdgeSetIntersector(),a=this._parentGeom instanceof nh||this._parentGeom instanceof eh||this._parentGeom instanceof ih,l=n||!a;return s.computeIntersections(this._edges,o,l),this.addSelfIntersectionNodes(this._argIndex),o}},e.prototype.computeSplitEdges=function(t){for(var e=this._edges.iterator();e.hasNext();)e.next().eiList.addSplitEdges(t)},e.prototype.computeEdgeIntersections=function(t,e,r){var n=new dd(e,r,!0);return n.setBoundaryNodes(this.getBoundaryNodes(),t.getBoundaryNodes()),this.createEdgeSetIntersector().computeIntersections(this._edges,t._edges,n),n},e.prototype.getGeometry=function(){return this._parentGeom},e.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},e.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},e.prototype.addPoint=function(){if(arguments[0]instanceof Qc){var t=arguments[0],e=t.getCoordinate();this.insertPoint(this._argIndex,e,fu.INTERIOR)}else if(arguments[0]instanceof uu){var r=arguments[0];this.insertPoint(this._argIndex,r,fu.INTERIOR)}},e.prototype.addPolygon=function(t){this.addPolygonRing(t.getExteriorRing(),fu.EXTERIOR,fu.INTERIOR);for(var e=0;e<t.getNumInteriorRing();e++){var r=t.getInteriorRingN(e);this.addPolygonRing(r,fu.INTERIOR,fu.EXTERIOR)}},e.prototype.addEdge=function(t){this.insertEdge(t);var e=t.getCoordinates();this.insertPoint(this._argIndex,e[0],fu.BOUNDARY),this.insertPoint(this._argIndex,e[e.length-1],fu.BOUNDARY)},e.prototype.addLineString=function(t){var e=fc.removeRepeatedPoints(t.getCoordinates());if(e.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=e[0],null;var r=new sf(e,new Oh(this._argIndex,fu.INTERIOR));this._lineEdgeMap.put(t,r),this.insertEdge(r),ju.isTrue(e.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,e[0]),this.insertBoundaryPoint(this._argIndex,e[e.length-1])},e.prototype.getInvalidPoint=function(){return this._invalidPoint},e.prototype.getBoundaryPoints=function(){for(var t=this.getBoundaryNodes(),e=new Array(t.size()).fill(null),r=0,n=t.iterator();n.hasNext();){var i=n.next();e[r++]=i.getCoordinate().copy()}return e},e.prototype.getBoundaryNodes=function(){return null===this._boundaryNodes&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},e.prototype.addSelfIntersectionNode=function(t,e,r){if(this.isBoundaryNode(t,e))return null;r===fu.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(t,e):this.insertPoint(t,e,r)},e.prototype.addPolygonRing=function(t,e,r){if(t.isEmpty())return null;var n=fc.removeRepeatedPoints(t.getCoordinates());if(n.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=n[0],null;var i=e,o=r;Zu.isCCW(n)&&(i=r,o=e);var s=new sf(n,new Oh(this._argIndex,fu.BOUNDARY,i,o));this._lineEdgeMap.put(t,s),this.insertEdge(s),this.insertPoint(this._argIndex,n[0],fu.BOUNDARY)},e.prototype.insertPoint=function(t,e,r){var n=this._nodes.addNode(e),i=n.getLabel();null===i?n._label=new Oh(t,r):i.setLocation(t,r)},e.prototype.createEdgeSetIntersector=function(){return new md},e.prototype.addSelfIntersectionNodes=function(t){for(var e=this._edges.iterator();e.hasNext();)for(var r=e.next(),n=r.getLabel().getLocation(t),i=r.eiList.iterator();i.hasNext();){var o=i.next();this.addSelfIntersectionNode(t,o.coord,n)}},e.prototype.add=function(){if(1!==arguments.length)return t.prototype.add.apply(this,arguments);var e=arguments[0];if(e.isEmpty())return null;if(e instanceof ih&&(this._useBoundaryDeterminationRule=!1),e instanceof eh)this.addPolygon(e);else if(e instanceof Jc)this.addLineString(e);else if(e instanceof Qc)this.addPoint(e);else if(e instanceof rh)this.addCollection(e);else if(e instanceof Bc)this.addCollection(e);else if(e instanceof ih)this.addCollection(e);else{if(!(e instanceof Fc))throw new Error(e.getClass().getName());this.addCollection(e)}},e.prototype.addCollection=function(t){for(var e=0;e<t.getNumGeometries();e++){var r=t.getGeometryN(e);this.add(r)}},e.prototype.locate=function(t){return mu(this._parentGeom,th)&&this._parentGeom.getNumGeometries()>50?(null===this._areaPtLocator&&(this._areaPtLocator=new Ed(this._parentGeom)),this._areaPtLocator.locate(t)):this._ptLocator.locate(t,this._parentGeom)},e.prototype.findEdge=function(){if(1===arguments.length){var e=arguments[0];return this._lineEdgeMap.get(e)}return t.prototype.findEdge.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.determineBoundary=function(t,e){return t.isInBoundary(e)?fu.BOUNDARY:fu.INTERIOR},e}(Wh),Md=function(){if(this._li=new Gu,this._resultPrecisionModel=null,this._arg=null,1===arguments.length){var t=arguments[0];this.setComputationPrecision(t.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new Cd(0,t)}else if(2===arguments.length){var e=arguments[0],r=arguments[1],n=Qu.OGC_SFS_BOUNDARY_RULE;e.getPrecisionModel().compareTo(r.getPrecisionModel())>=0?this.setComputationPrecision(e.getPrecisionModel()):this.setComputationPrecision(r.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Cd(0,e,n),this._arg[1]=new Cd(1,r,n)}else if(3===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2];i.getPrecisionModel().compareTo(o.getPrecisionModel())>=0?this.setComputationPrecision(i.getPrecisionModel()):this.setComputationPrecision(o.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Cd(0,i,s),this._arg[1]=new Cd(1,o,s)}};Md.prototype.getArgGeometry=function(t){return this._arg[t].getGeometry()},Md.prototype.setComputationPrecision=function(t){this._resultPrecisionModel=t,this._li.setPrecisionModel(this._resultPrecisionModel)},Md.prototype.interfaces_=function(){return[]},Md.prototype.getClass=function(){return Md};var Ad=function(){};Ad.prototype.interfaces_=function(){return[]},Ad.prototype.getClass=function(){return Ad},Ad.map=function(){if(arguments[0]instanceof Yu&&mu(arguments[1],Ad.MapOp)){for(var t=arguments[0],e=arguments[1],r=new cc,n=0;n<t.getNumGeometries();n++){var i=e.map(t.getGeometryN(n));null!==i&&r.add(i)}return t.getFactory().buildGeometry(r)}if(mu(arguments[0],oc)&&mu(arguments[1],Ad.MapOp)){for(var o=arguments[0],s=arguments[1],a=new cc,l=o.iterator();l.hasNext();){var u=l.next(),c=s.map(u);null!==c&&a.add(c)}return a}},Ad.MapOp=function(){};var Pd=function(t){function e(){var e=arguments[0],r=arguments[1];t.call(this,e,r),this._ptLocator=new Af,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new Hp,this._resultPolyList=new cc,this._resultLineList=new cc,this._resultPointList=new cc,this._graph=new Wh(new Wp),this._geomFact=e.getFactory()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertUniqueEdge=function(t){var e=this._edgeList.findEqualEdge(t);if(null!==e){var r=e.getLabel(),n=t.getLabel();e.isPointwiseEqual(t)||(n=new Oh(t.getLabel())).flip();var i=e.getDepth();i.isNull()&&i.add(r),i.add(n),r.merge(n)}else this._edgeList.add(t)},e.prototype.getGraph=function(){return this._graph},e.prototype.cancelDuplicateResultEdges=function(){for(var t=this._graph.getEdgeEnds().iterator();t.hasNext();){var e=t.next(),r=e.getSym();e.isInResult()&&r.isInResult()&&(e.setInResult(!1),r.setInResult(!1))}},e.prototype.isCoveredByLA=function(t){return!!this.isCovered(t,this._resultLineList)||!!this.isCovered(t,this._resultPolyList)},e.prototype.computeGeometry=function(t,r,n,i){var o=new cc;return o.addAll(t),o.addAll(r),o.addAll(n),o.isEmpty()?e.createEmptyResult(i,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(o)},e.prototype.mergeSymLabels=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();)t.next().getEdges().mergeSymLabels()},e.prototype.isCovered=function(t,e){for(var r=e.iterator();r.hasNext();){var n=r.next();if(this._ptLocator.locate(t,n)!==fu.EXTERIOR)return!0}return!1},e.prototype.replaceCollapsedEdges=function(){for(var t=new cc,e=this._edgeList.iterator();e.hasNext();){var r=e.next();r.isCollapsed()&&(e.remove(),t.add(r.getCollapsedEdge()))}this._edgeList.addAll(t)},e.prototype.updateNodeLabelling=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();){var e=t.next(),r=e.getEdges().getLabel();e.getLabel().merge(r)}},e.prototype.getResultGeometry=function(t){return this.computeOverlay(t),this._resultGeom},e.prototype.insertUniqueEdges=function(t){for(var e=t.iterator();e.hasNext();){var r=e.next();this.insertUniqueEdge(r)}},e.prototype.computeOverlay=function(t){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var e=new cc;this._arg[0].computeSplitEdges(e),this._arg[1].computeSplitEdges(e),this.insertUniqueEdges(e),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),Wf.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(t),this.cancelDuplicateResultEdges();var r=new Yh(this._geomFact);r.add(this._graph),this._resultPolyList=r.getPolygons();var n=new Hf(this,this._geomFact,this._ptLocator);this._resultLineList=n.build(t);var i=new Jf(this,this._geomFact,this._ptLocator);this._resultPointList=i.build(t),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,t)},e.prototype.labelIncompleteNode=function(t,e){var r=this._ptLocator.locate(t.getCoordinate(),this._arg[e].getGeometry());t.getLabel().setLocation(e,r)},e.prototype.copyPoints=function(t){for(var e=this._arg[t].getNodeIterator();e.hasNext();){var r=e.next();this._graph.addNode(r.getCoordinate()).setLabel(t,r.getLabel().getLocation(t))}},e.prototype.findResultAreaEdges=function(t){for(var r=this._graph.getEdgeEnds().iterator();r.hasNext();){var n=r.next(),i=n.getLabel();i.isArea()&&!n.isInteriorAreaEdge()&&e.isResultOfOp(i.getLocation(0,Ch.RIGHT),i.getLocation(1,Ch.RIGHT),t)&&n.setInResult(!0)}},e.prototype.computeLabelsFromDepths=function(){for(var t=this._edgeList.iterator();t.hasNext();){var e=t.next(),r=e.getLabel(),n=e.getDepth();if(!n.isNull()){n.normalize();for(var i=0;i<2;i++)r.isNull(i)||!r.isArea()||n.isNull(i)||(0===n.getDelta(i)?r.toLine(i):(ju.isTrue(!n.isNull(i,Ch.LEFT),"depth of LEFT side has not been initialized"),r.setLocation(i,Ch.LEFT,n.getLocation(i,Ch.LEFT)),ju.isTrue(!n.isNull(i,Ch.RIGHT),"depth of RIGHT side has not been initialized"),r.setLocation(i,Ch.RIGHT,n.getLocation(i,Ch.RIGHT))))}}},e.prototype.computeLabelling=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();)t.next().getEdges().computeLabelling(this._arg);this.mergeSymLabels(),this.updateNodeLabelling()},e.prototype.labelIncompleteNodes=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();){var e=t.next(),r=e.getLabel();e.isIsolated()&&(r.isNull(0)?this.labelIncompleteNode(e,0):this.labelIncompleteNode(e,1)),e.getEdges().updateLabelling(r)}},e.prototype.isCoveredByA=function(t){return!!this.isCovered(t,this._resultPolyList)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Md);Pd.overlayOp=function(t,e,r){return new Pd(t,e).getResultGeometry(r)},Pd.intersection=function(t,e){if(t.isEmpty()||e.isEmpty())return Pd.createEmptyResult(Pd.INTERSECTION,t,e,t.getFactory());if(t.isGeometryCollection()){var r=e;return Yf.map(t,{interfaces_:function(){return[Ad.MapOp]},map:function(t){return t.intersection(r)}})}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),ud.overlayOp(t,e,Pd.INTERSECTION)},Pd.symDifference=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return Pd.createEmptyResult(Pd.SYMDIFFERENCE,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),ud.overlayOp(t,e,Pd.SYMDIFFERENCE)},Pd.resultDimension=function(t,e,r){var n=e.getDimension(),i=r.getDimension(),o=-1;switch(t){case Pd.INTERSECTION:o=Math.min(n,i);break;case Pd.UNION:o=Math.max(n,i);break;case Pd.DIFFERENCE:o=n;break;case Pd.SYMDIFFERENCE:o=Math.max(n,i)}return o},Pd.createEmptyResult=function(t,e,r,n){var i=null;switch(Pd.resultDimension(t,e,r)){case-1:i=n.createGeometryCollection(new Array(0).fill(null));break;case 0:i=n.createPoint();break;case 1:i=n.createLineString();break;case 2:i=n.createPolygon()}return i},Pd.difference=function(t,e){return t.isEmpty()?Pd.createEmptyResult(Pd.DIFFERENCE,t,e,t.getFactory()):e.isEmpty()?t.copy():(t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),ud.overlayOp(t,e,Pd.DIFFERENCE))},Pd.isResultOfOp=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],r=t.getLocation(0),n=t.getLocation(1);return Pd.isResultOfOp(r,n,e)}if(3===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2];switch(i===fu.BOUNDARY&&(i=fu.INTERIOR),o===fu.BOUNDARY&&(o=fu.INTERIOR),s){case Pd.INTERSECTION:return i===fu.INTERIOR&&o===fu.INTERIOR;case Pd.UNION:return i===fu.INTERIOR||o===fu.INTERIOR;case Pd.DIFFERENCE:return i===fu.INTERIOR&&o!==fu.INTERIOR;case Pd.SYMDIFFERENCE:return i===fu.INTERIOR&&o!==fu.INTERIOR||i!==fu.INTERIOR&&o===fu.INTERIOR}return!1}},Pd.INTERSECTION=1,Pd.UNION=2,Pd.DIFFERENCE=3,Pd.SYMDIFFERENCE=4;var kd=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new Af,this._seg=new _p;var t=arguments[0],e=arguments[1];this._g=t,this._boundaryDistanceTolerance=e,this._linework=this.extractLinework(t)};kd.prototype.isWithinToleranceOfBoundary=function(t){for(var e=this,r=0;r<this._linework.getNumGeometries();r++)for(var n=e._linework.getGeometryN(r).getCoordinateSequence(),i=0;i<n.size()-1;i++)if(n.getCoordinate(i,e._seg.p0),n.getCoordinate(i+1,e._seg.p1),e._seg.distance(t)<=e._boundaryDistanceTolerance)return!0;return!1},kd.prototype.getLocation=function(t){return this.isWithinToleranceOfBoundary(t)?fu.BOUNDARY:this._ptLocator.locate(t,this._g)},kd.prototype.extractLinework=function(t){var e=new Ld;t.apply(e);var r=e.getLinework(),n=vh.toLineStringArray(r);return t.getFactory().createMultiLineString(n)},kd.prototype.interfaces_=function(){return[]},kd.prototype.getClass=function(){return kd};var Ld=function(){this._linework=null,this._linework=new cc};Ld.prototype.getLinework=function(){return this._linework},Ld.prototype.filter=function(t){if(t instanceof eh){var e=t;this._linework.add(e.getExteriorRing());for(var r=0;r<e.getNumInteriorRing();r++)this._linework.add(e.getInteriorRingN(r))}},Ld.prototype.interfaces_=function(){return[Oc]},Ld.prototype.getClass=function(){return Ld};var zd=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var t=arguments[0];this._g=t};zd.prototype.extractPoints=function(t,e,r){for(var n=t.getCoordinates(),i=0;i<n.length-1;i++)this.computeOffsetPoints(n[i],n[i+1],e,r)},zd.prototype.setSidesToGenerate=function(t,e){this._doLeft=t,this._doRight=e},zd.prototype.getPoints=function(t){for(var e=new cc,r=Mf.getLines(this._g).iterator();r.hasNext();){var n=r.next();this.extractPoints(n,t,e)}return e},zd.prototype.computeOffsetPoints=function(t,e,r,n){var i=e.x-t.x,o=e.y-t.y,s=Math.sqrt(i*i+o*o),a=r*i/s,l=r*o/s,u=(e.x+t.x)/2,c=(e.y+t.y)/2;if(this._doLeft){var h=new uu(u-l,c+a);n.add(h)}if(this._doRight){var p=new uu(u+l,c-a);n.add(p)}},zd.prototype.interfaces_=function(){return[]},zd.prototype.getClass=function(){return zd};var Dd=function t(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=t.TOLERANCE,this._testCoords=new cc;var e=arguments[0],r=arguments[1],n=arguments[2];this._boundaryDistanceTolerance=t.computeBoundaryDistanceTolerance(e,r),this._geom=[e,r,n],this._locFinder=[new kd(this._geom[0],this._boundaryDistanceTolerance),new kd(this._geom[1],this._boundaryDistanceTolerance),new kd(this._geom[2],this._boundaryDistanceTolerance)]},Rd={TOLERANCE:{configurable:!0}};Dd.prototype.reportResult=function(t,e,r){Au.out.println("Overlay result invalid - A:"+fu.toLocationSymbol(e[0])+" B:"+fu.toLocationSymbol(e[1])+" expected:"+(r?"i":"e")+" actual:"+fu.toLocationSymbol(e[2]))},Dd.prototype.isValid=function(t){this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]);var e=this.checkValid(t);return e},Dd.prototype.checkValid=function(){var t=this;if(1===arguments.length){for(var e=arguments[0],r=0;r<this._testCoords.size();r++){var n=t._testCoords.get(r);if(!t.checkValid(e,n))return t._invalidLocation=n,!1}return!0}if(2===arguments.length){var i=arguments[0],o=arguments[1];return this._location[0]=this._locFinder[0].getLocation(o),this._location[1]=this._locFinder[1].getLocation(o),this._location[2]=this._locFinder[2].getLocation(o),!!Dd.hasLocation(this._location,fu.BOUNDARY)||this.isValidResult(i,this._location)}},Dd.prototype.addTestPts=function(t){var e=new zd(t);this._testCoords.addAll(e.getPoints(5*this._boundaryDistanceTolerance))},Dd.prototype.isValidResult=function(t,e){var r=Pd.isResultOfOp(e[0],e[1],t),n=!(r^e[2]===fu.INTERIOR);return n||this.reportResult(t,e,r),n},Dd.prototype.getInvalidLocation=function(){return this._invalidLocation},Dd.prototype.interfaces_=function(){return[]},Dd.prototype.getClass=function(){return Dd},Dd.hasLocation=function(t,e){for(var r=0;r<3;r++)if(t[r]===e)return!0;return!1},Dd.computeBoundaryDistanceTolerance=function(t,e){return Math.min(td.computeSizeBasedSnapTolerance(t),td.computeSizeBasedSnapTolerance(e))},Dd.isValid=function(t,e,r,n){return new Dd(t,e,n).isValid(r)},Rd.TOLERANCE.get=function(){return 1e-6},Object.defineProperties(Dd,Rd);var Od=function t(e){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=t.extractFactory(e),this._inputGeoms=e};Od.prototype.extractElements=function(t,e){if(null===t)return null;for(var r=0;r<t.getNumGeometries();r++){var n=t.getGeometryN(r);this._skipEmpty&&n.isEmpty()||e.add(n)}},Od.prototype.combine=function(){for(var t=new cc,e=this._inputGeoms.iterator();e.hasNext();){var r=e.next();this.extractElements(r,t)}return 0===t.size()?null!==this._geomFactory?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(t)},Od.prototype.interfaces_=function(){return[]},Od.prototype.getClass=function(){return Od},Od.combine=function(){if(1===arguments.length){var t=arguments[0],e=new Od(t);return e.combine()}if(2===arguments.length){var r=arguments[0],n=arguments[1],i=new Od(Od.createList(r,n));return i.combine()}if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2],l=new Od(Od.createList(o,s,a));return l.combine()}},Od.extractFactory=function(t){return t.isEmpty()?null:t.iterator().next().getFactory()},Od.createList=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],r=new cc;return r.add(t),r.add(e),r}if(3===arguments.length){var n=arguments[0],i=arguments[1],o=arguments[2],s=new cc;return s.add(n),s.add(i),s.add(o),s}};var Nd=function(){this._inputPolys=null,this._geomFactory=null;var t=arguments[0];this._inputPolys=t,null===this._inputPolys&&(this._inputPolys=new cc)},Fd={STRTREE_NODE_CAPACITY:{configurable:!0}};Nd.prototype.reduceToGeometries=function(t){for(var e=new cc,r=t.iterator();r.hasNext();){var n=r.next(),i=null;mu(n,lc)?i=this.unionTree(n):n instanceof Yu&&(i=n),e.add(i)}return e},Nd.prototype.extractByEnvelope=function(t,e,r){for(var n=new cc,i=0;i<e.getNumGeometries();i++){var o=e.getGeometryN(i);o.getEnvelopeInternal().intersects(t)?n.add(o):r.add(o)}return this._geomFactory.buildGeometry(n)},Nd.prototype.unionOptimized=function(t,e){var r=t.getEnvelopeInternal(),n=e.getEnvelopeInternal();if(!r.intersects(n))return Od.combine(t,e);if(t.getNumGeometries()<=1&&e.getNumGeometries()<=1)return this.unionActual(t,e);var i=r.intersection(n);return this.unionUsingEnvelopeIntersection(t,e,i)},Nd.prototype.union=function(){if(null===this._inputPolys)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var t=new up(Nd.STRTREE_NODE_CAPACITY),e=this._inputPolys.iterator();e.hasNext();){var r=e.next();t.insert(r.getEnvelopeInternal(),r)}this._inputPolys=null;var n=t.itemsTree();return this.unionTree(n)},Nd.prototype.binaryUnion=function(){if(1===arguments.length){var t=arguments[0];return this.binaryUnion(t,0,t.size())}if(3===arguments.length){var e=arguments[0],r=arguments[1],n=arguments[2];if(n-r<=1){var i=Nd.getGeometry(e,r);return this.unionSafe(i,null)}if(n-r==2)return this.unionSafe(Nd.getGeometry(e,r),Nd.getGeometry(e,r+1));var o=Math.trunc((n+r)/2),s=this.binaryUnion(e,r,o),a=this.binaryUnion(e,o,n);return this.unionSafe(s,a)}},Nd.prototype.repeatedUnion=function(t){for(var e=null,r=t.iterator();r.hasNext();){var n=r.next();e=null===e?n.copy():e.union(n)}return e},Nd.prototype.unionSafe=function(t,e){return null===t&&null===e?null:null===t?e.copy():null===e?t.copy():this.unionOptimized(t,e)},Nd.prototype.unionActual=function(t,e){return Nd.restrictToPolygons(t.union(e))},Nd.prototype.unionTree=function(t){var e=this.reduceToGeometries(t);return this.binaryUnion(e)},Nd.prototype.unionUsingEnvelopeIntersection=function(t,e,r){var n=new cc,i=this.extractByEnvelope(r,t,n),o=this.extractByEnvelope(r,e,n),s=this.unionActual(i,o);return n.add(s),Od.combine(n)},Nd.prototype.bufferUnion=function(){if(1===arguments.length){var t=arguments[0],e=t.get(0).getFactory(),r=e.buildGeometry(t),n=r.buffer(0);return n}if(2===arguments.length){var i=arguments[0],o=arguments[1],s=i.getFactory(),a=s.createGeometryCollection([i,o]),l=a.buffer(0);return l}},Nd.prototype.interfaces_=function(){return[]},Nd.prototype.getClass=function(){return Nd},Nd.restrictToPolygons=function(t){if(mu(t,th))return t;var e=Cf.getPolygons(t);return 1===e.size()?e.get(0):t.getFactory().createMultiPolygon(vh.toPolygonArray(e))},Nd.getGeometry=function(t,e){return e>=t.size()?null:t.get(e)},Nd.union=function(t){return new Nd(t).union()},Fd.STRTREE_NODE_CAPACITY.get=function(){return 4},Object.defineProperties(Nd,Fd);var Bd=function(){};function jd(){return new Ud}function Ud(){this.reset()}Bd.prototype.interfaces_=function(){return[]},Bd.prototype.getClass=function(){return Bd},Bd.union=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return Pd.createEmptyResult(Pd.UNION,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),ud.overlayOp(t,e,Pd.UNION)},Ud.prototype={constructor:Ud,reset:function(){this.s=this.t=0},add:function(t){Gd(Vd,t,this.t),Gd(this,Vd.s,this.s),this.s?this.t+=Vd.t:this.s=Vd.t},valueOf:function(){return this.s}};var Vd=new Ud;function Gd(t,e,r){var n=t.s=e+r,i=n-e,o=n-i;t.t=e-o+(r-i)}var qd=1e-6,$d=Math.PI,Zd=$d/2,Xd=$d/4,Wd=2*$d,Yd=180/$d,Hd=$d/180,Jd=Math.abs,Kd=Math.atan,Qd=Math.atan2,tm=Math.cos,em=Math.sin,rm=Math.sqrt;function nm(t){return t>1?0:t<-1?$d:Math.acos(t)}function im(t){return t>1?Zd:t<-1?-Zd:Math.asin(t)}function om(){}function sm(t,e){t&&cm.hasOwnProperty(t.type)&&cm[t.type](t,e)}var am,lm,um={Feature:function(t,e){sm(t.geometry,e)},FeatureCollection:function(t,e){for(var r=t.features,n=-1,i=r.length;++n<i;)sm(r[n].geometry,e)}},cm={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var r=t.coordinates,n=-1,i=r.length;++n<i;)t=r[n],e.point(t[0],t[1],t[2])},LineString:function(t,e){hm(t.coordinates,e,0)},MultiLineString:function(t,e){for(var r=t.coordinates,n=-1,i=r.length;++n<i;)hm(r[n],e,0)},Polygon:function(t,e){pm(t.coordinates,e)},MultiPolygon:function(t,e){for(var r=t.coordinates,n=-1,i=r.length;++n<i;)pm(r[n],e)},GeometryCollection:function(t,e){for(var r=t.geometries,n=-1,i=r.length;++n<i;)sm(r[n],e)}};function hm(t,e,r){var n,i=-1,o=t.length-r;for(e.lineStart();++i<o;)n=t[i],e.point(n[0],n[1],n[2]);e.lineEnd()}function pm(t,e){var r=-1,n=t.length;for(e.polygonStart();++r<n;)hm(t[r],e,1);e.polygonEnd()}function fm(t){return[Qd(t[1],t[0]),im(t[2])]}function dm(t){var e=t[0],r=t[1],n=tm(r);return[n*tm(e),n*em(e),em(r)]}function mm(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function gm(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function ym(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function _m(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function vm(t){var e=rm(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function xm(t,e){function r(r,n){return r=t(r,n),e(r[0],r[1])}return t.invert&&e.invert&&(r.invert=function(r,n){return(r=e.invert(r,n))&&t.invert(r[0],r[1])}),r}function bm(t,e){return[t>$d?t-Wd:t<-$d?t+Wd:t,e]}function wm(t){return function(e,r){return[(e+=t)>$d?e-Wd:e<-$d?e+Wd:e,r]}}function Em(t){var e=wm(t);return e.invert=wm(-t),e}function Sm(t,e){var r=tm(t),n=em(t),i=tm(e),o=em(e);function s(t,e){var s=tm(e),a=tm(t)*s,l=em(t)*s,u=em(e),c=u*r+a*n;return[Qd(l*i-c*o,a*r-u*n),im(c*i+l*o)]}return s.invert=function(t,e){var s=tm(e),a=tm(t)*s,l=em(t)*s,u=em(e),c=u*i-l*o;return[Qd(l*i+u*o,a*r+c*n),im(c*r-a*n)]},s}function Im(t,e){(e=dm(e))[0]-=t,vm(e);var r=nm(-e[1]);return((-e[2]<0?-r:r)+Wd-qd)%Wd}function Tm(){var t,e=[];return{point:function(e,r){t.push([e,r])},lineStart:function(){e.push(t=[])},lineEnd:om,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var r=e;return e=[],t=null,r}}}function Cm(t,e){return Jd(t[0]-e[0])<qd&&Jd(t[1]-e[1])<qd}function Mm(t,e,r,n){this.x=t,this.z=e,this.o=r,this.e=n,this.v=!1,this.n=this.p=null}function Am(t,e,r,n,i){var o,s,a=[],l=[];if(t.forEach(function(t){if(!((e=t.length-1)<=0)){var e,r,n=t[0],s=t[e];if(Cm(n,s)){for(i.lineStart(),o=0;o<e;++o)i.point((n=t[o])[0],n[1]);i.lineEnd()}else a.push(r=new Mm(n,t,null,!0)),l.push(r.o=new Mm(n,null,r,!1)),a.push(r=new Mm(s,t,null,!1)),l.push(r.o=new Mm(s,null,r,!0))}}),a.length){for(l.sort(e),Pm(a),Pm(l),o=0,s=l.length;o<s;++o)l[o].e=r=!r;for(var u,c,h=a[0];;){for(var p=h,f=!0;p.v;)if((p=p.n)===h)return;u=p.z,i.lineStart();do{if(p.v=p.o.v=!0,p.e){if(f)for(o=0,s=u.length;o<s;++o)i.point((c=u[o])[0],c[1]);else n(p.x,p.n.x,1,i);p=p.n}else{if(f)for(u=p.p.z,o=u.length-1;o>=0;--o)i.point((c=u[o])[0],c[1]);else n(p.x,p.p.x,-1,i);p=p.p}u=(p=p.o).z,f=!f}while(!p.v);i.lineEnd()}}}function Pm(t){if(e=t.length){for(var e,r,n=0,i=t[0];++n<e;)i.n=r=t[n],r.p=i,i=r;i.n=r=t[0],r.p=i}}function km(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Lm(t){for(var e,r,n,i=t.length,o=-1,s=0;++o<i;)s+=t[o].length;for(r=new Array(s);--i>=0;)for(e=(n=t[i]).length;--e>=0;)r[--s]=n[e];return r}jd(),jd(),jd(),bm.invert=bm,1===(am=km).length&&(lm=am,am=function(t,e){return km(lm(t),e)});var zm=1e9,Dm=-zm;function Rm(t,e,r,n){function i(i,o){return t<=i&&i<=r&&e<=o&&o<=n}function o(i,o,a,u){var c=0,h=0;if(null==i||(c=s(i,a))!==(h=s(o,a))||l(i,o)<0^a>0)do{u.point(0===c||3===c?t:r,c>1?n:e)}while((c=(c+a+4)%4)!==h);else u.point(o[0],o[1])}function s(n,i){return Jd(n[0]-t)<qd?i>0?0:3:Jd(n[0]-r)<qd?i>0?2:1:Jd(n[1]-e)<qd?i>0?1:0:i>0?3:2}function a(t,e){return l(t.x,e.x)}function l(t,e){var r=s(t,1),n=s(e,1);return r!==n?r-n:0===r?e[1]-t[1]:1===r?t[0]-e[0]:2===r?t[1]-e[1]:e[0]-t[0]}return function(s){var l,u,c,h,p,f,d,m,g,y,_,v=s,x=Tm(),b={point:w,lineStart:function(){b.point=E,u&&u.push(c=[]),y=!0,g=!1,d=m=NaN},lineEnd:function(){l&&(E(h,p),f&&g&&x.rejoin(),l.push(x.result())),b.point=w,g&&v.lineEnd()},polygonStart:function(){v=x,l=[],u=[],_=!0},polygonEnd:function(){var e=function(){for(var e=0,r=0,i=u.length;r<i;++r)for(var o,s,a=u[r],l=1,c=a.length,h=a[0],p=h[0],f=h[1];l<c;++l)o=p,s=f,p=(h=a[l])[0],f=h[1],s<=n?f>n&&(p-o)*(n-s)>(f-s)*(t-o)&&++e:f<=n&&(p-o)*(n-s)<(f-s)*(t-o)&&--e;return e}(),r=_&&e,i=(l=Lm(l)).length;(r||i)&&(s.polygonStart(),r&&(s.lineStart(),o(null,null,1,s),s.lineEnd()),i&&Am(l,a,e,o,s),s.polygonEnd()),v=s,l=u=c=null}};function w(t,e){i(t,e)&&v.point(t,e)}function E(o,s){var a=i(o,s);if(u&&c.push([o,s]),y)h=o,p=s,f=a,y=!1,a&&(v.lineStart(),v.point(o,s));else if(a&&g)v.point(o,s);else{var l=[d=Math.max(Dm,Math.min(zm,d)),m=Math.max(Dm,Math.min(zm,m))],x=[o=Math.max(Dm,Math.min(zm,o)),s=Math.max(Dm,Math.min(zm,s))];!function(t,e,r,n,i,o){var s,a=t[0],l=t[1],u=0,c=1,h=e[0]-a,p=e[1]-l;if(s=r-a,h||!(s>0)){if(s/=h,h<0){if(s<u)return;s<c&&(c=s)}else if(h>0){if(s>c)return;s>u&&(u=s)}if(s=i-a,h||!(s<0)){if(s/=h,h<0){if(s>c)return;s>u&&(u=s)}else if(h>0){if(s<u)return;s<c&&(c=s)}if(s=n-l,p||!(s>0)){if(s/=p,p<0){if(s<u)return;s<c&&(c=s)}else if(p>0){if(s>c)return;s>u&&(u=s)}if(s=o-l,p||!(s<0)){if(s/=p,p<0){if(s>c)return;s>u&&(u=s)}else if(p>0){if(s<u)return;s<c&&(c=s)}return u>0&&(t[0]=a+u*h,t[1]=l+u*p),c<1&&(e[0]=a+c*h,e[1]=l+c*p),!0}}}}}(l,x,t,e,r,n)?a&&(v.lineStart(),v.point(o,s),_=!1):(g||(v.lineStart(),v.point(l[0],l[1])),v.point(x[0],x[1]),a||v.lineEnd(),_=!1)}d=o,m=s,g=a}return b}}var Om=jd();function Nm(t){return t}jd(),jd(),jd();var Fm=1/0,Bm=Fm,jm=-Fm,Um=jm,Vm={point:function(t,e){t<Fm&&(Fm=t),t>jm&&(jm=t),e<Bm&&(Bm=e),e>Um&&(Um=e)},lineStart:om,lineEnd:om,polygonStart:om,polygonEnd:om,result:function(){var t=[[Fm,Bm],[jm,Um]];return jm=Um=-(Bm=Fm=1/0),t}};function Gm(t,e,r,n){return function(i,o){var s,a,l,u=e(o),c=i.invert(n[0],n[1]),h=Tm(),p=e(h),f=!1,d={point:m,lineStart:y,lineEnd:_,polygonStart:function(){d.point=v,d.lineStart=x,d.lineEnd=b,a=[],s=[]},polygonEnd:function(){d.point=m,d.lineStart=y,d.lineEnd=_,a=Lm(a);var t=function(t,e){var r=e[0],n=e[1],i=[em(r),-tm(r),0],o=0,s=0;Om.reset();for(var a=0,l=t.length;a<l;++a)if(c=(u=t[a]).length)for(var u,c,h=u[c-1],p=h[0],f=h[1]/2+Xd,d=em(f),m=tm(f),g=0;g<c;++g,p=_,d=x,m=b,h=y){var y=u[g],_=y[0],v=y[1]/2+Xd,x=em(v),b=tm(v),w=_-p,E=w>=0?1:-1,S=E*w,I=S>$d,T=d*x;if(Om.add(Qd(T*E*em(S),m*b+T*tm(S))),o+=I?w+E*Wd:w,I^p>=r^_>=r){var C=gm(dm(h),dm(y));vm(C);var M=gm(i,C);vm(M);var A=(I^w>=0?-1:1)*im(M[2]);(n>A||n===A&&(C[0]||C[1]))&&(s+=I^w>=0?1:-1)}}return(o<-1e-6||o<qd&&Om<-1e-6)^1&s}(s,c);a.length?(f||(o.polygonStart(),f=!0),Am(a,$m,t,r,o)):t&&(f||(o.polygonStart(),f=!0),o.lineStart(),r(null,null,1,o),o.lineEnd()),f&&(o.polygonEnd(),f=!1),a=s=null},sphere:function(){o.polygonStart(),o.lineStart(),r(null,null,1,o),o.lineEnd(),o.polygonEnd()}};function m(e,r){var n=i(e,r);t(e=n[0],r=n[1])&&o.point(e,r)}function g(t,e){var r=i(t,e);u.point(r[0],r[1])}function y(){d.point=g,u.lineStart()}function _(){d.point=m,u.lineEnd()}function v(t,e){l.push([t,e]);var r=i(t,e);p.point(r[0],r[1])}function x(){p.lineStart(),l=[]}function b(){v(l[0][0],l[0][1]),p.lineEnd();var t,e,r,n,i=p.clean(),u=h.result(),c=u.length;if(l.pop(),s.push(l),l=null,c)if(1&i){if((e=(r=u[0]).length-1)>0){for(f||(o.polygonStart(),f=!0),o.lineStart(),t=0;t<e;++t)o.point((n=r[t])[0],n[1]);o.lineEnd()}}else c>1&&2&i&&u.push(u.pop().concat(u.shift())),a.push(u.filter(qm))}return d}}function qm(t){return t.length>1}function $m(t,e){return((t=t.x)[0]<0?t[1]-Zd-qd:Zd-t[1])-((e=e.x)[0]<0?e[1]-Zd-qd:Zd-e[1])}jd();var Zm=Gm(function(){return!0},function(t){var e,r=NaN,n=NaN,i=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(o,s){var a=o>0?$d:-$d,l=Jd(o-r);Jd(l-$d)<qd?(t.point(r,n=(n+s)/2>0?Zd:-Zd),t.point(i,n),t.lineEnd(),t.lineStart(),t.point(a,n),t.point(o,n),e=0):i!==a&&l>=$d&&(Jd(r-i)<qd&&(r-=i*qd),Jd(o-a)<qd&&(o-=a*qd),n=function(t,e,r,n){var i,o,s=em(t-r);return Jd(s)>qd?Kd((em(e)*(o=tm(n))*em(r)-em(n)*(i=tm(e))*em(t))/(i*o*s)):(e+n)/2}(r,n,o,s),t.point(i,n),t.lineEnd(),t.lineStart(),t.point(a,n),e=0),t.point(r=o,n=s),i=a},lineEnd:function(){t.lineEnd(),r=n=NaN},clean:function(){return 2-e}}},function(t,e,r,n){var i;if(null==t)i=r*Zd,n.point(-$d,i),n.point(0,i),n.point($d,i),n.point($d,0),n.point($d,-i),n.point(0,-i),n.point(-$d,-i),n.point(-$d,0),n.point(-$d,i);else if(Jd(t[0]-e[0])>qd){var o=t[0]<e[0]?$d:-$d;i=r*o/2,n.point(-o,i),n.point(0,i),n.point(o,i)}else n.point(e[0],e[1])},[-$d,-Zd]);function Xm(t,e){var r=tm(t),n=r>0,i=Jd(r)>qd;function o(t,e){return tm(t)*tm(e)>r}function s(t,e,n){var i=[1,0,0],o=gm(dm(t),dm(e)),s=mm(o,o),a=o[0],l=s-a*a;if(!l)return!n&&t;var u=r*s/l,c=-r*a/l,h=gm(i,o),p=_m(i,u);ym(p,_m(o,c));var f=h,d=mm(p,f),m=mm(f,f),g=d*d-m*(mm(p,p)-1);if(!(g<0)){var y=rm(g),_=_m(f,(-d-y)/m);if(ym(_,p),_=fm(_),!n)return _;var v,x=t[0],b=e[0],w=t[1],E=e[1];b<x&&(v=x,x=b,b=v);var S=b-x,I=Jd(S-$d)<qd;if(!I&&E<w&&(v=w,w=E,E=v),I||S<qd?I?w+E>0^_[1]<(Jd(_[0]-x)<qd?w:E):w<=_[1]&&_[1]<=E:S>$d^(x<=_[0]&&_[0]<=b)){var T=_m(f,(-d+y)/m);return ym(T,p),[_,fm(T)]}}}function a(e,r){var i=n?t:$d-t,o=0;return e<-i?o|=1:e>i&&(o|=2),r<-i?o|=4:r>i&&(o|=8),o}return Gm(o,function(t){var e,r,l,u,c;return{lineStart:function(){u=l=!1,c=1},point:function(h,p){var f,d=[h,p],m=o(h,p),g=n?m?0:a(h,p):m?a(h+(h<0?$d:-$d),p):0;if(!e&&(u=l=m)&&t.lineStart(),m!==l&&(!(f=s(e,d))||Cm(e,f)||Cm(d,f))&&(d[0]+=qd,d[1]+=qd,m=o(d[0],d[1])),m!==l)c=0,m?(t.lineStart(),f=s(d,e),t.point(f[0],f[1])):(f=s(e,d),t.point(f[0],f[1]),t.lineEnd()),e=f;else if(i&&e&&n^m){var y;g&r||!(y=s(d,e,!0))||(c=0,n?(t.lineStart(),t.point(y[0][0],y[0][1]),t.point(y[1][0],y[1][1]),t.lineEnd()):(t.point(y[1][0],y[1][1]),t.lineEnd(),t.lineStart(),t.point(y[0][0],y[0][1])))}!m||e&&Cm(e,d)||t.point(d[0],d[1]),e=d,l=m,r=g},lineEnd:function(){l&&t.lineEnd(),e=null},clean:function(){return c|(u&&l)<<1}}},function(r,n,i,o){!function(t,e,r,n,i,o){if(r){var s=tm(e),a=em(e),l=n*r;null==i?(i=e+n*Wd,o=e-l/2):(i=Im(s,i),o=Im(s,o),(n>0?i<o:i>o)&&(i+=n*Wd));for(var u,c=i;n>0?c>o:c<o;c-=l)u=fm([s,-a*tm(c),-a*em(c)]),t.point(u[0],u[1])}}(o,t,e,i,r,n)},n?[0,-t]:[-$d,t-$d])}function Wm(t){return function(e){var r=new Ym;for(var n in t)r[n]=t[n];return r.stream=e,r}}function Ym(){}function Hm(t,e,r){var n=e[1][0]-e[0][0],i=e[1][1]-e[0][1],o=t.clipExtent&&t.clipExtent();t.scale(150).translate([0,0]),null!=o&&t.clipExtent(null),function(t,e){t&&um.hasOwnProperty(t.type)?um[t.type](t,e):sm(t,e)}(r,t.stream(Vm));var s=Vm.result(),a=Math.min(n/(s[1][0]-s[0][0]),i/(s[1][1]-s[0][1])),l=+e[0][0]+(n-a*(s[1][0]+s[0][0]))/2,u=+e[0][1]+(i-a*(s[1][1]+s[0][1]))/2;return null!=o&&t.clipExtent(o),t.scale(150*a).translate([l,u])}Ym.prototype={constructor:Ym,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var Jm=tm(30*Hd);function Km(t,e){return+e?function(t,e){function r(n,i,o,s,a,l,u,c,h,p,f,d,m,g){var y=u-n,_=c-i,v=y*y+_*_;if(v>4*e&&m--){var x=s+p,b=a+f,w=l+d,E=rm(x*x+b*b+w*w),S=im(w/=E),I=Jd(Jd(w)-1)<qd||Jd(o-h)<qd?(o+h)/2:Qd(b,x),T=t(I,S),C=T[0],M=T[1],A=C-n,P=M-i,k=_*A-y*P;(k*k/v>e||Jd((y*A+_*P)/v-.5)>.3||s*p+a*f+l*d<Jm)&&(r(n,i,o,s,a,l,C,M,I,x/=E,b/=E,w,m,g),g.point(C,M),r(C,M,I,x,b,w,u,c,h,p,f,d,m,g))}}return function(e){var n,i,o,s,a,l,u,c,h,p,f,d,m={point:g,lineStart:y,lineEnd:v,polygonStart:function(){e.polygonStart(),m.lineStart=x},polygonEnd:function(){e.polygonEnd(),m.lineStart=y}};function g(r,n){r=t(r,n),e.point(r[0],r[1])}function y(){c=NaN,m.point=_,e.lineStart()}function _(n,i){var o=dm([n,i]),s=t(n,i);r(c,h,u,p,f,d,c=s[0],h=s[1],u=n,p=o[0],f=o[1],d=o[2],16,e),e.point(c,h)}function v(){m.point=g,e.lineEnd()}function x(){y(),m.point=b,m.lineEnd=w}function b(t,e){_(n=t,e),i=c,o=h,s=p,a=f,l=d,m.point=_}function w(){r(c,h,u,p,f,d,i,o,n,s,a,l,16,e),m.lineEnd=v,v()}return m}}(t,e):function(t){return Wm({point:function(e,r){e=t(e,r),this.stream.point(e[0],e[1])}})}(t)}var Qm=Wm({point:function(t,e){this.stream.point(t*Hd,e*Hd)}});function tg(t){return function(t){var e,r,n,i,o,s,a,l,u,c,h=150,p=480,f=250,d=0,m=0,g=0,y=0,_=0,v=null,x=Zm,b=null,w=Nm,E=.5,S=Km(C,E);function I(t){return[(t=o(t[0]*Hd,t[1]*Hd))[0]*h+r,n-t[1]*h]}function T(t){return(t=o.invert((t[0]-r)/h,(n-t[1])/h))&&[t[0]*Yd,t[1]*Yd]}function C(t,i){return[(t=e(t,i))[0]*h+r,n-t[1]*h]}function M(){o=xm(i=function(t,e,r){return(t%=Wd)?e||r?xm(Em(t),Sm(e,r)):Em(t):e||r?Sm(e,r):bm}(g,y,_),e);var t=e(d,m);return r=p-t[0]*h,n=f+t[1]*h,A()}function A(){return u=c=null,I}return I.stream=function(t){return u&&c===t?u:u=Qm(x(i,S(w(c=t))))},I.clipAngle=function(t){return arguments.length?(x=+t?Xm(v=t*Hd,6*Hd):(v=null,Zm),A()):v*Yd},I.clipExtent=function(t){return arguments.length?(w=null==t?(b=s=a=l=null,Nm):Rm(b=+t[0][0],s=+t[0][1],a=+t[1][0],l=+t[1][1]),A()):null==b?null:[[b,s],[a,l]]},I.scale=function(t){return arguments.length?(h=+t,M()):h},I.translate=function(t){return arguments.length?(p=+t[0],f=+t[1],M()):[p,f]},I.center=function(t){return arguments.length?(d=t[0]%360*Hd,m=t[1]%360*Hd,M()):[d*Yd,m*Yd]},I.rotate=function(t){return arguments.length?(g=t[0]%360*Hd,y=t[1]%360*Hd,_=t.length>2?t[2]%360*Hd:0,M()):[g*Yd,y*Yd,_*Yd]},I.precision=function(t){return arguments.length?(S=Km(C,E=t*t),A()):rm(E)},I.fitExtent=function(t,e){return Hm(I,t,e)},I.fitSize=function(t,e){return function(t,e,r){return Hm(t,[[0,0],e],r)}(I,t,e)},function(){return e=t.apply(this,arguments),I.invert=e.invert&&T,M()}}(function(){return t})()}var eg=function(t){return function(e,r){var n=tm(e),i=tm(r),o=t(n*i);return[o*i*em(e),o*em(r)]}}(function(t){return(t=nm(t))&&t/em(t)});function rg(){return tg(eg).scale(79.4188).clipAngle(179.999)}function ng(t,e,n,i){var o=t.properties||{},a="Feature"===t.type?t.geometry:t;if("GeometryCollection"===a.type){var l=[];return j(t,function(t){var r=ng(t,e,n,i);r&&l.push(r)}),d(l)}var u=function(t){var e=xr(t).geometry.coordinates,n=[-e[0],-e[1]];return rg().rotate(n).scale(r)}(a),c={type:a.type,coordinates:og(a.coordinates,u)},h=(new Ih).read(c),p=x(b(e,n),"meters"),f=vf.bufferOp(h,p,i);if(!ig((f=(new Th).write(f)).coordinates))return s({type:f.type,coordinates:sg(f.coordinates,u)},o)}function ig(t){return Array.isArray(t[0])?ig(t[0]):isNaN(t[0])}function og(t,e){return"object"!=typeof t[0]?e(t):t.map(function(t){return og(t,e)})}function sg(t,e){return"object"!=typeof t[0]?e.invert(t):t.map(function(t){return sg(t,e)})}function ag(t,e,r){void 0===r&&(r={});var n=it(t),i=it(e),o=tu.intersection(n.coordinates,i.coordinates);return 0===o.length?null:1===o.length?c(o[0],r.properties):y(o,r.properties)}function lg(t,e,r){void 0===r&&(r={});var n=JSON.stringify(r.properties||{}),i=t[0],o=t[1],s=t[2],a=t[3],l=(o+a)/2,u=(i+s)/2,c=2*e/xe([i,l],[s,l],r)*(s-i),h=2*e/xe([u,o],[u,a],r)*(a-o),p=c/2,f=2*p,m=Math.sqrt(3)/2*h,g=s-i,y=a-o,_=.75*f,v=m,x=(g-f)/(f-p/2),b=Math.floor(x),w=(b*_-p/2-g)/2-p/2+_/2,E=Math.floor((y-m)/m),S=(y-E*m)/2,I=E*m-y>m/2;I&&(S-=m/4);for(var T=[],C=[],M=0;M<6;M++){var A=2*Math.PI/6*M;T.push(Math.cos(A)),C.push(Math.sin(A))}for(var P=[],k=0;k<=b;k++)for(var L=0;L<=E;L++){var z=k%2==1;if((0!==L||!z)&&(0!==L||!I)){var D=k*_+i-w,R=L*v+o+S;if(z&&(R-=m/2),!0===r.triangles)cg([D,R],c/2,h/2,JSON.parse(n),T,C).forEach(function(t){r.mask?ag(r.mask,t)&&P.push(t):P.push(t)});else{var O=ug([D,R],c/2,h/2,JSON.parse(n),T,C);r.mask?ag(r.mask,O)&&P.push(O):P.push(O)}}}return d(P)}function ug(t,e,r,n,i,o){for(var s=[],a=0;a<6;a++){var l=t[0]+e*i[a],u=t[1]+r*o[a];s.push([l,u])}return s.push(s[0].slice()),c([s],n)}function cg(t,e,r,n,i,o){for(var s=[],a=0;a<6;a++){var l=[];l.push(t),l.push([t[0]+e*i[a],t[1]+r*o[a]]),l.push([t[0]+e*i[(a+1)%6],t[1]+r*o[(a+1)%6]]),l.push(t),s.push(c([l],n))}return s}function hg(t){return y(t)}function pg(t){return c(t&&t.geometry.coordinates||[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]])}function fg(t,e,r){return void 0===r&&(r={}),function(t,e,r,n){void 0===n&&(n={});for(var i=[],o=t[0],s=t[1],a=t[2],l=t[3],u=e/xe([o,s],[a,s],n)*(a-o),h=r/xe([o,s],[o,l],n)*(l-s),p=a-o,f=l-s,m=Math.floor(p/u),g=Math.floor(f/h),y=(f-g*h)/2,_=o+(p-m*u)/2,v=0;v<m;v++){for(var x=s+y,b=0;b<g;b++){var w=c([[[_,x],[_,x+h],[_+u,x+h],[_+u,x],[_,x]]],n.properties);n.mask?As(n.mask,w)&&i.push(w):i.push(w),x+=h}_+=u}return d(i)}(t,e,e,r)}function dg(t,e,r){void 0===r&&(r={});for(var n=[],i=e/xe([t[0],t[1]],[t[2],t[1]],r)*(t[2]-t[0]),o=e/xe([t[0],t[1]],[t[0],t[3]],r)*(t[3]-t[1]),s=0,a=t[0];a<=t[2];){for(var l=0,u=t[1];u<=t[3];){var h=null,p=null;s%2==0&&l%2==0?(h=c([[[a,u],[a,u+o],[a+i,u],[a,u]]],r.properties),p=c([[[a,u+o],[a+i,u+o],[a+i,u],[a,u+o]]],r.properties)):s%2==0&&l%2==1?(h=c([[[a,u],[a+i,u+o],[a+i,u],[a,u]]],r.properties),p=c([[[a,u],[a,u+o],[a+i,u+o],[a,u]]],r.properties)):l%2==0&&s%2==1?(h=c([[[a,u],[a,u+o],[a+i,u+o],[a,u]]],r.properties),p=c([[[a,u],[a+i,u+o],[a+i,u],[a,u]]],r.properties)):l%2==1&&s%2==1&&(h=c([[[a,u],[a,u+o],[a+i,u],[a,u]]],r.properties),p=c([[[a,u+o],[a+i,u+o],[a+i,u],[a,u+o]]],r.properties)),r.mask?(ag(r.mask,h)&&n.push(h),ag(r.mask,p)&&n.push(p)):(n.push(h),n.push(p)),u+=o,l++}s++,a+=i}return d(n)}eg.invert=function(t){return function(e,r){var n=rm(e*e+r*r),i=t(n),o=em(i),s=tm(i);return[Qd(e*o,n*s),im(n&&r*o/n)]}}(function(t){return t}),e.along=function(t,e,r){void 0===r&&(r={});for(var n=it(t).coordinates,i=0,o=0;o<n.length&&!(e>=i&&o===n.length-1);o++){if(i>=e){var s=e-i;if(s){var a=vr(n[o],n[o-1])-180;return yr(n[o],s,a,r)}return l(n[o])}i+=xe(n[o],n[o+1],r)}return l(n[n.length-1])},e.angle=function(t,e,r,n){if(void 0===n&&(n={}),!A(n))throw new Error("options is invalid");if(!t)throw new Error("startPoint is required");if(!e)throw new Error("midPoint is required");if(!r)throw new Error("endPoint is required");var i=t,o=e,s=r,a=E(!0!==n.mercator?vr(i,o):Ui(i,o)),l=E(!0!==n.mercator?vr(s,o):Ui(s,o)),u=Math.abs(a-l);return!0===n.explementary?360-u:u},e.applyFilter=ul,e.area=Gn,e.areaFactors=o,e.bbox=J,e.bboxClip=function(t,e){var r=it(t),n=r.type,i="Feature"===t.type?t.properties:{},o=r.coordinates;switch(n){case"LineString":case"MultiLineString":var s=[];return"LineString"===n&&(o=[o]),o.forEach(function(t){!function(t,e,r){var n,i,o,s,a,l=t.length,u=zi(t[0],e),c=[];for(r||(r=[]),n=1;n<l;n++){for(s=t[n-1],i=o=zi(a=t[n],e);;){if(!(u|i)){c.push(s),i!==o?(c.push(a),n<l-1&&(r.push(c),c=[])):n===l-1&&c.push(a);break}if(u&i)break;u?u=zi(s=Li(s,a,u,e),e):i=zi(a=Li(s,a,i,e),e)}u=o}c.length&&r.push(c)}(t,e,s)}),1===s.length?p(s[0],i):m(s,i);case"Polygon":return c(Di(o,e),i);case"MultiPolygon":return y(o.map(function(t){return Di(t,e)}),i);default:throw new Error("geometry "+n+" not supported")}},e.bboxPolygon=dr,e.bearing=vr,e.bearingToAngle=E,e.bearingToAzimuth=E,e.bezier=fr,e.bezierSpline=fr,e.booleanClockwise=Xi,e.booleanContains=function(t,e){var r=it(t),n=it(e),i=r.type,o=n.type,s=r.coordinates,a=n.coordinates;switch(i){case"Point":switch(o){case"Point":return _s(s,a);default:throw new Error("feature2 "+o+" geometry not supported")}case"MultiPoint":switch(o){case"Point":return function(t,e){var r,n=!1;for(r=0;r<t.coordinates.length;r++)if(_s(t.coordinates[r],e.coordinates)){n=!0;break}return n}(r,n);case"MultiPoint":return function(t,e){for(var r=0,n=e.coordinates;r<n.length;r++){for(var i=n[r],o=!1,s=0,a=t.coordinates;s<a.length;s++)if(_s(i,a[s])){o=!0;break}if(!o)return!1}return!0}(r,n);default:throw new Error("feature2 "+o+" geometry not supported")}case"LineString":switch(o){case"Point":return Yn(n,r,{ignoreEndVertices:!0});case"LineString":return function(t,e){for(var r=!1,n=0,i=e.coordinates;n<i.length;n++){var o=i[n];if(Yn({type:"Point",coordinates:o},t,{ignoreEndVertices:!0})&&(r=!0),!Yn({type:"Point",coordinates:o},t,{ignoreEndVertices:!1}))return!1}return r}(r,n);case"MultiPoint":return function(t,e){for(var r=!1,n=0,i=e.coordinates;n<i.length;n++){var o=i[n];if(Yn(o,t,{ignoreEndVertices:!0})&&(r=!0),!Yn(o,t))return!1}return!!r}(r,n);default:throw new Error("feature2 "+o+" geometry not supported")}case"Polygon":switch(o){case"Point":return ye(n,r,{ignoreBoundary:!0});case"LineString":return function(t,e){var r=!1,n=0,i=J(t),o=J(e);if(!ys(i,o))return!1;for(;n<e.coordinates.length-1;n++)if(ye({type:"Point",coordinates:vs(e.coordinates[n],e.coordinates[n+1])},t,{ignoreBoundary:!0})){r=!0;break}return r}(r,n);case"Polygon":return function(t,e){if("Feature"===t.type&&null===t.geometry)return!1;if("Feature"===e.type&&null===e.geometry)return!1;var r=J(t),n=J(e);if(!ys(r,n))return!1;for(var i=it(e).coordinates,o=0,s=i;o<s.length;o++)for(var a=0,l=s[o];a<l.length;a++)if(!ye(l[a],t))return!1;return!0}(r,n);case"MultiPoint":return function(t,e){for(var r=0,n=e.coordinates;r<n.length;r++)if(!ye(n[r],t,{ignoreBoundary:!0}))return!1;return!0}(r,n);default:throw new Error("feature2 "+o+" geometry not supported")}default:throw new Error("feature1 "+i+" geometry not supported")}},e.booleanCrosses=function(t,e){var r=it(t),n=it(e),i=r.type,o=n.type;switch(i){case"MultiPoint":switch(o){case"LineString":return xs(r,n);case"Polygon":return ws(r,n);default:throw new Error("feature2 "+o+" geometry not supported")}case"LineString":switch(o){case"MultiPoint":return xs(n,r);case"LineString":return function(t,e){if(Ln(t,e).features.length>0)for(var r=0;r<t.coordinates.length-1;r++)for(var n=0;n<e.coordinates.length-1;n++){var i=!0;if(0!==n&&n!==e.coordinates.length-2||(i=!1),Es(t.coordinates[r],t.coordinates[r+1],e.coordinates[n],i))return!0}return!1}(r,n);case"Polygon":return bs(r,n);default:throw new Error("feature2 "+o+" geometry not supported")}case"Polygon":switch(o){case"MultiPoint":return ws(n,r);case"LineString":return bs(n,r);default:throw new Error("feature2 "+o+" geometry not supported")}default:throw new Error("feature1 "+i+" geometry not supported")}},e.booleanDisjoint=fs,e.booleanEqual=function(t,e){return it(t).type===it(e).type&&new Ms({precision:6}).compare(er(t),er(e))},e.booleanIntersects=As,e.booleanOverlap=function(t,e){var r=it(t),n=it(e),i=r.type,o=n.type;if("MultiPoint"===i&&"MultiPoint"!==o||("LineString"===i||"MultiLineString"===i)&&"LineString"!==o&&"MultiLineString"!==o||("Polygon"===i||"MultiPolygon"===i)&&"Polygon"!==o&&"MultiPolygon"!==o)throw new Error("features must be of the same type");if("Point"===i)throw new Error("Point geometry not supported");if(new Ms({precision:6}).compare(t,e))return!1;var s=0;switch(i){case"MultiPoint":for(var a=0;a<r.coordinates.length;a++)for(var l=0;l<n.coordinates.length;l++){var u=r.coordinates[a],c=n.coordinates[l];if(u[0]===c[0]&&u[1]===c[1])return!0}return!1;case"LineString":case"MultiLineString":q(t,function(t){q(e,function(e){Fi(t,e).features.length&&s++})});break;case"Polygon":case"MultiPolygon":q(t,function(t){q(e,function(e){Ln(t,e).features.length&&s++})})}return s>0},e.booleanParallel=function(t,e){if(!t)throw new Error("line1 is required");if(!e)throw new Error("line2 is required");if("LineString"!==qs(t,"line1"))throw new Error("line1 must be a LineString");if("LineString"!==qs(e,"line2"))throw new Error("line2 must be a LineString");for(var r=Hr(er(t)).features,n=Hr(er(e)).features,i=0;i<r.length;i++){var o=r[i].geometry.coordinates;if(!n[i])break;if(!Gs(o,n[i].geometry.coordinates))return!1}return!0},e.booleanPointInPolygon=ye,e.booleanPointOnLine=Yn,e.booleanWithin=Jn,e.buffer=function(t,e,r){var n=(r=r||{}).units||"kilometers",i=r.steps||8;if(!t)throw new Error("geojson is required");if("object"!=typeof r)throw new Error("options must be an object");if("number"!=typeof i)throw new Error("steps must be an number");if(void 0===e)throw new Error("radius is required");if(i<=0)throw new Error("steps must be greater than 0");var o=[];switch(t.type){case"GeometryCollection":return j(t,function(t){var r=ng(t,e,n,i);r&&o.push(r)}),d(o);case"FeatureCollection":return N(t,function(t){var r=ng(t,e,n,i);r&&N(r,function(t){t&&o.push(t)})}),d(o)}return ng(t,e,n,i)},e.center=xr,e.centerMean=Na,e.centerMedian=function(t,e){if(void 0===e&&(e={}),!A(e=e||{}))throw new Error("options is invalid");var r=e.counter||10;if(!M(r))throw new Error("counter must be a number");var n=e.weight,i=Na(t,{weight:e.weight}),o=d([]);N(t,function(t){var e;o.features.push(br(t,{properties:{weight:null===(e=t.properties)||void 0===e?void 0:e[n]}}))});var s={tolerance:e.tolerance,medianCandidates:[]};return Fa(i.geometry.coordinates,[0,0],o,s,r)},e.centerOfMass=function t(e,r){switch(void 0===r&&(r={}),ot(e)){case"Point":return l(K(e),r.properties);case"Polygon":var n=[];z(e,function(t){n.push(t)});var i,o,s,a,u,c,h,p,f=br(e,{properties:r.properties}),d=f.geometry.coordinates,m=0,g=0,y=0,_=n.map(function(t){return[t[0]-d[0],t[1]-d[1]]});for(i=0;i<n.length-1;i++)a=(o=_[i])[0],c=o[1],u=(s=_[i+1])[0],y+=p=a*(h=s[1])-u*c,m+=(a+u)*p,g+=(c+h)*p;if(0===y)return f;var v=1/(.5*y*6);return l([d[0]+v*m,d[1]+v*g],r.properties);default:var x=ge(e);return x?t(x,{properties:r.properties}):br(e,{properties:r.properties})}},e.centroid=br,e.circle=_r,e.cleanCoords=er,e.clone=Ie,e.clusterEach=sl,e.clusterReduce=al,e.clusters=pl,e.clustersDbscan=function(t,e,r){void 0===r&&(r={}),!0!==r.mutate&&(t=Ie(t)),r.minPoints=r.minPoints||3;var n=new Ds.DBSCAN,i=n.run(B(t),T(e,r.units),r.minPoints,xe),o=-1;return i.forEach(function(e){o++,e.forEach(function(e){var r=t.features[e];r.properties||(r.properties={}),r.properties.cluster=o,r.properties.dbscan="core"})}),n.noise.forEach(function(e){var r=t.features[e];r.properties||(r.properties={}),r.properties.cluster?r.properties.dbscan="edge":r.properties.dbscan="noise"}),t},e.clustersKmeans=function(t,e){void 0===e&&(e={});var r=t.features.length;e.numberOfClusters=e.numberOfClusters||Math.round(Math.sqrt(r/2)),e.numberOfClusters>r&&(e.numberOfClusters=r),!0!==e.mutate&&(t=Ie(t));var n=B(t),i=n.slice(0,e.numberOfClusters),o=Vs(n,e.numberOfClusters,i),s={};return o.centroids.forEach(function(t,e){s[e]=t}),N(t,function(t,e){var r=o.idxs[e];t.properties.cluster=r,t.properties.centroid=s[r]}),t},e.collect=function(t,e,r,n){var i=Tt(6),o=e.features.map(function(t){var e;return{minX:t.geometry.coordinates[0],minY:t.geometry.coordinates[1],maxX:t.geometry.coordinates[0],maxY:t.geometry.coordinates[1],property:null===(e=t.properties)||void 0===e?void 0:e[r]}});return i.load(o),t.features.forEach(function(t){t.properties||(t.properties={});var e=J(t),r=i.search({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}),o=[];r.forEach(function(e){ye([e.minX,e.minY],t)&&o.push(e.property)}),t.properties[n]=o}),t},e.collectionOf=nt,e.combine=function(t){var e={MultiPoint:{coordinates:[],properties:[]},MultiLineString:{coordinates:[],properties:[]},MultiPolygon:{coordinates:[],properties:[]}};return N(t,function(t){var r,n,i,o;switch(null===(o=t.geometry)||void 0===o?void 0:o.type){case"Point":e.MultiPoint.coordinates.push(t.geometry.coordinates),e.MultiPoint.properties.push(t.properties);break;case"MultiPoint":(r=e.MultiPoint.coordinates).push.apply(r,t.geometry.coordinates),e.MultiPoint.properties.push(t.properties);break;case"LineString":e.MultiLineString.coordinates.push(t.geometry.coordinates),e.MultiLineString.properties.push(t.properties);break;case"MultiLineString":(n=e.MultiLineString.coordinates).push.apply(n,t.geometry.coordinates),e.MultiLineString.properties.push(t.properties);break;case"Polygon":e.MultiPolygon.coordinates.push(t.geometry.coordinates),e.MultiPolygon.properties.push(t.properties);break;case"MultiPolygon":(i=e.MultiPolygon.coordinates).push.apply(i,t.geometry.coordinates),e.MultiPolygon.properties.push(t.properties)}}),d(Object.keys(e).filter(function(t){return e[t].coordinates.length}).sort().map(function(t){return s({type:t,coordinates:e[t].coordinates},{collectedProperties:e[t].properties})}))},e.concave=function(t,e){void 0===e&&(e={});var r=e.maxEdge||1/0,n=be(function(t){var e=[],r={};return N(t,function(t){if(t.geometry){var n=t.geometry.coordinates.join("-");Object.prototype.hasOwnProperty.call(r,n)||(e.push(t),r[n]=!0)}}),d(e)}(t));if(n.features=n.features.filter(function(t){var n=t.geometry.coordinates[0][0],i=t.geometry.coordinates[0][1],o=t.geometry.coordinates[0][2],s=xe(n,i,e),a=xe(i,o,e),l=xe(n,o,e);return s<=r&&a<=r&&l<=r}),n.features.length<1)return null;var i=tr(n);return 1===i.coordinates.length&&(i.coordinates=i.coordinates[0],i.type="Polygon"),s(i)},e.containsNumber=tt,e.convertArea=C,e.convertDistance=T,e.convertLength=T,e.convex=ge,e.coordAll=B,e.coordEach=z,e.coordReduce=D,e.createBins=ll,e.degrees2radians=I,e.degreesToRadians=I,e.destination=yr,e.difference=function(t,e){var r=it(t),n=it(e),i=t.properties||{},o=tu.difference(r.coordinates,n.coordinates);return 0===o.length?null:1===o.length?c(o[0],i):y(o,i)},e.dissolve=function(t,e){if(!A(e=e||{}))throw new Error("options is invalid");var r=e.propertyName;nt(t,"Polygon","dissolve");var n=[];if(!e.propertyName)return ni(y(tu.union.apply(null,t.features.map(function(t){return t.geometry.coordinates}))));var i={};N(t,function(t){Object.prototype.hasOwnProperty.call(i,t.properties[r])||(i[t.properties[r]]=[]),i[t.properties[r]].push(t)});for(var o=Object.keys(i),s=0;s<o.length;s++){var a=y(tu.union.apply(null,i[o[s]].map(function(t){return t.geometry.coordinates})));a.properties[r]=o[s],n.push(a)}return ni(d(n))},e.distance=xe,e.distanceToDegrees=w,e.distanceToRadians=b,e.distanceWeight=Ga,e.earthRadius=r,e.ellipse=Ra,e.envelope=mr,e.explode=wr,e.factors=n,e.feature=s,e.featureCollection=d,e.featureEach=N,e.featureOf=rt,e.featureReduce=F,e.filterProperties=hl,e.findPoint=Y,e.findSegment=W,e.flatten=ni,e.flattenEach=V,e.flattenReduce=G,e.flip=function(t,e){if(!A(e=e||{}))throw new Error("options is invalid");var r=e.mutate;if(!t)throw new Error("geojson is required");return!1!==r&&void 0!==r||(t=Ie(t)),z(t,function(t){var e=t[0],r=t[1];t[0]=r,t[1]=e}),t},e.geojsonType=et,e.geomEach=j,e.geomReduce=U,e.geometry=a,e.geometryCollection=_,e.getCluster=ol,e.getCoord=K,e.getCoords=Q,e.getGeom=it,e.getType=ot,e.greatCircle=function(t,e,r){if("object"!=typeof(r=r||{}))throw new Error("options is invalid");var n=r.properties,i=r.npoints,o=r.offset;return t=K(t),e=K(e),n=n||{},i=i||100,o=o||10,new _i({x:t[0],y:t[1]},{x:e[0],y:e[1]},n).Arc(i,{offset:o}).json()},e.helpers=L,e.hexGrid=lg,e.inside=ye,e.interpolate=function(t,e,r){if("object"!=typeof(r=r||{}))throw new Error("options is invalid");var n=r.gridType,i=r.property,o=r.weight;if(!t)throw new Error("points is required");if(nt(t,"Point","input must contain Points"),!e)throw new Error("cellSize is required");if(void 0!==o&&"number"!=typeof o)throw new Error("weight must be a number");i=i||"elevation",n=n||"square",o=o||1;var s,a=J(t);switch(n){case"point":case"points":s=ei(a,e,r);break;case"square":case"squares":s=fg(a,e,r);break;case"hex":case"hexes":s=lg(a,e,r);break;case"triangle":case"triangles":s=dg(a,e,r);break;default:throw new Error("invalid gridType")}var l=[];return N(s,function(e){var s=0,a=0;N(t,function(t){var l,u=xe("point"===n?e:br(e),t,r);if(void 0!==i&&(l=t.properties[i]),void 0===l&&(l=t.geometry.coordinates[2]),void 0===l)throw new Error("zValue is missing");0===u&&(s=l);var c=1/Math.pow(u,o);a+=c,s+=c*l});var u=Ie(e);u.properties[i]=s/a,l.push(u)}),d(l)},e.intersect=ag,e.invariant=st,e.isNumber=M,e.isObject=A,e.isobands=function(t,e,r){if(!A(r=r||{}))throw new Error("options is invalid");var n=r.zProperty||"elevation",i=r.commonProperties||{},o=r.breaksProperties||[];if(nt(t,"Point","Input must contain Points"),!e)throw new Error("breaks is required");if(!Array.isArray(e))throw new Error("breaks is not an Array");if(!A(i))throw new Error("commonProperties is not an Object");if(!Array.isArray(o))throw new Error("breaksProperties is not an Array");var s=Ji(t,{zProperty:n,flip:!0}),a=function(t,e,r){for(var n=[],i=1;i<e.length;i++){var o=+e[i-1],s=+e[i],a=Jo(Ho(to(t,o,s-o))),l={};l.groupedRings=a,l[r]=o+"-"+s,n.push(l)}return n}(s,e,n);return d((a=function(t,e,r){var n=J(r),i=n[2]-n[0],o=n[3]-n[1],s=n[0],a=n[1],l=e[0].length-1,u=e.length-1,c=i/l,h=o/u,p=function(t){t[0]=t[0]*c+s,t[1]=t[1]*h+a};return t.forEach(function(t){t.groupedRings.forEach(function(t){t.forEach(function(t){t.forEach(p)})})}),t}(a,s,t)).map(function(t,e){if(o[e]&&!A(o[e]))throw new Error("Each mappedProperty is required to be an Object");var r=ht({},i,o[e]);return r[n]=t[n],y(t.groupedRings,r)}))},e.isolines=function(t,e,r){if(!A(r=r||{}))throw new Error("options is invalid");var n=r.zProperty||"elevation",i=r.commonProperties||{},o=r.breaksProperties||[];if(nt(t,"Point","Input must contain Points"),!e)throw new Error("breaks is required");if(!Array.isArray(e))throw new Error("breaks must be an Array");if(!A(i))throw new Error("commonProperties must be an Object");if(!Array.isArray(o))throw new Error("breaksProperties must be an Array");var s=vt(t,{zProperty:n,flip:!0});return d(function(t,e,r){var n=J(r),i=n[2]-n[0],o=n[3]-n[1],s=n[0],a=n[1],l=e[0].length-1,u=e.length-1,c=i/l,h=o/u,p=function(t){t[0]=t[0]*c+s,t[1]=t[1]*h+a};return t.forEach(function(t){z(t,p)}),t}(function(t,e,r,n,i){for(var o=[],s=1;s<e.length;s++){var a=+e[s],l=ht({},n,i[s]);l[r]=a;var u=m(dt(t,a),l);o.push(u)}return o}(s,e,n,i,o),s,t))},e.kinks=function(t){var e,r,n={type:"FeatureCollection",features:[]};if("LineString"===(r="Feature"===t.type?t.geometry:t).type)e=[r.coordinates];else if("MultiLineString"===r.type)e=r.coordinates;else if("MultiPolygon"===r.type)e=[].concat.apply([],r.coordinates);else{if("Polygon"!==r.type)throw new Error("Input must be a LineString, MultiLineString, Polygon, or MultiPolygon Feature or Geometry");e=r.coordinates}return e.forEach(function(t){e.forEach(function(e){for(var r=0;r<t.length-1;r++)for(var i=r;i<e.length-1;i++){if(t===e){if(1===Math.abs(r-i))continue;if(0===r&&i===t.length-2&&t[r][0]===t[t.length-1][0]&&t[r][1]===t[t.length-1][1])continue}var o=Bn(t[r][0],t[r][1],t[r+1][0],t[r+1][1],e[i][0],e[i][1],e[i+1][0],e[i+1][1]);o&&n.features.push(l([o[0],o[1]]))}})}),n},e.length=Xn,e.lengthToDegrees=w,e.lengthToRadians=b,e.lineArc=Ei,e.lineChunk=function(t,e,r){if(!A(r=r||{}))throw new Error("options is invalid");var n=r.units,i=r.reverse;if(!t)throw new Error("geojson is required");if(e<=0)throw new Error("segmentLength must be greater than 0");var o=[];return V(t,function(t){i&&(t.geometry.coordinates=t.geometry.coordinates.reverse()),function(t,e,r,n){var i=Xn(t,{units:r});if(i<=e)return n(t);var o=i/e;Number.isInteger(o)||(o=Math.floor(o)+1);for(var s=0;s<o;s++)n(Wn(t,e*s,e*(s+1),{units:r}),s)}(t,e,n,function(t){o.push(t)})}),d(o)},e.lineDistance=Xn,e.lineEach=Z,e.lineIntersect=Ln,e.lineOffset=function(t,e,r){if(!A(r=r||{}))throw new Error("options is invalid");var n=r.units;if(!t)throw new Error("geojson is required");if(null==e||isNaN(e))throw new Error("distance is required");var i=ot(t),o=t.properties;switch(i){case"LineString":return ss(t,e,n);case"MultiLineString":var s=[];return V(t,function(t){s.push(ss(t,e,n).geometry.coordinates)}),m(s,o);default:throw new Error("geometry "+i+" is not supported")}},e.lineOverlap=Fi,e.lineReduce=X,e.lineSegment=Hr,e.lineSlice=function(t,e,r){var n=Q(r);if("LineString"!==ot(r))throw new Error("line must be a LineString");for(var i,o=Dn(r,t),s=Dn(r,e),a=[(i=o.properties.index<=s.properties.index?[o,s]:[s,o])[0].geometry.coordinates],l=i[0].properties.index+1;l<i[1].properties.index+1;l++)a.push(n[l]);return a.push(i[1].geometry.coordinates),p(a,r.properties)},e.lineSliceAlong=Wn,e.lineSplit=function(t,e){if(!t)throw new Error("line is required");if(!e)throw new Error("splitter is required");var r=ot(t),n=ot(e);if("LineString"!==r)throw new Error("line must be LineString");if("FeatureCollection"===n)throw new Error("splitter cannot be a FeatureCollection");if("GeometryCollection"===n)throw new Error("splitter cannot be a GeometryCollection");var i=ri(e,{precision:7});switch(n){case"Point":return xi(t,i);case"MultiPoint":return vi(t,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return vi(t,Ln(t,i))}},e.lineString=p,e.lineStringToPolygon=Mi,e.lineStrings=f,e.lineToPolygon=Mi,e.mask=function(t,e){var r,n=pg(e),i=null;return i="FeatureCollection"===t.type?hg(2===(r=t).features.length?tu.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):tu.union.apply(tu,r.features.map(function(t){return t.geometry.coordinates}))):hg(tu.union(t.geometry.coordinates)),i.geometry.coordinates.forEach(function(t){n.geometry.coordinates.push(t[0])}),n},e.meta=H,e.midpoint=function(t,e){return yr(t,xe(t,e)/2,vr(t,e))},e.moranIndex=function(t,e){var r=e.inputField,n=e.threshold||1e5,i=e.p||2,o=e.binary||!1,s=Ga(t,{alpha:e.alpha||-1,binary:o,p:i,standardization:e.standardization||!0,threshold:n}),a=[];N(t,function(t){var e=t.properties||{};a.push(e[r])});for(var l=qa(a),u=function(t){for(var e=qa(t),r=0,n=0,i=t;n<i.length;n++){var o=i[n];r+=Math.pow(o-e,2)}return r/t.length}(a),c=0,h=0,p=0,f=0,d=s.length,m=0;m<d;m++){for(var g=0,y=0;y<d;y++)c+=s[m][y]*(a[m]-l)*(a[y]-l),h+=s[m][y],p+=Math.pow(s[m][y]+s[y][m],2),g+=s[m][y]+s[y][m];f+=Math.pow(g,2)}var _=c/h/u,v=-1/(d-1),x=(d*d*(p*=.5)-d*f+h*h*3)/((d-1)*(d+1)*(h*h))-v*v,b=Math.sqrt(x);return{expectedMoranIndex:v,moranIndex:_,stdNorm:b,zNorm:(_-v)/b}},e.multiLineString=m,e.multiPoint=g,e.multiPolygon=y,e.nearest=Yr,e.nearestPoint=Yr,e.nearestPointOnLine=Dn,e.nearestPointToLine=function(t,e,r){void 0===r&&(r={});var n=r.units,i=r.properties||{},o=function(t){var e=[];switch(t.geometry?t.geometry.type:t.type){case"GeometryCollection":return j(t,function(t){"Point"===t.type&&e.push({type:"Feature",properties:{},geometry:t})}),{type:"FeatureCollection",features:e};case"FeatureCollection":return t.features=t.features.filter(function(t){return"Point"===t.geometry.type}),t;default:throw new Error("points must be a Point Collection")}}(t);if(!o.features.length)throw new Error("points must contain features");if(!e)throw new Error("line is required");if("LineString"!==ot(e))throw new Error("line must be a LineString");var s=1/0,a=null;return N(o,function(t){var r=On(t,e,{units:n});r<s&&(s=r,a=t)}),a&&(a.properties=ht({dist:s},a.properties,i)),a},e.planepoint=function(t,e){var r=K(t),n=it(e).coordinates[0];if(n.length<4)throw new Error("OuterRing of a Polygon must have 4 or more Positions.");var i=e.properties||{},o=i.a,s=i.b,a=i.c,l=r[0],u=r[1],c=n[0][0],h=n[0][1],p=void 0!==o?o:n[0][2],f=n[1][0],d=n[1][1],m=void 0!==s?s:n[1][2],g=n[2][0],y=n[2][1],_=void 0!==a?a:n[2][2];return(_*(l-c)*(u-d)+p*(l-f)*(u-y)+m*(l-g)*(u-h)-m*(l-c)*(u-y)-_*(l-f)*(u-h)-p*(l-g)*(u-d))/((l-c)*(u-d)+(l-f)*(u-y)+(l-g)*(u-h)-(l-c)*(u-y)-(l-f)*(u-h)-(l-g)*(u-d))},e.point=l,e.pointGrid=ei,e.pointOnFeature=jn,e.pointOnLine=Dn,e.pointOnSurface=jn,e.pointToLineDistance=On,e.points=u,e.pointsWithinPolygon=ve,e.polygon=c,e.polygonSmooth=function(t,e){var r=[],n=e.iterations||1;if(!t)throw new Error("inputPolys is required");return j(t,function(t,e,i){var o,s,a;switch(t.type){case"Polygon":o=[[]];for(var l=0;l<n;l++)a=[[]],s=t,l>0&&(s=c(o).geometry),ja(s,a),o=a.slice(0);r.push(c(o,i));break;case"MultiPolygon":o=[[[]]];for(var u=0;u<n;u++)a=[[[]]],s=t,u>0&&(s=y(o).geometry),Ua(s,a),o=a.slice(0);r.push(y(o,i));break;default:throw new Error("geometry is invalid, must be Polygon or MultiPolygon")}}),d(r)},e.polygonTangents=function(t,e){var r,n,i,o,s=Q(t),a=Q(e),u=J(e),c=0,h=null;switch(s[0]>u[0]&&s[0]<u[2]&&s[1]>u[1]&&s[1]<u[3]&&(c=(h=Yr(t,wr(e))).properties.featureIndex),ot(e)){case"Polygon":r=a[0][c],n=a[0][0],null!==h&&h.geometry.coordinates[1]<s[1]&&(n=a[0][c]),o=Zi(a[0][0],a[0][a[0].length-1],s);var p=qi(a[0],s,o,i,r,n);r=p[0],n=p[1];break;case"MultiPolygon":for(var f=0,m=0,g=0,y=0;y<a[0].length;y++){f=y;for(var _=!1,v=0;v<a[0][y].length;v++){if(m=v,g===c){_=!0;break}g++}if(_)break}r=a[0][f][m],n=a[0][f][m],o=Zi(a[0][0][0],a[0][0][a[0][0].length-1],s),a.forEach(function(t){var e=qi(t[0],s,o,i,r,n);r=e[0],n=e[1]})}return d([l(r),l(n)])},e.polygonToLine=Ii,e.polygonToLineString=Ii,e.polygonize=function(t){var e=ps.fromGeoJson(t);e.deleteDangles(),e.deleteCutEdges();var r=[],n=[];return e.getEdgeRings().filter(function(t){return t.isValid()}).forEach(function(t){t.isHole()?r.push(t):n.push(t)}),r.forEach(function(t){hs.findEdgeRingContaining(t,n)&&n.push(t)}),d(n.map(function(t){return t.toPolygon()}))},e.polygons=h,e.projection=Ha,e.propEach=R,e.propReduce=O,e.propertiesContainsFilter=cl,e.radians2degrees=S,e.radiansToDegrees=S,e.radiansToDistance=x,e.radiansToLength=x,e.random=il,e.randomLineString=el,e.randomPoint=Qa,e.randomPolygon=tl,e.randomPosition=Ka,e.rewind=function(t,e){if(!A(e=e||{}))throw new Error("options is invalid");var r=e.reverse||!1,n=e.mutate||!1;if(!t)throw new Error("<geojson> is required");if("boolean"!=typeof r)throw new Error("<reverse> must be a boolean");if("boolean"!=typeof n)throw new Error("<mutate> must be a boolean");!1===n&&(t=Ie(t));var i=[];switch(t.type){case"GeometryCollection":return j(t,function(t){Wi(t,r)}),t;case"FeatureCollection":return N(t,function(t){N(Wi(t,r),function(t){i.push(t)})}),d(i)}return Wi(t,r)},e.rhumbBearing=Ui,e.rhumbDestination=Gi,e.rhumbDistance=Rn,e.round=v,e.sample=function(t,e){if(!t)throw new Error("featurecollection is required");if(null==e)throw new Error("num is required");if("number"!=typeof e)throw new Error("num must be a number");return d(function(t,e){for(var r,n,i=t.slice(0),o=t.length,s=o-e;o-- >s;)r=i[n=Math.floor((o+1)*Math.random())],i[n]=i[o],i[o]=r;return i.slice(s)}(t.features,e))},e.sector=function(t,e,r,n,i){if(!A(i=i||{}))throw new Error("options is invalid");var o=i.properties;if(!t)throw new Error("center is required");if(null==r)throw new Error("bearing1 is required");if(null==n)throw new Error("bearing2 is required");if(!e)throw new Error("radius is required");if("object"!=typeof i)throw new Error("options must be an object");if(ji(r)===ji(n))return _r(t,e,i);var s=Q(t),a=Ei(t,e,r,n,i),l=[[s]];return z(a,function(t){l[0].push(t)}),l[0].push(s),c(l,o)},e.segmentEach=q,e.segmentReduce=$,e.shortestPath=function(t,e,r){if(!A(r=r||{}))throw new Error("options is invalid");var n=r.resolution,i=r.minDistance,o=r.obstacles||d([]);if(!t)throw new Error("start is required");if(!e)throw new Error("end is required");if(n&&!M(n)||n<=0)throw new Error("options.resolution must be a number, greater than 0");if(i)throw new Error("options.minDistance is not yet implemented");var a=K(t),u=K(e);switch(t=l(a),e=l(u),ot(o)){case"FeatureCollection":if(0===o.features.length)return p([a,u]);break;case"Polygon":o=d([s(it(o))]);break;default:throw new Error("invalid obstacles")}var c=o;c.features.push(t),c.features.push(e);var h=J(es(dr(J(c)),1.15));n||(n=xe([h[0],h[1]],[h[2],h[1]],r)/100),c.features.pop(),c.features.pop();for(var f=h[0],m=h[1],g=h[2],y=h[3],_=n/xe([f,m],[g,m],r)*(g-f),v=n/xe([f,m],[f,y],r)*(y-m),x=g-f,b=y-m,w=Math.floor(x/_),E=Math.floor(b/v),S=(x-w*_)/2,I=[],T=[],C=[],P=[],k=1/0,L=1/0,z=y-(b-E*v)/2,D=0;z>=m;){for(var R=[],O=[],N=f+S,F=0;N<=g;){var B=l([N,z]),j=Hs(B,o);R.push(j?0:1),O.push(N+"|"+z);var U=xe(B,t);!j&&U<k&&(k=U,C={x:F,y:D});var V=xe(B,e);!j&&V<L&&(L=V,P={x:F,y:D}),N+=_,F++}T.push(R),I.push(O),z-=v,D++}var G=new Xs(T,{diagonal:!0}),q=G.grid[C.y][C.x],$=G.grid[P.y][P.x],Z=Zs.search(G,q,$),X=[a];return Z.forEach(function(t){var e=I[t.x][t.y].split("|");X.push([+e[0],+e[1]])}),X.push(u),er(p(X))},e.simplify=function(t,e){if(!A(e=e||{}))throw new Error("options is invalid");var r=void 0!==e.tolerance?e.tolerance:1,n=e.highQuality||!1,i=e.mutate||!1;if(!t)throw new Error("geojson is required");if(r&&r<0)throw new Error("invalid tolerance");return!0!==i&&(t=Ie(t)),j(t,function(t){!function(t,e,r){var n=t.type;if("Point"===n||"MultiPoint"===n)return t;er(t,!0);var i=t.coordinates;switch(n){case"LineString":t.coordinates=ur(i,e,r);break;case"MultiLineString":t.coordinates=i.map(function(t){return ur(t,e,r)});break;case"Polygon":t.coordinates=cr(i,e,r);break;case"MultiPolygon":t.coordinates=i.map(function(t){return cr(t,e,r)})}}(t,r,n)}),t},e.square=gr,e.squareGrid=fg,e.standardDeviationalEllipse=function(t,e){if(!A(e=e||{}))throw new Error("options is invalid");var r=e.steps||64,n=e.weight,i=e.properties||{};if(!M(r))throw new Error("steps must be a number");if(!A(i))throw new Error("properties must be a number");var o=B(t).length,s=Na(t,{weight:n}),a=0,l=0,u=0;N(t,function(t){var e=t.properties[n]||1,r=Ba(Q(t),Q(s));a+=Math.pow(r.x,2)*e,l+=Math.pow(r.y,2)*e,u+=r.x*r.y*e});var c=a-l,h=Math.sqrt(Math.pow(c,2)+4*Math.pow(u,2)),p=2*u,f=Math.atan((c+h)/p),m=180*f/Math.PI,g=0,y=0,_=0;N(t,function(t){var e=t.properties[n]||1,r=Ba(Q(t),Q(s));g+=Math.pow(r.x*Math.cos(f)-r.y*Math.sin(f),2)*e,y+=Math.pow(r.x*Math.sin(f)+r.y*Math.cos(f),2)*e,_+=e});var v=Math.sqrt(2*g/_),x=Math.sqrt(2*y/_),b=Ra(s,v,x,{units:"degrees",angle:m,steps:r,properties:i}),w=ve(t,d([b])),E={meanCenterCoordinates:Q(s),semiMajorAxis:v,semiMinorAxis:x,numberOfFeatures:o,angle:m,percentageWithinEllipse:100*B(w).length/o};return b.properties.standardDeviationalEllipse=E,b},e.tag=function(t,e,r,n){return t=Ie(t),e=Ie(e),N(t,function(t){t.properties||(t.properties={}),N(e,function(e){void 0===t.properties[n]&&ye(t,e)&&(t.properties[n]=e.properties[r])})}),t},e.tesselate=function(t){if(!t.geometry||"Polygon"!==t.geometry.type&&"MultiPolygon"!==t.geometry.type)throw new Error("input must be a Polygon or MultiPolygon");var e={type:"FeatureCollection",features:[]};return"Polygon"===t.geometry.type?e.features=Wr(t.geometry.coordinates):t.geometry.coordinates.forEach(function(t){e.features=e.features.concat(Wr(t))}),e},e.tin=be,e.toMercator=$a,e.toWgs84=Za,e.transformRotate=ts,e.transformScale=es,e.transformTranslate=function(t,e,r,n){if(!A(n=n||{}))throw new Error("options is invalid");var i=n.units,o=n.zTranslation,s=n.mutate;if(!t)throw new Error("geojson is required");if(null==e||isNaN(e))throw new Error("distance is required");if(o&&"number"!=typeof o&&isNaN(o))throw new Error("zTranslation is not a number");if(o=void 0!==o?o:0,0===e&&0===o)return t;if(null==r||isNaN(r))throw new Error("direction is required");return e<0&&(e=-e,r+=180),!1!==s&&void 0!==s||(t=Ie(t)),z(t,function(t){var n=Q(Gi(t,e,r,{units:i}));t[0]=n[0],t[1]=n[1],o&&3===t.length&&(t[2]+=o)}),t},e.triangleGrid=dg,e.truncate=ri,e.union=function(t,e,r){void 0===r&&(r={});var n=it(t),i=it(e),o=tu.union(n.coordinates,i.coordinates);return 0===o.length?null:1===o.length?c(o[0],r.properties):y(o,r.properties)},e.unitsFactors=i,e.unkinkPolygon=function(t){var e=[];return V(t,function(t){"Polygon"===t.geometry.type&&N(si(t),function(r){e.push(c(r.geometry.coordinates,t.properties))})}),d(e)},e.validateBBox=P,e.validateId=k,e.voronoi=function(t,e){if(!A(e=e||{}))throw new Error("options is invalid");var r=e.bbox||[-180,-85,180,85];if(!t)throw new Error("points is required");if(!Array.isArray(r))throw new Error("bbox is invalid");return nt(t,"Point","points"),d(function(){var t=Ks,e=Qs,r=null;function n(n){return new za(n.map(function(r,i){var o=[Math.round(t(r,i,n)/Pa)*Pa,Math.round(e(r,i,n)/Pa)*Pa];return o.index=i,o.data=r,o}),r)}return n.polygons=function(t){return n(t).polygons()},n.links=function(t){return n(t).links()},n.triangles=function(t){return n(t).triangles()},n.x=function(e){return arguments.length?(t="function"==typeof e?e:Js(+e),n):t},n.y=function(t){return arguments.length?(e="function"==typeof t?t:Js(+t),n):e},n.extent=function(t){return arguments.length?(r=null==t?null:[[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]],n):r&&[[r[0][0],r[0][1]],[r[1][0],r[1][1]]]},n.size=function(t){return arguments.length?(r=null==t?null:[[0,0],[+t[0],+t[1]]],n):r&&[r[1][0]-r[0][0],r[1][1]-r[0][1]]},n}().x(function(t){return t.geometry.coordinates[0]}).y(function(t){return t.geometry.coordinates[1]}).extent([[r[0],r[1]],[r[2],r[3]]]).polygons(t.features).map(Da))},e.within=ve,Object.defineProperty(e,"__esModule",{value:!0})})}).call(this,r("4362"))},"7bb2":function(t,e,r){"use strict";function n(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var i={paints:"fill-antialias,fill-opacity,fill-color,fill-outline-color,fill-translate,fill-translate-anchor,fill-pattern,fill-extrusion-opacity,fill-extrusion-color,fill-extrusion-translate,fill-extrusion-translate-anchor,fill-extrusion-pattern,fill-extrusion-height,fill-extrusion-base,fill-extrusion-vertical-gradient,line-opacity,line-color,line-translate,line-translate-anchor,line-width,line-gap-width,line-offset,line-blur,line-dasharray,line-pattern,line-gradient,circle-radius,circle-color,circle-blur,circle-opacity,circle-translate,circle-translate-anchor,circle-pitch-scale,circle-pitch-alignment,circle-stroke-width,circle-stroke-color,circle-stroke-opacity,heatmap-radius,heatmap-weight,heatmap-intensity,heatmap-color,heatmap-opacity,icon-opacity,icon-color,icon-halo-color,icon-halo-width,icon-halo-blur,icon-translate,icon-translate-anchor,text-opacity,text-color,text-halo-color,text-halo-width,text-halo-blur,text-translate,text-translate-anchor,raster-opacity,raster-hue-rotate,raster-brightness-min,raster-brightness-max,raster-saturation,raster-contrast,raster-resampling,raster-fade-duration,hillshade-illumination-direction,hillshade-illumination-anchor,hillshade-exaggeration,hillshade-shadow-color,hillshade-highlight-color,hillshade-accent-color,background-color,background-pattern,background-opacity,sky-type,sky-atmosphere-sun,sky-atmosphere-sun-intensity,sky-gradient-center,sky-gradient-radius,sky-gradient,sky-atmosphere-halo-color,sky-atmosphere-color,sky-opacity".split(","),layouts:"visibility,fill-sort-key,circle-sort-key,line-cap,line-join,line-miter-limit,line-round-limit,line-sort-key,symbol-placement,symbol-spacing,symbol-avoid-edges,symbol-sort-key,symbol-z-order,icon-allow-overlap,icon-ignore-placement,icon-optional,icon-rotation-alignment,icon-size,icon-text-fit,icon-text-fit-padding,icon-image,icon-rotate,icon-padding,icon-keep-upright,icon-offset,icon-anchor,icon-pitch-alignment,text-pitch-alignment,text-rotation-alignment,text-field,text-font,text-size,text-max-width,text-line-height,text-letter-spacing,text-justify,text-radial-offset,text-variable-anchor,text-anchor,text-max-angle,text-writing-mode,text-rotate,text-padding,text-keep-upright,text-transform,text-offset,text-allow-overlap,text-ignore-placement,text-optional".split(",")};const o=t=>t.replace(/[A-Z]/g,t=>`-${t.toLowerCase()}`),s=t=>t.replace(/(^|-)([a-z])/g,(t,e,r)=>`${r.toUpperCase()}`);function a(t){return i.paints.indexOf(t)>=0}function l(t){return i.layouts.indexOf(t)>=0}function u(t){return i.paints.indexOf(t)>=0?"paint":i.layouts.indexOf(t)>=0?"layout":"other"}function c(t){return String(t).match(/\.(geo)?json/)||"Feature"===t.type||"FeatureCollection"===t.type?{type:"geojson",data:t}:String(t).match(/^mapbox:\/\//)?{type:"vector",url:t}:t}const h=(t,e)=>{return Array.isArray(t)?t:t instanceof RegExp?e.getStyle().layers.map(t=>t.id).filter(e=>e.match(t)):t instanceof Function?e.getStyle().layers.filter(e=>t(e)).map(t=>t.id):[t]},p=t=>{return function(e,...r){const n=h(e,this.map);return n.forEach(e=>t.call(this,e,...r))}},f=t=>{return function(e,...r){const n=h(e,this.map),i=n.map(e=>t.call(this,e,...r));return()=>i.forEach(t=>t())}},d=["line","fill","circle","symbol","video","raster","fill-extrusion","heatmap","hillshade"];class m{constructor(){n(this,"_loaded",!1),n(this,"_mapgl",null),n(this,"map",null),n(this,"hoverFeatureState",f(function(t,e,r,n,i){if(Array.isArray(e)){let r=e.map(([e,r])=>this.hoverFeatureState(t,e,r));return()=>r.forEach(t=>t())}if(void 0===e){const n=this.getLayerStyle(t);e=n.source,r=n["source-layer"]}let o;const s=t=>{o&&this.map.setFeatureState({source:e,sourceLayer:r,id:o},{hover:t})},a=t=>{const e=t.features[0];e&&e.id===o||(s(!1),e&&(o&&i&&i({...t,oldFeatureId:o}),o=e.id,s(!0),n&&n(t)))},l=t=>{s(!1),t&&t.oldFeatureId&&(t.oldFeatureId=o),o=void 0,i&&i(t)};return this.map.on("mousemove",t,a),this.map.on("mouseleave",t,l),()=>{this.map.off("mousemove",t,a),this.map.off("mouseleave",t,l),l()}})),n(this,"clickLayer",f(function(t,e){const r=r=>{r.features=this.map.queryRenderedFeatures(r.point,{layers:[t]}),e(r)};return this.map.on("click",t,r),()=>this.map.off("click",t,r)})),n(this,"hoverLayer",f(function(t,e){const r=r=>{r.features=this.map.queryRenderedFeatures(r.point,{layers:[t]}),e(r)};return this.map.on("click",t,r),()=>this.map.off("click",t,r)})),n(this,"removeLayer",p(function(t){const e=t=>{t.error.message.match(/does not exist/)||console.error(t.error)};this.map.once("error",e),this.map.removeLayer(t),this.map.off("error",e)})),n(this,"setProperty",p(function(t,e,r){if("object"===typeof e)Object.keys(e).forEach(r=>this.setProperty(t,r,e[r]));else{const n=o(e);a(n)?this.map.setPaintProperty(t,n,r):l(n)&&this.map.setLayoutProperty(t,n,r)}})),n(this,"setLayerStyle",p(function(t,e){const r=(e={},r={})=>Object.keys(e).forEach(e=>{e in r||this.setProperty(t,e,void 0)});"object"!==typeof t||Array.isArray(t)||!t.id||e||(e=t,t=e.id);const n=this.getLayerStyle(t),i=this.properties(e);r(n.paint,i.paint),r(n.layout,i.layout),this.setProperty(t,{...i.paint,...i.layout})})),n(this,"show",p(function(t){this.setVisibility(t,"visible")})),n(this,"hide",p(function(t){this.setVisibility(t,"none")})),n(this,"toggle",p(function(t,e){this.setVisibility(t,e?"visible":"none")})),n(this,"showSource",p(function(t){this.setVisibility(this.layersBySource(t),"visible")})),n(this,"hideSource",p(function(t){this.setVisibility(this.layersBySource(t),"none")})),n(this,"toggleSource",p(function(t,e){this.setVisibility(this.layersBySource(t),e?"visible":"none")})),n(this,"setFilter",p(function(t,e){this.map.setFilter(t,e)})),n(this,"removeSource",p(function(t){const e=this.layersBySource(t);this.removeLayer(e),this.map.getSource(t)&&this.map.removeSource(t)})),n(this,"setLayerSource",p(function(t,e,r){const n=this.map.getStyle().layers,i=n.findIndex(e=>e.id===t),o=n[i],s=n[i+1]&&n[i+1].id;o.source=e,r?o["source-layer"]=r:void 0!==r&&delete o["source-layer"],this.map.removeLayer(t),this._mapAddLayerBefore(o,s)}))}static init(t,e){return t.U=new m,t.U._mapgl=e,t.U.map=t,t.U}static async newMap(t,e={},r={}){function n(t,e=[]){t.layers=[...t.layers,...e.map(t=>this.layerStyle(t))]}function i(t,e={}){t.sources={...t.sources,...e}}function o(t,e=(t=>t)){t=e(t)}function s(t,e={}){Object.keys(e).forEach(r=>{const n=e[r].layers;delete e[r].layers,t.sources[r]=e[r],t.layers=[...t.layers,...n.map(t=>this.layerStyle({source:r,...t}))]})}if(e.style||(e.style={version:8,layers:[],sources:{}}),r.addLayers||r.addSources||r.transformStyle||r.mixStyles){let t,a=e.style;if("string"===typeof a){const e=a.replace(/^mapbox:\/\/styles\//,"https://api.mapbox.com/styles/v1/"),r=await fetch(e);t=await r.json()}else t=a;const l=new m;n.call(l,t,r.addLayers),i(t,r.addSources),o(t,r.transformStyle),s.call(l,t,r.mixStyles),e.style=t}const a=new t.Map(e);return m.init(a,t),a}hoverPointer(t){const e=h(t,this.map),r=t=>this.map.getCanvas().style.cursor="pointer",n=t=>{0===this.map.queryRenderedFeatures(t.point,{layers:e}).length&&(this.map.getCanvas().style.cursor=i)},i=this.map.getCanvas().style.cursor;for(const o of e)this.map.on("mouseleave",o,n),this.map.on("mouseenter",o,r);return()=>{for(const t of e)this.map.off("mouseenter",t,r),this.map.off("mouseleave",t,n);this.map.getCanvas().style.cursor=i}}hoverPopup(t,e,r={}){if(!this._mapgl)throw"Mapbox GL JS or MapLibre GL JS object required when initialising";const n=new this._mapgl.Popup({closeButton:!1,...r});return f(function(t,e){const r=t=>{t.features[0]&&(n.setLngLat(t.lngLat),n.setHTML(e(t.features[0],n)),n.addTo(this.map))},i=t=>{n.remove()};return this.map.on("mouseenter",t,r),this.map.on("mouseout",t,i),()=>{this.map.off("mouseenter",t,r),this.map.off("mouseout",t,i),i()}}).call(this,t,e)}clickPopup(t,e,r={}){if(!this._mapgl)throw"Mapbox GL JS or Maplibre GL JS object required when initialising";const n=new this._mapgl.Popup({...r});return f(function(t,e){const r=t=>{t.features[0]&&(n.setLngLat(t.features[0].geometry.coordinates.slice()),n.setHTML(e(t.features[0],n)),n.addTo(this.map))};return this.map.on("click",t,r),()=>this.map.off("click",t,r)}).call(this,t,e)}clickOneLayer(t,e,r){const n=h(t,this.map),i=t=>{let i=!1;for(const r of n){const n=this.map.queryRenderedFeatures(t.point,{layers:[r]});if(n[0])try{e({event:t,layer:r,feature:n[0],features:n})}finally{i=!0;break}}!i&&r&&r(t)};return this.map.on("click",i),()=>this.map.off("click",i)}_mapAddLayerBefore(t,e){e?this.map.addLayer(t,e):this.map.addLayer(t)}addLayer(t,e,r,n,i){return this._mapAddLayerBefore(this.layerStyle(t,e,r,n),i),this._makeSource(e)}add(t,e,r,n,i){if(this._mapAddLayerBefore({...this.properties(n),id:t,type:r,source:c(e)},i),"string"===typeof e)return this._makeSource(e)}setLayer(t,e,r,n,i){const o=this.layerStyle(t,e,r,n),s=this.map.getStyle(),a=s.layers.findIndex(t=>t.id===o.id),l=s.layers.findIndex(t=>t.id===i);return a>=0?s.layers.splice(a,1,o):l>=0?s.layers.splice(l,0,o):s.layers.push(o),this.map.setStyle(s),this._makeSource(e)}addLineLayer(t,e,r){}addFillLayer(t,e,r){}addCircleLayer(t,e,r){}addSymbolLayer(t,e,r){}addVideoLayer(t,e,r){}addRasterLayer(t,e,r){}addFillExtrusionLayer(t,e,r){}addHeatmapLayer(t,e,r){}addHillshadeLayer(t,e,r){}addGeoJSONSource(t,e={type:"FeatureCollection",features:[]},r){return this.addSource(t,{type:"geojson",data:e,...r})}addGeoJSON(t,e={type:"FeatureCollection",features:[]},r){return this.addGeoJSONSource(t,e,r)}addSource(t,e){const r=this.map.getStyle();return r.sources[t]=e,this.map.setStyle(r),this._makeSource(t)}layersBySource(t){return this.map.getStyle().layers.filter(e=>e.source===t).map(t=>t.id)}addVectorSource(t,e,r={}){return"string"===typeof e?e.match(/\{z\}/)?this.addSource(t,{...r,type:"vector",tiles:[e]}):this.addSource(t,{...r,type:"vector",url:e}):this.addSource(t,{...e,type:"vector"})}addVector(t,e,r={}){return this.addVectorSource(t,e,r)}addRasterSource(t,e){return this.addSource(t,{...e,type:"raster"})}addRasterDemSource(t,e){return this.addSource(t,{...e,type:"raster-dem"})}addRasterSource(t,e){return this.addSource(t,{...e,type:"raster"})}addImageSource(t,e){return this.addSource(t,{...e,type:"image"})}addVideoSource(t,e){return this.addSource(t,{...e,type:"video"})}properties(t){if(!t)return;const e={},r={paint:{},layout:{},other:{}};return Object.keys(t).forEach(e=>{const n=o(e);r[u(n)][n]=t[e]}),Object.keys(r.paint).length&&(e.paint=r.paint),Object.keys(r.layout).length&&(e.layout=r.layout),Object.assign(e,r.other),e}layerStyle(...t){const[e,r,n]=t,i=t.find(t=>"object"===typeof t&&!Array.isArray(t)),o="object"===typeof i&&this.properties(i)||{};return"string"===typeof e&&(o.id=e),"string"===typeof r&&(o.source=r),"string"===typeof n&&(o.type=n),o}getLayerStyle(t){return this.map.getStyle().layers.find(e=>e.id===t)}setData(t,e={type:"FeatureCollection",features:[]}){this.map.getSource(t).setData(e)}onLoad(t){if(!t)return new Promise(t=>this.onLoad(t));this.map.loaded()||this._loaded?t():this.map.once("load",()=>{this._loaded=!0,t()})}setRootProperty(t,e){const r=this.map.getStyle();r[o(t)]=e,this.map.setStyle(r)}setTransition(t){this.setRootProperty("transition",t)}loadImage(t,e,r){return"string"===typeof e?new Promise((n,i)=>{this.map.loadImage(e,(o,s)=>{o?(console.error(`Error loading image ${e}`,o),i(`Error loading image ${e}`)):(this.map.addImage(t,s,r),n(t))})}):this.map.addImage(t,e,r)}lockOrientation(){this.map.touchZoomRotate.disableRotation(),this.map.dragRotate.disable()}fontsInUse(){function t(r){Array.isArray(r)&&("literal"===r[0]?e.push(...r[1]):r.forEach(t))}let e=[];const r=this.map.getStyle().layers.map(t=>t.layout&&t.layout["text-font"]).filter(Boolean);for(const n of r)if(n.stops)try{e.push(...n.stops.flat().filter(Array.isArray).flat())}catch{console.log("Couldn't process font expression:",n)}else n.every(t=>"string"===typeof t)?e.push(...n):t(n);return[...new Set(e)]}_makeSource(t){const e=new m;return e.map=this.map,e._mapgl=this._mapgl,d.forEach(function(r){g(r,e,t)}),e}}const g=(t,e,r)=>{let n;n=r?function(e,n,i){return this.setLayer(e,r,t,n,i)}:function(e,r,n,i){return this.setLayer(e,r,t,n,i)};const i=s(t);e[`add${i}`]=n,e[`add${i}Layer`]=n};function y(t){const e=(e,r)=>{const n="set"+s(e);t[n]=p(function(t,n){return this.map[r](t,e,n)})},r=(e,r)=>{const n="get"+s(e);t[n]=p(function(t){return this.map[r](t,e)})};t.update=t.setData,i.paints.forEach(t=>e(t,"setPaintProperty")),i.layouts.forEach(t=>e(t,"setLayoutProperty")),i.paints.forEach(t=>r(t,"getPaintProperty")),i.layouts.forEach(t=>r(t,"getLayoutProperty")),d.forEach(e=>g(e,t))}const _=m.prototype;y(_),e["a"]=m},9152:function(t,e){e.read=function(t,e,r,n,i){var o,s,a=8*i-n-1,l=(1<<a)-1,u=l>>1,c=-7,h=r?i-1:0,p=r?-1:1,f=t[e+h];for(h+=p,o=f&(1<<-c)-1,f>>=-c,c+=a;c>0;o=256*o+t[e+h],h+=p,c-=8);for(s=o&(1<<-c)-1,o>>=-c,c+=n;c>0;s=256*s+t[e+h],h+=p,c-=8);if(0===o)o=1-u;else{if(o===l)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,n),o-=u}return(f?-1:1)*s*Math.pow(2,o-n)},e.write=function(t,e,r,n,i,o){var s,a,l,u=8*o-i-1,c=(1<<u)-1,h=c>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:o-1,d=n?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=c):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),e+=s+h>=1?p/l:p*Math.pow(2,1-h),e*l>=2&&(s++,l/=2),s+h>=c?(a=0,s=c):s+h>=1?(a=(e*l-1)*Math.pow(2,i),s+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,i),s=0));i>=8;t[r+f]=255&a,f+=d,a/=256,i-=8);for(s=s<<i|a,u+=i;u>0;t[r+f]=255&s,f+=d,s/=256,u-=8);t[r+f-d]|=128*m}},"948e":function(t,e,r){},a557:function(t,e,r){"use strict";r.d(e,"a",function(){return i});var n=r("2fcc");class i{constructor(t){this.parsedExpression=t}static parse(t,e){let r;if(e){if(r=n["expression"].createExpression(t,{type:e}),"success"===r.result)return new i(r.value)}else if(r=n["expression"].createExpression(t),"success"===r.result)return new i(r.value);throw r.value[0]}evaluate(t,e={zoom:14}){return this.parsedExpression.evaluate(e,t)}}},ac6d:function(t,e,r){},b639:function(t,e,r){"use strict";(function(t){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var n=r("1fb5"),i=r("9152"),o=r("e3db");function s(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"===typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(e){return!1}}function a(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function l(t,e){if(a()<e)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e),t.__proto__=u.prototype):(null===t&&(t=new u(e)),t.length=e),t}function u(t,e,r){if(!u.TYPED_ARRAY_SUPPORT&&!(this instanceof u))return new u(t,e,r);if("number"===typeof t){if("string"===typeof e)throw new Error("If encoding is specified then the first argument must be a string");return f(this,t)}return c(this,t,e,r)}function c(t,e,r,n){if("number"===typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!==typeof ArrayBuffer&&e instanceof ArrayBuffer?g(t,e,r,n):"string"===typeof e?d(t,e,r):y(t,e)}function h(t){if("number"!==typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function p(t,e,r,n){return h(e),e<=0?l(t,e):void 0!==r?"string"===typeof n?l(t,e).fill(r,n):l(t,e).fill(r):l(t,e)}function f(t,e){if(h(e),t=l(t,e<0?0:0|_(e)),!u.TYPED_ARRAY_SUPPORT)for(var r=0;r<e;++r)t[r]=0;return t}function d(t,e,r){if("string"===typeof r&&""!==r||(r="utf8"),!u.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|x(e,r);t=l(t,n);var i=t.write(e,r);return i!==n&&(t=t.slice(0,i)),t}function m(t,e){var r=e.length<0?0:0|_(e.length);t=l(t,r);for(var n=0;n<r;n+=1)t[n]=255&e[n];return t}function g(t,e,r,n){if(e.byteLength,r<0||e.byteLength<r)throw new RangeError("'offset' is out of bounds");if(e.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");return e=void 0===r&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,r):new Uint8Array(e,r,n),u.TYPED_ARRAY_SUPPORT?(t=e,t.__proto__=u.prototype):t=m(t,e),t}function y(t,e){if(u.isBuffer(e)){var r=0|_(e.length);return t=l(t,r),0===t.length?t:(e.copy(t,0,0,r),t)}if(e){if("undefined"!==typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!==typeof e.length||et(e.length)?l(t,0):m(t,e);if("Buffer"===e.type&&o(e.data))return m(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function _(t){if(t>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|t}function v(t){return+t!=t&&(t=0),u.alloc(+t)}function x(t,e){if(u.isBuffer(t))return t.length;if("undefined"!==typeof ArrayBuffer&&"function"===typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!==typeof t&&(t=""+t);var r=t.length;if(0===r)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return H(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return Q(t).length;default:if(n)return H(t).length;e=(""+e).toLowerCase(),n=!0}}function b(t,e,r){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if(r>>>=0,e>>>=0,r<=e)return"";t||(t="utf8");while(1)switch(t){case"hex":return N(this,e,r);case"utf8":case"utf-8":return L(this,e,r);case"ascii":return R(this,e,r);case"latin1":case"binary":return O(this,e,r);case"base64":return k(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return F(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function w(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function E(t,e,r,n,i){if(0===t.length)return-1;if("string"===typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(i)return-1;r=t.length-1}else if(r<0){if(!i)return-1;r=0}if("string"===typeof e&&(e=u.from(e,n)),u.isBuffer(e))return 0===e.length?-1:S(t,e,r,n,i);if("number"===typeof e)return e&=255,u.TYPED_ARRAY_SUPPORT&&"function"===typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):S(t,[e],r,n,i);throw new TypeError("val must be string, number or Buffer")}function S(t,e,r,n,i){var o,s=1,a=t.length,l=e.length;if(void 0!==n&&(n=String(n).toLowerCase(),"ucs2"===n||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;s=2,a/=2,l/=2,r/=2}function u(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(i){var c=-1;for(o=r;o<a;o++)if(u(t,o)===u(e,-1===c?0:o-c)){if(-1===c&&(c=o),o-c+1===l)return c*s}else-1!==c&&(o-=o-c),c=-1}else for(r+l>a&&(r=a-l),o=r;o>=0;o--){for(var h=!0,p=0;p<l;p++)if(u(t,o+p)!==u(e,p)){h=!1;break}if(h)return o}return-1}function I(t,e,r,n){r=Number(r)||0;var i=t.length-r;n?(n=Number(n),n>i&&(n=i)):n=i;var o=e.length;if(o%2!==0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var s=0;s<n;++s){var a=parseInt(e.substr(2*s,2),16);if(isNaN(a))return s;t[r+s]=a}return s}function T(t,e,r,n){return tt(H(e,t.length-r),t,r,n)}function C(t,e,r,n){return tt(J(e),t,r,n)}function M(t,e,r,n){return C(t,e,r,n)}function A(t,e,r,n){return tt(Q(e),t,r,n)}function P(t,e,r,n){return tt(K(e,t.length-r),t,r,n)}function k(t,e,r){return 0===e&&r===t.length?n.fromByteArray(t):n.fromByteArray(t.slice(e,r))}function L(t,e,r){r=Math.min(t.length,r);var n=[],i=e;while(i<r){var o,s,a,l,u=t[i],c=null,h=u>239?4:u>223?3:u>191?2:1;if(i+h<=r)switch(h){case 1:u<128&&(c=u);break;case 2:o=t[i+1],128===(192&o)&&(l=(31&u)<<6|63&o,l>127&&(c=l));break;case 3:o=t[i+1],s=t[i+2],128===(192&o)&&128===(192&s)&&(l=(15&u)<<12|(63&o)<<6|63&s,l>2047&&(l<55296||l>57343)&&(c=l));break;case 4:o=t[i+1],s=t[i+2],a=t[i+3],128===(192&o)&&128===(192&s)&&128===(192&a)&&(l=(15&u)<<18|(63&o)<<12|(63&s)<<6|63&a,l>65535&&l<1114112&&(c=l))}null===c?(c=65533,h=1):c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|1023&c),n.push(c),i+=h}return D(n)}e.Buffer=u,e.SlowBuffer=v,e.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:s(),e.kMaxLength=a(),u.poolSize=8192,u._augment=function(t){return t.__proto__=u.prototype,t},u.from=function(t,e,r){return c(null,t,e,r)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!==typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(t,e,r){return p(null,t,e,r)},u.allocUnsafe=function(t){return f(null,t)},u.allocUnsafeSlow=function(t){return f(null,t)},u.isBuffer=function(t){return!(null==t||!t._isBuffer)},u.compare=function(t,e){if(!u.isBuffer(t)||!u.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var r=t.length,n=e.length,i=0,o=Math.min(r,n);i<o;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0},u.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(t,e){if(!o(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return u.alloc(0);var r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;var n=u.allocUnsafe(e),i=0;for(r=0;r<t.length;++r){var s=t[r];if(!u.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(n,i),i+=s.length}return n},u.byteLength=x,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var t=this.length;if(t%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)w(this,e,e+1);return this},u.prototype.swap32=function(){var t=this.length;if(t%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)w(this,e,e+3),w(this,e+1,e+2);return this},u.prototype.swap64=function(){var t=this.length;if(t%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)w(this,e,e+7),w(this,e+1,e+6),w(this,e+2,e+5),w(this,e+3,e+4);return this},u.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?L(this,0,t):b.apply(this,arguments)},u.prototype.equals=function(t){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===u.compare(this,t)},u.prototype.inspect=function(){var t="",r=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(t+=" ... ")),"<Buffer "+t+">"},u.prototype.compare=function(t,e,r,n,i){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),e<0||r>t.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&e>=r)return 0;if(n>=i)return-1;if(e>=r)return 1;if(e>>>=0,r>>>=0,n>>>=0,i>>>=0,this===t)return 0;for(var o=i-n,s=r-e,a=Math.min(o,s),l=this.slice(n,i),c=t.slice(e,r),h=0;h<a;++h)if(l[h]!==c[h]){o=l[h],s=c[h];break}return o<s?-1:s<o?1:0},u.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},u.prototype.indexOf=function(t,e,r){return E(this,t,e,r,!0)},u.prototype.lastIndexOf=function(t,e,r){return E(this,t,e,r,!1)},u.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"===typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-e;if((void 0===r||r>i)&&(r=i),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return I(this,t,e,r);case"utf8":case"utf-8":return T(this,t,e,r);case"ascii":return C(this,t,e,r);case"latin1":case"binary":return M(this,t,e,r);case"base64":return A(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,t,e,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var z=4096;function D(t){var e=t.length;if(e<=z)return String.fromCharCode.apply(String,t);var r="",n=0;while(n<e)r+=String.fromCharCode.apply(String,t.slice(n,n+=z));return r}function R(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}function O(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}function N(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=e;o<r;++o)i+=Y(t[o]);return i}function F(t,e,r){for(var n=t.slice(e,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function B(t,e,r){if(t%1!==0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function j(t,e,r,n,i,o){if(!u.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<o)throw new RangeError('"value" argument is out of bounds');if(r+n>t.length)throw new RangeError("Index out of range")}function U(t,e,r,n){e<0&&(e=65535+e+1);for(var i=0,o=Math.min(t.length-r,2);i<o;++i)t[r+i]=(e&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function V(t,e,r,n){e<0&&(e=4294967295+e+1);for(var i=0,o=Math.min(t.length-r,4);i<o;++i)t[r+i]=e>>>8*(n?i:3-i)&255}function G(t,e,r,n,i,o){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function q(t,e,r,n,o){return o||G(t,e,r,4,3.4028234663852886e38,-3.4028234663852886e38),i.write(t,e,r,n,23,4),r+4}function $(t,e,r,n,o){return o||G(t,e,r,8,1.7976931348623157e308,-1.7976931348623157e308),i.write(t,e,r,n,52,8),r+8}u.prototype.slice=function(t,e){var r,n=this.length;if(t=~~t,e=void 0===e?n:~~e,t<0?(t+=n,t<0&&(t=0)):t>n&&(t=n),e<0?(e+=n,e<0&&(e=0)):e>n&&(e=n),e<t&&(e=t),u.TYPED_ARRAY_SUPPORT)r=this.subarray(t,e),r.__proto__=u.prototype;else{var i=e-t;r=new u(i,void 0);for(var o=0;o<i;++o)r[o]=this[o+t]}return r},u.prototype.readUIntLE=function(t,e,r){t|=0,e|=0,r||B(t,e,this.length);var n=this[t],i=1,o=0;while(++o<e&&(i*=256))n+=this[t+o]*i;return n},u.prototype.readUIntBE=function(t,e,r){t|=0,e|=0,r||B(t,e,this.length);var n=this[t+--e],i=1;while(e>0&&(i*=256))n+=this[t+--e]*i;return n},u.prototype.readUInt8=function(t,e){return e||B(t,1,this.length),this[t]},u.prototype.readUInt16LE=function(t,e){return e||B(t,2,this.length),this[t]|this[t+1]<<8},u.prototype.readUInt16BE=function(t,e){return e||B(t,2,this.length),this[t]<<8|this[t+1]},u.prototype.readUInt32LE=function(t,e){return e||B(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},u.prototype.readUInt32BE=function(t,e){return e||B(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},u.prototype.readIntLE=function(t,e,r){t|=0,e|=0,r||B(t,e,this.length);var n=this[t],i=1,o=0;while(++o<e&&(i*=256))n+=this[t+o]*i;return i*=128,n>=i&&(n-=Math.pow(2,8*e)),n},u.prototype.readIntBE=function(t,e,r){t|=0,e|=0,r||B(t,e,this.length);var n=e,i=1,o=this[t+--n];while(n>0&&(i*=256))o+=this[t+--n]*i;return i*=128,o>=i&&(o-=Math.pow(2,8*e)),o},u.prototype.readInt8=function(t,e){return e||B(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},u.prototype.readInt16LE=function(t,e){e||B(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt16BE=function(t,e){e||B(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt32LE=function(t,e){return e||B(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},u.prototype.readInt32BE=function(t,e){return e||B(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},u.prototype.readFloatLE=function(t,e){return e||B(t,4,this.length),i.read(this,t,!0,23,4)},u.prototype.readFloatBE=function(t,e){return e||B(t,4,this.length),i.read(this,t,!1,23,4)},u.prototype.readDoubleLE=function(t,e){return e||B(t,8,this.length),i.read(this,t,!0,52,8)},u.prototype.readDoubleBE=function(t,e){return e||B(t,8,this.length),i.read(this,t,!1,52,8)},u.prototype.writeUIntLE=function(t,e,r,n){if(t=+t,e|=0,r|=0,!n){var i=Math.pow(2,8*r)-1;j(this,t,e,r,i,0)}var o=1,s=0;this[e]=255&t;while(++s<r&&(o*=256))this[e+s]=t/o&255;return e+r},u.prototype.writeUIntBE=function(t,e,r,n){if(t=+t,e|=0,r|=0,!n){var i=Math.pow(2,8*r)-1;j(this,t,e,r,i,0)}var o=r-1,s=1;this[e+o]=255&t;while(--o>=0&&(s*=256))this[e+o]=t/s&255;return e+r},u.prototype.writeUInt8=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,1,255,0),u.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},u.prototype.writeUInt16LE=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):U(this,t,e,!0),e+2},u.prototype.writeUInt16BE=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):U(this,t,e,!1),e+2},u.prototype.writeUInt32LE=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):V(this,t,e,!0),e+4},u.prototype.writeUInt32BE=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):V(this,t,e,!1),e+4},u.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e|=0,!n){var i=Math.pow(2,8*r-1);j(this,t,e,r,i-1,-i)}var o=0,s=1,a=0;this[e]=255&t;while(++o<r&&(s*=256))t<0&&0===a&&0!==this[e+o-1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+r},u.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e|=0,!n){var i=Math.pow(2,8*r-1);j(this,t,e,r,i-1,-i)}var o=r-1,s=1,a=0;this[e+o]=255&t;while(--o>=0&&(s*=256))t<0&&0===a&&0!==this[e+o+1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+r},u.prototype.writeInt8=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,1,127,-128),u.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},u.prototype.writeInt16LE=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):U(this,t,e,!0),e+2},u.prototype.writeInt16BE=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):U(this,t,e,!1),e+2},u.prototype.writeInt32LE=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):V(this,t,e,!0),e+4},u.prototype.writeInt32BE=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):V(this,t,e,!1),e+4},u.prototype.writeFloatLE=function(t,e,r){return q(this,t,e,!0,r)},u.prototype.writeFloatBE=function(t,e,r){return q(this,t,e,!1,r)},u.prototype.writeDoubleLE=function(t,e,r){return $(this,t,e,!0,r)},u.prototype.writeDoubleBE=function(t,e,r){return $(this,t,e,!1,r)},u.prototype.copy=function(t,e,r,n){if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var i,o=n-r;if(this===t&&r<e&&e<n)for(i=o-1;i>=0;--i)t[i+e]=this[i+r];else if(o<1e3||!u.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)t[i+e]=this[i+r];else Uint8Array.prototype.set.call(t,this.subarray(r,r+o),e);return o},u.prototype.fill=function(t,e,r,n){if("string"===typeof t){if("string"===typeof e?(n=e,e=0,r=this.length):"string"===typeof r&&(n=r,r=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==n&&"string"!==typeof n)throw new TypeError("encoding must be a string");if("string"===typeof n&&!u.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"===typeof t&&(t&=255);if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;var o;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"===typeof t)for(o=e;o<r;++o)this[o]=t;else{var s=u.isBuffer(t)?t:H(new u(t,n).toString()),a=s.length;for(o=0;o<r-e;++o)this[o+e]=s[o%a]}return this};var Z=/[^+\/0-9A-Za-z-_]/g;function X(t){if(t=W(t).replace(Z,""),t.length<2)return"";while(t.length%4!==0)t+="=";return t}function W(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function Y(t){return t<16?"0"+t.toString(16):t.toString(16)}function H(t,e){var r;e=e||1/0;for(var n=t.length,i=null,o=[],s=0;s<n;++s){if(r=t.charCodeAt(s),r>55295&&r<57344){if(!i){if(r>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(e-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;o.push(r)}else if(r<2048){if((e-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function J(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}function K(t,e){for(var r,n,i,o=[],s=0;s<t.length;++s){if((e-=2)<0)break;r=t.charCodeAt(s),n=r>>8,i=r%256,o.push(i),o.push(n)}return o}function Q(t){return n.toByteArray(X(t))}function tt(t,e,r,n){for(var i=0;i<n;++i){if(i+r>=e.length||i>=t.length)break;e[i+r]=t[i]}return i}function et(t){return t!==t}}).call(this,r("c8ba"))},c8ba:function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(n){"object"===typeof window&&(r=window)}t.exports=r},df7c:function(t,e,r){(function(t){function r(t,e){for(var r=0,n=t.length-1;n>=0;n--){var i=t[n];"."===i?t.splice(n,1):".."===i?(t.splice(n,1),r++):r&&(t.splice(n,1),r--)}if(e)for(;r--;r)t.unshift("..");return t}var n=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,i=function(t){return n.exec(t).slice(1)};function o(t,e){if(t.filter)return t.filter(e);for(var r=[],n=0;n<t.length;n++)e(t[n],n,t)&&r.push(t[n]);return r}e.resolve=function(){for(var e="",n=!1,i=arguments.length-1;i>=-1&&!n;i--){var s=i>=0?arguments[i]:t.cwd();if("string"!==typeof s)throw new TypeError("Arguments to path.resolve must be strings");s&&(e=s+"/"+e,n="/"===s.charAt(0))}return e=r(o(e.split("/"),function(t){return!!t}),!n).join("/"),(n?"/":"")+e||"."},e.normalize=function(t){var n=e.isAbsolute(t),i="/"===s(t,-1);return t=r(o(t.split("/"),function(t){return!!t}),!n).join("/"),t||n||(t="."),t&&i&&(t+="/"),(n?"/":"")+t},e.isAbsolute=function(t){return"/"===t.charAt(0)},e.join=function(){var t=Array.prototype.slice.call(arguments,0);return e.normalize(o(t,function(t,e){if("string"!==typeof t)throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))},e.relative=function(t,r){function n(t){for(var e=0;e<t.length;e++)if(""!==t[e])break;for(var r=t.length-1;r>=0;r--)if(""!==t[r])break;return e>r?[]:t.slice(e,r-e+1)}t=e.resolve(t).substr(1),r=e.resolve(r).substr(1);for(var i=n(t.split("/")),o=n(r.split("/")),s=Math.min(i.length,o.length),a=s,l=0;l<s;l++)if(i[l]!==o[l]){a=l;break}var u=[];for(l=a;l<i.length;l++)u.push("..");return u=u.concat(o.slice(a)),u.join("/")},e.sep="/",e.delimiter=":",e.dirname=function(t){var e=i(t),r=e[0],n=e[1];return r||n?(n&&(n=n.substr(0,n.length-1)),r+n):"."},e.basename=function(t,e){var r=i(t)[2];return e&&r.substr(-1*e.length)===e&&(r=r.substr(0,r.length-e.length)),r},e.extname=function(t){return i(t)[3]};var s="b"==="ab".substr(-1)?function(t,e,r){return t.substr(e,r)}:function(t,e,r){return e<0&&(e=t.length+e),t.substr(e,r)}}).call(this,r("4362"))},e192:function(t,e,r){(function(e,r){t.exports=r()})(0,function(){"use strict";var t,e,r;function n(n,i){if(t)if(e){var o="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+t+")(sharedChunk); ("+e+")(sharedChunk); self.onerror = null;",s={};t(s),r=i(s),"undefined"!==typeof window&&window&&window.URL&&window.URL.createObjectURL&&(r.workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})))}else e=i;else t=i}n(["exports"],function(t){var e="2.8.0-alpha.1",r=n;function n(t,e,r,n){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=r,this.p2y=n}n.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},n.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},n.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},n.prototype.solveCurveX=function(t,e){var r,n,i,o,s;for(void 0===e&&(e=1e-6),i=t,s=0;s<8;s++){if(o=this.sampleCurveX(i)-t,Math.abs(o)<e)return i;var a=this.sampleCurveDerivativeX(i);if(Math.abs(a)<1e-6)break;i-=o/a}if((i=t)<(r=0))return r;if(i>(n=1))return n;for(;r<n;){if(o=this.sampleCurveX(i),Math.abs(o-t)<e)return i;t>o?r=i:n=i,i=.5*(n-r)+r}return i},n.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var i=o;function o(t,e){this.x=t,this.y=e}o.prototype={clone:function(){return new o(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),n=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=n,this},_rotateAround:function(t,e){var r=Math.cos(t),n=Math.sin(t),i=e.y+n*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-n*(this.y-e.y),this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},o.convert=function(t){return t instanceof o?t:Array.isArray(t)?new o(t[0],t[1]):t};var s="undefined"!=typeof self?self:{};const a=Math.PI/180,l=180/Math.PI;function u(t){return t*a}function c(t){return t*l}const h=[[0,0],[1,0],[1,1],[0,1]];function p(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,r=e*t;return 4*(t<.5?r:3*(t-e)+r-.75)}function f(t,e,n,i){const o=new r(t,e,n,i);return function(t){return o.solve(t)}}const d=f(.25,.1,.25,1);function m(t,e,r){return Math.min(r,Math.max(e,t))}function g(t,e,r){return(r=m((r-t)/(e-t),0,1))*r*(3-2*r)}function y(t,e,r){const n=r-e,i=((t-e)%n+n)%n+e;return i===e?r:i}function _(t,e,r){if(!t.length)return r(null,[]);let n=t.length;const i=new Array(t.length);let o=null;t.forEach((t,s)=>{e(t,(t,e)=>{t&&(o=t),i[s]=e,0==--n&&r(o,i)})})}function v(t){const e=[];for(const r in t)e.push(t[r]);return e}function x(t,...e){for(const r of e)for(const e in r)t[e]=r[e];return t}let b=1;function w(){return b++}function E(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function S(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function I(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function T(t,e){t.forEach(t=>{e[t]&&(e[t]=e[t].bind(e))})}function C(t,e){return-1!==t.indexOf(e,t.length-e.length)}function M(t,e,r){const n={};for(const i in t)n[i]=e.call(r||this,t[i],i,t);return n}function A(t,e,r){const n={};for(const i in t)e.call(r||this,t[i],i,t)&&(n[i]=t[i]);return n}function P(t){return Array.isArray(t)?t.map(P):"object"==typeof t&&t?M(t,P):t}const k={};function L(t){k[t]||("undefined"!=typeof console&&console.warn(t),k[t]=!0)}function z(t,e,r){return(r.y-t.y)*(e.x-t.x)>(e.y-t.y)*(r.x-t.x)}function D(t){let e=0;for(let r,n,i=0,o=t.length,s=o-1;i<o;s=i++)r=t[i],n=t[s],e+=(n.x-r.x)*(r.y+n.y);return e}function R(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function O(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(t,r,n,i)=>{const o=n||i;return e[r]=!o||o.toLowerCase(),""}),e["max-age"]){const t=parseInt(e["max-age"],10);isNaN(t)?delete e["max-age"]:e["max-age"]=t}return e}let N,F,B,j=null;function U(t){if(null==j){const e=t.navigator?t.navigator.userAgent:null;j=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return j}function V(t){try{const e=s[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(t){return!1}}function G(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}const q={now:()=>void 0!==B?B:s.performance.now(),setNow(t){B=t},restoreNow(){B=void 0},frame(t){const e=s.requestAnimationFrame(t);return{cancel:()=>s.cancelAnimationFrame(e)}},getImageData(t,e=0){const r=s.document.createElement("canvas"),n=r.getContext("2d");if(!n)throw new Error("failed to create canvas 2d context");return r.width=t.width,r.height=t.height,n.drawImage(t,0,0,t.width,t.height),n.getImageData(-e,-e,t.width+2*e,t.height+2*e)},resolveURL:t=>(N||(N=s.document.createElement("a")),N.href=t,N.href),get devicePixelRatio(){return s.devicePixelRatio},get prefersReducedMotion(){return!!s.matchMedia&&(null==F&&(F=s.matchMedia("(prefers-reduced-motion: reduce)")),F.matches)}};let $;const Z={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==$){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{$=null!=Object({NODE_ENV:"production",BASE_URL:""}).API_URL_REGEX?new RegExp(Object({NODE_ENV:"production",BASE_URL:""}).API_URL_REGEX):t}catch(e){$=t}}return $},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},X={supported:!1,testSupport:function(t){!H&&Y&&(J?K(t):W=t)}};let W,Y,H=!1,J=!1;function K(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Y),t.isContextLost())return;X.supported=!0}catch(t){}t.deleteTexture(e),H=!0}s.document&&(Y=s.document.createElement("img"),Y.onload=function(){W&&K(W),W=null,J=!0},Y.onerror=function(){H=!0,W=null},Y.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Q="01",tt="NO_ACCESS_TOKEN";function et(t){return 0===t.indexOf("mapbox:")}function rt(t){return Z.API_URL_REGEX.test(t)}const nt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function it(t){const e=t.match(nt);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function ot(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}function st(t){if(!t)return null;const e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(s.atob(e[1]).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(t){return null}}class at{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const e=st(Z.ACCESS_TOKEN);let r="";return r=e&&e.u?s.btoa(encodeURIComponent(e.u).replace(/%([0-9A-F]{2})/g,(t,e)=>String.fromCharCode(Number("0x"+e)))):Z.ACCESS_TOKEN||"",t?`mapbox.eventData.${t}:${r}`:`mapbox.eventData:${r}`}fetchEventData(){const t=V("localStorage"),e=this.getStorageKey(),r=this.getStorageKey("uuid");if(t)try{const n=s.localStorage.getItem(e);n&&(this.eventData=JSON.parse(n));const i=s.localStorage.getItem(r);i&&(this.anonId=i)}catch(t){L("Unable to read from LocalStorage")}}saveEventData(){const t=V("localStorage"),e=this.getStorageKey(),r=this.getStorageKey("uuid");if(t)try{s.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&s.localStorage.setItem(e,JSON.stringify(this.eventData))}catch(t){L("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,r,n,i){if(!Z.EVENTS_URL)return;const o=it(Z.EVENTS_URL);o.params.push(`access_token=${i||Z.ACCESS_TOKEN||""}`);const s={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:e,skuId:Q,userId:this.anonId},a=r?x(s,r):s,l={url:ot(o),headers:{"Content-Type":"text/plain"},body:JSON.stringify([a])};this.pendingRequest=Mt(l,t=>{this.pendingRequest=null,n(t),this.saveEventData(),this.processRequests(i)})}queueRequest(t,e){this.queue.push(t),this.processRequests(e)}}const lt=new class extends at{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){Z.EVENTS_URL&&Z.ACCESS_TOKEN&&Array.isArray(t)&&t.some(t=>et(t)||rt(t))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=st(Z.ACCESS_TOKEN),r=e?e.u:Z.ACCESS_TOKEN;let n=r!==this.eventData.tokenU;I(this.anonId)||(this.anonId=E(),n=!0);const i=this.queue.shift();if(this.eventData.lastSuccess){const t=new Date(this.eventData.lastSuccess),e=new Date(i),r=(i-this.eventData.lastSuccess)/864e5;n=n||r>=1||r<-1||t.getDate()!==e.getDate()}else n=!0;if(!n)return this.processRequests();this.postEvent(i,{"enabled.telemetry":!1},t=>{t||(this.eventData.lastSuccess=i,this.eventData.tokenU=r)},t)}},ut=lt.postTurnstileEvent.bind(lt),ct=new class extends at{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,r,n){this.skuToken=e,this.errorCb=n,Z.EVENTS_URL&&(r||Z.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},r):this.errorCb(new Error(tt)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),I(this.anonId)||(this.anonId=E()),this.postEvent(r,{skuToken:this.skuToken},t=>{t?this.errorCb(t):e&&(this.success[e]=!0)},t))}},ht=ct.postMapLoadEvent.bind(ct),pt=new class extends at{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,r,n){if(!Z.API_URL||!Z.SESSION_PATH)return;const i=it(Z.API_URL+Z.SESSION_PATH);i.params.push(`sku=${e||""}`),i.params.push(`access_token=${n||Z.ACCESS_TOKEN||""}`);const o={url:ot(i),headers:{"Content-Type":"text/plain"}};this.pendingRequest=At(o,t=>{this.pendingRequest=null,r(t),this.saveEventData(),this.processRequests(n)})}getSessionAPI(t,e,r,n){this.skuToken=e,this.errorCb=n,Z.SESSION_PATH&&Z.API_URL&&(r||Z.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},r):this.errorCb(new Error(tt)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||this.getSession(r,this.skuToken,t=>{t?this.errorCb(t):e&&(this.success[e]=!0)},t)}},ft=pt.getSessionAPI.bind(pt),dt=new Set,mt="mapbox-tiles";let gt,yt,_t=500,vt=50;function xt(){s.caches&&!gt&&(gt=s.caches.open(mt))}function bt(t){const e=t.indexOf("?");return e<0?t:t.slice(0,e)}let wt=1/0;const Et={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Et);class St extends Error{constructor(t,e,r){401===e&&rt(r)&&(t+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(t),this.status=e,this.url=r}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const It=R()?()=>self.worker&&self.worker.referrer:()=>("blob:"===s.location.protocol?s.parent:s).location.href,Tt=function(t,e){if(!(/^file:/.test(r=t.url)||/^file:/.test(It())&&!/^\w+:/.test(r))){if(s.fetch&&s.Request&&s.AbortController&&s.Request.prototype.hasOwnProperty("signal"))return function(t,e){const r=new s.AbortController,n=new s.Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:It(),signal:r.signal});let i=!1,o=!1;const a=(l=n.url).indexOf("sku=")>0&&rt(l);var l;"json"===t.type&&n.headers.set("Accept","application/json");const u=(r,i,l)=>{if(o)return;if(r&&"SecurityError"!==r.message&&L(r),i&&l)return c(i);const u=Date.now();s.fetch(n).then(r=>{if(r.ok){const t=a?r.clone():null;return c(r,t,u)}return e(new St(r.statusText,r.status,t.url))}).catch(t=>{20!==t.code&&e(new Error(t.message))})},c=(r,a,l)=>{("arrayBuffer"===t.type?r.arrayBuffer():"json"===t.type?r.json():r.text()).then(t=>{o||(a&&l&&function(t,e,r){if(xt(),!gt)return;const n={status:e.status,statusText:e.statusText,headers:new s.Headers};e.headers.forEach((t,e)=>n.headers.set(e,t));const i=O(e.headers.get("Cache-Control")||"");if(i["no-store"])return;i["max-age"]&&n.headers.set("Expires",new Date(r+1e3*i["max-age"]).toUTCString());const o=n.headers.get("Expires");o&&(new Date(o).getTime()-r<42e4||function(t,e){if(void 0===yt)try{new Response(new ReadableStream),yt=!0}catch(t){yt=!1}yt?e(t.body):t.blob().then(e)}(e,e=>{const r=new s.Response(e,n);xt(),gt&&gt.then(e=>e.put(bt(t.url),r)).catch(t=>L(t.message))}))}(n,a,l),i=!0,e(null,t,r.headers.get("Cache-Control"),r.headers.get("Expires")))}).catch(t=>{o||e(new Error(t.message))})};return a?function(t,e){if(xt(),!gt)return e(null);const r=bt(t.url);gt.then(t=>{t.match(r).then(n=>{const i=function(t){if(!t)return!1;const e=new Date(t.headers.get("Expires")||0),r=O(t.headers.get("Cache-Control")||"");return e>Date.now()&&!r["no-cache"]}(n);t.delete(r),i&&t.put(r,n.clone()),e(null,n,i)}).catch(e)}).catch(e)}(n,u):u(null,null),{cancel:()=>{o=!0,i||r.abort()}}}(t,e);if(R()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var r;return function(t,e){const r=new s.XMLHttpRequest;r.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(r.responseType="arraybuffer");for(const n in t.headers)r.setRequestHeader(n,t.headers[n]);return"json"===t.type&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials="include"===t.credentials,r.onerror=(()=>{e(new Error(r.statusText))}),r.onload=(()=>{if((r.status>=200&&r.status<300||0===r.status)&&null!==r.response){let n=r.response;if("json"===t.type)try{n=JSON.parse(r.response)}catch(t){return e(t)}e(null,n,r.getResponseHeader("Cache-Control"),r.getResponseHeader("Expires"))}else e(new St(r.statusText,r.status,t.url))}),r.send(t.body),{cancel:()=>r.abort()}}(t,e)},Ct=function(t,e){return Tt(x(t,{type:"arrayBuffer"}),e)},Mt=function(t,e){return Tt(x(t,{method:"POST"}),e)},At=function(t,e){return Tt(x(t,{method:"GET"}),e)};function Pt(t){const e=s.document.createElement("a");return e.href=t,e.protocol===s.document.location.protocol&&e.host===s.document.location.host}const kt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Lt,zt;Lt=[],zt=0;const Dt=function(t,e){if(X.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),zt>=Z.MAX_PARALLEL_IMAGE_REQUESTS){const r={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Lt.push(r),r}zt++;let r=!1;const n=()=>{if(!r)for(r=!0,zt--;Lt.length&&zt<Z.MAX_PARALLEL_IMAGE_REQUESTS;){const t=Lt.shift(),{requestParameters:e,callback:r,cancelled:n}=t;n||(t.cancel=Dt(e,r).cancel)}},i=Ct(t,(t,r,i,o)=>{n(),t?e(t):r&&(s.createImageBitmap?function(t,e){const r=new s.Blob([new Uint8Array(t)],{type:"image/png"});s.createImageBitmap(r).then(t=>{e(null,t)}).catch(t=>{e(new Error(`Could not load image because of ${t.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(r,(t,r)=>e(t,r,i,o)):function(t,e){const r=new s.Image,n=s.URL;r.onload=(()=>{e(null,r),n.revokeObjectURL(r.src),r.onload=null,s.requestAnimationFrame(()=>{r.src=kt})}),r.onerror=(()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")));const i=new s.Blob([new Uint8Array(t)],{type:"image/png"});r.src=t.byteLength?n.createObjectURL(i):kt}(r,(t,r)=>e(t,r,i,o)))});return{cancel:()=>{i.cancel(),n()}}};function Rt(t,e,r){r[t]&&-1!==r[t].indexOf(e)||(r[t]=r[t]||[],r[t].push(e))}function Ot(t,e,r){if(r&&r[t]){const n=r[t].indexOf(e);-1!==n&&r[t].splice(n,1)}}class Nt{constructor(t,e={}){x(this,e),this.type=t}}class Ft extends Nt{constructor(t,e={}){super("error",x({error:t},e))}}class Bt{on(t,e){return this._listeners=this._listeners||{},Rt(t,e,this._listeners),this}off(t,e){return Ot(t,e,this._listeners),Ot(t,e,this._oneTimeListeners),this}once(t,e){return e?(this._oneTimeListeners=this._oneTimeListeners||{},Rt(t,e,this._oneTimeListeners),this):new Promise(e=>this.once(t,e))}fire(t,e){"string"==typeof t&&(t=new Nt(t,e||{}));const r=t.type;if(this.listens(r)){t.target=this;const e=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];for(const r of e)r.call(this,t);const n=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];for(const o of n)Ot(r,o,this._oneTimeListeners),o.call(this,t);const i=this._eventedParent;i&&(x(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),i.fire(t))}else t instanceof Ft&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,e){return this._eventedParent=t,this._eventedParentData=e,this}}var jt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class Ut{constructor(t,e,r,n){this.message=(t?`${t}: `:"")+r,n&&(this.identifier=n),null!=e&&e.__line__&&(this.line=e.__line__)}}function Vt(t){const e=t.value;return e?[new Ut(t.key,e,"constants have been deprecated as of v8")]:[]}function Gt(t,...e){for(const r of e)for(const e in r)t[e]=r[e];return t}function qt(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function $t(t){if(Array.isArray(t))return t.map($t);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const r in t)e[r]=$t(t[r]);return e}return qt(t)}class Zt extends Error{constructor(t,e){super(e),this.message=e,this.key=t}}class Xt{constructor(t,e=[]){this.parent=t,this.bindings={};for(const[r,n]of e)this.bindings[r]=n}concat(t){return new Xt(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Wt={kind:"null"},Yt={kind:"number"},Ht={kind:"string"},Jt={kind:"boolean"},Kt={kind:"color"},Qt={kind:"object"},te={kind:"value"},ee={kind:"collator"},re={kind:"formatted"},ne={kind:"resolvedImage"};function ie(t,e){return{kind:"array",itemType:t,N:e}}function oe(t){if("array"===t.kind){const e=oe(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const se=[Wt,Yt,Ht,Jt,Kt,re,Qt,ie(te),ne];function ae(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!ae(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const t of se)if(!ae(t,e))return null}return`Expected ${oe(t)} but found ${oe(e)} instead.`}function le(t,e){return e.some(e=>e.kind===t.kind)}function ue(t,e){return e.some(e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t)}function ce(t){var e={exports:{}};return t(e,e.exports),e.exports}var he=ce(function(t,e){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(t){return(t=Math.round(t))<0?0:t>255?255:t}function i(t){return n("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function o(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function s(t,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?t+(e-t)*r*6:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}try{e.parseCSSColor=function(t){var e,a=t.replace(/ /g,"").toLowerCase();if(a in r)return r[a].slice();if("#"===a[0])return 4===a.length?(e=parseInt(a.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===a.length&&(e=parseInt(a.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var l=a.indexOf("("),u=a.indexOf(")");if(-1!==l&&u+1===a.length){var c=a.substr(0,l),h=a.substr(l+1,u-(l+1)).split(","),p=1;switch(c){case"rgba":if(4!==h.length)return null;p=o(h.pop());case"rgb":return 3!==h.length?null:[i(h[0]),i(h[1]),i(h[2]),p];case"hsla":if(4!==h.length)return null;p=o(h.pop());case"hsl":if(3!==h.length)return null;var f=(parseFloat(h[0])%360+360)%360/360,d=o(h[1]),m=o(h[2]),g=m<=.5?m*(d+1):m+d-m*d,y=2*m-g;return[n(255*s(y,g,f+1/3)),n(255*s(y,g,f)),n(255*s(y,g,f-1/3)),p];default:return null}}return null}}catch(t){}});class pe{constructor(t,e,r,n=1){this.r=t,this.g=e,this.b=r,this.a=n}static parse(t){if(!t)return;if(t instanceof pe)return t;if("string"!=typeof t)return;const e=he.parseCSSColor(t);return e?new pe(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3]):void 0}toString(){const[t,e,r,n]=this.toArray();return`rgba(${Math.round(t)},${Math.round(e)},${Math.round(r)},${n})`}toArray(){const{r:t,g:e,b:r,a:n}=this;return 0===n?[0,0,0,0]:[255*t/n,255*e/n,255*r/n,n]}}pe.black=new pe(0,0,0,1),pe.white=new pe(1,1,1,1),pe.transparent=new pe(0,0,0,0),pe.red=new pe(1,0,0,1),pe.blue=new pe(0,0,1,1);class fe{constructor(t,e,r){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,e){return this.collator.compare(t,e)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class de{constructor(t,e,r,n,i){this.text=t.normalize?t.normalize():t,this.image=e,this.scale=r,this.fontStack=n,this.textColor=i}}class me{constructor(t){this.sections=t}static fromString(t){return new me([new de(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(t=>0!==t.text.length||t.image&&0!==t.image.name.length)}static factory(t){return t instanceof me?t:me.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const e of this.sections){if(e.image){t.push(["image",e.image.name]);continue}t.push(e.text);const r={};e.fontStack&&(r["text-font"]=["literal",e.fontStack.split(",")]),e.scale&&(r["font-scale"]=e.scale),e.textColor&&(r["text-color"]=["rgba"].concat(e.textColor.toArray())),t.push(r)}return t}}class ge{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new ge({name:t,available:!1}):null}serialize(){return["image",this.name]}}function ye(t,e,r,n){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof r&&r>=0&&r<=255?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:`Invalid rgba value [${[t,e,r,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof n?[t,e,r,n]:[t,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function _e(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof pe)return!0;if(t instanceof fe)return!0;if(t instanceof me)return!0;if(t instanceof ge)return!0;if(Array.isArray(t)){for(const e of t)if(!_e(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!_e(t[e]))return!1;return!0}return!1}function ve(t){if(null===t)return Wt;if("string"==typeof t)return Ht;if("boolean"==typeof t)return Jt;if("number"==typeof t)return Yt;if(t instanceof pe)return Kt;if(t instanceof fe)return ee;if(t instanceof me)return re;if(t instanceof ge)return ne;if(Array.isArray(t)){const e=t.length;let r;for(const n of t){const t=ve(n);if(r){if(r===t)continue;r=te;break}r=t}return ie(r||te,e)}return Qt}function xe(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof pe||t instanceof me||t instanceof ge?t.toString():JSON.stringify(t)}class be{constructor(t,e){this.type=t,this.value=e}static parse(t,e){if(2!==t.length)return e.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!_e(t[1]))return e.error("invalid value");const r=t[1];let n=ve(r);const i=e.expectedType;return"array"!==n.kind||0!==n.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(n=i),new be(n,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof pe?["rgba"].concat(this.value.toArray()):this.value instanceof me?this.value.serialize():this.value}}class we{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Ee={string:Ht,number:Yt,boolean:Jt,object:Qt};class Se{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let r,n=1;const i=t[0];if("array"===i){let i,o;if(t.length>2){const r=t[1];if("string"!=typeof r||!(r in Ee)||"object"===r)return e.error('The item type argument of "array" must be one of string, number, boolean',1);i=Ee[r],n++}else i=te;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);o=t[2],n++}r=ie(i,o)}else r=Ee[i];const o=[];for(;n<t.length;n++){const r=e.parse(t[n],n,te);if(!r)return null;o.push(r)}return new Se(r,o)}evaluate(t){for(let e=0;e<this.args.length;e++){const r=this.args[e].evaluate(t);if(!ae(this.type,ve(r)))return r;if(e===this.args.length-1)throw new we(`Expected value to be of type ${oe(this.type)}, but found ${oe(ve(r))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,e=[t.kind];if("array"===t.kind){const r=t.itemType;if("string"===r.kind||"number"===r.kind||"boolean"===r.kind){e.push(r.kind);const n=t.N;("number"==typeof n||this.args.length>1)&&e.push(n)}}return e.concat(this.args.map(t=>t.serialize()))}}class Ie{constructor(t){this.type=re,this.sections=t}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const r=t[1];if(!Array.isArray(r)&&"object"==typeof r)return e.error("First argument must be an image or text section.");const n=[];let i=!1;for(let o=1;o<=t.length-1;++o){const r=t[o];if(i&&"object"==typeof r&&!Array.isArray(r)){i=!1;let t=null;if(r["font-scale"]&&(t=e.parse(r["font-scale"],1,Yt),!t))return null;let o=null;if(r["text-font"]&&(o=e.parse(r["text-font"],1,ie(Ht)),!o))return null;let s=null;if(r["text-color"]&&(s=e.parse(r["text-color"],1,Kt),!s))return null;const a=n[n.length-1];a.scale=t,a.font=o,a.textColor=s}else{const r=e.parse(t[o],1,te);if(!r)return null;const s=r.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");i=!0,n.push({content:r,scale:null,font:null,textColor:null})}}return new Ie(n)}evaluate(t){return new me(this.sections.map(e=>{const r=e.content.evaluate(t);return ve(r)===ne?new de("",r,null,null,null):new de(xe(r),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)}))}eachChild(t){for(const e of this.sections)t(e.content),e.scale&&t(e.scale),e.font&&t(e.font),e.textColor&&t(e.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const e of this.sections){t.push(e.content.serialize());const r={};e.scale&&(r["font-scale"]=e.scale.serialize()),e.font&&(r["text-font"]=e.font.serialize()),e.textColor&&(r["text-color"]=e.textColor.serialize()),t.push(r)}return t}}class Te{constructor(t){this.type=ne,this.input=t}static parse(t,e){if(2!==t.length)return e.error("Expected two arguments.");const r=e.parse(t[1],1,Ht);return r?new Te(r):e.error("No image name provided.")}evaluate(t){const e=this.input.evaluate(t),r=ge.fromString(e);return r&&t.availableImages&&(r.available=t.availableImages.indexOf(e)>-1),r}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Ce={"to-boolean":Jt,"to-color":Kt,"to-number":Yt,"to-string":Ht};class Me{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const r=t[0];if(("to-boolean"===r||"to-string"===r)&&2!==t.length)return e.error("Expected one argument.");const n=Ce[r],i=[];for(let o=1;o<t.length;o++){const r=e.parse(t[o],o,te);if(!r)return null;i.push(r)}return new Me(n,i)}evaluate(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){let e,r;for(const n of this.args){if(e=n.evaluate(t),r=null,e instanceof pe)return e;if("string"==typeof e){const r=t.parseColor(e);if(r)return r}else if(Array.isArray(e)&&(r=e.length<3||e.length>4?`Invalid rbga value ${JSON.stringify(e)}: expected an array containing either three or four numeric values.`:ye(e[0],e[1],e[2],e[3]),!r))return new pe(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new we(r||`Could not parse color from value '${"string"==typeof e?e:String(JSON.stringify(e))}'`)}if("number"===this.type.kind){let e=null;for(const r of this.args){if(e=r.evaluate(t),null===e)return 0;const n=Number(e);if(!isNaN(n))return n}throw new we(`Could not convert ${JSON.stringify(e)} to number.`)}return"formatted"===this.type.kind?me.fromString(xe(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?ge.fromString(xe(this.args[0].evaluate(t))):xe(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Ie([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Te(this.args[0]).serialize();const t=[`to-${this.type.kind}`];return this.eachChild(e=>{t.push(e.serialize())}),t}}const Ae=["Unknown","Point","LineString","Polygon"];class Pe{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Ae[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:r,y:n}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*e-t[0])+this.featureDistanceData.bearing[1]*(n*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=pe.parse(t)),e}}class ke{constructor(t,e,r,n){this.name=t,this.type=e,this._evaluate=r,this.args=n}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,e){const r=t[0],n=ke.definitions[r];if(!n)return e.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);const i=Array.isArray(n)?n[0]:n.type,o=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,s=o.filter(([e])=>!Array.isArray(e)||e.length===t.length-1);let a=null;for(const[l,u]of s){a=new tr(e.registry,e.path,null,e.scope);const n=[];let o=!1;for(let e=1;e<t.length;e++){const r=t[e],i=Array.isArray(l)?l[e-1]:l.type,s=a.parse(r,1+n.length,i);if(!s){o=!0;break}n.push(s)}if(!o)if(Array.isArray(l)&&l.length!==n.length)a.error(`Expected ${l.length} arguments, but found ${n.length} instead.`);else{for(let t=0;t<n.length;t++){const e=Array.isArray(l)?l[t]:l.type,r=n[t];a.concat(t+1).checkSubtype(e,r.type)}if(0===a.errors.length)return new ke(r,i,u,n)}}if(1===s.length)e.errors.push(...a.errors);else{const r=(s.length?s:o).map(([t])=>{return e=t,Array.isArray(e)?`(${e.map(oe).join(", ")})`:`(${oe(e.type)}...)`;var e}).join(" | "),n=[];for(let i=1;i<t.length;i++){const r=e.parse(t[i],1+n.length);if(!r)return null;n.push(oe(r.type))}e.error(`Expected arguments of type ${r}, but found (${n.join(", ")}) instead.`)}return null}static register(t,e){ke.definitions=e;for(const r in e)t[r]=ke}}class Le{constructor(t,e,r){this.type=ee,this.locale=r,this.caseSensitive=t,this.diacriticSensitive=e}static parse(t,e){if(2!==t.length)return e.error("Expected one argument.");const r=t[1];if("object"!=typeof r||Array.isArray(r))return e.error("Collator options argument must be an object.");const n=e.parse(void 0!==r["case-sensitive"]&&r["case-sensitive"],1,Jt);if(!n)return null;const i=e.parse(void 0!==r["diacritic-sensitive"]&&r["diacritic-sensitive"],1,Jt);if(!i)return null;let o=null;return r.locale&&(o=e.parse(r.locale,1,Ht),!o)?null:new Le(n,i,o)}evaluate(t){return new fe(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}const ze=8192;function De(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Re(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Oe(t,e){const r=(180+t[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,i=Math.pow(2,e.z);return[Math.round(r*i*ze),Math.round(n*i*ze)]}function Ne(t,e,r){const n=t[0]-e[0],i=t[1]-e[1],o=t[0]-r[0],s=t[1]-r[1];return n*s-o*i==0&&n*o<=0&&i*s<=0}function Fe(t,e){let r=!1;for(let s=0,a=e.length;s<a;s++){const a=e[s];for(let e=0,s=a.length;e<s-1;e++){if(Ne(t,a[e],a[e+1]))return!1;(i=a[e])[1]>(n=t)[1]!=(o=a[e+1])[1]>n[1]&&n[0]<(o[0]-i[0])*(n[1]-i[1])/(o[1]-i[1])+i[0]&&(r=!r)}}var n,i,o;return r}function Be(t,e){for(let r=0;r<e.length;r++)if(Fe(t,e[r]))return!0;return!1}function je(t,e,r,n){const i=n[0]-r[0],o=n[1]-r[1],s=(t[0]-r[0])*o-i*(t[1]-r[1]),a=(e[0]-r[0])*o-i*(e[1]-r[1]);return s>0&&a<0||s<0&&a>0}function Ue(t,e,r){for(const u of r)for(let r=0;r<u.length-1;++r)if(0!=(a=[(s=u[r+1])[0]-(o=u[r])[0],s[1]-o[1]])[0]*(l=[(i=e)[0]-(n=t)[0],i[1]-n[1]])[1]-a[1]*l[0]&&je(n,i,o,s)&&je(o,s,n,i))return!0;var n,i,o,s,a,l;return!1}function Ve(t,e){for(let r=0;r<t.length;++r)if(!Fe(t[r],e))return!1;for(let r=0;r<t.length-1;++r)if(Ue(t[r],t[r+1],e))return!1;return!0}function Ge(t,e){for(let r=0;r<e.length;r++)if(Ve(t,e[r]))return!0;return!1}function qe(t,e,r){const n=[];for(let i=0;i<t.length;i++){const o=[];for(let n=0;n<t[i].length;n++){const s=Oe(t[i][n],r);De(e,s),o.push(s)}n.push(o)}return n}function $e(t,e,r){const n=[];for(let i=0;i<t.length;i++){const o=qe(t[i],e,r);n.push(o)}return n}function Ze(t,e,r,n){if(t[0]<r[0]||t[0]>r[2]){const e=.5*n;let i=t[0]-r[0]>e?-n:r[0]-t[0]>e?n:0;0===i&&(i=t[0]-r[2]>e?-n:r[2]-t[0]>e?n:0),t[0]+=i}De(e,t)}function Xe(t,e,r,n){const i=Math.pow(2,n.z)*ze,o=[n.x*ze,n.y*ze],s=[];for(const a of t)for(const t of a){const n=[t.x+o[0],t.y+o[1]];Ze(n,e,r,i),s.push(n)}return s}function We(t,e,r,n){const i=Math.pow(2,n.z)*ze,o=[n.x*ze,n.y*ze],s=[];for(const l of t){const t=[];for(const r of l){const n=[r.x+o[0],r.y+o[1]];De(e,n),t.push(n)}s.push(t)}if(e[2]-e[0]<=i/2){(a=e)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const t of s)for(const n of t)Ze(n,e,r,i)}var a;return s}class Ye{constructor(t,e){this.type=Jt,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(_e(t[1])){const e=t[1];if("FeatureCollection"===e.type)for(let t=0;t<e.features.length;++t){const r=e.features[t].geometry.type;if("Polygon"===r||"MultiPolygon"===r)return new Ye(e,e.features[t].geometry)}else if("Feature"===e.type){const t=e.geometry.type;if("Polygon"===t||"MultiPolygon"===t)return new Ye(e,e.geometry)}else if("Polygon"===e.type||"MultiPolygon"===e.type)return new Ye(e,e)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if("Polygon"===e.type){const o=qe(e.coordinates,n,i),s=Xe(t.geometry(),r,n,i);if(!Re(r,n))return!1;for(const t of s)if(!Fe(t,o))return!1}if("MultiPolygon"===e.type){const o=$e(e.coordinates,n,i),s=Xe(t.geometry(),r,n,i);if(!Re(r,n))return!1;for(const t of s)if(!Be(t,o))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if("Polygon"===e.type){const o=qe(e.coordinates,n,i),s=We(t.geometry(),r,n,i);if(!Re(r,n))return!1;for(const t of s)if(!Ve(t,o))return!1}if("MultiPolygon"===e.type){const o=$e(e.coordinates,n,i),s=We(t.geometry(),r,n,i);if(!Re(r,n))return!1;for(const t of s)if(!Ge(t,o))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function He(t){if(t instanceof ke){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof Ye)return!1;let e=!0;return t.eachChild(t=>{e&&!He(t)&&(e=!1)}),e}function Je(t){if(t instanceof ke&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild(t=>{e&&!Je(t)&&(e=!1)}),e}function Ke(t,e){if(t instanceof ke&&e.indexOf(t.name)>=0)return!1;let r=!0;return t.eachChild(t=>{r&&!Ke(t,e)&&(r=!1)}),r}class Qe{constructor(t,e){this.type=e.type,this.name=t,this.boundExpression=e}static parse(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");const r=t[1];return e.scope.has(r)?new Qe(r,e.scope.get(r)):e.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class tr{constructor(t,e=[],r,n=new Xt,i=[]){this.registry=t,this.path=e,this.key=e.map(t=>`[${t}]`).join(""),this.scope=n,this.errors=i,this.expectedType=r}parse(t,e,r,n,i={}){return e?this.concat(e,r,n)._parse(t,i):this._parse(t,i)}_parse(t,e){function r(t,e,r){return"assert"===r?new Se(e,[t]):"coerce"===r?new Me(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const n=t[0];if("string"!=typeof n)return this.error(`Expression name must be a string, but found ${typeof n} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const i=this.registry[n];if(i){let n=i.parse(t,this);if(!n)return null;if(this.expectedType){const t=this.expectedType,i=n.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==i.kind)if("color"!==t.kind&&"formatted"!==t.kind&&"resolvedImage"!==t.kind||"value"!==i.kind&&"string"!==i.kind){if(this.checkSubtype(t,i))return null}else n=r(n,t,e.typeAnnotation||"coerce");else n=r(n,t,e.typeAnnotation||"assert")}if(!(n instanceof be)&&"resolvedImage"!==n.type.kind&&er(n)){const e=new Pe;try{n=new be(n.type,n.evaluate(e))}catch(t){return this.error(t.message),null}}return n}return this.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,e,r){const n="number"==typeof t?this.path.concat(t):this.path,i=r?this.scope.concat(r):this.scope;return new tr(this.registry,n,e||null,i,this.errors)}error(t,...e){const r=`${this.key}${e.map(t=>`[${t}]`).join("")}`;this.errors.push(new Zt(r,t))}checkSubtype(t,e){const r=ae(t,e);return r&&this.error(r),r}}function er(t){if(t instanceof Qe)return er(t.boundExpression);if(t instanceof ke&&"error"===t.name)return!1;if(t instanceof Le)return!1;if(t instanceof Ye)return!1;const e=t instanceof Me||t instanceof Se;let r=!0;return t.eachChild(t=>{r=e?r&&er(t):r&&t instanceof be}),!!r&&He(t)&&Ke(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function rr(t,e){const r=t.length-1;let n,i,o=0,s=r,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),n=t[a],i=t[a+1],n<=e){if(a===r||e<i)return a;o=a+1}else{if(!(n>e))throw new we("Input is not a number.");s=a-1}return 0}class nr{constructor(t,e,r){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(const[n,i]of r)this.labels.push(n),this.outputs.push(i)}static parse(t,e){if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");const r=e.parse(t[1],1,Yt);if(!r)return null;const n=[];let i=null;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);for(let o=1;o<t.length;o+=2){const r=1===o?-1/0:t[o],s=t[o+1],a=o,l=o+1;if("number"!=typeof r)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(n.length&&n[n.length-1][0]>=r)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const u=e.parse(s,l,i);if(!u)return null;i=i||u.type,n.push([r,u])}return new nr(i,r,n)}evaluate(t){const e=this.labels,r=this.outputs;if(1===e.length)return r[0].evaluate(t);const n=this.input.evaluate(t);if(n<=e[0])return r[0].evaluate(t);const i=e.length;return n>=e[i-1]?r[i-1].evaluate(t):r[rr(e,n)].evaluate(t)}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t}}function ir(t,e,r){return t*(1-r)+e*r}var or=Object.freeze({__proto__:null,number:ir,color:function(t,e,r){return new pe(ir(t.r,e.r,r),ir(t.g,e.g,r),ir(t.b,e.b,r),ir(t.a,e.a,r))},array:function(t,e,r){return t.map((t,n)=>ir(t,e[n],r))}});const sr=.95047,ar=1.08883,lr=4/29,ur=6/29,cr=3*ur*ur,hr=Math.PI/180,pr=180/Math.PI;function fr(t){return t>.008856451679035631?Math.pow(t,1/3):t/cr+lr}function dr(t){return t>ur?t*t*t:cr*(t-lr)}function mr(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function gr(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function yr(t){const e=gr(t.r),r=gr(t.g),n=gr(t.b),i=fr((.4124564*e+.3575761*r+.1804375*n)/sr),o=fr((.2126729*e+.7151522*r+.072175*n)/1);return{l:116*o-16,a:500*(i-o),b:200*(o-fr((.0193339*e+.119192*r+.9503041*n)/ar)),alpha:t.a}}function _r(t){let e=(t.l+16)/116,r=isNaN(t.a)?e:e+t.a/500,n=isNaN(t.b)?e:e-t.b/200;return e=1*dr(e),r=sr*dr(r),n=ar*dr(n),new pe(mr(3.2404542*r-1.5371385*e-.4985314*n),mr(-.969266*r+1.8760108*e+.041556*n),mr(.0556434*r-.2040259*e+1.0572252*n),t.alpha)}function vr(t,e,r){const n=e-t;return t+r*(n>180||n<-180?n-360*Math.round(n/360):n)}const xr={forward:yr,reverse:_r,interpolate:function(t,e,r){return{l:ir(t.l,e.l,r),a:ir(t.a,e.a,r),b:ir(t.b,e.b,r),alpha:ir(t.alpha,e.alpha,r)}}},br={forward:function(t){const{l:e,a:r,b:n}=yr(t),i=Math.atan2(n,r)*pr;return{h:i<0?i+360:i,c:Math.sqrt(r*r+n*n),l:e,alpha:t.a}},reverse:function(t){const e=t.h*hr,r=t.c;return _r({l:t.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:t.alpha})},interpolate:function(t,e,r){return{h:vr(t.h,e.h,r),c:ir(t.c,e.c,r),l:ir(t.l,e.l,r),alpha:ir(t.alpha,e.alpha,r)}}};var wr=Object.freeze({__proto__:null,lab:xr,hcl:br});class Er{constructor(t,e,r,n,i){this.type=t,this.operator=e,this.interpolation=r,this.input=n,this.labels=[],this.outputs=[];for(const[o,s]of i)this.labels.push(o),this.outputs.push(s)}static interpolationFactor(t,e,n,i){let o=0;if("exponential"===t.name)o=Sr(e,t.base,n,i);else if("linear"===t.name)o=Sr(e,1,n,i);else if("cubic-bezier"===t.name){const s=t.controlPoints;o=new r(s[0],s[1],s[2],s[3]).solve(Sr(e,1,n,i))}return o}static parse(t,e){let[r,n,i,...o]=t;if(!Array.isArray(n)||0===n.length)return e.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){const t=n[1];if("number"!=typeof t)return e.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:t}}else{if("cubic-bezier"!==n[0])return e.error(`Unknown interpolation type ${String(n[0])}`,1,0);{const t=n.slice(1);if(4!==t.length||t.some(t=>"number"!=typeof t||t<0||t>1))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:t}}}if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(i=e.parse(i,2,Yt),!i)return null;const s=[];let a=null;"interpolate-hcl"===r||"interpolate-lab"===r?a=Kt:e.expectedType&&"value"!==e.expectedType.kind&&(a=e.expectedType);for(let l=0;l<o.length;l+=2){const t=o[l],r=o[l+1],n=l+3,i=l+4;if("number"!=typeof t)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',n);if(s.length&&s[s.length-1][0]>=t)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',n);const u=e.parse(r,i,a);if(!u)return null;a=a||u.type,s.push([t,u])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new Er(a,r,n,i,s):e.error(`Type ${oe(a)} is not interpolatable.`)}evaluate(t){const e=this.labels,r=this.outputs;if(1===e.length)return r[0].evaluate(t);const n=this.input.evaluate(t);if(n<=e[0])return r[0].evaluate(t);const i=e.length;if(n>=e[i-1])return r[i-1].evaluate(t);const o=rr(e,n),s=Er.interpolationFactor(this.interpolation,n,e[o],e[o+1]),a=r[o].evaluate(t),l=r[o+1].evaluate(t);return"interpolate"===this.operator?or[this.type.kind.toLowerCase()](a,l,s):"interpolate-hcl"===this.operator?br.reverse(br.interpolate(br.forward(a),br.forward(l),s)):xr.reverse(xr.interpolate(xr.forward(a),xr.forward(l),s))}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const e=[this.operator,t,this.input.serialize()];for(let r=0;r<this.labels.length;r++)e.push(this.labels[r],this.outputs[r].serialize());return e}}function Sr(t,e,r,n){const i=n-r,o=t-r;return 0===i?0:1===e?o/i:(Math.pow(e,o)-1)/(Math.pow(e,i)-1)}class Ir{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expectected at least one argument.");let r=null;const n=e.expectedType;n&&"value"!==n.kind&&(r=n);const i=[];for(const s of t.slice(1)){const t=e.parse(s,1+i.length,r,void 0,{typeAnnotation:"omit"});if(!t)return null;r=r||t.type,i.push(t)}const o=n&&i.some(t=>ae(n,t.type));return new Ir(o?te:r,i)}evaluate(t){let e,r=null,n=0;for(const i of this.args){if(n++,r=i.evaluate(t),r&&r instanceof ge&&!r.available&&(e||(e=r),r=null,n===this.args.length))return e;if(null!==r)break}return r}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(e=>{t.push(e.serialize())}),t}}class Tr{constructor(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const e of this.bindings)t(e[1]);t(this.result)}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const r=[];for(let i=1;i<t.length-1;i+=2){const n=t[i];if("string"!=typeof n)return e.error(`Expected string, but found ${typeof n} instead.`,i);if(/[^a-zA-Z0-9_]/.test(n))return e.error("Variable names must contain only alphanumeric characters or '_'.",i);const o=e.parse(t[i+1],i+1);if(!o)return null;r.push([n,o])}const n=e.parse(t[t.length-1],t.length-1,e.expectedType,r);return n?new Tr(r,n):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[e,r]of this.bindings)t.push(e,r.serialize());return t.push(this.result.serialize()),t}}class Cr{constructor(t,e,r){this.type=t,this.index=e,this.input=r}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const r=e.parse(t[1],1,Yt),n=e.parse(t[2],2,ie(e.expectedType||te));return r&&n?new Cr(n.type.itemType,r,n):null}evaluate(t){const e=this.index.evaluate(t),r=this.input.evaluate(t);if(e<0)throw new we(`Array index out of bounds: ${e} < 0.`);if(e>=r.length)throw new we(`Array index out of bounds: ${e} > ${r.length-1}.`);if(e!==Math.floor(e))throw new we(`Array index must be an integer, but found ${e} instead.`);return r[e]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Mr{constructor(t,e){this.type=Jt,this.needle=t,this.haystack=e}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const r=e.parse(t[1],1,te),n=e.parse(t[2],2,te);return r&&n?le(r.type,[Jt,Ht,Yt,Wt,te])?new Mr(r,n):e.error(`Expected first argument to be of type boolean, string, number or null, but found ${oe(r.type)} instead`):null}evaluate(t){const e=this.needle.evaluate(t),r=this.haystack.evaluate(t);if(!r)return!1;if(!ue(e,["boolean","string","number","null"]))throw new we(`Expected first argument to be of type boolean, string, number or null, but found ${oe(ve(e))} instead.`);if(!ue(r,["string","array"]))throw new we(`Expected second argument to be of type array or string, but found ${oe(ve(r))} instead.`);return r.indexOf(e)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Ar{constructor(t,e,r){this.type=Yt,this.needle=t,this.haystack=e,this.fromIndex=r}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const r=e.parse(t[1],1,te),n=e.parse(t[2],2,te);if(!r||!n)return null;if(!le(r.type,[Jt,Ht,Yt,Wt,te]))return e.error(`Expected first argument to be of type boolean, string, number or null, but found ${oe(r.type)} instead`);if(4===t.length){const i=e.parse(t[3],3,Yt);return i?new Ar(r,n,i):null}return new Ar(r,n)}evaluate(t){const e=this.needle.evaluate(t),r=this.haystack.evaluate(t);if(!ue(e,["boolean","string","number","null"]))throw new we(`Expected first argument to be of type boolean, string, number or null, but found ${oe(ve(e))} instead.`);if(!ue(r,["string","array"]))throw new we(`Expected second argument to be of type array or string, but found ${oe(ve(r))} instead.`);if(this.fromIndex){const n=this.fromIndex.evaluate(t);return r.indexOf(e,n)}return r.indexOf(e)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Pr{constructor(t,e,r,n,i,o){this.inputType=t,this.type=e,this.input=r,this.cases=n,this.outputs=i,this.otherwise=o}static parse(t,e){if(t.length<5)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return e.error("Expected an even number of arguments.");let r,n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);const i={},o=[];for(let l=2;l<t.length-1;l+=2){let s=t[l];const a=t[l+1];Array.isArray(s)||(s=[s]);const u=e.concat(l);if(0===s.length)return u.error("Expected at least one branch label.");for(const t of s){if("number"!=typeof t&&"string"!=typeof t)return u.error("Branch labels must be numbers or strings.");if("number"==typeof t&&Math.abs(t)>Number.MAX_SAFE_INTEGER)return u.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof t&&Math.floor(t)!==t)return u.error("Numeric branch labels must be integer values.");if(r){if(u.checkSubtype(r,ve(t)))return null}else r=ve(t);if(void 0!==i[String(t)])return u.error("Branch labels must be unique.");i[String(t)]=o.length}const c=e.parse(a,l,n);if(!c)return null;n=n||c.type,o.push(c)}const s=e.parse(t[1],1,te);if(!s)return null;const a=e.parse(t[t.length-1],t.length-1,n);return a?"value"!==s.type.kind&&e.concat(1).checkSubtype(r,s.type)?null:new Pr(r,n,s,i,o,a):null}evaluate(t){const e=this.input.evaluate(t);return(ve(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],e=Object.keys(this.cases).sort(),r=[],n={};for(const o of e){const t=n[this.cases[o]];void 0===t?(n[this.cases[o]]=r.length,r.push([this.cases[o],[o]])):r[t][1].push(o)}const i=t=>"number"===this.inputType.kind?Number(t):t;for(const[o,s]of r)t.push(1===s.length?i(s[0]):s.map(i)),t.push(this.outputs[o].serialize());return t.push(this.otherwise.serialize()),t}}class kr{constructor(t,e,r){this.type=t,this.branches=e,this.otherwise=r}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return e.error("Expected an odd number of arguments.");let r;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);const n=[];for(let o=1;o<t.length-1;o+=2){const i=e.parse(t[o],o,Jt);if(!i)return null;const s=e.parse(t[o+1],o+1,r);if(!s)return null;n.push([i,s]),r=r||s.type}const i=e.parse(t[t.length-1],t.length-1,r);return i?new kr(r,n,i):null}evaluate(t){for(const[e,r]of this.branches)if(e.evaluate(t))return r.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[e,r]of this.branches)t(e),t(r);t(this.otherwise)}outputDefined(){return this.branches.every(([t,e])=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(e=>{t.push(e.serialize())}),t}}class Lr{constructor(t,e,r,n){this.type=t,this.input=e,this.beginIndex=r,this.endIndex=n}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const r=e.parse(t[1],1,te),n=e.parse(t[2],2,Yt);if(!r||!n)return null;if(!le(r.type,[ie(te),Ht,te]))return e.error(`Expected first argument to be of type array or string, but found ${oe(r.type)} instead`);if(4===t.length){const i=e.parse(t[3],3,Yt);return i?new Lr(r.type,r,n,i):null}return new Lr(r.type,r,n)}evaluate(t){const e=this.input.evaluate(t),r=this.beginIndex.evaluate(t);if(!ue(e,["string","array"]))throw new we(`Expected first argument to be of type array or string, but found ${oe(ve(e))} instead.`);if(this.endIndex){const n=this.endIndex.evaluate(t);return e.slice(r,n)}return e.slice(r)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function zr(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function Dr(t,e,r,n){return 0===n.compare(e,r)}function Rr(t,e,r){const n="=="!==t&&"!="!==t;return class i{constructor(t,e,r){this.type=Jt,this.lhs=t,this.rhs=e,this.collator=r,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}static parse(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");const r=t[0];let o=e.parse(t[1],1,te);if(!o)return null;if(!zr(r,o.type))return e.concat(1).error(`"${r}" comparisons are not supported for type '${oe(o.type)}'.`);let s=e.parse(t[2],2,te);if(!s)return null;if(!zr(r,s.type))return e.concat(2).error(`"${r}" comparisons are not supported for type '${oe(s.type)}'.`);if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return e.error(`Cannot compare types '${oe(o.type)}' and '${oe(s.type)}'.`);n&&("value"===o.type.kind&&"value"!==s.type.kind?o=new Se(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new Se(o.type,[s])));let a=null;if(4===t.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return e.error("Cannot use collator to compare non-string types.");if(a=e.parse(t[3],3,ee),!a)return null}return new i(o,s,a)}evaluate(i){const o=this.lhs.evaluate(i),s=this.rhs.evaluate(i);if(n&&this.hasUntypedArgument){const e=ve(o),r=ve(s);if(e.kind!==r.kind||"string"!==e.kind&&"number"!==e.kind)throw new we(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${e.kind}, ${r.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const t=ve(o),r=ve(s);if("string"!==t.kind||"string"!==r.kind)return e(i,o,s)}return this.collator?r(i,o,s,this.collator.evaluate(i)):e(i,o,s)}eachChild(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)}outputDefined(){return!0}serialize(){const e=[t];return this.eachChild(t=>{e.push(t.serialize())}),e}}}const Or=Rr("==",function(t,e,r){return e===r},Dr),Nr=Rr("!=",function(t,e,r){return e!==r},function(t,e,r,n){return!Dr(0,e,r,n)}),Fr=Rr("<",function(t,e,r){return e<r},function(t,e,r,n){return n.compare(e,r)<0}),Br=Rr(">",function(t,e,r){return e>r},function(t,e,r,n){return n.compare(e,r)>0}),jr=Rr("<=",function(t,e,r){return e<=r},function(t,e,r,n){return n.compare(e,r)<=0}),Ur=Rr(">=",function(t,e,r){return e>=r},function(t,e,r,n){return n.compare(e,r)>=0});class Vr{constructor(t,e,r,n,i){this.type=Ht,this.number=t,this.locale=e,this.currency=r,this.minFractionDigits=n,this.maxFractionDigits=i}static parse(t,e){if(3!==t.length)return e.error("Expected two arguments.");const r=e.parse(t[1],1,Yt);if(!r)return null;const n=t[2];if("object"!=typeof n||Array.isArray(n))return e.error("NumberFormat options argument must be an object.");let i=null;if(n.locale&&(i=e.parse(n.locale,1,Ht),!i))return null;let o=null;if(n.currency&&(o=e.parse(n.currency,1,Ht),!o))return null;let s=null;if(n["min-fraction-digits"]&&(s=e.parse(n["min-fraction-digits"],1,Yt),!s))return null;let a=null;return n["max-fraction-digits"]&&(a=e.parse(n["max-fraction-digits"],1,Yt),!a)?null:new Vr(r,i,o,s,a)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class Gr{constructor(t){this.type=Yt,this.input=t}static parse(t,e){if(2!==t.length)return e.error(`Expected 1 argument, but found ${t.length-1} instead.`);const r=e.parse(t[1],1);return r?"array"!==r.type.kind&&"string"!==r.type.kind&&"value"!==r.type.kind?e.error(`Expected argument of type string or array, but found ${oe(r.type)} instead.`):new Gr(r):null}evaluate(t){const e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new we(`Expected value to be of type string or array, but found ${oe(ve(e))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(e=>{t.push(e.serialize())}),t}}const qr={"==":Or,"!=":Nr,">":Br,"<":Fr,">=":Ur,"<=":jr,array:Se,at:Cr,boolean:Se,case:kr,coalesce:Ir,collator:Le,format:Ie,image:Te,in:Mr,"index-of":Ar,interpolate:Er,"interpolate-hcl":Er,"interpolate-lab":Er,length:Gr,let:Tr,literal:be,match:Pr,number:Se,"number-format":Vr,object:Se,slice:Lr,step:nr,string:Se,"to-boolean":Me,"to-color":Me,"to-number":Me,"to-string":Me,var:Qe,within:Ye};function $r(t,[e,r,n,i]){e=e.evaluate(t),r=r.evaluate(t),n=n.evaluate(t);const o=i?i.evaluate(t):1,s=ye(e,r,n,o);if(s)throw new we(s);return new pe(e/255*o,r/255*o,n/255*o,o)}function Zr(t,e){return t in e}function Xr(t,e){const r=e[t];return void 0===r?null:r}function Wr(t){return{type:t}}function Yr(t){return{result:"success",value:t}}function Hr(t){return{result:"error",value:t}}function Jr(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function Kr(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Qr(t){return!!t.expression&&t.expression.interpolated}function tn(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function en(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function rn(t){return t}function nn(t,e){const r="color"===e.type,n=t.stops&&"object"==typeof t.stops[0][0],i=n||!(n||void 0!==t.property),o=t.type||(Qr(e)?"exponential":"interval");if(r&&((t=Gt({},t)).stops&&(t.stops=t.stops.map(t=>[t[0],pe.parse(t[1])])),t.default=pe.parse(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!wr[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let s,a,l;if("exponential"===o)s=ln;else if("interval"===o)s=an;else if("categorical"===o){s=sn,a=Object.create(null);for(const e of t.stops)a[e[0]]=e[1];l=typeof t.stops[0][0]}else{if("identity"!==o)throw new Error(`Unknown function type "${o}"`);s=un}if(n){const r={},n=[];for(let e=0;e<t.stops.length;e++){const i=t.stops[e],o=i[0].zoom;void 0===r[o]&&(r[o]={zoom:o,type:t.type,property:t.property,default:t.default,stops:[]},n.push(o)),r[o].stops.push([i[0].value,i[1]])}const i=[];for(const t of n)i.push([r[t].zoom,nn(r[t],e)]);const o={name:"linear"};return{kind:"composite",interpolationType:o,interpolationFactor:Er.interpolationFactor.bind(void 0,o),zoomStops:i.map(t=>t[0]),evaluate:({zoom:r},n)=>ln({stops:i,base:t.base},e,r).evaluate(r,n)}}if(i){const r="exponential"===o?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:r,interpolationFactor:Er.interpolationFactor.bind(void 0,r),zoomStops:t.stops.map(t=>t[0]),evaluate:({zoom:r})=>s(t,e,r,a,l)}}return{kind:"source",evaluate(r,n){const i=n&&n.properties?n.properties[t.property]:void 0;return void 0===i?on(t.default,e.default):s(t,e,i,a,l)}}}function on(t,e,r){return void 0!==t?t:void 0!==e?e:void 0!==r?r:void 0}function sn(t,e,r,n,i){return on(typeof r===i?n[r]:void 0,t.default,e.default)}function an(t,e,r){if("number"!==tn(r))return on(t.default,e.default);const n=t.stops.length;if(1===n)return t.stops[0][1];if(r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[n-1][0])return t.stops[n-1][1];const i=rr(t.stops.map(t=>t[0]),r);return t.stops[i][1]}function ln(t,e,r){const n=void 0!==t.base?t.base:1;if("number"!==tn(r))return on(t.default,e.default);const i=t.stops.length;if(1===i)return t.stops[0][1];if(r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[i-1][0])return t.stops[i-1][1];const o=rr(t.stops.map(t=>t[0]),r),s=function(t,e,r,n){const i=n-r,o=t-r;return 0===i?0:1===e?o/i:(Math.pow(e,o)-1)/(Math.pow(e,i)-1)}(r,n,t.stops[o][0],t.stops[o+1][0]),a=t.stops[o][1],l=t.stops[o+1][1];let u=or[e.type]||rn;if(t.colorSpace&&"rgb"!==t.colorSpace){const e=wr[t.colorSpace];u=((t,r)=>e.reverse(e.interpolate(e.forward(t),e.forward(r),s)))}return"function"==typeof a.evaluate?{evaluate(...t){const e=a.evaluate.apply(void 0,t),r=l.evaluate.apply(void 0,t);if(void 0!==e&&void 0!==r)return u(e,r,s)}}:u(a,l,s)}function un(t,e,r){return"color"===e.type?r=pe.parse(r):"formatted"===e.type?r=me.fromString(r.toString()):"resolvedImage"===e.type?r=ge.fromString(r.toString()):tn(r)===e.type||"enum"===e.type&&e.values[r]||(r=void 0),on(r,t.default,e.default)}ke.register(qr,{error:[{kind:"error"},[Ht],(t,[e])=>{throw new we(e.evaluate(t))}],typeof:[Ht,[te],(t,[e])=>oe(ve(e.evaluate(t)))],"to-rgba":[ie(Yt,4),[Kt],(t,[e])=>e.evaluate(t).toArray()],rgb:[Kt,[Yt,Yt,Yt],$r],rgba:[Kt,[Yt,Yt,Yt,Yt],$r],has:{type:Jt,overloads:[[[Ht],(t,[e])=>Zr(e.evaluate(t),t.properties())],[[Ht,Qt],(t,[e,r])=>Zr(e.evaluate(t),r.evaluate(t))]]},get:{type:te,overloads:[[[Ht],(t,[e])=>Xr(e.evaluate(t),t.properties())],[[Ht,Qt],(t,[e,r])=>Xr(e.evaluate(t),r.evaluate(t))]]},"feature-state":[te,[Ht],(t,[e])=>Xr(e.evaluate(t),t.featureState||{})],properties:[Qt,[],t=>t.properties()],"geometry-type":[Ht,[],t=>t.geometryType()],id:[te,[],t=>t.id()],zoom:[Yt,[],t=>t.globals.zoom],pitch:[Yt,[],t=>t.globals.pitch||0],"distance-from-center":[Yt,[],t=>t.distanceFromCenter()],"heatmap-density":[Yt,[],t=>t.globals.heatmapDensity||0],"line-progress":[Yt,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[Yt,[],t=>t.globals.skyRadialProgress||0],accumulated:[te,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[Yt,Wr(Yt),(t,e)=>{let r=0;for(const n of e)r+=n.evaluate(t);return r}],"*":[Yt,Wr(Yt),(t,e)=>{let r=1;for(const n of e)r*=n.evaluate(t);return r}],"-":{type:Yt,overloads:[[[Yt,Yt],(t,[e,r])=>e.evaluate(t)-r.evaluate(t)],[[Yt],(t,[e])=>-e.evaluate(t)]]},"/":[Yt,[Yt,Yt],(t,[e,r])=>e.evaluate(t)/r.evaluate(t)],"%":[Yt,[Yt,Yt],(t,[e,r])=>e.evaluate(t)%r.evaluate(t)],ln2:[Yt,[],()=>Math.LN2],pi:[Yt,[],()=>Math.PI],e:[Yt,[],()=>Math.E],"^":[Yt,[Yt,Yt],(t,[e,r])=>Math.pow(e.evaluate(t),r.evaluate(t))],sqrt:[Yt,[Yt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Yt,[Yt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Yt,[Yt],(t,[e])=>Math.log(e.evaluate(t))],log2:[Yt,[Yt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Yt,[Yt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Yt,[Yt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Yt,[Yt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Yt,[Yt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Yt,[Yt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Yt,[Yt],(t,[e])=>Math.atan(e.evaluate(t))],min:[Yt,Wr(Yt),(t,e)=>Math.min(...e.map(e=>e.evaluate(t)))],max:[Yt,Wr(Yt),(t,e)=>Math.max(...e.map(e=>e.evaluate(t)))],abs:[Yt,[Yt],(t,[e])=>Math.abs(e.evaluate(t))],round:[Yt,[Yt],(t,[e])=>{const r=e.evaluate(t);return r<0?-Math.round(-r):Math.round(r)}],floor:[Yt,[Yt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Yt,[Yt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Jt,[Ht,te],(t,[e,r])=>t.properties()[e.value]===r.value],"filter-id-==":[Jt,[te],(t,[e])=>t.id()===e.value],"filter-type-==":[Jt,[Ht],(t,[e])=>t.geometryType()===e.value],"filter-<":[Jt,[Ht,te],(t,[e,r])=>{const n=t.properties()[e.value],i=r.value;return typeof n==typeof i&&n<i}],"filter-id-<":[Jt,[te],(t,[e])=>{const r=t.id(),n=e.value;return typeof r==typeof n&&r<n}],"filter->":[Jt,[Ht,te],(t,[e,r])=>{const n=t.properties()[e.value],i=r.value;return typeof n==typeof i&&n>i}],"filter-id->":[Jt,[te],(t,[e])=>{const r=t.id(),n=e.value;return typeof r==typeof n&&r>n}],"filter-<=":[Jt,[Ht,te],(t,[e,r])=>{const n=t.properties()[e.value],i=r.value;return typeof n==typeof i&&n<=i}],"filter-id-<=":[Jt,[te],(t,[e])=>{const r=t.id(),n=e.value;return typeof r==typeof n&&r<=n}],"filter->=":[Jt,[Ht,te],(t,[e,r])=>{const n=t.properties()[e.value],i=r.value;return typeof n==typeof i&&n>=i}],"filter-id->=":[Jt,[te],(t,[e])=>{const r=t.id(),n=e.value;return typeof r==typeof n&&r>=n}],"filter-has":[Jt,[te],(t,[e])=>e.value in t.properties()],"filter-has-id":[Jt,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[Jt,[ie(Ht)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Jt,[ie(te)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Jt,[Ht,ie(te)],(t,[e,r])=>r.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Jt,[Ht,ie(te)],(t,[e,r])=>(function(t,e,r,n){for(;r<=n;){const i=r+n>>1;if(e[i]===t)return!0;e[i]>t?n=i-1:r=i+1}return!1})(t.properties()[e.value],r.value,0,r.value.length-1)],all:{type:Jt,overloads:[[[Jt,Jt],(t,[e,r])=>e.evaluate(t)&&r.evaluate(t)],[Wr(Jt),(t,e)=>{for(const r of e)if(!r.evaluate(t))return!1;return!0}]]},any:{type:Jt,overloads:[[[Jt,Jt],(t,[e,r])=>e.evaluate(t)||r.evaluate(t)],[Wr(Jt),(t,e)=>{for(const r of e)if(r.evaluate(t))return!0;return!1}]]},"!":[Jt,[Jt],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Jt,[Ht],(t,[e])=>{const r=t.globals&&t.globals.isSupportedScript;return!r||r(e.evaluate(t))}],upcase:[Ht,[Ht],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Ht,[Ht],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Ht,Wr(te),(t,e)=>e.map(e=>xe(e.evaluate(t))).join("")],"resolved-locale":[Ht,[ee],(t,[e])=>e.evaluate(t).resolvedLocale()]});class cn{constructor(t,e){this.expression=t,this._warningHistory={},this._evaluator=new Pe,this._defaultValue=e?function(t){return"color"===t.type&&en(t.default)?new pe(0,0,0,0):"color"===t.type?pe.parse(t.default)||null:void 0===t.default?null:t.default}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null}evaluateWithoutErrorHandling(t,e,r,n,i,o,s,a){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=r,this._evaluator.canonical=n,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null,this.expression.evaluate(this._evaluator)}evaluate(t,e,r,n,i,o,s,a){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=r||null,this._evaluator.canonical=n,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new we(`Expected value to be one of ${Object.keys(this._enumValues).map(t=>JSON.stringify(t)).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}}}function hn(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in qr}function pn(t,e){const r=new tr(qr,[],e?function(t){const e={color:Kt,string:Ht,number:Yt,enum:Ht,boolean:Jt,formatted:re,resolvedImage:ne};return"array"===t.type?ie(e[t.value]||te,t.length):e[t.type]}(e):void 0),n=r.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return n?Yr(new cn(n,e)):Hr(r.errors)}class fn{constructor(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!Je(e.expression)}evaluateWithoutErrorHandling(t,e,r,n,i,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r,n,i,o)}evaluate(t,e,r,n,i,o){return this._styleExpression.evaluate(t,e,r,n,i,o)}}class dn{constructor(t,e,r,n){this.kind=t,this.zoomStops=r,this._styleExpression=e,this.isStateDependent="camera"!==t&&!Je(e.expression),this.interpolationType=n}evaluateWithoutErrorHandling(t,e,r,n,i,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r,n,i,o)}evaluate(t,e,r,n,i,o){return this._styleExpression.evaluate(t,e,r,n,i,o)}interpolationFactor(t,e,r){return this.interpolationType?Er.interpolationFactor(this.interpolationType,t,e,r):0}}function mn(t,e){if("error"===(t=pn(t,e)).result)return t;const r=t.value.expression,n=He(r);if(!n&&!Jr(e))return Hr([new Zt("","data expressions not supported")]);const i=Ke(r,["zoom","pitch","distance-from-center"]);if(!i&&!Kr(e))return Hr([new Zt("","zoom expressions not supported")]);const o=yn(r);return o||i?o instanceof Zt?Hr([o]):o instanceof Er&&!Qr(e)?Hr([new Zt("",'"interpolate" expressions cannot be used with this property')]):Yr(o?new dn(n?"camera":"composite",t.value,o.labels,o instanceof Er?o.interpolation:void 0):new fn(n?"constant":"source",t.value)):Hr([new Zt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class gn{constructor(t,e){this._parameters=t,this._specification=e,Gt(this,nn(this._parameters,this._specification))}static deserialize(t){return new gn(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function yn(t){let e=null;if(t instanceof Tr)e=yn(t.result);else if(t instanceof Ir){for(const r of t.args)if(e=yn(r),e)break}else(t instanceof nr||t instanceof Er)&&t.input instanceof ke&&"zoom"===t.input.name&&(e=t);return e instanceof Zt||t.eachChild(t=>{const r=yn(t);r instanceof Zt?e=r:!e&&r?e=new Zt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&r&&e!==r&&(e=new Zt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function _n(t){const e=t.key,r=t.value,n=t.valueSpec||{},i=t.objectElementValidators||{},o=t.style,s=t.styleSpec;let a=[];const l=tn(r);if("object"!==l)return[new Ut(e,r,`object expected, ${l} found`)];for(const u in r){const t=u.split(".")[0],l=n[t]||n["*"];let c;if(i[t])c=i[t];else if(n[t])c=Jn;else if(i["*"])c=i["*"];else{if(!n["*"]){a.push(new Ut(e,r[u],`unknown property "${u}"`));continue}c=Jn}a=a.concat(c({key:(e?`${e}.`:e)+u,value:r[u],valueSpec:l,style:o,styleSpec:s,object:r,objectKey:u},r))}for(const u in n)i[u]||n[u].required&&void 0===n[u].default&&void 0===r[u]&&a.push(new Ut(e,r,`missing required property "${u}"`));return a}function vn(t){const e=t.value,r=t.valueSpec,n=t.style,i=t.styleSpec,o=t.key,s=t.arrayElementValidator||Jn;if("array"!==tn(e))return[new Ut(o,e,`array expected, ${tn(e)} found`)];if(r.length&&e.length!==r.length)return[new Ut(o,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new Ut(o,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let a={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum};i.$version<7&&(a.function=r.function),"object"===tn(r.value)&&(a=r.value);let l=[];for(let u=0;u<e.length;u++)l=l.concat(s({array:e,arrayIndex:u,value:e[u],valueSpec:a,style:n,styleSpec:i,key:`${o}[${u}]`}));return l}function xn(t){const e=t.key,r=t.value,n=t.valueSpec;let i=tn(r);if("number"===i&&r!=r&&(i="NaN"),"number"!==i)return[new Ut(e,r,`number expected, ${i} found`)];if("minimum"in n){let i=n.minimum;if("array"===tn(n.minimum)&&(i=n.minimum[t.arrayIndex]),r<i)return[new Ut(e,r,`${r} is less than the minimum value ${i}`)]}if("maximum"in n){let i=n.maximum;if("array"===tn(n.maximum)&&(i=n.maximum[t.arrayIndex]),r>i)return[new Ut(e,r,`${r} is greater than the maximum value ${i}`)]}return[]}function bn(t){const e=t.valueSpec,r=qt(t.value.type);let n,i,o,s={};const a="categorical"!==r&&void 0===t.value.property,l=!a,u="array"===tn(t.value.stops)&&"array"===tn(t.value.stops[0])&&"object"===tn(t.value.stops[0][0]),c=_n({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===r)return[new Ut(t.key,t.value,'identity function may not have a "stops" property')];let e=[];const n=t.value;return e=e.concat(vn({key:t.key,value:n,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===tn(n)&&0===n.length&&e.push(new Ut(t.key,n,"array must have at least one stop")),e},default:function(t){return Jn({key:t.key,value:t.value,valueSpec:e,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===r&&a&&c.push(new Ut(t.key,t.value,'missing required property "property"')),"identity"===r||t.value.stops||c.push(new Ut(t.key,t.value,'missing required property "stops"')),"exponential"===r&&t.valueSpec.expression&&!Qr(t.valueSpec)&&c.push(new Ut(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(l&&!Jr(t.valueSpec)?c.push(new Ut(t.key,t.value,"property functions not supported")):a&&!Kr(t.valueSpec)&&c.push(new Ut(t.key,t.value,"zoom functions not supported"))),"categorical"!==r&&!u||void 0!==t.value.property||c.push(new Ut(t.key,t.value,'"property" property is required')),c;function h(t){let r=[];const n=t.value,a=t.key;if("array"!==tn(n))return[new Ut(a,n,`array expected, ${tn(n)} found`)];if(2!==n.length)return[new Ut(a,n,`array length 2 expected, length ${n.length} found`)];if(u){if("object"!==tn(n[0]))return[new Ut(a,n,`object expected, ${tn(n[0])} found`)];if(void 0===n[0].zoom)return[new Ut(a,n,"object stop key must have zoom")];if(void 0===n[0].value)return[new Ut(a,n,"object stop key must have value")];if(o&&o>qt(n[0].zoom))return[new Ut(a,n[0].zoom,"stop zoom values must appear in ascending order")];qt(n[0].zoom)!==o&&(o=qt(n[0].zoom),i=void 0,s={}),r=r.concat(_n({key:`${a}[0]`,value:n[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:xn,value:p}}))}else r=r.concat(p({key:`${a}[0]`,value:n[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},n));return hn($t(n[1]))?r.concat([new Ut(`${a}[1]`,n[1],"expressions are not allowed in function stops.")]):r.concat(Jn({key:`${a}[1]`,value:n[1],valueSpec:e,style:t.style,styleSpec:t.styleSpec}))}function p(t,o){const a=tn(t.value),l=qt(t.value),u=null!==t.value?t.value:o;if(n){if(a!==n)return[new Ut(t.key,u,`${a} stop domain type must match previous stop domain type ${n}`)]}else n=a;if("number"!==a&&"string"!==a&&"boolean"!==a)return[new Ut(t.key,u,"stop domain value must be a number, string, or boolean")];if("number"!==a&&"categorical"!==r){let n=`number expected, ${a} found`;return Jr(e)&&void 0===r&&(n+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ut(t.key,u,n)]}return"categorical"!==r||"number"!==a||isFinite(l)&&Math.floor(l)===l?"categorical"!==r&&"number"===a&&void 0!==i&&l<i?[new Ut(t.key,u,"stop domain values must appear in ascending order")]:(i=l,"categorical"===r&&l in s?[new Ut(t.key,u,"stop domain values must be unique")]:(s[l]=!0,[])):[new Ut(t.key,u,`integer expected, found ${l}`)]}}function wn(t){const e=("property"===t.expressionContext?mn:pn)($t(t.value),t.valueSpec);if("error"===e.result)return e.value.map(e=>new Ut(`${t.key}${e.key}`,t.value,e.message));const r=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!r.outputDefined())return[new Ut(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!Je(r))return[new Ut(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return En(r,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!Ke(r,["zoom","feature-state"]))return[new Ut(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!He(r))return[new Ut(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function En(t,e){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);for(const i of e.valueSpec.expression.parameters)r.delete(i);if(0===r.size)return[];const n=[];return t instanceof ke&&r.has(t.name)?[new Ut(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(t=>{n.push(...En(t,e))}),n)}function Sn(t){const e=t.key,r=t.value,n=t.valueSpec,i=[];return Array.isArray(n.values)?-1===n.values.indexOf(qt(r))&&i.push(new Ut(e,r,`expected one of [${n.values.join(", ")}], ${JSON.stringify(r)} found`)):-1===Object.keys(n.values).indexOf(qt(r))&&i.push(new Ut(e,r,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(r)} found`)),i}function In(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!In(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function Tn(t,e="fill"){if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};In(t)||(t=zn(t));const r=t;let n=!0;try{n=function(t){if(!An(t))return t;let e=$t(t);return Mn(e),e=Cn(e),e}(r)}catch(t){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(r,null,2)}\n        `)}const i=jt[`filter_${e}`],o=pn(n,i);let s=null;if("error"===o.result)throw new Error(o.value.map(t=>`${t.key}: ${t.message}`).join(", "));s=((t,e,r)=>o.value.evaluate(t,e,{},r));let a=null,l=null;if(n!==r){const t=pn(r,i);if("error"===t.result)throw new Error(t.value.map(t=>`${t.key}: ${t.message}`).join(", "));a=((e,r,n,i,o)=>t.value.evaluate(e,r,{},n,void 0,void 0,i,o)),l=!He(t.value.expression)}return s=s,{filter:s,dynamicFilter:a||void 0,needGeometry:Ln(n),needFeature:!!l}}function Cn(t){if(!Array.isArray(t))return t;const e=function(t){if(Pn.has(t[0]))for(let e=1;e<t.length;e++)if(An(t[e]))return!0;return t}(t);return!0===e?e:e.map(t=>Cn(t))}function Mn(t){let e=!1;const r=[];if("case"===t[0]){for(let n=1;n<t.length-1;n+=2)e=e||An(t[n]),r.push(t[n+1]);r.push(t[t.length-1])}else if("match"===t[0]){e=e||An(t[1]);for(let e=2;e<t.length-1;e+=2)r.push(t[e+1]);r.push(t[t.length-1])}else if("step"===t[0]){e=e||An(t[1]);for(let e=1;e<t.length-1;e+=2)r.push(t[e+1])}e&&(t.length=0,t.push("any",...r));for(let n=1;n<t.length;n++)Mn(t[n])}function An(t){if(!Array.isArray(t))return!1;if("pitch"===(e=t[0])||"distance-from-center"===e)return!0;var e;for(let r=1;r<t.length;r++)if(An(t[r]))return!0;return!1}const Pn=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function kn(t,e){return t<e?-1:t>e?1:0}function Ln(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(let e=1;e<t.length;e++)if(Ln(t[e]))return!0;return!1}function zn(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?Dn(t[1],t[2],"=="):"!="===e?Nn(Dn(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?Dn(t[1],t[2],e):"any"===e?(r=t.slice(1),["any"].concat(r.map(zn))):"all"===e?["all"].concat(t.slice(1).map(zn)):"none"===e?["all"].concat(t.slice(1).map(zn).map(Nn)):"in"===e?Rn(t[1],t.slice(2)):"!in"===e?Nn(Rn(t[1],t.slice(2))):"has"===e?On(t[1]):"!has"===e?Nn(On(t[1])):"within"!==e||t;var r}function Dn(t,e,r){switch(t){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,t,e]}}function Rn(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(t=>typeof t!=typeof e[0])?["filter-in-large",t,["literal",e.sort(kn)]]:["filter-in-small",t,["literal",e]]}}function On(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Nn(t){return["!",t]}function Fn(t){if(In($t(t.value))){const e=$t(t.layerType);return wn(Gt({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${e||"fill"}`]}))}return Bn(t)}function Bn(t){const e=t.value,r=t.key;if("array"!==tn(e))return[new Ut(r,e,`array expected, ${tn(e)} found`)];const n=t.styleSpec;let i,o=[];if(e.length<1)return[new Ut(r,e,"filter array must have at least 1 element")];switch(o=o.concat(Sn({key:`${r}[0]`,value:e[0],valueSpec:n.filter_operator,style:t.style,styleSpec:t.styleSpec})),qt(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===qt(e[1])&&o.push(new Ut(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&o.push(new Ut(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(i=tn(e[1]),"string"!==i&&o.push(new Ut(`${r}[1]`,e[1],`string expected, ${i} found`)));for(let s=2;s<e.length;s++)i=tn(e[s]),"$type"===qt(e[1])?o=o.concat(Sn({key:`${r}[${s}]`,value:e[s],valueSpec:n.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==i&&"number"!==i&&"boolean"!==i&&o.push(new Ut(`${r}[${s}]`,e[s],`string, number, or boolean expected, ${i} found`));break;case"any":case"all":case"none":for(let n=1;n<e.length;n++)o=o.concat(Bn({key:`${r}[${n}]`,value:e[n],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":i=tn(e[1]),2!==e.length?o.push(new Ut(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==i&&o.push(new Ut(`${r}[1]`,e[1],`string expected, ${i} found`));break;case"within":i=tn(e[1]),2!==e.length?o.push(new Ut(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==i&&o.push(new Ut(`${r}[1]`,e[1],`object expected, ${i} found`))}return o}function jn(t,e){const r=t.key,n=t.style,i=t.styleSpec,o=t.value,s=t.objectKey,a=i[`${e}_${t.layerType}`];if(!a)return[];const l=s.match(/^(.*)-transition$/);if("paint"===e&&l&&a[l[1]]&&a[l[1]].transition)return Jn({key:r,value:o,valueSpec:i.transition,style:n,styleSpec:i});const u=t.valueSpec||a[s];if(!u)return[new Ut(r,o,`unknown property "${s}"`)];let c;if("string"===tn(o)&&Jr(u)&&!u.tokens&&(c=/^{([^}]+)}$/.exec(o)))return[new Ut(r,o,`"${s}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(c[1])} }\`.`)];const h=[];return"symbol"===t.layerType&&("text-field"===s&&n&&!n.glyphs&&h.push(new Ut(r,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===s&&en($t(o))&&"identity"===qt(o.type)&&h.push(new Ut(r,o,'"text-font" does not support identity functions'))),h.concat(Jn({key:t.key,value:o,valueSpec:u,style:n,styleSpec:i,expressionContext:"property",propertyType:e,propertyKey:s}))}function Un(t){return jn(t,"paint")}function Vn(t){return jn(t,"layout")}function Gn(t){let e=[];const r=t.value,n=t.key,i=t.style,o=t.styleSpec;r.type||r.ref||e.push(new Ut(n,r,'either "type" or "ref" is required'));let s=qt(r.type);const a=qt(r.ref);if(r.id){const o=qt(r.id);for(let s=0;s<t.arrayIndex;s++){const t=i.layers[s];qt(t.id)===o&&e.push(new Ut(n,r.id,`duplicate layer id "${r.id}", previously used at line ${t.id.__line__}`))}}if("ref"in r){let t;["type","source","source-layer","filter","layout"].forEach(t=>{t in r&&e.push(new Ut(n,r[t],`"${t}" is prohibited for ref layers`))}),i.layers.forEach(e=>{qt(e.id)===a&&(t=e)}),t?t.ref?e.push(new Ut(n,r.ref,"ref cannot reference another ref layer")):s=qt(t.type):e.push(new Ut(n,r.ref,`ref layer "${a}" not found`))}else if("background"!==s&&"sky"!==s)if(r.source){const t=i.sources&&i.sources[r.source],o=t&&qt(t.type);t?"vector"===o&&"raster"===s?e.push(new Ut(n,r.source,`layer "${r.id}" requires a raster source`)):"raster"===o&&"raster"!==s?e.push(new Ut(n,r.source,`layer "${r.id}" requires a vector source`)):"vector"!==o||r["source-layer"]?"raster-dem"===o&&"hillshade"!==s?e.push(new Ut(n,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!r.paint||!r.paint["line-gradient"]||"geojson"===o&&t.lineMetrics||e.push(new Ut(n,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Ut(n,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Ut(n,r.source,`source "${r.source}" not found`))}else e.push(new Ut(n,r,'missing required property "source"'));return e=e.concat(_n({key:n,value:r,valueSpec:o.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Jn({key:`${n}.type`,value:r.type,valueSpec:o.layer.type,style:t.style,styleSpec:t.styleSpec,object:r,objectKey:"type"}),filter:t=>Fn(Gt({layerType:s},t)),layout:t=>_n({layer:r,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>Vn(Gt({layerType:s},t))}}),paint:t=>_n({layer:r,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>Un(Gt({layerType:s},t))}})}})),e}function qn(t){const e=t.value,r=t.key,n=tn(e);return"string"!==n?[new Ut(r,e,`string expected, ${n} found`)]:[]}const $n={promoteId:function({key:t,value:e}){if("string"===tn(e))return qn({key:t,value:e});{const r=[];for(const n in e)r.push(...qn({key:`${t}.${n}`,value:e[n]}));return r}}};function Zn(t){const e=t.value,r=t.key,n=t.styleSpec,i=t.style;if(!e.type)return[new Ut(r,e,'"type" is required')];const o=qt(e.type);let s;switch(o){case"vector":case"raster":case"raster-dem":return s=_n({key:r,value:e,valueSpec:n[`source_${o.replace("-","_")}`],style:t.style,styleSpec:n,objectElementValidators:$n}),s;case"geojson":if(s=_n({key:r,value:e,valueSpec:n.source_geojson,style:i,styleSpec:n,objectElementValidators:$n}),e.cluster)for(const t in e.clusterProperties){const[n,i]=e.clusterProperties[t],o="string"==typeof n?[n,["accumulated"],["get",t]]:n;s.push(...wn({key:`${r}.${t}.map`,value:i,expressionContext:"cluster-map"})),s.push(...wn({key:`${r}.${t}.reduce`,value:o,expressionContext:"cluster-reduce"}))}return s;case"video":return _n({key:r,value:e,valueSpec:n.source_video,style:i,styleSpec:n});case"image":return _n({key:r,value:e,valueSpec:n.source_image,style:i,styleSpec:n});case"canvas":return[new Ut(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Sn({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:i,styleSpec:n})}}function Xn(t){const e=t.value,r=t.styleSpec,n=r.light,i=t.style;let o=[];const s=tn(e);if(void 0===e)return o;if("object"!==s)return o=o.concat([new Ut("light",e,`object expected, ${s} found`)]),o;for(const a in e){const t=a.match(/^(.*)-transition$/);o=o.concat(t&&n[t[1]]&&n[t[1]].transition?Jn({key:a,value:e[a],valueSpec:r.transition,style:i,styleSpec:r}):n[a]?Jn({key:a,value:e[a],valueSpec:n[a],style:i,styleSpec:r}):[new Ut(a,e[a],`unknown property "${a}"`)])}return o}function Wn(t){const e=t.value,r=t.key,n=t.style,i=t.styleSpec,o=i.terrain;let s=[];const a=tn(e);if(void 0===e)return s;if("object"!==a)return s=s.concat([new Ut("terrain",e,`object expected, ${a} found`)]),s;for(const l in e){const t=l.match(/^(.*)-transition$/);s=s.concat(t&&o[t[1]]&&o[t[1]].transition?Jn({key:l,value:e[l],valueSpec:i.transition,style:n,styleSpec:i}):o[l]?Jn({key:l,value:e[l],valueSpec:o[l],style:n,styleSpec:i}):[new Ut(l,e[l],`unknown property "${l}"`)])}if(e.source){const t=n.sources&&n.sources[e.source],i=t&&qt(t.type);t?"raster-dem"!==i&&s.push(new Ut(r,e.source,`terrain cannot be used with a source of type ${i}, it only be used with a "raster-dem" source type`)):s.push(new Ut(r,e.source,`source "${e.source}" not found`))}else s.push(new Ut(r,e,'terrain is missing required property "source"'));return s}function Yn(t){const e=t.value,r=t.style,n=t.styleSpec,i=n.fog;let o=[];const s=tn(e);if(void 0===e)return o;if("object"!==s)return o=o.concat([new Ut("fog",e,`object expected, ${s} found`)]),o;for(const a in e){const t=a.match(/^(.*)-transition$/);o=o.concat(t&&i[t[1]]&&i[t[1]].transition?Jn({key:a,value:e[a],valueSpec:n.transition,style:r,styleSpec:n}):i[a]?Jn({key:a,value:e[a],valueSpec:i[a],style:r,styleSpec:n}):[new Ut(a,e[a],`unknown property "${a}"`)])}return o}const Hn={"*":()=>[],array:vn,boolean:function(t){const e=t.value,r=t.key,n=tn(e);return"boolean"!==n?[new Ut(r,e,`boolean expected, ${n} found`)]:[]},number:xn,color:function(t){const e=t.key,r=t.value,n=tn(r);return"string"!==n?[new Ut(e,r,`color expected, ${n} found`)]:null===he.parseCSSColor(r)?[new Ut(e,r,`color expected, "${r}" found`)]:[]},constants:Vt,enum:Sn,filter:Fn,function:bn,layer:Gn,object:_n,source:Zn,light:Xn,terrain:Wn,fog:Yn,string:qn,formatted:function(t){return 0===qn(t).length?[]:wn(t)},resolvedImage:function(t){return 0===qn(t).length?[]:wn(t)},projection:function(t){const e=t.value,r=t.styleSpec,n=r.projection,i=t.style;let o=[];const s=tn(e);if("object"===s)for(const a in e)o=o.concat(Jn({key:a,value:e[a],valueSpec:n[a],style:i,styleSpec:r}));else"string"!==s&&(o=o.concat([new Ut("projection",e,`object or string expected, ${s} found`)]));return o}};function Jn(t){const e=t.value,r=t.valueSpec,n=t.styleSpec;return r.expression&&en(qt(e))?bn(t):r.expression&&hn($t(e))?wn(t):r.type&&Hn[r.type]?Hn[r.type](t):_n(Gt({},t,{valueSpec:r.type?n[r.type]:r}))}function Kn(t){const e=t.value,r=t.key,n=qn(t);return n.length||(-1===e.indexOf("{fontstack}")&&n.push(new Ut(r,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&n.push(new Ut(r,e,'"glyphs" url must include a "{range}" token'))),n}function Qn(t,e=jt){let r=[];return r=r.concat(Jn({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Kn,"*":()=>[]}})),t.constants&&(r=r.concat(Vt({key:"constants",value:t.constants,style:t,styleSpec:e}))),ti(r)}function ti(t){return[].concat(t).sort((t,e)=>t.line-e.line)}function ei(t){return function(...e){return ti(t.apply(this,e))}}Qn.source=ei(Zn),Qn.light=ei(Xn),Qn.terrain=ei(Wn),Qn.fog=ei(Yn),Qn.layer=ei(Gn),Qn.filter=ei(Fn),Qn.paintProperty=ei(Un),Qn.layoutProperty=ei(Vn);const ri=Qn,ni=ri.light,ii=ri.fog,oi=ri.paintProperty,si=ri.layoutProperty;function ai(t,e){let r=!1;if(e&&e.length)for(const n of e)t.fire(new Ft(new Error(n.message))),r=!0;return r}var li=ui;function ui(t,e,r){var n=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var i=new Int32Array(this.arrayBuffer);t=i[0],this.d=(e=i[1])+2*(r=i[2]);for(var o=0;o<this.d*this.d;o++){var s=i[3+o],a=i[3+o+1];n.push(s===a?null:i.subarray(s,a))}var l=i[3+n.length+1];this.keys=i.subarray(i[3+n.length],l),this.bboxes=i.subarray(l),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var u=0;u<this.d*this.d;u++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=r,this.scale=e/t,this.uid=0;var c=r/e*t;this.min=-c,this.max=t+c}ui.prototype.insert=function(t,e,r,n,i){this._forEachCell(e,r,n,i,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(i)},ui.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ui.prototype._insertCell=function(t,e,r,n,i,o){this.cells[i].push(o)},ui.prototype.query=function(t,e,r,n,i){var o=this.min,s=this.max;if(t<=o&&e<=o&&s<=r&&s<=n&&!i)return Array.prototype.slice.call(this.keys);var a=[];return this._forEachCell(t,e,r,n,this._queryCell,a,{},i),a},ui.prototype._queryCell=function(t,e,r,n,i,o,s,a){var l=this.cells[i];if(null!==l)for(var u=this.keys,c=this.bboxes,h=0;h<l.length;h++){var p=l[h];if(void 0===s[p]){var f=4*p;(a?a(c[f+0],c[f+1],c[f+2],c[f+3]):t<=c[f+2]&&e<=c[f+3]&&r>=c[f+0]&&n>=c[f+1])?(s[p]=!0,o.push(u[p])):s[p]=!1}}},ui.prototype._forEachCell=function(t,e,r,n,i,o,s,a){for(var l=this._convertToCellCoord(t),u=this._convertToCellCoord(e),c=this._convertToCellCoord(r),h=this._convertToCellCoord(n),p=l;p<=c;p++)for(var f=u;f<=h;f++){var d=this.d*f+p;if((!a||a(this._convertFromCellCoord(p),this._convertFromCellCoord(f),this._convertFromCellCoord(p+1),this._convertFromCellCoord(f+1)))&&i.call(this,t,e,r,n,d,o,s,a))return}},ui.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},ui.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},ui.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,r=0,n=0;n<this.cells.length;n++)r+=this.cells[n].length;var i=new Int32Array(e+r+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;for(var o=e,s=0;s<t.length;s++){var a=t[s];i[3+s]=o,i.set(a,o),o+=a.length}return i[3+t.length]=o,i.set(this.keys,o),i[3+t.length+1]=o+=this.keys.length,i.set(this.bboxes,o),o+=this.bboxes.length,i.buffer};const ci={};function hi(t,e,r={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),ci[t]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}hi("Object",Object),li.serialize=function(t,e){const r=t.toArrayBuffer();return e&&e.push(r),{buffer:r}},li.deserialize=function(t){return new li(t.buffer)},hi("Grid",li),hi("Color",pe),hi("Error",Error),hi("ResolvedImage",ge),hi("StylePropertyFunction",gn),hi("StyleExpression",cn,{omit:["_evaluator"]}),hi("ZoomDependentExpression",dn),hi("ZoomConstantExpression",fn),hi("CompoundExpression",ke,{omit:["_evaluate"]});for(const ed in qr)qr[ed]._classRegistryKey||hi(`Expression_${ed}`,qr[ed]);function pi(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function fi(t){return s.ImageBitmap&&t instanceof s.ImageBitmap}function di(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(pi(t)||fi(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const r=t;return e&&e.push(r.buffer),r}if(t instanceof s.ImageData)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const r=[];for(const n of t)r.push(di(n,e));return r}if("object"==typeof t){const r=t.constructor,n=r._classRegistryKey;if(!n)throw new Error("can't serialize object of unregistered class");const i=r.serialize?r.serialize(t,e):{};if(!r.serialize){for(const r in t){if(!t.hasOwnProperty(r))continue;if(ci[n].omit.indexOf(r)>=0)continue;const o=t[r];i[r]=ci[n].shallow.indexOf(r)>=0?o:di(o,e)}t instanceof Error&&(i.message=t.message)}if(i.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==n&&(i.$name=n),i}throw new Error("can't serialize object of type "+typeof t)}function mi(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||pi(t)||fi(t)||ArrayBuffer.isView(t)||t instanceof s.ImageData)return t;if(Array.isArray(t))return t.map(mi);if("object"==typeof t){const e=t.$name||"Object",{klass:r}=ci[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(t);const n=Object.create(r.prototype);for(const i of Object.keys(t)){if("$name"===i)continue;const r=t[i];n[i]=ci[e].shallow.indexOf(i)>=0?r:mi(r)}return n}throw new Error("can't deserialize object of type "+typeof t)}class gi{constructor(){this.first=!0}update(t,e){const r=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=r,!0))}}const yi=t=>t>=1536&&t<=1791,_i=t=>t>=1872&&t<=1919,vi=t=>t>=2208&&t<=2303,xi=t=>t>=11904&&t<=12031,bi=t=>t>=12032&&t<=12255,wi=t=>t>=12272&&t<=12287,Ei=t=>t>=12288&&t<=12351,Si=t=>t>=12352&&t<=12447,Ii=t=>t>=12448&&t<=12543,Ti=t=>t>=12544&&t<=12591,Ci=t=>t>=12704&&t<=12735,Mi=t=>t>=12736&&t<=12783,Ai=t=>t>=12784&&t<=12799,Pi=t=>t>=12800&&t<=13055,ki=t=>t>=13056&&t<=13311,Li=t=>t>=13312&&t<=19903,zi=t=>t>=19968&&t<=40959,Di=t=>t>=40960&&t<=42127,Ri=t=>t>=42128&&t<=42191,Oi=t=>t>=44032&&t<=55215,Ni=t=>t>=63744&&t<=64255,Fi=t=>t>=64336&&t<=65023,Bi=t=>t>=65040&&t<=65055,ji=t=>t>=65072&&t<=65103,Ui=t=>t>=65104&&t<=65135,Vi=t=>t>=65136&&t<=65279,Gi=t=>t>=65280&&t<=65519;function qi(t){for(const e of t)if(Xi(e.charCodeAt(0)))return!0;return!1}function $i(t){for(const e of t)if(!Zi(e.charCodeAt(0)))return!1;return!0}function Zi(t){return!(yi(t)||_i(t)||vi(t)||Fi(t)||Vi(t))}function Xi(t){return!(746!==t&&747!==t&&(t<4352||!(Ci(t)||Ti(t)||ji(t)&&!(t>=65097&&t<=65103)||Ni(t)||ki(t)||xi(t)||Mi(t)||!(!Ei(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||Li(t)||zi(t)||Pi(t)||(t=>t>=12592&&t<=12687)(t)||(t=>t>=43360&&t<=43391)(t)||(t=>t>=55216&&t<=55295)(t)||(t=>t>=4352&&t<=4607)(t)||Oi(t)||Si(t)||wi(t)||(t=>t>=12688&&t<=12703)(t)||bi(t)||Ai(t)||Ii(t)&&12540!==t||!(!Gi(t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!Ui(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(t=>t>=5120&&t<=5759)(t)||(t=>t>=6320&&t<=6399)(t)||Bi(t)||(t=>t>=19904&&t<=19967)(t)||Di(t)||Ri(t))))}function Wi(t){return!(Xi(t)||function(t){return!!((t=>t>=128&&t<=255)(t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||(t=>t>=8192&&t<=8303)(t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||(t=>t>=8448&&t<=8527)(t)||(t=>t>=8528&&t<=8591)(t)||(t=>t>=8960&&t<=9215)(t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||(t=>t>=9216&&t<=9279)(t)&&9251!==t||(t=>t>=9280&&t<=9311)(t)||(t=>t>=9312&&t<=9471)(t)||(t=>t>=9632&&t<=9727)(t)||(t=>t>=9728&&t<=9983)(t)&&!(t>=9754&&t<=9759)||(t=>t>=11008&&t<=11263)(t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Ei(t)||Ii(t)||(t=>t>=57344&&t<=63743)(t)||ji(t)||Ui(t)||Gi(t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function Yi(t){return t>=1424&&t<=2303||Fi(t)||Vi(t)}function Hi(t,e){return!(!e&&Yi(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||(t=>t>=6016&&t<=6143)(t))}function Ji(t){for(const e of t)if(Yi(e.charCodeAt(0)))return!0;return!1}const Ki="deferred",Qi="loading",to="loaded";let eo=null,ro="unavailable",no=null;const io=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(ro="error"),eo&&eo(t)};function oo(){so.fire(new Nt("pluginStateChange",{pluginStatus:ro,pluginURL:no}))}const so=new Bt,ao=function(){return ro},lo=function(){if(ro!==Ki||!no)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ro=Qi,oo(),no&&Ct({url:no},t=>{t?io(t):(ro=to,oo())})},uo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ro===to||null!=uo.applyArabicShaping,isLoading:()=>ro===Qi,setState(t){ro=t.pluginStatus,no=t.pluginURL},isParsed:()=>null!=uo.applyArabicShaping&&null!=uo.processBidirectionalText&&null!=uo.processStyledBidirectionalText,getPluginURL:()=>no};class co{constructor(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition,this.pitch=e.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new gi,this.transition={},this.pitch=0)}isSupportedScript(t){return function(t,e){for(const r of t)if(!Hi(r.charCodeAt(0),e))return!1;return!0}(t,uo.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,e=t-Math.floor(t),r=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*e}}}class ho{constructor(t,e){this.property=t,this.value=e,this.expression=function(t,e){if(en(t))return new gn(t,e);if(hn(t)){const r=mn(t,e);if("error"===r.result)throw new Error(r.value.map(t=>`${t.key}: ${t.message}`).join(", "));return r.value}{let r=t;return"string"==typeof t&&"color"===e.type&&(r=pe.parse(t)),{kind:"constant",evaluate:()=>r}}}(void 0===e?t.specification.default:e,t.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,e,r){return this.property.possiblyEvaluate(this,t,e,r)}}class po{constructor(t){this.property=t,this.value=new ho(t,void 0)}transitioned(t,e){return new mo(this.property,this.value,e,x({},t.transition,this.transition),t.now)}untransitioned(){return new mo(this.property,this.value,null,{},0)}}class fo{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return P(this._values[t].value.value)}setValue(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new po(this._values[t].property)),this._values[t].value=new ho(this._values[t].property,null===e?void 0:P(e))}getTransition(t){return P(this._values[t].transition)}setTransition(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new po(this._values[t].property)),this._values[t].transition=P(e)||void 0}serialize(){const t={};for(const e of Object.keys(this._values)){const r=this.getValue(e);void 0!==r&&(t[e]=r);const n=this.getTransition(e);void 0!==n&&(t[`${e}-transition`]=n)}return t}transitioned(t,e){const r=new go(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].transitioned(t,e._values[n]);return r}untransitioned(){const t=new go(this._properties);for(const e of Object.keys(this._values))t._values[e]=this._values[e].untransitioned();return t}}class mo{constructor(t,e,r,n,i){const o=n.delay||0,s=n.duration||0;i=i||0,this.property=t,this.value=e,this.begin=i+o,this.end=this.begin+s,t.specification.transition&&(n.delay||n.duration)&&(this.prior=r)}possiblyEvaluate(t,e,r){const n=t.now||0,i=this.value.possiblyEvaluate(t,e,r),o=this.prior;if(o){if(n>this.end)return this.prior=null,i;if(this.value.isDataDriven())return this.prior=null,i;if(n<this.begin)return o.possiblyEvaluate(t,e,r);{const s=(n-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(t,e,r),i,p(s))}}return i}}class go{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,e,r){const n=new vo(this._properties);for(const i of Object.keys(this._values))n._values[i]=this._values[i].possiblyEvaluate(t,e,r);return n}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class yo{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return P(this._values[t].value)}setValue(t,e){this._values[t]=new ho(this._values[t].property,null===e?void 0:P(e))}serialize(){const t={};for(const e of Object.keys(this._values)){const r=this.getValue(e);void 0!==r&&(t[e]=r)}return t}possiblyEvaluate(t,e,r){const n=new vo(this._properties);for(const i of Object.keys(this._values))n._values[i]=this._values[i].possiblyEvaluate(t,e,r);return n}}class _o{constructor(t,e,r){this.property=t,this.value=e,this.parameters=r}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,e,r,n){return this.property.evaluate(this.value,this.parameters,t,e,r,n)}}class vo{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class xo{constructor(t){this.specification=t}possiblyEvaluate(t,e){return t.expression.evaluate(e)}interpolate(t,e,r){const n=or[this.specification.type];return n?n(t,e,r):t}}class bo{constructor(t,e){this.specification=t,this.overrides=e}possiblyEvaluate(t,e,r,n){return new _o(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},r,n)}:t.expression,e)}interpolate(t,e,r){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new _o(this,{kind:"constant",value:void 0},t.parameters);const n=or[this.specification.type];return n?new _o(this,{kind:"constant",value:n(t.value.value,e.value.value,r)},t.parameters):t}evaluate(t,e,r,n,i,o){return"constant"===t.kind?t.value:t.evaluate(e,r,n,i,o)}}class wo extends bo{possiblyEvaluate(t,e,r,n){if(void 0===t.value)return new _o(this,{kind:"constant",value:void 0},e);if("constant"===t.expression.kind){const i=t.expression.evaluate(e,null,{},r,n),o="resolvedImage"===t.property.specification.type&&"string"!=typeof i?i.name:i,s=this._calculate(o,o,o,e);return new _o(this,{kind:"constant",value:s},e)}if("camera"===t.expression.kind){const r=this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);return new _o(this,{kind:"constant",value:r},e)}return new _o(this,t.expression,e)}evaluate(t,e,r,n,i,o){if("source"===t.kind){const s=t.evaluate(e,r,n,i,o);return this._calculate(s,s,s,e)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(e.zoom)-1},r,n),t.evaluate({zoom:Math.floor(e.zoom)},r,n),t.evaluate({zoom:Math.floor(e.zoom)+1},r,n),e):t.value}_calculate(t,e,r,n){return n.zoom>n.zoomHistory.lastIntegerZoom?{from:t,to:e,other:r}:{from:r,to:e,other:t}}interpolate(t){return t}}class Eo{constructor(t){this.specification=t}possiblyEvaluate(t,e,r,n){if(void 0!==t.value){if("constant"===t.expression.kind){const i=t.expression.evaluate(e,null,{},r,n);return this._calculate(i,i,i,e)}return this._calculate(t.expression.evaluate(new co(Math.floor(e.zoom-1),e)),t.expression.evaluate(new co(Math.floor(e.zoom),e)),t.expression.evaluate(new co(Math.floor(e.zoom+1),e)),e)}}_calculate(t,e,r,n){return n.zoom>n.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:r,to:e}}interpolate(t){return t}}class So{constructor(t){this.specification=t}possiblyEvaluate(t,e,r,n){return!!t.expression.evaluate(e,null,{},r,n)}interpolate(){return!1}}class Io{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const e in t){const r=t[e];r.specification.overridable&&this.overridableProperties.push(e);const n=this.defaultPropertyValues[e]=new ho(r,void 0),i=this.defaultTransitionablePropertyValues[e]=new po(r);this.defaultTransitioningPropertyValues[e]=i.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=n.possiblyEvaluate({})}}}function To(t,e){return 256*(t=m(Math.floor(t),0,255))+m(Math.floor(e),0,255)}hi("DataDrivenProperty",bo),hi("DataConstantProperty",xo),hi("CrossFadedDataDrivenProperty",wo),hi("CrossFadedProperty",Eo),hi("ColorRampProperty",So);const Co={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Mo{constructor(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ao{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Po(t,e=1){let r=0,n=0;return{members:t.map(t=>{const i=Co[t.type].BYTES_PER_ELEMENT,o=r=ko(r,Math.max(e,i)),s=t.components||1;return n=Math.max(n,i),r+=i*s,{name:t.name,type:t.type,components:s,offset:o}}),size:ko(r,Math.max(n,e)),alignment:e}}function ko(t,e){return Math.ceil(t/e)*e}class Lo extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e){const r=this.length;return this.resize(r+1),this.emplace(r,t,e)}emplace(t,e,r){const n=2*t;return this.int16[n+0]=e,this.int16[n+1]=r,t}}Lo.prototype.bytesPerElement=4,hi("StructArrayLayout2i4",Lo);class zo extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,r,n){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,r,n)}emplace(t,e,r,n,i){const o=4*t;return this.int16[o+0]=e,this.int16[o+1]=r,this.int16[o+2]=n,this.int16[o+3]=i,t}}zo.prototype.bytesPerElement=8,hi("StructArrayLayout4i8",zo);class Do extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,r,n,i,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,r,n,i,o,s)}emplace(t,e,r,n,i,o,s,a){const l=6*t,u=12*t,c=3*t;return this.int16[l+0]=e,this.int16[l+1]=r,this.uint8[u+4]=n,this.uint8[u+5]=i,this.uint8[u+6]=o,this.uint8[u+7]=s,this.float32[c+2]=a,t}}Do.prototype.bytesPerElement=12,hi("StructArrayLayout2i4ub1f12",Do);class Ro extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,r){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,r)}emplace(t,e,r,n){const i=3*t;return this.float32[i+0]=e,this.float32[i+1]=r,this.float32[i+2]=n,t}}Ro.prototype.bytesPerElement=12,hi("StructArrayLayout3f12",Ro);class Oo extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,r,n,i,o,s,a,l,u){const c=this.length;return this.resize(c+1),this.emplace(c,t,e,r,n,i,o,s,a,l,u)}emplace(t,e,r,n,i,o,s,a,l,u,c){const h=10*t;return this.uint16[h+0]=e,this.uint16[h+1]=r,this.uint16[h+2]=n,this.uint16[h+3]=i,this.uint16[h+4]=o,this.uint16[h+5]=s,this.uint16[h+6]=a,this.uint16[h+7]=l,this.uint16[h+8]=u,this.uint16[h+9]=c,t}}Oo.prototype.bytesPerElement=20,hi("StructArrayLayout10ui20",Oo);class No extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,r,n,i,o,s,a){const l=this.length;return this.resize(l+1),this.emplace(l,t,e,r,n,i,o,s,a)}emplace(t,e,r,n,i,o,s,a,l){const u=8*t;return this.uint16[u+0]=e,this.uint16[u+1]=r,this.uint16[u+2]=n,this.uint16[u+3]=i,this.uint16[u+4]=o,this.uint16[u+5]=s,this.uint16[u+6]=a,this.uint16[u+7]=l,t}}No.prototype.bytesPerElement=16,hi("StructArrayLayout8ui16",No);class Fo extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,r,n,i,o,s,a,l,u,c,h,p,f,d,m){const g=this.length;return this.resize(g+1),this.emplace(g,t,e,r,n,i,o,s,a,l,u,c,h,p,f,d,m)}emplace(t,e,r,n,i,o,s,a,l,u,c,h,p,f,d,m,g){const y=16*t;return this.int16[y+0]=e,this.int16[y+1]=r,this.int16[y+2]=n,this.int16[y+3]=i,this.uint16[y+4]=o,this.uint16[y+5]=s,this.uint16[y+6]=a,this.uint16[y+7]=l,this.int16[y+8]=u,this.int16[y+9]=c,this.int16[y+10]=h,this.int16[y+11]=p,this.int16[y+12]=f,this.int16[y+13]=d,this.int16[y+14]=m,this.int16[y+15]=g,t}}Fo.prototype.bytesPerElement=32,hi("StructArrayLayout4i4ui4i4i32",Fo);class Bo extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint32[1*t+0]=e,t}}Bo.prototype.bytesPerElement=4,hi("StructArrayLayout1ul4",Bo);class jo extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,r,n,i,o,s,a,l,u,c,h,p){const f=this.length;return this.resize(f+1),this.emplace(f,t,e,r,n,i,o,s,a,l,u,c,h,p)}emplace(t,e,r,n,i,o,s,a,l,u,c,h,p,f){const d=20*t,m=10*t;return this.int16[d+0]=e,this.int16[d+1]=r,this.int16[d+2]=n,this.int16[d+3]=i,this.int16[d+4]=o,this.float32[m+3]=s,this.float32[m+4]=a,this.float32[m+5]=l,this.float32[m+6]=u,this.int16[d+14]=c,this.uint32[m+8]=h,this.uint16[d+18]=p,this.uint16[d+19]=f,t}}jo.prototype.bytesPerElement=40,hi("StructArrayLayout5i4f1i1ul2ui40",jo);class Uo extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,r,n,i,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,r,n,i,o,s)}emplace(t,e,r,n,i,o,s,a){const l=8*t;return this.int16[l+0]=e,this.int16[l+1]=r,this.int16[l+2]=n,this.int16[l+4]=i,this.int16[l+5]=o,this.int16[l+6]=s,this.int16[l+7]=a,t}}Uo.prototype.bytesPerElement=16,hi("StructArrayLayout3i2i2i16",Uo);class Vo extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,r,n,i){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,r,n,i)}emplace(t,e,r,n,i,o){const s=4*t,a=8*t;return this.float32[s+0]=e,this.float32[s+1]=r,this.float32[s+2]=n,this.int16[a+6]=i,this.int16[a+7]=o,t}}Vo.prototype.bytesPerElement=16,hi("StructArrayLayout2f1f2i16",Vo);class Go extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,r,n){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,r,n)}emplace(t,e,r,n,i){const o=12*t,s=3*t;return this.uint8[o+0]=e,this.uint8[o+1]=r,this.float32[s+1]=n,this.float32[s+2]=i,t}}Go.prototype.bytesPerElement=12,hi("StructArrayLayout2ub2f12",Go);class qo extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,r){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,r)}emplace(t,e,r,n){const i=3*t;return this.uint16[i+0]=e,this.uint16[i+1]=r,this.uint16[i+2]=n,t}}qo.prototype.bytesPerElement=6,hi("StructArrayLayout3ui6",qo);class $o extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,e,r,n,i,o,s,a,l,u,c,h,p,f,d,m,g,y,_,v,x){const b=this.length;return this.resize(b+1),this.emplace(b,t,e,r,n,i,o,s,a,l,u,c,h,p,f,d,m,g,y,_,v,x)}emplace(t,e,r,n,i,o,s,a,l,u,c,h,p,f,d,m,g,y,_,v,x,b){const w=30*t,E=15*t,S=60*t;return this.int16[w+0]=e,this.int16[w+1]=r,this.int16[w+2]=n,this.float32[E+2]=i,this.float32[E+3]=o,this.uint16[w+8]=s,this.uint16[w+9]=a,this.uint32[E+5]=l,this.uint32[E+6]=u,this.uint32[E+7]=c,this.uint16[w+16]=h,this.uint16[w+17]=p,this.uint16[w+18]=f,this.float32[E+10]=d,this.float32[E+11]=m,this.uint8[S+48]=g,this.uint8[S+49]=y,this.uint8[S+50]=_,this.uint32[E+13]=v,this.int16[w+28]=x,this.uint8[S+58]=b,t}}$o.prototype.bytesPerElement=60,hi("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",$o);class Zo extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,e,r,n,i,o,s,a,l,u,c,h,p,f,d,m,g,y,_,v,x,b,w,E,S,I,T,C,M,A){const P=this.length;return this.resize(P+1),this.emplace(P,t,e,r,n,i,o,s,a,l,u,c,h,p,f,d,m,g,y,_,v,x,b,w,E,S,I,T,C,M,A)}emplace(t,e,r,n,i,o,s,a,l,u,c,h,p,f,d,m,g,y,_,v,x,b,w,E,S,I,T,C,M,A,P){const k=38*t,L=19*t;return this.int16[k+0]=e,this.int16[k+1]=r,this.int16[k+2]=n,this.float32[L+2]=i,this.float32[L+3]=o,this.int16[k+8]=s,this.int16[k+9]=a,this.int16[k+10]=l,this.int16[k+11]=u,this.int16[k+12]=c,this.int16[k+13]=h,this.uint16[k+14]=p,this.uint16[k+15]=f,this.uint16[k+16]=d,this.uint16[k+17]=m,this.uint16[k+18]=g,this.uint16[k+19]=y,this.uint16[k+20]=_,this.uint16[k+21]=v,this.uint16[k+22]=x,this.uint16[k+23]=b,this.uint16[k+24]=w,this.uint16[k+25]=E,this.uint16[k+26]=S,this.uint16[k+27]=I,this.uint16[k+28]=T,this.uint32[L+15]=C,this.float32[L+16]=M,this.float32[L+17]=A,this.float32[L+18]=P,t}}Zo.prototype.bytesPerElement=76,hi("StructArrayLayout3i2f6i15ui1ul3f76",Zo);class Xo extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.float32[1*t+0]=e,t}}Xo.prototype.bytesPerElement=4,hi("StructArrayLayout1f4",Xo);class Wo extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,r){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,r)}emplace(t,e,r,n){const i=3*t;return this.int16[i+0]=e,this.int16[i+1]=r,this.int16[i+2]=n,t}}Wo.prototype.bytesPerElement=6,hi("StructArrayLayout3i6",Wo);class Yo extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,r,n,i,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,r,n,i,o,s)}emplace(t,e,r,n,i,o,s,a){const l=7*t;return this.float32[l+0]=e,this.float32[l+1]=r,this.float32[l+2]=n,this.float32[l+3]=i,this.float32[l+4]=o,this.float32[l+5]=s,this.float32[l+6]=a,t}}Yo.prototype.bytesPerElement=28,hi("StructArrayLayout7f28",Yo);class Ho extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,r,n){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,r,n)}emplace(t,e,r,n,i){const o=6*t;return this.uint32[3*t+0]=e,this.uint16[o+2]=r,this.uint16[o+3]=n,this.uint16[o+4]=i,t}}Ho.prototype.bytesPerElement=12,hi("StructArrayLayout1ul3ui12",Ho);class Jo extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e){const r=this.length;return this.resize(r+1),this.emplace(r,t,e)}emplace(t,e,r){const n=2*t;return this.uint16[n+0]=e,this.uint16[n+1]=r,t}}Jo.prototype.bytesPerElement=4,hi("StructArrayLayout2ui4",Jo);class Ko extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint16[1*t+0]=e,t}}Ko.prototype.bytesPerElement=2,hi("StructArrayLayout1ui2",Ko);class Qo extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e){const r=this.length;return this.resize(r+1),this.emplace(r,t,e)}emplace(t,e,r){const n=2*t;return this.float32[n+0]=e,this.float32[n+1]=r,t}}Qo.prototype.bytesPerElement=8,hi("StructArrayLayout2f8",Qo);class ts extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,r,n){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,r,n)}emplace(t,e,r,n,i){const o=4*t;return this.float32[o+0]=e,this.float32[o+1]=r,this.float32[o+2]=n,this.float32[o+3]=i,t}}ts.prototype.bytesPerElement=16,hi("StructArrayLayout4f16",ts);class es extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,r,n,i,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,r,n,i,o,s)}emplace(t,e,r,n,i,o,s,a){const l=8*t,u=4*t;return this.int16[l+0]=e,this.int16[l+1]=r,this.int16[l+2]=n,this.int16[l+3]=i,this.int16[l+4]=o,this.int16[l+5]=s,this.float32[u+3]=a,t}}es.prototype.bytesPerElement=16,hi("StructArrayLayout6i1f16",es);class rs extends Mo{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}rs.prototype.size=40;class ns extends jo{get(t){return new rs(this,t)}}hi("CollisionBoxArray",ns);class is extends Mo{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}is.prototype.size=60;class os extends $o{get(t){return new is(this,t)}}hi("PlacedSymbolArray",os);class ss extends Mo{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(t){this._structArray.uint32[this._pos4+15]=t}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}ss.prototype.size=76;class as extends Zo{get(t){return new ss(this,t)}}hi("SymbolInstanceArray",as);class ls extends Xo{getoffsetX(t){return this.float32[1*t+0]}}hi("GlyphOffsetArray",ls);class us extends Wo{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}hi("SymbolLineVertexArray",us);class cs extends Mo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}cs.prototype.size=12;class hs extends Ho{get(t){return new cs(this,t)}}hi("FeatureIndexArray",hs);class ps extends Mo{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}ps.prototype.size=4;class fs extends Jo{get(t){return new ps(this,t)}}hi("FillExtrusionCentroidArray",fs);class ds extends Mo{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}get a_scale(){return this._structArray.float32[this._pos4+3]}}ds.prototype.size=16;class ms extends es{get(t){return new ds(this,t)}}hi("CircleGlobeExtArray",ms);const gs=Po([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),ys=Po([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var _s=ce(function(t){t.exports=function(t,e){var r,n,i,o,s,a,l,u;for(n=t.length-(r=3&t.length),i=e,s=3432918353,a=461845907,u=0;u<n;)l=255&t.charCodeAt(u)|(255&t.charCodeAt(++u))<<8|(255&t.charCodeAt(++u))<<16|(255&t.charCodeAt(++u))<<24,++u,i=27492+(65535&(o=5*(65535&(i=(i^=l=(65535&(l=(l=(65535&l)*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,r){case 3:l^=(255&t.charCodeAt(u+2))<<16;case 2:l^=(255&t.charCodeAt(u+1))<<8;case 1:i^=l=(65535&(l=(l=(65535&(l^=255&t.charCodeAt(u)))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return i^=t.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}}),vs=ce(function(t){t.exports=function(t,e){for(var r,n=t.length,i=e^n,o=0;n>=4;)r=1540483477*(65535&(r=255&t.charCodeAt(o)|(255&t.charCodeAt(++o))<<8|(255&t.charCodeAt(++o))<<16|(255&t.charCodeAt(++o))<<24))+((1540483477*(r>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),n-=4,++o;switch(n){case 3:i^=(255&t.charCodeAt(o+2))<<16;case 2:i^=(255&t.charCodeAt(o+1))<<8;case 1:i=1540483477*(65535&(i^=255&t.charCodeAt(o)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}}),xs=_s,bs=vs;xs.murmur3=_s,xs.murmur2=bs;class ws{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,e,r,n){this.ids.push(Es(t)),this.positions.push(e,r,n)}getPositions(t){const e=Es(t);let r=0,n=this.ids.length-1;for(;r<n;){const t=r+n>>1;this.ids[t]>=e?n=t:r=t+1}const i=[];for(;this.ids[r]===e;)i.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return i}static serialize(t,e){const r=new Float64Array(t.ids),n=new Uint32Array(t.positions);return Ss(r,n,0,r.length-1),e&&e.push(r.buffer,n.buffer),{ids:r,positions:n}}static deserialize(t){const e=new ws;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e}}function Es(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:xs(String(t))}function Ss(t,e,r,n){for(;r<n;){const i=t[r+n>>1];let o=r-1,s=n+1;for(;;){do{o++}while(t[o]<i);do{s--}while(t[s]>i);if(o>=s)break;Is(t,o,s),Is(e,3*o,3*s),Is(e,3*o+1,3*s+1),Is(e,3*o+2,3*s+2)}s-r<n-s?(Ss(t,e,r,s),r=s+1):(Ss(t,e,s+1,n),n=s)}}function Is(t,e,r){const n=t[e];t[e]=t[r],t[r]=n}hi("FeaturePositionMap",ws);class Ts{constructor(t,e){this.gl=t.gl,this.location=e}}class Cs extends Ts{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Ms extends Ts{constructor(t,e){super(t,e),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class As extends Ts{constructor(t,e){super(t,e),this.current=pe.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Ps=new Float32Array(16),ks=new Float32Array(9),Ls=new Float32Array(4);function zs(t){return[To(255*t.r,255*t.g),To(255*t.b,255*t.a)]}class Ds{constructor(t,e,r){this.value=t,this.uniformNames=e.map(t=>`u_${t}`),this.type=r}setUniform(t,e,r){t.set(r.constantOr(this.value))}getBinding(t,e,r){return"color"===this.type?new As(t,e):new Cs(t,e)}}class Rs{constructor(t,e){this.uniformNames=e.map(t=>`u_${t}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,e){this.pixelRatioFrom=e.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=e.tl.concat(e.br),this.patternTo=t.tl.concat(t.br)}setUniform(t,e,r,n){const i="u_pattern_to"===n||"u_dash_to"===n?this.patternTo:"u_pattern_from"===n||"u_dash_from"===n?this.patternFrom:"u_pixel_ratio_to"===n?this.pixelRatioTo:"u_pixel_ratio_from"===n?this.pixelRatioFrom:null;i&&t.set(i)}getBinding(t,e,r){return"u_pattern_from"===r||"u_pattern_to"===r||"u_dash_from"===r||"u_dash_to"===r?new Ms(t,e):new Cs(t,e)}}class Os{constructor(t,e,r,n){this.expression=t,this.type=r,this.maxValue=0,this.paintVertexAttributes=e.map(t=>({name:`a_${t}`,type:"Float32",components:"color"===r?2:1,offset:0})),this.paintVertexArray=new n}populatePaintArray(t,e,r,n,i,o){const s=this.paintVertexArray.length,a=this.expression.evaluate(new co(0),e,{},i,n,o);this.paintVertexArray.resize(t),this._setPaintValue(s,t,a)}updatePaintArray(t,e,r,n,i){const o=this.expression.evaluate({zoom:0},r,n,void 0,i);this._setPaintValue(t,e,o)}_setPaintValue(t,e,r){if("color"===this.type){const n=zs(r);for(let r=t;r<e;r++)this.paintVertexArray.emplace(r,n[0],n[1])}else{for(let n=t;n<e;n++)this.paintVertexArray.emplace(n,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ns{constructor(t,e,r,n,i,o){this.expression=t,this.uniformNames=e.map(t=>`u_${t}_t`),this.type=r,this.useIntegerZoom=n,this.zoom=i,this.maxValue=0,this.paintVertexAttributes=e.map(t=>({name:`a_${t}`,type:"Float32",components:"color"===r?4:2,offset:0})),this.paintVertexArray=new o}populatePaintArray(t,e,r,n,i,o){const s=this.expression.evaluate(new co(this.zoom),e,{},i,n,o),a=this.expression.evaluate(new co(this.zoom+1),e,{},i,n,o),l=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(l,t,s,a)}updatePaintArray(t,e,r,n,i){const o=this.expression.evaluate({zoom:this.zoom},r,n,void 0,i),s=this.expression.evaluate({zoom:this.zoom+1},r,n,void 0,i);this._setPaintValue(t,e,o,s)}_setPaintValue(t,e,r,n){if("color"===this.type){const i=zs(r),o=zs(n);for(let r=t;r<e;r++)this.paintVertexArray.emplace(r,i[0],i[1],o[0],o[1])}else{for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,r,n);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(n))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,e){const r=this.useIntegerZoom?Math.floor(e.zoom):e.zoom,n=m(this.expression.interpolationFactor(r,this.zoom,this.zoom+1),0,1);t.set(n)}getBinding(t,e,r){return new Cs(t,e)}}class Fs{constructor(t,e,r,n,i,o,s){this.expression=t,this.type=r,this.useIntegerZoom=n,this.zoom=i,this.layerId=s,this.paintVertexAttributes=("array"===r?ys:gs).members;for(let a=0;a<e.length;++a);this.zoomInPaintVertexArray=new o,this.zoomOutPaintVertexArray=new o}populatePaintArray(t,e,r){const n=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(n,t,e.patterns&&e.patterns[this.layerId],r)}updatePaintArray(t,e,r,n,i,o){this._setPaintValues(t,e,r.patterns&&r.patterns[this.layerId],o)}_setPaintValues(t,e,r,n){if(!n||!r)return;const{min:i,mid:o,max:s}=r,a=n[i],l=n[o],u=n[s];if(a&&l&&u)for(let c=t;c<e;c++)this._setPaintValue(this.zoomInPaintVertexArray,c,l,a),this._setPaintValue(this.zoomOutPaintVertexArray,c,l,u)}_setPaintValue(t,e,r,n){t.emplace(e,r.tl[0],r.tl[1],r.br[0],r.br[1],n.tl[0],n.tl[1],n.br[0],n.br[1],r.pixelRatio,n.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Bs{constructor(t,e,r=(()=>!0)){this.binders={},this._buffers=[];const n=[];for(const i in t.paint._values){if(!r(i))continue;const o=t.paint.get(i);if(!(o instanceof _o&&Jr(o.property.specification)))continue;const s=Vs(i,t.type),a=o.value,l=o.property.specification.type,u=o.property.useIntegerZoom,c=o.property.specification["property-type"],h="cross-faded"===c||"cross-faded-data-driven"===c,p="line-dasharray"===String(i)&&"constant"!==t.layout.get("line-cap").value.kind;if("constant"!==a.kind||p)if("source"===a.kind||p||h){const r=$s(i,l,"source");this.binders[i]=h?new Fs(a,s,l,u,e,r,t.id):new Os(a,s,l,r),n.push(`/a_${i}`)}else{const t=$s(i,l,"composite");this.binders[i]=new Ns(a,s,l,u,e,t),n.push(`/z_${i}`)}else this.binders[i]=h?new Rs(a.value,s):new Ds(a.value,s,l),n.push(`/u_${i}`)}this.cacheKey=n.sort().join("")}getMaxValue(t){const e=this.binders[t];return e instanceof Os||e instanceof Ns?e.maxValue:0}populatePaintArrays(t,e,r,n,i,o){for(const s in this.binders){const a=this.binders[s];(a instanceof Os||a instanceof Ns||a instanceof Fs)&&a.populatePaintArray(t,e,r,n,i,o)}}setConstantPatternPositions(t,e){for(const r in this.binders){const n=this.binders[r];n instanceof Rs&&n.setConstantPatternPositions(t,e)}}updatePaintArrays(t,e,r,n,i,o){let s=!1;for(const a in t){const l=e.getPositions(a);for(const e of l){const l=r.feature(e.index);for(const r in this.binders){const u=this.binders[r];if((u instanceof Os||u instanceof Ns||u instanceof Fs)&&!0===u.expression.isStateDependent){const c=n.paint.get(r);u.expression=c.value,u.updatePaintArray(e.start,e.end,l,t[a],i,o),s=!0}}}}return s}defines(){const t=[];for(const e in this.binders){const r=this.binders[e];(r instanceof Ds||r instanceof Rs)&&t.push(...r.uniformNames.map(t=>`#define HAS_UNIFORM_${t}`))}return t}getBinderAttributes(){const t=[];for(const e in this.binders){const r=this.binders[e];if(r instanceof Os||r instanceof Ns||r instanceof Fs)for(let e=0;e<r.paintVertexAttributes.length;e++)t.push(r.paintVertexAttributes[e].name)}return t}getBinderUniforms(){const t=[];for(const e in this.binders){const r=this.binders[e];if(r instanceof Ds||r instanceof Rs||r instanceof Ns)for(const e of r.uniformNames)t.push(e)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,e){const r=[];for(const n in this.binders){const i=this.binders[n];if(i instanceof Ds||i instanceof Rs||i instanceof Ns)for(const o of i.uniformNames)if(e[o]){const s=i.getBinding(t,e[o],o);r.push({name:o,property:n,binding:s})}}return r}setUniforms(t,e,r,n){for(const{name:i,property:o,binding:s}of e)this.binders[o].setUniform(s,n,r.get(o),i)}updatePaintBuffers(t){this._buffers=[];for(const e in this.binders){const r=this.binders[e];if(t&&r instanceof Fs){const e=2===t.fromScale?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer;e&&this._buffers.push(e)}else(r instanceof Os||r instanceof Ns)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(t){for(const e in this.binders){const r=this.binders[e];(r instanceof Os||r instanceof Ns||r instanceof Fs)&&r.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const e=this.binders[t];(e instanceof Os||e instanceof Ns||e instanceof Fs)&&e.destroy()}}}class js{constructor(t,e,r=(()=>!0)){this.programConfigurations={};for(const n of t)this.programConfigurations[n.id]=new Bs(n,e,r);this.needsUpload=!1,this._featureMap=new ws,this._bufferOffset=0}populatePaintArrays(t,e,r,n,i,o,s){for(const a in this.programConfigurations)this.programConfigurations[a].populatePaintArrays(t,e,n,i,o,s);void 0!==e.id&&this._featureMap.add(e.id,r,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,e,r,n,i){for(const o of r)this.needsUpload=this.programConfigurations[o.id].updatePaintArrays(t,this._featureMap,e,o,n,i)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const Us={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function Vs(t,e){return Us[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const Gs={"line-pattern":{source:Oo,composite:Oo},"fill-pattern":{source:Oo,composite:Oo},"fill-extrusion-pattern":{source:Oo,composite:Oo},"line-dasharray":{source:No,composite:No}},qs={color:{source:Qo,composite:ts},number:{source:Xo,composite:Qo}};function $s(t,e,r){const n=Gs[t];return n&&n[r]||qs[e][r]}hi("ConstantBinder",Ds),hi("CrossFadedConstantBinder",Rs),hi("SourceExpressionBinder",Os),hi("CrossFadedCompositeBinder",Fs),hi("CompositeExpressionBinder",Ns),hi("ProgramConfiguration",Bs,{omit:["_buffers"]}),hi("ProgramConfigurationSet",js);const Zs="-transition";class Xs extends Bt{constructor(t,e){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==t.type&&(this.metadata=(t=t).metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&"sky"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),e.layout&&(this._unevaluatedLayout=new yo(e.layout)),e.paint)){this._transitionablePaint=new fo(e.paint);for(const e in t.paint)this.setPaintProperty(e,t.paint[e],{validate:!1});for(const e in t.layout)this.setLayoutProperty(e,t.layout[e],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new vo(e.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,e,r={}){null!=e&&this._validate(si,`layers.${this.id}.layout.${t}`,t,e,r)||("visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility=e)}getPaintProperty(t){return C(t,Zs)?this._transitionablePaint.getTransition(t.slice(0,-Zs.length)):this._transitionablePaint.getValue(t)}setPaintProperty(t,e,r={}){if(null!=e&&this._validate(oi,`layers.${this.id}.paint.${t}`,t,e,r))return!1;if(C(t,Zs))return this._transitionablePaint.setTransition(t.slice(0,-Zs.length),e||void 0),!1;{const r=this._transitionablePaint._values[t],n="cross-faded-data-driven"===r.property.specification["property-type"],i=r.value.isDataDriven(),o=r.value;this._transitionablePaint.setValue(t,e),this._handleSpecialPaintPropertyUpdate(t);const s=this._transitionablePaint._values[t].value;return s.isDataDriven()||i||n||this._handleOverridablePaintPropertyUpdate(t,o,s)}}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getProgramConfiguration(t){return null}_handleOverridablePaintPropertyUpdate(t,e,r){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,e){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,e)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),A(t,(t,e)=>!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length))}_validate(t,e,r,n,i={}){return(!i||!1!==i.validate)&&ai(this,t.call(ri,{key:e,layerType:this.type,objectKey:r,value:n,styleSpec:jt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const e=this.paint.get(t);if(e instanceof _o&&Jr(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Tn(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Ws=Po([{name:"a_pos",components:2,type:"Int16"}],4),Ys=Po([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"},{name:"a_scale",components:1,type:"Float32"}]);class Hs{constructor(t=[]){this.segments=t}prepareSegment(t,e,r,n){let i=this.segments[this.segments.length-1];return t>Hs.MAX_VERTEX_ARRAY_LENGTH&&L(`Max vertices per segment is ${Hs.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!i||i.vertexLength+t>Hs.MAX_VERTEX_ARRAY_LENGTH||i.sortKey!==n)&&(i={vertexOffset:e.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},void 0!==n&&(i.sortKey=n),this.segments.push(i)),i}get(){return this.segments}destroy(){for(const t of this.segments)for(const e in t.vaos)t.vaos[e].destroy()}static simpleSegment(t,e,r,n){return new Hs([{vertexOffset:t,primitiveOffset:e,vertexLength:r,primitiveLength:n,vaos:{},sortKey:0}])}}Hs.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,hi("SegmentVector",Hs);var Js=8192;class Ks{constructor(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof ta?new ta(t.lng,t.lat):ta.convert(t),this}setSouthWest(t){return this._sw=t instanceof ta?new ta(t.lng,t.lat):ta.convert(t),this}extend(t){const e=this._sw,r=this._ne;let n,i;if(t instanceof ta)n=t,i=t;else{if(!(t instanceof Ks))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(Ks.convert(t)):this.extend(ta.convert(t)):this;if(n=t._sw,i=t._ne,!n||!i)return this}return e||r?(e.lng=Math.min(n.lng,e.lng),e.lat=Math.min(n.lat,e.lat),r.lng=Math.max(i.lng,r.lng),r.lat=Math.max(i.lat,r.lat)):(this._sw=new ta(n.lng,n.lat),this._ne=new ta(i.lng,i.lat)),this}getCenter(){return new ta((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ta(this.getWest(),this.getNorth())}getSouthEast(){return new ta(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:e,lat:r}=ta.convert(t);let n=this._sw.lng<=e&&e<=this._ne.lng;return this._sw.lng>this._ne.lng&&(n=this._sw.lng>=e&&e>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&n}static convert(t){return!t||t instanceof Ks?t:new Ks(t)}}const Qs=6371008.8;class ta{constructor(t,e){if(isNaN(t)||isNaN(e))throw new Error(`Invalid LngLat object: (${t}, ${e})`);if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ta(y(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const e=Math.PI/180,r=this.lat*e,n=t.lat*e,i=Math.sin(r)*Math.sin(n)+Math.cos(r)*Math.cos(n)*Math.cos((t.lng-this.lng)*e);return Qs*Math.acos(Math.min(i,1))}toBounds(t=0){const e=360*t/40075017,r=e/Math.cos(Math.PI/180*this.lat);return new Ks(new ta(this.lng-r,this.lat-e),new ta(this.lng+r,this.lat+e))}static convert(t){if(t instanceof ta)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new ta(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new ta(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const ea=2*Math.PI*Qs;function ra(t){return ea*Math.cos(t*Math.PI/180)}function na(t){return(180+t)/360}function ia(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function oa(t,e){return t/ra(e)}function sa(t){return 360*t-180}function aa(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function la(t,e){return t*ra(aa(e))}const ua=85.051129;class ca{constructor(t,e,r=0){this.x=+t,this.y=+e,this.z=+r}static fromLngLat(t,e=0){const r=ta.convert(t);return new ca(na(r.lng),ia(r.lat),oa(e,r.lat))}toLngLat(){return new ta(sa(this.x),aa(this.y))}toAltitude(){return la(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ea*(t=aa(this.y),1/Math.cos(t*Math.PI/180));var t}}function ha(t,e,r,n,o,s,a,l,u){const c=(e+n)/2,h=(r+o)/2,p=new i(c,h);l(p),function(t,e,r,n,i,o){const s=r-i,a=n-o;return Math.abs((n-e)*s-(r-t)*a)/Math.hypot(s,a)}(p.x,p.y,s.x,s.y,a.x,a.y)>=u?(ha(t,e,r,c,h,s,p,l,u),ha(t,c,h,n,o,p,a,l,u)):t.push(a)}function pa(t,e,r){let n=t[0],i=n.x,o=n.y;e(n);const s=[n];for(let a=1;a<t.length;a++){const l=t[a],{x:u,y:c}=l;e(l),ha(s,i,o,u,c,n,l,e,r),i=u,o=c,n=l}return s}const fa=Math.pow(2,14)-1,da=-fa-1;function ma(t,e){const r=Math.round(t.x*e),n=Math.round(t.y*e);return t.x=m(r,da,fa),t.y=m(n,da,fa),(r<t.x||r>t.x+1||n<t.y||n>t.y+1)&&L("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function ga(t,e,r){const n=t.loadGeometry(),i=t.extent,o=Js/i;if(e&&r&&r.projection.isReprojectedInTileSpace){const o=1<<e.z,{scale:s,x:a,y:l,projection:u}=r,c=t=>{const r=sa((e.x+t.x/i)/o),n=aa((e.y+t.y/i)/o),c=u.project(r,n);t.x=(c.x*s-a)*i,t.y=(c.y*s-l)*i};for(let e=0;e<n.length;e++)if(1!==t.type)n[e]=pa(n[e],c,1);else{const t=[];for(const r of n[e])r.x<0||r.x>=i||r.y<0||r.y>=i||(c(r),t.push(r));n[e]=t}}for(const s of n)for(const t of s)ma(t,o);return n}function ya(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?ga(t):[]}}function _a(t,e,r,n,i){t.emplaceBack(2*e+(n+1)/2,2*r+(i+1)/2)}function va(t,e,r,n){const i=16384;t.emplaceBack(e.x,e.y,e.z,r[0]*i,r[1]*i,r[2]*i,n)}class xa{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Lo,this.indexArray=new qo,this.segments=new Hs,this.programConfigurations=new js(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(t,e,r,n){const i=this.layers[0],o=[];let s=null;"circle"===i.type&&(s=i.layout.get("circle-sort-key"));for(const{feature:l,id:u,index:c,sourceLayerIndex:h}of t){const t=this.layers[0]._featureFilter.needGeometry,e=ya(l,t);if(!this.layers[0]._featureFilter.filter(new co(this.zoom),e,r))continue;const i=s?s.evaluate(e,{},r):void 0,a={id:u,properties:l.properties,type:l.type,sourceLayerIndex:h,index:c,geometry:t?e.geometry:ga(l,r,n),patterns:{},sortKey:i};o.push(a)}s&&o.sort((t,e)=>t.sortKey-e.sortKey);let a=null;"globe"===n.projection.name&&(this.globeExtVertexArray=new ms,a=n.projection);for(const l of o){const{geometry:n,index:i,sourceLayerIndex:o}=l,s=t[i].feature;this.addFeature(l,n,i,e.availableImages,r,a),e.featureIndex.insert(s,n,i,o,this.index)}}update(t,e,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ws.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,Ys.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,e,r,n,i,o){for(const s of e)for(const e of s){const r=e.x,n=e.y;if(r<0||r>=Js||n<0||n>=Js)continue;if(o){const t=o.projectTilePoint(r,n,i),e=o.upVector(i,r,n),s=aa((n/Js+i.y)/(1<<i.z)),a=o.pixelsPerMeter(s,1)/oa(1,s),l=this.globeExtVertexArray;va(l,t,e,a),va(l,t,e,a),va(l,t,e,a),va(l,t,e,a)}const s=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),a=s.vertexLength;_a(this.layoutVertexArray,r,n,-1,-1),_a(this.layoutVertexArray,r,n,1,-1),_a(this.layoutVertexArray,r,n,1,1),_a(this.layoutVertexArray,r,n,-1,1),this.indexArray.emplaceBack(a,a+1,a+2),this.indexArray.emplaceBack(a,a+3,a+2),s.vertexLength+=4,s.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,{},n,i)}}function ba(t,e){for(let r=0;r<t.length;r++)if(Pa(e,t[r]))return!0;for(let r=0;r<e.length;r++)if(Pa(t,e[r]))return!0;return!!Ia(t,e)}function wa(t,e,r){return!!Pa(t,e)||!!Ca(e,t,r)}function Ea(t,e){if(1===t.length)return Aa(e,t[0]);for(let r=0;r<e.length;r++){const n=e[r];for(let e=0;e<n.length;e++)if(Pa(t,n[e]))return!0}for(let r=0;r<t.length;r++)if(Aa(e,t[r]))return!0;for(let r=0;r<e.length;r++)if(Ia(t,e[r]))return!0;return!1}function Sa(t,e,r){if(t.length>1){if(Ia(t,e))return!0;for(let n=0;n<e.length;n++)if(Ca(e[n],t,r))return!0}for(let n=0;n<t.length;n++)if(Ca(t[n],e,r))return!0;return!1}function Ia(t,e){if(0===t.length||0===e.length)return!1;for(let r=0;r<t.length-1;r++){const n=t[r],i=t[r+1];for(let t=0;t<e.length-1;t++)if(Ta(n,i,e[t],e[t+1]))return!0}return!1}function Ta(t,e,r,n){return z(t,r,n)!==z(e,r,n)&&z(t,e,r)!==z(t,e,n)}function Ca(t,e,r){const n=r*r;if(1===e.length)return t.distSqr(e[0])<n;for(let i=1;i<e.length;i++)if(Ma(t,e[i-1],e[i])<n)return!0;return!1}function Ma(t,e,r){const n=e.distSqr(r);if(0===n)return t.distSqr(e);const i=((t.x-e.x)*(r.x-e.x)+(t.y-e.y)*(r.y-e.y))/n;return t.distSqr(i<0?e:i>1?r:r.sub(e)._mult(i)._add(e))}function Aa(t,e){let r,n,i,o=!1;for(let s=0;s<t.length;s++){r=t[s];for(let t=0,s=r.length-1;t<r.length;s=t++)n=r[t],i=r[s],n.y>e.y!=i.y>e.y&&e.x<(i.x-n.x)*(e.y-n.y)/(i.y-n.y)+n.x&&(o=!o)}return o}function Pa(t,e){let r=!1;for(let n=0,i=t.length-1;n<t.length;i=n++){const o=t[n],s=t[i];o.y>e.y!=s.y>e.y&&e.x<(s.x-o.x)*(e.y-o.y)/(s.y-o.y)+o.x&&(r=!r)}return r}function ka(t,e,r,n,o){for(const i of t)if(e<=i.x&&r<=i.y&&n>=i.x&&o>=i.y)return!0;const s=[new i(e,r),new i(e,o),new i(n,o),new i(n,r)];if(t.length>2)for(const i of s)if(Pa(t,i))return!0;for(let i=0;i<t.length-1;i++)if(La(t[i],t[i+1],s))return!0;return!1}function La(t,e,r){const n=r[0],i=r[2];if(t.x<n.x&&e.x<n.x||t.x>i.x&&e.x>i.x||t.y<n.y&&e.y<n.y||t.y>i.y&&e.y>i.y)return!1;const o=z(t,e,r[0]);return o!==z(t,e,r[1])||o!==z(t,e,r[2])||o!==z(t,e,r[3])}function za(t,e,r){const n=e.paint.get(t).value;return"constant"===n.kind?n.value:r.programConfigurations.get(e.id).getMaxValue(t)}function Da(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Ra(t,e,r,n,o){if(!e[0]&&!e[1])return t;const s=i.convert(e)._mult(o);"viewport"===r&&s._rotate(-n);const a=[];for(let i=0;i<t.length;i++)a.push(t[i].sub(s));return a}function Oa(t,e,r,n){const o=i.convert(t)._mult(n);return"viewport"===e&&o._rotate(-r),o}hi("CircleBucket",xa,{omit:["layers"]});const Na=new Io({"circle-sort-key":new bo(jt.layout_circle["circle-sort-key"])});var Fa={paint:new Io({"circle-radius":new bo(jt.paint_circle["circle-radius"]),"circle-color":new bo(jt.paint_circle["circle-color"]),"circle-blur":new bo(jt.paint_circle["circle-blur"]),"circle-opacity":new bo(jt.paint_circle["circle-opacity"]),"circle-translate":new xo(jt.paint_circle["circle-translate"]),"circle-translate-anchor":new xo(jt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new xo(jt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new xo(jt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new bo(jt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new bo(jt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new bo(jt.paint_circle["circle-stroke-opacity"])}),layout:Na},Ba=1e-6,ja="undefined"!=typeof Float32Array?Float32Array:Array;function Ua(){var t=new ja(9);return ja!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Va(){var t=new ja(16);return ja!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Ga(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function qa(t,e,r){var n=e[0],i=e[1],o=e[2],s=e[3],a=e[4],l=e[5],u=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],m=e[12],g=e[13],y=e[14],_=e[15],v=r[0],x=r[1],b=r[2],w=r[3];return t[0]=v*n+x*a+b*h+w*m,t[1]=v*i+x*l+b*p+w*g,t[2]=v*o+x*u+b*f+w*y,t[3]=v*s+x*c+b*d+w*_,t[4]=(v=r[4])*n+(x=r[5])*a+(b=r[6])*h+(w=r[7])*m,t[5]=v*i+x*l+b*p+w*g,t[6]=v*o+x*u+b*f+w*y,t[7]=v*s+x*c+b*d+w*_,t[8]=(v=r[8])*n+(x=r[9])*a+(b=r[10])*h+(w=r[11])*m,t[9]=v*i+x*l+b*p+w*g,t[10]=v*o+x*u+b*f+w*y,t[11]=v*s+x*c+b*d+w*_,t[12]=(v=r[12])*n+(x=r[13])*a+(b=r[14])*h+(w=r[15])*m,t[13]=v*i+x*l+b*p+w*g,t[14]=v*o+x*u+b*f+w*y,t[15]=v*s+x*c+b*d+w*_,t}function $a(t,e,r){var n,i,o,s,a,l,u,c,h,p,f,d,m=r[0],g=r[1],y=r[2];return e===t?(t[12]=e[0]*m+e[4]*g+e[8]*y+e[12],t[13]=e[1]*m+e[5]*g+e[9]*y+e[13],t[14]=e[2]*m+e[6]*g+e[10]*y+e[14],t[15]=e[3]*m+e[7]*g+e[11]*y+e[15]):(i=e[1],o=e[2],s=e[3],a=e[4],l=e[5],u=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],t[0]=n=e[0],t[1]=i,t[2]=o,t[3]=s,t[4]=a,t[5]=l,t[6]=u,t[7]=c,t[8]=h,t[9]=p,t[10]=f,t[11]=d,t[12]=n*m+a*g+h*y+e[12],t[13]=i*m+l*g+p*y+e[13],t[14]=o*m+u*g+f*y+e[14],t[15]=s*m+c*g+d*y+e[15]),t}function Za(t,e,r){var n=r[0],i=r[1],o=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Xa(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[4],s=e[5],a=e[6],l=e[7],u=e[8],c=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+u*n,t[5]=s*i+c*n,t[6]=a*i+h*n,t[7]=l*i+p*n,t[8]=u*i-o*n,t[9]=c*i-s*n,t[10]=h*i-a*n,t[11]=p*i-l*n,t}function Wa(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[0],s=e[1],a=e[2],l=e[3],u=e[8],c=e[9],h=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-u*n,t[1]=s*i-c*n,t[2]=a*i-h*n,t[3]=l*i-p*n,t[8]=o*n+u*i,t[9]=s*n+c*i,t[10]=a*n+h*i,t[11]=l*n+p*i,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Ya=qa;function Ha(){var t=new ja(3);return ja!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Ja(t){var e=new ja(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Ka(t){return Math.hypot(t[0],t[1],t[2])}function Qa(t,e,r){var n=new ja(3);return n[0]=t,n[1]=e,n[2]=r,n}function tl(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function el(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function rl(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function nl(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function il(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function ol(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t}function sl(t,e){var r=e[0],n=e[1],i=e[2],o=r*r+n*n+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function al(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ll(t,e,r){var n=e[0],i=e[1],o=e[2],s=r[0],a=r[1],l=r[2];return t[0]=i*l-o*a,t[1]=o*s-n*l,t[2]=n*a-i*s,t}function ul(t,e,r){var n=e[0],i=e[1],o=e[2],s=r[3]*n+r[7]*i+r[11]*o+r[15];return t[0]=(r[0]*n+r[4]*i+r[8]*o+r[12])/(s=s||1),t[1]=(r[1]*n+r[5]*i+r[9]*o+r[13])/s,t[2]=(r[2]*n+r[6]*i+r[10]*o+r[14])/s,t}function cl(t,e,r){var n=r[0],i=r[1],o=r[2],s=e[0],a=e[1],l=e[2],u=i*l-o*a,c=o*s-n*l,h=n*a-i*s,p=i*h-o*c,f=o*u-n*h,d=n*c-i*u,m=2*r[3];return c*=m,h*=m,f*=2,d*=2,t[0]=s+(u*=m)+(p*=2),t[1]=a+c+f,t[2]=l+h+d,t}var hl,pl=el,fl=rl,dl=Ka;function ml(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function gl(t,e,r){var n=e[0],i=e[1],o=e[2],s=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*s,t[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*s,t[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*s,t[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*s,t}function yl(){var t=new ja(4);return ja!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function _l(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function vl(t,e,r){r*=.5;var n=e[0],i=e[1],o=e[2],s=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=n*l+s*a,t[1]=i*l+o*a,t[2]=o*l-i*a,t[3]=s*l-n*a,t}function xl(t,e){return t[0]===e[0]&&t[1]===e[1]}Ha(),hl=new ja(4),ja!=Float32Array&&(hl[0]=0,hl[1]=0,hl[2]=0,hl[3]=0),Ha(),Qa(1,0,0),Qa(0,1,0),yl(),yl(),Ua(),function(){var t;t=new ja(2),ja!=Float32Array&&(t[0]=0,t[1]=0)}();class bl{constructor(t,e){this.pos=t,this.dir=e}intersectsPlane(t,e,r){const n=al(e,this.dir);if(Math.abs(n)<1e-6)return!1;const i=((t[0]-this.pos[0])*e[0]+(t[1]-this.pos[1])*e[1]+(t[2]-this.pos[2])*e[2])/n;return r[0]=this.pos[0]+this.dir[0]*i,r[1]=this.pos[1]+this.dir[1]*i,r[2]=this.pos[2]+this.dir[2]*i,!0}closestPointOnSphere(t,e,r){if(function(t,e){var r=t[0],n=t[1],i=t[2],o=e[0],s=e[1],a=e[2];return Math.abs(r-o)<=Ba*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-s)<=Ba*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-a)<=Ba*Math.max(1,Math.abs(i),Math.abs(a))}(this.pos,t)||0===e)return r[0]=r[1]=r[2]=0,!1;const[n,i,o]=this.dir,s=this.pos[0]-t[0],a=this.pos[1]-t[1],l=this.pos[2]-t[2],u=n*n+i*i+o*o,c=2*(s*n+a*i+l*o),h=c*c-4*u*(s*s+a*a+l*l-e*e);if(h<0){const t=Math.max(-c/2,0),u=s+n*t,h=a+i*t,p=l+o*t,f=Math.hypot(u,h,p);return r[0]=u*e/f,r[1]=h*e/f,r[2]=p*e/f,!1}{const t=(-c-Math.sqrt(h))/(2*u);if(t<0){const t=Math.hypot(s,a,l);return r[0]=s*e/t,r[1]=a*e/t,r[2]=l*e/t,!1}return r[0]=s+n*t,r[1]=a+i*t,r[2]=l+o*t,!0}}}class wl{constructor(t,e){this.points=t,this.planes=e}static fromInvProjectionMatrix(t,e,r,n){const i=Math.pow(2,r),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(r=>{const o=gl([],r,t),s=1/o[3]/e*i;return function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}(o,o,[s,s,n?1/o[3]:s,s])}),s=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(t=>{const e=sl([],ll([],pl([],o[t[0]],o[t[1]]),pl([],o[t[2]],o[t[1]]))),r=-al(e,o[t[1]]);return e.concat(r)});return new wl(o,s)}}class El{constructor(t,e){this.min=t,this.max=e,this.center=il([],tl([],this.min,this.max),.5)}quadrant(t){const e=[t%2==0,t<2],r=Ja(this.min),n=Ja(this.max);for(let i=0;i<e.length;i++)r[i]=e[i]?this.min[i]:this.center[i],n[i]=e[i]?this.center[i]:this.max[i];return n[2]=this.max[2],new El(r,n)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,e=this.max;return[[t[0],t[1],t[2]],[e[0],t[1],t[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],e[2]],[t[0],e[1],e[2]]]}intersects(t){const e=this.getCorners();let r=!0;for(let n=0;n<t.planes.length;n++){const i=t.planes[n];let o=0;for(let t=0;t<e.length;t++)o+=al(i,e[t])+i[3]>=0;if(0===o)return 0;o!==e.length&&(r=!1)}if(r)return 2;for(let n=0;n<3;n++){let e=Number.MAX_VALUE,r=-Number.MAX_VALUE;for(let i=0;i<t.points.length;i++){const o=t.points[i][n]-this.min[n];e=Math.min(e,o),r=Math.max(r,o)}if(r<0||e>this.max[n]-this.min[n])return 0}return 1}}function Sl(t,e,r,n,i,o,s,a,l){if(o&&t.queryGeometry.isAboveHorizon)return!1;o&&(l*=t.pixelToTileUnitsFactor);for(const u of e)for(const e of u){const u=e.add(a),c=i&&r.elevation?r.elevation.exaggeration()*i.getElevationAt(u.x,u.y,!0):0,h=o?u:Il(u,c,n),p=o?t.tilespaceRays.map(t=>Ml(t,c)):t.queryGeometry.screenGeometry,f=gl([],[e.x,e.y,c,1],n);if(!s&&o?l*=f[3]/r.cameraToCenterDistance:s&&!o&&(l*=r.cameraToCenterDistance/f[3]),wa(p,h,l))return!0}return!1}function Il(t,e,r){const n=gl([],[t.x,t.y,e,1],r);return new i(n[0]/n[3],n[1]/n[3])}const Tl=Qa(0,0,0),Cl=Qa(0,0,1);function Ml(t,e){const r=Ha();return Tl[2]=e,t.intersectsPlane(Tl,Cl,r),new i(r[0],r[1])}class Al extends xa{}function Pl(t,{width:e,height:r},n,i){if(i){if(i instanceof Uint8ClampedArray)i=new Uint8Array(i.buffer);else if(i.length!==e*r*n)throw new RangeError("mismatched image size")}else i=new Uint8Array(e*r*n);return t.width=e,t.height=r,t.data=i,t}function kl(t,e,r){const{width:n,height:i}=e;n===t.width&&i===t.height||(Ll(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,n),height:Math.min(t.height,i)},r),t.width=n,t.height=i,t.data=e.data)}function Ll(t,e,r,n,i,o){if(0===i.width||0===i.height)return e;if(i.width>t.width||i.height>t.height||r.x>t.width-i.width||r.y>t.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>e.width||i.height>e.height||n.x>e.width-i.width||n.y>e.height-i.height)throw new RangeError("out of range destination coordinates for image copy");const s=t.data,a=e.data;for(let l=0;l<i.height;l++){const u=((r.y+l)*t.width+r.x)*o,c=((n.y+l)*e.width+n.x)*o;for(let t=0;t<i.width*o;t++)a[c+t]=s[u+t]}return e}hi("HeatmapBucket",Al,{omit:["layers"]});class zl{constructor(t,e){Pl(this,t,1,e)}resize(t){kl(this,new zl(t),1)}clone(){return new zl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,r,n,i){Ll(t,e,r,n,i,1)}}class Dl{constructor(t,e){Pl(this,t,4,e)}resize(t){kl(this,new Dl(t),4)}replace(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Dl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,r,n,i){Ll(t,e,r,n,i,4)}}hi("AlphaImage",zl),hi("RGBAImage",Dl);var Rl={paint:new Io({"heatmap-radius":new bo(jt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new bo(jt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new xo(jt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new So(jt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new xo(jt.paint_heatmap["heatmap-opacity"])})};function Ol(t){const e={},r=t.resolution||256,n=t.clips?t.clips.length:1,i=t.image||new Dl({width:r,height:n}),o=(r,n,o)=>{e[t.evaluationKey]=o;const s=t.expression.evaluate(e);i.data[r+n+0]=Math.floor(255*s.r/s.a),i.data[r+n+1]=Math.floor(255*s.g/s.a),i.data[r+n+2]=Math.floor(255*s.b/s.a),i.data[r+n+3]=Math.floor(255*s.a)};if(t.clips)for(let s=0,a=0;s<n;++s,a+=4*r)for(let e=0,n=0;e<r;e++,n+=4){const i=e/(r-1),{start:l,end:u}=t.clips[s];o(a,n,l*(1-i)+u*i)}else for(let s=0,a=0;s<r;s++,a+=4)o(0,a,s/(r-1));return i}var Nl={paint:new Io({"hillshade-illumination-direction":new xo(jt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new xo(jt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new xo(jt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new xo(jt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new xo(jt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new xo(jt.paint_hillshade["hillshade-accent-color"])})};const Fl=Po([{name:"a_pos",components:2,type:"Int16"}],4),{members:Bl}=Fl;var jl=Vl,Ul=Vl;function Vl(t,e,r){r=r||2;var n,i,o,s,a,l,u,c=e&&e.length,h=c?e[0]*r:t.length,p=Gl(t,0,h,r,!0),f=[];if(!p||p.next===p.prev)return f;if(c&&(p=function(t,e,r,n){var i,o,s,a=[];for(i=0,o=e.length;i<o;i++)(s=Gl(t,e[i]*n,i<o-1?e[i+1]*n:t.length,n,!1))===s.next&&(s.steiner=!0),a.push(tu(s));for(a.sort(Hl),i=0;i<a.length;i++)r=ql(r=Jl(a[i],r),r.next);return r}(t,e,p,r)),t.length>80*r){n=o=t[0],i=s=t[1];for(var d=r;d<h;d+=r)(a=t[d])<n&&(n=a),(l=t[d+1])<i&&(i=l),a>o&&(o=a),l>s&&(s=l);u=0!==(u=Math.max(o-n,s-i))?1/u:0}return $l(p,f,r,n,i,u),f}function Gl(t,e,r,n,i){var o,s;if(i===fu(t,e,r,n)>0)for(o=e;o<r;o+=n)s=cu(o,t[o],t[o+1],s);else for(o=r-n;o>=e;o-=n)s=cu(o,t[o],t[o+1],s);return s&&iu(s,s.next)&&(hu(s),s=s.next),s}function ql(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!iu(n,n.next)&&0!==nu(n.prev,n,n.next))n=n.next;else{if(hu(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function $l(t,e,r,n,i,o,s){if(t){!s&&o&&function(t,e,r,n){var i=t;do{null===i.z&&(i.z=Ql(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,r,n,i,o,s,a,l,u=1;do{for(r=t,t=null,o=null,s=0;r;){for(s++,n=r,a=0,e=0;e<u&&(a++,n=n.nextZ);e++);for(l=u;a>0||l>0&&n;)0!==a&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,a--):(i=n,n=n.nextZ,l--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;r=n}o.nextZ=null,u*=2}while(s>1)}(i)}(t,n,i,o);for(var a,l,u=t;t.prev!==t.next;)if(a=t.prev,l=t.next,o?Xl(t,n,i,o):Zl(t))e.push(a.i/r),e.push(t.i/r),e.push(l.i/r),hu(t),t=l.next,u=l.next;else if((t=l)===u){s?1===s?$l(t=Wl(ql(t),e,r),e,r,n,i,o,2):2===s&&Yl(t,e,r,n,i,o):$l(ql(t),e,r,n,i,o,1);break}}}function Zl(t){var e=t.prev,r=t,n=t.next;if(nu(e,r,n)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(eu(e.x,e.y,r.x,r.y,n.x,n.y,i.x,i.y)&&nu(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Xl(t,e,r,n){var i=t.prev,o=t,s=t.next;if(nu(i,o,s)>=0)return!1;for(var a=i.x>o.x?i.x>s.x?i.x:s.x:o.x>s.x?o.x:s.x,l=i.y>o.y?i.y>s.y?i.y:s.y:o.y>s.y?o.y:s.y,u=Ql(i.x<o.x?i.x<s.x?i.x:s.x:o.x<s.x?o.x:s.x,i.y<o.y?i.y<s.y?i.y:s.y:o.y<s.y?o.y:s.y,e,r,n),c=Ql(a,l,e,r,n),h=t.prevZ,p=t.nextZ;h&&h.z>=u&&p&&p.z<=c;){if(h!==t.prev&&h!==t.next&&eu(i.x,i.y,o.x,o.y,s.x,s.y,h.x,h.y)&&nu(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,p!==t.prev&&p!==t.next&&eu(i.x,i.y,o.x,o.y,s.x,s.y,p.x,p.y)&&nu(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;h&&h.z>=u;){if(h!==t.prev&&h!==t.next&&eu(i.x,i.y,o.x,o.y,s.x,s.y,h.x,h.y)&&nu(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;p&&p.z<=c;){if(p!==t.prev&&p!==t.next&&eu(i.x,i.y,o.x,o.y,s.x,s.y,p.x,p.y)&&nu(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function Wl(t,e,r){var n=t;do{var i=n.prev,o=n.next.next;!iu(i,o)&&ou(i,n,n.next,o)&&lu(i,o)&&lu(o,i)&&(e.push(i.i/r),e.push(n.i/r),e.push(o.i/r),hu(n),hu(n.next),n=t=o),n=n.next}while(n!==t);return ql(n)}function Yl(t,e,r,n,i,o){var s=t;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&ru(s,a)){var l=uu(s,a);return s=ql(s,s.next),l=ql(l,l.next),$l(s,e,r,n,i,o),void $l(l,e,r,n,i,o)}a=a.next}s=s.next}while(s!==t)}function Hl(t,e){return t.x-e.x}function Jl(t,e){var r=function(t,e){var r,n=e,i=t.x,o=t.y,s=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var a=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=i&&a>s){if(s=a,a===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!r)return null;if(i===s)return r;var l,u=r,c=r.x,h=r.y,p=1/0;n=r;do{i>=n.x&&n.x>=c&&i!==n.x&&eu(o<h?i:s,o,c,h,o<h?s:i,o,n.x,n.y)&&(l=Math.abs(o-n.y)/(i-n.x),lu(n,t)&&(l<p||l===p&&(n.x>r.x||n.x===r.x&&Kl(r,n)))&&(r=n,p=l)),n=n.next}while(n!==u);return r}(t,e);if(!r)return e;var n=uu(r,t),i=ql(r,r.next);return ql(n,n.next),e===r?i:e}function Kl(t,e){return nu(t.prev,t,e.prev)<0&&nu(e.next,t,t.next)<0}function Ql(t,e,r,n,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function tu(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function eu(t,e,r,n,i,o,s,a){return(i-s)*(e-a)-(t-s)*(o-a)>=0&&(t-s)*(n-a)-(r-s)*(e-a)>=0&&(r-s)*(o-a)-(i-s)*(n-a)>=0}function ru(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&ou(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(lu(t,e)&&lu(e,t)&&function(t,e){var r=t,n=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)&&(nu(t.prev,t,e.prev)||nu(t,e.prev,e))||iu(t,e)&&nu(t.prev,t,t.next)>0&&nu(e.prev,e,e.next)>0)}function nu(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function iu(t,e){return t.x===e.x&&t.y===e.y}function ou(t,e,r,n){var i=au(nu(t,e,r)),o=au(nu(t,e,n)),s=au(nu(r,n,t)),a=au(nu(r,n,e));return i!==o&&s!==a||!(0!==i||!su(t,r,e))||!(0!==o||!su(t,n,e))||!(0!==s||!su(r,t,n))||!(0!==a||!su(r,e,n))}function su(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function au(t){return t>0?1:t<0?-1:0}function lu(t,e){return nu(t.prev,t,t.next)<0?nu(t,e,t.next)>=0&&nu(t,t.prev,e)>=0:nu(t,e,t.prev)<0||nu(t,t.next,e)<0}function uu(t,e){var r=new pu(t.i,t.x,t.y),n=new pu(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function cu(t,e,r,n){var i=new pu(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function hu(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function pu(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function fu(t,e,r,n){for(var i=0,o=e,s=r-n;o<r;o+=n)i+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return i}function du(t,e,r,n,i){mu(t,e,r||0,n||t.length-1,i||yu)}function mu(t,e,r,n,i){for(;n>r;){if(n-r>600){var o=n-r+1,s=e-r+1,a=Math.log(o),l=.5*Math.exp(2*a/3),u=.5*Math.sqrt(a*l*(o-l)/o)*(s-o/2<0?-1:1);mu(t,e,Math.max(r,Math.floor(e-s*l/o+u)),Math.min(n,Math.floor(e+(o-s)*l/o+u)),i)}var c=t[e],h=r,p=n;for(gu(t,r,e),i(t[n],c)>0&&gu(t,r,n);h<p;){for(gu(t,h,p),h++,p--;i(t[h],c)<0;)h++;for(;i(t[p],c)>0;)p--}0===i(t[r],c)?gu(t,r,p):gu(t,++p,n),p<=e&&(r=p+1),e<=p&&(n=p-1)}}function gu(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function yu(t,e){return t<e?-1:t>e?1:0}function _u(t,e){const r=t.length;if(r<=1)return[t];const n=[];let i,o;for(let s=0;s<r;s++){const e=D(t[s]);0!==e&&(t[s].area=Math.abs(e),void 0===o&&(o=e<0),o===e<0?(i&&n.push(i),i=[t[s]]):i.push(t[s]))}if(i&&n.push(i),e>1)for(let s=0;s<n.length;s++)n[s].length<=e||(du(n[s],e,1,n[s].length-1,vu),n[s]=n[s].slice(0,e));return n}function vu(t,e){return e.area-t.area}function xu(t,e,r){const n=r.patternDependencies;let i=!1;for(const o of e){const e=o.paint.get(`${t}-pattern`);e.isConstant()||(i=!0);const r=e.constantOr(null);r&&(i=!0,n[r.to]=!0,n[r.from]=!0)}return i}function bu(t,e,r,n,i){const o=i.patternDependencies;for(const s of e){const e=s.paint.get(`${t}-pattern`).value;if("constant"!==e.kind){let t=e.evaluate({zoom:n-1},r,{},i.availableImages),a=e.evaluate({zoom:n},r,{},i.availableImages),l=e.evaluate({zoom:n+1},r,{},i.availableImages);t=t&&t.name?t.name:t,a=a&&a.name?a.name:a,l=l&&l.name?l.name:l,o[t]=!0,o[a]=!0,o[l]=!0,r.patterns[s.id]={min:t,mid:a,max:l}}}return r}Vl.deviation=function(t,e,r,n){var i=e&&e.length,o=Math.abs(fu(t,0,i?e[0]*r:t.length,r));if(i)for(var s=0,a=e.length;s<a;s++)o-=Math.abs(fu(t,e[s]*r,s<a-1?e[s+1]*r:t.length,r));var l=0;for(s=0;s<n.length;s+=3){var u=n[s]*r,c=n[s+1]*r,h=n[s+2]*r;l+=Math.abs((t[u]-t[h])*(t[c+1]-t[u+1])-(t[u]-t[c])*(t[h+1]-t[u+1]))}return 0===o&&0===l?0:Math.abs((l-o)/o)},Vl.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var s=0;s<e;s++)r.vertices.push(t[i][o][s]);i>0&&r.holes.push(n+=t[i-1].length)}return r},jl.default=Ul;class wu{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Lo,this.indexArray=new qo,this.indexArray2=new Jo,this.programConfigurations=new js(t.layers,t.zoom),this.segments=new Hs,this.segments2=new Hs,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(t,e,r,n){this.hasPattern=xu("fill",this.layers,e);const i=this.layers[0].layout.get("fill-sort-key"),o=[];for(const{feature:s,id:a,index:l,sourceLayerIndex:u}of t){const t=this.layers[0]._featureFilter.needGeometry,c=ya(s,t);if(!this.layers[0]._featureFilter.filter(new co(this.zoom),c,r))continue;const h=i?i.evaluate(c,{},r,e.availableImages):void 0,p={id:a,properties:s.properties,type:s.type,sourceLayerIndex:u,index:l,geometry:t?c.geometry:ga(s,r,n),patterns:{},sortKey:h};o.push(p)}i&&o.sort((t,e)=>t.sortKey-e.sortKey);for(const s of o){const{geometry:n,index:i,sourceLayerIndex:o}=s;if(this.hasPattern){const t=bu("fill",this.layers,s,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(s,n,i,r,{},e.availableImages);e.featureIndex.insert(t[i].feature,n,i,o,this.index)}}update(t,e,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r,n)}addFeatures(t,e,r,n){for(const i of this.patternFeatures)this.addFeature(i,i.geometry,i.index,e,r,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Bl),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,e,r,n,i,o=[]){for(const s of _u(e,500)){let t=0;for(const a of s)t+=a.length;const e=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray),r=e.vertexLength,n=[],i=[];for(const a of s){if(0===a.length)continue;a!==s[0]&&i.push(n.length/2);const t=this.segments2.prepareSegment(a.length,this.layoutVertexArray,this.indexArray2),e=t.vertexLength;this.layoutVertexArray.emplaceBack(a[0].x,a[0].y),this.indexArray2.emplaceBack(e+a.length-1,e),n.push(a[0].x),n.push(a[0].y);for(let r=1;r<a.length;r++)this.layoutVertexArray.emplaceBack(a[r].x,a[r].y),this.indexArray2.emplaceBack(e+r-1,e+r),n.push(a[r].x),n.push(a[r].y);t.vertexLength+=a.length,t.primitiveLength+=a.length}const o=jl(n,i);for(let s=0;s<o.length;s+=3)this.indexArray.emplaceBack(r+o[s],r+o[s+1],r+o[s+2]);e.vertexLength+=t,e.primitiveLength+=o.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,i,o,n)}}hi("FillBucket",wu,{omit:["layers","patternFeatures"]});const Eu=new Io({"fill-sort-key":new bo(jt.layout_fill["fill-sort-key"])});var Su={paint:new Io({"fill-antialias":new xo(jt.paint_fill["fill-antialias"]),"fill-opacity":new bo(jt.paint_fill["fill-opacity"]),"fill-color":new bo(jt.paint_fill["fill-color"]),"fill-outline-color":new bo(jt.paint_fill["fill-outline-color"]),"fill-translate":new xo(jt.paint_fill["fill-translate"]),"fill-translate-anchor":new xo(jt.paint_fill["fill-translate-anchor"]),"fill-pattern":new wo(jt.paint_fill["fill-pattern"])}),layout:Eu};const Iu=Po([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Tu=Po([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:Cu}=Iu;var Mu=Au;function Au(t,e,r,n,i){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=i,t.readFields(Pu,this,e)}function Pu(t,e,r){1==t?e.id=r.readVarint():2==t?function(t,e){for(var r=t.readVarint()+t.pos;t.pos<r;){var n=e._keys[t.readVarint()],i=e._values[t.readVarint()];e.properties[n]=i}}(r,e):3==t?e.type=r.readVarint():4==t&&(e._geometry=r.pos)}function ku(t){for(var e,r,n=0,i=0,o=t.length,s=o-1;i<o;s=i++)n+=((r=t[s]).x-(e=t[i]).x)*(e.y+r.y);return n}Au.types=["Unknown","Point","LineString","Polygon"],Au.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,n=1,o=0,s=0,a=0,l=[];t.pos<r;){if(o<=0){var u=t.readVarint();n=7&u,o=u>>3}if(o--,1===n||2===n)s+=t.readSVarint(),a+=t.readSVarint(),1===n&&(e&&l.push(e),e=[]),e.push(new i(s,a));else{if(7!==n)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&l.push(e),l},Au.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,n=0,i=0,o=0,s=1/0,a=-1/0,l=1/0,u=-1/0;t.pos<e;){if(n<=0){var c=t.readVarint();r=7&c,n=c>>3}if(n--,1===r||2===r)(i+=t.readSVarint())<s&&(s=i),i>a&&(a=i),(o+=t.readSVarint())<l&&(l=o),o>u&&(u=o);else if(7!==r)throw new Error("unknown command "+r)}return[s,l,a,u]},Au.prototype.toGeoJSON=function(t,e,r){var n,i,o=this.extent*Math.pow(2,r),s=this.extent*t,a=this.extent*e,l=this.loadGeometry(),u=Au.types[this.type];function c(t){for(var e=0;e<t.length;e++){var r=t[e];t[e]=[360*(r.x+s)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(r.y+a)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(n=0;n<l.length;n++)h[n]=l[n][0];c(l=h);break;case 2:for(n=0;n<l.length;n++)c(l[n]);break;case 3:for(l=function(t){var e=t.length;if(e<=1)return[t];for(var r,n,i=[],o=0;o<e;o++){var s=ku(t[o]);0!==s&&(void 0===n&&(n=s<0),n===s<0?(r&&i.push(r),r=[t[o]]):r.push(t[o]))}return r&&i.push(r),i}(l),n=0;n<l.length;n++)for(i=0;i<l[n].length;i++)c(l[n][i])}1===l.length?l=l[0]:u="Multi"+u;var p={type:"Feature",geometry:{type:u,coordinates:l},properties:this.properties};return"id"in this&&(p.id=this.id),p};var Lu=zu;function zu(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Du,this,e),this.length=this._features.length}function Du(t,e,r){15===t?e.version=r.readVarint():1===t?e.name=r.readString():5===t?e.extent=r.readVarint():2===t?e._features.push(r.pos):3===t?e._keys.push(r.readString()):4===t&&e._values.push(function(t){for(var e=null,r=t.readVarint()+t.pos;t.pos<r;){var n=t.readVarint()>>3;e=1===n?t.readString():2===n?t.readFloat():3===n?t.readDouble():4===n?t.readVarint64():5===n?t.readVarint():6===n?t.readSVarint():7===n?t.readBoolean():null}return e}(r))}function Ru(t,e,r){if(3===t){var n=new Lu(r,r.readVarint()+r.pos);n.length&&(e[n.name]=n)}}zu.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Mu(this._pbf,e,this.extent,this._keys,this._values)};var Ou={VectorTile:function(t,e){this.layers=t.readFields(Ru,{},e)},VectorTileFeature:Mu,VectorTileLayer:Lu};const Nu=Ou.VectorTileFeature.types,Fu=Math.pow(2,13);function Bu(t,e,r,n,i,o,s,a){t.emplaceBack((e<<1)+s,(r<<1)+o,(Math.floor(n*Fu)<<1)+i,Math.round(a))}class ju{constructor(){this.acc=new i(0,0),this.polyCount=[]}startRing(t){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new i(t.x,t.y),this.max=new i(t.x,t.y))}append(t,e){this.currentPolyCount.edges++,this.acc._add(t);let r=!!this.borders;const n=this.min,i=this.max;t.x<n.x?(n.x=t.x,r=!0):t.x>i.x&&(i.x=t.x,r=!0),t.y<n.y?(n.y=t.y,r=!0):t.y>i.y&&(i.y=t.y,r=!0),((0===t.x||t.x===Js)&&t.x===e.x)!=((0===t.y||t.y===Js)&&t.y===e.y)&&this.processBorderOverlap(t,e),r&&this.checkBorderIntersection(t,e)}checkBorderIntersection(t,e){e.x<0!=t.x<0&&this.addBorderIntersection(0,ir(e.y,t.y,(0-e.x)/(t.x-e.x))),e.x>Js!=t.x>Js&&this.addBorderIntersection(1,ir(e.y,t.y,(Js-e.x)/(t.x-e.x))),e.y<0!=t.y<0&&this.addBorderIntersection(2,ir(e.x,t.x,(0-e.y)/(t.y-e.y))),e.y>Js!=t.y>Js&&this.addBorderIntersection(3,ir(e.x,t.x,(Js-e.y)/(t.y-e.y)))}addBorderIntersection(t,e){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const r=this.borders[t];e<r[0]&&(r[0]=e),e>r[1]&&(r[1]=e)}processBorderOverlap(t,e){if(t.x===e.x){if(t.y===e.y)return;const r=0===t.x?0:1;this.addBorderIntersection(r,e.y),this.addBorderIntersection(r,t.y)}else{const r=0===t.y?2:3;this.addBorderIntersection(r,e.x),this.addBorderIntersection(r,t.x)}}centroid(){const t=this.polyCount.reduce((t,e)=>t+e.edges,0);return 0!==t?this.acc.div(t)._round():new i(0,0)}span(){return new i(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((t,e)=>t+ +(e[0]!==Number.MAX_VALUE),0)}}class Uu{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new zo,this.centroidVertexArray=new fs,this.indexArray=new qo,this.programConfigurations=new js(t.layers,t.zoom),this.segments=new Hs,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.enableTerrain=t.enableTerrain}populate(t,e,r,n){this.features=[],this.hasPattern=xu("fill-extrusion",this.layers,e),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(t){const e=Math.exp(Math.PI*(1-t.y/(1<<t.z)*2));return 80150034*e/(e*e+1)/Js/(1<<t.z)}(r);for(const{feature:i,id:o,index:s,sourceLayerIndex:a}of t){const t=this.layers[0]._featureFilter.needGeometry,l=ya(i,t);if(!this.layers[0]._featureFilter.filter(new co(this.zoom),l,r))continue;const u={id:o,sourceLayerIndex:a,index:s,geometry:t?l.geometry:ga(i,r,n),properties:i.properties,type:i.type,patterns:{}},c=this.layoutVertexArray.length;this.hasPattern?this.features.push(bu("fill-extrusion",this.layers,u,this.zoom,e)):this.addFeature(u,u.geometry,s,r,{},e.availableImages),e.featureIndex.insert(i,u.geometry,s,a,this.index,c)}this.sortBorders()}addFeatures(t,e,r,n){for(const i of this.features){const{geometry:t}=i;this.addFeature(i,t,i.index,e,r,n)}this.sortBorders()}update(t,e,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Cu),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Tu.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,e,r,n,i,o){const s=this.enableTerrain?new ju:null;for(const l of _u(e,500)){let e=0,r=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(0===l.length||(a=l[0]).every(t=>t.x<=0)||a.every(t=>t.x>=Js)||a.every(t=>t.y<=0)||a.every(t=>t.y>=Js))continue;for(let t=0;t<l.length;t++){const n=l[t];if(0===n.length)continue;e+=n.length;let i=0;s&&s.startRing(n[0]);for(let t=0;t<n.length;t++){const e=n[t];if(t>=1){const o=n[t-1];if(!Vu(e,o)){s&&s.append(e,o),r.vertexLength+4>Hs.MAX_VERTEX_ARRAY_LENGTH&&(r=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const t=e.sub(o)._perp(),n=t.x/(Math.abs(t.x)+Math.abs(t.y)),a=t.y>0?1:0,l=o.dist(e);i+l>32768&&(i=0),Bu(this.layoutVertexArray,e.x,e.y,n,a,0,0,i),Bu(this.layoutVertexArray,e.x,e.y,n,a,0,1,i),i+=l,Bu(this.layoutVertexArray,o.x,o.y,n,a,0,0,i),Bu(this.layoutVertexArray,o.x,o.y,n,a,0,1,i);const u=r.vertexLength;this.indexArray.emplaceBack(u,u+2,u+1),this.indexArray.emplaceBack(u+1,u+2,u+3),r.vertexLength+=4,r.primitiveLength+=2}}}}if(r.vertexLength+e>Hs.MAX_VERTEX_ARRAY_LENGTH&&(r=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray)),"Polygon"!==Nu[t.type])continue;const n=[],i=[],o=r.vertexLength;for(let t=0;t<l.length;t++){const e=l[t];if(0!==e.length){e!==l[0]&&i.push(n.length/2);for(let t=0;t<e.length;t++){const r=e[t];Bu(this.layoutVertexArray,r.x,r.y,0,0,1,1,0),n.push(r.x),n.push(r.y),s&&s.currentPolyCount.top++}}}const u=jl(n,i);for(let t=0;t<u.length;t+=3)this.indexArray.emplaceBack(o+u[t],o+u[t+2],o+u[t+1]);r.primitiveLength+=u.length/3,r.vertexLength+=e}var a;if(s&&s.polyCount.length>0){if(s.borders){s.vertexArrayOffset=this.centroidVertexArray.length;const t=s.borders,e=this.featuresOnBorder.push(s)-1;for(let r=0;r<4;r++)t[r][0]!==Number.MAX_VALUE&&this.borders[r].push(e)}this.encodeCentroid(s.borders?void 0:s.centroid(),s)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,i,o,n)}sortBorders(){for(let t=0;t<4;t++)this.borders[t].sort((e,r)=>this.featuresOnBorder[e].borders[t][0]-this.featuresOnBorder[r].borders[t][0])}encodeCentroid(t,e,r=!0){let n,i;if(t)if(0!==t.y){const r=e.span()._mult(this.tileToMeter);n=(Math.max(t.x,1)<<3)+Math.min(7,Math.round(r.x/10)),i=(Math.max(t.y,1)<<3)+Math.min(7,Math.round(r.y/10))}else n=Math.ceil(7*(t.x+450)),i=0;else n=0,i=+r;let o=r?this.centroidVertexArray.length:e.vertexArrayOffset;for(const s of e.polyCount){r&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*s.edges+s.top);for(let t=0;t<2*s.edges;t++)this.centroidVertexArray.emplace(o++,0,i),this.centroidVertexArray.emplace(o++,n,i);for(let t=0;t<s.top;t++)this.centroidVertexArray.emplace(o++,n,i)}}}function Vu(t,e){return t.x===e.x&&(t.x<0||t.x>Js)||t.y===e.y&&(t.y<0||t.y>Js)}hi("FillExtrusionBucket",Uu,{omit:["layers","features"]}),hi("PartMetadata",ju);var Gu={paint:new Io({"fill-extrusion-opacity":new xo(jt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new bo(jt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new xo(jt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new xo(jt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new wo(jt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new bo(jt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new bo(jt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new xo(jt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function qu(t,e){return t.x*e.x+t.y*e.y}function $u(t,e){if(1===t.length){let r=0;const n=e[r++];let i;for(;!i||n.equals(i);)if(i=e[r++],!i)return 1/0;for(;r<e.length;r++){const o=e[r],s=t[0],a=i.sub(n),l=o.sub(n),u=s.sub(n),c=qu(a,a),h=qu(a,l),p=qu(l,l),f=qu(u,a),d=qu(u,l),m=c*p-h*h,g=(p*f-h*d)/m,y=(c*d-h*f)/m,_=n.z*(1-g-y)+i.z*g+o.z*y;if(isFinite(_))return _}return 1/0}{let t=1/0;for(const r of e)t=Math.min(t,r.z);return t}}function Zu(t){const e=new i(t[0],t[1]);return e.z=t[2],e}function Xu(t,e,r,n,i,o,s,a){const l=s*i.getElevationAt(t,e,!0,!0),u=0!==o[0],c=u?0===o[1]?s*(o[0]/7-450):s*function(t,e,r){const n=Math.floor(e[0]/8),i=Math.floor(e[1]/8),o=10*(e[0]-8*n),s=10*(e[1]-8*i),a=t.getElevationAt(n,i,!0,!0),l=t.getMeterToDEM(r),u=Math.floor(.5*(o*l-1)),c=Math.floor(.5*(s*l-1)),h=t.tileCoordToPixel(n,i),p=2*u+1,f=2*c+1,d=function(t,e,r,n,i){return[t.getElevationAtPixel(e,r,!0),t.getElevationAtPixel(e+i,r,!0),t.getElevationAtPixel(e,r+i,!0),t.getElevationAtPixel(e+n,r+i,!0)]}(t,h.x-u,h.y-c,p,f),m=Math.abs(d[0]-d[1]),g=Math.abs(d[2]-d[3]),y=Math.abs(d[0]-d[2])+Math.abs(d[1]-d[3]),_=Math.min(.25,.5*l*(m+g)/p),v=Math.min(.25,.5*l*y/f);return a+Math.max(_*o,v*s)}(i,o,a):l;return{base:l+(0===r)?-1:r,top:u?Math.max(c+n,l+r+2):l+n}}const Wu=Po([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Yu}=Wu,Hu=Po([{name:"a_packed",components:3,type:"Float32"}]),{members:Ju}=Hu,Ku=Ou.VectorTileFeature.types,Qu=Math.cos(Math.PI/180*37.5);class tc{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(t=>{this.gradients[t.id]={}}),this.layoutVertexArray=new Do,this.layoutVertexArray2=new Ro,this.indexArray=new qo,this.programConfigurations=new js(t.layers,t.zoom),this.segments=new Hs,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(t,e,r,n){this.hasPattern=xu("line",this.layers,e);const i=this.layers[0].layout.get("line-sort-key"),o=[];for(const{feature:u,id:c,index:h,sourceLayerIndex:p}of t){const t=this.layers[0]._featureFilter.needGeometry,e=ya(u,t);if(!this.layers[0]._featureFilter.filter(new co(this.zoom),e,r))continue;const s=i?i.evaluate(e,{},r):void 0,a={id:c,properties:u.properties,type:u.type,sourceLayerIndex:p,index:h,geometry:t?e.geometry:ga(u,r,n),patterns:{},sortKey:s};o.push(a)}i&&o.sort((t,e)=>t.sortKey-e.sortKey);const{lineAtlas:s,featureIndex:a}=e,l=this.addConstantDashes(s);for(const u of o){const{geometry:n,index:i,sourceLayerIndex:o}=u;if(l&&this.addFeatureDashes(u,s),this.hasPattern){const t=bu("line",this.layers,u,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(u,n,i,r,s.positions,e.availableImages);a.insert(t[i].feature,n,i,o,this.index)}}addConstantDashes(t){let e=!1;for(const r of this.layers){const n=r.paint.get("line-dasharray").value,i=r.layout.get("line-cap").value;if("constant"!==n.kind||"constant"!==i.kind)e=!0;else{const e=i.value,r=n.value;if(!r)continue;t.addDash(r.from,e),t.addDash(r.to,e),r.other&&t.addDash(r.other,e)}}return e}addFeatureDashes(t,e){const r=this.zoom;for(const n of this.layers){const i=n.paint.get("line-dasharray").value,o=n.layout.get("line-cap").value;if("constant"===i.kind&&"constant"===o.kind)continue;let s,a,l,u,c,h;if("constant"===i.kind){const t=i.value;if(!t)continue;s=t.other||t.to,a=t.to,l=t.from}else s=i.evaluate({zoom:r-1},t),a=i.evaluate({zoom:r},t),l=i.evaluate({zoom:r+1},t);"constant"===o.kind?u=c=h=o.value:(u=o.evaluate({zoom:r-1},t),c=o.evaluate({zoom:r},t),h=o.evaluate({zoom:r+1},t)),e.addDash(s,u),e.addDash(a,c),e.addDash(l,h);const p=e.getKey(s,u),f=e.getKey(a,c),d=e.getKey(l,h);t.patterns[n.id]={min:p,mid:f,max:d}}}update(t,e,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r,n)}addFeatures(t,e,r,n){for(const i of this.patternFeatures)this.addFeature(i,i.geometry,i.index,e,r,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Ju)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Yu),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,e,r,n,i,o){const s=this.layers[0].layout,a=s.get("line-join").evaluate(t,{}),l=s.get("line-cap").evaluate(t,{}),u=s.get("line-miter-limit"),c=s.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const h of e)this.addLine(h,t,a,l,u,c);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,i,o,n)}addLine(t,e,r,n,i,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let e=0;e<t.length-1;e++)this.totalDistance+=t[e].dist(t[e+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const s="Polygon"===Ku[e.type];let a=t.length;for(;a>=2&&t[a-1].equals(t[a-2]);)a--;let l=0;for(;l<a-1&&t[l].equals(t[l+1]);)l++;if(a<(s?3:2))return;"bevel"===r&&(i=1.05);const u=this.overscaling<=16?122880/(512*this.overscaling):0,c=this.segments.prepareSegment(10*a,this.layoutVertexArray,this.indexArray);let h,p,f,d,m;this.e1=this.e2=-1,s&&(h=t[a-2],m=t[l].sub(h)._unit()._perp());for(let g=l;g<a;g++){if(f=g===a-1?s?t[l+1]:void 0:t[g+1],f&&t[g].equals(f))continue;m&&(d=m),h&&(p=h),h=t[g],m=f?f.sub(h)._unit()._perp():d,d=d||m;let e=d.add(m);0===e.x&&0===e.y||e._unit();const y=d.x*m.x+d.y*m.y,_=e.x*m.x+e.y*m.y,v=0!==_?1/_:1/0,x=2*Math.sqrt(2-2*_),b=_<Qu&&p&&f,w=d.x*m.y-d.y*m.x>0;if(b&&g>l){const t=h.dist(p);if(t>2*u){const e=h.sub(h.sub(p)._mult(u/t)._round());this.updateDistance(p,e),this.addCurrentVertex(e,d,0,0,c),p=e}}const E=p&&f;let S=E?r:s?"butt":n;if(E&&"round"===S&&(v<o?S="miter":v<=2&&(S="fakeround")),"miter"===S&&v>i&&(S="bevel"),"bevel"===S&&(v>2&&(S="flipbevel"),v<i&&(S="miter")),p&&this.updateDistance(p,h),"miter"===S)e._mult(v),this.addCurrentVertex(h,e,0,0,c);else if("flipbevel"===S){if(v>100)e=m.mult(-1);else{const t=v*d.add(m).mag()/d.sub(m).mag();e._perp()._mult(t*(w?-1:1))}this.addCurrentVertex(h,e,0,0,c),this.addCurrentVertex(h,e.mult(-1),0,0,c)}else if("bevel"===S||"fakeround"===S){const t=-Math.sqrt(v*v-1),e=w?t:0,r=w?0:t;if(p&&this.addCurrentVertex(h,d,e,r,c),"fakeround"===S){const t=Math.round(180*x/Math.PI/20);for(let e=1;e<t;e++){let r=e/t;if(.5!==r){const t=r-.5;r+=r*t*(r-1)*((1.0904+y*(y*(3.55645-1.43519*y)-3.2452))*t*t+(.848013+y*(.215638*y-1.06021)))}const n=m.sub(d)._mult(r)._add(d)._unit()._mult(w?-1:1);this.addHalfVertex(h,n.x,n.y,!1,w,0,c)}}f&&this.addCurrentVertex(h,m,-e,-r,c)}else if("butt"===S)this.addCurrentVertex(h,e,0,0,c);else if("square"===S){const t=p?1:-1;p||this.addCurrentVertex(h,e,t,t,c),this.addCurrentVertex(h,e,0,0,c),p&&this.addCurrentVertex(h,e,t,t,c)}else"round"===S&&(p&&(this.addCurrentVertex(h,d,0,0,c),this.addCurrentVertex(h,d,1,1,c,!0)),f&&(this.addCurrentVertex(h,m,-1,-1,c,!0),this.addCurrentVertex(h,m,0,0,c)));if(b&&g<a-1){const t=h.dist(f);if(t>2*u){const e=h.add(f.sub(h)._mult(u/t)._round());this.updateDistance(h,e),this.addCurrentVertex(e,m,0,0,c),h=e}}}}addCurrentVertex(t,e,r,n,i,o=!1){const s=e.y*n-e.x,a=-e.y-e.x*n;this.addHalfVertex(t,e.x+e.y*r,e.y-e.x*r,o,!1,r,i),this.addHalfVertex(t,s,a,o,!0,-n,i)}addHalfVertex({x:t,y:e},r,n,i,o,s,a){this.layoutVertexArray.emplaceBack((t<<1)+(i?1:0),(e<<1)+(o?1:0),Math.round(63*r)+128,Math.round(63*n)+128,1+(0===s?0:s<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const l=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,l),a.primitiveLength++),o?this.e2=l:this.e1=l}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,e){this.distance+=t.dist(e),this.updateScaledDistance()}}hi("LineBucket",tc,{omit:["layers","patternFeatures"]});const ec=new Io({"line-cap":new bo(jt.layout_line["line-cap"]),"line-join":new bo(jt.layout_line["line-join"]),"line-miter-limit":new xo(jt.layout_line["line-miter-limit"]),"line-round-limit":new xo(jt.layout_line["line-round-limit"]),"line-sort-key":new bo(jt.layout_line["line-sort-key"])});var rc={paint:new Io({"line-opacity":new bo(jt.paint_line["line-opacity"]),"line-color":new bo(jt.paint_line["line-color"]),"line-translate":new xo(jt.paint_line["line-translate"]),"line-translate-anchor":new xo(jt.paint_line["line-translate-anchor"]),"line-width":new bo(jt.paint_line["line-width"]),"line-gap-width":new bo(jt.paint_line["line-gap-width"]),"line-offset":new bo(jt.paint_line["line-offset"]),"line-blur":new bo(jt.paint_line["line-blur"]),"line-dasharray":new wo(jt.paint_line["line-dasharray"]),"line-pattern":new wo(jt.paint_line["line-pattern"]),"line-gradient":new So(jt.paint_line["line-gradient"])}),layout:ec};const nc=new class extends bo{possiblyEvaluate(t,e){return e=new co(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,r,n){return e=x({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,r,n)}}(rc.paint.properties["line-width"].specification);function ic(t,e){return e>0?e+2*t:t}nc.useIntegerZoom=!0;const oc=Po([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),sc=Po([{name:"a_projected_pos",components:3,type:"Float32"}],4);Po([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const ac=Po([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),lc=Po([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Po([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const uc=Po([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),cc=Po([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Po([{name:"triangle",components:3,type:"Uint16"}]),Po([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Po([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Po([{type:"Float32",name:"offsetX"}]),Po([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var hc=24;const pc=128;function fc(t,e){const{expression:r}=e;if("constant"===r.kind)return{kind:"constant",layoutSize:r.evaluate(new co(t+1))};if("source"===r.kind)return{kind:"source"};{const{zoomStops:e,interpolationType:n}=r;let i=0;for(;i<e.length&&e[i]<=t;)i++;i=Math.max(0,i-1);let o=i;for(;o<e.length&&e[o]<t+1;)o++;o=Math.min(e.length-1,o);const s=e[i],a=e[o];return"composite"===r.kind?{kind:"composite",minZoom:s,maxZoom:a,interpolationType:n}:{kind:"camera",minZoom:s,maxZoom:a,minSize:r.evaluate(new co(s)),maxSize:r.evaluate(new co(a)),interpolationType:n}}}function dc(t,{uSize:e,uSizeT:r},{lowerSize:n,upperSize:i}){return"source"===t.kind?n/pc:"composite"===t.kind?ir(n/pc,i/pc,r):e}function mc(t,e){let r=0,n=0;if("constant"===t.kind)n=t.layoutSize;else if("source"!==t.kind){const{interpolationType:i,minZoom:o,maxZoom:s}=t,a=i?m(Er.interpolationFactor(i,e,o,s),0,1):0;"camera"===t.kind?n=ir(t.minSize,t.maxSize,a):r=a}return{uSizeT:r,uSize:n}}var gc=Object.freeze({__proto__:null,getSizeData:fc,evaluateSizeForFeature:dc,evaluateSizeForZoom:mc,SIZE_PACK_FACTOR:pc});function yc(t,e,r){return t.sections.forEach(t=>{t.text=function(t,e,r){const n=e.layout.get("text-transform").evaluate(r,{});return"uppercase"===n?t=t.toLocaleUpperCase():"lowercase"===n&&(t=t.toLocaleLowerCase()),uo.applyArabicShaping&&(t=uo.applyArabicShaping(t)),t}(t.text,e,r)}),t}const _c={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};function vc(t){return"︶"===t||"﹈"===t||"︸"===t||"﹄"===t||"﹂"===t||"︾"===t||"︼"===t||"︺"===t||"︘"===t||"﹀"===t||"︐"===t||"︓"===t||"︔"===t||"｀"===t||"￣"===t||"︑"===t||"︒"===t}function xc(t){return"︵"===t||"﹇"===t||"︷"===t||"﹃"===t||"﹁"===t||"︽"===t||"︻"===t||"︹"===t||"︗"===t||"︿"===t}var bc=function(t,e,r,n,i){var o,s,a=8*i-n-1,l=(1<<a)-1,u=l>>1,c=-7,h=r?i-1:0,p=r?-1:1,f=t[e+h];for(h+=p,o=f&(1<<-c)-1,f>>=-c,c+=a;c>0;o=256*o+t[e+h],h+=p,c-=8);for(s=o&(1<<-c)-1,o>>=-c,c+=n;c>0;s=256*s+t[e+h],h+=p,c-=8);if(0===o)o=1-u;else{if(o===l)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,n),o-=u}return(f?-1:1)*s*Math.pow(2,o-n)},wc=function(t,e,r,n,i,o){var s,a,l,u=8*o-i-1,c=(1<<u)-1,h=c>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:o-1,d=n?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=c):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),(e+=s+h>=1?p/l:p*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=c?(a=0,s=c):s+h>=1?(a=(e*l-1)*Math.pow(2,i),s+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,i),s=0));i>=8;t[r+f]=255&a,f+=d,a/=256,i-=8);for(s=s<<i|a,u+=i;u>0;t[r+f]=255&s,f+=d,s/=256,u-=8);t[r+f-d]|=128*m},Ec=Sc;function Sc(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Sc.Varint=0,Sc.Fixed64=1,Sc.Bytes=2,Sc.Fixed32=5;var Ic=4294967296,Tc=1/Ic,Cc="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Mc(t){return t.type===Sc.Bytes?t.readVarint()+t.pos:t.pos+1}function Ac(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Pc(t,e,r){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(n);for(var i=r.pos-1;i>=t;i--)r.buf[i+n]=r.buf[i]}function kc(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function Lc(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function zc(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function Dc(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function Rc(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function Oc(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function Nc(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function Fc(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function Bc(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function jc(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Uc(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function Vc(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function Gc(t,e,r){e.glyphs=[],1===t&&r.readMessage(qc,e)}function qc(t,e,r){if(3===t){const{id:t,bitmap:n,width:i,height:o,left:s,top:a,advance:l}=r.readMessage($c,{});e.glyphs.push({id:t,bitmap:new zl({width:i+6,height:o+6},n),metrics:{width:i,height:o,left:s,top:a,advance:l}})}else 4===t?e.ascender=r.readSVarint():5===t&&(e.descender=r.readSVarint())}function $c(t,e,r){1===t?e.id=r.readVarint():2===t?e.bitmap=r.readBytes():3===t?e.width=r.readVarint():4===t?e.height=r.readVarint():5===t?e.left=r.readSVarint():6===t?e.top=r.readSVarint():7===t&&(e.advance=r.readVarint())}function Zc(t){let e=0,r=0;for(const s of t)e+=s.w*s.h,r=Math.max(r,s.w);t.sort((t,e)=>e.h-t.h);const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let i=0,o=0;for(const s of t)for(let t=n.length-1;t>=0;t--){const e=n[t];if(!(s.w>e.w||s.h>e.h)){if(s.x=e.x,s.y=e.y,o=Math.max(o,s.y+s.h),i=Math.max(i,s.x+s.w),s.w===e.w&&s.h===e.h){const e=n.pop();t<n.length&&(n[t]=e)}else s.h===e.h?(e.x+=s.w,e.w-=s.w):s.w===e.w?(e.y+=s.h,e.h-=s.h):(n.push({x:e.x+s.w,y:e.y,w:e.w-s.w,h:s.h}),e.y+=s.h,e.h-=s.h);break}}return{w:i,h:o,fill:e/(i*o)||0}}Sc.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),i=n>>3,o=this.pos;this.type=7&n,t(i,e,this),this.pos===o&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=jc(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Vc(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=jc(this.buf,this.pos)+jc(this.buf,this.pos+4)*Ic;return this.pos+=8,t},readSFixed64:function(){var t=jc(this.buf,this.pos)+Vc(this.buf,this.pos+4)*Ic;return this.pos+=8,t},readFloat:function(){var t=bc(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=bc(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,n=this.buf;return e=127&(r=n[this.pos++]),r<128?e:(e|=(127&(r=n[this.pos++]))<<7,r<128?e:(e|=(127&(r=n[this.pos++]))<<14,r<128?e:(e|=(127&(r=n[this.pos++]))<<21,r<128?e:function(t,e,r){var n,i,o=r.buf;if(n=(112&(i=o[r.pos++]))>>4,i<128)return Ac(t,n,e);if(n|=(127&(i=o[r.pos++]))<<3,i<128)return Ac(t,n,e);if(n|=(127&(i=o[r.pos++]))<<10,i<128)return Ac(t,n,e);if(n|=(127&(i=o[r.pos++]))<<17,i<128)return Ac(t,n,e);if(n|=(127&(i=o[r.pos++]))<<24,i<128)return Ac(t,n,e);if(n|=(1&(i=o[r.pos++]))<<31,i<128)return Ac(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Cc?function(t,e,r){return Cc.decode(t.subarray(e,r))}(this.buf,e,t):function(t,e,r){for(var n="",i=e;i<r;){var o,s,a,l=t[i],u=null,c=l>239?4:l>223?3:l>191?2:1;if(i+c>r)break;1===c?l<128&&(u=l):2===c?128==(192&(o=t[i+1]))&&(u=(31&l)<<6|63&o)<=127&&(u=null):3===c?(s=t[i+2],128==(192&(o=t[i+1]))&&128==(192&s)&&((u=(15&l)<<12|(63&o)<<6|63&s)<=2047||u>=55296&&u<=57343)&&(u=null)):4===c&&(s=t[i+2],a=t[i+3],128==(192&(o=t[i+1]))&&128==(192&s)&&128==(192&a)&&((u=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||u>=1114112)&&(u=null)),null===u?(u=65533,c=1):u>65535&&(u-=65536,n+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),n+=String.fromCharCode(u),i+=c}return n}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Sc.Bytes)return t.push(this.readVarint(e));var r=Mc(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Sc.Bytes)return t.push(this.readSVarint());var e=Mc(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Sc.Bytes)return t.push(this.readBoolean());var e=Mc(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Sc.Bytes)return t.push(this.readFloat());var e=Mc(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Sc.Bytes)return t.push(this.readDouble());var e=Mc(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Sc.Bytes)return t.push(this.readFixed32());var e=Mc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Sc.Bytes)return t.push(this.readSFixed32());var e=Mc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Sc.Bytes)return t.push(this.readFixed64());var e=Mc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Sc.Bytes)return t.push(this.readSFixed64());var e=Mc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Sc.Varint)for(;this.buf[this.pos++]>127;);else if(e===Sc.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Sc.Fixed32)this.pos+=4;else{if(e!==Sc.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Uc(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Uc(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Uc(this.buf,-1&t,this.pos),Uc(this.buf,Math.floor(t*Tc),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Uc(this.buf,-1&t,this.pos),Uc(this.buf,Math.floor(t*Tc),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var r,n;if(t>=0?(r=t%4294967296|0,n=t/4294967296|0):(n=~(-t/4294967296),4294967295^(r=~(-t%4294967296))?r=r+1|0:(r=0,n=n+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,r){r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,r.buf[r.pos]=127&(t>>>=7)}(r,0,e),function(t,e){var r=(7&t)<<4;e.buf[e.pos++]|=r|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(n,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,r){for(var n,i,o=0;o<e.length;o++){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){n>56319||o+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):i=n;continue}if(n<56320){t[r++]=239,t[r++]=191,t[r++]=189,i=n;continue}n=i-55296<<10|n-56320|65536,i=null}else i&&(t[r++]=239,t[r++]=191,t[r++]=189,i=null);n<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:(n<65536?t[r++]=n>>12|224:(t[r++]=n>>18|240,t[r++]=n>>12&63|128),t[r++]=n>>6&63|128),t[r++]=63&n|128)}return r}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&Pc(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),wc(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),wc(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var n=this.pos-r;n>=128&&Pc(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,r){this.writeTag(t,Sc.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,kc,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Lc,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Rc,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,zc,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Dc,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Oc,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,Nc,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,Fc,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Bc,e)},writeBytesField:function(t,e){this.writeTag(t,Sc.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Sc.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Sc.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Sc.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Sc.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Sc.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Sc.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Sc.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Sc.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Sc.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};class Xc{constructor(t,{pixelRatio:e,version:r,stretchX:n,stretchY:i,content:o}){this.paddedRect=t,this.pixelRatio=e,this.stretchX=n,this.stretchY=i,this.content=o,this.version=r}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Wc{constructor(t,e){const r={},n={};this.haveRenderCallbacks=[];const i=[];this.addImages(t,r,i),this.addImages(e,n,i);const{w:o,h:s}=Zc(i),a=new Dl({width:o||1,height:s||1});for(const l in t){const e=t[l],n=r[l].paddedRect;Dl.copy(e.data,a,{x:0,y:0},{x:n.x+1,y:n.y+1},e.data)}for(const l in e){const t=e[l],r=n[l].paddedRect,i=r.x+1,o=r.y+1,s=t.data.width,u=t.data.height;Dl.copy(t.data,a,{x:0,y:0},{x:i,y:o},t.data),Dl.copy(t.data,a,{x:0,y:u-1},{x:i,y:o-1},{width:s,height:1}),Dl.copy(t.data,a,{x:0,y:0},{x:i,y:o+u},{width:s,height:1}),Dl.copy(t.data,a,{x:s-1,y:0},{x:i-1,y:o},{width:1,height:u}),Dl.copy(t.data,a,{x:0,y:0},{x:i+s,y:o},{width:1,height:u})}this.image=a,this.iconPositions=r,this.patternPositions=n}addImages(t,e,r){for(const n in t){const i=t[n],o={x:0,y:0,w:i.data.width+2,h:i.data.height+2};r.push(o),e[n]=new Xc(o,i),i.hasRenderCallback&&this.haveRenderCallbacks.push(n)}}patchUpdatedImages(t,e){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const r in t.updatedImages)this.patchUpdatedImage(this.iconPositions[r],t.getImage(r),e),this.patchUpdatedImage(this.patternPositions[r],t.getImage(r),e)}patchUpdatedImage(t,e,r){if(!t||!e)return;if(t.version===e.version)return;t.version=e.version;const[n,i]=t.tl;r.update(e.data,void 0,{x:n,y:i})}}hi("ImagePosition",Xc),hi("ImageAtlas",Wc);const Yc={horizontal:1,vertical:2,horizontalOnly:3};class Hc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,e){const r=new Hc;return r.scale=t||1,r.fontStack=e,r}static forImage(t){const e=new Hc;return e.imageName=t,e}}class Jc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,e){const r=new Jc;for(let n=0;n<t.sections.length;n++){const i=t.sections[n];i.image?r.addImageSection(i):r.addTextSection(i,e)}return r}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(t){this.text=function(t,e){let r="";for(let n=0;n<t.length;n++){const i=t.charCodeAt(n+1)||null,o=t.charCodeAt(n-1)||null;r+=!e&&(i&&Wi(i)&&!_c[t[n+1]]||o&&Wi(o)&&!_c[t[n-1]])||!_c[t[n]]?t[n]:_c[t[n]]}return r}(this.text,t)}trim(){let t=0;for(let r=0;r<this.text.length&&Qc[this.text.charCodeAt(r)];r++)t++;let e=this.text.length;for(let r=this.text.length-1;r>=0&&r>=t&&Qc[this.text.charCodeAt(r)];r--)e--;this.text=this.text.substring(t,e),this.sectionIndex=this.sectionIndex.slice(t,e)}substring(t,e){const r=new Jc;return r.text=this.text.substring(t,e),r.sectionIndex=this.sectionIndex.slice(t,e),r.sections=this.sections,r}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,e)=>Math.max(t,this.sections[e].scale),0)}addTextSection(t,e){this.text+=t.text,this.sections.push(Hc.forText(t.scale,t.fontStack||e));const r=this.sections.length-1;for(let n=0;n<t.text.length;++n)this.sectionIndex.push(r)}addImageSection(t){const e=t.image?t.image.name:"";if(0===e.length)return void L("Can't add FormattedSection with an empty image.");const r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(Hc.forImage(e)),this.sectionIndex.push(this.sections.length-1)):L("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Kc(t,e,r,n,i,o,s,a,l,u,c,h,p,f,d,m){const g=Jc.fromFeature(t,i);let y;h===Yc.vertical&&g.verticalizePunctuation(p);const{processBidirectionalText:_,processStyledBidirectionalText:v}=uo;if(_&&1===g.sections.length){y=[];const t=_(g.toString(),sh(g,u,o,e,n,f,d));for(const e of t){const t=new Jc;t.text=e,t.sections=g.sections;for(let r=0;r<e.length;r++)t.sectionIndex.push(0);y.push(t)}}else if(v){y=[];const t=v(g.text,g.sectionIndex,sh(g,u,o,e,n,f,d));for(const e of t){const t=new Jc;t.text=e[0],t.sectionIndex=e[1],t.sections=g.sections,y.push(t)}}else y=function(t,e){const r=[],n=t.text;let i=0;for(const o of e)r.push(t.substring(i,o)),i=o;return i<n.length&&r.push(t.substring(i,n.length)),r}(g,sh(g,u,o,e,n,f,d));const x=[],b={positionedLines:x,text:g.toString(),top:c[1],bottom:c[1],left:c[0],right:c[0],writingMode:h,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(t,e,r,n,i,o,s,a,l,u,c,h){let p=0,f=0,d=0;const m="right"===a?1:"left"===a?0:.5;let g=!1;for(const w of i){const t=w.getSections();for(const r of t){if(r.imageName)continue;const t=e[r.fontStack];if(t&&(g=void 0!==t.ascender&&void 0!==t.descender,!g))break}if(!g)break}let y=0;for(const w of i){w.trim();const i=w.getMaxScale(),s=(i-1)*hc,a={positionedGlyphs:[],lineOffset:0};t.positionedLines[y]=a;const v=a.positionedGlyphs;let x=0;if(!w.length()){f+=o,++y;continue}let b=0,E=0;for(let o=0;o<w.length();o++){const s=w.getSection(o),a=w.getSectionIndex(o),d=w.getCharCode(o);let m=s.scale,y=null,S=null,I=null,T=hc,C=0;const M=!(l===Yc.horizontal||!c&&!Xi(d)||c&&(Qc[d]||(_=d,yi(_)||_i(_)||vi(_)||Fi(_)||Vi(_))));if(s.imageName){const e=n[s.imageName];if(!e)continue;I=s.imageName,t.iconsInText=t.iconsInText||!0,S=e.paddedRect;const r=e.displaySize;m=m*hc/h,y={width:r[0],height:r[1],left:1,top:-3,advance:M?r[1]:r[0],localGlyph:!1},C=g?-y.height*m:i*hc-17-r[1]*m,T=y.advance;const o=(M?r[0]:r[1])*m-hc*i;o>0&&o>x&&(x=o)}else{const t=r[s.fontStack];if(!t)continue;t[d]&&(S=t[d]);const n=e[s.fontStack];if(!n)continue;const o=n.glyphs[d];if(!o)continue;if(y=o.metrics,T=8203!==d?hc:0,g){const t=void 0!==n.ascender?Math.abs(n.ascender):0,e=void 0!==n.descender?Math.abs(n.descender):0,r=(t+e)*m;b<r&&(b=r,E=(t-e)/2*m),C=-t*m}else C=(i-m)*hc-17}M?(t.verticalizable=!0,v.push({glyph:d,imageName:I,x:p,y:f+C,vertical:M,scale:m,localGlyph:y.localGlyph,fontStack:s.fontStack,sectionIndex:a,metrics:y,rect:S}),p+=T*m+u):(v.push({glyph:d,imageName:I,x:p,y:f+C,vertical:M,scale:m,localGlyph:y.localGlyph,fontStack:s.fontStack,sectionIndex:a,metrics:y,rect:S}),p+=y.advance*m+u)}0!==v.length&&(d=Math.max(p-u,d),g?lh(v,m,x,E,o*i/2):lh(v,m,x,0,o/2)),p=0;const S=o*i+x;a.lineOffset=Math.max(x,s),f+=S,++y}var _;const v=f,{horizontalAlign:x,verticalAlign:b}=ah(s);(function(t,e,r,n,i,o){const s=(e-r)*i,a=-o*n;for(const l of t)for(const t of l.positionedGlyphs)t.x+=s,t.y+=a})(t.positionedLines,m,x,b,d,v),t.top+=-b*v,t.bottom=t.top+v,t.left+=-x*d,t.right=t.left+d,t.hasBaseline=g}(b,e,r,n,y,s,a,l,h,u,p,m),!function(t){for(const e of t)if(0!==e.positionedGlyphs.length)return!1;return!0}(x)&&b}const Qc={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},th={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function eh(t,e,r,n,i,o){if(e.imageName){const t=n[e.imageName];return t?t.displaySize[0]*e.scale*hc/o+i:0}{const n=r[e.fontStack],o=n&&n.glyphs[t];return o?o.metrics.advance*e.scale+i:0}}function rh(t,e,r,n){const i=Math.pow(t-e,2);return n?t<e?i/2:2*i:i+Math.abs(r)*r}function nh(t,e,r){let n=0;return 10===t&&(n-=1e4),r&&(n+=150),40!==t&&65288!==t||(n+=50),41!==e&&65289!==e||(n+=50),n}function ih(t,e,r,n,i,o){let s=null,a=rh(e,r,i,o);for(const l of n){const t=rh(e-l.x,r,i,o)+l.badness;t<=a&&(s=l,a=t)}return{index:t,x:e,priorBreak:s,badness:a}}function oh(t){return t?oh(t.priorBreak).concat(t.index):[]}function sh(t,e,r,n,i,o,s){if("point"!==o)return[];if(!t)return[];const a=[],l=function(t,e,r,n,i,o){let s=0;for(let a=0;a<t.length();a++){const r=t.getSection(a);s+=eh(t.getCharCode(a),r,n,i,e,o)}return s/Math.max(1,Math.ceil(s/r))}(t,e,r,n,i,s),u=t.text.indexOf("​")>=0;let c=0;for(let p=0;p<t.length();p++){const r=t.getSection(p),o=t.getCharCode(p);if(Qc[o]||(c+=eh(o,r,n,i,e,s)),p<t.length()-1){const e=!((h=o)<11904||!(Ci(h)||Ti(h)||ji(h)||Ni(h)||ki(h)||xi(h)||Mi(h)||Ei(h)||Li(h)||zi(h)||Pi(h)||Gi(h)||Si(h)||wi(h)||bi(h)||Ai(h)||Ii(h)||Bi(h)||Ri(h)||Di(h)));(th[o]||e||r.imageName)&&a.push(ih(p+1,c,l,a,nh(o,t.getCharCode(p+1),e&&u),!1))}}var h;return oh(ih(t.length(),c,l,a,0,!0))}function ah(t){let e=.5,r=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function lh(t,e,r,n,i){if(!(e||r||n||i))return;const o=t.length-1,s=t[o],a=(s.x+s.metrics.advance*s.scale)*e;for(let l=0;l<=o;l++)t[l].x-=a,t[l].y+=r+n+i}function uh(t,e,r){const{horizontalAlign:n,verticalAlign:i}=ah(r),o=e[0]-t.displaySize[0]*n,s=e[1]-t.displaySize[1]*i;return{image:t,top:s,bottom:s+t.displaySize[1],left:o,right:o+t.displaySize[0]}}function ch(t,e,r,n,i,o){const s=t.image;let a;if(s.content){const t=s.content,e=s.pixelRatio||1;a=[t[0]/e,t[1]/e,s.displaySize[0]-t[2]/e,s.displaySize[1]-t[3]/e]}const l=e.left*o,u=e.right*o;let c,h,p,f;"width"===r||"both"===r?(f=i[0]+l-n[3],h=i[0]+u+n[1]):(f=i[0]+(l+u-s.displaySize[0])/2,h=f+s.displaySize[0]);const d=e.top*o,m=e.bottom*o;return"height"===r||"both"===r?(c=i[1]+d-n[0],p=i[1]+m+n[2]):(c=i[1]+(d+m-s.displaySize[1])/2,p=c+s.displaySize[1]),{image:s,top:c,right:h,bottom:p,left:f,collisionPadding:a}}class hh extends i{constructor(t,e,r,n,i){super(t,e),this.angle=n,this.z=r,void 0!==i&&(this.segment=i)}clone(){return new hh(this.x,this.y,this.z,this.angle,this.segment)}}function ph(t,e,r,n,i){if(void 0===e.segment)return!0;let o=e,s=e.segment+1,a=0;for(;a>-r/2;){if(s--,s<0)return!1;a-=t[s].dist(o),o=t[s]}a+=t[s].dist(t[s+1]),s++;const l=[];let u=0;for(;a<r/2;){const e=t[s],r=t[s+1];if(!r)return!1;let o=t[s-1].angleTo(e)-e.angleTo(r);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:o}),u+=o;a-l[0].distance>n;)u-=l.shift().angleDelta;if(u>i)return!1;s++,a+=e.dist(r)}return!0}function fh(t){let e=0;for(let r=0;r<t.length-1;r++)e+=t[r].dist(t[r+1]);return e}function dh(t,e,r){return t?.6*e*r:0}function mh(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function gh(t,e,r,n,i,o){const s=dh(r,i,o),a=mh(r,n)*o;let l=0;const u=fh(t)/2;for(let c=0;c<t.length-1;c++){const r=t[c],n=t[c+1],i=r.dist(n);if(l+i>u){const o=(u-l)/i,h=ir(r.x,n.x,o),p=ir(r.y,n.y,o),f=new hh(h,p,0,n.angleTo(r),c);return!s||ph(t,f,a,s,e)?f:void 0}l+=i}}function yh(t,e,r,n,i,o,s,a,l){const u=dh(n,o,s),c=mh(n,i),h=c*s,p=0===t[0].x||t[0].x===l||0===t[0].y||t[0].y===l;return e-h<e/4&&(e=h+e/4),_h(t,p?e/2*a%e:(c/2+2*o)*s*a%e,e,u,r,h,p,!1,l)}function _h(t,e,r,n,i,o,s,a,l){const u=o/2,c=fh(t);let h=0,p=e-r,f=[];for(let d=0;d<t.length-1;d++){const e=t[d],s=t[d+1],a=e.dist(s),m=s.angleTo(e);for(;p+r<h+a;){p+=r;const g=(p-h)/a,y=ir(e.x,s.x,g),_=ir(e.y,s.y,g);if(y>=0&&y<l&&_>=0&&_<l&&p-u>=0&&p+u<=c){const e=new hh(y,_,0,m,d);e._round(),n&&!ph(t,e,o,n,i)||f.push(e)}}h+=a}return a||f.length||s||(f=_h(t,h/2,r,n,i,o,s,!0,l)),f}function vh(t,e,r,n,o){const s=[];for(let a=0;a<t.length;a++){const l=t[a];let u;for(let t=0;t<l.length-1;t++){let a=l[t],c=l[t+1];a.x<e&&c.x<e||(a.x<e?a=new i(e,a.y+(e-a.x)/(c.x-a.x)*(c.y-a.y))._round():c.x<e&&(c=new i(e,a.y+(e-a.x)/(c.x-a.x)*(c.y-a.y))._round()),a.y<r&&c.y<r||(a.y<r?a=new i(a.x+(r-a.y)/(c.y-a.y)*(c.x-a.x),r)._round():c.y<r&&(c=new i(a.x+(r-a.y)/(c.y-a.y)*(c.x-a.x),r)._round()),a.x>=n&&c.x>=n||(a.x>=n?a=new i(n,a.y+(n-a.x)/(c.x-a.x)*(c.y-a.y))._round():c.x>=n&&(c=new i(n,a.y+(n-a.x)/(c.x-a.x)*(c.y-a.y))._round()),a.y>=o&&c.y>=o||(a.y>=o?a=new i(a.x+(o-a.y)/(c.y-a.y)*(c.x-a.x),o)._round():c.y>=o&&(c=new i(a.x+(o-a.y)/(c.y-a.y)*(c.x-a.x),o)._round()),u&&a.equals(u[u.length-1])||(u=[a],s.push(u)),u.push(c)))))}}return s}hi("Anchor",hh);const xh=1e20;function bh(t,e,r,n,i,o,s,a,l){for(let u=e;u<e+n;u++)wh(t,r*o+u,o,i,s,a,l);for(let u=r;u<r+i;u++)wh(t,u*o+e,1,n,s,a,l)}function wh(t,e,r,n,i,o,s){o[0]=0,s[0]=-xh,s[1]=xh,i[0]=t[e];for(let a=1,l=0,u=0;a<n;a++){i[a]=t[e+a*r];const n=a*a;do{const t=o[l];u=(i[a]-i[t]+n-t*t)/(a-t)/2}while(u<=s[l]&&--l>-1);l++,o[l]=a,s[l]=u,s[l+1]=xh}for(let a=0,l=0;a<n;a++){for(;s[l+1]<a;)l++;const n=o[l],u=a-n;t[e+a*r]=i[n]+u*u}}const Eh={none:0,ideographs:1,all:2};class Sh{constructor(t,e,r){this.requestManager=t,this.localGlyphMode=e,this.localFontFamily=r,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t){this.url=t}getGlyphs(t,e){const r=[];for(const n in t)for(const e of t[n])r.push({stack:n,id:e});_(r,({stack:t,id:e},r)=>{let n=this.entries[t];n||(n=this.entries[t]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let i=n.glyphs[e];if(void 0!==i)return void r(null,{stack:t,id:e,glyph:i});if(i=this._tinySDF(n,t,e),i)return n.glyphs[e]=i,void r(null,{stack:t,id:e,glyph:i});const o=Math.floor(e/256);if(256*o>65535)return void r(new Error("glyphs > 65535 not supported"));if(n.ranges[o])return void r(null,{stack:t,id:e,glyph:i});let s=n.requests[o];s||(s=n.requests[o]=[],Sh.loadGlyphRange(t,o,this.url,this.requestManager,(t,e)=>{if(e){n.ascender=e.ascender,n.descender=e.descender;for(const t in e.glyphs)this._doesCharSupportLocalGlyph(+t)||(n.glyphs[+t]=e.glyphs[+t]);n.ranges[o]=!0}for(const r of s)r(t,e);delete n.requests[o]})),s.push((n,i)=>{n?r(n):i&&r(null,{stack:t,id:e,glyph:i.glyphs[e]||null})})},(t,r)=>{if(t)e(t);else if(r){const t={};for(const{stack:e,id:n,glyph:i}of r)void 0===t[e]&&(t[e]={}),void 0===t[e].glyphs&&(t[e].glyphs={}),t[e].glyphs[n]=i&&{id:i.id,bitmap:i.bitmap.clone(),metrics:i.metrics},t[e].ascender=this.entries[e].ascender,t[e].descender=this.entries[e].descender;e(null,t)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==Eh.none&&(this.localGlyphMode===Eh.all?!!this.localFontFamily:!!this.localFontFamily&&(zi(t)||Oi(t)||Si(t)||Ii(t)||Ei(t)))}_tinySDF(t,e,r){const n=this.localFontFamily;if(!n||!this._doesCharSupportLocalGlyph(r))return;let i=t.tinySDF;if(!i){let r="400";/bold/i.test(e)?r="900":/medium/i.test(e)?r="500":/light/i.test(e)&&(r="200"),i=t.tinySDF=new Sh.TinySDF({fontFamily:n,fontWeight:r,fontSize:48,buffer:6,radius:16}),i.fontWeight=r}if(this.localGlyphs[i.fontWeight][r])return this.localGlyphs[i.fontWeight][r];const o=String.fromCharCode(r),{data:s,width:a,height:l,glyphWidth:u,glyphHeight:c,glyphLeft:h,glyphTop:p,glyphAdvance:f}=i.draw(o);return this.localGlyphs[i.fontWeight][r]={id:r,bitmap:new zl({width:a,height:l},s),metrics:{width:u/2,height:c/2,left:h/2,top:p/2-27,advance:f/2,localGlyph:!0}}}}function Ih(t,e,r,n){const o=[],s=t.image,a=s.pixelRatio,l=s.paddedRect.w-2,u=s.paddedRect.h-2,c=t.right-t.left,h=t.bottom-t.top,p=s.stretchX||[[0,l]],f=s.stretchY||[[0,u]],d=(t,e)=>t+e[1]-e[0],m=p.reduce(d,0),g=f.reduce(d,0),y=l-m,_=u-g;let v=0,x=m,b=0,w=g,E=0,S=y,I=0,T=_;if(s.content&&n){const t=s.content;v=Th(p,0,t[0]),b=Th(f,0,t[1]),x=Th(p,t[0],t[2]),w=Th(f,t[1],t[3]),E=t[0]-v,I=t[1]-b,S=t[2]-t[0]-x,T=t[3]-t[1]-w}const C=(n,o,l,u)=>{const p=Mh(n.stretch-v,x,c,t.left),f=Ah(n.fixed-E,S,n.stretch,m),d=Mh(o.stretch-b,w,h,t.top),y=Ah(o.fixed-I,T,o.stretch,g),_=Mh(l.stretch-v,x,c,t.left),C=Ah(l.fixed-E,S,l.stretch,m),M=Mh(u.stretch-b,w,h,t.top),A=Ah(u.fixed-I,T,u.stretch,g),P=new i(p,d),k=new i(_,d),L=new i(_,M),z=new i(p,M),D=new i(f/a,y/a),R=new i(C/a,A/a),O=e*Math.PI/180;if(O){const t=Math.sin(O),e=Math.cos(O),r=[e,-t,t,e];P._matMult(r),k._matMult(r),z._matMult(r),L._matMult(r)}const N=n.stretch+n.fixed,F=o.stretch+o.fixed;return{tl:P,tr:k,bl:z,br:L,tex:{x:s.paddedRect.x+1+N,y:s.paddedRect.y+1+F,w:l.stretch+l.fixed-N,h:u.stretch+u.fixed-F},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:D,pixelOffsetBR:R,minFontScaleX:S/a/c,minFontScaleY:T/a/h,isSDF:r}};if(n&&(s.stretchX||s.stretchY)){const t=Ch(p,y,m),e=Ch(f,_,g);for(let r=0;r<t.length-1;r++){const n=t[r],i=t[r+1];for(let t=0;t<e.length-1;t++)o.push(C(n,e[t],i,e[t+1]))}}else o.push(C({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:l+1},{fixed:0,stretch:u+1}));return o}function Th(t,e,r){let n=0;for(const i of t)n+=Math.max(e,Math.min(r,i[1]))-Math.max(e,Math.min(r,i[0]));return n}function Ch(t,e,r){const n=[{fixed:-1,stretch:0}];for(const[i,o]of t){const t=n[n.length-1];n.push({fixed:i-t.stretch,stretch:t.stretch}),n.push({fixed:i-t.stretch,stretch:t.stretch+(o-i)})}return n.push({fixed:e+1,stretch:r}),n}function Mh(t,e,r,n){return t/e*r+n}function Ah(t,e,r,n){return t-e*r/n}function Ph(t,e,r,n){const i=e+t.positionedLines[n].lineOffset;return 0===n?r+i/2:r+(i+(e+t.positionedLines[n-1].lineOffset))/2}Sh.loadGlyphRange=function(t,e,r,n,i){const o=256*e,s=o+255,a=n.transformRequest(n.normalizeGlyphsURL(r).replace("{fontstack}",t).replace("{range}",`${o}-${s}`),Et.Glyphs);Ct(a,(t,e)=>{if(t)i(t);else if(e){const t={},r=function(t){return new Ec(t).readFields(Gc,{})}(e);for(const e of r.glyphs)t[e.id]=e;i(null,{glyphs:t,ascender:r.ascender,descender:r.descender})}})},Sh.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:r=8,cutoff:n=.25,fontFamily:i="sans-serif",fontWeight:o="normal",fontStyle:s="normal"}){this.buffer=e,this.cutoff=n,this.radius=r;const a=this.size=t+4*e,l=this._createCanvas(a),u=this.ctx=l.getContext("2d",{willReadFrequently:!0});u.font=`${s} ${o} ${t}px ${i}`,u.textBaseline="alphabetic",u.textAlign="left",u.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:n,actualBoundingBoxLeft:i,actualBoundingBoxRight:o}=this.ctx.measureText(t),s=Math.floor(r),a=Math.min(this.size-this.buffer,Math.ceil(o-i)),l=Math.min(this.size-this.buffer,Math.ceil(r)+Math.ceil(n)),u=a+2*this.buffer,c=l+2*this.buffer,h=u*c,p=new Uint8ClampedArray(h),f={data:p,width:u,height:c,glyphWidth:a,glyphHeight:l,glyphTop:s,glyphLeft:0,glyphAdvance:e};if(0===a||0===l)return f;const{ctx:d,buffer:m,gridInner:g,gridOuter:y}=this;d.clearRect(m,m,a,l),d.fillText(t,m,m+s+1);const _=d.getImageData(m,m,a,l);y.fill(xh,0,h),g.fill(0,0,h);for(let v=0;v<l;v++)for(let t=0;t<a;t++){const e=_.data[4*(v*a+t)+3]/255;if(0===e)continue;const r=(v+m)*u+t+m;if(1===e)y[r]=0,g[r]=xh;else{const t=.5-e;y[r]=t>0?t*t:0,g[r]=t<0?t*t:0}}bh(y,0,0,u,c,u,this.f,this.v,this.z),bh(g,m,m,a,l,u,this.f,this.v,this.z);for(let v=0;v<h;v++){const t=Math.sqrt(y[v])-Math.sqrt(g[v]);p[v]=Math.round(255-255*(t/this.radius+this.cutoff))}return f}};class kh{constructor(t=[],e=Lh){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:r}=this,n=e[t];for(;t>0;){const i=t-1>>1,o=e[i];if(r(n,o)>=0)break;e[t]=o,t=i}e[t]=n}_down(t){const{data:e,compare:r}=this,n=this.length>>1,i=e[t];for(;t<n;){let n=1+(t<<1),o=e[n];const s=n+1;if(s<this.length&&r(e[s],o)<0&&(n=s,o=e[s]),r(o,i)>=0)break;e[t]=o,t=n}e[t]=i}}function Lh(t,e){return t<e?-1:t>e?1:0}function zh(t,e=1,r=!1){let n=1/0,o=1/0,s=-1/0,a=-1/0;const l=t[0];for(let i=0;i<l.length;i++){const t=l[i];(!i||t.x<n)&&(n=t.x),(!i||t.y<o)&&(o=t.y),(!i||t.x>s)&&(s=t.x),(!i||t.y>a)&&(a=t.y)}const u=Math.min(s-n,a-o);let c=u/2;const h=new kh([],Dh);if(0===u)return new i(n,o);for(let i=n;i<s;i+=u)for(let e=o;e<a;e+=u)h.push(new Rh(i+c,e+c,c,t));let p=function(t){let e=0,r=0,n=0;const i=t[0];for(let o=0,s=i.length,a=s-1;o<s;a=o++){const t=i[o],s=i[a],l=t.x*s.y-s.x*t.y;r+=(t.x+s.x)*l,n+=(t.y+s.y)*l,e+=3*l}return new Rh(r/e,n/e,0,t)}(t),f=h.length;for(;h.length;){const n=h.pop();(n.d>p.d||!p.d)&&(p=n,r&&console.log("found best %d after %d probes",Math.round(1e4*n.d)/1e4,f)),n.max-p.d<=e||(c=n.h/2,h.push(new Rh(n.p.x-c,n.p.y-c,c,t)),h.push(new Rh(n.p.x+c,n.p.y-c,c,t)),h.push(new Rh(n.p.x-c,n.p.y+c,c,t)),h.push(new Rh(n.p.x+c,n.p.y+c,c,t)),f+=4)}return r&&(console.log(`num probes: ${f}`),console.log(`best distance: ${p.d}`)),p.p}function Dh(t,e){return e.max-t.max}function Rh(t,e,r,n){this.p=new i(t,e),this.h=r,this.d=function(t,e){let r=!1,n=1/0;for(let i=0;i<e.length;i++){const o=e[i];for(let e=0,i=o.length,s=i-1;e<i;s=e++){const i=o[e],a=o[s];i.y>t.y!=a.y>t.y&&t.x<(a.x-i.x)*(t.y-i.y)/(a.y-i.y)+i.x&&(r=!r),n=Math.min(n,Ma(t,i,a))}}return(r?1:-1)*Math.sqrt(n)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}const Oh=Number.POSITIVE_INFINITY,Nh=Math.sqrt(2);function Fh(t,e){return e[1]!==Oh?function(t,e,r){let n=0,i=0;switch(e=Math.abs(e),r=Math.abs(r),t){case"top-right":case"top-left":case"top":i=r-7;break;case"bottom-right":case"bottom-left":case"bottom":i=7-r}switch(t){case"top-right":case"bottom-right":case"right":n=-e;break;case"top-left":case"bottom-left":case"left":n=e}return[n,i]}(t,e[0],e[1]):function(t,e){let r=0,n=0;e<0&&(e=0);const i=e/Nh;switch(t){case"top-right":case"top-left":n=i-7;break;case"bottom-right":case"bottom-left":n=7-i;break;case"bottom":n=7-e;break;case"top":n=e-7}switch(t){case"top-right":case"bottom-right":r=-i;break;case"top-left":case"bottom-left":r=i;break;case"left":r=e;break;case"right":r=-e}return[r,n]}(t,e[0])}function Bh(t,e,r,n,i,o,s,a,l,u){t.createArrays(),t.tilePixelRatio=Js/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const c=t.layers[0].layout,h=t.layers[0]._unevaluatedLayout._values,p={};if("composite"===t.textSizeData.kind){const{minZoom:e,maxZoom:r}=t.textSizeData;p.compositeTextSizes=[h["text-size"].possiblyEvaluate(new co(e),a),h["text-size"].possiblyEvaluate(new co(r),a)]}if("composite"===t.iconSizeData.kind){const{minZoom:e,maxZoom:r}=t.iconSizeData;p.compositeIconSizes=[h["icon-size"].possiblyEvaluate(new co(e),a),h["icon-size"].possiblyEvaluate(new co(r),a)]}p.layoutTextSize=h["text-size"].possiblyEvaluate(new co(l+1),a),p.layoutIconSize=h["icon-size"].possiblyEvaluate(new co(l+1),a),p.textMaxSize=h["text-size"].possiblyEvaluate(new co(18),a);const f="map"===c.get("text-rotation-alignment")&&"point"!==c.get("symbol-placement"),d=c.get("text-size");for(const m of t.features){const o=c.get("text-font").evaluate(m,{},a).join(","),l=d.evaluate(m,{},a),h=p.layoutTextSize.evaluate(m,{},a),g=(p.layoutIconSize.evaluate(m,{},a),{horizontal:{},vertical:void 0}),y=m.text;let _,v=[0,0];if(y){const n=y.toString(),s=c.get("text-letter-spacing").evaluate(m,{},a)*hc,u=c.get("text-line-height").evaluate(m,{},a)*hc,p=$i(n)?s:0,d=c.get("text-anchor").evaluate(m,{},a),_=c.get("text-variable-anchor");if(!_){const t=c.get("text-radial-offset").evaluate(m,{},a);v=t?Fh(d,[t*hc,Oh]):c.get("text-offset").evaluate(m,{},a).map(t=>t*hc)}let x=f?"center":c.get("text-justify").evaluate(m,{},a);const b=c.get("symbol-placement"),w="point"===b,E="point"===b?c.get("text-max-width").evaluate(m,{},a)*hc:0,S=s=>{t.allowVerticalPlacement&&qi(n)&&(g.vertical=Kc(y,e,r,i,o,E,u,d,s,p,v,Yc.vertical,!0,b,h,l))};if(!f&&_){const t="auto"===x?_.map(t=>jh(t)):[x];let n=!1;for(let s=0;s<t.length;s++){const a=t[s];if(!g.horizontal[a])if(n)g.horizontal[a]=g.horizontal[0];else{const t=Kc(y,e,r,i,o,E,u,"center",a,p,v,Yc.horizontal,!1,b,h,l);t&&(g.horizontal[a]=t,n=1===t.positionedLines.length)}}S("left")}else{if("auto"===x&&(x=jh(d)),w||c.get("text-writing-mode").indexOf("horizontal")>=0||!qi(n)){const t=Kc(y,e,r,i,o,E,u,d,x,p,v,Yc.horizontal,!1,b,h,l);t&&(g.horizontal[x]=t)}S("point"===b?"left":x)}}let x=!1;if(m.icon&&m.icon.name){const e=n[m.icon.name];e&&(_=uh(i[m.icon.name],c.get("icon-offset").evaluate(m,{},a),c.get("icon-anchor").evaluate(m,{},a)),x=e.sdf,void 0===t.sdfIcons?t.sdfIcons=e.sdf:t.sdfIcons!==e.sdf&&L("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(e.pixelRatio!==t.pixelRatio||0!==c.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}const b=qh(g.horizontal)||g.vertical;t.iconsInText||(t.iconsInText=!!b&&b.iconsInText),(b||_)&&Uh(t,m,g,_,n,p,h,0,v,x,s,a,u)}o&&t.generateCollisionDebugBuffers(l,t.collisionBoxArray)}function jh(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Uh(t,e,r,n,i,o,s,a,l,c,h,p,f){let d=o.textMaxSize.evaluate(e,{},p);void 0===d&&(d=s);const m=t.layers[0].layout,g=m.get("icon-offset").evaluate(e,{},p),y=qh(r.horizontal)||r.vertical,_=s/24,v=t.tilePixelRatio*d/24,x=(M=t.overscaling,t.zoom>18&&M>2&&(M>>=1),Math.max(Js/(512*M),1)*m.get("symbol-spacing")),b=m.get("text-padding")*t.tilePixelRatio,w=m.get("icon-padding")*t.tilePixelRatio,E=u(m.get("text-max-angle")),S="map"===m.get("text-rotation-alignment")&&"point"!==m.get("symbol-placement"),I="map"===m.get("icon-rotation-alignment")&&"point"!==m.get("symbol-placement"),T=m.get("symbol-placement"),C=x/2;var M;const A=m.get("icon-text-fit");let P;n&&"none"!==A&&(t.allowVerticalPlacement&&r.vertical&&(P=ch(n,r.vertical,A,m.get("icon-text-fit-padding"),g,_)),y&&(n=ch(n,y,A,m.get("icon-text-fit-padding"),g,_)));const k=(s,a,u)=>{if(a.x<0||a.x>=Js||a.y<0||a.y>=Js)return;const{x:d,y:m,z:y}=f.projectTilePoint(a.x,a.y,u),_=new hh(d,m,y,0,void 0);!function(t,e,r,n,i,o,s,a,l,u,c,h,p,f,d,m,g,y,_,v,x,b,w,E,S){const I=t.addToLineVertexArray(e,n);let T,C,M,A,P,k,z,D=0,R=0,O=0,N=0,F=-1,B=-1;const j={};let U=xs(""),V=0,G=0;if(void 0===l._unevaluatedLayout.getValue("text-radial-offset")?[V,G]=l.layout.get("text-offset").evaluate(x,{},S).map(t=>t*hc):(V=l.layout.get("text-radial-offset").evaluate(x,{},S)*hc,G=Oh),t.allowVerticalPlacement&&i.vertical){const t=i.vertical;if(d)k=Zh(t),a&&(z=Zh(a));else{const n=l.layout.get("text-rotate").evaluate(x,{},S)+90;M=$h(u,r,e,c,h,p,t,f,n,m),a&&(A=$h(u,r,e,c,h,p,a,y,n))}}if(o){const n=l.layout.get("icon-rotate").evaluate(x,{},S),i="none"!==l.layout.get("icon-text-fit"),s=Ih(o,n,w,i),f=a?Ih(a,n,w,i):void 0;C=$h(u,r,e,c,h,p,o,y,n),D=4*s.length;const d=t.iconSizeData;let m=null;"source"===d.kind?(m=[pc*l.layout.get("icon-size").evaluate(x,{},S)],m[0]>Vh&&L(`${t.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===d.kind&&(m=[pc*b.compositeIconSizes[0].evaluate(x,{},S),pc*b.compositeIconSizes[1].evaluate(x,{},S)],(m[0]>Vh||m[1]>Vh)&&L(`${t.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),t.addSymbols(t.icon,s,m,v,_,x,!1,r,e,I.lineStartIndex,I.lineLength,-1,E,S),F=t.icon.placedSymbolArray.length-1,f&&(R=4*f.length,t.addSymbols(t.icon,f,m,v,_,x,Yc.vertical,r,e,I.lineStartIndex,I.lineLength,-1,E,S),B=t.icon.placedSymbolArray.length-1)}for(const L in i.horizontal){const n=i.horizontal[L];T||(U=xs(n.text),d?P=Zh(n):T=$h(u,r,e,c,h,p,n,f,l.layout.get("text-rotate").evaluate(x,{},S),m));const o=1===n.positionedLines.length;if(O+=Gh(t,r,e,n,s,l,d,x,m,I,i.vertical?Yc.horizontal:Yc.horizontalOnly,o?Object.keys(i.horizontal):[L],j,F,b,E,S),o)break}i.vertical&&(N+=Gh(t,r,e,i.vertical,s,l,d,x,m,I,Yc.vertical,["vertical"],j,B,b,E,S));let q=-1;const $=(t,e)=>t?Math.max(t,e):e;q=$(P,q),q=$(k,q),q=$(z,q);const Z=q>-1?1:0;t.glyphOffsetArray.length>=ep.MAX_GLYPHS&&L("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&t.addToSortKeyRanges(t.symbolInstances.length,x.sortKey),t.symbolInstances.emplaceBack(r.x,r.y,r.z,e.x,e.y,j.right>=0?j.right:-1,j.center>=0?j.center:-1,j.left>=0?j.left:-1,j.vertical>=0?j.vertical:-1,F,B,U,void 0!==T?T:t.collisionBoxArray.length,void 0!==T?T+1:t.collisionBoxArray.length,void 0!==M?M:t.collisionBoxArray.length,void 0!==M?M+1:t.collisionBoxArray.length,void 0!==C?C:t.collisionBoxArray.length,void 0!==C?C+1:t.collisionBoxArray.length,A||t.collisionBoxArray.length,A?A+1:t.collisionBoxArray.length,c,O,N,D,R,Z,0,V,G,q)}(t,a,_,s,r,n,i,P,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,b,S,l,0,w,I,g,e,o,c,h,p)};if("line"===T)for(const u of vh(e.geometry,0,0,Js,Js)){const e=yh(u,x,E,r.vertical||y,n,24,v,t.overscaling,Js);for(const r of e){const e=y;e&&Xh(t,e.text,C,r)||k(u,r,p)}}else if("line-center"===T){for(const u of e.geometry)if(u.length>1){const t=gh(u,E,r.vertical||y,n,24,v);t&&k(u,t,p)}}else if("Polygon"===e.type)for(const u of _u(e.geometry,0)){const t=zh(u,16);k(u[0],new hh(t.x,t.y,0,0,void 0),p)}else if("LineString"===e.type)for(const u of e.geometry)k(u,new hh(u[0].x,u[0].y,0,0,void 0),p);else if("Point"===e.type)for(const u of e.geometry)for(const t of u)k([t],new hh(t.x,t.y,0,0,void 0),p)}const Vh=32640;function Gh(t,e,r,n,o,s,a,l,u,c,h,p,f,d,m,g,y){const _=function(t,e,r,n,o,s,a,l){const u=[];if(0===e.positionedLines.length)return u;const c=n.layout.get("text-rotate").evaluate(s,{})*Math.PI/180,h=function(t){const e=t[0],r=t[1],n=e*r;return n>0?[e,-r]:n<0?[-e,r]:0===e?[r,e]:[r,-e]}(r);let p=Math.abs(e.top-e.bottom);for(const i of e.positionedLines)p-=i.lineOffset;const f=e.positionedLines.length,d=p/f;let m=e.top-r[1];for(let g=0;g<f;++g){const t=e.positionedLines[g];m=Ph(e,d,m,g);for(const n of t.positionedGlyphs){if(!n.rect)continue;const t=n.rect||{};let s=4,p=!0,f=1,d=0;if(n.imageName){const t=a[n.imageName];if(!t)continue;if(t.sdf){L("SDF images are not supported in formatted text and will be ignored.");continue}p=!1,f=t.pixelRatio,s=1/f}const g=(o||l)&&n.vertical,y=n.metrics.advance*n.scale/2,_=n.metrics,v=n.rect;if(null===v)continue;l&&e.verticalizable&&(d=n.imageName?y-n.metrics.width*n.scale/2:0);const x=o?[n.x+y,n.y]:[0,0];let b=[0,0],w=[0,0],E=!1;o||(g?(w=[n.x+y+h[0],n.y+h[1]-d],E=!0):b=[n.x+y+r[0],n.y+r[1]-d]);const S=v.w*n.scale/(f*(n.localGlyph?2:1)),I=v.h*n.scale/(f*(n.localGlyph?2:1));let T,C,M,A;if(g){const t=n.y-m,e=new i(-y,y-t),r=-Math.PI/2,o=new i(...w);T=new i(-y+b[0],b[1]),T._rotateAround(r,e)._add(o),T.x+=-t+y,T.y-=(_.left-s)*n.scale;const a=n.imageName?_.advance*n.scale:hc*n.scale,l=String.fromCharCode(n.glyph);vc(l)?T.x+=(1-s)*n.scale:xc(l)?T.x+=a-_.height*n.scale+(-s-1)*n.scale:T.x+=n.imageName||_.width+2*s===v.w&&_.height+2*s===v.h?(a-I)/2:(a-(_.height+2*s)*n.scale)/2,C=new i(T.x,T.y-S),M=new i(T.x+I,T.y),A=new i(T.x+I,T.y-S)}else{const t=(_.left-s)*n.scale-y+b[0],e=(-_.top-s)*n.scale+b[1],r=t+S,o=e+I;T=new i(t,e),C=new i(r,e),M=new i(t,o),A=new i(r,o)}if(c){let t;t=o?new i(0,0):E?new i(h[0],h[1]):new i(r[0],r[1]),T._rotateAround(c,t),C._rotateAround(c,t),M._rotateAround(c,t),A._rotateAround(c,t)}const P=new i(0,0),k=new i(0,0);u.push({tl:T,tr:C,bl:M,br:A,tex:t,writingMode:e.writingMode,glyphOffset:x,sectionIndex:n.sectionIndex,isSDF:p,pixelOffsetTL:P,pixelOffsetBR:k,minFontScaleX:0,minFontScaleY:0})}}return u}(0,n,u,s,a,l,o,t.allowVerticalPlacement),v=t.textSizeData;let x=null;"source"===v.kind?(x=[pc*s.layout.get("text-size").evaluate(l,{},y)],x[0]>Vh&&L(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===v.kind&&(x=[pc*m.compositeTextSizes[0].evaluate(l,{},y),pc*m.compositeTextSizes[1].evaluate(l,{},y)],(x[0]>Vh||x[1]>Vh)&&L(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),t.addSymbols(t.text,_,x,u,a,l,h,e,r,c.lineStartIndex,c.lineLength,d,g,y);for(const i of p)f[i]=t.text.placedSymbolArray.length-1;return 4*_.length}function qh(t){for(const e in t)return t[e];return null}function $h(t,e,r,n,o,s,a,l,c,h){let p=a.top,f=a.bottom,d=a.left,m=a.right;const g=a.collisionPadding;if(g&&(d-=g[0],p-=g[1],m+=g[2],f+=g[3]),c){const t=new i(d,p),e=new i(m,p),r=new i(d,f),n=new i(m,f),o=u(c);let s=new i(0,0);h&&(s=new i(h[0],h[1])),t._rotateAround(o,s),e._rotateAround(o,s),r._rotateAround(o,s),n._rotateAround(o,s),d=Math.min(t.x,e.x,r.x,n.x),m=Math.max(t.x,e.x,r.x,n.x),p=Math.min(t.y,e.y,r.y,n.y),f=Math.max(t.y,e.y,r.y,n.y)}return t.emplaceBack(e.x,e.y,e.z,r.x,r.y,d,p,m,f,l,n,o,s),t.length-1}function Zh(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function Xh(t,e,r,n){const i=t.compareText;if(e in i){const t=i[e];for(let e=t.length-1;e>=0;e--)if(n.dist(t[e])<r)return!0}else i[e]=[];return i[e].push(n),!1}const Wh=Ou.VectorTileFeature.types,Yh=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Hh(t,e,r,n,i,o,s,a,l,u,c,h,p,f,d,m){const g=c?Math.min(Vh,Math.round(c[0])):0,y=c?Math.min(Vh,Math.round(c[1])):0;t.emplaceBack(e,r,Math.round(32*s),Math.round(32*a),l,u,(g<<1)+(h?1:0),y,16*p,16*f,256*d,256*m,n,i,o,0)}function Jh(t,e,r){t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r)}function Kh(t){for(const e of t.sections)if(Ji(e.text))return!0;return!1}class Qh{constructor(t){this.layoutVertexArray=new Fo,this.indexArray=new qo,this.programConfigurations=t,this.segments=new Hs,this.dynamicLayoutVertexArray=new Ro,this.opacityVertexArray=new Bo,this.placedSymbolArray=new os}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(t,e,r,n){this.isEmpty()||(r&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,oc.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,sc.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Yh,!0),this.opacityVertexBuffer.itemSize=1),(r||n)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}hi("SymbolBuffers",Qh);class tp{constructor(t,e,r){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new r,this.segments=new Hs,this.collisionVertexArray=new Go,this.collisionVertexArrayExt=new Ro}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,ac.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,lc.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}hi("CollisionBuffers",tp);class ep{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ga([]),this.placementViewportMatrix=Ga([]);const e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=fc(this.zoom,e["text-size"]),this.iconSizeData=fc(this.zoom,e["icon-size"]);const r=this.layers[0].layout,n=r.get("symbol-sort-key"),i=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==i&&void 0!==n.constantOr(1),this.sortFeaturesByY=("viewport-y"===i||"auto"===i&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=r.get("text-writing-mode").map(t=>Yc[t]),this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.sourceID=t.sourceID}createArrays(){this.text=new Qh(new js(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Qh(new js(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new ls,this.lineVertexArray=new us,this.symbolInstances=new as}calculateGlyphDependencies(t,e,r,n,i){for(let o=0;o<t.length;o++)if(e[t.charCodeAt(o)]=!0,n&&i){const r=_c[t.charAt(o)];r&&(e[r.charCodeAt(0)]=!0)}}populate(t,e,r,n){const i=this.layers[0],o=i.layout,s=o.get("text-font"),a=o.get("text-field"),l=o.get("icon-image"),u=("constant"!==a.value.kind||a.value.value instanceof me&&!a.value.value.isEmpty()||a.value.value.toString().length>0)&&("constant"!==s.value.kind||s.value.value.length>0),c="constant"!==l.value.kind||!!l.value.value||Object.keys(l.parameters).length>0,h=o.get("symbol-sort-key");if(this.features=[],!u&&!c)return;const p=e.iconDependencies,f=e.glyphDependencies,d=e.availableImages,m=new co(this.zoom);for(const{feature:g,id:y,index:_,sourceLayerIndex:v}of t){const t=i._featureFilter.needGeometry,e=ya(g,t);if(!i._featureFilter.filter(m,e,r))continue;let a,l;if(t||(e.geometry=ga(g,r,n)),u){const t=i.getValueAndResolveTokens("text-field",e,r,d),n=me.factory(t);Kh(n)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===ao()||this.hasRTLText&&uo.isParsed())&&(a=yc(n,i,e))}if(c){const t=i.getValueAndResolveTokens("icon-image",e,r,d);l=t instanceof ge?t:ge.fromString(t)}if(!a&&!l)continue;const x=this.sortFeaturesByKey?h.evaluate(e,{},r):void 0;if(this.features.push({id:y,text:a,icon:l,index:_,sourceLayerIndex:v,geometry:e.geometry,properties:g.properties,type:Wh[g.type],sortKey:x}),l&&(p[l.name]=!0),a){const t=s.evaluate(e,{},r).join(","),n="map"===o.get("text-rotation-alignment")&&"point"!==o.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Yc.vertical)>=0;for(const e of a.sections)if(e.image)p[e.image.name]=!0;else{const r=qi(a.toString()),i=e.fontStack||t,o=f[i]=f[i]||{};this.calculateGlyphDependencies(e.text,o,n,this.allowVerticalPlacement,r)}}}"line"===o.get("symbol-placement")&&(this.features=function(t){const e={},r={},n=[];let i=0;function o(e){n.push(t[e]),i++}function s(t,e,i){const o=r[t];return delete r[t],r[e]=o,n[o].geometry[0].pop(),n[o].geometry[0]=n[o].geometry[0].concat(i[0]),o}function a(t,r,i){const o=e[r];return delete e[r],e[t]=o,n[o].geometry[0].shift(),n[o].geometry[0]=i[0].concat(n[o].geometry[0]),o}function l(t,e,r){const n=r?e[0][e[0].length-1]:e[0][0];return`${t}:${n.x}:${n.y}`}for(let u=0;u<t.length;u++){const c=t[u],h=c.geometry,p=c.text?c.text.toString():null;if(!p){o(u);continue}const f=l(p,h),d=l(p,h,!0);if(f in r&&d in e&&r[f]!==e[d]){const t=a(f,d,h),i=s(f,d,n[t].geometry);delete e[f],delete r[d],r[l(p,n[i].geometry,!0)]=i,n[t].geometry=null}else f in r?s(f,d,h):d in e?a(f,d,h):(o(u),e[f]=i-1,r[d]=i-1)}return n.filter(t=>t.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((t,e)=>t.sortKey-e.sortKey)}update(t,e,r,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,r,n),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,r,n))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,e){const r=this.lineVertexArray.length,n=t.segment;if(void 0!==n){let r=t.dist(e[n+1]),i=t.dist(e[n]);const o={};for(let t=n+1;t<e.length;t++)o[t]={x:e[t].x,y:e[t].y,tileUnitDistanceFromAnchor:r},t<e.length-1&&(r+=e[t+1].dist(e[t]));for(let t=n||0;t>=0;t--)o[t]={x:e[t].x,y:e[t].y,tileUnitDistanceFromAnchor:i},t>0&&(i+=e[t-1].dist(e[t]));for(let t=0;t<e.length;t++){const e=o[t];this.lineVertexArray.emplaceBack(e.x,e.y,e.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}}addSymbols(t,e,r,n,i,o,s,a,l,u,c,h,p,f){const d=t.indexArray,m=t.layoutVertexArray,g=t.segments.prepareSegment(4*e.length,m,d,this.canOverlap?o.sortKey:void 0),y=this.glyphOffsetArray.length,_=g.vertexLength,v=this.allowVerticalPlacement&&s===Yc.vertical?Math.PI/2:0,x=o.text&&o.text.sections;for(let b=0;b<e.length;b++){const{tl:n,tr:i,bl:s,br:u,tex:c,pixelOffsetTL:h,pixelOffsetBR:y,minFontScaleX:_,minFontScaleY:w,glyphOffset:E,isSDF:S,sectionIndex:I}=e[b],T=g.vertexLength,C=E[1];Hh(m,a.x,a.y,a.z,l.x,l.y,n.x,C+n.y,c.x,c.y,r,S,h.x,h.y,_,w),Hh(m,a.x,a.y,a.z,l.x,l.y,i.x,C+i.y,c.x+c.w,c.y,r,S,y.x,h.y,_,w),Hh(m,a.x,a.y,a.z,l.x,l.y,s.x,C+s.y,c.x,c.y+c.h,r,S,h.x,y.y,_,w),Hh(m,a.x,a.y,a.z,l.x,l.y,u.x,C+u.y,c.x+c.w,c.y+c.h,r,S,y.x,y.y,_,w),Jh(t.dynamicLayoutVertexArray,a,v),d.emplaceBack(T,T+1,T+2),d.emplaceBack(T+1,T+2,T+3),g.vertexLength+=4,g.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(E[0]),b!==e.length-1&&I===e[b+1].sectionIndex||t.programConfigurations.populatePaintArrays(m.length,o,o.index,{},p,f,x&&x[I])}t.placedSymbolArray.emplaceBack(a.x,a.y,a.z,l.x,l.y,y,this.glyphOffsetArray.length-y,_,u,c,l.segment,r?r[0]:0,r?r[1]:0,n[0],n[1],s,0,!1,0,h,0)}_commitLayoutVertex(t,e,r,n,i,o,s){t.emplaceBack(e,r,n,i,o,Math.round(s.x),Math.round(s.y))}_addCollisionDebugVertices(t,e,r,n,o,s,a){const l=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),u=l.vertexLength,c=a.tileAnchorX,h=a.tileAnchorY;for(let i=0;i<4;i++)r.collisionVertexArray.emplaceBack(0,0,0,0);r.collisionVertexArrayExt.emplaceBack(e,-t.padding,-t.padding),r.collisionVertexArrayExt.emplaceBack(e,t.padding,-t.padding),r.collisionVertexArrayExt.emplaceBack(e,t.padding,t.padding),r.collisionVertexArrayExt.emplaceBack(e,-t.padding,t.padding),this._commitLayoutVertex(r.layoutVertexArray,n,o,s,c,h,new i(t.x1,t.y1)),this._commitLayoutVertex(r.layoutVertexArray,n,o,s,c,h,new i(t.x2,t.y1)),this._commitLayoutVertex(r.layoutVertexArray,n,o,s,c,h,new i(t.x2,t.y2)),this._commitLayoutVertex(r.layoutVertexArray,n,o,s,c,h,new i(t.x1,t.y2)),l.vertexLength+=4;const p=r.indexArray;p.emplaceBack(u,u+1),p.emplaceBack(u+1,u+2),p.emplaceBack(u+2,u+3),p.emplaceBack(u+3,u),l.primitiveLength+=4}_addTextDebugCollisionBoxes(t,e,r,n,i,o){for(let s=n;s<i;s++){const n=r.get(s),i=this.getSymbolInstanceTextSize(t,o,e,s);this._addCollisionDebugVertices(n,i,this.textCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,o)}}_addIconDebugCollisionBoxes(t,e,r,n,i,o){for(let s=n;s<i;s++){const n=r.get(s),i=this.getSymbolInstanceIconSize(t,e,s);this._addCollisionDebugVertices(n,i,this.iconCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,o)}}generateCollisionDebugBuffers(t,e){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new tp(Uo,uc.members,Jo),this.iconCollisionBox=new tp(Uo,uc.members,Jo);const r=mc(this.iconSizeData,t),n=mc(this.textSizeData,t);for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this._addTextDebugCollisionBoxes(n,t,e,o.textBoxStartIndex,o.textBoxEndIndex,o),this._addTextDebugCollisionBoxes(n,t,e,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._addIconDebugCollisionBoxes(r,t,e,o.iconBoxStartIndex,o.iconBoxEndIndex,o),this._addIconDebugCollisionBoxes(r,t,e,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o)}}getSymbolInstanceTextSize(t,e,r,n){const i=this.text.placedSymbolArray.get(e.rightJustifiedTextSymbolIndex>=0?e.rightJustifiedTextSymbolIndex:e.centerJustifiedTextSymbolIndex>=0?e.centerJustifiedTextSymbolIndex:e.leftJustifiedTextSymbolIndex>=0?e.leftJustifiedTextSymbolIndex:e.verticalPlacedTextSymbolIndex>=0?e.verticalPlacedTextSymbolIndex:n),o=dc(this.textSizeData,t,i)/hc;return this.tilePixelRatio*o}getSymbolInstanceIconSize(t,e,r){const n=this.icon.placedSymbolArray.get(r),i=dc(this.iconSizeData,t,n);return this.tilePixelRatio*i}_commitDebugCollisionVertexUpdate(t,e,r){t.emplaceBack(e,-r,-r),t.emplaceBack(e,r,-r),t.emplaceBack(e,r,r),t.emplaceBack(e,-r,r)}_updateTextDebugCollisionBoxes(t,e,r,n,i,o){for(let s=n;s<i;s++){const n=r.get(s),i=this.getSymbolInstanceTextSize(t,o,e,s);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,i,n.padding)}}_updateIconDebugCollisionBoxes(t,e,r,n,i){for(let o=n;o<i;o++){const n=r.get(o),i=this.getSymbolInstanceIconSize(t,e,o);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,i,n.padding)}}updateCollisionDebugBuffers(t,e){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const r=mc(this.iconSizeData,t),n=mc(this.textSizeData,t);for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this._updateTextDebugCollisionBoxes(n,t,e,o.textBoxStartIndex,o.textBoxEndIndex,o),this._updateTextDebugCollisionBoxes(n,t,e,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._updateIconDebugCollisionBoxes(r,t,e,o.iconBoxStartIndex,o.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(r,t,e,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,e,r,n,i,o,s,a,l){const u={};for(let c=e;c<r;c++){const e=t.get(c);u.textBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,padding:e.padding,projectedAnchorX:e.projectedAnchorX,projectedAnchorY:e.projectedAnchorY,projectedAnchorZ:e.projectedAnchorZ,tileAnchorX:e.tileAnchorX,tileAnchorY:e.tileAnchorY},u.textFeatureIndex=e.featureIndex;break}for(let c=n;c<i;c++){const e=t.get(c);u.verticalTextBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,padding:e.padding,projectedAnchorX:e.projectedAnchorX,projectedAnchorY:e.projectedAnchorY,projectedAnchorZ:e.projectedAnchorZ,tileAnchorX:e.tileAnchorX,tileAnchorY:e.tileAnchorY},u.verticalTextFeatureIndex=e.featureIndex;break}for(let c=o;c<s;c++){const e=t.get(c);u.iconBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,padding:e.padding,projectedAnchorX:e.projectedAnchorX,projectedAnchorY:e.projectedAnchorY,projectedAnchorZ:e.projectedAnchorZ,tileAnchorX:e.tileAnchorX,tileAnchorY:e.tileAnchorY},u.iconFeatureIndex=e.featureIndex;break}for(let c=a;c<l;c++){const e=t.get(c);u.verticalIconBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,padding:e.padding,projectedAnchorX:e.projectedAnchorX,projectedAnchorY:e.projectedAnchorY,projectedAnchorZ:e.projectedAnchorZ,tileAnchorX:e.tileAnchorX,tileAnchorY:e.tileAnchorY},u.verticalIconFeatureIndex=e.featureIndex;break}return u}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,e){const r=t.placedSymbolArray.get(e),n=r.vertexStartIndex+4*r.numGlyphs;for(let i=r.vertexStartIndex;i<n;i+=4)t.indexArray.emplaceBack(i,i+1,i+2),t.indexArray.emplaceBack(i+1,i+2,i+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const e=Math.sin(t),r=Math.cos(t),n=[],i=[],o=[];for(let s=0;s<this.symbolInstances.length;++s){o.push(s);const t=this.symbolInstances.get(s);n.push(0|Math.round(e*t.tileAnchorX+r*t.tileAnchorY)),i.push(t.featureIndex)}return o.sort((t,e)=>n[t]-n[e]||i[e]-i[t]),o}addToSortKeyRanges(t,e){const r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===e?r.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const e=this.symbolInstances.get(t);this.featureSortOrder.push(e.featureIndex),[e.rightJustifiedTextSymbolIndex,e.centerJustifiedTextSymbolIndex,e.leftJustifiedTextSymbolIndex].forEach((t,e,r)=>{t>=0&&r.indexOf(t)===e&&this.addIndicesForPlacedSymbol(this.text,t)}),e.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,e.verticalPlacedTextSymbolIndex),e.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,e.placedIconSymbolIndex),e.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,e.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}hi("SymbolBucket",ep,{omit:["layers","collisionBoxArray","features","compareText"]}),ep.MAX_GLYPHS=65535,ep.addDynamicAttributes=Jh;const rp=new Io({"symbol-placement":new xo(jt.layout_symbol["symbol-placement"]),"symbol-spacing":new xo(jt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new xo(jt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new bo(jt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new xo(jt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new xo(jt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new xo(jt.layout_symbol["icon-ignore-placement"]),"icon-optional":new xo(jt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new xo(jt.layout_symbol["icon-rotation-alignment"]),"icon-size":new bo(jt.layout_symbol["icon-size"]),"icon-text-fit":new xo(jt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new xo(jt.layout_symbol["icon-text-fit-padding"]),"icon-image":new bo(jt.layout_symbol["icon-image"]),"icon-rotate":new bo(jt.layout_symbol["icon-rotate"]),"icon-padding":new xo(jt.layout_symbol["icon-padding"]),"icon-keep-upright":new xo(jt.layout_symbol["icon-keep-upright"]),"icon-offset":new bo(jt.layout_symbol["icon-offset"]),"icon-anchor":new bo(jt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new xo(jt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new xo(jt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new xo(jt.layout_symbol["text-rotation-alignment"]),"text-field":new bo(jt.layout_symbol["text-field"]),"text-font":new bo(jt.layout_symbol["text-font"]),"text-size":new bo(jt.layout_symbol["text-size"]),"text-max-width":new bo(jt.layout_symbol["text-max-width"]),"text-line-height":new bo(jt.layout_symbol["text-line-height"]),"text-letter-spacing":new bo(jt.layout_symbol["text-letter-spacing"]),"text-justify":new bo(jt.layout_symbol["text-justify"]),"text-radial-offset":new bo(jt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new xo(jt.layout_symbol["text-variable-anchor"]),"text-anchor":new bo(jt.layout_symbol["text-anchor"]),"text-max-angle":new xo(jt.layout_symbol["text-max-angle"]),"text-writing-mode":new xo(jt.layout_symbol["text-writing-mode"]),"text-rotate":new bo(jt.layout_symbol["text-rotate"]),"text-padding":new xo(jt.layout_symbol["text-padding"]),"text-keep-upright":new xo(jt.layout_symbol["text-keep-upright"]),"text-transform":new bo(jt.layout_symbol["text-transform"]),"text-offset":new bo(jt.layout_symbol["text-offset"]),"text-allow-overlap":new xo(jt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new xo(jt.layout_symbol["text-ignore-placement"]),"text-optional":new xo(jt.layout_symbol["text-optional"])});var np={paint:new Io({"icon-opacity":new bo(jt.paint_symbol["icon-opacity"]),"icon-color":new bo(jt.paint_symbol["icon-color"]),"icon-halo-color":new bo(jt.paint_symbol["icon-halo-color"]),"icon-halo-width":new bo(jt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new bo(jt.paint_symbol["icon-halo-blur"]),"icon-translate":new xo(jt.paint_symbol["icon-translate"]),"icon-translate-anchor":new xo(jt.paint_symbol["icon-translate-anchor"]),"text-opacity":new bo(jt.paint_symbol["text-opacity"]),"text-color":new bo(jt.paint_symbol["text-color"],{runtimeType:Kt,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new bo(jt.paint_symbol["text-halo-color"]),"text-halo-width":new bo(jt.paint_symbol["text-halo-width"]),"text-halo-blur":new bo(jt.paint_symbol["text-halo-blur"]),"text-translate":new xo(jt.paint_symbol["text-translate"]),"text-translate-anchor":new xo(jt.paint_symbol["text-translate-anchor"])}),layout:rp};class ip{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Wt,this.defaultValue=t}evaluate(t){if(t.formattedSection){const e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}hi("FormatSectionOverride",ip,{omit:["defaultValue"]});class op extends Xs{constructor(t){super(t,np)}recalculate(t,e){super.recalculate(t,e),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const r=this.layout.get("text-writing-mode");if(r){const t=[];for(const e of r)t.indexOf(e)<0&&t.push(e);this.layout._values["text-writing-mode"]=t}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,e,r,n){const i=this.layout.get(t).evaluate(e,{},r,n),o=this._unevaluatedLayout._values[t];return o.isDataDriven()||hn(o.value)||!i?i:function(t,e){return e.replace(/{([^{}]+)}/g,(e,r)=>r in t?String(t[r]):"")}(e.properties,i)}createBucket(t){return new ep(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of np.paint.overridableProperties){if(!op.hasPaintOverride(this.layout,t))continue;const e=this.paint.get(t),r=new ip(e),n=new cn(r,e.property.specification);let i=null;i="constant"===e.value.kind||"source"===e.value.kind?new fn("source",n):new dn("composite",n,e.value.zoomStops,e.value._interpolationType),this.paint._values[t]=new _o(e.property,i,e.parameters)}}_handleOverridablePaintPropertyUpdate(t,e,r){return!(!this.layout||e.isDataDriven()||r.isDataDriven())&&op.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,e){const r=t.get("text-field"),n=np.paint.properties[e];let i=!1;const o=t=>{for(const e of t)if(n.overrides&&n.overrides.hasOverride(e))return void(i=!0)};if("constant"===r.value.kind&&r.value.value instanceof me)o(r.value.value.sections);else if("source"===r.value.kind){const t=e=>{i||(e instanceof be&&ve(e.value)===re?o(e.value.sections):e instanceof Ie?o(e.sections):e.eachChild(t))},e=r.value;e._styleExpression&&t(e._styleExpression.expression)}return i}getProgramConfiguration(t){return new Bs(this,t)}}var sp={paint:new Io({"background-color":new xo(jt.paint_background["background-color"]),"background-pattern":new Eo(jt.paint_background["background-pattern"]),"background-opacity":new xo(jt.paint_background["background-opacity"])})},ap={paint:new Io({"raster-opacity":new xo(jt.paint_raster["raster-opacity"]),"raster-hue-rotate":new xo(jt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new xo(jt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new xo(jt.paint_raster["raster-brightness-max"]),"raster-saturation":new xo(jt.paint_raster["raster-saturation"]),"raster-contrast":new xo(jt.paint_raster["raster-contrast"]),"raster-resampling":new xo(jt.paint_raster["raster-resampling"]),"raster-fade-duration":new xo(jt.paint_raster["raster-fade-duration"])})};class lp extends Xs{constructor(t){super(t,{}),this.implementation=t}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}var up={paint:new Io({"sky-type":new xo(jt.paint_sky["sky-type"]),"sky-atmosphere-sun":new xo(jt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new xo(jt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new xo(jt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new xo(jt.paint_sky["sky-gradient-radius"]),"sky-gradient":new So(jt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new xo(jt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new xo(jt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new xo(jt.paint_sky["sky-opacity"])})};function cp(t,e,r){const n=[0,0,1],i=_l([]);return function(t,e,r){r*=.5;var n=e[0],i=e[1],o=e[2],s=e[3],a=Math.sin(r),l=Math.cos(r);t[0]=n*l-o*a,t[1]=i*l+s*a,t[2]=o*l+n*a,t[3]=s*l-i*a}(i,i,r?-u(t)+Math.PI:u(t)),vl(i,i,-u(e)),cl(n,n,i),sl(n,n)}const hp={circle:class extends Xs{constructor(t){super(t,Fa)}createBucket(t){return new xa(t)}queryRadius(t){const e=t;return za("circle-radius",this,e)+za("circle-stroke-width",this,e)+Da(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,r,n,i,o,s,a){const l=Oa(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),u=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return Sl(t,n,o,s,a,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),l,u)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new Bs(this,t)}},heatmap:class extends Xs{createBucket(t){return new Al(t)}constructor(t){super(t,Rl),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ol({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return za("heatmap-radius",this,t)}queryIntersectsFeature(t,e,r,n,o,s,a,l){const u=this.paint.get("heatmap-radius").evaluate(e,r);return Sl(t,n,s,a,l,!0,!0,new i(0,0),u)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new Bs(this,t)}},hillshade:class extends Xs{constructor(t){super(t,Nl)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(t){return new Bs(this,t)}},fill:class extends Xs{constructor(t){super(t,Su)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getProgramConfiguration(t){return new Bs(this,t)}recalculate(t,e){super.recalculate(t,e);const r=this.paint._values["fill-outline-color"];"constant"===r.value.kind&&void 0===r.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new wu(t)}queryRadius(){return Da(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,r,n,i,o){return!t.queryGeometry.isAboveHorizon&&Ea(Ra(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),n)}isTileClipped(){return!0}},"fill-extrusion":class extends Xs{constructor(t){super(t,Gu)}createBucket(t){return new Uu(t)}queryRadius(){return Da(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new Bs(this,t)}queryIntersectsFeature(t,e,r,n,o,s,a,l,u){const c=Oa(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),s.angle,t.pixelToTileUnitsFactor),h=this.paint.get("fill-extrusion-height").evaluate(e,r),p=this.paint.get("fill-extrusion-base").evaluate(e,r),f=[0,0],d=l&&s.elevation,m=s.elevation?s.elevation.exaggeration():1;if(d){const e=t.tile.getBucket(this).centroidVertexArray,r=u+1;if(r<e.length){const t=e.get(r);f[0]=t.a_centroid_pos0,f[1]=t.a_centroid_pos1}}if(0===f[0]&&1===f[1])return!1;const g=function(t,e,r,n,o,s,a,l,u){return s?function(t,e,r,n,i,o,s,a,l){const u=[],c=[],h=[0,0,0,1];for(const p of t){const t=[],f=[];for(const u of p){const c=u.x+n.x,p=u.y+n.y,d=Xu(c,p,e,r,o,s,a,l);h[0]=c,h[1]=p,h[2]=d.base,h[3]=1,gl(h,h,i),h[3]=Math.max(h[3],1e-5);const m=Zu([h[0]/h[3],h[1]/h[3],h[2]/h[3]]);h[0]=c,h[1]=p,h[2]=d.top,h[3]=1,gl(h,h,i),h[3]=Math.max(h[3],1e-5);const g=Zu([h[0]/h[3],h[1]/h[3],h[2]/h[3]]);t.push(m),f.push(g)}u.push(t),c.push(f)}return[u,c]}(t,e,r,n,o,s,a,l,u):function(t,e,r,n,o){const s=[],a=[],l=o[8]*e,u=o[9]*e,c=o[10]*e,h=o[11]*e,p=o[8]*r,f=o[9]*r,d=o[10]*r,m=o[11]*r;for(const g of t){const t=[],e=[];for(const r of g){const s=r.x+n.x,a=r.y+n.y,g=o[0]*s+o[4]*a+o[12],y=o[1]*s+o[5]*a+o[13],_=o[2]*s+o[6]*a+o[14],v=o[3]*s+o[7]*a+o[15],x=g+l,b=y+u,w=_+c,E=Math.max(v+h,1e-5),S=g+p,I=y+f,T=_+d,C=Math.max(v+m,1e-5),M=new i(x/E,b/E);M.z=w/E,t.push(M);const A=new i(S/C,I/C);A.z=T/C,e.push(A)}s.push(t),a.push(e)}return[s,a]}(t,e,r,n,o)}(n,p,h,c,a,d?l:null,f,m,s.center.lat),y=t.queryGeometry;return function(t,e,r){let n=1/0;Ea(r,e)&&(n=$u(r,e[0]));for(let i=0;i<e.length;i++){const o=e[i],s=t[i];for(let t=0;t<o.length-1;t++){const e=o[t],i=[e,o[t+1],s[t+1],s[t],e];ba(r,i)&&(n=Math.min(n,$u(r,i)))}}return n!==1/0&&n}(g[0],g[1],y.isPointQuery()?y.screenBounds:y.screenGeometry)}},line:class extends Xs{constructor(t){super(t,rc),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof nr,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=nc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new tc(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new Bs(this,t)}queryRadius(t){const e=t,r=ic(za("line-width",this,e),za("line-gap-width",this,e)),n=za("line-offset",this,e);return r/2+Math.abs(n)+Da(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,r,n,o,s){if(t.queryGeometry.isAboveHorizon)return!1;const a=Ra(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),s.angle,t.pixelToTileUnitsFactor),l=t.pixelToTileUnitsFactor/2*ic(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),u=this.paint.get("line-offset").evaluate(e,r);return u&&(n=function(t,e){const r=[],n=new i(0,0);for(let i=0;i<t.length;i++){const o=t[i],s=[];for(let t=0;t<o.length;t++){const r=o[t-1],i=o[t],a=o[t+1],l=0===t?n:i.sub(r)._unit()._perp(),u=t===o.length-1?n:a.sub(i)._unit()._perp(),c=l._add(u)._unit();c._mult(1/(c.x*u.x+c.y*u.y)),s.push(c._mult(e)._add(i))}r.push(s)}return r}(n,u*t.pixelToTileUnitsFactor)),function(t,e,r){for(let n=0;n<e.length;n++){const i=e[n];if(t.length>=3)for(let e=0;e<i.length;e++)if(Pa(t,i[e]))return!0;if(Sa(t,i,r))return!0}return!1}(a,n,l)}isTileClipped(){return!0}},symbol:op,background:class extends Xs{constructor(t){super(t,sp)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Xs{constructor(t){super(t,ap)}getProgramIds(){return["raster"]}},sky:class extends Xs{constructor(t){super(t,up),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"sky-gradient"===t?this._updateColorRamp():"sky-atmosphere-sun"!==t&&"sky-atmosphere-halo-color"!==t&&"sky-atmosphere-color"!==t&&"sky-atmosphere-sun-intensity"!==t||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Ol({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}}getCenter(t,e){if("atmosphere"===this.paint.get("sky-type")){const r=this.paint.get("sky-atmosphere-sun"),n=!r,i=t.style.light,o=i.properties.get("position");return n&&"viewport"===i.properties.get("anchor")&&L("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),n?cp(o.azimuthal,90-o.polar,e):cp(r[0],90-r[1],e)}const r=this.paint.get("sky-gradient-center");return cp(r[0],90-r[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return"atmosphere"===t?["skyboxCapture","skybox"]:"gradient"===t?["skyboxGradient"]:null}}};class pp{constructor(t,e,r,n){this.context=t,this.format=r,this.texture=t.gl.createTexture(),this.update(e,n)}update(t,e,r){const{width:n,height:i}=t,{context:o}=this,{gl:a}=o,{HTMLImageElement:l,HTMLCanvasElement:u,HTMLVideoElement:c,ImageData:h,ImageBitmap:p}=s;if(a.bindTexture(a.TEXTURE_2D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(this.format===a.RGBA&&(!e||!1!==e.premultiply)),r||this.size&&this.size[0]===n&&this.size[1]===i){const{x:e,y:o}=r||{x:0,y:0};t instanceof l||t instanceof u||t instanceof c||t instanceof h||p&&t instanceof p?a.texSubImage2D(a.TEXTURE_2D,0,e,o,a.RGBA,a.UNSIGNED_BYTE,t):a.texSubImage2D(a.TEXTURE_2D,0,e,o,n,i,a.RGBA,a.UNSIGNED_BYTE,t.data)}else this.size=[n,i],t instanceof l||t instanceof u||t instanceof c||t instanceof h||p&&t instanceof p?a.texImage2D(a.TEXTURE_2D,0,this.format,this.format,a.UNSIGNED_BYTE,t):a.texImage2D(a.TEXTURE_2D,0,this.format,n,i,0,this.format,a.UNSIGNED_BYTE,t.data);this.useMipmap=Boolean(e&&e.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&a.generateMipmap(a.TEXTURE_2D)}bind(t,e){const{context:r}=this,{gl:n}=r;n.bindTexture(n.TEXTURE_2D,this.texture),t!==this.filter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,this.useMipmap?t===n.NEAREST?n.NEAREST_MIPMAP_NEAREST:n.LINEAR_MIPMAP_NEAREST:t),this.filter=t),e!==this.wrap&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,e),this.wrap=e)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class fp{constructor(t,e){this.width=t,this.height=e,this.nextRow=0,this.image=new zl({width:t,height:e}),this.positions={},this.uploaded=!1}getDash(t,e){const r=this.getKey(t,e);return this.positions[r]}trim(){const t=this.width,e=this.height=S(this.nextRow);this.image.resize({width:t,height:e})}getKey(t,e){return t.join(",")+e}getDashRanges(t,e,r){const n=[];let i=t.length%2==1?-t[t.length-1]*r:0,o=t[0]*r,s=!0;n.push({left:i,right:o,isDash:s,zeroLength:0===t[0]});let a=t[0];for(let l=1;l<t.length;l++){s=!s;const e=t[l];i=a*r,a+=e,o=a*r,n.push({left:i,right:o,isDash:s,zeroLength:0===e})}return n}addRoundDash(t,e,r){const n=e/2;for(let i=-r;i<=r;i++){const e=this.width*(this.nextRow+r+i);let o=0,s=t[o];for(let a=0;a<this.width;a++){a/s.right>1&&(s=t[++o]);const l=Math.abs(a-s.left),u=Math.abs(a-s.right),c=Math.min(l,u);let h;const p=i/r*(n+1);if(s.isDash){const t=n-Math.abs(p);h=Math.sqrt(c*c+t*t)}else h=n-Math.sqrt(c*c+p*p);this.image.data[e+a]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(t,e){for(let a=t.length-1;a>=0;--a){const e=t[a],r=t[a+1];e.zeroLength?t.splice(a,1):r&&r.isDash===e.isDash&&(r.left=e.left,t.splice(a,1))}const r=t[0],n=t[t.length-1];r.isDash===n.isDash&&(r.left=n.left-this.width,n.right=r.right+this.width);const i=this.width*this.nextRow;let o=0,s=t[o];for(let a=0;a<this.width;a++){a/s.right>1&&(s=t[++o]);const r=Math.abs(a-s.left),n=Math.abs(a-s.right),l=Math.min(r,n);this.image.data[i+a]=Math.max(0,Math.min(255,(s.isDash?l:-l)+e+128))}}addDash(t,e){const r=this.getKey(t,e);if(this.positions[r])return this.positions[r];const n="round"===e,i=n?7:0,o=2*i+1;if(this.nextRow+o>this.height)return L("LineAtlas out of space"),null;0===t.length&&t.push(1);let s=0;for(let u=0;u<t.length;u++)t[u]<0&&(L("Negative value is found in line dasharray, replacing values with 0"),t[u]=0),s+=t[u];if(0!==s){const r=this.width/s,o=this.getDashRanges(t,this.width,r);n?this.addRoundDash(o,r,i):this.addRegularDash(o,"square"===e?.5*r:0)}const a=this.nextRow+i;this.nextRow+=o;const l={tl:[a,i],br:[s,0]};return this.positions[r]=l,l}}hi("LineAtlas",fp);class dp{constructor(t){this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=(()=>{this._triggered=!1,this._callback()}))}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=(()=>{})}}const mp=s.performance;function gp(t){const e=t?t.url.toString():void 0;return mp.getEntriesByName(e)}class yp{constructor(){this.tasks={},this.taskQueue=[],T(["process"],this),this.invoker=new dp(this.process),this.nextId=0}add(t,e){const r=this.nextId++,n=function({type:t,isSymbolTile:e,zoom:r}){return r=r||0,"message"===t?0:"maybePrepare"!==t||e?"parseTile"!==t||e?"parseTile"===t&&e?300-r:"maybePrepare"===t&&e?400-r:500:200-r:100-r}(e);if(0===n){R();try{t()}finally{}return{cancel:()=>{}}}return this.tasks[r]={fn:t,metadata:e,priority:n,id:r},this.taskQueue.push(r),this.invoker.trigger(),{cancel:()=>{delete this.tasks[r]}}}process(){R();try{if(this.taskQueue=this.taskQueue.filter(t=>!!this.tasks[t]),!this.taskQueue.length)return;const t=this.pick();if(null===t)return;const e=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!e)return;e.fn()}finally{}}pick(){let t=null,e=1/0;for(let n=0;n<this.taskQueue.length;n++){const r=this.tasks[this.taskQueue[n]];r.priority<e&&(e=r.priority,t=n)}if(null===t)return null;const r=this.taskQueue[t];return this.taskQueue.splice(t,1),r}remove(){this.invoker.remove()}}function _p(t,e,r){var n=2*Math.PI*6378137/256/Math.pow(2,r);return[t*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}class vp{constructor(t,e,r){this.z=t,this.x=e,this.y=r,this.key=wp(0,t,t,e,r)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,e){const r=function(t,e,r){var n=_p(256*t,256*(e=Math.pow(2,r)-e-1),r),i=_p(256*(t+1),256*(e+1),r);return n[0]+","+n[1]+","+i[0]+","+i[1]}(this.x,this.y,this.z),n=function(t,e,r){let n,i="";for(let o=t;o>0;o--)n=1<<o-1,i+=(e&n?1:0)+(r&n?2:0);return i}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",n).replace("{bbox-epsg-3857}",r)}toString(){return`${this.z}/${this.x}/${this.y}`}}class xp{constructor(t,e){this.wrap=t,this.canonical=e,this.key=wp(t,e.z,e.z,e.x,e.y)}}class bp{constructor(t,e,r,n,i){this.overscaledZ=t,this.wrap=e,this.canonical=new vp(r,+n,+i),this.key=0===e&&t===r?this.canonical.key:wp(e,t,r,n,i)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const e=this.canonical.z-t;return t>this.canonical.z?new bp(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new bp(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)}calculateScaledKey(t,e=!0){if(this.overscaledZ===t&&e)return this.key;if(t>this.canonical.z)return wp(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y);{const r=this.canonical.z-t;return wp(this.wrap*+e,t,t,this.canonical.x>>r,this.canonical.y>>r)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e}children(t){if(this.overscaledZ>=t)return[new bp(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const e=this.canonical.z+1,r=2*this.canonical.x,n=2*this.canonical.y;return[new bp(e,this.wrap,e,r,n),new bp(e,this.wrap,e,r+1,n),new bp(e,this.wrap,e,r,n+1),new bp(e,this.wrap,e,r+1,n+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new bp(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new bp(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new xp(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function wp(t,e,r,n,i){const o=1<<Math.min(r,22);let s=o*(i%o)+n%o;return t&&r<22&&(s+=o*o*((t<0?-2*t-1:2*t)%(1<<2*(22-r)))),16*(32*s+r)+(e-r)}hi("CanonicalTileID",vp),hi("OverscaledTileID",bp,{omit:["projMatrix"]});class Ep{constructor(t,e,r){this.func=t,this.mask=e,this.range=r}}Ep.ReadOnly=!1,Ep.ReadWrite=!0,Ep.disabled=new Ep(519,Ep.ReadOnly,[0,1]);const Sp=7680;class Ip{constructor(t,e,r,n,i,o){this.test=t,this.ref=e,this.mask=r,this.fail=n,this.depthFail=i,this.pass=o}}Ip.disabled=new Ip({func:519,mask:0},0,0,Sp,Sp,Sp);class Tp{constructor(t,e,r){this.blendFunction=t,this.blendColor=e,this.mask=r}}Tp.Replace=[1,0],Tp.disabled=new Tp(Tp.Replace,pe.transparent,[!1,!1,!1,!1]),Tp.unblended=new Tp(Tp.Replace,pe.transparent,[!0,!0,!0,!0]),Tp.alphaBlended=new Tp([1,771],pe.transparent,[!0,!0,!0,!0]);const Cp=1029,Mp=2305;class Ap{constructor(t,e,r){this.enable=t,this.mode=e,this.frontFace=r}}Ap.disabled=new Ap(!1,Cp,Mp),Ap.backCCW=new Ap(!0,Cp,Mp),Ap.backCW=new Ap(!0,Cp,2304),Ap.frontCW=new Ap(!0,1028,2304),Ap.frontCCW=new Ap(!0,1028,Mp);class Pp{constructor(t){this._stringToNumber={},this._numberToString=[];for(let e=0;e<t.length;e++){const r=t[e];this._stringToNumber[r]=e,this._numberToString[e]=r}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}class kp{constructor(t,e,r,n,i){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=r,t._y=n,this.properties=t.properties,this.id=i}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t}}class Lp{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,e,r){const n=String(e);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][n]=this.stateChanges[t][n]||{},x(this.stateChanges[t][n],r),null===this.deletedStates[t]){this.deletedStates[t]={};for(const e in this.state[t])e!==n&&(this.deletedStates[t][e]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][n]){this.deletedStates[t][n]={};for(const e in this.state[t][n])r[e]||(this.deletedStates[t][n][e]=null)}else for(const i in r)this.deletedStates[t]&&this.deletedStates[t][n]&&null===this.deletedStates[t][n][i]&&delete this.deletedStates[t][n][i]}removeFeatureState(t,e,r){if(null===this.deletedStates[t])return;const n=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},r&&void 0!==e)null!==this.deletedStates[t][n]&&(this.deletedStates[t][n]=this.deletedStates[t][n]||{},this.deletedStates[t][n][r]=null);else if(void 0!==e)if(this.stateChanges[t]&&this.stateChanges[t][n])for(r in this.deletedStates[t][n]={},this.stateChanges[t][n])this.deletedStates[t][n][r]=null;else this.deletedStates[t][n]=null;else this.deletedStates[t]=null}getState(t,e){const r=String(e),n=x({},(this.state[t]||{})[r],(this.stateChanges[t]||{})[r]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){const r=this.deletedStates[t][e];if(null===r)return{};for(const t in r)delete n[t]}return n}initializeTileState(t,e){t.setFeatureState(this.state,e)}coalesceChanges(t,e){const r={};for(const n in this.stateChanges){this.state[n]=this.state[n]||{};const t={};for(const e in this.stateChanges[n])this.state[n][e]||(this.state[n][e]={}),x(this.state[n][e],this.stateChanges[n][e]),t[e]=this.state[n][e];r[n]=t}for(const n in this.deletedStates){this.state[n]=this.state[n]||{};const t={};if(null===this.deletedStates[n])for(const e in this.state[n])t[e]={},this.state[n][e]={};else for(const e in this.deletedStates[n]){if(null===this.deletedStates[n][e])this.state[n][e]={};else for(const t of Object.keys(this.deletedStates[n][e]))delete this.state[n][e][t];t[e]=this.state[n][e]}r[n]=r[n]||{},x(r[n],t)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(r).length)for(const n in t)t[n].setFeatureState(r,e)}}class zp{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,e){const r=this.toIdx(t,e);return{min:this.minimums[r],max:this.maximums[r]}}isLeaf(t,e){return this.leaves[this.toIdx(t,e)]}toIdx(t,e){return e*this.size+t}}function Dp(t,e,r,n){let i=0,o=Number.MAX_VALUE;for(let s=0;s<3;s++)if(Math.abs(n[s])<1e-15){if(r[s]<t[s]||r[s]>e[s])return null}else{const a=1/n[s];let l=(t[s]-r[s])*a,u=(e[s]-r[s])*a;if(l>u){const t=l;l=u,u=t}if(l>i&&(i=l),u<o&&(o=u),i>o)return null}return i}function Rp(t,e,r,n,i,o,s,a,l,u,c){const h=n-t,p=i-e,f=o-r,d=s-t,m=a-e,g=l-r,y=c[1]*g-c[2]*m,_=c[2]*d-c[0]*g,v=c[0]*m-c[1]*d,x=h*y+p*_+f*v;if(Math.abs(x)<1e-15)return null;const b=1/x,w=u[0]-t,E=u[1]-e,S=u[2]-r,I=(w*y+E*_+S*v)*b;if(I<0||I>1)return null;const T=E*f-S*p,C=S*h-w*f,M=w*p-E*h,A=(c[0]*T+c[1]*C+c[2]*M)*b;return A<0||I+A>1?null:(d*T+m*C+g*M)*b}function Op(t,e,r){return(t-e)/(r-e)}function Np(t,e,r,n,i,o,s,a,l){const u=1<<r,c=o-n,h=s-i,p=(t+1)/u*c+n,f=(e+0)/u*h+i,d=(e+1)/u*h+i;a[0]=(t+0)/u*c+n,a[1]=f,l[0]=p,l[1]=d}class Fp{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const e=function(t){const e=Math.ceil(Math.log2(t.dim/8)),r=[];let n=Math.ceil(Math.pow(2,e));const i=1/n,o=(t,e,r,n,i)=>{const o=n?1:0,s=(t+1)*r-o,a=e*r,l=(e+1)*r-o;i[0]=t*r,i[1]=a,i[2]=s,i[3]=l};let s=new zp(n);const a=[];for(let l=0;l<n*n;l++){o(l%n,Math.floor(l/n),i,!1,a);const e=jp(a[0],a[1],t),r=jp(a[2],a[1],t),u=jp(a[2],a[3],t),c=jp(a[0],a[3],t);s.minimums.push(Math.min(e,r,u,c)),s.maximums.push(Math.max(e,r,u,c)),s.leaves.push(1)}for(r.push(s),n/=2;n>=1;n/=2){const t=r[r.length-1];s=new zp(n);for(let e=0;e<n*n;e++){o(e%n,Math.floor(e/n),2,!0,a);const r=t.getElevation(a[0],a[1]),i=t.getElevation(a[2],a[1]),l=t.getElevation(a[2],a[3]),u=t.getElevation(a[0],a[3]),c=t.isLeaf(a[0],a[1]),h=t.isLeaf(a[2],a[1]),p=t.isLeaf(a[2],a[3]),f=t.isLeaf(a[0],a[3]),d=Math.min(r.min,i.min,l.min,u.min),m=Math.max(r.max,i.max,l.max,u.max),g=c&&h&&p&&f;s.maximums.push(m),s.minimums.push(d),s.leaves.push(m-d<=5&&g?1:0)}r.push(s)}return r}(this.dem),r=e.length-1,n=e[r];this._addNode(n.minimums[0],n.maximums[0],n.leaves[0]),this._construct(e,0,0,r,0)}raycastRoot(t,e,r,n,i,o,s=1){return Dp([t,e,-100],[r,n,this.maximums[0]*s],i,o)}raycast(t,e,r,n,i,o,s=1){if(!this.nodeCount)return null;const a=this.raycastRoot(t,e,r,n,i,o,s);if(null==a)return null;const l=[],u=[],c=[],h=[],p=[{idx:0,t:a,nodex:0,nodey:0,depth:0}];for(;p.length>0;){const{idx:a,t:f,nodex:d,nodey:m,depth:g}=p.pop();if(this.leaves[a]){Np(d,m,g,t,e,r,n,c,h);const a=1<<g,l=(d+0)/a,u=(d+1)/a,p=(m+0)/a,y=(m+1)/a,_=jp(l,p,this.dem)*s,v=jp(u,p,this.dem)*s,x=jp(u,y,this.dem)*s,b=jp(l,y,this.dem)*s,w=Rp(c[0],c[1],_,h[0],c[1],v,h[0],h[1],x,i,o),E=Rp(h[0],h[1],x,c[0],h[1],b,c[0],c[1],_,i,o),S=Math.min(null!==w?w:Number.MAX_VALUE,null!==E?E:Number.MAX_VALUE);if(S!==Number.MAX_VALUE)return S;{const t=ol([],i,o,f);if(Bp(_,v,b,x,Op(t[0],c[0],h[0]),Op(t[1],c[1],h[1]))>=t[2])return f}continue}let y=0;for(let p=0;p<this._siblingOffset.length;p++){Np((d<<1)+this._siblingOffset[p][0],(m<<1)+this._siblingOffset[p][1],g+1,t,e,r,n,c,h),c[2]=-100,h[2]=this.maximums[this.childOffsets[a]+p]*s;const f=Dp(c,h,i,o);if(null!=f){const t=f;l[p]=t;let e=!1;for(let r=0;r<y&&!e;r++)t>=l[u[r]]&&(u.splice(r,0,p),e=!0);e||(u[y]=p),y++}}for(let t=0;t<y;t++){const e=u[t];p.push({idx:this.childOffsets[a]+e,t:l[e],nodex:(d<<1)+this._siblingOffset[e][0],nodey:(m<<1)+this._siblingOffset[e][1],depth:g+1})}}return null}_addNode(t,e,r){return this.minimums.push(t),this.maximums.push(e),this.leaves.push(r),this.childOffsets.push(0),this.nodeCount++}_construct(t,e,r,n,i){if(1===t[n].isLeaf(e,r))return;this.childOffsets[i]||(this.childOffsets[i]=this.nodeCount);const o=n-1,s=t[o];let a=0,l=0;for(let u=0;u<this._siblingOffset.length;u++){const t=2*e+this._siblingOffset[u][0],n=2*r+this._siblingOffset[u][1],i=s.getElevation(t,n),o=s.isLeaf(t,n),c=this._addNode(i.min,i.max,o);o&&(a|=1<<u),l||(l=c)}for(let u=0;u<this._siblingOffset.length;u++)a&1<<u||this._construct(t,2*e+this._siblingOffset[u][0],2*r+this._siblingOffset[u][1],o,l+u)}}function Bp(t,e,r,n,i,o){return ir(ir(t,r,o),ir(e,n,o),i)}function jp(t,e,r){const n=r.dim,i=m(t*n-.5,0,n-1),o=m(e*n-.5,0,n-1),s=Math.floor(i),a=Math.floor(o),l=Math.min(s+1,n-1),u=Math.min(a+1,n-1);return Bp(r.get(s,a),r.get(l,a),r.get(s,u),r.get(l,u),i-s,o-a)}const Up={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Vp{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,e,r,n=!1,i=!1){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(r&&"mapbox"!==r&&"terrarium"!==r)return L(`"${r}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=e.height;const o=this.dim=e.height-2,s=new Uint32Array(e.data.buffer);if(this.pixels=new Uint8Array(e.data.buffer),this.encoding=r||"mapbox",this.borderReady=n,!n){for(let t=0;t<o;t++)s[this._idx(-1,t)]=s[this._idx(0,t)],s[this._idx(o,t)]=s[this._idx(o-1,t)],s[this._idx(t,-1)]=s[this._idx(t,0)],s[this._idx(t,o)]=s[this._idx(t,o-1)];s[this._idx(-1,-1)]=s[this._idx(0,0)],s[this._idx(o,-1)]=s[this._idx(o-1,0)],s[this._idx(-1,o)]=s[this._idx(0,o-1)],s[this._idx(o,o)]=s[this._idx(o-1,o-1)],i&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Fp(this)}get(t,e,r=!1){r&&(t=m(t,-1,this.dim),e=m(e,-1,this.dim));const n=4*this._idx(t,e);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[n],this.pixels[n+1],this.pixels[n+2])}static getUnpackVector(t){return Up[t]}get unpackVector(){return Up[this.encoding]}_idx(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)}_unpackMapbox(t,e,r){return(256*t*256+256*e+r)/10-1e4}_unpackTerrarium(t,e,r){return 256*t+e+r/256-32768}static pack(t,e){const r=[0,0,0,0],n=Vp.getUnpackVector(e);let i=Math.floor((t+n[3])/n[2]);return r[2]=i%256,i=Math.floor(i/256),r[1]=i%256,i=Math.floor(i/256),r[0]=i,r}getPixels(){return new Dl({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,e,r){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let n=e*this.dim,i=e*this.dim+this.dim,o=r*this.dim,s=r*this.dim+this.dim;switch(e){case-1:n=i-1;break;case 1:i=n+1}switch(r){case-1:o=s-1;break;case 1:s=o+1}const a=-e*this.dim,l=-r*this.dim;for(let u=o;u<s;u++)for(let e=n;e<i;e++){const r=4*this._idx(e,u),n=4*this._idx(e+a,u+l);this.pixels[r+0]=t.pixels[n+0],this.pixels[r+1]=t.pixels[n+1],this.pixels[r+2]=t.pixels[n+2],this.pixels[r+3]=t.pixels[n+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}hi("DEMData",Vp),hi("DemMinMaxQuadTree",Fp,{omit:["dem"]});class Gp{constructor(t,e){this.max=t,this.onRemove=e,this.reset()}reset(){for(const t in this.data)for(const e of this.data[t])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(t,e,r){const n=t.wrapped().key;void 0===this.data[n]&&(this.data[n]=[]);const i={value:e,timeout:void 0};if(void 0!==r&&(i.timeout=setTimeout(()=>{this.remove(t,i)},r)),this.data[n].push(i),this.order.push(n),this.order.length>this.max){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value}getByKey(t){const e=this.data[t];return e?e[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,e){if(!this.has(t))return this;const r=t.wrapped().key,n=void 0===e?0:this.data[r].indexOf(e),i=this.data[r][n];return this.data[r].splice(n,1),i.timeout&&clearTimeout(i.timeout),0===this.data[r].length&&delete this.data[r],this.onRemove(i.value),this.order.splice(this.order.indexOf(r),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(t){const e=[];for(const r in this.data)for(const n of this.data[r])t(n.value)||e.push(n);for(const r of e)this.remove(r.value.tileID,r)}}class qp extends Bt{constructor(t,e,r){super(),this.id=t,this._onlySymbols=r,e.on("data",t=>{"source"===t.dataType&&"metadata"===t.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),e.on("error",()=>{this._sourceErrored=!0}),this._source=e,this._tiles={},this._cache=new Gp(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=null,this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Lp}onAdd(t){this.map=t,this._minTileCacheSize=t?t._minTileCacheSize:null,this._maxTileCacheSize=t?t._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const t in this._tiles){const e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,e){return t.isSymbolTile=this._onlySymbols,this._source.loadTile(t,e)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const e in this._tiles){const r=this._tiles[e];r.upload(t),r.prepare(this.map.style.imageManager)}}getIds(){return v(this._tiles).map(t=>t.tileID).sort($p).map(t=>t.key)}getRenderableIds(t){const e=[];for(const r in this._tiles)this._isIdRenderable(+r,t)&&e.push(this._tiles[r]);return t?e.sort((t,e)=>{const r=t.tileID,n=e.tileID,o=new i(r.canonical.x,r.canonical.y)._rotate(this.transform.angle),s=new i(n.canonical.x,n.canonical.y)._rotate(this.transform.angle);return r.overscaledZ-n.overscaledZ||s.y-o.y||s.x-o.x}).map(t=>t.tileID.key):e.map(t=>t.tileID).sort($p).map(t=>t.key)}hasRenderableParent(t){const e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)}_isIdRenderable(t,e){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(+t,"reloading")}}_reloadTile(t,e){const r=this._tiles[t];r&&("loading"!==r.state&&(r.state=e),this._loadTile(r,this._tileLoaded.bind(this,r,t,e)))}_tileLoaded(t,e,r,n){if(n)if(t.state="errored",404!==n.status)this._source.fire(new Ft(n,{tile:t}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const t=this.map.painter.terrain;this.update(this.transform,t.getScaledDemTileSize(),!0),t.resetTileLookupCache(this.id)}else this.update(this.transform);else t.timeAdded=q.now(),"expired"===r&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(e,t),"raster-dem"===this._source.type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new Nt("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const e=this.getRenderableIds();for(let n=0;n<e.length;n++){const i=e[n];if(t.neighboringTiles&&t.neighboringTiles[i]){const e=this.getTileByID(i);r(t,e),r(e,t)}}function r(t,e){if(!t.dem||t.dem.borderReady)return;t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0;let r=e.tileID.canonical.x-t.tileID.canonical.x;const n=e.tileID.canonical.y-t.tileID.canonical.y,i=Math.pow(2,t.tileID.canonical.z),o=e.tileID.key;0===r&&0===n||Math.abs(n)>1||(Math.abs(r)>1&&(1===Math.abs(r+i)?r+=i:1===Math.abs(r-i)&&(r-=i)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,r,n),t.neighboringTiles&&t.neighboringTiles[o]&&(t.neighboringTiles[o].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,e,r,n){for(const i in this._tiles){let o=this._tiles[i];if(n[i]||!o.hasData()||o.tileID.overscaledZ<=e||o.tileID.overscaledZ>r)continue;let s=o.tileID;for(;o&&o.tileID.overscaledZ>e+1;){const t=o.tileID.scaledTo(o.tileID.overscaledZ-1);o=this._tiles[t.key],o&&o.hasData()&&(s=t)}let a=s;for(;a.overscaledZ>e;)if(a=a.scaledTo(a.overscaledZ-1),t[a.key]){n[s.key]=s;break}}}findLoadedParent(t,e){if(t.key in this._loadedParentTiles){const r=this._loadedParentTiles[t.key];return r&&r.tileID.overscaledZ>=e?r:null}for(let r=t.overscaledZ-1;r>=e;r--){const e=t.scaledTo(r),n=this._getLoadedTile(e);if(n)return n}}_getLoadedTile(t){const e=this._tiles[t.key];return e&&e.hasData()?e:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,e){e=e||this._source.tileSize;const r=Math.ceil(t.width/e)+1,n=Math.ceil(t.height/e)+1,i=Math.floor(r*n*5),o="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,i):i,s="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,o):o;this._cache.setMaxSize(s)}handleWrapJump(t){const e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){const t={};for(const r in this._tiles){const n=this._tiles[r];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+e),t[n.tileID.key]=n}this._tiles=t;for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(+e,this._tiles[e])}}update(t,e,r){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!r)return;let n;this.updateCacheSize(t,e),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?n=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(t=>new bp(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y)):(n=t.coveringTiles({tileSize:e||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!r,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(n=n.filter(t=>this._source.hasTile(t)))):n=[];const i=this._updateRetainedTiles(n);if(Zp(this._source.type)&&0!==n.length){const t={},e={},r=Object.keys(i);for(const n of r){const r=i[n],o=this._tiles[n];if(!o||o.fadeEndTime&&o.fadeEndTime<=q.now())continue;const s=this.findLoadedParent(r,Math.max(r.overscaledZ-qp.maxOverzooming,this._source.minzoom));s&&(this._addTile(s.tileID),t[s.tileID.key]=s.tileID),e[n]=r}const o=n[n.length-1].overscaledZ;for(const n in this._tiles){const t=this._tiles[n];if(i[n]||!t.hasData())continue;let r=t.tileID;for(;r.overscaledZ>o;){r=r.scaledTo(r.overscaledZ-1);const o=this._tiles[r.key];if(o&&o.hasData()&&e[r.key]){i[n]=t.tileID;break}}}for(const n in t)i[n]||(this._coveredTiles[n]=!0,i[n]=t[n])}for(const s in i)this._tiles[s].clearFadeHold();const o=function(t,e){const r=[];for(const n in t)n in e||r.push(n);return r}(this._tiles,i);for(const s of o){const t=this._tiles[s];t.hasSymbolBuckets&&!t.holdingForFade()?t.setHoldDuration(this.map._fadeDuration):t.hasSymbolBuckets&&!t.symbolFadeFinished()||this._removeTile(+s)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const e={};if(0===t.length)return e;const r={},n=t.reduce((t,e)=>Math.min(t,e.overscaledZ),1/0),i=t[0].overscaledZ,o=Math.max(i-qp.maxOverzooming,this._source.minzoom),s=Math.max(i+qp.maxUnderzooming,this._source.minzoom),a={};for(const l of t){const t=this._addTile(l);e[l.key]=l,t.hasData()||n<this._source.maxzoom&&(a[l.key]=l)}this._retainLoadedChildren(a,n,s,e);for(const l of t){let t=this._tiles[l.key];if(t.hasData())continue;if(l.canonical.z>=this._source.maxzoom){const t=l.children(this._source.maxzoom)[0],r=this.getTile(t);if(r&&r.hasData()){e[t.key]=t;continue}}else{const t=l.children(this._source.maxzoom);if(e[t[0].key]&&e[t[1].key]&&e[t[2].key]&&e[t[3].key])continue}let n=t.wasRequested();for(let i=l.overscaledZ-1;i>=o;--i){const o=l.scaledTo(i);if(r[o.key])break;if(r[o.key]=!0,t=this.getTile(o),!t&&n&&(t=this._addTile(o)),t&&(e[o.key]=o,n=t.wasRequested(),t.hasData()))break}}return e}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const e=[];let r,n=this._tiles[t].tileID;for(;n.overscaledZ>0;){if(n.key in this._loadedParentTiles){r=this._loadedParentTiles[n.key];break}e.push(n.key);const t=n.scaledTo(n.overscaledZ-1);if(r=this._getLoadedTile(t),r)break;n=t}for(const t of e)this._loadedParentTiles[t]=r}}_addTile(t){let e=this._tiles[t.key];if(e)return e;e=this._cache.getAndRemove(t),e&&(this._setTileReloadTimer(t.key,e),e.tileID=t,this._state.initializeTileState(e,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,e)));const r=Boolean(e);if(!r){const r=this.map?this.map.painter:null,n="raster"===this._source.type||"raster-dem"===this._source.type;e=new lf(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,r,n),this._loadTile(e,this._tileLoaded.bind(this,e,t.key,e.state))}return e?(e.uses++,this._tiles[t.key]=e,r||this._source.fire(new Nt("dataloading",{tile:e,coord:e.tileID,dataType:"source"})),e):null}_setTileReloadTimer(t,e){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const r=e.getExpiryTimeout();r&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},r))}_removeTile(t){const e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()&&"reloading"!==e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,e,r){const n=[],i=this.transform;if(!i)return n;for(const o in this._tiles){const s=this._tiles[o];if(r&&s.clearQueryDebugViz(),s.holdingForFade())continue;const a=t.containsTile(s,i,e);a&&n.push(a)}return n}getVisibleCoordinates(t){const e=this.getRenderableIds(t).map(t=>this._tiles[t].tileID);for(const r of e)r.projMatrix=this.transform.calculateProjMatrix(r.toUnwrapped());return e}hasTransition(){if(this._source.hasTransition())return!0;if(Zp(this._source.type))for(const t in this._tiles){const e=this._tiles[t];if(void 0!==e.fadeEndTime&&e.fadeEndTime>=q.now())return!0}return!1}setFeatureState(t,e,r){this._state.updateState(t=t||"_geojsonTileLayer",e,r)}removeFeatureState(t,e,r){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,r)}getFeatureState(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)}setDependencies(t,e,r){const n=this._tiles[t];n&&n.setDependencies(e,r)}reloadTilesForDependencies(t,e){for(const r in this._tiles)this._tiles[r].hasDependency(t,e)&&this._reloadTile(+r,"reloading");this._cache.filter(r=>!r.hasDependency(t,e))}_preloadTiles(t,e){const r=new Map,n=Array.isArray(t)?t:[t],i=this.map.painter.terrain,o=this.usedForTerrain&&i?i.getScaledDemTileSize():this._source.tileSize;for(const l of n){const t=l.coveringTiles({tileSize:o,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const e of t)r.set(e.key,e);this.usedForTerrain&&l.updateElevation(!1)}const s=Array.from(r.values()),a="raster"===this._source.type||"raster-dem"===this._source.type;_(s,(t,e)=>{const r=new lf(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,this.map.painter,a);this._loadTile(r,t=>{"raster-dem"===this._source.type&&r.dem&&this._backfillDEM(r),e(t,r)})},e)}}function $p(t,e){const r=Math.abs(2*t.wrap)-+(t.wrap<0),n=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||n-r||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function Zp(t){return"raster"===t||"image"===t||"video"===t}qp.maxOverzooming=10,qp.maxUnderzooming=3;class Xp{constructor(t,e,r){this._demTile=t,this._dem=this._demTile.dem,this._scale=e,this._offset=r}static create(t,e,r){const n=r||t.findDEMTileFor(e);if(!n||!n.dem)return;const i=n.dem,o=n.tileID,s=1<<e.canonical.z-o.canonical.z;return new Xp(n,n.tileSize/Js/s,[(e.canonical.x/s-o.canonical.x)*i.dim,(e.canonical.y/s-o.canonical.y)*i.dim])}tileCoordToPixel(t,e){const r=e*this._scale+this._offset[1],n=Math.floor(t*this._scale+this._offset[0]),o=Math.floor(r);return new i(n,o)}getElevationAt(t,e,r,n){const i=t*this._scale+this._offset[0],o=e*this._scale+this._offset[1],s=Math.floor(i),a=Math.floor(o),l=this._dem;return n=!!n,r?ir(ir(l.get(s,a,n),l.get(s,a+1,n),o-a),ir(l.get(s+1,a,n),l.get(s+1,a+1,n),o-a),i-s):l.get(s,a,n)}getElevationAtPixel(t,e,r){return this._dem.get(t,e,!!r)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*oa(1,t)*this._dem.stride}}class Wp{constructor(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new li(Js,16,0),this.featureIndexArray=new hs,this.promoteId=e}insert(t,e,r,n,i,o=0){const s=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,n,i,o);const a=this.grid;for(let l=0;l<e.length;l++){const t=e[l],r=[1/0,1/0,-1/0,-1/0];for(let e=0;e<t.length;e++){const n=t[e];r[0]=Math.min(r[0],n.x),r[1]=Math.min(r[1],n.y),r[2]=Math.max(r[2],n.x),r[3]=Math.max(r[3],n.y)}r[0]<Js&&r[1]<Js&&r[2]>=0&&r[3]>=0&&a.insert(s,r[0],r[1],r[2],r[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ou.VectorTile(new Ec(this.rawTileData)).layers,this.sourceLayerCoder=new Pp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,e,r,n){this.loadVTLayers();const i=t.params||{},o=Tn(i.filter),s=t.tileResult,a=t.transform,l=s.bufferedTilespaceBounds,u=this.grid.query(l.min.x,l.min.y,l.max.x,l.max.y,(t,e,r,n)=>ka(s.bufferedTilespaceGeometry,t,e,r,n));u.sort(Hp);let c=null;a.elevation&&u.length>0&&(c=Xp.create(a.elevation,this.tileID));const h={};let p;for(let f=0;f<u.length;f++){const a=u[f];if(a===p)continue;p=a;const l=this.featureIndexArray.get(a);let d=null;this.loadMatchingFeature(h,l,o,i.layers,i.availableImages,e,r,n,(e,r,n,i=0)=>(d||(d=ga(e,this.tileID.canonical,t.tileTransform)),r.queryIntersectsFeature(s,e,n,d,this.z,t.transform,t.pixelPosMatrix,c,i)))}return h}loadMatchingFeature(t,e,r,n,i,o,s,a,l){const{featureIndex:u,bucketIndex:c,sourceLayerIndex:h,layoutVertexArrayOffset:p}=e,f=this.bucketLayerIDs[c];if(n&&!function(t,e){for(let r=0;r<t.length;r++)if(e.indexOf(t[r])>=0)return!0;return!1}(n,f))return;const d=this.sourceLayerCoder.decode(h),m=this.vtLayers[d].feature(u);if(r.needGeometry){const t=ya(m,!0);if(!r.filter(new co(this.tileID.overscaledZ),t,this.tileID.canonical))return}else if(!r.filter(new co(this.tileID.overscaledZ),m))return;const g=this.getId(m,d);for(let y=0;y<f.length;y++){const e=f[y];if(n&&n.indexOf(e)<0)continue;const r=o[e];if(!r)continue;let c={};void 0!==g&&a&&(c=a.getState(r.sourceLayer||"_geojsonTileLayer",g));const h=x({},s[e]);h.paint=Yp(h.paint,r.paint,m,c,i),h.layout=Yp(h.layout,r.layout,m,c,i);const d=!l||l(m,r,c,p);if(!d)continue;const _=new kp(m,this.z,this.x,this.y,g);_.layer=h;let v=t[e];void 0===v&&(v=t[e]=[]),v.push({featureIndex:u,feature:_,intersectionZ:d})}}lookupSymbolFeatures(t,e,r,n,i,o,s,a){const l={};this.loadVTLayers();const u=Tn(i);for(const c of t)this.loadMatchingFeature(l,{bucketIndex:r,sourceLayerIndex:n,featureIndex:c,layoutVertexArrayOffset:0},u,o,s,a,e);return l}loadFeature(t){const{featureIndex:e,sourceLayerIndex:r}=t;this.loadVTLayers();const n=this.sourceLayerCoder.decode(r),i=this.vtFeatures[n];if(i[e])return i[e];const o=this.vtLayers[n].feature(e);return i[e]=o,o}hasLayer(t){for(const e of this.bucketLayerIDs)for(const r of e)if(t===r)return!0;return!1}getId(t,e){let r=t.id;return this.promoteId&&(r=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[e]],"boolean"==typeof r&&(r=Number(r))),r}}function Yp(t,e,r,n,i){return M(t,(t,o)=>{const s=e instanceof vo?e.get(o):null;return s&&s.evaluate?s.evaluate(r,n,i):s})}function Hp(t,e){return e-t}hi("FeatureIndex",Wp,{omit:["rawTileData","sourceLayerCoder"]});var Jp=Po([{name:"a_pos",type:"Int16",components:2}]);const Kp=32,Qp=33,tf=new Uint16Array(8184);for(let ed=0;ed<2046;ed++){let t=ed+2,e=0,r=0,n=0,i=0,o=0,s=0;for(1&t?n=i=o=Kp:e=r=s=Kp;(t>>=1)>1;){const a=e+n>>1,l=r+i>>1;1&t?(n=e,i=r,e=o,r=s):(e=n,r=i,n=o,i=s),o=a,s=l}const a=4*ed;tf[a+0]=e,tf[a+1]=r,tf[a+2]=n,tf[a+3]=i}const ef=new Uint16Array(2178),rf=new Uint8Array(1089),nf=new Uint16Array(1089);function of(t){return 0===t?-.03125:32===t?.03125:0}var sf=Po([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const af={type:2,extent:Js,loadGeometry:()=>[[new i(0,0),new i(8193,0),new i(8193,8193),new i(0,8193),new i(0,0)]]};class lf{constructor(t,e,r,n,i){this.tileID=t,this.uid=w(),this.uses=0,this.tileSize=e,this.tileZoom=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=i,this.expiredRequestCount=0,this.state="loading",n&&n.transform&&(this.projection=n.transform.projection)}registerFadeDuration(t){const e=t+this.timeAdded;e<q.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=kf(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,e,r){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){const r={};if(!e)return r;for(const n of t){const t=n.layerIds.map(t=>e.getLayer(t)).filter(Boolean);if(0!==t.length){n.layers=t,n.stateDependentLayerIds&&(n.stateDependentLayers=n.stateDependentLayerIds.map(e=>t.filter(t=>t.id===e)[0]));for(const e of t)r[e.id]=n}}return r}(t.buckets,e.style),this.hasSymbolBuckets=!1;for(const t in this.buckets){const e=this.buckets[t];if(e instanceof ep){if(this.hasSymbolBuckets=!0,!r)break;e.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const t in this.buckets){const e=this.buckets[t];if(e instanceof ep&&e.hasRTLText){this.hasRTLText=!0,uo.isLoading()||uo.isLoaded()||"deferred"!==ao()||lo();break}}this.queryPadding=0;for(const t in this.buckets){const r=this.buckets[t];this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(t).queryRadius(r))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas)}else this.collisionBoxArray=new ns}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this.globeGridBuffer&&(this.globeGridBuffer.destroy(),this.globeGridBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.id]}upload(t){for(const r in this.buckets){const e=this.buckets[r];e.uploadPending()&&e.upload(t)}const e=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new pp(t,this.imageAtlas.image,e.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new pp(t,this.glyphAtlasImage,e.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new pp(t,this.lineAtlas.image,e.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,e,r,n,i,o,s,a){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:n,pixelPosMatrix:s,transform:o,params:i,tileTransform:this.tileTransform},t,e,r):{}}querySourceFeatures(t,e){const r=this.latestFeatureIndex;if(!r||!r.rawTileData)return;const n=r.loadVTLayers(),i=e?e.sourceLayer:"",o=n._geojsonTileLayer||n[i];if(!o)return;const s=Tn(e&&e.filter),{z:a,x:l,y:u}=this.tileID.canonical,c={z:a,x:l,y:u};for(let h=0;h<o.length;h++){const e=o.feature(h);if(s.needGeometry){const t=ya(e,!0);if(!s.filter(new co(this.tileID.overscaledZ),t,this.tileID.canonical))continue}else if(!s.filter(new co(this.tileID.overscaledZ),e))continue;const n=r.getId(e,i),p=new kp(e,a,l,u,n);p.tile=c,t.push(p)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const e=this.expirationTime;if(t.cacheControl){const e=O(t.cacheControl);e["max-age"]&&(this.expirationTime=Date.now()+1e3*e["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const t=Date.now();let r=!1;if(this.expirationTime>t)r=!1;else if(e)if(this.expirationTime<e)r=!0;else{const n=this.expirationTime-e;n?this.expirationTime=t+Math.max(n,3e4):r=!0}else r=!0;r?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(t,e){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(t).length||!e)return;const r=this.latestFeatureIndex.loadVTLayers(),n=e.style.listImages();for(const i in this.buckets){if(!e.style.hasLayer(i))continue;const o=this.buckets[i],s=o.layers[0].sourceLayer||"_geojsonTileLayer",a=r[s],l=t[s];if(!a||!l||0===Object.keys(l).length)continue;if(o.update(l,a,n,this.imageAtlas&&this.imageAtlas.patternPositions||{}),o instanceof tc||o instanceof wu){const t=e.style._getSourceCache(o.layers[0].source);e._terrain&&e._terrain.enabled&&t&&o.programConfigurations.needsUpload&&e._terrain._clearRenderCacheForTile(t.id,this.tileID)}const u=e&&e.style&&e.style.getLayer(i);u&&(this.queryPadding=Math.max(this.queryPadding,u.queryRadius(o)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=q.now()+t}setDependencies(t,e){const r={};for(const n of e)r[n]=!0;this.dependencies[t]=r}hasDependency(t,e){for(const r of t){const t=this.dependencies[r];if(t)for(const r of e)if(t[r])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,e){if(!e||"mercator"===e.name||this._tileDebugBuffer)return;const r=ga(af,this.tileID.canonical,this.tileTransform)[0],n=new Lo,i=new Ko;for(let o=0;o<r.length;o++){const{x:t,y:e}=r[o];n.emplaceBack(t,e),i.emplaceBack(o)}i.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(i),this._tileDebugBuffer=t.createVertexBuffer(n,sf.members),this._tileDebugSegments=Hs.simpleSegment(0,0,n.length,i.length)}_makeTileBoundsBuffers(t,e){if(this._tileBoundsBuffer||!e||"mercator"===e.name)return;const r=ga(af,this.tileID.canonical,this.tileTransform)[0];let n,i;if(this.isRaster){const t=function(t,e){const r=kf(t,e),n=Math.pow(2,t.z);for(let u=0;u<Qp;u++)for(let i=0;i<Qp;i++){const o=sa((t.x+(i+of(i))/Kp)/n),s=aa((t.y+(u+of(u))/Kp)/n),a=e.project(o,s),l=u*Qp+i;ef[2*l+0]=Math.round((a.x*r.scale-r.x)*Js),ef[2*l+1]=Math.round((a.y*r.scale-r.y)*Js)}rf.fill(0),nf.fill(0);for(let u=2045;u>=0;u--){const t=4*u,e=tf[t+0],r=tf[t+1],n=tf[t+2],i=tf[t+3],o=e+n>>1,s=r+i>>1,a=o+s-r,l=s+e-o,c=r*Qp+e,h=i*Qp+n,p=s*Qp+o,f=Math.hypot((ef[2*c+0]+ef[2*h+0])/2-ef[2*p+0],(ef[2*c+1]+ef[2*h+1])/2-ef[2*p+1])>=16;if(rf[p]=rf[p]||(f?1:0),u<1022){const t=(r+l>>1)*Qp+(e+a>>1),o=(i+l>>1)*Qp+(n+a>>1);rf[p]=rf[p]||rf[t]||rf[o]}}const i=new zo,o=new qo;let s=0;function a(t,e){const r=e*Qp+t;return 0===nf[r]&&(i.emplaceBack(ef[2*r+0],ef[2*r+1],t*Js/Kp,e*Js/Kp),nf[r]=++s),nf[r]-1}function l(t,e,r,n,i,s){const u=t+r>>1,c=e+n>>1;if(Math.abs(t-i)+Math.abs(e-s)>1&&rf[c*Qp+u])l(i,s,t,e,u,c),l(r,n,i,s,u,c);else{const l=a(t,e),u=a(r,n),c=a(i,s);o.emplaceBack(l,u,c)}}return l(0,0,Kp,Kp,Kp,0),l(Kp,Kp,0,0,0,Kp),{vertices:i,indices:o}}(this.tileID.canonical,e);n=t.vertices,i=t.indices}else{n=new zo,i=new qo;for(const{x:e,y:i}of r)n.emplaceBack(e,i,0,0);const t=jl(n.int16,void 0,4);for(let e=0;e<t.length;e+=3)i.emplaceBack(t[e],t[e+1],t[e+2])}this._tileBoundsBuffer=t.createVertexBuffer(n,sf.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(i),this._tileBoundsSegments=Hs.simpleSegment(0,0,n.length,i.length)}}const uf=Po([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),cf=Po([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:hf}=uf;class pf{constructor(t,e){this._tr=t,this._worldSize=e,this._globeMatrix=Mf(t,e)}createTileMatrix(t){const e=Tf(xf(t.canonical));return qa(new Float64Array(16),this._globeMatrix,e)}createInversionMatrix(t){const e=Ga(new Float64Array(16)),r=this._tr.center,n=Cf(this._worldSize),i=Ga(new Float64Array(16));qa(i,i,If(xf(t))),Wa(i,i,u(r.lng)),Xa(i,i,u(r.lat)),Za(i,i,[1/n,1/n,1]);const o=oa(1,r.lat)*this._worldSize,s=this._worldSize/(o/this._tr.pixelsPerMeter)/(2*Math.PI)/(Js/(2*Math.PI));return Za(e,e,[s,s,1]),qa(i,i,e),Float32Array.from(i)}pointCoordinate(t,e){const r=[t,e,0,1],n=[t,e,1,1];gl(r,r,this._tr.pixelMatrixInverse),gl(n,n,this._tr.pixelMatrixInverse),ml(r,r,1/r[3]),ml(n,n,1/n[3]);const i=sl([],pl([],n,r)),o=this._globeMatrix,s=[o[12],o[13],o[14]],a=this._worldSize/(2*Math.PI),l=[];new bl(r,i).closestPointOnSphere(s,a,l);const u=sl([],G(o,0)),h=sl([],G(o,1)),p=sl([],G(o,2)),f=al(u,l),d=al(h,l),m=al(p,l),g=c(Math.asin(-d/a));let y=c(Math.atan2(f,m));y=this._tr.center.lng+function(t,e){const r=(e-t+180)%360-180;return r<-180?r+360:r}(this._tr.center.lng,y);const _=na(y),v=ia(g);return new ca(_,v)}}function ff(t,e){const r=t.fovAboveCenter,n=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,i=(t._camera.position[2]*t.worldSize-n)/Math.cos(t._pitch),o=Math.sin(r)*i/Math.sin(Math.max(Math.PI/2-t._pitch-r,.01)),s=Math.sin(t._pitch)*o+i;return Math.min(1.01*s,i*(1/t._horizonShift))}const df=Js/Math.PI/2,mf=2*oa(1,0)*df*Math.PI;var gf={name:"globe",requiresDraping:!0,wrap:!0,supportsWorldCopies:!1,supportsTerrain:!0,supportsFreeCamera:!0,zAxisUnit:"pixels",center:[0,0],unsupportedLayers:["fill-extrusion","debug","custom"],project:(t,e)=>({x:na(t),y:ia(e),z:0}),unproject(t,e){const r=sa(t),n=aa(e);return new ta(r,n)},projectTilePoint(t,e,r){const n=Math.pow(2,r.z),i=(t/Js+r.x)/n,o=Ef(aa((e/Js+r.y)/n),sa(i));return ul(o,o,If(xf(r))),{x:o[0],y:o[1],z:o[2]}},locationPoint(t,e){const r=Ef(e.lat,e.lng),n=sl([],r),o=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(e),t._centerAltitude):t._centerAltitude;ol(r,r,n,oa(1,0)*Js*o);const s=Mf(t,t.worldSize);return qa(s,t.pixelMatrix,s),ul(r,r,s),new i(r[0],r[1])},pixelsPerMeter:(t,e)=>oa(1,0)*e,createTileTransform:(t,e)=>new pf(t,e),farthestPixelDistance(t){const e=function(t,e){const r=t.cameraToCenterDistance,n=t._centerAltitude*e,i=t._camera,o=t._camera.forward(),s=tl([],il([],o,-r),[0,0,n]),a=t.worldSize/(2*Math.PI),l=[0,0,-a],u=t.width/t.height,c=Math.tan(t.fovAboveCenter),h=il([],i.up(),c),p=il([],i.right(),c*u),f=sl([],tl([],tl([],o,h),p)),d=[];let m;if(new bl(s,f).closestPointOnSphere(l,a,d)){const e=tl([],d,l),r=pl([],e,s);m=Math.cos(t.fovAboveCenter)*Ka(r)}else{const t=pl([],s,l),e=pl([],l,s);sl(e,e);const r=Ka(t)-a;m=Math.sqrt(r*r+2*a*r);const n=Math.acos(m/(a+r))-Math.acos(al(o,e));m*=Math.cos(n)}return 1.01*m}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),r=Af(t.zoom);return r>0?ir(e,ff(t,oa(1,t.center.lat)*t.worldSize),r):e},upVector(t,e,r){const n=1<<t.z,i=(e/Js+t.x)/n;return Ef(aa((r/Js+t.y)/n),sa(i),1)},upVectorScale(t,e,r){const n=oa(1,e)*r;return{metersToTile:mf*Sf(xf(t)),metersToLabelSpace:n}}};const yf=-df,_f=df,vf=[new El([yf,yf,yf],[_f,_f,_f]),new El([yf,yf,yf],[0,0,_f]),new El([0,yf,yf],[_f,0,_f]),new El([yf,0,yf],[0,_f,_f]),new El([0,0,yf],[_f,_f,_f])];function xf(t){if(t.z<=1)return vf[t.z+2*t.y+t.x];const[e,r]=bf(t),n=[Ef(e[0],e[1]),Ef(e[0],r[1]),Ef(r[0],e[1]),Ef(r[0],r[1])],i=[_f,_f,_f],o=[yf,yf,yf];for(const s of n)i[0]=Math.min(i[0],s[0]),i[1]=Math.min(i[1],s[1]),i[2]=Math.min(i[2],s[2]),o[0]=Math.max(o[0],s[0]),o[1]=Math.max(o[1],s[1]),o[2]=Math.max(o[2],s[2]);return new El(i,o)}function bf(t){const e=Math.pow(2,t.z),r=t.x/e,n=(t.x+1)/e,i=(t.y+1)/e;return[[aa(t.y/e),sa(r)],[aa(i),sa(n)]]}function wf(t,e,r,n){return r=u(r),n||(n=df),[t*Math.sin(r)*n,-e*n,t*Math.cos(r)*n]}function Ef(t,e,r){return wf(Math.cos(u(t)),Math.sin(u(t)),e,r)}function Sf(t){return 16383/Math.max(...pl([],t.max,t.min))}function If(t){const e=Ga(new Float64Array(16)),r=Sf(t);var n,i;return Za(e,e,[r,r,r]),$a(e,e,((n=[])[0]=-(i=t.min)[0],n[1]=-i[1],n[2]=-i[2],n)),e}function Tf(t){const e=Ga(new Float64Array(16)),r=1/Sf(t);return $a(e,e,t.min),Za(e,e,[r,r,r]),e}function Cf(t){const e=Js/(2*Math.PI);return t/(2*Math.PI)/e}function Mf(t,e,r){const n=e/(2*Math.PI),i=Cf(e);if(!r){const n=m(t.center.lat,-85.051129,ua);r=[na(t.center.lng)*e,ia(n)*e]}const o=Ga(new Float64Array(16));return $a(o,o,[r[0],r[1],-n]),Za(o,o,[i,i,i]),Xa(o,o,u(-t._center.lat)),Wa(o,o,u(-t._center.lng)),o}function Af(t){return g(5,6,t)}class Pf{constructor(t){const e=this._createGridIndices();this.gridIndexBuffer=t.createIndexBuffer(e,!0),this.gridSegments=Hs.simpleSegment(0,0,4225,8192);const r=this._createPoleTriangleIndices();this.poleIndexBuffer=t.createIndexBuffer(r,!0);const n=this._createPoleVerticesForAllZooms(!0),i=this._createPoleVerticesForAllZooms(!1);this.poleNorthVertexBuffer=t.createVertexBuffer(n,hf,!1),this.poleSouthVertexBuffer=t.createVertexBuffer(i,hf,!1),this.poleSegments=this._createPoleSegments();const o=new Yo;o.emplaceBack(-1,1,1,0,0,0,0),o.emplaceBack(1,1,1,0,0,1,0),o.emplaceBack(1,-1,1,0,0,1,1),o.emplaceBack(-1,-1,1,0,0,0,1);const s=new qo;s.emplaceBack(0,1,2),s.emplaceBack(2,3,0),this.atmosphereVertexBuffer=t.createVertexBuffer(o,cf.members),this.atmosphereIndexBuffer=t.createIndexBuffer(s),this.atmosphereSegments=Hs.simpleSegment(0,0,4,2)}destroy(){this.poleIndexBuffer.destroy(),this.gridIndexBuffer.destroy(),this.poleNorthVertexBuffer.destroy(),this.poleSouthVertexBuffer.destroy(),this.poleSegments.destroy(),this.gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this.wireframeIndexBuffer&&(this.wireframeIndexBuffer.destroy(),this.wireframeSegments.destroy())}_createPoleVertices(t,e,r){const n=1<<t,i=512*n/Math.PI/2;r.emplaceBack(0,-i,0,0,0,.5,e?0:1);const o=360/n,s=Math.cos(u(85)),a=Math.sin(u(85));for(let u=0;u<=64;u++){const t=u/64,n=wf(s,a,0*(1-(l=t))+o*l,i);r.emplaceBack(n[0],n[1],n[2],0,0,t,e?0:1)}var l}_createPoleVerticesForAllZooms(t){const e=new Yo;for(let r=0;r<5;r++)this._createPoleVertices(r,t,e);return e}_createPoleTriangleIndices(){const t=new qo;for(let e=0;e<=64;e++)t.emplaceBack(0,e+1,e+2);return t}_createPoleSegments(){const t=[];let e=0;for(let r=0;r<5;r++)t.push({vertexOffset:e,primitiveOffset:0,vertexLength:66,primitiveLength:64,vaos:{},sortKey:0}),e+=66;return new Hs(t)}static createGridVertices(t){const e=Math.pow(2,t.z),r=(t,e,r)=>t*(1-r)+e*r,[n,i]=bf(t),o=new Yo,s=If(xf(t));o.reserve(4096);for(let a=0;a<65;a++){const l=r(n[0],i[0],a/64),c=ia(l),h=c*e-t.y,p=Math.sin(u(l)),f=Math.cos(u(l));for(let t=0;t<65;t++){const e=t/64,a=r(n[1],i[1],e),l=wf(f,p,a);ul(l,l,s);const u=na(a);o.emplaceBack(l[0],l[1],l[2],u,c,e,h)}}return o}_createGridIndices(){const t=new qo,e=(e,r)=>{const n=65*r+e;t.emplaceBack(n+1,n,n+65),t.emplaceBack(n+65,n+65+1,n+1)};for(let r=0;r<64;r++)for(let t=0;t<64;t++)e(t,r);return t}getWirefameBuffer(t){if(!this.wireframeSegments){const e=this._createWireframeGrid();this.wireframeIndexBuffer=t.createIndexBuffer(e),this.wireframeSegments=Hs.simpleSegment(0,0,4096,e.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}_createWireframeGrid(){const t=new Jo,e=(e,r)=>{const n=65*r+e;t.emplaceBack(n,n+1),t.emplaceBack(n,n+65),t.emplaceBack(n,n+65+1)};for(let r=0;r<64;r++)for(let t=0;t<64;t++)e(t,r);return t}getPoleBuffersForTile(t,e){return[e?this.poleNorthVertexBuffer:this.poleSouthVertexBuffer,t>=0&&t<this.poleSegments.get().length?new Hs([this.poleSegments.get()[t]]):null]}}function kf(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const r=Math.pow(2,-t.z),n=t.x*r,i=(t.x+1)*r,o=t.y*r,s=(t.y+1)*r,a=sa(n),l=sa(i),u=aa(o),c=aa(s),h=e.project(a,u),p=e.project(l,u),f=e.project(l,c),d=e.project(a,c);let m=Math.min(h.x,p.x,f.x,d.x),g=Math.min(h.y,p.y,f.y,d.y),y=Math.max(h.x,p.x,f.x,d.x),_=Math.max(h.y,p.y,f.y,d.y);const v=r/16;function x(t,r,n,i,o,s){const a=(n+o)/2,l=(i+s)/2,u=e.project(sa(a),aa(l)),c=Math.max(0,m-u.x,g-u.y,u.x-y,u.y-_);m=Math.min(m,u.x),y=Math.max(y,u.x),g=Math.min(g,u.y),_=Math.max(_,u.y),c>v&&(x(t,u,n,i,a,l),x(u,r,a,l,o,s))}x(h,p,n,o,i,o),x(p,f,i,o,i,s),x(f,d,i,s,n,s),x(d,h,n,s,n,o),m-=v,g-=v,y+=v,_+=v;const b=1/Math.max(y-m,_-g);return{scale:b,x:m*b,y:g*b,x2:y*b,y2:_*b,projection:e}}class Lf{constructor(t){const e={},r=[];for(const s in t){const n=t[s],i=e[s]={};for(const t in n.glyphs){const e=n.glyphs[+t];if(!e||0===e.bitmap.width||0===e.bitmap.height)continue;const o=e.metrics.localGlyph?2:1,s={x:0,y:0,w:e.bitmap.width+2*o,h:e.bitmap.height+2*o};r.push(s),i[t]=s}}const{w:n,h:i}=Zc(r),o=new zl({width:n||1,height:i||1});for(const s in t){const r=t[s];for(const t in r.glyphs){const n=r.glyphs[+t];if(!n||0===n.bitmap.width||0===n.bitmap.height)continue;const i=e[s][t],a=n.metrics.localGlyph?2:1;zl.copy(n.bitmap,o,{x:0,y:0},{x:i.x+a,y:i.y+a},n.bitmap)}}this.image=o,this.positions=e}}hi("GlyphAtlas",Lf);class zf{constructor(t){this.tileID=new bp(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.enableTerrain=!!t.enableTerrain,this.isSymbolTile=t.isSymbolTile,this.tileTransform=kf(t.tileID.canonical,t.projection),this.projection=t.projection}parse(t,e,r,n,i){this.status="parsing",this.data=t,this.collisionBoxArray=new ns;const o=new Pp(Object.keys(t.layers).sort()),s=new Wp(this.tileID,this.promoteId);s.bucketLayerIDs=[];const a={},l=new fp(256,256),u={featureIndex:s,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:l,availableImages:r},c=e.familiesBySource[this.source];for(const v in c){const e=t.layers[v];if(!e)continue;let n=!1,i=!1;for(const t of c[v])"symbol"===t[0].type?n=!0:i=!0;if(!0===this.isSymbolTile&&!n)continue;if(!1===this.isSymbolTile&&!i)continue;1===e.version&&L(`Vector tile source "${this.source}" layer "${v}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const l=o.encode(v),h=[];for(let t=0;t<e.length;t++){const r=e.feature(t),n=s.getId(r,v);h.push({feature:r,id:n,index:t,sourceLayerIndex:l})}for(const t of c[v]){const e=t[0];void 0!==this.isSymbolTile&&"symbol"===e.type!==this.isSymbolTile||e.minzoom&&this.zoom<Math.floor(e.minzoom)||e.maxzoom&&this.zoom>=e.maxzoom||"none"!==e.visibility&&(Df(t,this.zoom,r),(a[e.id]=e.createBucket({index:s.bucketLayerIDs.length,layers:t,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:l,sourceID:this.source,enableTerrain:this.enableTerrain,availableImages:r})).populate(h,u,this.tileID.canonical,this.tileTransform),s.bucketLayerIDs.push(t.map(t=>t.id)))}}let h,p,f,d;l.trim();const m={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},g=M(u.glyphDependencies,t=>Object.keys(t).map(Number));Object.keys(g).length?n.send("getGlyphs",{uid:this.uid,stacks:g},(t,e)=>{h||(h=t,p=e,x.call(this))},void 0,!1,m):p={};const y=Object.keys(u.iconDependencies);y.length?n.send("getImages",{icons:y,source:this.source,tileID:this.tileID,type:"icons"},(t,e)=>{h||(h=t,f=e,x.call(this))},void 0,!1,m):f={};const _=Object.keys(u.patternDependencies);function x(){if(h)return i(h);if(p&&f&&d){const t=new Lf(p),e=new Wc(f,d);for(const n in a){const i=a[n];i instanceof ep?(Df(i.layers,this.zoom,r),Bh(i,p,t.positions,f,e.iconPositions,this.showCollisionBoxes,r,this.tileID.canonical,this.tileZoom,this.projection),i.projection=this.projection.name):i.hasPattern&&(i instanceof tc||i instanceof wu||i instanceof Uu)&&(Df(i.layers,this.zoom,r),i.addFeatures(u,this.tileID.canonical,e.patternPositions,r))}this.status="done",i(null,{buckets:v(a).filter(t=>!t.isEmpty()),featureIndex:s,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:t.image,lineAtlas:l,imageAtlas:e,glyphMap:this.returnDependencies?p:null,iconMap:this.returnDependencies?f:null,glyphPositions:this.returnDependencies?t.positions:null})}}_.length?n.send("getImages",{icons:_,source:this.source,tileID:this.tileID,type:"patterns"},(t,e)=>{h||(h=t,d=e,x.call(this))},void 0,!1,m):d={},x.call(this)}}function Df(t,e,r){const n=new co(e);for(const i of t)i.recalculate(n,r)}class Rf{constructor(t){this.entries={},this.scheduler=t}request(t,e,r,n){const i=this.entries[t]=this.entries[t]||{callbacks:[]};if(i.result){const[t,r]=i.result;return this.scheduler?this.scheduler.add(()=>{n(t,r)},e):n(t,r),()=>{}}return i.callbacks.push(n),i.cancel||(i.cancel=r((r,n)=>{i.result=[r,n];for(const t of i.callbacks)this.scheduler?this.scheduler.add(()=>{t(r,n)},e):t(r,n);setTimeout(()=>delete this.entries[t],3e3)})),()=>{i.result||(i.callbacks=i.callbacks.filter(t=>t!==n),i.callbacks.length||(i.cancel(),delete this.entries[t]))}}}function Of(t,e,r){const n=JSON.stringify(t.request);return t.data&&(this.deduped.entries[n]={result:[null,t.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},e=>{const n=Ct(t.request,(t,n,i,o)=>{t?e(t):n&&e(null,{vectorTile:r?void 0:new Ou.VectorTile(new Ec(n)),rawData:n,cacheControl:i,expires:o})});return()=>{n.cancel(),e()}},e)}const Nf=Ga(new Float64Array(16));class Ff{constructor(t,e){this._tr=t,this._worldSize=e}createInversionMatrix(){return Nf}createTileMatrix(t){let e,r,n;const i=t.canonical,o=Ga(new Float64Array(16)),s=this._tr.projection;if(s.isReprojectedInTileSpace){const a=kf(i,s);e=1,r=a.x+t.wrap*a.scale,n=a.y,Za(o,o,[e/a.scale,e/a.scale,this._tr.pixelsPerMeter/this._worldSize])}else e=this._worldSize/this._tr.zoomScale(i.z),r=(i.x+Math.pow(2,i.z)*t.wrap)*e,n=i.y*e;return $a(o,o,[r,n,0]),Za(o,o,[e/Js,e/Js,1]),o}pointCoordinate(t,e,r){const n=this._tr.horizonLineFromTop(!1),o=new i(t,Math.max(n,e));return this._tr.rayIntersectionCoordinate(this._tr.pointRayIntersection(o,r))}}var Bf={name:"albers",range:[4,7],center:[-96,37.5],parallels:[29.5,45.5],zAxisUnit:"meters",conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&xl(this.parallels,this.constants.parallels))return;const t=Math.sin(u(this.parallels[0])),e=(t+Math.sin(u(this.parallels[1])))/2,r=1+t*(2*e-t),n=Math.sqrt(r)/e;this.constants={n:e,c:r,r0:n,parallels:this.parallels}},project(t,e){this.initializeConstants();const r=u(t-this.center[0]),n=u(e),{n:i,c:o,r0:s}=this.constants,a=Math.sqrt(o-2*i*Math.sin(n))/i;return{x:a*Math.sin(r*i),y:a*Math.cos(r*i)-s,z:0}},unproject(t,e){this.initializeConstants();const{n:r,c:n,r0:i}=this.constants,o=i+e;let s=Math.atan2(t,Math.abs(o))*Math.sign(o);o*r<0&&(s-=Math.PI*Math.sign(t)*Math.sign(o));const a=u(this.center[0])*r;s=y(s,-Math.PI-a,Math.PI-a);const l=c(s/r)+this.center[0],h=Math.asin(m((n-(t*t+o*o)*r*r)/(2*r),-1,1)),p=m(c(h),-85.051129,ua);return new ta(l,p)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>oa(1,t)*e,farthestPixelDistance(t){return ff(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new Ff(t,e),upVector:()=>[0,0,1],upVectorScale:()=>({metersToTile:1,metersToLabelSpace:1})};const jf=1.340264,Uf=-.081106,Vf=893e-6,Gf=.003796,qf=Math.sqrt(3)/2;var $f={name:"equalEarth",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(t,e){e=e/180*Math.PI,t=t/180*Math.PI;const r=Math.asin(qf*Math.sin(e)),n=r*r,i=n*n*n;return{x:.5*(t*Math.cos(r)/(qf*(jf+3*Uf*n+i*(7*Vf+9*Gf*n)))/Math.PI+.5),y:1-.5*(r*(jf+Uf*n+i*(Vf+Gf*n))/Math.PI+1),z:0}},unproject(t,e){t=(2*t-.5)*Math.PI;let r=e=(2*(1-e)-1)*Math.PI,n=r*r,i=n*n*n;for(let u,c,h,p=0;p<12&&(c=r*(jf+Uf*n+i*(Vf+Gf*n))-e,h=jf+3*Uf*n+i*(7*Vf+9*Gf*n),u=c/h,r=m(r-u,-Math.PI/3,Math.PI/3),n=r*r,i=n*n*n,!(Math.abs(u)<1e-12));++p);const o=qf*t*(jf+3*Uf*n+i*(7*Vf+9*Gf*n))/Math.cos(r),s=Math.asin(Math.sin(r)/qf),a=m(180*o/Math.PI,-180,180),l=m(180*s/Math.PI,-85.051129,ua);return new ta(a,l)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>oa(1,t)*e,farthestPixelDistance(t){return ff(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new Ff(t,e),upVector:()=>[0,0,1],upVectorScale:()=>({metersToTile:1,metersToLabelSpace:1})},Zf={name:"equirectangular",supportsWorldCopies:!0,center:[0,0],range:[3.5,7],zAxisUnit:"meters",wrap:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project:(t,e)=>({x:.5+t/360,y:.5-e/360,z:0}),unproject(t,e){const r=360*(t-.5),n=m(360*(.5-e),-85.051129,ua);return new ta(r,n)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>oa(1,t)*e,farthestPixelDistance(t){return ff(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new Ff(t,e),upVector:()=>[0,0,1],upVectorScale:()=>({metersToTile:1,metersToLabelSpace:1})};const Xf=Math.PI/2;function Wf(t){return Math.tan((Xf+t)/2)}var Yf={name:"lambertConformalConic",range:[3.5,7],zAxisUnit:"meters",center:[0,30],parallels:[30,30],conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&xl(this.parallels,this.constants.parallels))return;const t=u(this.parallels[0]),e=u(this.parallels[1]),r=Math.cos(t),n=t===e?Math.sin(t):Math.log(r/Math.cos(e))/Math.log(Wf(e)/Wf(t)),i=r*Math.pow(Wf(t),n)/n;this.constants={n:n,f:i,parallels:this.parallels}},project(t,e){this.initializeConstants(),e=u(e),t=u(t-this.center[0]);const r=1e-6,{n:n,f:i}=this.constants;i>0?e<-Xf+r&&(e=-Xf+r):e>Xf-r&&(e=Xf-r);const o=i/Math.pow(Wf(e),n),s=o*Math.sin(n*t),a=i-o*Math.cos(n*t);return{x:.5*(s/Math.PI+.5),y:1-.5*(a/Math.PI+.5),z:0}},unproject(t,e){this.initializeConstants(),t=(2*t-.5)*Math.PI,e=(2*(1-e)-.5)*Math.PI;const{n:r,f:n}=this.constants,i=n-e,o=Math.sign(i),s=Math.sign(r)*Math.sqrt(t*t+i*i);let a=Math.atan2(t,Math.abs(i))*o;i*r<0&&(a-=Math.PI*Math.sign(t)*o);const l=m(c(a/r)+this.center[0],-180,180),u=m(c(2*Math.atan(Math.pow(n/s,1/r))-Xf),-85.051129,ua);return new ta(l,u)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>oa(1,t)*e,farthestPixelDistance(t){return ff(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new Ff(t,e),upVector:()=>[0,0,1],upVectorScale:()=>({metersToTile:1,metersToLabelSpace:1})},Hf={name:"mercator",wrap:!0,requiresDraping:!1,supportsWorldCopies:!0,supportsTerrain:!0,supportsFog:!0,supportsFreeCamera:!0,zAxisUnit:"meters",center:[0,0],project:(t,e)=>({x:na(t),y:ia(e),z:0}),unproject(t,e){const r=sa(t),n=aa(e);return new ta(r,n)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>oa(1,t)*e,farthestPixelDistance(t){return ff(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new Ff(t,e),upVector:()=>[0,0,1],upVectorScale:()=>({metersToTile:1,metersToLabelSpace:1})};const Jf=u(ua);var Kf={name:"naturalEarth",center:[0,0],range:[3.5,7],isReprojectedInTileSpace:!0,zAxisUnit:"meters",unsupportedLayers:["custom"],project(t,e){const r=(e=u(e))*e,n=r*r;return{x:.5*((t=u(t))*(.8707-.131979*r+n*(n*(.003971*r-.001529*n)-.013791))/Math.PI+.5),y:1-.5*(e*(1.007226+r*(.015085+n*(.028874*r-.044475-.005916*n)))/Math.PI+1),z:0}},unproject(t,e){t=(2*t-.5)*Math.PI;let r=e=(2*(1-e)-1)*Math.PI,n=25,i=0,o=r*r;do{o=r*r;const t=o*o;i=(r*(1.007226+o*(.015085+t*(.028874*o-.044475-.005916*t)))-e)/(1.007226+o*(.045255+t*(.259866*o-.311325-.005916*11*t))),r=m(r-i,-Jf,Jf)}while(Math.abs(i)>1e-6&&--n>0);o=r*r;const s=m(c(t/(.8707+o*(o*(o*o*o*(.003971-.001529*o)-.013791)-.131979))),-180,180),a=c(r);return new ta(s,a)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>oa(1,t)*e,farthestPixelDistance(t){return ff(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new Ff(t,e),upVector:()=>[0,0,1],upVectorScale:()=>({metersToTile:1,metersToLabelSpace:1})};const Qf=u(ua),td={globe:gf,albers:Bf,equalEarth:$f,equirectangular:Zf,lambertConformalConic:Yf,mercator:Hf,naturalEarth:Kf,winkelTripel:{name:"winkelTripel",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(t,e){e=u(e),t=u(t);const r=Math.cos(e),n=2/Math.PI,i=Math.acos(r*Math.cos(t/2)),o=Math.sin(i)/i,s=.5*(t*n+2*r*Math.sin(t/2)/o)||0,a=.5*(e+Math.sin(e)/o)||0;return{x:.5*(s/Math.PI+.5),y:1-.5*(a/Math.PI+1),z:0}},unproject(t,e){let r=t=(2*t-.5)*Math.PI,n=e=(2*(1-e)-1)*Math.PI,i=25;const o=1e-6;let s=0,a=0;do{const i=Math.cos(n),o=Math.sin(n),l=2*o*i,u=o*o,c=i*i,h=Math.cos(r/2),p=Math.sin(r/2),f=2*h*p,d=p*p,g=1-c*h*h,y=g?1/g:0,_=g?Math.acos(i*h)*Math.sqrt(1/g):0,v=.5*(2*_*i*p+2*r/Math.PI)-t,x=.5*(_*o+n)-e,b=.5*y*(c*d+_*i*h*u)+1/Math.PI,w=y*(f*l/4-_*o*p),E=.125*y*(l*p-_*o*c*f),S=.5*y*(u*h+_*d*i)+.5,I=w*E-S*b;s=(x*w-v*S)/I,a=(v*E-x*b)/I,r=m(r-s,-Math.PI,Math.PI),n=m(n-a,-Qf,Qf)}while((Math.abs(s)>o||Math.abs(a)>o)&&--i>0);return new ta(c(r),c(n))},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>oa(1,t)*e,farthestPixelDistance(t){return ff(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new Ff(t,e),upVector:()=>[0,0,1],upVectorScale:()=>({metersToTile:1,metersToLabelSpace:1})}};t.ARRAY_TYPE=ja,t.AUTH_ERR_MSG=tt,t.Aabb=El,t.Actor=class{constructor(t,e,r){this.target=t,this.parent=e,this.mapId=r,this.callbacks={},this.cancelCallbacks={},T(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=R()?t:s,this.scheduler=new yp}send(t,e,r,n,i=!1,o){const s=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=o,this.callbacks[s]=r);const a=U(this.globalScope)?void 0:[];return this.target.postMessage({id:s,type:t,hasCallback:!!r,targetMapId:n,mustQueue:i,sourceMapId:this.mapId,data:di(e,a)},a),{cancel:()=>{r&&delete this.callbacks[s],this.target.postMessage({id:s,type:"<cancel>",targetMapId:n,sourceMapId:this.mapId})}}}receive(t){const e=t.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const t=this.cancelCallbacks[r];delete this.cancelCallbacks[r],t&&t.cancel()}else if(e.mustQueue||R()){const t=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add(()=>this.processTask(r,e),t&&t.metadata||{type:"message"})}else this.processTask(r,e)}processTask(t,e){if("<response>"===e.type){const r=this.callbacks[t];delete this.callbacks[t],r&&(e.error?r(mi(e.error)):r(null,mi(e.data)))}else{const r=U(this.globalScope)?void 0:[],n=e.hasCallback?(e,n)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:e?di(e):null,data:di(n,r)},r)}:t=>{},i=mi(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,i,n);else if(this.parent.getWorkerSource){const t=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,t[0],i.source)[t[1]](i,n)}else n(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},t.CanonicalTileID=vp,t.Color=pe,t.ColorMode=Tp,t.CullFaceMode=Ap,t.DEMData=Vp,t.DataConstantProperty=xo,t.DedupedRequest=Rf,t.DepthMode=Ep,t.EXTENT=Js,t.Elevation=class{getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,r=!0){null==e&&(e=null);const n=this._source();if(!n)return e;if(t.y<0||t.y>1)return e;const i=n.getSource().maxzoom,o=1<<i,s=Math.floor(t.x),a=t.x-s,l=new bp(i,s,i,Math.floor(a*o),Math.floor(t.y*o)),u=this.findDEMTileFor(l);if(!u||!u.dem)return e;const c=u.dem,h=1<<u.tileID.canonical.z,p=(a*h-u.tileID.canonical.x)*c.dim,f=(t.y*h-u.tileID.canonical.y)*c.dim,d=Math.floor(p),m=Math.floor(f);return(r?this.exaggeration():1)*ir(ir(c.get(d,m),c.get(d,m+1),f-m),ir(c.get(d+1,m),c.get(d+1,m+1),f-m),p-d)}getAtTileOffset(t,e,r){const n=1<<t.canonical.z;return this.getAtPointOrZero(new ca(t.wrap+(t.canonical.x+e/Js)/n,(t.canonical.y+r/Js)/n))}getAtTileOffsetFunc(t,e,r,n){return i=>{const o=this.getAtTileOffset(t,i.x,i.y),s=n.upVector(t.canonical,i.x,i.y);return il(s,s,o*n.upVectorScale(t.canonical,e,r).metersToTile),s}}getForTilePoints(t,e,r,n){const i=Xp.create(this,t,n);return!!i&&(e.forEach(t=>{t[2]=this.exaggeration()*i.getElevationAt(t[0],t[1],r)}),!0)}getMinMaxForTile(t){const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const r=e.dem.tree,n=e.tileID,i=1<<t.canonical.z-n.canonical.z;let o=t.canonical.x/i-n.canonical.x,s=t.canonical.y/i-n.canonical.y,a=0;for(let l=0;l<t.canonical.z-n.canonical.z&&!r.leaves[a];l++){o*=2,s*=2;const t=2*Math.floor(s)+Math.floor(o);a=r.childOffsets[a]+t,o%=1,s%=1}return{min:this.exaggeration()*r.minimums[a],max:this.exaggeration()*r.maximums[a]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},t.ErrorEvent=Ft,t.EvaluationParameters=co,t.Event=Nt,t.Evented=Bt,t.Frustum=wl,t.GLOBE_ZOOM_THRESHOLD_MAX=6,t.GlobeSharedBuffers=Pf,t.GlyphManager=Sh,t.ImagePosition=Xc,t.LineAtlas=fp,t.LngLat=ta,t.LngLatBounds=Ks,t.LocalGlyphMode=Eh,t.MAX_MERCATOR_LATITUDE=ua,t.MercatorCoordinate=ca,t.ONE_EM=hc,t.OverscaledTileID=bp,t.Properties=Io,t.RGBAImage=Dl,t.Ray=bl,t.RequestManager=class{constructor(t,e,r){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const t=function(){let t="";for(let e=0;e<10;e++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Q,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!et(t))return t;const r=it(t);return r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!et(t))return t;const r=it(t);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeSourceURL(t,e){if(!et(t))return t;const r=it(t);return r.path=`/v4/${r.authority}.json`,r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||e)}normalizeSpriteURL(t,e,r,n){const i=it(t);return et(t)?(i.path=`/styles/v1${i.path}/sprite${e}${r}`,this._makeAPIURL(i,this._customAccessToken||n)):(i.path+=`${e}${r}`,ot(i))}normalizeTileURL(t,e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!et(t))return t;const n=it(t);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||r&&"raster"!==n.authority&&512===r?"@2x":""}${X.supported?".webp":"$1"}`),"raster"===n.authority?n.path=`/${Z.RASTER_URL_PREFIX}${n.path}`:(n.path=n.path.replace(/^.+\/v4\//,"/"),n.path=`/${Z.TILE_URL_VERSION}${n.path}`);const i=this._customAccessToken||function(t){for(const e of t){const t=e.match(/^access_token=(.*)$/);if(t)return t[1]}return null}(n.params)||Z.ACCESS_TOKEN;return Z.REQUIRE_ACCESS_TOKEN&&i&&this._skuToken&&n.params.push(`sku=${this._skuToken}`),this._makeAPIURL(n,i)}canonicalizeTileURL(t,e){const r=it(t);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return t;let n="mapbox://";r.path.match(/^\/raster\/v1\//)?n+=`raster/${r.path.replace(`/${Z.RASTER_URL_PREFIX}/`,"")}`:n+=`tiles/${r.path.replace(`/${Z.TILE_URL_VERSION}/`,"")}`;let i=r.params;return e&&(i=i.filter(t=>!t.match(/^access_token=/))),i.length&&(n+=`?${i.join("&")}`),n}canonicalizeTileset(t,e){const r=!!e&&et(e),n=[];for(const i of t.tiles||[])rt(i)?n.push(this.canonicalizeTileURL(i,r)):n.push(i);return n}_makeAPIURL(t,e){const r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",n=it(Z.API_URL);if(t.protocol=n.protocol,t.authority=n.authority,"http"===t.protocol){const e=t.params.indexOf("secure");e>=0&&t.params.splice(e,1)}if("/"!==n.path&&(t.path=`${n.path}${t.path}`),!Z.REQUIRE_ACCESS_TOKEN)return ot(t);if(e=e||Z.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return t.params=t.params.filter(t=>-1===t.indexOf("access_token")),t.params.push(`access_token=${e||""}`),ot(t)}},t.ResourceType=Et,t.SegmentVector=Hs,t.SourceCache=qp,t.StencilMode=Ip,t.StructArrayLayout1ui2=Ko,t.StructArrayLayout2f1f2i16=Vo,t.StructArrayLayout2i4=Lo,t.StructArrayLayout2ui4=Jo,t.StructArrayLayout3f12=Ro,t.StructArrayLayout3ui6=qo,t.StructArrayLayout4i8=zo,t.Texture=pp,t.Tile=lf,t.Transitionable=fo,t.Uniform1f=Cs,t.Uniform1i=class extends Ts{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))}},t.Uniform2f=class extends Ts{constructor(t,e){super(t,e),this.current=[0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))}},t.Uniform3f=class extends Ts{constructor(t,e){super(t,e),this.current=[0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))}},t.Uniform4f=Ms,t.UniformColor=As,t.UniformMatrix2f=class extends Ts{constructor(t,e){super(t,e),this.current=Ls}set(t){for(let e=0;e<4;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix2fv(this.location,!1,t);break}}},t.UniformMatrix3f=class extends Ts{constructor(t,e){super(t,e),this.current=ks}set(t){for(let e=0;e<9;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix3fv(this.location,!1,t);break}}},t.UniformMatrix4f=class extends Ts{constructor(t,e){super(t,e),this.current=Ps}set(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(let e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}}},t.UnwrappedTileID=xp,t.ValidationError=Ut,t.VectorTileWorkerSource=class extends Bt{constructor(t,e,r,n,i){super(),this.actor=t,this.layerIndex=e,this.availableImages=r,this.loadVectorData=i||Of,this.loading={},this.loaded={},this.deduped=new Rf(t.scheduler),this.isSpriteLoaded=n,this.scheduler=t.scheduler}loadTile(t,e){const r=t.uid,n=t&&t.request,i=n&&n.collectResourceTiming,o=this.loading[r]=new zf(t);o.abort=this.loadVectorData(t,(s,a)=>{const l=!this.loading[r];if(delete this.loading[r],l||s||!a)return o.status="done",l||(this.loaded[r]=o),e(s);const u=a.rawData,c={};a.expires&&(c.expires=a.expires),a.cacheControl&&(c.cacheControl=a.cacheControl),o.vectorTile=a.vectorTile||new Ou.VectorTile(new Ec(u));const h=()=>{o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,(t,r)=>{if(t||!r)return e(t);const o={};if(i){const t=gp(n);t.length>0&&(o.resourceTiming=JSON.parse(JSON.stringify(t)))}e(null,x({rawTileData:u.slice(0)},r,c,o))})};this.isSpriteLoaded?h():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(h,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):h()}),this.loaded=this.loaded||{},this.loaded[r]=o})}reloadTile(t,e){const r=this.loaded,n=t.uid,i=this;if(r&&r[n]){const o=r[n];o.showCollisionBoxes=t.showCollisionBoxes,o.enableTerrain=!!t.enableTerrain,o.projection=t.projection;const s=(t,r)=>{const n=o.reloadCallback;n&&(delete o.reloadCallback,o.parse(o.vectorTile,i.layerIndex,this.availableImages,i.actor,n)),e(t,r)};"parsing"===o.status?o.reloadCallback=s:"done"===o.status&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}}abortTile(t,e){const r=t.uid,n=this.loading[r];n&&(n.abort&&n.abort(),delete this.loading[r]),e()}removeTile(t,e){const r=this.loaded,n=t.uid;r&&r[n]&&delete r[n],e()}},t.WritingMode=Yc,t.ZoomHistory=gi,t.add=tl,t.addDynamicAttributes=Jh,t.adjoint=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],s=e[4],a=e[5],l=e[6],u=e[7],c=e[8];return t[0]=s*c-a*u,t[1]=i*u-n*c,t[2]=n*a-i*s,t[3]=a*l-o*c,t[4]=r*c-i*l,t[5]=i*o-r*a,t[6]=o*u-s*l,t[7]=n*l-r*u,t[8]=r*s-n*o,t},t.asyncAll=_,t.bezier=f,t.bindAll=T,t.boundsAttributes=sf,t.bufferConvexPolygon=function(t,e){const r=[];for(let n=0;n<t.length;n++){const i=y(n-1,-1,t.length-1),o=y(n+1,-1,t.length-1),s=t[n],a=t[o],l=t[i].sub(s).unit(),u=a.sub(s).unit(),c=u.angleWithSep(l.x,l.y),h=l.add(u).unit().mult(-1*e/Math.sin(c/2));r.push(s.add(h))}return r},t.cacheEntryPossiblyAdded=function(t){wt++,wt>vt&&(t.getActor().send("enforceCacheSizeLimit",_t),wt=0)},t.calculateGlobeMatrix=Mf,t.calculateGlobeMercatorMatrix=function(t){const e=t.worldSize,r=m(t.center.lat,-85.051129,ua),n=new i(na(t.center.lng)*e,ia(r)*e),o=oa(1,t.center.lat)*e,s=t.pixelsPerMeter,a=e/(o/t.pixelsPerMeter),l=Ga(new Float64Array(16));return $a(l,l,[n.x,n.y,0]),Za(l,l,[a,a,s]),Float32Array.from(l)},t.clamp=m,t.clearTileCache=function(t){const e=s.caches.delete(mt);t&&e.catch(t).then(()=>t())},t.clipLine=vh,t.clone=function(t){var e=new ja(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.clone$1=P,t.collisionCircleLayout=cc,t.config=Z,t.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},t.create=Va,t.create$1=Ua,t.createExpression=pn,t.createLayout=Po,t.createStyleLayer=function(t){return"custom"===t.type?new lp(t):new hp[t.type](t)},t.cross=ll,t.degToRad=u,t.div=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t},t.dot=al,t.ease=d,t.easeCubicInOut=p,t.emitValidationErrors=ai,t.endsWith=C,t.enforceCacheSizeLimit=function(t){xt(),gt&&gt.then(e=>{e.keys().then(r=>{for(let n=0;n<r.length-t;n++)e.delete(r[n])})})},t.evaluateSizeForFeature=dc,t.evaluateSizeForZoom=mc,t.evaluateVariableOffset=Fh,t.evented=so,t.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},t.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},t.exported=q,t.exported$1=X,t.extend=x,t.extend$1=Gt,t.filterObject=A,t.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},t.fromQuat=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],s=r+r,a=n+n,l=i+i,u=r*s,c=n*s,h=n*a,p=i*s,f=i*a,d=i*l,m=o*s,g=o*a,y=o*l;return t[0]=1-h-d,t[1]=c+y,t[2]=p-g,t[3]=0,t[4]=c-y,t[5]=1-u-d,t[6]=f+m,t[7]=0,t[8]=p+g,t[9]=f-m,t[10]=1-u-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.fromRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return h[e]},t.getAABBPointSquareDist=function(t,e,r){let n=0;for(let i=0;i<2;++i){const o=r?r[i]:0;t[i]>o&&(n+=(t[i]-o)*(t[i]-o)),e[i]<o&&(n+=(o-e[i])*(o-e[i]))}return n},t.getAnchorAlignment=ah,t.getAnchorJustification=jh,t.getBounds=function(t){let e=1/0,r=1/0,n=-1/0,o=-1/0;for(const i of t)e=Math.min(e,i.x),r=Math.min(r,i.y),n=Math.max(n,i.x),o=Math.max(o,i.y);return{min:new i(e,r),max:new i(n,o)}},t.getColumn=G,t.getImage=Dt,t.getJSON=function(t,e){return Tt(x(t,{type:"json"}),e)},t.getMapSessionAPI=ft,t.getPerformanceMeasurement=gp,t.getProjection=function(t){const e=td[t.name];if(!e)throw new Error(`Invalid projection name: ${t.name}`);return e.conic?function(t,e){if(e.parallels&&Math.abs(e.parallels[0]+e.parallels[1])<.01){let r=function(t){const e=Math.max(.01,Math.cos(u(t))),r=1/(2*Math.max(Math.PI*e,1/e));return{wrap:!0,supportsWorldCopies:!0,unsupportedLayers:["custom"],project(t,n){const i=u(t)*e,o=Math.sin(u(n))/e;return{x:i*r+.5,y:-o*r+.5,z:0}},unproject(t,n){const i=-(n-.5)/r,o=m(c((t-.5)/r)/e,-180,180),s=Math.asin(m(i*e,-1,1)),a=m(c(s),-85.051129,ua);return new ta(o,a)}}}(e.parallels[0]);if("lambertConformalConic"===e.name){const{project:t,unproject:e}=td.mercator;r={wrap:!0,supportsWorldCopies:!0,project:t,unproject:e}}return x({},t,e,r)}return x({},t,e)}(e,t):e},t.getRTLTextPluginStatus=ao,t.getReferrer=It,t.getTilePoint=function(t,{x:e,y:r},n=0){return new i(((e-n)*t.scale-t.x)*Js,(r*t.scale-t.y)*Js)},t.getTileVec3=function(t,e,r=0){return Qa(((e.x-r)*t.scale-t.x)*Js,(e.y*t.scale-t.y)*Js,la(e.z,e.y))},t.getVideo=function(t,e){const r=s.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let n=0;n<t.length;n++){const e=s.document.createElement("source");Pt(t[n])||(r.crossOrigin="Anonymous"),e.src=t[n],r.appendChild(e)}return{cancel:()=>{}}},t.globeDenormalizeECEF=Tf,t.globeECEFOrigin=function(t,e){const r=[0,0,0];return ul(r,r,If(xf(e.canonical))),ul(r,r,t),r},t.globeMatrixForTile=function(t,e){const r=Tf(xf(t));return Ya(Va(),e,r)},t.globePixelsToTileUnits=function(t,e){return Js/(512*Math.pow(2,t))*Sf(xf(e))},t.globePoleMatrixForTile=function(t,e,r){const n=Ga(new Float64Array(16)),i=Math.pow(2,t.z),o=(t.x-i/2)/i*Math.PI*2,s=r.point,a=r.worldSize/(r.tileSize*i);return $a(n,n,[s.x,s.y,-r.worldSize/Math.PI/2]),Za(n,n,[a,a,a]),Xa(n,n,u(-r._center.lat)),Wa(n,n,u(-r._center.lng)),Wa(n,n,o),e||Za(n,n,[1,-1,1]),Float32Array.from(n)},t.globeTileBounds=xf,t.globeToMercatorTransition=Af,t.globeVertexBufferForTileMesh=function(t,e,r){const n=t.context;let i=e.globeGridBuffer;if(!i){const t=Pf.createGridVertices(r.canonical);i=e.globeGridBuffer=n.createVertexBuffer(t,hf,!1)}return i},t.identity=Ga,t.identity$1=_l,t.invert=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],s=e[4],a=e[5],l=e[6],u=e[7],c=e[8],h=e[9],p=e[10],f=e[11],d=e[12],m=e[13],g=e[14],y=e[15],_=r*a-n*s,v=r*l-i*s,x=r*u-o*s,b=n*l-i*a,w=n*u-o*a,E=i*u-o*l,S=c*m-h*d,I=c*g-p*d,T=c*y-f*d,C=h*g-p*m,M=h*y-f*m,A=p*y-f*g,P=_*A-v*M+x*C+b*T-w*I+E*S;return P?(t[0]=(a*A-l*M+u*C)*(P=1/P),t[1]=(i*M-n*A-o*C)*P,t[2]=(m*E-g*w+y*b)*P,t[3]=(p*w-h*E-f*b)*P,t[4]=(l*T-s*A-u*I)*P,t[5]=(r*A-i*T+o*I)*P,t[6]=(g*x-d*E-y*v)*P,t[7]=(c*E-p*x+f*v)*P,t[8]=(s*M-a*T+u*S)*P,t[9]=(n*T-r*M-o*S)*P,t[10]=(d*w-m*x+y*_)*P,t[11]=(h*x-c*w-f*_)*P,t[12]=(a*I-s*C-l*S)*P,t[13]=(r*C-n*I+i*S)*P,t[14]=(m*v-d*b-g*_)*P,t[15]=(c*b-h*v+p*_)*P,t):null},t.isMapAuthenticated=function(t){return dt.has(t)},t.isMapboxURL=et,t.latFromMercatorY=aa,t.len=dl,t.length=Ka,t.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},t.loadVectorTile=Of,t.makeRequest=Tt,t.mercatorXfromLng=na,t.mercatorYfromLat=ia,t.mercatorZfromAltitude=oa,t.mul=Ya,t.mul$1=fl,t.multiply=function(t,e,r){var n=e[0],i=e[1],o=e[2],s=e[3],a=e[4],l=e[5],u=e[6],c=e[7],h=e[8],p=r[0],f=r[1],d=r[2],m=r[3],g=r[4],y=r[5],_=r[6],v=r[7],x=r[8];return t[0]=p*n+f*s+d*u,t[1]=p*i+f*a+d*c,t[2]=p*o+f*l+d*h,t[3]=m*n+g*s+y*u,t[4]=m*i+g*a+y*c,t[5]=m*o+g*l+y*h,t[6]=_*n+v*s+x*u,t[7]=_*i+v*a+x*c,t[8]=_*o+v*l+x*h,t},t.multiply$1=qa,t.multiply$2=rl,t.nextPowerOfTwo=S,t.normalize=sl,t.normalize$1=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],s=r*r+n*n+i*i+o*o;return s>0&&(s=1/Math.sqrt(s)),t[0]=r*s,t[1]=n*s,t[2]=i*s,t[3]=o*s,t},t.number=ir,t.ortho=function(t,e,r,n,i,o,s){var a=1/(e-r),l=1/(n-i),u=1/(o-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+r)*a,t[13]=(i+n)*l,t[14]=(s+o)*u,t[15]=1,t},t.pbf=Ec,t.perspective=function(t,e,r,n,i){var o,s=1/Math.tan(e/2);return t[0]=s/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(t[10]=(i+n)*(o=1/(n-i)),t[14]=2*i*n*o):(t[10]=-1,t[14]=-2*n),t},t.pick=function(t,e){const r={};for(let n=0;n<e.length;n++){const i=e[n];i in t&&(r[i]=t[i])}return r},t.plugin=uo,t.pointGeometry=i,t.polygonIntersectsBox=ka,t.polygonIntersectsPolygon=ba,t.polygonizeBounds=function(t,e,r=0,n=!0){const o=new i(r,r),s=t.sub(o),a=e.add(o),l=[s,new i(a.x,s.y),a,new i(s.x,a.y)];return n&&l.push(s),l},t.posAttributes=Jp,t.postMapLoadEvent=ht,t.postTurnstileEvent=ut,t.potpack=Zc,t.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},t.radToDeg=c,t.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.registerForPluginStateChange=function(t){return t({pluginStatus:ro,pluginURL:no}),so.on("pluginStateChange",t),t},t.removeAuthState=function(t){dt.delete(t)},t.renderColorRamp=Ol,t.rotateX=Xa,t.rotateX$1=vl,t.rotateY=Wa,t.rotateZ=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[0],s=e[1],a=e[2],l=e[3],u=e[4],c=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+u*n,t[1]=s*i+c*n,t[2]=a*i+h*n,t[3]=l*i+p*n,t[4]=u*i-o*n,t[5]=c*i-s*n,t[6]=h*i-a*n,t[7]=p*i-l*n,t},t.rotateZ$1=function(t,e,r){r*=.5;var n=e[0],i=e[1],o=e[2],s=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=n*l+i*a,t[1]=i*l-n*a,t[2]=o*l+s*a,t[3]=s*l-o*a,t},t.scale=Za,t.scale$1=ml,t.scale$2=il,t.scaleAndAdd=ol,t.setCacheLimits=function(t,e){_t=t,vt=e},t.setColumn=function(t,e,r){t[4*e+0]=r[0],t[4*e+1]=r[1],t[4*e+2]=r[2],t[4*e+3]=r[3]},t.setRTLTextPlugin=function(t,e,r=!1){if(ro===Ki||ro===Qi||ro===to)throw new Error("setRTLTextPlugin cannot be called multiple times.");no=q.resolveURL(t),ro=Ki,eo=e,oo(),r||lo()},t.smoothstep=g,t.spec=jt,t.storeAuthState=function(t,e){e?dt.add(t):dt.delete(t)},t.sub=pl,t.subtract=el,t.symbolSize=gc,t.tileAABB=function(t,e,r,n,i,o,s,a,l){if("globe"===l.name){const s=xf(new xp(o,new vp(r,n,i)).canonical).getCorners(),a=Number.MAX_VALUE,l=[-a,-a,-a],p=[a,a,a],f=Mf(t,e);for(let t=0;t<s.length;t++)ul(s[t],s[t],f),c=p,h=s[t],(u=p)[0]=Math.min(c[0],h[0]),u[1]=Math.min(c[1],h[1]),u[2]=Math.min(c[2],h[2]),nl(l,l,s[t]);return new El(p,l)}var u,c,h;const p=kf({z:r,x:n,y:i},l);return new El([(o+p.x/p.scale)*e,e*(p.y/p.scale),s],[(o+p.x2/p.scale)*e,e*(p.y2/p.scale),a])},t.tileTransform=kf,t.transformMat3=function(t,e,r){var n=e[0],i=e[1],o=e[2];return t[0]=n*r[0]+i*r[3]+o*r[6],t[1]=n*r[1]+i*r[4]+o*r[7],t[2]=n*r[2]+i*r[5]+o*r[8],t},t.transformMat4=ul,t.transformMat4$1=gl,t.transformQuat=cl,t.translate=$a,t.transpose=function(t,e){if(t===e){var r=e[1],n=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},t.triggerPluginCompletionEvent=io,t.uniqueId=w,t.validateCustomStyleLayer=function(t){const e=[],r=t.id;return void 0===r&&e.push({message:`layers.${r}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${r}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},t.validateFog=ii,t.validateLight=ni,t.validateStyle=ri,t.values=v,t.vectorTile=Ou,t.version=e,t.warnOnce=L,t.window=s,t.wrap=y}),n(["./shared"],function(t){function e(t){const r=typeof t;if("number"===r||"boolean"===r||"string"===r||null==t)return JSON.stringify(t);if(Array.isArray(t)){let r="[";for(const n of t)r+=`${e(n)},`;return`${r}]`}const n=Object.keys(t).sort();let i="{";for(let o=0;o<n.length;o++)i+=`${JSON.stringify(n[o])}:${e(t[n[o]])},`;return`${i}}`}function r(r){let n="";for(const i of t.refProperties)n+=`/${e(r[i])}`;return n}class n{constructor(t){this.keyCache={},t&&this.replace(t)}replace(t){this._layerConfigs={},this._layers={},this.update(t,[])}update(e,n){for(const r of e)this._layerConfigs[r.id]=r,(this._layers[r.id]=t.createStyleLayer(r)).compileFilter(),this.keyCache[r.id]&&delete this.keyCache[r.id];for(const t of n)delete this.keyCache[t],delete this._layerConfigs[t],delete this._layers[t];this.familiesBySource={};const i=function(t,e){const n={};for(let o=0;o<t.length;o++){const i=e&&e[t[o].id]||r(t[o]);e&&(e[t[o].id]=i);let s=n[i];s||(s=n[i]=[]),s.push(t[o])}const i=[];for(const r in n)i.push(n[r]);return i}(t.values(this._layerConfigs),this.keyCache);for(const t of i){const e=t.map(t=>this._layers[t.id]),r=e[0];if("none"===r.visibility)continue;const n=r.source||"";let i=this.familiesBySource[n];i||(i=this.familiesBySource[n]={});const o=r.sourceLayer||"_geojsonTileLayer";let s=i[o];s||(s=i[o]=[]),s.push(e)}}}class i{loadTile(e,r){const{uid:n,encoding:i,rawImageData:o,padding:s,buildQuadTree:a}=e,l=t.window.ImageBitmap&&o instanceof t.window.ImageBitmap?this.getImageData(o,s):o;r(null,new t.DEMData(n,l,i,s<1,a))}getImageData(t,e){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(t.width,t.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=t.width,this.offscreenCanvas.height=t.height,this.offscreenCanvasContext.drawImage(t,0,0,t.width,t.height);const r=this.offscreenCanvasContext.getImageData(-e,-e,t.width+2*e,t.height+2*e);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),r}}var o=function t(e,r){var n,i=e&&e.type;if("FeatureCollection"===i)for(n=0;n<e.features.length;n++)t(e.features[n],r);else if("GeometryCollection"===i)for(n=0;n<e.geometries.length;n++)t(e.geometries[n],r);else if("Feature"===i)t(e.geometry,r);else if("Polygon"===i)s(e.coordinates,r);else if("MultiPolygon"===i)for(n=0;n<e.coordinates.length;n++)s(e.coordinates[n],r);return e};function s(t,e){if(0!==t.length){a(t[0],e);for(var r=1;r<t.length;r++)a(t[r],!e)}}function a(t,e){for(var r=0,n=0,i=0,o=t.length,s=o-1;i<o;s=i++){var a=(t[i][0]-t[s][0])*(t[s][1]+t[i][1]),l=r+a;n+=Math.abs(r)>=Math.abs(a)?r-l+a:a-l+r,r=l}r+n>=0!=!!e&&t.reverse()}const l=t.vectorTile.VectorTileFeature.prototype.toGeoJSON;class u{constructor(e){this._feature=e,this.extent=t.EXTENT,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))}loadGeometry(){if(1===this._feature.type){const e=[];for(const r of this._feature.geometry)e.push([new t.pointGeometry(r[0],r[1])]);return e}{const e=[];for(const r of this._feature.geometry){const n=[];for(const e of r)n.push(new t.pointGeometry(e[0],e[1]));e.push(n)}return e}}toGeoJSON(t,e,r){return l.call(this,t,e,r)}}class c{constructor(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.EXTENT,this.length=e.length,this._features=e}feature(t){return new u(this._features[t])}}var h=t.vectorTile.VectorTileFeature,p=f;function f(t,e){this.options=e||{},this.features=t,this.length=t.length}function d(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}f.prototype.feature=function(t){return new d(this.features[t],this.options.extent)},d.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var r=0;r<e.length;r++){for(var n=e[r],i=[],o=0;o<n.length;o++)i.push(new t.pointGeometry(n[o][0],n[o][1]));this.geometry.push(i)}return this.geometry},d.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,r=-1/0,n=1/0,i=-1/0,o=0;o<t.length;o++)for(var s=t[o],a=0;a<s.length;a++){var l=s[a];e=Math.min(e,l.x),r=Math.max(r,l.x),n=Math.min(n,l.y),i=Math.max(i,l.y)}return[e,n,r,i]},d.prototype.toGeoJSON=h.prototype.toGeoJSON;var m=y,g=p;function y(e){var r=new t.pbf;return function(t,e){for(var r in t.layers)e.writeMessage(3,_,t.layers[r])}(e,r),r.finish()}function _(t,e){var r;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var n={keys:[],values:[],keycache:{},valuecache:{}};for(r=0;r<t.length;r++)n.feature=t.feature(r),e.writeMessage(2,v,n);var i=n.keys;for(r=0;r<i.length;r++)e.writeStringField(3,i[r]);var o=n.values;for(r=0;r<o.length;r++)e.writeMessage(4,S,o[r])}function v(t,e){var r=t.feature;void 0!==r.id&&e.writeVarintField(1,r.id),e.writeMessage(2,x,t),e.writeVarintField(3,r.type),e.writeMessage(4,E,r)}function x(t,e){var r=t.feature,n=t.keys,i=t.values,o=t.keycache,s=t.valuecache;for(var a in r.properties){var l=r.properties[a],u=o[a];if(null!==l){void 0===u&&(n.push(a),o[a]=u=n.length-1),e.writeVarint(u);var c=typeof l;"string"!==c&&"boolean"!==c&&"number"!==c&&(l=JSON.stringify(l));var h=c+":"+l,p=s[h];void 0===p&&(i.push(l),s[h]=p=i.length-1),e.writeVarint(p)}}}function b(t,e){return(e<<3)+(7&t)}function w(t){return t<<1^t>>31}function E(t,e){for(var r=t.loadGeometry(),n=t.type,i=0,o=0,s=r.length,a=0;a<s;a++){var l=r[a],u=1;1===n&&(u=l.length),e.writeVarint(b(1,u));for(var c=3===n?l.length-1:l.length,h=0;h<c;h++){1===h&&1!==n&&e.writeVarint(b(2,c-1));var p=l[h].x-i,f=l[h].y-o;e.writeVarint(w(p)),e.writeVarint(w(f)),i+=p,o+=f}3===n&&e.writeVarint(b(7,1))}}function S(t,e){var r=typeof t;"string"===r?e.writeStringField(1,t):"boolean"===r?e.writeBooleanField(7,t):"number"===r&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}function I(t,e,r,n,i,o){if(i-n<=r)return;const s=n+i>>1;T(t,e,s,n,i,o%2),I(t,e,r,n,s-1,o+1),I(t,e,r,s+1,i,o+1)}function T(t,e,r,n,i,o){for(;i>n;){if(i-n>600){const s=i-n+1,a=r-n+1,l=Math.log(s),u=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*u*(s-u)/s)*(a-s/2<0?-1:1);T(t,e,r,Math.max(n,Math.floor(r-a*u/s+c)),Math.min(i,Math.floor(r+(s-a)*u/s+c)),o)}const s=e[2*r+o];let a=n,l=i;for(C(t,e,n,r),e[2*i+o]>s&&C(t,e,n,i);a<l;){for(C(t,e,a,l),a++,l--;e[2*a+o]<s;)a++;for(;e[2*l+o]>s;)l--}e[2*n+o]===s?C(t,e,n,l):(l++,C(t,e,l,i)),l<=r&&(n=l+1),r<=l&&(i=l-1)}}function C(t,e,r,n){M(t,r,n),M(e,2*r,2*n),M(e,2*r+1,2*n+1)}function M(t,e,r){const n=t[e];t[e]=t[r],t[r]=n}function A(t,e,r,n){const i=t-r,o=e-n;return i*i+o*o}m.fromVectorTileJs=y,m.fromGeojsonVt=function(t,e){e=e||{};var r={};for(var n in t)r[n]=new p(t[n].features,e),r[n].name=n,r[n].version=e.version,r[n].extent=e.extent;return y({layers:r})},m.GeoJSONWrapper=g;const P=t=>t[0],k=t=>t[1];class L{constructor(t,e=P,r=k,n=64,i=Float64Array){this.nodeSize=n,this.points=t;const o=t.length<65536?Uint16Array:Uint32Array,s=this.ids=new o(t.length),a=this.coords=new i(2*t.length);for(let l=0;l<t.length;l++)s[l]=l,a[2*l]=e(t[l]),a[2*l+1]=r(t[l]);I(s,a,n,0,s.length-1,0)}range(t,e,r,n){return function(t,e,r,n,i,o,s){const a=[0,t.length-1,0],l=[];let u,c;for(;a.length;){const h=a.pop(),p=a.pop(),f=a.pop();if(p-f<=s){for(let s=f;s<=p;s++)u=e[2*s],c=e[2*s+1],u>=r&&u<=i&&c>=n&&c<=o&&l.push(t[s]);continue}const d=Math.floor((f+p)/2);u=e[2*d],c=e[2*d+1],u>=r&&u<=i&&c>=n&&c<=o&&l.push(t[d]);const m=(h+1)%2;(0===h?r<=u:n<=c)&&(a.push(f),a.push(d-1),a.push(m)),(0===h?i>=u:o>=c)&&(a.push(d+1),a.push(p),a.push(m))}return l}(this.ids,this.coords,t,e,r,n,this.nodeSize)}within(t,e,r){return function(t,e,r,n,i,o){const s=[0,t.length-1,0],a=[],l=i*i;for(;s.length;){const u=s.pop(),c=s.pop(),h=s.pop();if(c-h<=o){for(let i=h;i<=c;i++)A(e[2*i],e[2*i+1],r,n)<=l&&a.push(t[i]);continue}const p=Math.floor((h+c)/2),f=e[2*p],d=e[2*p+1];A(f,d,r,n)<=l&&a.push(t[p]);const m=(u+1)%2;(0===u?r-i<=f:n-i<=d)&&(s.push(h),s.push(p-1),s.push(m)),(0===u?r+i>=f:n+i>=d)&&(s.push(p+1),s.push(c),s.push(m))}return a}(this.ids,this.coords,t,e,r,this.nodeSize)}}const z={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:t=>t},D=Math.fround||(R=new Float32Array(1),t=>(R[0]=+t,R[0]));var R;class O{constructor(t){this.options=q(Object.create(z),t),this.trees=new Array(this.options.maxZoom+1)}load(t){const{log:e,minZoom:r,maxZoom:n,nodeSize:i}=this.options;e&&console.time("total time");const o=`prepare ${t.length} points`;e&&console.time(o),this.points=t;let s=[];for(let a=0;a<t.length;a++)t[a].geometry&&s.push(F(t[a],a));this.trees[n+1]=new L(s,$,Z,i,Float32Array),e&&console.timeEnd(o);for(let a=n;a>=r;a--){const t=+Date.now();s=this._cluster(s,a),this.trees[a]=new L(s,$,Z,i,Float32Array),e&&console.log("z%d: %d clusters in %dms",a,s.length,+Date.now()-t)}return e&&console.timeEnd("total time"),this}getClusters(t,e){let r=((t[0]+180)%360+360)%360-180;const n=Math.max(-90,Math.min(90,t[1]));let i=180===t[2]?180:((t[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)r=-180,i=180;else if(r>i){const t=this.getClusters([r,n,180,o],e),s=this.getClusters([-180,n,i,o],e);return t.concat(s)}const s=this.trees[this._limitZoom(e)],a=s.range(U(r),V(o),U(i),V(n)),l=[];for(const u of a){const t=s.points[u];l.push(t.numPoints?B(t):this.points[t.index])}return l}getChildren(t){const e=this._getOriginId(t),r=this._getOriginZoom(t),n="No cluster with the specified id.",i=this.trees[r];if(!i)throw new Error(n);const o=i.points[e];if(!o)throw new Error(n);const s=this.options.radius/(this.options.extent*Math.pow(2,r-1)),a=i.within(o.x,o.y,s),l=[];for(const u of a){const e=i.points[u];e.parentId===t&&l.push(e.numPoints?B(e):this.points[e.index])}if(0===l.length)throw new Error(n);return l}getLeaves(t,e,r){const n=[];return this._appendLeaves(n,t,e=e||10,r=r||0,0),n}getTile(t,e,r){const n=this.trees[this._limitZoom(t)],i=Math.pow(2,t),{extent:o,radius:s}=this.options,a=s/o,l=(r-a)/i,u=(r+1+a)/i,c={features:[]};return this._addTileFeatures(n.range((e-a)/i,l,(e+1+a)/i,u),n.points,e,r,i,c),0===e&&this._addTileFeatures(n.range(1-a/i,l,1,u),n.points,i,r,i,c),e===i-1&&this._addTileFeatures(n.range(0,l,a/i,u),n.points,-1,r,i,c),c.features.length?c:null}getClusterExpansionZoom(t){let e=this._getOriginZoom(t)-1;for(;e<=this.options.maxZoom;){const r=this.getChildren(t);if(e++,1!==r.length)break;t=r[0].properties.cluster_id}return e}_appendLeaves(t,e,r,n,i){const o=this.getChildren(e);for(const s of o){const e=s.properties;if(e&&e.cluster?i+e.point_count<=n?i+=e.point_count:i=this._appendLeaves(t,e.cluster_id,r,n,i):i<n?i++:t.push(s),t.length===r)break}return i}_addTileFeatures(t,e,r,n,i,o){for(const s of t){const t=e[s],a=t.numPoints;let l,u,c;if(a)l=j(t),u=t.x,c=t.y;else{const e=this.points[t.index];l=e.properties,u=U(e.geometry.coordinates[0]),c=V(e.geometry.coordinates[1])}const h={type:1,geometry:[[Math.round(this.options.extent*(u*i-r)),Math.round(this.options.extent*(c*i-n))]],tags:l};let p;a?p=t.id:this.options.generateId?p=t.index:this.points[t.index].id&&(p=this.points[t.index].id),void 0!==p&&(h.id=p),o.features.push(h)}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(+t,this.options.maxZoom+1))}_cluster(t,e){const r=[],{radius:n,extent:i,reduce:o,minPoints:s}=this.options,a=n/(i*Math.pow(2,e));for(let l=0;l<t.length;l++){const n=t[l];if(n.zoom<=e)continue;n.zoom=e;const i=this.trees[e+1],u=i.within(n.x,n.y,a),c=n.numPoints||1;let h=c;for(const t of u){const r=i.points[t];r.zoom>e&&(h+=r.numPoints||1)}if(h>c&&h>=s){let t=n.x*c,s=n.y*c,a=o&&c>1?this._map(n,!0):null;const p=(l<<5)+(e+1)+this.points.length;for(const r of u){const l=i.points[r];if(l.zoom<=e)continue;l.zoom=e;const u=l.numPoints||1;t+=l.x*u,s+=l.y*u,l.parentId=p,o&&(a||(a=this._map(n,!0)),o(a,this._map(l)))}n.parentId=p,r.push(N(t/h,s/h,p,h,a))}else if(r.push(n),h>1)for(const t of u){const n=i.points[t];n.zoom<=e||(n.zoom=e,r.push(n))}}return r}_getOriginId(t){return t-this.points.length>>5}_getOriginZoom(t){return(t-this.points.length)%32}_map(t,e){if(t.numPoints)return e?q({},t.properties):t.properties;const r=this.points[t.index].properties,n=this.options.map(r);return e&&n===r?q({},n):n}}function N(t,e,r,n,i){return{x:D(t),y:D(e),zoom:1/0,id:r,parentId:-1,numPoints:n,properties:i}}function F(t,e){const[r,n]=t.geometry.coordinates;return{x:D(U(r)),y:D(V(n)),zoom:1/0,index:e,parentId:-1}}function B(t){return{type:"Feature",id:t.id,properties:j(t),geometry:{type:"Point",coordinates:[(e=t.x,360*(e-.5)),G(t.y)]}};var e}function j(t){const e=t.numPoints,r=e>=1e4?`${Math.round(e/1e3)}k`:e>=1e3?Math.round(e/100)/10+"k":e;return q(q({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:r})}function U(t){return t/360+.5}function V(t){const e=Math.sin(t*Math.PI/180),r=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return r<0?0:r>1?1:r}function G(t){const e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function q(t,e){for(const r in e)t[r]=e[r];return t}function $(t){return t.x}function Z(t){return t.y}function X(t,e,r,n){for(var i,o=n,s=r-e>>1,a=r-e,l=t[e],u=t[e+1],c=t[r],h=t[r+1],p=e+3;p<r;p+=3){var f=W(t[p],t[p+1],l,u,c,h);if(f>o)i=p,o=f;else if(f===o){var d=Math.abs(p-s);d<a&&(i=p,a=d)}}o>n&&(i-e>3&&X(t,e,i,n),t[i+2]=o,r-i>3&&X(t,i,r,n))}function W(t,e,r,n,i,o){var s=i-r,a=o-n;if(0!==s||0!==a){var l=((t-r)*s+(e-n)*a)/(s*s+a*a);l>1?(r=i,n=o):l>0&&(r+=s*l,n+=a*l)}return(s=t-r)*s+(a=e-n)*a}function Y(t,e,r,n){var i={id:void 0===t?null:t,type:e,geometry:r,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,r=t.type;if("Point"===r||"MultiPoint"===r||"LineString"===r)H(t,e);else if("Polygon"===r||"MultiLineString"===r)for(var n=0;n<e.length;n++)H(t,e[n]);else if("MultiPolygon"===r)for(n=0;n<e.length;n++)for(var i=0;i<e[n].length;i++)H(t,e[n][i])}(i),i}function H(t,e){for(var r=0;r<e.length;r+=3)t.minX=Math.min(t.minX,e[r]),t.minY=Math.min(t.minY,e[r+1]),t.maxX=Math.max(t.maxX,e[r]),t.maxY=Math.max(t.maxY,e[r+1])}function J(t,e,r,n){if(e.geometry){var i=e.geometry.coordinates,o=e.geometry.type,s=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),a=[],l=e.id;if(r.promoteId?l=e.properties[r.promoteId]:r.generateId&&(l=n||0),"Point"===o)K(i,a);else if("MultiPoint"===o)for(var u=0;u<i.length;u++)K(i[u],a);else if("LineString"===o)Q(i,a,s,!1);else if("MultiLineString"===o){if(r.lineMetrics){for(u=0;u<i.length;u++)Q(i[u],a=[],s,!1),t.push(Y(l,"LineString",a,e.properties));return}tt(i,a,s,!1)}else if("Polygon"===o)tt(i,a,s,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(u=0;u<e.geometry.geometries.length;u++)J(t,{id:l,geometry:e.geometry.geometries[u],properties:e.properties},r,n);return}throw new Error("Input data is not a valid GeoJSON object.")}for(u=0;u<i.length;u++){var c=[];tt(i[u],c,s,!0),a.push(c)}}t.push(Y(l,o,a,e.properties))}}function K(t,e){e.push(et(t[0])),e.push(rt(t[1])),e.push(0)}function Q(t,e,r,n){for(var i,o,s=0,a=0;a<t.length;a++){var l=et(t[a][0]),u=rt(t[a][1]);e.push(l),e.push(u),e.push(0),a>0&&(s+=n?(i*u-l*o)/2:Math.sqrt(Math.pow(l-i,2)+Math.pow(u-o,2))),i=l,o=u}var c=e.length-3;e[2]=1,X(e,0,c,r),e[c+2]=1,e.size=Math.abs(s),e.start=0,e.end=e.size}function tt(t,e,r,n){for(var i=0;i<t.length;i++){var o=[];Q(t[i],o,r,n),e.push(o)}}function et(t){return t/360+.5}function rt(t){var e=Math.sin(t*Math.PI/180),r=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return r<0?0:r>1?1:r}function nt(t,e,r,n,i,o,s,a){if(n/=e,o>=(r/=e)&&s<n)return t;if(s<r||o>=n)return null;for(var l=[],u=0;u<t.length;u++){var c=t[u],h=c.geometry,p=c.type,f=0===i?c.minX:c.minY,d=0===i?c.maxX:c.maxY;if(f>=r&&d<n)l.push(c);else if(!(d<r||f>=n)){var m=[];if("Point"===p||"MultiPoint"===p)it(h,m,r,n,i);else if("LineString"===p)ot(h,m,r,n,i,!1,a.lineMetrics);else if("MultiLineString"===p)at(h,m,r,n,i,!1);else if("Polygon"===p)at(h,m,r,n,i,!0);else if("MultiPolygon"===p)for(var g=0;g<h.length;g++){var y=[];at(h[g],y,r,n,i,!0),y.length&&m.push(y)}if(m.length){if(a.lineMetrics&&"LineString"===p){for(g=0;g<m.length;g++)l.push(Y(c.id,p,m[g],c.tags));continue}"LineString"!==p&&"MultiLineString"!==p||(1===m.length?(p="LineString",m=m[0]):p="MultiLineString"),"Point"!==p&&"MultiPoint"!==p||(p=3===m.length?"Point":"MultiPoint"),l.push(Y(c.id,p,m,c.tags))}}}return l.length?l:null}function it(t,e,r,n,i){for(var o=0;o<t.length;o+=3){var s=t[o+i];s>=r&&s<=n&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function ot(t,e,r,n,i,o,s){for(var a,l,u=st(t),c=0===i?ut:ct,h=t.start,p=0;p<t.length-3;p+=3){var f=t[p],d=t[p+1],m=t[p+2],g=t[p+3],y=t[p+4],_=0===i?f:d,v=0===i?g:y,x=!1;s&&(a=Math.sqrt(Math.pow(f-g,2)+Math.pow(d-y,2))),_<r?v>r&&(l=c(u,f,d,g,y,r),s&&(u.start=h+a*l)):_>n?v<n&&(l=c(u,f,d,g,y,n),s&&(u.start=h+a*l)):lt(u,f,d,m),v<r&&_>=r&&(l=c(u,f,d,g,y,r),x=!0),v>n&&_<=n&&(l=c(u,f,d,g,y,n),x=!0),!o&&x&&(s&&(u.end=h+a*l),e.push(u),u=st(t)),s&&(h+=a)}var b=t.length-3;f=t[b],d=t[b+1],m=t[b+2],(_=0===i?f:d)>=r&&_<=n&&lt(u,f,d,m),b=u.length-3,o&&b>=3&&(u[b]!==u[0]||u[b+1]!==u[1])&&lt(u,u[0],u[1],u[2]),u.length&&e.push(u)}function st(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function at(t,e,r,n,i,o){for(var s=0;s<t.length;s++)ot(t[s],e,r,n,i,o,!1)}function lt(t,e,r,n){t.push(e),t.push(r),t.push(n)}function ut(t,e,r,n,i,o){var s=(o-e)/(n-e);return t.push(o),t.push(r+(i-r)*s),t.push(1),s}function ct(t,e,r,n,i,o){var s=(o-r)/(i-r);return t.push(e+(n-e)*s),t.push(o),t.push(1),s}function ht(t,e){for(var r=[],n=0;n<t.length;n++){var i,o=t[n],s=o.type;if("Point"===s||"MultiPoint"===s||"LineString"===s)i=pt(o.geometry,e);else if("MultiLineString"===s||"Polygon"===s){i=[];for(var a=0;a<o.geometry.length;a++)i.push(pt(o.geometry[a],e))}else if("MultiPolygon"===s)for(i=[],a=0;a<o.geometry.length;a++){for(var l=[],u=0;u<o.geometry[a].length;u++)l.push(pt(o.geometry[a][u],e));i.push(l)}r.push(Y(o.id,s,i,o.tags))}return r}function pt(t,e){var r=[];r.size=t.size,void 0!==t.start&&(r.start=t.start,r.end=t.end);for(var n=0;n<t.length;n+=3)r.push(t[n]+e,t[n+1],t[n+2]);return r}function ft(t,e){if(t.transformed)return t;var r,n,i,o=1<<t.z,s=t.x,a=t.y;for(r=0;r<t.features.length;r++){var l=t.features[r],u=l.geometry,c=l.type;if(l.geometry=[],1===c)for(n=0;n<u.length;n+=2)l.geometry.push(dt(u[n],u[n+1],e,o,s,a));else for(n=0;n<u.length;n++){var h=[];for(i=0;i<u[n].length;i+=2)h.push(dt(u[n][i],u[n][i+1],e,o,s,a));l.geometry.push(h)}}return t.transformed=!0,t}function dt(t,e,r,n,i,o){return[Math.round(r*(t*n-i)),Math.round(r*(e*n-o))]}function mt(t,e,r,n,i){for(var o=e===i.maxZoom?0:i.tolerance/((1<<e)*i.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:n,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<t.length;a++){s.numFeatures++,gt(s,t[a],o,i);var l=t[a].minX,u=t[a].minY,c=t[a].maxX,h=t[a].maxY;l<s.minX&&(s.minX=l),u<s.minY&&(s.minY=u),c>s.maxX&&(s.maxX=c),h>s.maxY&&(s.maxY=h)}return s}function gt(t,e,r,n){var i=e.geometry,o=e.type,s=[];if("Point"===o||"MultiPoint"===o)for(var a=0;a<i.length;a+=3)s.push(i[a]),s.push(i[a+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)yt(s,i,t,r,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(a=0;a<i.length;a++)yt(s,i[a],t,r,"Polygon"===o,0===a);else if("MultiPolygon"===o)for(var l=0;l<i.length;l++){var u=i[l];for(a=0;a<u.length;a++)yt(s,u[a],t,r,!0,0===a)}if(s.length){var c=e.tags||null;if("LineString"===o&&n.lineMetrics){for(var h in c={},e.tags)c[h]=e.tags[h];c.mapbox_clip_start=i.start/i.size,c.mapbox_clip_end=i.end/i.size}var p={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:c};null!==e.id&&(p.id=e.id),t.features.push(p)}}function yt(t,e,r,n,i,o){var s=n*n;if(n>0&&e.size<(i?s:n))r.numPoints+=e.length/3;else{for(var a=[],l=0;l<e.length;l+=3)(0===n||e[l+2]>s)&&(r.numSimplified++,a.push(e[l]),a.push(e[l+1])),r.numPoints++;i&&function(t,e){for(var r=0,n=0,i=t.length,o=i-2;n<i;o=n,n+=2)r+=(t[n]-t[o])*(t[n+1]+t[o+1]);if(r>0===e)for(n=0,i=t.length;n<i/2;n+=2){var s=t[n],a=t[n+1];t[n]=t[i-2-n],t[n+1]=t[i-1-n],t[i-2-n]=s,t[i-1-n]=a}}(a,o),t.push(a)}}function _t(t,e){var r=(e=this.options=function(t,e){for(var r in e)t[r]=e[r];return t}(Object.create(this.options),e)).debug;if(r&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=function(t,e){var r=[];if("FeatureCollection"===t.type)for(var n=0;n<t.features.length;n++)J(r,t.features[n],e,n);else J(r,"Feature"===t.type?t:{geometry:t},e);return r}(t,e);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(n=function(t,e){var r=e.buffer/e.extent,n=t,i=nt(t,1,-1-r,r,0,-1,2,e),o=nt(t,1,1-r,2+r,0,-1,2,e);return(i||o)&&(n=nt(t,1,-r,1+r,0,-1,2,e)||[],i&&(n=ht(i,1).concat(n)),o&&(n=n.concat(ht(o,-1)))),n}(n,e)).length&&this.splitTile(n,0,0,0),r&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function vt(t,e,r){return 32*((1<<t)*r+e)+t}function xt(t,e){const r=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);const n=this._geoJSONIndex.getTile(r.z,r.x,r.y);if(!n)return e(null,null);const i=new c(n.features);let o=m(i);0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),e(null,{vectorTile:i,rawData:o.buffer})}_t.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},_t.prototype.splitTile=function(t,e,r,n,i,o,s){for(var a=[t,e,r,n],l=this.options,u=l.debug;a.length;){n=a.pop(),r=a.pop(),e=a.pop(),t=a.pop();var c=1<<e,h=vt(e,r,n),p=this.tiles[h];if(!p&&(u>1&&console.time("creation"),p=this.tiles[h]=mt(t,e,r,n,l),this.tileCoords.push({z:e,x:r,y:n}),u)){u>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,r,n,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var f="z"+e;this.stats[f]=(this.stats[f]||0)+1,this.total++}if(p.source=t,i){if(e===l.maxZoom||e===i)continue;var d=1<<i-e;if(r!==Math.floor(o/d)||n!==Math.floor(s/d))continue}else if(e===l.indexMaxZoom||p.numPoints<=l.indexMaxPoints)continue;if(p.source=null,0!==t.length){u>1&&console.time("clipping");var m,g,y,_,v,x,b=.5*l.buffer/l.extent,w=.5-b,E=.5+b,S=1+b;m=g=y=_=null,v=nt(t,c,r-b,r+E,0,p.minX,p.maxX,l),x=nt(t,c,r+w,r+S,0,p.minX,p.maxX,l),t=null,v&&(m=nt(v,c,n-b,n+E,1,p.minY,p.maxY,l),g=nt(v,c,n+w,n+S,1,p.minY,p.maxY,l),v=null),x&&(y=nt(x,c,n-b,n+E,1,p.minY,p.maxY,l),_=nt(x,c,n+w,n+S,1,p.minY,p.maxY,l),x=null),u>1&&console.timeEnd("clipping"),a.push(m||[],e+1,2*r,2*n),a.push(g||[],e+1,2*r,2*n+1),a.push(y||[],e+1,2*r+1,2*n),a.push(_||[],e+1,2*r+1,2*n+1)}}},_t.prototype.getTile=function(t,e,r){var n=this.options,i=n.extent,o=n.debug;if(t<0||t>24)return null;var s=1<<t,a=vt(t,e=(e%s+s)%s,r);if(this.tiles[a])return ft(this.tiles[a],i);o>1&&console.log("drilling down to z%d-%d-%d",t,e,r);for(var l,u=t,c=e,h=r;!l&&u>0;)u--,c=Math.floor(c/2),h=Math.floor(h/2),l=this.tiles[vt(u,c,h)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",u,c,h),o>1&&console.time("drilling down"),this.splitTile(l.source,u,c,h,t,e,r),o>1&&console.timeEnd("drilling down"),this.tiles[a]?ft(this.tiles[a],i):null):null};class bt extends t.VectorTileWorkerSource{constructor(t,e,r,n,i){super(t,e,r,n,xt),i&&(this.loadGeoJSON=i)}loadData(e,r){const n=e&&e.request,i=n&&n.collectResourceTiming;this.loadGeoJSON(e,(s,a)=>{if(s||!a)return r(s);if("object"!=typeof a)return r(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`));{o(a,!0);try{if(e.filter){const r=t.createExpression(e.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===r.result)throw new Error(r.value.map(t=>`${t.key}: ${t.message}`).join(", "));const n=a.features.filter(t=>r.value.evaluate({zoom:0},t));a={type:"FeatureCollection",features:n}}this._geoJSONIndex=e.cluster?new O(function({superclusterOptions:e,clusterProperties:r}){if(!r||!e)return e;const n={},i={},o={accumulated:null,zoom:0},s={properties:null},a=Object.keys(r);for(const l of a){const[e,o]=r[l],s=t.createExpression(o),a=t.createExpression("string"==typeof e?[e,["accumulated"],["get",l]]:e);n[l]=s.value,i[l]=a.value}return e.map=(t=>{s.properties=t;const e={};for(const r of a)e[r]=n[r].evaluate(o,s);return e}),e.reduce=((t,e)=>{s.properties=e;for(const r of a)o.accumulated=t[r],t[r]=i[r].evaluate(o,s)}),e}(e)).load(a.features):function(t,e){return new _t(t,e)}(a,e.geojsonVtOptions)}catch(s){return r(s)}this.loaded={};const l={};if(i){const r=t.getPerformanceMeasurement(n);r&&(l.resourceTiming={},l.resourceTiming[e.source]=JSON.parse(JSON.stringify(r)))}r(null,l)}})}reloadTile(t,e){const r=this.loaded;return r&&r[t.uid]?super.reloadTile(t,e):this.loadTile(t,e)}loadGeoJSON(e,r){if(e.request)t.getJSON(e.request,r);else{if("string"!=typeof e.data)return r(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`));try{return r(null,JSON.parse(e.data))}catch(t){return r(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(t,e){try{e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId))}catch(t){e(t)}}getClusterChildren(t,e){try{e(null,this._geoJSONIndex.getChildren(t.clusterId))}catch(t){e(t)}}getClusterLeaves(t,e){try{e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset))}catch(t){e(t)}}}class wt{constructor(e){this.self=e,this.actor=new t.Actor(e,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=t.getProjection({name:"mercator"}),this.workerSourceTypes={vector:t.VectorTileWorkerSource,geojson:bt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=((t,e)=>{if(this.workerSourceTypes[t])throw new Error(`Worker source with name "${t}" already registered.`);this.workerSourceTypes[t]=e}),this.self.registerRTLTextPlugin=(e=>{if(t.plugin.isParsed())throw new Error("RTL text plugin already registered.");t.plugin.applyArabicShaping=e.applyArabicShaping,t.plugin.processBidirectionalText=e.processBidirectionalText,t.plugin.processStyledBidirectionalText=e.processStyledBidirectionalText})}clearCaches(t,e,r){delete this.layerIndexes[t],delete this.availableImages[t],delete this.workerSources[t],delete this.demWorkerSources[t],r()}checkIfReady(t,e,r){r()}setReferrer(t,e){this.referrer=e}spriteLoaded(e,r){this.isSpriteLoaded[e]=r;for(const n in this.workerSources[e]){const i=this.workerSources[e][n];for(const e in i)i[e]instanceof t.VectorTileWorkerSource&&(i[e].isSpriteLoaded=r,i[e].fire(new t.Event("isSpriteLoaded")))}}setImages(t,e,r){this.availableImages[t]=e;for(const n in this.workerSources[t]){const r=this.workerSources[t][n];for(const t in r)r[t].availableImages=e}r()}enableTerrain(t,e,r){this.terrain=e,r()}setProjection(e,r){this.projections[e]=t.getProjection(r)}setLayers(t,e,r){this.getLayerIndex(t).replace(e),r()}updateLayers(t,e,r){this.getLayerIndex(t).update(e.layers,e.removedIds),r()}loadTile(e,r,n){const i=this.enableTerrain?t.extend({enableTerrain:this.terrain},r):r;i.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,r.type,r.source).loadTile(i,n)}loadDEMTile(e,r,n){const i=this.enableTerrain?t.extend({buildQuadTree:this.terrain},r):r;this.getDEMWorkerSource(e,r.source).loadTile(i,n)}reloadTile(e,r,n){const i=this.enableTerrain?t.extend({enableTerrain:this.terrain},r):r;i.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,r.type,r.source).reloadTile(i,n)}abortTile(t,e,r){this.getWorkerSource(t,e.type,e.source).abortTile(e,r)}removeTile(t,e,r){this.getWorkerSource(t,e.type,e.source).removeTile(e,r)}removeSource(t,e,r){if(!this.workerSources[t]||!this.workerSources[t][e.type]||!this.workerSources[t][e.type][e.source])return;const n=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==n.removeSource?n.removeSource(e,r):r()}loadWorkerSource(t,e,r){try{this.self.importScripts(e.url),r()}catch(t){r(t.toString())}}syncRTLPluginState(e,r,n){try{t.plugin.setState(r);const e=t.plugin.getPluginURL();if(t.plugin.isLoaded()&&!t.plugin.isParsed()&&null!=e){this.self.importScripts(e);const r=t.plugin.isParsed();n(r?void 0:new Error(`RTL Text Plugin failed to import scripts from ${e}`),r)}}catch(t){n(t.toString())}}getAvailableImages(t){let e=this.availableImages[t];return e||(e=[]),e}getLayerIndex(t){let e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new n),e}getWorkerSource(t,e,r){return this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][e]||(this.workerSources[t][e]={}),this.workerSources[t][e][r]||(this.workerSources[t][e][r]=new this.workerSourceTypes[e]({send:(e,r,n,i,o,s)=>{this.actor.send(e,r,n,t,o,s)},scheduler:this.actor.scheduler},this.getLayerIndex(t),this.getAvailableImages(t),this.isSpriteLoaded[t])),this.workerSources[t][e][r]}getDEMWorkerSource(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new i),this.demWorkerSources[t][e]}enforceCacheSizeLimit(e,r){t.enforceCacheSizeLimit(r)}getWorkerPerformanceMetrics(t,e,r){r(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new wt(self)),wt}),n(["./shared"],function(t){var e=r;function r(t){return!function(t){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var t,e,r=new Blob([""],{type:"text/javascript"}),n=URL.createObjectURL(r);try{e=new Worker(n),t=!0}catch(e){t=!1}return e&&e.terminate(),URL.revokeObjectURL(n),t}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var t=document.createElement("canvas");t.width=t.height=1;var e=t.getContext("2d");if(!e)return!1;var r=e.getImageData(0,0,1,1);return r&&r.width===t.width}()?(void 0===n[e=t&&t.failIfMajorPerformanceCaveat]&&(n[e]=function(t){var e,n=function(t){var e=document.createElement("canvas"),n=Object.create(r.webGLContextAttributes);return n.failIfMajorPerformanceCaveat=t,e.getContext("webgl",n)||e.getContext("experimental-webgl",n)}(t);if(!n)return!1;try{e=n.createShader(n.VERTEX_SHADER)}catch(t){return!1}return!(!e||n.isContextLost())&&(n.shaderSource(e,"void main() {}"),n.compileShader(e),!0===n.getShaderParameter(e,n.COMPILE_STATUS))}(e)),n[e]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var e}(t)}var n={};function i(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!i(t[r],e[r]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==e){if("object"!=typeof e)return!1;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const r in t)if(!i(t[r],e[r]))return!1;return!0}return t===e}function o(e,r,n){const i=t.window.document.createElement(e);return void 0!==r&&(i.className=r),n&&n.appendChild(i),i}function s(e,r,n){const i=t.window.document.createElementNS("http://www.w3.org/2000/svg",e);for(const t of Object.keys(r))i.setAttributeNS(null,t,r[t]);return n&&n.appendChild(i),i}r.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const a=t.window.document&&t.window.document.documentElement.style,l=a&&void 0!==a.userSelect?"userSelect":"WebkitUserSelect";let u;function c(){a&&l&&(u=a[l],a[l]="none")}function h(){a&&l&&(a[l]=u)}function p(e){e.preventDefault(),e.stopPropagation(),t.window.removeEventListener("click",p,!0)}function f(){t.window.addEventListener("click",p,!0),t.window.setTimeout(()=>{t.window.removeEventListener("click",p,!0)},0)}function d(t,e){const r=t.getBoundingClientRect();return y(t,r,e)}function m(t,e){const r=t.getBoundingClientRect(),n=[];for(let i=0;i<e.length;i++)n.push(y(t,r,e[i]));return n}function g(e){return void 0!==t.window.InstallTrigger&&2===e.button&&e.ctrlKey&&t.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button}function y(e,r,n){const i=e.offsetWidth===r.width?1:e.offsetWidth/r.width;return new t.pointGeometry((n.clientX-r.left)*i,(n.clientY-r.top)*i)}function _(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],s=r*o-i*n;return s?(t[0]=o*(s=1/s),t[1]=-n*s,t[2]=-i*s,t[3]=r*s,t):null}function v(t){const{userImage:e}=t;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}class x extends t.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:t,callback:e}of this.requestors)this._notify(t,e);this.requestors=[]}}getImage(t){return this.images[t]}addImage(t,e){this._validate(t,e)&&(this.images[t]=e)}_validate(e,r){let n=!0;return this._validateStretch(r.stretchX,r.data&&r.data.width)||(this.fire(new t.ErrorEvent(new Error(`Image "${e}" has invalid "stretchX" value`))),n=!1),this._validateStretch(r.stretchY,r.data&&r.data.height)||(this.fire(new t.ErrorEvent(new Error(`Image "${e}" has invalid "stretchY" value`))),n=!1),this._validateContent(r.content,r)||(this.fire(new t.ErrorEvent(new Error(`Image "${e}" has invalid "content" value`))),n=!1),n}_validateStretch(t,e){if(!t)return!0;let r=0;for(const n of t){if(n[0]<r||n[1]<n[0]||e<n[1])return!1;r=n[1]}return!0}_validateContent(t,e){return!(t&&(4!==t.length||t[0]<0||e.data.width<t[0]||t[1]<0||e.data.height<t[1]||t[2]<0||e.data.width<t[2]||t[3]<0||e.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,e){e.version=this.images[t].version+1,this.images[t]=e,this.updatedImages[t]=!0}removeImage(t){const e=this.images[t];delete this.images[t],delete this.patterns[t],e.userImage&&e.userImage.onRemove&&e.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,e){let r=!0;if(!this.isLoaded())for(const n of t)this.images[n]||(r=!1);this.isLoaded()||r?this._notify(t,e):this.requestors.push({ids:t,callback:e})}_notify(e,r){const n={};for(const i of e){this.images[i]||this.fire(new t.Event("styleimagemissing",{id:i}));const e=this.images[i];e?n[i]={data:e.data.clone(),pixelRatio:e.pixelRatio,sdf:e.sdf,version:e.version,stretchX:e.stretchX,stretchY:e.stretchY,content:e.content,hasRenderCallback:Boolean(e.userImage&&e.userImage.render)}:t.warnOnce(`Image "${i}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}r(null,n)}getPixelSize(){const{width:t,height:e}=this.atlasImage;return{width:t,height:e}}getPattern(e){const r=this.patterns[e],n=this.getImage(e);if(!n)return null;if(r&&r.position.version===n.version)return r.position;if(r)r.position.version=n.version;else{const r={w:n.data.width+2,h:n.data.height+2,x:0,y:0},i=new t.ImagePosition(r,n);this.patterns[e]={bin:r,position:i}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const r=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new t.Texture(e,this.atlasImage,r.RGBA),this.atlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const t in this.patterns)e.push(this.patterns[t].bin);const{w:r,h:n}=t.potpack(e),i=this.atlasImage;i.resize({width:r||1,height:n||1});for(const o in this.patterns){const{bin:e}=this.patterns[o],r=e.x+1,n=e.y+1,s=this.images[o].data,a=s.width,l=s.height;t.RGBAImage.copy(s,i,{x:0,y:0},{x:r,y:n},{width:a,height:l}),t.RGBAImage.copy(s,i,{x:0,y:l-1},{x:r,y:n-1},{width:a,height:1}),t.RGBAImage.copy(s,i,{x:0,y:0},{x:r,y:n+l},{width:a,height:1}),t.RGBAImage.copy(s,i,{x:a-1,y:0},{x:r-1,y:n},{width:1,height:l}),t.RGBAImage.copy(s,i,{x:0,y:0},{x:r+a,y:n},{width:1,height:l})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const e of t){if(this.callbackDispatchedThisFrame[e])continue;this.callbackDispatchedThisFrame[e]=!0;const t=this.images[e];v(t)&&this.updateImage(e,t)}}}const b=new t.Properties({anchor:new t.DataConstantProperty(t.spec.light.anchor),position:new class{constructor(){this.specification=t.spec.light.position}possiblyEvaluate(e,r){return function([e,r,n]){const i=t.degToRad(r+90),o=t.degToRad(n);return{x:e*Math.cos(i)*Math.sin(o),y:e*Math.sin(i)*Math.sin(o),z:e*Math.cos(o),azimuthal:r,polar:n}}(e.expression.evaluate(r))}interpolate(e,r,n){return{x:t.number(e.x,r.x,n),y:t.number(e.y,r.y,n),z:t.number(e.z,r.z,n),azimuthal:t.number(e.azimuthal,r.azimuthal,n),polar:t.number(e.polar,r.polar,n)}}},color:new t.DataConstantProperty(t.spec.light.color),intensity:new t.DataConstantProperty(t.spec.light.intensity)}),w="-transition";class E extends t.Evented{constructor(e){super(),this._transitionable=new t.Transitionable(b),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,r={}){if(!this._validate(t.validateLight,e,r))for(const n in e){const r=e[n];t.endsWith(n,w)?this._transitionable.setTransition(n.slice(0,-w.length),r):this._transitionable.setValue(n,r)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(e,r,n){return(!n||!1!==n.validate)&&t.emitValidationErrors(this,e.call(t.validateStyle,t.extend({value:r,style:{glyphs:!0,sprite:!0},styleSpec:t.spec})))}}const S=new t.Properties({source:new t.DataConstantProperty(t.spec.terrain.source),exaggeration:new t.DataConstantProperty(t.spec.terrain.exaggeration)}),I="-transition";class T extends t.Evented{constructor(e,r){super(),this._transitionable=new t.Transitionable(S),this.set(e),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=r}get(){return this._transitionable.serialize()}set(e){for(const r in e){const n=e[r];t.endsWith(r,I)?this._transitionable.setTransition(r.slice(0,-I.length),n):this._transitionable.setValue(r,n)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}}function C(e,r,n,i){const o=t.smoothstep(45,65,n),[s,a]=M(e,i),l=t.length(r);let u=1-Math.min(1,Math.exp((l-s)/(a-s)*-6));return u*=u*u,u=Math.min(1,1.00747*u),u*o*e.alpha}function M(t,e){const r=.5/Math.tan(.5*e);return[t.range[0]+r,t.range[1]+r]}const A=new t.Properties({range:new t.DataConstantProperty(t.spec.fog.range),color:new t.DataConstantProperty(t.spec.fog.color),"horizon-blend":new t.DataConstantProperty(t.spec.fog["horizon-blend"])}),P="-transition";class k extends t.Evented{constructor(e,r){super(),this._transitionable=new t.Transitionable(A),this.set(e),this._transitioning=this._transitionable.untransitioned(),this._transform=r}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(e,r={}){if(!this._validate(t.validateFog,e,r))for(const n in e){const r=e[n];t.endsWith(n,P)?this._transitionable.setTransition(n.slice(0,-P.length),r):this._transitionable.setValue(n,r)}}getOpacity(e){if(!this._transform.projection.supportsFog)return 0;const r=this.properties&&this.properties.get("color")||1;return t.smoothstep(45,65,e)*r.a}getOpacityAtLatLng(e,r){return this._transform.projection.supportsFog?function(e,r,n){const i=t.MercatorCoordinate.fromLngLat(r),o=n.elevation?n.elevation.getAtPointOrZero(i):0,s=[i.x,i.y,o];return t.transformMat4(s,s,n.mercatorFogMatrix),C(e,s,n.pitch,n._fov)}(this.state,e,r):0}getFovAdjustedRange(t){return this._transform.projection.supportsFog?M(this.state,t):[0,1]}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(e,r,n){return(!n||!1!==n.validate)&&t.emitValidationErrors(this,e.call(t.validateStyle,t.extend({value:r,style:{glyphs:!0,sprite:!0},styleSpec:t.spec})))}}class L{constructor(e,r){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=t.uniqueId();const n=this.workerPool.acquire(this.id);for(let t=0;t<n.length;t++){const e=new L.Actor(n[t],r,this.id);e.name=`Worker ${t}`,this.actors.push(e)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,r,n){t.asyncAll(this.actors,(t,n)=>{t.send(e,r,n)},n=n||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function z(e,r,n){return r*(t.EXTENT/(e.tileSize*Math.pow(2,n-e.tileID.overscaledZ)))}L.Actor=t.Actor;class D{constructor(t,e,r){this.context=t;const n=t.gl;this.buffer=n.createBuffer(),this.dynamicDraw=Boolean(r),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||e.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const e=this.context.gl;this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const R={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class O{constructor(t,e,r,n){this.length=e.length,this.attributes=r,this.itemSize=e.bytesPerElement,this.dynamicDraw=n,this.context=t;const i=t.gl;this.buffer=i.createBuffer(),t.bindVertexBuffer.set(this.buffer),i.bufferData(i.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||e.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,e){for(let r=0;r<this.attributes.length;r++){const n=e.attributes[this.attributes[r].name];void 0!==n&&t.enableVertexAttribArray(n)}}setVertexAttribPointers(t,e,r){for(let n=0;n<this.attributes.length;n++){const i=this.attributes[n],o=e.attributes[i.name];void 0!==o&&t.vertexAttribPointer(o,i.components,t[R[i.type]],!1,this.itemSize,i.offset+this.itemSize*(r||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class N{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class F extends N{getDefault(){return t.Color.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class B extends N{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class j extends N{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class U extends N{getDefault(){return[!0,!0,!0,!0]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class V extends N{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class G extends N{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class q extends N{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class $ extends N{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Z extends N{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}}class X extends N{getDefault(){return[0,1]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class W extends N{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}}class Y extends N{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class H extends N{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}}class J extends N{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class K extends N{getDefault(){return t.Color.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Q extends N{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class tt extends N{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}}class et extends N{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class rt extends N{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class nt extends N{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class it extends N{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class ot extends N{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class st extends N{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class at extends N{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class lt extends N{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class ut extends N{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ct extends N{getDefault(){return null}set(t){const e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ht extends N{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class pt extends N{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class ft extends N{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class dt extends N{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class mt extends N{constructor(t,e){super(t),this.context=t,this.parent=e}getDefault(){return null}}class gt extends mt{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class yt extends mt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,this.attachment(),e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class _t extends yt{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class vt{constructor(t,e,r,n){this.context=t,this.width=e,this.height=r;const i=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new gt(t,i),n&&(this.depthAttachment=new yt(t,i))}destroy(){const t=this.context.gl,e=this.colorAttachment.get();if(e&&t.deleteTexture(e),this.depthAttachment){const e=this.depthAttachment.get();e&&t.deleteRenderbuffer(e)}t.deleteFramebuffer(this.framebuffer)}}class xt{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new F(this),this.clearDepth=new B(this),this.clearStencil=new j(this),this.colorMask=new U(this),this.depthMask=new V(this),this.stencilMask=new G(this),this.stencilFunc=new q(this),this.stencilOp=new $(this),this.stencilTest=new Z(this),this.depthRange=new X(this),this.depthTest=new W(this),this.depthFunc=new Y(this),this.blend=new H(this),this.blendFunc=new J(this),this.blendColor=new K(this),this.blendEquation=new Q(this),this.cullFace=new tt(this),this.cullFaceSide=new et(this),this.frontFace=new rt(this),this.program=new nt(this),this.activeTexture=new it(this),this.viewport=new ot(this),this.bindFramebuffer=new st(this),this.bindRenderbuffer=new at(this),this.bindTexture=new lt(this),this.bindVertexBuffer=new ut(this),this.bindElementBuffer=new ct(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ht(this),this.pixelStoreUnpack=new pt(this),this.pixelStoreUnpackPremultiplyAlpha=new ft(this),this.pixelStoreUnpackFlipY=new dt(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,e){return new D(this,t,e)}createVertexBuffer(t,e,r){return new O(this,t,e,r)}createRenderbuffer(t,e,r){const n=this.gl,i=n.createRenderbuffer();return this.bindRenderbuffer.set(i),n.renderbufferStorage(n.RENDERBUFFER,t,e,r),this.bindRenderbuffer.set(null),i}createFramebuffer(t,e,r){return new vt(this,t,e,r)}clear({color:t,depth:e,stencil:r}){const n=this.gl;let i=0;t&&(i|=n.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),void 0!==e&&(i|=n.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(e),this.depthMask.set(!0)),void 0!==r&&(i|=n.STENCIL_BUFFER_BIT,this.clearStencil.set(r),this.stencilMask.set(255)),n.clear(i)}setCullFace(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(e){i(e.blendFunction,t.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class bt{constructor(t,e,r,n){this.screenBounds=t,this.cameraPoint=e,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=r,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(t=>n.pointCoordinate3D(t)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(e,r){let n,i;if(e instanceof t.pointGeometry||"number"==typeof e[0]){const o=t.pointGeometry.convert(e);n=[t.pointGeometry.convert(e)],i=r.isPointAboveHorizon(o)}else{const o=t.pointGeometry.convert(e[0]),s=t.pointGeometry.convert(e[1]);n=[o,s],i=t.polygonizeBounds(o,s).every(t=>r.isPointAboveHorizon(t))}return new bt(n,r.getCameraPoint(),i,r)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(e){return t.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],e)}bufferedCameraGeometry(e){const r=this.screenBounds[0],n=1===this.screenBounds.length?this.screenBounds[0].add(new t.pointGeometry(1,1)):this.screenBounds[1],i=t.polygonizeBounds(r,n,0,!1);return this.cameraPoint.y>n.y&&(this.cameraPoint.x>r.x&&this.cameraPoint.x<n.x?i.splice(3,0,this.cameraPoint):this.cameraPoint.x>=n.x?i[2]=this.cameraPoint:this.cameraPoint.x<=r.x&&(i[3]=this.cameraPoint)),t.bufferConvexPolygon(i,e)}containsTile(e,r,n){const i=e.queryPadding+1,o=e.tileID.wrap,s=n?this._bufferedCameraMercator(i,r).map(r=>t.getTilePoint(e.tileTransform,r,o)):this._bufferedScreenMercator(i,r).map(r=>t.getTilePoint(e.tileTransform,r,o)),a=this.screenGeometryMercator.map(r=>t.getTileVec3(e.tileTransform,r,o)),l=a.map(e=>new t.pointGeometry(e[0],e[1])),u=r.getFreeCameraOptions().position||new t.MercatorCoordinate(0,0,0),c=t.getTileVec3(e.tileTransform,u,o),h=a.map(e=>{const r=t.sub(e,e,c);return t.normalize(r,r),new t.Ray(c,r)}),p=z(e,1,r.zoom);if(t.polygonIntersectsBox(s,0,0,t.EXTENT,t.EXTENT))return{queryGeometry:this,tilespaceGeometry:l,tilespaceRays:h,bufferedTilespaceGeometry:s,bufferedTilespaceBounds:(f=t.getBounds(s),f.min.x=t.clamp(f.min.x,0,t.EXTENT),f.min.y=t.clamp(f.min.y,0,t.EXTENT),f.max.x=t.clamp(f.max.x,0,t.EXTENT),f.max.y=t.clamp(f.max.y,0,t.EXTENT),f),tile:e,tileID:e.tileID,pixelToTileUnitsFactor:p};var f}_bufferedScreenMercator(t,e){const r=wt(t);if(this._screenRaycastCache[r])return this._screenRaycastCache[r];{const n=this.bufferedScreenGeometry(t).map(t=>e.pointCoordinate3D(t));return this._screenRaycastCache[r]=n,n}}_bufferedCameraMercator(t,e){const r=wt(t);if(this._cameraRaycastCache[r])return this._cameraRaycastCache[r];{const n=this.bufferedCameraGeometry(t).map(t=>e.pointCoordinate3D(t));return this._cameraRaycastCache[r]=n,n}}}function wt(t){return 100*t|0}function Et(e,r,n){const i=function(i,o){if(i)return n(i);if(o){const i=t.pick(t.extend(o,e),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);o.vector_layers&&(i.vectorLayers=o.vector_layers,i.vectorLayerIds=i.vectorLayers.map(t=>t.id)),i.tiles=r.canonicalizeTileset(i,e.url),n(null,i)}};return e.url?t.getJSON(r.transformRequest(r.normalizeSourceURL(e.url),t.ResourceType.Source),i):t.exported.frame(()=>i(null,e))}class St{constructor(e,r,n){this.bounds=t.LngLatBounds.convert(this.validateBounds(e)),this.minzoom=r||0,this.maxzoom=n||24}validateBounds(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(e){const r=Math.pow(2,e.z),n=Math.floor(t.mercatorXfromLng(this.bounds.getWest())*r),i=Math.floor(t.mercatorYfromLat(this.bounds.getNorth())*r),o=Math.ceil(t.mercatorXfromLng(this.bounds.getEast())*r),s=Math.ceil(t.mercatorYfromLat(this.bounds.getSouth())*r);return e.x>=n&&e.x<o&&e.y>=i&&e.y<s}}class It extends t.Evented{constructor(e,r,n,i){super(),this.id=e,this.dispatcher=n,this.setEventedParent(i),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.extend({type:"raster"},r),t.extend(this,t.pick(r,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Et(this._options,this.map._requestManager,(e,r)=>{this._tileJSONRequest=null,this._loaded=!0,e?this.fire(new t.ErrorEvent(e)):r&&(t.extend(this,r),r.bounds&&(this.tileBounds=new St(r.bounds,this.minzoom,this.maxzoom)),t.postTurnstileEvent(r.tiles),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return t.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(e,r){const n=t.exported.devicePixelRatio>=2,i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),n,this.tileSize);e.request=t.getImage(this.map._requestManager.transformRequest(i,t.ResourceType.Tile),(n,i,o,s)=>{if(delete e.request,e.aborted)e.state="unloaded",r(null);else if(n)e.state="errored",r(n);else if(i){this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:o,expires:s});const n=this.map.painter.context,a=n.gl;e.texture=this.map.painter.getTileTexture(i.width),e.texture?e.texture.update(i,{useMipmap:!0}):(e.texture=new t.Texture(n,i,a.RGBA,{useMipmap:!0}),e.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),n.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax)),e.state="loaded",t.cacheEntryPossiblyAdded(this.dispatcher),r(null)}})}abortTile(t,e){t.request&&(t.request.cancel(),delete t.request),e()}unloadTile(t,e){t.texture&&this.map.painter.saveTileTexture(t.texture),e()}hasTransition(){return!1}}let Tt;function Ct(e,r,n,i,o,s,a,l){const u=[e,n,o,r,i,s,1,1,1],c=[a,l,1],h=t.adjoint([],u),[p,f,d]=t.transformMat3(c,c,t.transpose(h,h));return t.multiply(u,[p,0,0,0,f,0,0,0,d],u)}class Mt extends t.Evented{constructor(t,e,r,n){super(),this.id=t,this.dispatcher=r,this.coordinates=e.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(n),this.options=e}load(e,r){this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this.url=this.options.url,t.getImage(this.map._requestManager.transformRequest(this.url,t.ResourceType.Image),(n,i)=>{this._loaded=!0,n?this.fire(new t.ErrorEvent(n)):i&&(this.image=t.exported.getImageData(i),this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),r&&r(),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}setCoordinates(e){this.coordinates=e,this._boundsArray=void 0;const r=e.map(t.MercatorCoordinate.fromLngLat);return this.tileID=function(e){let r=1/0,n=1/0,i=-1/0,o=-1/0;for(const t of e)r=Math.min(r,t.x),n=Math.min(n,t.y),i=Math.max(i,t.x),o=Math.max(o,t.y);const s=Math.max(i-r,o-n),a=Math.max(0,Math.floor(-Math.log(s)/Math.LN2)),l=Math.pow(2,a);return new t.CanonicalTileID(a,Math.floor((r+i)/2*l),Math.floor((n+o)/2*l))}(r),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(e){for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture)}if(this._boundsArray)return;const r=t.tileTransform(this.tileID,this.map.transform.projection),[n,i,o,s]=this.coordinates.map(e=>{const n=r.projection.project(e[0],e[1]);return t.getTilePoint(r,n)._round()});this.perspectiveTransform=function(e,r,n,i,o,s,a,l,u,c){const h=Ct(0,0,e,0,0,r,e,r),p=Ct(n,i,o,s,a,l,u,c);return t.multiply(p,t.adjoint(h,h),p),[p[6]/p[8]*e/t.EXTENT,p[7]/p[8]*r/t.EXTENT]}(this.width,this.height,n.x,n.y,i.x,i.y,s.x,s.y,o.x,o.y);const a=this._boundsArray=new t.StructArrayLayout4i8;a.emplaceBack(n.x,n.y,0,0),a.emplaceBack(i.x,i.y,t.EXTENT,0),a.emplaceBack(s.x,s.y,0,t.EXTENT),a.emplaceBack(o.x,o.y,t.EXTENT,t.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=e.createVertexBuffer(a,t.boundsAttributes.members),this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const e=this.map.painter.context,r=e.gl;this.texture||(this.texture=new t.Texture(e,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE)),this._prepareData(e)}loadTile(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const At={vector:class extends t.Evented{constructor(e,r,n,i){if(super(),this.id=e,this.dispatcher=n,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.extend(this,t.pick(r,["url","scheme","tileSize","promoteId"])),this._options=t.extend({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(i),this._tileWorkers={},this._deduped=new t.DedupedRequest}load(){this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Et(this._options,this.map._requestManager,(e,r)=>{this._tileJSONRequest=null,this._loaded=!0,e?this.fire(new t.ErrorEvent(e)):r&&(t.extend(this,r),r.bounds&&(this.tileBounds=new St(r.bounds,this.minzoom,this.maxzoom)),t.postTurnstileEvent(r.tiles,this.map._requestManager._customAccessToken),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t();const e=this.map.style._getSourceCaches(this.id);for(const r of e)r.clearTiles();this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return t.extend({},this._options)}loadTile(e,r){const n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),i={request:this.map._requestManager.transformRequest(n,t.ResourceType.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:t.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:e.isSymbolTile};if(i.request.collectResourceTiming=this._collectResourceTiming,e.actor&&"expired"!==e.state)"loading"===e.state?e.reloadCallback=r:e.request=e.actor.send("reloadTile",i,o.bind(this));else if(e.actor=this._tileWorkers[n]=this._tileWorkers[n]||this.dispatcher.getActor(),this.dispatcher.ready)e.request=e.actor.send("loadTile",i,o.bind(this),void 0,!0);else{const r=t.loadVectorTile.call({deduped:this._deduped},i,(t,r)=>{t||!r?o.call(this,t):(i.data={cacheControl:r.cacheControl,expires:r.expires,rawData:r.rawData.slice(0)},e.actor&&e.actor.send("loadTile",i,o.bind(this),void 0,!0))},!0);e.request={cancel:r}}function o(n,i){return delete e.request,e.aborted?r(null):n&&404!==n.status?r(n):(i&&i.resourceTiming&&(e.resourceTiming=i.resourceTiming),this.map._refreshExpiredTiles&&i&&e.setExpiryData(i),e.loadVectorData(i,this.map.painter),t.cacheEntryPossiblyAdded(this.dispatcher),r(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id})}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:It,"raster-dem":class extends It{constructor(e,r,n,i){super(e,r,n,i),this.type="raster-dem",this.maxzoom=22,this._options=t.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(e,r){const n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function i(t,n){t&&(e.state="errored",r(t)),n&&(e.dem=n,e.dem.onDeserialize(),e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0,e.state="loaded",r(null))}e.request=t.getImage(this.map._requestManager.transformRequest(n,t.ResourceType.Tile),function(n,o,s,a){if(delete e.request,e.aborted)e.state="unloaded",r(null);else if(n)e.state="errored",r(n);else if(o){this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:s,expires:a});const r=t.window.ImageBitmap&&o instanceof t.window.ImageBitmap&&(null==Tt&&(Tt=t.window.OffscreenCanvas&&new t.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof t.window.createImageBitmap),Tt),n=1-(o.width-t.prevPowerOfTwo(o.width))/2;n<1||e.neighboringTiles||(e.neighboringTiles=this._getNeighboringTiles(e.tileID));const l=r?o:t.exported.getImageData(o,n),u={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:l,encoding:this.encoding,padding:n};e.actor&&"expired"!==e.state||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",u,i.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(e){const r=e.canonical,n=Math.pow(2,r.z),i=(r.x-1+n)%n,o=0===r.x?e.wrap-1:e.wrap,s=(r.x+1+n)%n,a=r.x+1===n?e.wrap+1:e.wrap,l={};return l[new t.OverscaledTileID(e.overscaledZ,o,r.z,i,r.y).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,a,r.z,s,r.y).key]={backfilled:!1},r.y>0&&(l[new t.OverscaledTileID(e.overscaledZ,o,r.z,i,r.y-1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,e.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,a,r.z,s,r.y-1).key]={backfilled:!1}),r.y+1<n&&(l[new t.OverscaledTileID(e.overscaledZ,o,r.z,i,r.y+1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,e.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,a,r.z,s,r.y+1).key]={backfilled:!1}),l}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded"}},geojson:class extends t.Evented{constructor(e,r,n,i){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(i),this._data=r.data,this._options=t.extend({},r),this._collectResourceTiming=r.collectResourceTiming,void 0!==r.maxzoom&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const o=t.EXTENT/this.tileSize;this.workerOptions=t.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(void 0!==r.buffer?r.buffer:128)*o,tolerance:(void 0!==r.tolerance?r.tolerance:.375)*o,extent:t.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:void 0!==r.clusterMaxZoom?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:t.EXTENT,radius:(void 0!==r.clusterRadius?r.clusterRadius:50)*o,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}onAdd(t){this.map=t,this.setData(this._data)}setData(t){return this._data=t,this._updateWorkerData(),this}getClusterExpansionZoom(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},e),this}getClusterChildren(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},e),this}getClusterLeaves(t,e,r,n){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:e,offset:r},n),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new t.Event("dataloading",{dataType:"source"})),this._loaded=!1;const e=t.extend({},this.workerOptions),r=this._data;"string"==typeof r?(e.request=this.map._requestManager.transformRequest(t.exported.resolveURL(r),t.ResourceType.Source),e.request.collectResourceTiming=this._collectResourceTiming):e.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,e,(e,r)=>{if(this._loaded=!0,this._pendingLoad=null,e)this.fire(new t.ErrorEvent(e));else{const e={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&r&&r.resourceTiming&&r.resourceTiming[this.id]&&(e.resourceTiming=r.resourceTiming[this.id]),this.fire(new t.Event("data",e)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(e,r){const n=e.actor?"reloadTile":"loadTile";e.actor=this.actor,e.request=this.actor.send(n,{type:this.type,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:t.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(t,i)=>(delete e.request,e.unloadVectorData(),e.aborted?r(null):t?r(t):(e.loadVectorData(i,this.map.painter,"reloadTile"===n),r(null))),void 0,"loadTile"===n)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return t.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Mt{constructor(t,e,r,n){super(t,e,r,n),this.roundZoom=!0,this.type="video",this.options=e}load(){this._loaded=!1;const e=this.options;this.urls=[];for(const r of e.urls)this.urls.push(this.map._requestManager.transformRequest(r,t.ResourceType.Source).url);t.getVideo(this.urls,(e,r)=>{this._loaded=!0,e?this.fire(new t.ErrorEvent(e)):r&&(this.video=r,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const r=this.video.seekable;e<r.start(0)||e>r.end(0)?this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const e=this.map.painter.context,r=e.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new t.Texture(e,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(e)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Mt,canvas:class extends Mt{constructor(e,r,n,i){super(e,r,n,i),r.coordinates?Array.isArray(r.coordinates)&&4===r.coordinates.length&&!r.coordinates.some(t=>!Array.isArray(t)||2!==t.length||t.some(t=>"number"!=typeof t))||this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${e}`,null,'missing required property "coordinates"'))),r.animate&&"boolean"!=typeof r.animate&&this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),r.canvas?"string"==typeof r.canvas||r.canvas instanceof t.window.HTMLCanvasElement||this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${e}`,null,'missing required property "canvas"'))),this.options=r,this.animate=void 0===r.animate||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof t.window.HTMLCanvasElement?this.options.canvas:t.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const r=this.map.painter.context;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.Texture(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}},Pt=function(e,r,n,i){const o=new At[r.type](e,r,n,i);if(o.id!==e)throw new Error(`Expected Source id to be ${e} instead of ${o.id}`);return t.bindAll(["load","abort","unload","serialize","prepare"],o),o};function kt(e,r){const n=t.identity([]);return t.scale(n,n,[.5*e.width,.5*-e.height,1]),t.translate(n,n,[1,-1,0]),t.multiply$1(n,n,e.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(n)}function Lt(t,e,r,n,i,o,s,a=!1){const l=t.tilesIn(n,s,a);l.sort(Dt);const u=[];for(const h of l)u.push({wrappedTileID:h.tile.tileID.wrapped().key,queryResults:h.tile.queryRenderedFeatures(e,r,t._state,h,i,o,kt(t.transform,h.tile.tileID),a)});const c=function(t){const e={},r={};for(const n of t){const t=n.queryResults,i=n.wrappedTileID,o=r[i]=r[i]||{};for(const r in t){const n=t[r],i=o[r]=o[r]||{},s=e[r]=e[r]||[];for(const t of n)i[t.featureIndex]||(i[t.featureIndex]=!0,s.push(t))}}return e}(u);for(const h in c)c[h].forEach(e=>{const r=e.feature,n=t.getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=n});return c}function zt(t,e){const r=t.getRenderableIds().map(e=>t.getTileByID(e)),n=[],i={};for(let o=0;o<r.length;o++){const t=r[o],s=t.tileID.canonical.key;i[s]||(i[s]=!0,t.querySourceFeatures(n,e))}return n}function Dt(t,e){const r=t.tileID,n=e.tileID;return r.overscaledZ-n.overscaledZ||r.canonical.y-n.canonical.y||r.wrap-n.wrap||r.canonical.x-n.canonical.x}function Rt(){return null!=io.workerClass?new io.workerClass:new t.window.Worker(io.workerUrl)}const Ot="mapboxgl_preloaded_worker_pool";class Nt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Nt.workerCount;)this.workers.push(new Rt);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],0===this.numActive()&&(this.workers.forEach(t=>{t.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ot]}numActive(){return Object.keys(this.active).length}}let Ft;function Bt(){return Ft||(Ft=new Nt),Ft}function jt(e,r){const n={};for(const t in e)"ref"!==t&&(n[t]=e[t]);return t.refProperties.forEach(t=>{t in r&&(n[t]=r[t])}),n}function Ut(t){t=t.slice();const e=Object.create(null);for(let r=0;r<t.length;r++)e[t[r].id]=t[r];for(let r=0;r<t.length;r++)"ref"in t[r]&&(t[r]=jt(t[r],e[t[r].ref]));return t}Nt.workerCount=2;const Vt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Gt(t,e,r){r.push({command:Vt.addSource,args:[t,e[t]]})}function qt(t,e,r){e.push({command:Vt.removeSource,args:[t]}),r[t]=!0}function $t(t,e,r,n){qt(t,r,n),Gt(t,e,r)}function Zt(t,e,r){let n;for(n in t[r])if(t[r].hasOwnProperty(n)&&"data"!==n&&!i(t[r][n],e[r][n]))return!1;for(n in e[r])if(e[r].hasOwnProperty(n)&&"data"!==n&&!i(t[r][n],e[r][n]))return!1;return!0}function Xt(t,e,r,n,o,s){let a;for(a in e=e||{},t=t||{})t.hasOwnProperty(a)&&(i(t[a],e[a])||r.push({command:s,args:[n,a,e[a],o]}));for(a in e)e.hasOwnProperty(a)&&!t.hasOwnProperty(a)&&(i(t[a],e[a])||r.push({command:s,args:[n,a,e[a],o]}))}function Wt(t){return t.id}function Yt(t,e){return t[e.id]=e,t}class Ht{constructor(t,e){this.reset(t,e)}reset(t,e){this.points=t||[],this._distances=[0];for(let r=1;r<this.points.length;r++)this._distances[r]=this._distances[r-1]+this.points[r].dist(this.points[r-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(e||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(1===this.points.length)return this.points[0];e=t.clamp(e,0,1);let r=1,n=this._distances[r];const i=e*this.paddedLength+this.padding;for(;n<i&&r<this._distances.length;)n=this._distances[++r];const o=r-1,s=this._distances[o],a=n-s,l=a>0?(i-s)/a:0;return this.points[o].mult(1-l).add(this.points[r].mult(l))}}class Jt{constructor(t,e,r){const n=this.boxCells=[],i=this.circleCells=[];this.xCellCount=Math.ceil(t/r),this.yCellCount=Math.ceil(e/r);for(let o=0;o<this.xCellCount*this.yCellCount;o++)n.push([]),i.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,e,r,n,i){this._forEachCell(e,r,n,i,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(i)}insertCircle(t,e,r,n){this._forEachCell(e-n,r-n,e+n,r+n,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(r),this.circles.push(n)}_insertBoxCell(t,e,r,n,i,o){this.boxCells[i].push(o)}_insertCircleCell(t,e,r,n,i,o){this.circleCells[i].push(o)}_query(t,e,r,n,i,o){if(r<0||t>this.width||n<0||e>this.height)return!i&&[];const s=[];if(t<=0&&e<=0&&this.width<=r&&this.height<=n){if(i)return!0;for(let t=0;t<this.boxKeys.length;t++)s.push({key:this.boxKeys[t],x1:this.bboxes[4*t],y1:this.bboxes[4*t+1],x2:this.bboxes[4*t+2],y2:this.bboxes[4*t+3]});for(let t=0;t<this.circleKeys.length;t++){const e=this.circles[3*t],r=this.circles[3*t+1],n=this.circles[3*t+2];s.push({key:this.circleKeys[t],x1:e-n,y1:r-n,x2:e+n,y2:r+n})}return o?s.filter(o):s}return this._forEachCell(t,e,r,n,this._queryCell,s,{hitTest:i,seenUids:{box:{},circle:{}}},o),i?s.length>0:s}_queryCircle(t,e,r,n,i){const o=t-r,s=t+r,a=e-r,l=e+r;if(s<0||o>this.width||l<0||a>this.height)return!n&&[];const u=[];return this._forEachCell(o,a,s,l,this._queryCellCircle,u,{hitTest:n,circle:{x:t,y:e,radius:r},seenUids:{box:{},circle:{}}},i),n?u.length>0:u}query(t,e,r,n,i){return this._query(t,e,r,n,!1,i)}hitTest(t,e,r,n,i){return this._query(t,e,r,n,!0,i)}hitTestCircle(t,e,r,n){return this._queryCircle(t,e,r,!0,n)}_queryCell(t,e,r,n,i,o,s,a){const l=s.seenUids,u=this.boxCells[i];if(null!==u){const i=this.bboxes;for(const c of u)if(!l.box[c]){l.box[c]=!0;const u=4*c;if(t<=i[u+2]&&e<=i[u+3]&&r>=i[u+0]&&n>=i[u+1]&&(!a||a(this.boxKeys[c]))){if(s.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[c],x1:i[u],y1:i[u+1],x2:i[u+2],y2:i[u+3]})}}}const c=this.circleCells[i];if(null!==c){const i=this.circles;for(const u of c)if(!l.circle[u]){l.circle[u]=!0;const c=3*u;if(this._circleAndRectCollide(i[c],i[c+1],i[c+2],t,e,r,n)&&(!a||a(this.circleKeys[u]))){if(s.hitTest)return o.push(!0),!0;{const t=i[c],e=i[c+1],r=i[c+2];o.push({key:this.circleKeys[u],x1:t-r,y1:e-r,x2:t+r,y2:e+r})}}}}}_queryCellCircle(t,e,r,n,i,o,s,a){const l=s.circle,u=s.seenUids,c=this.boxCells[i];if(null!==c){const t=this.bboxes;for(const e of c)if(!u.box[e]){u.box[e]=!0;const r=4*e;if(this._circleAndRectCollide(l.x,l.y,l.radius,t[r+0],t[r+1],t[r+2],t[r+3])&&(!a||a(this.boxKeys[e])))return o.push(!0),!0}}const h=this.circleCells[i];if(null!==h){const t=this.circles;for(const e of h)if(!u.circle[e]){u.circle[e]=!0;const r=3*e;if(this._circlesCollide(t[r],t[r+1],t[r+2],l.x,l.y,l.radius)&&(!a||a(this.circleKeys[e])))return o.push(!0),!0}}}_forEachCell(t,e,r,n,i,o,s,a){const l=this._convertToXCellCoord(t),u=this._convertToYCellCoord(e),c=this._convertToXCellCoord(r),h=this._convertToYCellCoord(n);for(let p=l;p<=c;p++)for(let l=u;l<=h;l++)if(i.call(this,t,e,r,n,this.xCellCount*l+p,o,s,a))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,e,r,n,i,o){const s=n-t,a=i-e,l=r+o;return l*l>s*s+a*a}_circleAndRectCollide(t,e,r,n,i,o,s){const a=(o-n)/2,l=Math.abs(t-(n+a));if(l>a+r)return!1;const u=(s-i)/2,c=Math.abs(e-(i+u));if(c>u+r)return!1;if(l<=a||c<=u)return!0;const h=l-a,p=c-u;return h*h+p*p<=r*r}}const Kt=Math.tan(85*Math.PI/180);function Qt(e,r,n,i,o,s){const a=t.create();if(n){if("globe"===o.projection.name){const e=t.calculateGlobeMatrix(o,o.worldSize/o._projectionScaler,[0,0]);t.multiply$1(a,e,t.globeDenormalizeECEF(t.globeTileBounds(r)))}else{const t=_([],s);a[0]=t[0],a[1]=t[1],a[4]=t[2],a[5]=t[3]}i||t.rotateZ(a,a,o.angle)}else t.multiply$1(a,o.labelPlaneMatrix,e);return a}function te(e,r,n,i,o,s){if(n){if("globe"===o.projection.name){const a=Qt(e,r,n,i,o,s);return t.invert(a,a),t.multiply$1(a,e,a),a}{const r=t.clone(e),n=t.identity([]);return n[0]=s[0],n[1]=s[1],n[4]=s[2],n[5]=s[3],t.multiply$1(r,r,n),i||t.rotateZ(r,r,-o.angle),r}}return o.glCoordMatrix}function ee(e,r,n=0){const i=[e.x,e.y,n,1];n?t.transformMat4$1(i,i,r):de(i,i,r);const o=i[3];return{point:new t.pointGeometry(i[0]/o,i[1]/o),signedDistanceFromCamera:o}}function re(e,r){const n=[e[0],e[1],e[2],1];t.transformMat4$1(n,n,r);const i=n[3];return{point:new t.pointGeometry(n[0]/i,n[1]/i),signedDistanceFromCamera:i}}function ne(t,e){return Math.min(.5+t/e*.5,1.5)}function ie(t,e){const r=t[0]/t[3],n=t[1]/t[3];return r>=-e[0]&&r<=e[0]&&n>=-e[1]&&n<=e[1]}function oe(e,r,n,i,o,s,a,l,u,c){const h=n.transform,p=i?e.textSizeData:e.iconSizeData,f=t.evaluateSizeForZoom(p,n.transform.zoom),d=[256/n.width*2+1,256/n.height*2+1],m=i?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;m.clear();const g=e.lineVertexArray,y=i?e.text.placedSymbolArray:e.icon.placedSymbolArray,_=n.transform.width/n.transform.height;let v=!1;for(let x=0;x<y.length;x++){const i=y.get(x);if(i.writingMode!==t.WritingMode.vertical||v||0!==x&&y.get(x-1).writingMode===t.WritingMode.horizontal||(v=!0),(i.hidden||i.writingMode===t.WritingMode.vertical)&&!v){fe(i.numGlyphs,m);continue}v=!1;const b=new t.pointGeometry(i.tileAnchorX,i.tileAnchorY),w=u?u(b):[0,0,0],E=h.projection.projectTilePoint(b.x,b.y,c.canonical),S=[E.x+w[0],E.y+w[1],E.z+w[2]],I=[...S,1];if(t.transformMat4$1(I,I,r),!ie(I,d)){fe(i.numGlyphs,m);continue}const T=ne(n.transform.cameraToCenterDistance,I[3]),C=t.evaluateSizeForFeature(p,f,i),M=a?C/T:C*T,A=ee(new t.pointGeometry(S[0],S[1]),o,S[2]);if(A.signedDistanceFromCamera<=0){fe(i.numGlyphs,m);continue}let P={};const k=a?null:u,L=le(i,M,!1,l,r,o,s,e.glyphOffsetArray,g,m,A.point,b,P,_,k,h.projection,c);v=L.useVertical,k&&L.needsFlipping&&(P={}),(L.notEnoughRoom||v||L.needsFlipping&&le(i,M,!0,l,r,o,s,e.glyphOffsetArray,g,m,A.point,b,P,_,k,h.projection,c).notEnoughRoom)&&fe(i.numGlyphs,m)}i?e.text.dynamicLayoutVertexBuffer.updateData(m):e.icon.dynamicLayoutVertexBuffer.updateData(m)}function se(t,e,r,n,i,o,s,a,l,u,c,h,p,f,d){const m=a.glyphStartIndex+a.numGlyphs,g=a.lineStartIndex,y=a.lineStartIndex+a.lineLength,_=e.getoffsetX(a.glyphStartIndex),v=e.getoffsetX(m-1),x=he(t*_,r,n,i,o,s,a.segment,g,y,l,u,c,h,p,!0,f,d);if(!x)return null;const b=he(t*v,r,n,i,o,s,a.segment,g,y,l,u,c,h,p,!0,f,d);return b?{first:x,last:b}:null}function ae(e,r,n,i){return e.writingMode===t.WritingMode.horizontal&&Math.abs(n.y-r.y)>Math.abs(n.x-r.x)*i?{useVertical:!0}:e.writingMode===t.WritingMode.vertical?r.y<n.y?{needsFlipping:!0}:null:0!==e.flipState&&function(t,e,r){const n=(e.x-t.x)*r;return 0===n||Math.abs((e.y-t.y)/n)>Kt}(r,n,i)?1===e.flipState?{needsFlipping:!0}:null:r.x>n.x?{needsFlipping:!0}:null}function le(e,r,n,i,o,s,a,l,u,c,h,p,f,d,m,g,y){const _=r/24,v=e.lineOffsetX*_,x=e.lineOffsetY*_;let b;if(e.numGlyphs>1){const t=e.glyphStartIndex+e.numGlyphs,r=e.lineStartIndex,o=e.lineStartIndex+e.lineLength,c=se(_,l,v,x,n,h,p,e,u,s,f,m,!1,g,y);if(!c)return{notEnoughRoom:!0};const w=ee(c.first.point,a).point,E=ee(c.last.point,a).point;if(i&&!n){const t=ae(e,w,E,d);if(e.flipState=t&&t.needsFlipping?1:2,t)return t}b=[c.first];for(let i=e.glyphStartIndex+1;i<t-1;i++)b.push(he(_*l.getoffsetX(i),v,x,n,h,p,e.segment,r,o,u,s,f,m,!1,!1,g,y));b.push(c.last)}else{if(i&&!n){const r=ee(p,o).point,n=e.lineStartIndex+e.segment+1,i=new t.pointGeometry(u.getx(n),u.gety(n)),s=ee(i,o),a=ae(e,r,s.signedDistanceFromCamera>0?s.point:ce(p,i,r,1,o,void 0,g,y.canonical),d);if(e.flipState=a&&a.needsFlipping?1:2,a)return a}const r=he(_*l.getoffsetX(e.glyphStartIndex),v,x,n,h,p,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,u,s,f,m,!1,!1,g,y);if(!r)return{notEnoughRoom:!0};b=[r]}for(const w of b)t.addDynamicAttributes(c,w.point,w.angle);return{}}function ue(e,r,n,i,o){const s=i.projectTilePoint(e.x,e.y,r);if(!o)return ee(s,n,s.z);const a=o(e);return ee(new t.pointGeometry(s.x+a[0],s.y+a[1]),n,s.z+a[2])}function ce(t,e,r,n,i,o,s,a){const l=ue(t.add(t.sub(e)._unit()),a,i,s,o).point,u=r.sub(l);return r.add(u._mult(n/u.mag()))}function he(e,r,n,i,o,s,a,l,u,c,h,p,f,d,m,g,y){const _=i?e-r:e+r;let v=_>0?1:-1,x=0;i&&(v*=-1,x=Math.PI),v<0&&(x+=Math.PI);let b=v>0?l+a:l+a+1,w=o,E=o,S=0,I=0;const T=Math.abs(_),C=[],M=[];let A=s;const P=()=>{const e=b-v;return 0===S?s:new t.pointGeometry(c.getx(e),c.gety(e))},k=()=>ce(P(),A,E,T-S+1,h,f,g,y.canonical);for(;S+I<=T;){if(b+=v,b<l||b>=u)return null;if(E=w,C.push(w),d&&M.push(A||P()),w=p[b],void 0===w){A=new t.pointGeometry(c.getx(b),c.gety(b));const e=ue(A,y.canonical,h,g,f);w=e.signedDistanceFromCamera>0?p[b]=e.point:k()}else A=null;S+=I,I=E.dist(w)}m&&f&&(A=A||new t.pointGeometry(c.getx(b),c.gety(b)),p[b]=w=void 0===p[b]?w:k(),I=E.dist(w));const L=(T-S)/I,z=w.sub(E),D=z.mult(L)._add(E);n&&D._add(z._unit()._perp()._mult(n*v));const R=x+Math.atan2(w.y-E.y,w.x-E.x);return C.push(D),d&&(A=A||new t.pointGeometry(c.getx(b),c.gety(b)),M.push(function(e,r,n){const i=1-n;return new t.pointGeometry(e.x*i+r.x*n,e.y*i+r.y*n)}(M.length>0?M[M.length-1]:A,A,L))),{point:D,angle:R,path:C,tilePath:M}}const pe=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function fe(t,e){for(let r=0;r<t;r++){const t=e.length;e.resize(t+4),e.float32.set(pe,3*t)}}function de(t,e,r){const n=e[0],i=e[1];return t[0]=r[0]*n+r[4]*i+r[12],t[1]=r[1]*n+r[5]*i+r[13],t[3]=r[3]*n+r[7]*i+r[15],t}const me=100;class ge{constructor(t,e,r=new Jt(t.width+200,t.height+200,25),n=new Jt(t.width+200,t.height+200,25)){this.transform=t,this.grid=r,this.ignoredGrid=n,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+me,this.screenBottomBoundary=t.height+me,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=e}placeCollisionBox(t,e,r,n,i,o,s){let a=e.projectedAnchorX,l=e.projectedAnchorY,u=e.projectedAnchorZ;const c=e.elevation,h=e.tileID;if(c&&h){const t=this.transform.projection.upVector(h.canonical,e.tileAnchorX,e.tileAnchorY),r=this.transform.projection.upVectorScale(h.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;a+=t[0]*c*r,l+=t[1]*c*r,u+=t[2]*c*r}const p=this.projectAndGetPerspectiveRatio(o,[a,l,u],e.tileID,"globe"===this.transform.projection.name||!!c||this.transform.pitch>0),f=i*p.perspectiveRatio,d=(e.x1*t+r.x-e.padding)*f+p.point.x,m=(e.y1*t+r.y-e.padding)*f+p.point.y,g=(e.x2*t+r.x+e.padding)*f+p.point.x,y=(e.y2*t+r.y+e.padding)*f+p.point.y,_=p.perspectiveRatio<=.55||p.occluded;return!this.isInsideGrid(d,m,g,y)||!n&&this.grid.hitTest(d,m,g,y,s)||_?{box:[],offscreen:!1,occluded:p.occluded}:{box:[d,m,g,y],offscreen:this.isOffscreen(d,m,g,y),occluded:!1}}placeCollisionCircles(e,r,n,i,o,s,a,l,u,c,h,p,f,d){const m=[],g=this.transform.elevation,y=g?g.getAtTileOffsetFunc(d,this.transform.center.lat,this.transform.worldSize,this.transform.projection):t=>[0,0,0],_=new t.pointGeometry(r.tileAnchorX,r.tileAnchorY),v=this.transform.projection.projectTilePoint(r.tileAnchorX,r.tileAnchorY,d.canonical),x=y(_),b=[v.x+x[0],v.y+x[1],v.z+x[2]],w=this.projectAndGetPerspectiveRatio(s,[b[0],b[1],b[2]],d,"globe"===this.transform.projection.name||!!g||this.transform.pitch>0),{perspectiveRatio:E}=w,S=(c?o/E:o*E)/t.ONE_EM,I=ee(new t.pointGeometry(b[0],b[1]),a,b[2]).point,T=w.signedDistanceFromCamera>0?se(S,i,r.lineOffsetX*S,r.lineOffsetY*S,!1,I,_,r,n,a,{},g&&!c?y:null,c&&!!g,this.transform.projection,d):null;let C=!1,M=!1,A=!0;if(T&&!w.occluded){const r=.5*p*E+f,n=new t.pointGeometry(-100,-100),i=new t.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),o=new Ht,s=T.first,a=T.last;let c=[];for(let t=s.path.length-1;t>=1;t--)c.push(s.path[t]);for(let t=1;t<a.path.length;t++)c.push(a.path[t]);const d=2.5*r;if(l){const t=c.map(g?(t,e)=>{const r=y(e<s.path.length-1?s.tilePath[s.path.length-1-e]:a.tilePath[e-s.path.length+2]);return ee(t,l,r[2])}:t=>ee(t,l));c=t.some(t=>t.signedDistanceFromCamera<=0)?[]:t.map(t=>t.point)}let _=[];if(c.length>0){const e=c[0].clone(),r=c[0].clone();for(let t=1;t<c.length;t++)e.x=Math.min(e.x,c[t].x),e.y=Math.min(e.y,c[t].y),r.x=Math.max(r.x,c[t].x),r.y=Math.max(r.y,c[t].y);_=e.x>=n.x&&r.x<=i.x&&e.y>=n.y&&r.y<=i.y?[c]:r.x<n.x||e.x>i.x||r.y<n.y||e.y>i.y?[]:t.clipLine([c],n.x,n.y,i.x,i.y)}for(const t of _){o.reset(t,.25*r);let n=0;n=o.length<=.5*r?1:Math.ceil(o.paddedLength/d)+1;for(let t=0;t<n;t++){const i=t/Math.max(n-1,1),s=o.lerp(i),a=s.x+me,l=s.y+me;m.push(a,l,r,0);const c=a-r,p=l-r,f=a+r,d=l+r;if(A=A&&this.isOffscreen(c,p,f,d),M=M||this.isInsideGrid(c,p,f,d),!e&&this.grid.hitTestCircle(a,l,r,h)&&(C=!0,!u))return{circles:[],offscreen:!1,collisionDetected:C,occluded:!1}}}}return{circles:!u&&C||!M?[]:m,offscreen:A,collisionDetected:C,occluded:w.occluded}}queryRenderedSymbols(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const r=[];let n=1/0,i=1/0,o=-1/0,s=-1/0;for(const c of e){const e=new t.pointGeometry(c.x+me,c.y+me);n=Math.min(n,e.x),i=Math.min(i,e.y),o=Math.max(o,e.x),s=Math.max(s,e.y),r.push(e)}const a=this.grid.query(n,i,o,s).concat(this.ignoredGrid.query(n,i,o,s)),l={},u={};for(const c of a){const e=c.key;if(void 0===l[e.bucketInstanceId]&&(l[e.bucketInstanceId]={}),l[e.bucketInstanceId][e.featureIndex])continue;const n=[new t.pointGeometry(c.x1,c.y1),new t.pointGeometry(c.x2,c.y1),new t.pointGeometry(c.x2,c.y2),new t.pointGeometry(c.x1,c.y2)];t.polygonIntersectsPolygon(r,n)&&(l[e.bucketInstanceId][e.featureIndex]=!0,void 0===u[e.bucketInstanceId]&&(u[e.bucketInstanceId]=[]),u[e.bucketInstanceId].push(e.featureIndex))}return u}insertCollisionBox(t,e,r,n,i){(e?this.ignoredGrid:this.grid).insert({bucketInstanceId:r,featureIndex:n,collisionGroupID:i},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,e,r,n,i){const o=e?this.ignoredGrid:this.grid,s={bucketInstanceId:r,featureIndex:n,collisionGroupID:i};for(let a=0;a<t.length;a+=4)o.insertCircle(s,t[a],t[a+1],t[a+2])}projectAndGetPerspectiveRatio(e,r,n,i){const o=[r[0],r[1],r[2],1];let s=!1;return r[2]||this.transform.pitch>0?(t.transformMat4$1(o,o,e),this.fogState&&n&&(s=function(e,r,n,i,o,s){const a=s.calculateFogTileMatrix(o),l=[r,n,i];return t.transformMat4(l,l,a),C(e,l,s.pitch,s._fov)}(this.fogState,r[0],r[1],r[2],n.toUnwrapped(),this.transform)>.9)):de(o,o,e),{point:new t.pointGeometry((o[0]/o[3]+1)/2*this.transform.width+me,(-o[1]/o[3]+1)/2*this.transform.height+me),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/o[3]*.5,1.5),signedDistanceFromCamera:o[3],occluded:i&&o[2]>o[3]||s}}isOffscreen(t,e,r,n){return r<me||t>=this.screenRightBoundary||n<me||e>this.screenBottomBoundary}isInsideGrid(t,e,r,n){return r>=0&&t<this.gridRightBoundary&&n>=0&&e<this.gridBottomBoundary}getViewportMatrix(){const e=t.identity([]);return t.translate(e,e,[-100,-100,0]),e}}class ye{constructor(t,e,r,n){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):n&&r?1:0,this.placed=r}isHidden(){return 0===this.opacity&&!this.placed}}class _e{constructor(t,e,r,n,i,o=!1){this.text=new ye(t?t.text:null,e,r,i),this.icon=new ye(t?t.icon:null,e,n,i),this.clipped=o}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ve{constructor(t,e,r,n=!1){this.text=t,this.icon=e,this.skipFade=r,this.clipped=n}}class xe{constructor(){this.invProjMatrix=t.create(),this.viewportMatrix=t.create(),this.circles=[]}}class be{constructor(t,e,r,n,i){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=r,this.bucketIndex=n,this.tileID=i}}class we{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:t=>t.collisionGroupID===e}}return this.collisionGroups[t]}}function Ee(e,r,n,i,o){const{horizontalAlign:s,verticalAlign:a}=t.getAnchorAlignment(e),l=-(s-.5)*r,u=-(a-.5)*n,c=t.evaluateVariableOffset(e,i);return new t.pointGeometry(l+c[0]*o,u+c[1]*o)}function Se(e,r,n,i,o){const s=new t.pointGeometry(e,r);return n&&s._rotate(i?o:-o),s}class Ie{constructor(t,e,r,n,i){this.transform=t.clone(),this.collisionIndex=new ge(this.transform,i),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=e,this.retainedQueryData={},this.collisionGroups=new we(r),this.collisionCircleArrays={},this.prevPlacement=n,n&&(n.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(e,r,n,i){const o=n.getBucket(r),s=n.latestFeatureIndex;if(!o||!s||r.id!==o.layerIds[0])return;const a=o.layers[0].layout,l=n.collisionBoxArray,u=Math.pow(2,this.transform.zoom-n.tileID.overscaledZ),c=n.tileSize/t.EXTENT,h=n.tileID.toUnwrapped(),p=this.transform.calculateProjMatrix(h),f="map"===a.get("text-pitch-alignment"),d="map"===a.get("text-rotation-alignment");r.compileFilter();const m=r.dynamicFilter(),g=r.dynamicFilterNeedsFeature(),y=this.transform.calculatePixelsToTileUnitsMatrix(n),_=Qt(p,n.tileID.canonical,f,d,this.transform,y);let v=null;if(f){const e=te(p,n.tileID.canonical,f,d,this.transform,y);v=t.multiply$1([],this.transform.labelPlaneMatrix,e)}let x=null;m&&n.latestFeatureIndex&&(x={unwrappedTileID:h,dynamicFilter:m,dynamicFilterNeedsFeature:g,featureIndex:n.latestFeatureIndex}),this.retainedQueryData[o.bucketInstanceId]=new be(o.bucketInstanceId,s,o.sourceLayerIndex,o.index,n.tileID);const b={bucket:o,layout:a,posMatrix:p,textLabelPlaneMatrix:_,labelToScreenMatrix:v,clippingData:x,scale:u,textPixelRatio:c,holdingForFade:n.holdingForFade(),collisionBoxArray:l,partiallyEvaluatedTextSize:t.evaluateSizeForZoom(o.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:t.evaluateSizeForZoom(o.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(i)for(const t of o.sortKeyRanges){const{sortKey:r,symbolInstanceStart:n,symbolInstanceEnd:i}=t;e.push({sortKey:r,symbolInstanceStart:n,symbolInstanceEnd:i,parameters:b})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:b})}attemptAnchorPlacement(t,e,r,n,i,o,s,a,l,u,c,h,p,f,d,m,g,y){const _=[h.textOffset0,h.textOffset1],v=Ee(t,r,n,_,i),x=this.collisionIndex.placeCollisionBox(i,e,Se(v.x,v.y,o,s,this.transform.angle),c,a,l,u.predicate);if((!m||0!==this.collisionIndex.placeCollisionBox(f.getSymbolInstanceIconSize(y,this.transform.zoom,p),m,Se(v.x,v.y,o,s,this.transform.angle),c,a,l,u.predicate).box.length)&&x.box.length>0){let e;return this.prevPlacement&&this.prevPlacement.variableOffsets[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID].text&&(e=this.prevPlacement.variableOffsets[h.crossTileID].anchor),this.variableOffsets[h.crossTileID]={textOffset:_,width:r,height:n,anchor:t,textScale:i,prevAnchor:e},this.markUsedJustification(f,t,h,d),f.allowVerticalPlacement&&(this.markUsedOrientation(f,d,h),this.placedOrientations[h.crossTileID]=d),{shift:v,placedGlyphBoxes:x}}}placeLayerBucketPart(e,r,n,i){const{bucket:o,layout:s,posMatrix:a,textLabelPlaneMatrix:l,labelToScreenMatrix:u,clippingData:c,textPixelRatio:h,holdingForFade:p,collisionBoxArray:f,partiallyEvaluatedTextSize:d,partiallyEvaluatedIconSize:m,collisionGroup:g}=e.parameters,y=s.get("text-optional"),_=s.get("icon-optional"),v=s.get("text-allow-overlap"),x=s.get("icon-allow-overlap"),b="map"===s.get("text-rotation-alignment"),w="map"===s.get("text-pitch-alignment"),E="none"!==s.get("icon-text-fit"),S="viewport-y"===s.get("symbol-z-order");let I=v&&(x||!o.hasIconData()||_),T=x&&(v||!o.hasTextData()||y);!o.collisionArrays&&f&&o.deserializeCollisionBoxes(f),n&&i&&o.updateCollisionDebugBuffers(this.transform.zoom,f);const C=(e,i,f)=>{if(c){const n={zoom:this.transform.zoom,pitch:this.transform.pitch};let i=null;if(c.dynamicFilterNeedsFeature){const t=this.retainedQueryData[o.bucketInstanceId];i=c.featureIndex.loadFeature({featureIndex:e.featureIndex,bucketIndex:t.bucketIndex,sourceLayerIndex:t.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,c.dynamicFilter)(n,i,this.retainedQueryData[o.bucketInstanceId].tileID.canonical,new t.pointGeometry(e.tileAnchorX,e.tileAnchorY),this.transform.calculateDistanceTileData(c.unwrappedTileID)))return this.placements[e.crossTileID]=new ve(!1,!1,!1,!0),void(r[e.crossTileID]=!0)}if(r[e.crossTileID])return;if(p)return void(this.placements[e.crossTileID]=new ve(!1,!1,!1));let S=!1,C=!1,M=!0,A=!1,P=!1,k=null,L={box:null,offscreen:null,occluded:null},z={box:null,offscreen:null,occluded:null},D=null,R=null,O=null,N=0,F=0,B=0;f.textFeatureIndex?N=f.textFeatureIndex:e.useRuntimeCollisionCircles&&(N=e.featureIndex),f.verticalTextFeatureIndex&&(F=f.verticalTextFeatureIndex);const j=t=>{t.tileID=this.retainedQueryData[o.bucketInstanceId].tileID,(this.transform.elevation||t.elevation)&&(t.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[o.bucketInstanceId].tileID,t.tileAnchorX,t.tileAnchorY):0)},U=f.textBox;if(U){j(U);const r=r=>{let n=t.WritingMode.horizontal;if(o.allowVerticalPlacement&&!r&&this.prevPlacement){const t=this.prevPlacement.placedOrientations[e.crossTileID];t&&(this.placedOrientations[e.crossTileID]=t,n=t,this.markUsedOrientation(o,n,e))}return n},n=(r,n)=>{if(o.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&f.verticalTextBox){for(const e of o.writingModes)if(e===t.WritingMode.vertical?(L=n(),z=L):L=r(),L&&L.box&&L.box.length)break}else L=r()};if(s.get("text-variable-anchor")){let l=s.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[e.crossTileID]){const t=this.prevPlacement.variableOffsets[e.crossTileID];l.indexOf(t.anchor)>0&&(l=l.filter(e=>e!==t.anchor),l.unshift(t.anchor))}const u=(t,r,n)=>{const s=o.getSymbolInstanceTextSize(d,e,this.transform.zoom,i),u=(t.x2-t.x1)*s+2*t.padding,c=(t.y2-t.y1)*s+2*t.padding,p=E&&!x?r:null;p&&j(p);let f={box:[],offscreen:!1,occluded:!1};const y=v?2*l.length:l.length;for(let _=0;_<y;++_){const r=this.attemptAnchorPlacement(l[_%l.length],t,u,c,s,b,w,h,a,g,_>=l.length,e,i,o,n,p,d,m);if(r&&(f=r.placedGlyphBoxes,f&&f.box&&f.box.length)){S=!0,k=r.shift;break}}return f};n(()=>u(U,f.iconBox,t.WritingMode.horizontal),()=>{const r=f.verticalTextBox;return r&&j(r),o.allowVerticalPlacement&&!(L&&L.box&&L.box.length)&&e.numVerticalGlyphVertices>0&&r?u(r,f.verticalIconBox,t.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),L&&(S=L.box,M=L.offscreen,A=L.occluded);const c=r(L&&L.box);if(!S&&this.prevPlacement){const t=this.prevPlacement.variableOffsets[e.crossTileID];t&&(this.variableOffsets[e.crossTileID]=t,this.markUsedJustification(o,t.anchor,e,c))}}else{const s=(r,n)=>{const s=o.getSymbolInstanceTextSize(d,e,this.transform.zoom,i),l=this.collisionIndex.placeCollisionBox(s,r,new t.pointGeometry(0,0),v,h,a,g.predicate);return l&&l.box&&l.box.length&&(this.markUsedOrientation(o,n,e),this.placedOrientations[e.crossTileID]=n),l};n(()=>s(U,t.WritingMode.horizontal),()=>{const r=f.verticalTextBox;return o.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&r?(j(r),s(r,t.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),r(L&&L.box&&L.box.length)}}if(D=L,S=D&&D.box&&D.box.length>0,M=D&&D.offscreen,A=D&&D.occluded,e.useRuntimeCollisionCircles){const r=o.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex>=0?e.centerJustifiedTextSymbolIndex:e.verticalPlacedTextSymbolIndex),i=t.evaluateSizeForFeature(o.textSizeData,d,r),c=s.get("text-padding");R=this.collisionIndex.placeCollisionCircles(v,r,o.lineVertexArray,o.glyphOffsetArray,i,a,l,u,n,w,g.predicate,e.collisionCircleDiameter*i/t.ONE_EM,c,this.retainedQueryData[o.bucketInstanceId].tileID),S=v||R.circles.length>0&&!R.collisionDetected,M=M&&R.offscreen,A=R.occluded}if(f.iconFeatureIndex&&(B=f.iconFeatureIndex),f.iconBox){const e=e=>{j(e);const r=E&&k?Se(k.x,k.y,b,w,this.transform.angle):new t.pointGeometry(0,0),n=o.getSymbolInstanceIconSize(m,this.transform.zoom,i);return this.collisionIndex.placeCollisionBox(n,e,r,x,h,a,g.predicate)};z&&z.box&&z.box.length&&f.verticalIconBox?(O=e(f.verticalIconBox),C=O.box.length>0):(O=e(f.iconBox),C=O.box.length>0),M=M&&O.offscreen,P=O.occluded}const V=y||0===e.numHorizontalGlyphVertices&&0===e.numVerticalGlyphVertices,G=_||0===e.numIconVertices;if(V||G?G?V||(C=C&&S):S=C&&S:C=S=C&&S,S&&D&&D.box&&this.collisionIndex.insertCollisionBox(D.box,s.get("text-ignore-placement"),o.bucketInstanceId,z&&z.box&&F?F:N,g.ID),C&&O&&this.collisionIndex.insertCollisionBox(O.box,s.get("icon-ignore-placement"),o.bucketInstanceId,B,g.ID),R&&(S&&this.collisionIndex.insertCollisionCircles(R.circles,s.get("text-ignore-placement"),o.bucketInstanceId,N,g.ID),n)){const t=o.bucketInstanceId;let e=this.collisionCircleArrays[t];void 0===e&&(e=this.collisionCircleArrays[t]=new xe);for(let r=0;r<R.circles.length;r+=4)e.circles.push(R.circles[r+0]),e.circles.push(R.circles[r+1]),e.circles.push(R.circles[r+2]),e.circles.push(R.collisionDetected?1:0)}const q="globe"!==this.transform.projection.name;I=I&&(q||!A),T=T&&(q||!P),this.placements[e.crossTileID]=new ve(S||I,C||T,M||o.justReloaded),r[e.crossTileID]=!0};if(S){const t=o.getSortedSymbolIndexes(this.transform.angle);for(let e=t.length-1;e>=0;--e){const r=t[e];C(o.symbolInstances.get(r),r,o.collisionArrays[r])}}else for(let t=e.symbolInstanceStart;t<e.symbolInstanceEnd;t++)C(o.symbolInstances.get(t),t,o.collisionArrays[t]);if(n&&o.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[o.bucketInstanceId];t.invert(e.invProjMatrix,a),e.viewportMatrix=this.collisionIndex.getViewportMatrix()}o.justReloaded=!1}markUsedJustification(e,r,n,i){let o;o=i===t.WritingMode.vertical?n.verticalPlacedTextSymbolIndex:{left:n.leftJustifiedTextSymbolIndex,center:n.centerJustifiedTextSymbolIndex,right:n.rightJustifiedTextSymbolIndex}[t.getAnchorJustification(r)];const s=[n.leftJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.rightJustifiedTextSymbolIndex,n.verticalPlacedTextSymbolIndex];for(const t of s)t>=0&&(e.text.placedSymbolArray.get(t).crossTileID=o>=0&&t!==o?0:n.crossTileID)}markUsedOrientation(e,r,n){const i=r===t.WritingMode.horizontal||r===t.WritingMode.horizontalOnly?r:0,o=r===t.WritingMode.vertical?r:0,s=[n.leftJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.rightJustifiedTextSymbolIndex];for(const t of s)e.text.placedSymbolArray.get(t).placedOrientation=i;n.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(n.verticalPlacedTextSymbolIndex).placedOrientation=o)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const e=this.prevPlacement;let r=!1;this.prevZoomAdjustment=e?e.zoomAdjustment(this.transform.zoom):0;const n=e?e.symbolFadeChange(t):1,i=e?e.opacities:{},o=e?e.variableOffsets:{},s=e?e.placedOrientations:{};for(const a in this.placements){const t=this.placements[a],e=i[a];e?(this.opacities[a]=new _e(e,n,t.text,t.icon,null,t.clipped),r=r||t.text!==e.text.placed||t.icon!==e.icon.placed):(this.opacities[a]=new _e(null,n,t.text,t.icon,t.skipFade,t.clipped),r=r||t.text||t.icon)}for(const a in i){const t=i[a];if(!this.opacities[a]){const e=new _e(t,n,!1,!1);e.isHidden()||(this.opacities[a]=e,r=r||t.text.placed||t.icon.placed)}}for(const a in o)this.variableOffsets[a]||!this.opacities[a]||this.opacities[a].isHidden()||(this.variableOffsets[a]=o[a]);for(const a in s)this.placedOrientations[a]||!this.opacities[a]||this.opacities[a].isHidden()||(this.placedOrientations[a]=s[a]);r?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)}updateLayerOpacities(t,e){const r={};for(const n of e){const e=n.getBucket(t);e&&n.latestFeatureIndex&&t.id===e.layerIds[0]&&this.updateBucketOpacities(e,r,n.collisionBoxArray)}}updateBucketOpacities(e,r,n){e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const i=e.layers[0].layout,o=!!e.layers[0].dynamicFilter(),s=new _e(null,0,!1,!1,!0),a=i.get("text-allow-overlap"),l=i.get("icon-allow-overlap"),u=i.get("text-variable-anchor"),c="map"===i.get("text-rotation-alignment"),h="map"===i.get("text-pitch-alignment"),p="none"!==i.get("icon-text-fit"),f=new _e(null,0,a&&(l||!e.hasIconData()||i.get("icon-optional")),l&&(a||!e.hasTextData()||i.get("text-optional")),!0);!e.collisionArrays&&n&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(n);const d=(t,e,r)=>{for(let n=0;n<e/4;n++)t.opacityVertexArray.emplaceBack(r)};let m=0;for(let g=0;g<e.symbolInstances.length;g++){const n=e.symbolInstances.get(g),{numHorizontalGlyphVertices:i,numVerticalGlyphVertices:a,crossTileID:l}=n;let y=this.opacities[l];r[l]?y=s:y||(y=f,this.opacities[l]=y),r[l]=!0;const _=i>0||a>0,v=n.numIconVertices>0,x=this.placedOrientations[n.crossTileID],b=x===t.WritingMode.vertical,w=x===t.WritingMode.horizontal||x===t.WritingMode.horizontalOnly;if(!_&&!v||y.isHidden()||m++,_){const t=De(y.text);d(e.text,i,b?Re:t),d(e.text,a,w?Re:t);const r=y.text.isHidden();[n.rightJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.leftJustifiedTextSymbolIndex].forEach(t=>{t>=0&&(e.text.placedSymbolArray.get(t).hidden=r||b?1:0)}),n.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(n.verticalPlacedTextSymbolIndex).hidden=r||w?1:0);const o=this.variableOffsets[n.crossTileID];o&&this.markUsedJustification(e,o.anchor,n,x);const s=this.placedOrientations[n.crossTileID];s&&(this.markUsedJustification(e,"left",n,s),this.markUsedOrientation(e,s,n))}if(v){const t=De(y.icon);n.placedIconSymbolIndex>=0&&(d(e.icon,n.numIconVertices,b?Re:t),e.icon.placedSymbolArray.get(n.placedIconSymbolIndex).hidden=y.icon.isHidden()),n.verticalPlacedIconSymbolIndex>=0&&(d(e.icon,n.numVerticalIconVertices,w?Re:t),e.icon.placedSymbolArray.get(n.verticalPlacedIconSymbolIndex).hidden=y.icon.isHidden())}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const r=e.collisionArrays[g];if(r){let n=new t.pointGeometry(0,0),i=!0;if(r.textBox||r.verticalTextBox){if(u){const t=this.variableOffsets[l];t?(n=Ee(t.anchor,t.width,t.height,t.textOffset,t.textScale),c&&n._rotate(h?this.transform.angle:-this.transform.angle)):i=!1}o&&(i=!y.clipped),r.textBox&&Te(e.textCollisionBox.collisionVertexArray,y.text.placed,!i||b,n.x,n.y),r.verticalTextBox&&Te(e.textCollisionBox.collisionVertexArray,y.text.placed,!i||w,n.x,n.y)}const s=i&&Boolean(!w&&r.verticalIconBox);r.iconBox&&Te(e.iconCollisionBox.collisionVertexArray,y.icon.placed,s,p?n.x:0,p?n.y:0),r.verticalIconBox&&Te(e.iconCollisionBox.collisionVertexArray,y.icon.placed,!s,p?n.x:0,p?n.y:0)}}}if(e.fullyClipped=0===m,e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=t.invProjMatrix,e.placementViewportMatrix=t.viewportMatrix,e.collisionCircleArray=t.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,e){const r=this.zoomAtLastRecencyCheck===e?1-this.zoomAdjustment(e):1;return this.zoomAtLastRecencyCheck=e,this.commitTime+this.fadeDuration*r>t}setStale(){this.stale=!0}}function Te(t,e,r,n,i){t.emplaceBack(e?1:0,r?1:0,n||0,i||0),t.emplaceBack(e?1:0,r?1:0,n||0,i||0),t.emplaceBack(e?1:0,r?1:0,n||0,i||0),t.emplaceBack(e?1:0,r?1:0,n||0,i||0)}const Ce=Math.pow(2,25),Me=Math.pow(2,24),Ae=Math.pow(2,17),Pe=Math.pow(2,16),ke=Math.pow(2,9),Le=Math.pow(2,8),ze=Math.pow(2,1);function De(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;const e=t.placed?1:0,r=Math.floor(127*t.opacity);return r*Ce+e*Me+r*Ae+e*Pe+r*ke+e*Le+r*ze+e}const Re=0;class Oe{constructor(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,e,r,n,i){const o=this._bucketParts;for(;this._currentTileIndex<t.length;)if(e.getBucketParts(o,n,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,i())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort((t,e)=>t.sortKey-e.sortKey));this._currentPartIndex<o.length;){const t=o[this._currentPartIndex];if(e.placeLayerBucketPart(t,this._seenCrossTileIDs,r,0===t.symbolInstanceStart),this._currentPartIndex++,i())return!0}return!1}}class Ne{constructor(t,e,r,n,i,o,s,a){this.placement=new Ie(t,i,o,s,a),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=r,this._showCollisionBoxes=n,this._done=!1}isDone(){return this._done}continuePlacement(e,r,n){const i=t.exported.now(),o=()=>{const e=t.exported.now()-i;return!this._forceFullPlacement&&e>2};for(;this._currentPlacementIndex>=0;){const t=r[e[this._currentPlacementIndex]],i=this.placement.collisionIndex.transform.zoom;if("symbol"===t.type&&(!t.minzoom||t.minzoom<=i)&&(!t.maxzoom||t.maxzoom>i)){if(this._inProgressLayer||(this._inProgressLayer=new Oe(t)),this._inProgressLayer.continuePlacement(n[t.source],this.placement,this._showCollisionBoxes,t,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Fe=512/t.EXTENT/2;class Be{constructor(t,e,r){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=r;for(let n=0;n<e.length;n++){const r=e.get(n),i=r.key;this.indexedSymbolInstances[i]||(this.indexedSymbolInstances[i]=[]),this.indexedSymbolInstances[i].push({crossTileID:r.crossTileID,coord:this.getScaledCoordinates(r,t)})}}getScaledCoordinates(e,r){const n=Fe/Math.pow(2,r.canonical.z-this.tileID.canonical.z);return{x:Math.floor((r.canonical.x*t.EXTENT+e.tileAnchorX)*n),y:Math.floor((r.canonical.y*t.EXTENT+e.tileAnchorY)*n)}}findMatches(t,e,r){const n=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z);for(let i=0;i<t.length;i++){const o=t.get(i);if(o.crossTileID)continue;const s=this.indexedSymbolInstances[o.key];if(!s)continue;const a=this.getScaledCoordinates(o,e);for(const t of s)if(Math.abs(t.coord.x-a.x)<=n&&Math.abs(t.coord.y-a.y)<=n&&!r[t.crossTileID]){r[t.crossTileID]=!0,o.crossTileID=t.crossTileID;break}}}}class je{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ue{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const e=Math.round((t-this.lng)/360);if(0!==e)for(const r in this.indexes){const t=this.indexes[r],n={};for(const r in t){const i=t[r];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+e),n[i.tileID.key]=i}this.indexes[r]=n}this.lng=t}addBucket(t,e,r){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let i=0;i<e.symbolInstances.length;i++)e.symbolInstances.get(i).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const n=this.usedCrossTileIDs[t.overscaledZ];for(const i in this.indexes){const r=this.indexes[i];if(Number(i)>t.overscaledZ)for(const i in r){const o=r[i];o.tileID.isChildOf(t)&&o.findMatches(e.symbolInstances,t,n)}else{const o=r[t.scaledTo(Number(i)).key];o&&o.findMatches(e.symbolInstances,t,n)}}for(let i=0;i<e.symbolInstances.length;i++){const t=e.symbolInstances.get(i);t.crossTileID||(t.crossTileID=r.generate(),n[t.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Be(t,e.symbolInstances,e.bucketInstanceId),!0}removeBucketCrossTileIDs(t,e){for(const r in e.indexedSymbolInstances)for(const n of e.indexedSymbolInstances[r])delete this.usedCrossTileIDs[t][n.crossTileID]}removeStaleBuckets(t){let e=!1;for(const r in this.indexes){const n=this.indexes[r];for(const i in n)t[n[i].bucketInstanceId]||(this.removeBucketCrossTileIDs(r,n[i]),delete n[i],e=!0)}return e}}class Ve{constructor(){this.layerIndexes={},this.crossTileIDs=new je,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,e,r,n){let i=this.layerIndexes[t.id];void 0===i&&(i=this.layerIndexes[t.id]=new Ue);let o=!1;const s={};"globe"!==n.name&&i.handleWrapJump(r);for(const a of e){const e=a.getBucket(t);e&&t.id===e.layerIds[0]&&(e.bucketInstanceId||(e.bucketInstanceId=++this.maxBucketInstanceId),i.addBucket(a.tileID,e,this.crossTileIDs)&&(o=!0),s[e.bucketInstanceId]=!0)}return i.removeStaleBuckets(s)&&(o=!0),o}pruneUnusedLayers(t){const e={};t.forEach(t=>{e[t]=!0});for(const r in this.layerIndexes)e[r]||delete this.layerIndexes[r]}}const Ge=(e,r)=>t.emitValidationErrors(e,r&&r.filter(t=>"source.canvas"!==t.identifier)),qe=t.pick(Vt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),$e=t.pick(Vt,["setCenter","setZoom","setBearing","setPitch"]),Ze=function(){const e={},r=t.spec.$version;for(const n in t.spec.$root){const i=t.spec.$root[n];if(i.required){let t=null;t="version"===n?r:"array"===i.type?[]:{},null!=t&&(e[n]=t)}}return e}(),Xe={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class We extends t.Evented{constructor(e,r={}){super(),this.map=e,this.dispatcher=new L(Bt(),this),this.imageManager=new x,this.imageManager.setEventedParent(this),this.glyphManager=new t.GlyphManager(e._requestManager,r.localFontFamily?t.LocalGlyphMode.all:r.localIdeographFontFamily?t.LocalGlyphMode.ideographs:t.LocalGlyphMode.none,r.localFontFamily||r.localIdeographFontFamily),this.lineAtlas=new t.LineAtlas(256,512),this.crossTileSymbolIndex=new Ve,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new t.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",t.getReferrer());const n=this;this._rtlTextPluginCallback=We.registerForPluginStateChange(e=>{n.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:e.pluginStatus,pluginURL:e.pluginURL},(e,r)=>{if(t.triggerPluginCompletionEvent(e),r&&r.every(t=>t))for(const t in n._sourceCaches){const e=n._sourceCaches[t],r=e.getSource().type;"vector"!==r&&"geojson"!==r||e.reload()}})}),this.on("data",t=>{if("source"!==t.dataType||"metadata"!==t.sourceDataType)return;const e=this.getSource(t.sourceId);if(e&&e.vectorLayerIds)for(const r in this._layers){const t=this._layers[r];t.source===e.id&&this._validateLayer(t)}})}loadURL(e,r={}){this.fire(new t.Event("dataloading",{dataType:"style"}));const n="boolean"==typeof r.validate?r.validate:!t.isMapboxURL(e);e=this.map._requestManager.normalizeStyleURL(e,r.accessToken);const i=this.map._requestManager.transformRequest(e,t.ResourceType.Style);this._request=t.getJSON(i,(e,r)=>{this._request=null,e?this.fire(new t.ErrorEvent(e)):r&&this._load(r,n)})}loadJSON(e,r={}){this.fire(new t.Event("dataloading",{dataType:"style"})),this._request=t.exported.frame(()=>{this._request=null,this._load(e,!1!==r.validate)})}loadEmpty(){this.fire(new t.Event("dataloading",{dataType:"style"})),this._load(Ze,!1)}_updateLayerCount(t,e){const r=e?1:-1;t.is3D()&&(this._num3DLayers+=r),"circle"===t.type&&(this._numCircleLayers+=r),"symbol"===t.type&&(this._numSymbolLayers+=r)}_load(e,r){if(r&&Ge(this,t.validateStyle(e)))return;this._loaded=!0,this.stylesheet=e,this.updateProjection();for(const t in e.sources)this.addSource(t,e.sources[t],{validate:!1});this._changed=!1,e.sprite?this._loadSprite(e.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(e.glyphs);const n=Ut(this.stylesheet.layers);this._order=n.map(t=>t.id),this._layers={},this._serializedLayers={};for(let i of n)i=t.createStyleLayer(i),i.setEventedParent(this,{layer:{id:i.id}}),this._layers[i.id]=i,this._serializedLayers[i.id]=i.serialize(),this._updateLayerCount(i,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new E(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new t.Event("data",{dataType:"style"})),this.fire(new t.Event("style.load"))}terrainSetForDrapingOnly(){return this.terrain&&0===this.terrain.drapeRenderMode}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.updateProjection()}updateProjection(){const t=this.map.transform.projection,e=this.map.transform.setProjection(this.map._runtimeProjection||(this.stylesheet?this.stylesheet.projection:void 0)),r=this.map.transform.projection;if(this._loaded&&(r.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null)),this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),e){if(r.isReprojectedInTileSpace||t.isReprojectedInTileSpace||("globe"===r.name||"globe"===t.name)&&!this.map._transitionFromGlobe){this.map.painter.clearBackgroundTiles();for(const t in this._sourceCaches)this._sourceCaches[t].clearTiles()}else this._forceSymbolLayerUpdate();this.map._update(!0)}}_loadSprite(e){this._spriteRequest=function(e,r,n){let i,o,s;const a=t.exported.devicePixelRatio>1?"@2x":"";let l=t.getJSON(r.transformRequest(r.normalizeSpriteURL(e,a,".json"),t.ResourceType.SpriteJSON),(t,e)=>{l=null,s||(s=t,i=e,c())}),u=t.getImage(r.transformRequest(r.normalizeSpriteURL(e,a,".png"),t.ResourceType.SpriteImage),(t,e)=>{u=null,s||(s=t,o=e,c())});function c(){if(s)n(s);else if(i&&o){const e=t.exported.getImageData(o),r={};for(const n in i){const{width:o,height:s,x:a,y:l,sdf:u,pixelRatio:c,stretchX:h,stretchY:p,content:f}=i[n],d=new t.RGBAImage({width:o,height:s});t.RGBAImage.copy(e,d,{x:a,y:l},{x:0,y:0},{width:o,height:s}),r[n]={data:d,pixelRatio:c,sdf:u,stretchX:h,stretchY:p,content:f}}n(null,r)}}return{cancel(){l&&(l.cancel(),l=null),u&&(u.cancel(),u=null)}}}(e,this.map._requestManager,(e,r)=>{if(this._spriteRequest=null,e)this.fire(new t.ErrorEvent(e));else if(r)for(const t in r)this.imageManager.addImage(t,r[t]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new t.Event("data",{dataType:"style"}))})}_validateLayer(e){const r=this.getSource(e.source);if(!r)return;const n=e.sourceLayer;n&&("geojson"===r.type||r.vectorLayerIds&&-1===r.vectorLayerIds.indexOf(n))&&this.fire(new t.ErrorEvent(new Error(`Source layer "${n}" does not exist on source "${r.id}" as specified by style layer "${e.id}"`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const e=[];for(const r of t){const t=this._layers[r];"custom"!==t.type&&e.push(t.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;if(this.fog&&this.fog.hasTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(t){return!!this.terrain&&Xe[t.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(e){if(!this._loaded)return;const r=this._changed;if(this._changed){const t=Object.keys(this._updatedLayers),r=Object.keys(this._removedLayers);(t.length||r.length)&&this._updateWorkerLayers(t,r);for(const e in this._updatedSources){const t=this._updatedSources[e];"reload"===t?this._reloadSource(e):"clear"===t&&this._clearSource(e)}this._updateTilesForChangedImages();for(const n in this._updatedPaintProps)this._layers[n].updateTransitions(e);this.light.updateTransitions(e),this.fog&&this.fog.updateTransitions(e),this._resetUpdates()}const n={};for(const t in this._sourceCaches){const e=this._sourceCaches[t];n[t]=e.used,e.used=!1}for(const t of this._order){const r=this._layers[t];if(r.recalculate(e,this._availableImages),!r.isHidden(e.zoom)){const t=this._getLayerSourceCache(r);t&&(t.used=!0)}const n=this.map.painter;if(n){const t=r.getProgramIds();if(!t)continue;const i=r.getProgramConfiguration(e.zoom);for(const e of t)n.useProgram(e,i)}}for(const i in n){const e=this._sourceCaches[i];n[i]!==e.used&&e.getSource().fire(new t.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:e.getSource().id}))}this.light.recalculate(e),this.terrain&&this.terrain.recalculate(e),this.fog&&this.fog.recalculate(e),this.z=e.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),r&&this.fire(new t.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const e in this._sourceCaches)this._sourceCaches[e].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,e){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(e){if(this._checkLoaded(),Ge(this,t.validateStyle(e)))return!1;(e=t.clone$1(e)).layers=Ut(e.layers);const r=function(t,e){if(!t)return[{command:Vt.setStyle,args:[e]}];let r=[];try{if(!i(t.version,e.version))return[{command:Vt.setStyle,args:[e]}];i(t.center,e.center)||r.push({command:Vt.setCenter,args:[e.center]}),i(t.zoom,e.zoom)||r.push({command:Vt.setZoom,args:[e.zoom]}),i(t.bearing,e.bearing)||r.push({command:Vt.setBearing,args:[e.bearing]}),i(t.pitch,e.pitch)||r.push({command:Vt.setPitch,args:[e.pitch]}),i(t.sprite,e.sprite)||r.push({command:Vt.setSprite,args:[e.sprite]}),i(t.glyphs,e.glyphs)||r.push({command:Vt.setGlyphs,args:[e.glyphs]}),i(t.transition,e.transition)||r.push({command:Vt.setTransition,args:[e.transition]}),i(t.light,e.light)||r.push({command:Vt.setLight,args:[e.light]}),i(t.fog,e.fog)||r.push({command:Vt.setFog,args:[e.fog]}),i(t.projection,e.projection)||r.push({command:Vt.setProjection,args:[e.projection]});const n={},o=[];!function(t,e,r,n){let o;for(o in e=e||{},t=t||{})t.hasOwnProperty(o)&&(e.hasOwnProperty(o)||qt(o,r,n));for(o in e)e.hasOwnProperty(o)&&(t.hasOwnProperty(o)?i(t[o],e[o])||("geojson"===t[o].type&&"geojson"===e[o].type&&Zt(t,e,o)?r.push({command:Vt.setGeoJSONSourceData,args:[o,e[o].data]}):$t(o,e,r,n)):Gt(o,e,r))}(t.sources,e.sources,o,n);const s=[];t.layers&&t.layers.forEach(t=>{n[t.source]?r.push({command:Vt.removeLayer,args:[t.id]}):s.push(t)});let a=t.terrain;a&&n[a.source]&&(r.push({command:Vt.setTerrain,args:[void 0]}),a=void 0),r=r.concat(o),i(a,e.terrain)||r.push({command:Vt.setTerrain,args:[e.terrain]}),function(t,e,r){e=e||[];const n=(t=t||[]).map(Wt),o=e.map(Wt),s=t.reduce(Yt,{}),a=e.reduce(Yt,{}),l=n.slice(),u=Object.create(null);let c,h,p,f,d,m,g;for(c=0,h=0;c<n.length;c++)p=n[c],a.hasOwnProperty(p)?h++:(r.push({command:Vt.removeLayer,args:[p]}),l.splice(l.indexOf(p,h),1));for(c=0,h=0;c<o.length;c++)p=o[o.length-1-c],l[l.length-1-c]!==p&&(s.hasOwnProperty(p)?(r.push({command:Vt.removeLayer,args:[p]}),l.splice(l.lastIndexOf(p,l.length-h),1)):h++,m=l[l.length-c],r.push({command:Vt.addLayer,args:[a[p],m]}),l.splice(l.length-c,0,p),u[p]=!0);for(c=0;c<o.length;c++)if(p=o[c],f=s[p],d=a[p],!u[p]&&!i(f,d))if(i(f.source,d.source)&&i(f["source-layer"],d["source-layer"])&&i(f.type,d.type)){for(g in Xt(f.layout,d.layout,r,p,null,Vt.setLayoutProperty),Xt(f.paint,d.paint,r,p,null,Vt.setPaintProperty),i(f.filter,d.filter)||r.push({command:Vt.setFilter,args:[p,d.filter]}),i(f.minzoom,d.minzoom)&&i(f.maxzoom,d.maxzoom)||r.push({command:Vt.setLayerZoomRange,args:[p,d.minzoom,d.maxzoom]}),f)f.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&(0===g.indexOf("paint.")?Xt(f[g],d[g],r,p,g.slice(6),Vt.setPaintProperty):i(f[g],d[g])||r.push({command:Vt.setLayerProperty,args:[p,g,d[g]]}));for(g in d)d.hasOwnProperty(g)&&!f.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&(0===g.indexOf("paint.")?Xt(f[g],d[g],r,p,g.slice(6),Vt.setPaintProperty):i(f[g],d[g])||r.push({command:Vt.setLayerProperty,args:[p,g,d[g]]}))}else r.push({command:Vt.removeLayer,args:[p]}),m=l[l.lastIndexOf(p)+1],r.push({command:Vt.addLayer,args:[d,m]})}(s,e.layers,r)}catch(t){console.warn("Unable to compute style diff:",t),r=[{command:Vt.setStyle,args:[e]}]}return r}(this.serialize(),e).filter(t=>!(t.command in $e));if(0===r.length)return!1;const n=r.filter(t=>!(t.command in qe));if(n.length>0)throw new Error(`Unimplemented: ${n.map(t=>t.command).join(", ")}.`);return r.forEach(t=>{"setTransition"!==t.command&&this[t.command].apply(this,t.args)}),this.stylesheet=e,this.updateProjection(),!0}addImage(e,r){if(this.getImage(e))return this.fire(new t.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(e,r),this._afterImageUpdated(e)}updateImage(t,e){this.imageManager.updateImage(t,e)}getImage(t){return this.imageManager.getImage(t)}removeImage(e){if(!this.getImage(e))return this.fire(new t.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new t.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(e,r,n={}){if(this._checkLoaded(),void 0!==this.getSource(e))throw new Error("There is already a source with this ID");if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(t.validateStyle.source,`sources.${e}`,r,null,n))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const i=Pt(e,r,this.dispatcher,this);i.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(e),source:i.serialize(),sourceId:e}));const o=r=>{const n=(r?"symbol:":"other:")+e,o=this._sourceCaches[n]=new t.SourceCache(n,i,r);(r?this._symbolSourceCaches:this._otherSourceCaches)[e]=o,o.style=this,o.onAdd(this.map)};o(!1),"vector"!==r.type&&"geojson"!==r.type||o(!0),i.onAdd&&i.onAdd(this.map),this._changed=!0}removeSource(e){this._checkLoaded();const r=this.getSource(e);if(void 0===r)throw new Error("There is no source with this ID");for(const i in this._layers)if(this._layers[i].source===e)return this.fire(new t.ErrorEvent(new Error(`Source "${e}" cannot be removed while layer "${i}" is using it.`)));if(this.terrain&&this.terrain.get().source===e)return this.fire(new t.ErrorEvent(new Error(`Source "${e}" cannot be removed while terrain is using it.`)));const n=this._getSourceCaches(e);for(const i of n)delete this._sourceCaches[i.id],delete this._updatedSources[i.id],i.fire(new t.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:i.getSource().id})),i.setEventedParent(null),i.clearTiles();delete this._otherSourceCaches[e],delete this._symbolSourceCaches[e],r.setEventedParent(null),r.onRemove&&r.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,e){this._checkLoaded(),this.getSource(t).setData(e),this._changed=!0}getSource(t){const e=this._getSourceCache(t);return e&&e.getSource()}addLayer(e,r,n={}){this._checkLoaded();const i=e.id;if(this.getLayer(i))return void this.fire(new t.ErrorEvent(new Error(`Layer with id "${i}" already exists on this map`)));let o;if("custom"===e.type){if(Ge(this,t.validateCustomStyleLayer(e)))return;o=t.createStyleLayer(e)}else{if("object"==typeof e.source&&(this.addSource(i,e.source),e=t.clone$1(e),e=t.extend(e,{source:i})),this._validate(t.validateStyle.layer,`layers.${i}`,e,{arrayIndex:-1},n))return;o=t.createStyleLayer(e),this._validateLayer(o),o.setEventedParent(this,{layer:{id:i}}),this._serializedLayers[o.id]=o.serialize(),this._updateLayerCount(o,!0)}const s=r?this._order.indexOf(r):this._order.length;if(r&&-1===s)return void this.fire(new t.ErrorEvent(new Error(`Layer with id "${r}" does not exist on this map.`)));this._order.splice(s,0,i),this._layerOrderChanged=!0,this._layers[i]=o;const a=this._getLayerSourceCache(o);if(this._removedLayers[i]&&o.source&&a&&"custom"!==o.type){const t=this._removedLayers[i];delete this._removedLayers[i],t.type!==o.type?this._updatedSources[o.source]="clear":(this._updatedSources[o.source]="reload",a.pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(e,r){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===r)return;const n=this._order.indexOf(e);this._order.splice(n,1);const i=r?this._order.indexOf(r):this._order.length;r&&-1===i?this.fire(new t.ErrorEvent(new Error(`Layer with id "${r}" does not exist on this map.`))):(this._order.splice(i,0,e),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(e){this._checkLoaded();const r=this._layers[e];if(!r)return void this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be removed.`)));r.setEventedParent(null),this._updateLayerCount(r,!1);const n=this._order.indexOf(e);this._order.splice(n,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=r,delete this._layers[e],delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],r.onRemove&&r.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}hasLayerType(t){for(const e in this._layers)if(this._layers[e].type===t)return!0;return!1}setLayerZoomRange(e,r,n){this._checkLoaded();const i=this.getLayer(e);i?i.minzoom===r&&i.maxzoom===n||(null!=r&&(i.minzoom=r),null!=n&&(i.maxzoom=n),this._updateLayer(i)):this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(e,r,n={}){this._checkLoaded();const o=this.getLayer(e);if(o){if(!i(o.filter,r))return null==r?(o.filter=void 0,void this._updateLayer(o)):void(this._validate(t.validateStyle.filter,`layers.${o.id}.filter`,r,{layerType:o.type},n)||(o.filter=t.clone$1(r),this._updateLayer(o)))}else this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be filtered.`)))}getFilter(e){return t.clone$1(this.getLayer(e).filter)}setLayoutProperty(e,r,n,o={}){this._checkLoaded();const s=this.getLayer(e);s?i(s.getLayoutProperty(r),n)||(s.setLayoutProperty(r,n,o),this._updateLayer(s)):this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(e,r){const n=this.getLayer(e);if(n)return n.getLayoutProperty(r);this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style.`)))}setPaintProperty(e,r,n,o={}){this._checkLoaded();const s=this.getLayer(e);s?i(s.getPaintProperty(r),n)||(s.setPaintProperty(r,n,o)&&this._updateLayer(s),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(t,e){return this.getLayer(t).getPaintProperty(e)}setFeatureState(e,r){this._checkLoaded();const n=e.source,i=e.sourceLayer,o=this.getSource(n);if(void 0===o)return void this.fire(new t.ErrorEvent(new Error(`The source '${n}' does not exist in the map's style.`)));const s=o.type;if("geojson"===s&&i)return void this.fire(new t.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===s&&!i)return void this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided.")));const a=this._getSourceCaches(n);for(const t of a)t.setFeatureState(i,e.id,r)}removeFeatureState(e,r){this._checkLoaded();const n=e.source,i=this.getSource(n);if(void 0===i)return void this.fire(new t.ErrorEvent(new Error(`The source '${n}' does not exist in the map's style.`)));const o=i.type,s="vector"===o?e.sourceLayer:void 0;if("vector"===o&&!s)return void this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(r&&"string"!=typeof e.id&&"number"!=typeof e.id)return void this.fire(new t.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const a=this._getSourceCaches(n);for(const t of a)t.removeFeatureState(s,e.id,r)}getFeatureState(e){this._checkLoaded();const r=e.source,n=e.sourceLayer,i=this.getSource(r);if(void 0!==i){if("vector"!==i.type||n)return void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(r)[0].getFeatureState(n,e.id);this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error(`The source '${r}' does not exist in the map's style.`)))}getTransition(){return t.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const e={};for(const t in this._sourceCaches){const r=this._sourceCaches[t].getSource();e[r.id]||(e[r.id]=r.serialize())}return t.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:e,layers:this._serializeLayers(this._order)},t=>void 0!==t)}_updateLayer(t){this._updatedLayers[t.id]=!0;const e=this._getLayerSourceCache(t);t.source&&!this._updatedSources[t.source]&&e&&"raster"!==e.getSource().type&&(this._updatedSources[t.source]="reload",e.pause()),this._changed=!0,t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const e=t=>"fill-extrusion"===this._layers[t].type,r={},n=[];for(let o=this._order.length-1;o>=0;o--){const i=this._order[o];if(e(i)){r[i]=o;for(const e of t){const t=e[i];if(t)for(const e of t)n.push(e)}}}n.sort((t,e)=>e.intersectionZ-t.intersectionZ);const i=[];for(let o=this._order.length-1;o>=0;o--){const s=this._order[o];if(e(s))for(let t=n.length-1;t>=0;t--){const e=n[t].feature;if(r[e.layer.id]<o)break;i.push(e),n.pop()}else for(const e of t){const t=e[s];if(t)for(const e of t)i.push(e.feature)}}return i}queryRenderedFeatures(e,r,n){r&&r.filter&&this._validate(t.validateStyle.filter,"queryRenderedFeatures.filter",r.filter,null,r);const i={};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new t.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const e of r.layers){const r=this._layers[e];if(!r)return this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be queried for features.`))),[];i[r.source]=!0}}const o=[];r.availableImages=this._availableImages;const s=r&&r.layers?r.layers.some(t=>{const e=this.getLayer(t);return e&&e.is3D()}):this.has3DLayers(),a=bt.createFromScreenPoints(e,n);for(const t in this._sourceCaches){const e=this._sourceCaches[t].getSource().id;r.layers&&!i[e]||o.push(Lt(this._sourceCaches[t],this._layers,this._serializedLayers,a,r,n,s,!!this.map._showQueryGeometry))}return this.placement&&o.push(function(t,e,r,n,i,o,s){const a={},l=o.queryRenderedSymbols(n),u=[];for(const c of Object.keys(l).map(Number))u.push(s[c]);u.sort(Dt);for(const c of u){const r=c.featureIndex.lookupSymbolFeatures(l[c.bucketInstanceId],e,c.bucketIndex,c.sourceLayerIndex,i.filter,i.layers,i.availableImages,t);for(const t in r){const e=a[t]=a[t]||[],n=r[t];n.sort((t,e)=>{const r=c.featureSortOrder;if(r){const n=r.indexOf(t.featureIndex);return r.indexOf(e.featureIndex)-n}return e.featureIndex-t.featureIndex});for(const t of n)e.push(t)}}for(const c in a)a[c].forEach(e=>{const n=e.feature,i=r(t[c]).getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=i});return a}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),a.screenGeometry,r,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(o)}querySourceFeatures(e,r){r&&r.filter&&this._validate(t.validateStyle.filter,"querySourceFeatures.filter",r.filter,null,r);const n=this._getSourceCaches(e);let i=[];for(const t of n)i=i.concat(zt(t,r));return i}addSourceType(t,e,r){return We.getSourceType(t)?r(new Error(`A source type called "${t}" already exists.`)):(We.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},r):r(null,null))}getLight(){return this.light.getLight()}setLight(e,r={}){this._checkLoaded();const n=this.light.getLight();let o=!1;for(const t in e)if(!i(e[t],n[t])){o=!0;break}if(!o)return;const s={now:t.exported.now(),transition:t.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,r),this.light.updateTransitions(s)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(e,r=1){if(this._checkLoaded(),!e)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===r){if("object"==typeof e.source){const r="terrain-dem-src";this.addSource(r,e.source),e=t.clone$1(e),e=t.extend(e,{source:r})}if(this._validate(t.validateStyle.terrain,"terrain",e))return}if(!this.terrain||this.terrain&&r!==this.terrain.drapeRenderMode)this._createTerrain(e,r);else{const r=this.terrain,n=r.get();for(const o in e)if(!i(e[o],n[o])){r.set(e),this.stylesheet.terrain=e;const n={now:t.exported.now(),transition:t.extend({duration:0},this.stylesheet.transition)};r.updateTransitions(n);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(e){const r=this.fog=new k(e,this.map.transform);this.stylesheet.fog=e;const n={now:t.exported.now(),transition:t.extend({duration:0},this.stylesheet.transition)};r.updateTransitions(n)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(e){if(this._checkLoaded(),!e)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const r=this.fog,n=r.get();for(const o in e)if(!i(e[o],n[o])){r.set(e),this.stylesheet.fog=e;const n={now:t.exported.now(),transition:t.extend({duration:0},this.stylesheet.transition)};r.updateTransitions(n);break}}else this._createFog(e);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const t=this._order.filter(t=>this.isLayerDraped(this._layers[t])),e=this._order.filter(t=>!this.isLayerDraped(this._layers[t]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...e)}_createTerrain(e,r){const n=this.terrain=new T(e,r);this.stylesheet.terrain=e,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const i={now:t.exported.now(),transition:t.extend({duration:0},this.stylesheet.transition)};n.updateTransitions(i)}_force3DLayerUpdate(){for(const t in this._layers){const e=this._layers[t];"fill-extrusion"===e.type&&this._updateLayer(e)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const e=this._layers[t];"symbol"===e.type&&this._updateLayer(e)}}_validate(e,r,n,i,o={}){return(!o||!1!==o.validate)&&Ge(this,e.call(t.validateStyle,t.extend({key:r,style:this.serialize(),value:n,styleSpec:t.spec},i)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this._sourceCaches)this._sourceCaches[t].clearTiles(),this._sourceCaches[t].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){const e=this._getSourceCaches(t);for(const r of e)r.clearTiles()}_reloadSource(t){const e=this._getSourceCaches(t);for(const r of e)r.resume(),r.reload()}_updateSources(t){for(const e in this._sourceCaches)this._sourceCaches[e].update(t)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const e=this._sourceCaches[t];e.resume(),e.reload()}}_updatePlacement(e,r,n,i,o=!1){let s=!1,a=!1;const l={};for(const t of this._order){const r=this._layers[t];if("symbol"!==r.type)continue;if(!l[r.source]){const t=this._getLayerSourceCache(r);if(!t)continue;l[r.source]=t.getRenderableIds(!0).map(e=>t.getTileByID(e)).sort((t,e)=>e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1))}const n=this.crossTileSymbolIndex.addLayer(r,l[r.source],e.center.lng,e.projection);s=s||n}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),o=o||this._layerOrderChanged||0===n,this._layerOrderChanged&&this.fire(new t.Event("neworder")),(o||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.exported.now(),e.zoom))&&(this.pauseablePlacement=new Ne(e,this._order,o,r,n,i,this.placement,this.fog&&e.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.exported.now()),a=!0),s&&this.pauseablePlacement.placement.setStale()),a||s)for(const t of this._order){const e=this._layers[t];"symbol"===e.type&&this.placement.updateLayerOpacities(e,l[e.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.exported.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,e,r){this.imageManager.getImages(e.icons,r),this._updateTilesForChangedImages();const n=t=>{t&&t.setDependencies(e.tileID.key,e.type,e.icons)};n(this._otherSourceCaches[e.source]),n(this._symbolSourceCaches[e.source])}getGlyphs(t,e,r){this.glyphManager.getGlyphs(e.stacks,r)}getResource(e,r,n){return t.makeRequest(r,n)}_getSourceCache(t){return this._otherSourceCaches[t]}_getLayerSourceCache(t){return"symbol"===t.type?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}_getSourceCaches(t){const e=[];return this._otherSourceCaches[t]&&e.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&e.push(this._symbolSourceCaches[t]),e}_isSourceCacheLoaded(e){const r=this._getSourceCaches(e);if(0!==r.length)return r.every(t=>t.loaded());this.fire(new t.ErrorEvent(new Error(`There is no source with ID '${e}'`)))}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}We.getSourceType=function(t){return At[t]},We.setSourceType=function(t,e){At[t]=e},We.registerForPluginStateChange=t.registerForPluginStateChange;var Ye="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",He="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let Je={},Ke={};Je=rr("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),Ke=rr("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const Qe=rr("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),tr=Ye;var er={background:rr("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:rr("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:rr("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\n#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)\nview_scale*=a_scale;\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:rr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:rr("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nextrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:rr("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:rr("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:rr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:rr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:rr("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:rr("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:rr("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:rr("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:rr("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:rr("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:rr("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:rr("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:rr("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:rr("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:rr("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:rr("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);\n#else\nvec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);\n#endif\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:rr("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);\n#else\nvec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);\n#endif\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:rr("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);\n#else\nvec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);\n#endif\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:rr("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:rr("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:rr("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",He),skyboxGradient:rr("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",He),skyboxCapture:rr("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:rr("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying vec2 v_pos0;const float wireframeOffset=1e3;void main() {v_pos0=a_uv;vec2 uv=a_uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nvec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}"),globeAtmosphere:rr("uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {highp vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)\ndiscard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}","attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}")};function rr(t,e,r){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,i=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,o=e.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),s=t.match(i),a=e.match(i),l=Ye.match(i);let u=a?a.concat(s):s;r||(Je.staticUniforms&&(u=Je.staticUniforms.concat(u)),Ke.staticUniforms&&(u=Ke.staticUniforms.concat(u))),u&&(u=u.concat(l));const c={};return{fragmentSource:t=t.replace(n,(t,e,r,n,i)=>(c[i]=!0,"define"===e?`\n#ifndef HAS_UNIFORM_u_${i}\nvarying ${r} ${n} ${i};\n#else\nuniform ${r} ${n} u_${i};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${i}\n    ${r} ${n} ${i} = u_${i};\n#endif\n`)),vertexSource:e=e.replace(n,(t,e,r,n,i)=>{const o="float"===n?"vec2":"vec4",s=i.match(/color/)?"color":o;return c[i]?"define"===e?`\n#ifndef HAS_UNIFORM_u_${i}\nuniform lowp float u_${i}_t;\nattribute ${r} ${o} a_${i};\nvarying ${r} ${n} ${i};\n#else\nuniform ${r} ${n} u_${i};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${i}\n    ${i} = a_${i};\n#else\n    ${r} ${n} ${i} = u_${i};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${i}\n    ${i} = unpack_mix_${s}(a_${i}, u_${i}_t);\n#else\n    ${r} ${n} ${i} = u_${i};\n#endif\n`:"define"===e?`\n#ifndef HAS_UNIFORM_u_${i}\nuniform lowp float u_${i}_t;\nattribute ${r} ${o} a_${i};\n#else\nuniform ${r} ${n} u_${i};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${i}\n    ${r} ${n} ${i} = a_${i};\n#else\n    ${r} ${n} ${i} = u_${i};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${i}\n    ${r} ${n} ${i} = unpack_mix_${s}(a_${i}, u_${i}_t);\n#else\n    ${r} ${n} ${i} = u_${i};\n#endif\n`}),staticAttributes:o,staticUniforms:u}}class nr{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,e,r,n,i,o,s,a){this.context=t;let l=this.boundPaintVertexBuffers.length!==n.length;for(let u=0;!l&&u<n.length;u++)this.boundPaintVertexBuffers[u]!==n[u]&&(l=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===e&&this.boundLayoutVertexBuffer===r&&!l&&this.boundIndexBuffer===i&&this.boundVertexOffset===o&&this.boundDynamicVertexBuffer===s&&this.boundDynamicVertexBuffer2===a?(t.bindVertexArrayOES.set(this.vao),s&&s.bind(),i&&i.dynamicDraw&&i.bind(),a&&a.bind()):this.freshBind(e,r,n,i,o,s,a)}freshBind(t,e,r,n,i,o,s){let a;const l=t.numAttributes,u=this.context,c=u.gl;if(u.extVertexArrayObject)this.vao&&this.destroy(),this.vao=u.extVertexArrayObject.createVertexArrayOES(),u.bindVertexArrayOES.set(this.vao),a=0,this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=r,this.boundIndexBuffer=n,this.boundVertexOffset=i,this.boundDynamicVertexBuffer=o,this.boundDynamicVertexBuffer2=s;else{a=u.currentNumAttributes||0;for(let t=l;t<a;t++)c.disableVertexAttribArray(t)}e.enableAttributes(c,t);for(const h of r)h.enableAttributes(c,t);o&&o.enableAttributes(c,t),s&&s.enableAttributes(c,t),e.bind(),e.setVertexAttribPointers(c,t,i);for(const h of r)h.bind(),h.setVertexAttribPointers(c,t,i);o&&(o.bind(),o.setVertexAttribPointers(c,t,i)),n&&n.bind(),s&&(s.bind(),s.setVertexAttribPointers(c,t,i)),u.currentNumAttributes=l}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function ir(e,r){const n=Math.pow(2,r.canonical.z),i=r.canonical.y;return[new t.MercatorCoordinate(0,i/n).toLngLat().lat,new t.MercatorCoordinate(0,(i+1)/n).toLngLat().lat]}function or(e,r,n,i,o,s,a){const l=e.context,u=l.gl,c=n.fbo;if(!c)return;e.prepareDrawTile();const h=e.useProgram("hillshade");l.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,c.colorAttachment.get());const p=((t,e,r,n)=>{const i=r.paint.get("hillshade-shadow-color"),o=r.paint.get("hillshade-highlight-color"),s=r.paint.get("hillshade-accent-color");let a=r.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===r.paint.get("hillshade-illumination-anchor")&&(a-=t.transform.angle);const l=!t.options.moving;return{u_matrix:n||t.transform.calculateProjMatrix(e.tileID.toUnwrapped(),l),u_image:0,u_latrange:ir(0,e.tileID),u_light:[r.paint.get("hillshade-exaggeration"),a],u_shadow:i,u_highlight:o,u_accent:s}})(e,n,i,e.terrain?r.projMatrix:null);e.prepareDrawProgram(l,h,r.toUnwrapped());const{tileBoundsBuffer:f,tileBoundsIndexBuffer:d,tileBoundsSegments:m}=e.getTileBoundsBuffers(n);h.draw(l,u.TRIANGLES,o,s,a,t.CullFaceMode.disabled,p,i.id,f,d,m)}function sr(e,r,n){if(!r.needsDEMTextureUpload)return;const i=e.context,o=i.gl;i.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||e.getTileTexture(n.stride);const s=n.getPixels();r.demTexture?r.demTexture.update(s,{premultiply:!1}):r.demTexture=new t.Texture(i,s,o.RGBA,{premultiply:!1}),r.needsDEMTextureUpload=!1}function ar(e,r,n,i,o,s){const a=e.context,l=a.gl;if(!r.dem)return;const u=r.dem;if(a.activeTexture.set(l.TEXTURE1),sr(e,r,u),!r.demTexture)return;r.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);const c=u.dim;a.activeTexture.set(l.TEXTURE0);let h=r.fbo;if(!h){const e=new t.Texture(a,{width:c,height:c,data:null},l.RGBA);e.bind(l.LINEAR,l.CLAMP_TO_EDGE),h=r.fbo=a.createFramebuffer(c,c,!0),h.colorAttachment.set(e.texture)}a.bindFramebuffer.set(h.framebuffer),a.viewport.set([0,0,c,c]);const{tileBoundsBuffer:p,tileBoundsIndexBuffer:f,tileBoundsSegments:d}=e.getMercatorTileBoundsBuffers();e.useProgram("hillshadePrepare").draw(a,l.TRIANGLES,i,o,s,t.CullFaceMode.disabled,((e,r)=>{const n=r.stride,i=t.create();return t.ortho(i,0,t.EXTENT,-t.EXTENT,0,0,1),t.translate(i,i,[0,-t.EXTENT,0]),{u_matrix:i,u_image:1,u_dimension:[n,n],u_zoom:e.overscaledZ,u_unpack:r.unpackVector}})(r.tileID,u),n.id,p,f,d),r.needsHillshadePrepare=!1}const lr=(e,r)=>({u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_image0:new t.Uniform1i(e,r.u_image0),u_skirt_height:new t.Uniform1f(e,r.u_skirt_height)}),ur=(t,e)=>({u_matrix:t,u_image0:0,u_skirt_height:e}),cr=(t,e,r,n,i)=>({u_proj_matrix:Float32Array.from(t),u_globe_matrix:e,u_merc_matrix:r,u_zoom_transition:n,u_merc_center:i,u_image0:0});function hr(t,e){return null!=t&&null!=e&&!(!t.hasData()||!e.hasData())&&null!=t.demTexture&&null!=e.demTexture&&t.tileID.key!==e.tileID.key}const pr=new class{constructor(){this.operations={}}newMorphing(t,e,r,n,i){if(t in this.operations){const e=this.operations[t];e.to.tileID.key!==r.tileID.key&&(e.queued=r)}else this.operations[t]={startTime:n,phase:0,duration:i,from:e,to:r,queued:null}}getMorphValuesForProxy(t){if(!(t in this.operations))return null;const e=this.operations[t];return{from:e.from,to:e.to,phase:e.phase}}update(t){for(const e in this.operations){const r=this.operations[e];for(r.phase=(t-r.startTime)/r.duration;r.phase>=1||!this._validOp(r);)if(!this._nextOp(r,t)){delete this.operations[e];break}}}_nextOp(t,e){return!!t.queued&&(t.from=t.to,t.to=t.queued,t.queued=null,t.phase=0,t.startTime=e,!0)}_validOp(t){return t.from.hasData()&&t.to.hasData()}},fr={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function dr(t,e){const r=1<<t.z;return!e&&(0===t.x||t.x===r-1)||0===t.y||t.y===r-1}const mr=t=>({u_matrix:t});function gr(e,r,n,i,o){if(o>0){const s=t.exported.now(),a=(s-e.timeAdded)/o,l=r?(s-r.timeAdded)/o:-1,u=n.getSource(),c=i.coveringZoomLevel({tileSize:u.tileSize,roundZoom:u.roundZoom}),h=!r||Math.abs(r.tileID.overscaledZ-c)>Math.abs(e.tileID.overscaledZ-c),p=h&&e.refreshedUponExpiration?1:t.clamp(h?a:1-l,0,1);return e.refreshedUponExpiration&&a>=1&&(e.refreshedUponExpiration=!1),r?{opacity:1,mix:1-p}:{opacity:p,mix:0}}return{opacity:1,mix:0}}class yr extends t.SourceCache{constructor(t){const e={type:"raster-dem",maxzoom:t.transform.maxZoom},r=new L(Bt(),null),n=Pt("mock-dem",e,r,t.style);super("mock-dem",n,!1),n.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,e){t.state="loaded",e(null)}}class _r extends t.SourceCache{constructor(t){const e=Pt("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new L(Bt(),null),t.style);super("proxy",e,!1),e.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(e,r,n){if(e.freezeTileCoverage)return;this.transform=e;const i=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((r,n)=>{if(r[n.key]="",!this._tiles[n.key]){const r=new t.Tile(n,this._source.tileSize*n.overscaleFactor(),e.tileZoom);r.state="loaded",this._tiles[n.key]=r}return r},{});for(const t in this._tiles)t in i||(this.freeFBO(t),this._tiles[t].unloadVectorData(),delete this._tiles[t])}freeFBO(t){const e=this.proxyCachedFBO[t];if(void 0!==e){const r=Object.values(e);this.renderCachePool.push(...r),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class vr extends t.OverscaledTileID{constructor(t,e,r){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=e,this.projMatrix=r}}class xr extends t.Elevation{constructor(e,r){super(),this.painter=e,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[n,i,o]=function(e){const r=new t.StructArrayLayout4i8,n=new t.StructArrayLayout3ui6,i=131;r.reserve(17161),n.reserve(33800);const o=t.EXTENT/128,s=t.EXTENT+o/2,a=s+o;for(let u=-o;u<a;u+=o)for(let e=-o;e<a;e+=o){const n=e<0||e>s||u<0||u>s?24575:0,i=t.clamp(Math.round(e),0,t.EXTENT),o=t.clamp(Math.round(u),0,t.EXTENT);r.emplaceBack(i+n,o,i,o)}const l=(t,e)=>{const r=e*i+t;n.emplaceBack(r+1,r,r+i),n.emplaceBack(r+i,r+i+1,r+1)};for(let t=1;t<129;t++)for(let e=1;e<129;e++)l(e,t);return[0,129].forEach(t=>{for(let e=0;e<130;e++)l(e,t),l(t,e)}),[r,n,32768]}(),s=e.context;this.gridBuffer=s.createVertexBuffer(n,t.boundsAttributes.members),this.gridIndexBuffer=s.createIndexBuffer(i),this.gridSegments=t.SegmentVector.simpleSegment(0,0,n.length,i.length),this.gridNoSkirtSegments=t.SegmentVector.simpleSegment(0,0,n.length,o),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new _r(r.map),this.orthoMatrix=t.create(),t.ortho(this.orthoMatrix,0,t.EXTENT,0,t.EXTENT,0,1);const a=s.gl;this._overlapStencilMode=new t.StencilMode({func:a.GEQUAL,mask:255},0,255,a.KEEP,a.KEEP,a.REPLACE),this._previousZoom=e.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=r,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new yr(r.map)}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),t.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=t,this._checkRenderCacheEfficiency()}update(e,r,n){if(e&&e.terrain){this._style!==e&&(this.style=e),this.enabled=!0;const i=e.terrain.properties;this.sourceCache=0===e.terrain.drapeRenderMode?this._mockSourceCache:e._getSourceCache(i.get("source")),this._exaggeration=i.get("exaggeration");const o=()=>{this.sourceCache.used&&t.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const e=this.getScaledDemTileSize();this.sourceCache.update(r,e,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,o(),this._initializing=!0),o(),r.updateElevation(!n),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(r),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const e=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==e.efficiency&&t.warnOnce(`Terrain render cache efficiency is not optimal (${e.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${e.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(t){t.coord&&"source"===t.dataType?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):"style"===t.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._sourceCaches)this._style._sourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(e){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const r=this.proxySourceCache,n=this.painter.transform;this._initializing&&(this._initializing=0===n._centerAltitude&&-1===this.getAtPointOrZero(t.MercatorCoordinate.fromLngLat(n.center),-1),this._emptyDEMTextureDirty=!this._initializing);const i=this.proxyCoords=r.getIds().map(t=>{const e=r.getTileByID(t).tileID;return e.projMatrix=n.calculateProjMatrix(e.toUnwrapped()),e});!function(e,r){const n=r.transform.pointCoordinate(r.transform.getCameraPoint()),i=new t.pointGeometry(n.x,n.y);e.sort((e,r)=>{if(r.overscaledZ-e.overscaledZ)return r.overscaledZ-e.overscaledZ;const n=new t.pointGeometry(e.canonical.x+(1<<e.canonical.z)*e.wrap,e.canonical.y),o=new t.pointGeometry(r.canonical.x+(1<<r.canonical.z)*r.wrap,r.canonical.y),s=i.mult(1<<e.canonical.z);return s.x-=.5,s.y-=.5,s.distSqr(n)-s.distSqr(o)})}(i,this.painter),this._previousZoom=n.zoom;const o=this.proxyToSource||{};this.proxyToSource={},i.forEach(t=>{this.proxyToSource[t.key]={}}),this.terrainTileForTile={};const s=this._style._sourceCaches;for(const t in s){const r=s[t];if(!r.used)continue;if(r!==this.sourceCache&&this.resetTileLookupCache(r.id),this._setupProxiedCoordsForOrtho(r,e[t],o),r.usedForTerrain)continue;const n=e[t];r.getSource().reparseOverscaled&&this._assignTerrainTiles(n)}this.proxiedCoords[r.id]=i.map(t=>new vr(t,t.key,this.orthoMatrix)),this._assignTerrainTiles(i),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(o),this.renderingToTexture=!1,this._updateTimestamp=t.exported.now();const a={};this._visibleDemTiles=[];for(const t of this.proxyCoords){const e=this.terrainTileForTile[t.key];if(!e)continue;const r=e.tileID.key;r in a||(this._visibleDemTiles.push(e),a[r]=r)}}_assignTerrainTiles(t){this._initializing||t.forEach(t=>{if(this.terrainTileForTile[t.key])return;const e=this._findTileCoveringTileID(t,this.sourceCache);e&&(this.terrainTileForTile[t.key]=e)})}_prepareDEMTextures(){const t=this.painter.context,e=t.gl;for(const r in this.terrainTileForTile){const n=this.terrainTileForTile[r],i=n.dem;!i||n.demTexture&&!n.needsDEMTextureUpload||(t.activeTexture.set(e.TEXTURE1),sr(this.painter,n,i))}}_prepareDemTileUniforms(t,e,r,n){if(!e||null==e.demTexture)return!1;const i=t.tileID.canonical,o=Math.pow(2,e.tileID.canonical.z-i.z),s=n||"";return r[`u_dem_tl${s}`]=[i.x*o%1,i.y*o%1],r[`u_dem_scale${s}`]=o,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const e=this.painter.context,r=e.gl;if(!this._emptyDepthBufferTexture){const n=new t.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new t.Texture(e,n,r.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let t=0;const e=this._visibleDemTiles.reduce((e,r)=>{if(!r.dem)return e;const n=r.dem.tree.minimums[0];return n>0&&t++,e+n},0);return t?e/t:0}_updateEmptyDEMTexture(){const e=this.painter.context,r=e.gl;e.activeTexture.set(r.TEXTURE2);const n=this._getLoadedAreaMinimum(),i=new t.RGBAImage({width:1,height:1},new Uint8Array(t.DEMData.pack(n,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let o=this._emptyDEMTexture;return o?o.update(i,{premultiply:!1}):o=this._emptyDEMTexture=new t.Texture(e,i,r.RGBA,{premultiply:!1}),o}setupElevationDraw(e,r,n){const i=this.painter.context,o=i.gl,s=(a=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:t.DEMData.getUnpackVector(a),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var a;s.u_dem_size=this.sourceCache.getSource().tileSize,s.u_exaggeration=this.exaggeration();const l=this.painter.transform,u=l.projection,c=e.tileID.canonical;s.u_tile_tl_up=u.upVector(c,0,0),s.u_tile_tr_up=u.upVector(c,t.EXTENT,0),s.u_tile_br_up=u.upVector(c,t.EXTENT,t.EXTENT),s.u_tile_bl_up=u.upVector(c,0,t.EXTENT),s.u_tile_up_scale=u.upVectorScale(c,l.center.lat,l.worldSize).metersToTile;let h=null,p=null,f=1;if(n&&n.morphing&&this._useVertexMorphing){const t=n.morphing.srcDemTile,r=n.morphing.dstDemTile;f=n.morphing.phase,t&&r&&(this._prepareDemTileUniforms(e,t,s,"_prev")&&(p=t),this._prepareDemTileUniforms(e,r,s)&&(h=r))}if(p&&h?(i.activeTexture.set(o.TEXTURE2),h.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE,o.NEAREST),i.activeTexture.set(o.TEXTURE4),p.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE,o.NEAREST),s.u_dem_lerp=f):(h=this.terrainTileForTile[e.tileID.key],i.activeTexture.set(o.TEXTURE2),(this._prepareDemTileUniforms(e,h,s)?h.demTexture:this.emptyDEMTexture).bind(o.NEAREST,o.CLAMP_TO_EDGE)),i.activeTexture.set(o.TEXTURE3),n&&n.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),this._depthFBO&&(s.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),s.u_depth_size_inv=[1,1]),n&&n.useMeterToDem&&h){const e=(1<<h.tileID.canonical.z)*t.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;s.u_meter_to_dem=e}n&&n.labelPlaneMatrixInv&&(s.u_label_plane_matrix_inv=n.labelPlaneMatrixInv),r.setTerrainUniformValues(i,s)}renderToBackBuffer(e){const r=this.painter,n=this.painter.context;0!==e.length&&(n.bindFramebuffer.set(null),n.viewport.set([0,0,r.width,r.height]),this.renderingToTexture=!1,function(e,r,n,i,o){if("globe"===e.transform.projection.name)!function(e,r,n,i,o){const s=e.context,a=s.gl;let l,u;const c=e.options.showTerrainWireframe?2:0,h=(t,r)=>{if(u===t)return;const n=[];r&&n.push(fr[c]),n.push(fr[t]),n.push("PROJECTION_GLOBE_VIEW"),l=e.useProgram("globeRaster",null,n),u=t},p=e.colorModeForRenderPass(),f=new t.DepthMode(a.LEQUAL,t.DepthMode.ReadWrite,e.depthRangeFor3D);pr.update(o);const d=e.transform,m=t.calculateGlobeMatrix(d,d.worldSize),g=t.calculateGlobeMercatorMatrix(d),y=[t.mercatorXfromLng(d.center.lng),t.mercatorYfromLat(d.center.lat)],_=e.globeSharedBuffers;(c?[!1,!0]:[!1]).forEach(c=>{u=-1;const v=c?a.LINES:a.TRIANGLES;for(const u of i){const i=n.getTile(u),x=Math.pow(2,u.canonical.z),b=t.globeVertexBufferForTileMesh(e,i,u),w=t.StencilMode.disabled,E=r.prevTerrainTileForTile[u.key],S=r.terrainTileForTile[u.key];hr(E,S)&&pr.newMorphing(u.key,E,S,o,250),s.activeTexture.set(a.TEXTURE0),i.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const I=pr.getMorphValuesForProxy(u.key),T=I?1:0,C={};I&&t.extend$1(C,{morphing:{srcDemTile:I.from,dstDemTile:I.to,phase:t.easeCubicInOut(I.phase)}});const M=t.globeMatrixForTile(u.canonical,m),A=cr(d.projMatrix,M,g,t.globeToMercatorTransition(d.zoom),y);if(h(T,c),r.setupElevationDraw(i,l,C),e.prepareDrawProgram(s,l,u.toUnwrapped()),_){const[r,n]=c?_.getWirefameBuffer(e.context):[_.gridIndexBuffer,_.gridSegments];l.draw(s,v,f,w,p,t.CullFaceMode.backCCW,A,"globe_raster",b,r,n)}if(!c&&_){const e=(e,r)=>{const[n,i]=_.getPoleBuffersForTile(u.canonical.z,r);if(i){const o=t.globePoleMatrixForTile(u.canonical,r,d),a=cr(d.projMatrix,o,o,0,y);e.draw(s,v,f,w,p,t.CullFaceMode.disabled,a,"globe_pole_raster",n,_.poleIndexBuffer,i)}};0===u.canonical.y&&e(l,!0),u.canonical.y===x-1&&e(l,!1)}}})}(e,r,n,i,o);else{const s=e.context,a=s.gl;let l,u;const c=e.options.showTerrainWireframe?2:0,h=(t,r)=>{if(u===t)return;const n=[fr[t]];r&&n.push(fr[c]),l=e.useProgram("terrainRaster",null,n),u=t},p=e.colorModeForRenderPass(),f=new t.DepthMode(a.LEQUAL,t.DepthMode.ReadWrite,e.depthRangeFor3D);pr.update(o);const d=e.transform,m=6*Math.pow(1.5,22-d.zoom)*r.exaggeration();(c?[!1,!0]:[!1]).forEach(c=>{u=-1;const g=c?a.LINES:a.TRIANGLES,[y,_]=c?r.getWirefameBuffer():[r.gridIndexBuffer,r.gridSegments];for(const u of i){const i=n.getTile(u),v=t.StencilMode.disabled,x=r.prevTerrainTileForTile[u.key],b=r.terrainTileForTile[u.key];hr(x,b)&&pr.newMorphing(u.key,x,b,o,250),s.activeTexture.set(a.TEXTURE0),i.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST);const w=pr.getMorphValuesForProxy(u.key),E=w?1:0;let S;w&&(S={morphing:{srcDemTile:w.from,dstDemTile:w.to,phase:t.easeCubicInOut(w.phase)}});const I=ur(u.projMatrix,dr(u.canonical,d.renderWorldCopies)?m/10:m);h(E,c),r.setupElevationDraw(i,l,S),e.prepareDrawProgram(s,l,u.toUnwrapped()),l.draw(s,g,f,v,p,t.CullFaceMode.backCCW,I,"terrain_raster",r.gridBuffer,y,_)}})}}(r,this,this.proxySourceCache,e,this._updateTimestamp),this.renderingToTexture=!0,e.splice(0,e.length))}renderBatch(e){if(0===this._drapedRenderBatches.length)return e+1;this.renderingToTexture=!0;const r=this.painter,n=this.painter.context,i=this.proxySourceCache,o=this.proxiedCoords[i.id],s=this._drapedRenderBatches.shift(),a=[],l=r.style.order;let u=0;for(const c of o){const o=i.getTileByID(c.proxyTileKey),h=i.proxyCachedFBO[c.key]?i.proxyCachedFBO[c.key][e]:void 0,p=void 0!==h?i.renderCache[h]:this.pool[u++],f=void 0!==h;if(o.texture=p.tex,f&&!p.dirty){a.push(o.tileID);continue}let d;n.bindFramebuffer.set(p.fb.framebuffer),this.renderedToTile=!1,p.dirty&&(n.clear({color:t.Color.transparent,stencil:0}),p.dirty=!1);for(let t=s.start;t<=s.end;++t){const e=r.style._layers[l[t]];if(e.isHidden(r.transform.zoom))continue;const i=r.style._getLayerSourceCache(e),o=i?this.proxyToSource[c.key][i.id]:[c];if(!o)continue;const s=o;n.viewport.set([0,0,p.fb.width,p.fb.height]),d!==(i?i.id:null)&&(this._setupStencil(p,o,e,i),d=i?i.id:null),r.renderLayer(r,i,e,s)}this.renderedToTile?(p.dirty=!0,a.push(o.tileID)):f||--u,5===u&&(u=0,this.renderToBackBuffer(a))}return this.renderToBackBuffer(a),this.renderingToTexture=!1,n.bindFramebuffer.set(null),n.viewport.set([0,0,r.width,r.height]),s.end+1}postRender(){}renderCacheEfficiency(t){const e=t.order.length;if(0===e)return{efficiency:100};let r,n=0,i=0,o=!1;for(let s=0;s<e;++s){const e=t._layers[t.order[s]];this._style.isLayerDraped(e)?(o&&++n,++i):o||(o=!0,r=e.id)}return 0===i?{efficiency:100}:{efficiency:100*(1-n/i),firstUndrapedLayer:r}}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(t=>t.dem).forEach(e=>{t=Math.min(t,e.dem.tree.minimums[0])}),0===t?t:(t-30)*this._exaggeration}raycast(t,e,r){if(!this._visibleDemTiles)return null;const n=this._visibleDemTiles.filter(t=>t.dem).map(n=>{const i=n.tileID,o=Math.pow(2,i.overscaledZ),{x:s,y:a}=i.canonical,l=s/o,u=(s+1)/o,c=a/o,h=(a+1)/o;return{minx:l,miny:c,maxx:u,maxy:h,t:n.dem.tree.raycastRoot(l,c,u,h,t,e,r),tile:n}});n.sort((t,e)=>(null!==t.t?t.t:Number.MAX_VALUE)-(null!==e.t?e.t:Number.MAX_VALUE));for(const i of n){if(null==i.t)return null;const n=i.tile.dem.tree.raycast(i.minx,i.miny,i.maxx,i.maxy,t,e,r);if(null!=n)return n}return null}_createFBO(){const e=this.painter.context,r=e.gl,n=this.drapeBufferSize;e.activeTexture.set(r.TEXTURE0);const i=new t.Texture(e,{width:n[0],height:n[1],data:null},r.RGBA);i.bind(r.LINEAR,r.CLAMP_TO_EDGE);const o=e.createFramebuffer(n[0],n[1],!1);return o.colorAttachment.set(i.texture),o.depthAttachment=new _t(e,o.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=e.createRenderbuffer(e.gl.DEPTH_STENCIL,n[0],n[1]),this._stencilRef=0,o.depthAttachment.set(this._sharedDepthStencil),e.clear({stencil:0})):o.depthAttachment.set(this._sharedDepthStencil),e.extTextureFilterAnisotropic&&!e.extTextureFilterAnisotropicForceOff&&r.texParameterf(r.TEXTURE_2D,e.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.extTextureFilterAnisotropicMax),{fb:o,tex:i,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const t in this._style._sourceCaches)if(this._style._sourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const e=this._style._layers[t],r=e.isHidden(this.painter.transform.zoom),n=e.getCrossfadeParameters(),i=!!n&&1!==n.t,o=e.hasTransition();return"custom"!==e.type&&!r&&(i||o)})}_clearRasterFadeFromRenderCache(){let t=!1;for(const e in this._style._sourceCaches)if(this._style._sourceCaches[e]._source instanceof It){t=!0;break}if(t)for(let e=0;e<this._style.order.length;++e){const t=this._style._layers[this._style.order[e]],r=t.isHidden(this.painter.transform.zoom),n=this._style._getLayerSourceCache(t);if("raster"!==t.type||r||!n)continue;const i=t.paint.get("raster-fade-duration");for(const e of this.proxyCoords){const t=this.proxyToSource[e.key][n.id];if(t)for(const e of t){const t=gr(n.getTile(e),n.findLoadedParent(e,0),n,this.painter.transform,i);(1!==t.opacity||0!==t.mix)&&this._clearRenderCacheForTile(n.id,e)}}}}_setupDrapedRenderBatches(){const t=this._style.order,e=t.length;if(0===e)return;const r=[];let n,i=0,o=this._style._layers[t[i]];for(;!this._style.isLayerDraped(o)&&o.isHidden(this.painter.transform.zoom)&&++i<e;)o=this._style._layers[t[i]];for(;i<e;++i){const e=this._style._layers[t[i]];e.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(e)?void 0===n&&(n=i):void 0!==n&&(r.push({start:n,end:i-1}),n=void 0))}void 0!==n&&r.push({start:n,end:i-1}),this._drapedRenderBatches=r}_setupRenderCache(t){const e=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,e.renderCache.length>e.renderCachePool.length){const t=Object.values(e.proxyCachedFBO);e.proxyCachedFBO={};for(let r=0;r<t.length;++r){const n=Object.values(t[r]);e.renderCachePool.push(...n)}}return}this._clearRasterFadeFromRenderCache();const r=this.proxyCoords,n=this._tilesDirty;for(let o=r.length-1;o>=0;o--){const i=r[o];if(e.getTileByID(i.key),void 0!==e.proxyCachedFBO[i.key]){const r=t[i.key],o=this.proxyToSource[i.key];let s=0;for(const t in o){const e=o[t],i=r[t];if(!i||i.length!==e.length||e.some((e,r)=>e!==i[r]||n[t]&&n[t].hasOwnProperty(e.key))){s=-1;break}++s}for(const t in e.proxyCachedFBO[i.key])e.renderCache[e.proxyCachedFBO[i.key][t]].dirty=s<0||s!==Object.values(r).length}}const i=[...this._drapedRenderBatches];i.sort((t,e)=>e.end-e.start-(t.end-t.start));for(const o of i)for(const t of r){if(e.proxyCachedFBO[t.key])continue;let r=e.renderCachePool.pop();void 0===r&&e.renderCache.length<50&&(r=e.renderCache.length,e.renderCache.push(this._createFBO())),void 0!==r&&(e.proxyCachedFBO[t.key]={},e.proxyCachedFBO[t.key][o.start]=r,e.renderCache[r].dirty=!0)}this._tilesDirty={}}_setupStencil(t,e,r,n){if(!n||!this._sourceTilesOverlap[n.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const i=this.painter.context,o=i.gl;if(e.length<=1)return void(this._overlapStencilType=!1);let s;if(r.isTileClipped())s=e.length,this._overlapStencilMode.test={func:o.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(e[0].overscaledZ>e[e.length-1].overscaledZ))return void(this._overlapStencilType=!1);s=1,this._overlapStencilMode.test={func:o.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+s>255&&(i.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=s,this._overlapStencilMode.ref=this._stencilRef,r.isTileClipped()&&this._renderTileClippingMasks(e,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(e){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[e.key]),this._overlapStencilMode):t.StencilMode.disabled}_renderTileClippingMasks(e,r){const n=this.painter,i=this.painter.context,o=i.gl;n._tileClippingMaskIDs={},i.setColorMode(t.ColorMode.disabled),i.setDepthMode(t.DepthMode.disabled);const s=n.useProgram("clippingMask");for(const a of e){const e=n._tileClippingMaskIDs[a.key]=--r;s.draw(i,o.TRIANGLES,t.DepthMode.disabled,new t.StencilMode({func:o.ALWAYS,mask:0},e,255,o.KEEP,o.KEEP,o.REPLACE),t.ColorMode.disabled,t.CullFaceMode.disabled,mr(a.projMatrix),"$clipping",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments)}}pointCoordinate(e){const r=this.painter.transform;if(e.x<0||e.x>r.width||e.y<0||e.y>r.height)return null;const n=[e.x,e.y,1,1];t.transformMat4$1(n,n,r.pixelMatrixInverse),t.scale$1(n,n,1/n[3]),n[0]/=r.worldSize,n[1]/=r.worldSize;const i=r._camera.position,o=t.mercatorZfromAltitude(1,r.center.lat),s=[i[0],i[1],i[2]/o,0],a=t.subtract([],n.slice(0,3),s);t.normalize(a,a);const l=this.raycast(s,a,this._exaggeration);return null!==l&&l?(t.scaleAndAdd(s,s,a,l),s[3]=s[2],s[2]*=o,s):null}drawDepth(){const e=this.painter,r=e.context,n=this.proxySourceCache,i=Math.ceil(e.width),o=Math.ceil(e.height);if(!this._depthFBO||this._depthFBO.width===i&&this._depthFBO.height===o||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const e=r.gl,n=r.createFramebuffer(i,o,!0);r.activeTexture.set(e.TEXTURE0);const s=new t.Texture(r,{width:i,height:o,data:null},e.RGBA);s.bind(e.NEAREST,e.CLAMP_TO_EDGE),n.colorAttachment.set(s.texture);const a=r.createRenderbuffer(r.gl.DEPTH_COMPONENT16,i,o);n.depthAttachment.set(a),this._depthFBO=n,this._depthTexture=s}r.bindFramebuffer.set(this._depthFBO.framebuffer),r.viewport.set([0,0,i,o]),function(e,r,n,i){if("globe"===e.transform.projection.name)return;const o=e.context,s=o.gl;o.clear({depth:1});const a=e.useProgram("terrainDepth"),l=new t.DepthMode(s.LESS,t.DepthMode.ReadWrite,e.depthRangeFor3D);for(const u of i){const e=n.getTile(u),i=ur(u.projMatrix,0);r.setupElevationDraw(e,a),a.draw(o,s.TRIANGLES,l,t.StencilMode.disabled,t.ColorMode.unblended,t.CullFaceMode.backCCW,i,"terrain_depth",r.gridBuffer,r.gridIndexBuffer,r.gridNoSkirtSegments)}}(e,this,n,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,e,r){if(t.getSource()instanceof Mt)return this._setupProxiedCoordsForImageSource(t,e,r);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const n=this.proxiedCoords[t.id]=[],i=this.proxyCoords;for(let s=0;s<i.length;s++){const e=i[s],o=this._findTileCoveringTileID(e,t);if(o){const i=this._createProxiedId(e,o,r[e.key]&&r[e.key][t.id]);n.push(i),this.proxyToSource[e.key][t.id]=[i]}}let o=!1;for(let s=0;s<e.length;s++){const i=t.getTile(e[s]);if(!i||!i.hasData())continue;const a=this._findTileCoveringTileID(i.tileID,this.proxySourceCache);if(a&&a.tileID.canonical.z!==i.tileID.canonical.z){const e=this.proxyToSource[a.tileID.key][t.id],s=this._createProxiedId(a.tileID,i,r[a.tileID.key]&&r[a.tileID.key][t.id]);e?e.splice(e.length-1,0,s):this.proxyToSource[a.tileID.key][t.id]=[s],n.push(s),o=!0}}this._sourceTilesOverlap[t.id]=o}_setupProxiedCoordsForImageSource(e,r,n){if(!e.getSource().loaded())return;const i=this.proxiedCoords[e.id]=[],o=this.proxyCoords,s=e.getSource(),a=new t.pointGeometry(s.tileID.x,s.tileID.y)._div(1<<s.tileID.z),l=s.coordinates.map(t.MercatorCoordinate.fromLngLat).reduce((t,e)=>(t.min.x=Math.min(t.min.x,e.x-a.x),t.min.y=Math.min(t.min.y,e.y-a.y),t.max.x=Math.max(t.max.x,e.x-a.x),t.max.y=Math.max(t.max.y,e.y-a.y),t),{min:new t.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new t.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),u=(e,r)=>{const n=e.wrap+e.canonical.x/(1<<e.canonical.z),i=e.canonical.y/(1<<e.canonical.z),o=t.EXTENT/(1<<e.canonical.z),s=r.wrap+r.canonical.x/(1<<r.canonical.z),a=r.canonical.y/(1<<r.canonical.z);return n+o<s+l.min.x||n>s+l.max.x||i+o<a+l.min.y||i>a+l.max.y};for(let t=0;t<o.length;t++){const s=o[t];for(let t=0;t<r.length;t++){const o=e.getTile(r[t]);if(!o||!o.hasData())continue;if(u(s,o.tileID))continue;const a=this._createProxiedId(s,o,n[s.key]&&n[s.key][e.id]),l=this.proxyToSource[s.key][e.id];l?l.push(a):this.proxyToSource[s.key][e.id]=[a],i.push(a)}}}_createProxiedId(e,r,n){let i=this.orthoMatrix;if(n){const t=n.find(t=>t.key===r.tileID.key);if(t)return t}if(r.tileID.key!==e.key){const n=e.canonical.z-r.tileID.canonical.z;let o,s,a;i=t.create();const l=r.tileID.wrap-e.wrap<<e.overscaledZ;n>0?(o=t.EXTENT>>n,s=o*((r.tileID.canonical.x<<n)-e.canonical.x+l),a=o*((r.tileID.canonical.y<<n)-e.canonical.y)):(o=t.EXTENT<<-n,s=t.EXTENT*(r.tileID.canonical.x-(e.canonical.x+l<<-n)),a=t.EXTENT*(r.tileID.canonical.y-(e.canonical.y<<-n))),t.ortho(i,0,o,0,o,0,1),t.translate(i,i,[s,a,0])}return new vr(r.tileID,e.key,i)}_findTileCoveringTileID(e,r){let n=r.getTile(e);if(n&&n.hasData())return n;const i=this._findCoveringTileCache[r.id],o=i[e.key];if(n=o?r.getTileByID(o):null,n&&n.hasData()||null===o)return n;let s=n?n.tileID:e,a=s.overscaledZ;const l=r.getSource().minzoom,u=[];if(!o){const i=r.getSource().maxzoom;if(e.canonical.z>=i){const n=e.canonical.z-i;r.getSource().reparseOverscaled?(a=Math.max(e.canonical.z+2,r.transform.tileZoom),s=new t.OverscaledTileID(a,e.wrap,i,e.canonical.x>>n,e.canonical.y>>n)):0!==n&&(a=i,s=new t.OverscaledTileID(a,e.wrap,i,e.canonical.x>>n,e.canonical.y>>n))}s.key!==e.key&&(u.push(s.key),n=r.getTile(s))}const c=t=>{u.forEach(e=>{i[e]=t}),u.length=0};for(a-=1;a>=l&&(!n||!n.hasData());a--){n&&c(n.tileID.key);const t=s.calculateScaledKey(a);if(n=r.getTileByID(t),n&&n.hasData())break;const e=i[t];if(null===e)break;void 0===e?u.push(t):n=r.getTileByID(e)}return c(n?n.tileID.key:null),n&&n.hasData()?n:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,e){let r=this._tilesDirty[t];r||(r=this._tilesDirty[t]={}),r[e.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const e=function(e){let r=0;const n=new t.StructArrayLayout2ui4,i=131;for(let t=1;t<129;t++){for(let e=1;e<129;e++)r=t*i+e,n.emplaceBack(r,r+1),n.emplaceBack(r,r+i),n.emplaceBack(r+1,r+i),128===t&&n.emplaceBack(r+i,r+i+1);n.emplaceBack(r+1,r+1+i)}return n}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(e),this.wireframeSegments=t.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,e.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function br(t){const e=[];for(let r=0;r<t.length;r++){if(null===t[r])continue;const n=t[r].split(" ");e.push(n.pop())}return e}class wr{static cacheKey(t,e,r){let n=`${t}${r?r.cacheKey:""}`;for(const i of e)n+=`/${i}`;return n}constructor(e,r,n,i,o,s){const a=e.gl;this.program=a.createProgram();const l=br(n.staticAttributes),u=i?i.getBinderAttributes():[],c=l.concat(u),h=n.staticUniforms?br(n.staticUniforms):[],p=i?i.getBinderUniforms():[],f=h.concat(p),d=[];for(const t of f)d.indexOf(t)<0&&d.push(t);let m=i?i.defines():[];m=m.concat(s.map(t=>`#define ${t}`));const g=m.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",tr,Qe.fragmentSource,Ke.fragmentSource,n.fragmentSource).join("\n"),y=m.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",tr,Qe.vertexSource,Ke.vertexSource,Je.vertexSource,n.vertexSource).join("\n"),_=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);a.shaderSource(_,g),a.compileShader(_),a.attachShader(this.program,_);const v=a.createShader(a.VERTEX_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);a.shaderSource(v,y),a.compileShader(v),a.attachShader(this.program,v),this.attributes={};const x={};this.numAttributes=c.length;for(let t=0;t<this.numAttributes;t++)c[t]&&(a.bindAttribLocation(this.program,t,c[t]),this.attributes[c[t]]=t);a.linkProgram(this.program),a.deleteShader(v),a.deleteShader(_);for(let t=0;t<d.length;t++){const e=d[t];if(e&&!x[e]){const t=a.getUniformLocation(this.program,e);t&&(x[e]=t)}}this.fixedUniforms=o(e,x),this.binderUniforms=i?i.getUniforms(e,x):[],-1!==s.indexOf("TERRAIN")&&(this.terrainUniforms=((e,r)=>({u_dem:new t.Uniform1i(e,r.u_dem),u_dem_prev:new t.Uniform1i(e,r.u_dem_prev),u_dem_unpack:new t.Uniform4f(e,r.u_dem_unpack),u_dem_tl:new t.Uniform2f(e,r.u_dem_tl),u_dem_scale:new t.Uniform1f(e,r.u_dem_scale),u_dem_tl_prev:new t.Uniform2f(e,r.u_dem_tl_prev),u_dem_scale_prev:new t.Uniform1f(e,r.u_dem_scale_prev),u_dem_size:new t.Uniform1f(e,r.u_dem_size),u_dem_lerp:new t.Uniform1f(e,r.u_dem_lerp),u_exaggeration:new t.Uniform1f(e,r.u_exaggeration),u_depth:new t.Uniform1i(e,r.u_depth),u_depth_size_inv:new t.Uniform2f(e,r.u_depth_size_inv),u_meter_to_dem:new t.Uniform1f(e,r.u_meter_to_dem),u_label_plane_matrix_inv:new t.UniformMatrix4f(e,r.u_label_plane_matrix_inv),u_tile_tl_up:new t.Uniform3f(e,r.u_tile_tl_up),u_tile_tr_up:new t.Uniform3f(e,r.u_tile_tr_up),u_tile_br_up:new t.Uniform3f(e,r.u_tile_br_up),u_tile_bl_up:new t.Uniform3f(e,r.u_tile_bl_up),u_tile_up_scale:new t.Uniform1f(e,r.u_tile_up_scale)}))(e,x)),-1!==s.indexOf("FOG")&&(this.fogUniforms=((e,r)=>({u_fog_matrix:new t.UniformMatrix4f(e,r.u_fog_matrix),u_fog_range:new t.Uniform2f(e,r.u_fog_range),u_fog_color:new t.Uniform4f(e,r.u_fog_color),u_fog_horizon_blend:new t.Uniform1f(e,r.u_fog_horizon_blend),u_fog_temporal_offset:new t.Uniform1f(e,r.u_fog_temporal_offset)}))(e,x))}setTerrainUniformValues(t,e){if(!this.terrainUniforms)return;const r=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)r[t].set(e[t])}}setFogUniformValues(t,e){if(!this.fogUniforms)return;const r=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)r[t].location&&r[t].set(e[t])}}draw(t,e,r,n,i,o,s,a,l,u,c,h,p,f,d,m){const g=t.gl;if(this.failedToCreate)return;t.program.set(this.program),t.setDepthMode(r),t.setStencilMode(n),t.setColorMode(i),t.setCullFace(o);for(const _ of Object.keys(this.fixedUniforms))this.fixedUniforms[_].set(s[_]);f&&f.setUniforms(t,this.binderUniforms,h,{zoom:p});const y={[g.LINES]:2,[g.TRIANGLES]:3,[g.LINE_STRIP]:1}[e];for(const _ of c.get()){const r=_.vaos||(_.vaos={});(r[a]||(r[a]=new nr)).bind(t,this,l,f?f.getPaintVertexBuffers():[],u,_.vertexOffset,d,m),g.drawElements(e,_.primitiveLength*y,g.UNSIGNED_SHORT,_.primitiveOffset*y*2)}}}function Er(t,e,r){const n=1/z(r,1,e.transform.tileZoom),i=Math.pow(2,r.tileID.overscaledZ),o=r.tileSize*Math.pow(2,e.transform.tileZoom)/i,s=o*(r.tileID.canonical.x+r.tileID.wrap*i),a=o*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[n,t.fromScale,t.toScale],u_fade:t.t,u_pixel_coord_upper:[s>>16,a>>16],u_pixel_coord_lower:[65535&s,65535&a]}}const Sr=(e,r,n,i)=>{const o=r.style.light,s=o.properties.get("position"),a=[s.x,s.y,s.z],l=t.create$1();"viewport"===o.properties.get("anchor")&&(t.fromRotation(l,-r.transform.angle),t.transformMat3(a,a,l));const u=o.properties.get("color");return{u_matrix:e,u_lightpos:a,u_lightintensity:o.properties.get("intensity"),u_lightcolor:[u.r,u.g,u.b],u_vertical_gradient:+n,u_opacity:i}},Ir=(e,r,n,i,o,s,a)=>t.extend(Sr(e,r,n,i),Er(s,r,a),{u_height_factor:-Math.pow(2,o.overscaledZ)/a.tileSize/8}),Tr=t=>({u_matrix:t}),Cr=(e,r,n,i)=>t.extend(Tr(e),Er(n,r,i)),Mr=(t,e)=>({u_matrix:t,u_world:e}),Ar=(e,r,n,i,o)=>t.extend(Cr(e,r,n,i),{u_world:o}),Pr=t.create(),kr=(e,r,n,i,o,s)=>{const a=e.transform,l="globe"===a.projection.name;let u;if("map"===s.paint.get("circle-pitch-alignment"))if(l){const e=t.globePixelsToTileUnits(a.zoom,r.canonical);u=Float32Array.from([e,0,0,e])}else u=a.calculatePixelsToTileUnitsMatrix(n);else u=new Float32Array([a.pixelsToGLUnits[0],0,0,a.pixelsToGLUnits[1]]);const c={u_camera_to_center_distance:a.cameraToCenterDistance,u_matrix:e.translatePosMatrix(r.projMatrix,n,s.paint.get("circle-translate"),s.paint.get("circle-translate-anchor")),u_device_pixel_ratio:t.exported.devicePixelRatio,u_extrude_scale:u,u_inv_rot_matrix:Pr,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};return l&&(c.u_inv_rot_matrix=i.createInversionMatrix(r.canonical),c.u_merc_center=o,c.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],c.u_zoom_transition=t.globeToMercatorTransition(a.zoom),c.u_up_dir=a.projection.upVector(r.canonical,o[0],o[1])),c},Lr=t=>{const e=[];return"map"===t.paint.get("circle-pitch-alignment")&&e.push("PITCH_WITH_MAP"),"map"===t.paint.get("circle-pitch-scale")&&e.push("SCALE_WITH_MAP"),e},zr=(e,r,n)=>{const i=t.EXTENT/n.tileSize;return{u_matrix:e,u_camera_to_center_distance:r.cameraToCenterDistance,u_extrude_scale:[r.pixelsToGLUnits[0]/i,r.pixelsToGLUnits[1]/i]}},Dr=(t,e,r=1)=>({u_matrix:t,u_color:e,u_overlay:0,u_overlay_scale:r}),Rr=t.create(),Or=(e,r,n,i,o,s,a)=>{const l=e.transform,u="globe"===l.projection.name,c=u?t.globePixelsToTileUnits(l.zoom,r.canonical):z(n,1,s),h={u_matrix:r.projMatrix,u_extrude_scale:c,u_intensity:a,u_inv_rot_matrix:Rr,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};return u&&(h.u_inv_rot_matrix=i.createInversionMatrix(r.canonical),h.u_merc_center=o,h.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],h.u_zoom_transition=t.globeToMercatorTransition(l.zoom),h.u_up_dir=l.projection.upVector(r.canonical,o[0],o[1])),h},Nr=(e,r,n,i,o,s)=>{const a=e.transform,l=a.calculatePixelsToTileUnitsMatrix(r),u={u_matrix:jr(e,r,n,o),u_pixels_to_tile_units:l,u_device_pixel_ratio:t.exported.devicePixelRatio,u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:s,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(Ur(n)){const t=Br(r,e.transform);u.u_texsize=r.lineAtlasTexture.size,u.u_scale=[t,i.fromScale,i.toScale],u.u_mix=i.t}return u},Fr=(e,r,n,i,o)=>{const s=e.transform,a=Br(r,s);return{u_matrix:jr(e,r,n,o),u_texsize:r.imageAtlasTexture.size,u_pixels_to_tile_units:s.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:t.exported.devicePixelRatio,u_image:0,u_scale:[a,i.fromScale,i.toScale],u_fade:i.t,u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Br(t,e){return 1/z(t,1,e.tileZoom)}function jr(t,e,r,n){return t.translatePosMatrix(n||e.tileID.projMatrix,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}function Ur(t){const e=t.paint.get("line-dasharray").value;return e.value||"constant"!==e.kind}const Vr=(t,e,r,n,i,o)=>{return{u_matrix:t,u_tl_parent:e,u_scale_parent:r,u_fade_t:n.mix,u_opacity:n.opacity*i.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:i.paint.get("raster-brightness-min"),u_brightness_high:i.paint.get("raster-brightness-max"),u_saturation_factor:(a=i.paint.get("raster-saturation"),a>0?1-1/(1.001-a):-a),u_contrast_factor:(s=i.paint.get("raster-contrast"),s>0?1/(1-s):1+s),u_spin_weights:Gr(i.paint.get("raster-hue-rotate")),u_perspective_transform:o};var s,a};function Gr(t){t*=Math.PI/180;const e=Math.sin(t),r=Math.cos(t);return[(2*r+1)/3,(-Math.sqrt(3)*e-r+1)/3,(Math.sqrt(3)*e-r+1)/3]}const qr=t.create(),$r=(e,r,n,i,o,s,a,l,u,c,h,p,f,d)=>{const m=o.transform,g={u_is_size_zoom_constant:+("constant"===e||"source"===e),u_is_size_feature_constant:+("constant"===e||"camera"===e),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:m.cameraToCenterDistance,u_rotate_symbol:+n,u_aspect_ratio:m.width/m.height,u_fade_change:o.options.fadeDuration?o.symbolFadeChange:1,u_matrix:s,u_label_plane_matrix:a,u_coord_matrix:l,u_is_text:+u,u_pitch_with_map:+i,u_texsize:c,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:qr,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:qr};if("globe"===m.projection.name){const e=t.calculateGlobeMatrix(m,m.worldSize);g.u_tile_id=[h.canonical.x,h.canonical.y,1<<h.canonical.z],g.u_zoom_transition=p,g.u_inv_rot_matrix=d.createInversionMatrix(h.canonical),g.u_merc_center=f,g.u_camera_forward=m._camera.forward(),g.u_ecef_origin=t.globeECEFOrigin(e,h.toUnwrapped()),g.u_tile_matrix=Float32Array.from(e)}return g},Zr=(e,r,n,i,o,s,a,l,u,c,h,p,f,d,m)=>{const{cameraToCenterDistance:g,_pitch:y}=o.transform;return t.extend($r(e,r,n,i,o,s,a,l,u,c,p,f,d,m),{u_gamma_scale:i?g*Math.cos(o.terrain?0:y):1,u_device_pixel_ratio:t.exported.devicePixelRatio,u_is_halo:+h})},Xr=(e,r,n,i,o,s,a,l,u,c,h,p,f,d)=>t.extend(Zr(e,r,n,i,o,s,a,l,!0,u,!0,h,p,f,d),{u_texsize_icon:c,u_texture_icon:1}),Wr=(t,e,r)=>({u_matrix:t,u_opacity:e,u_color:r}),Yr=(e,r,n,i,o,s)=>t.extend(function(t,e,r,n){const i=r.imageManager.getPattern(t.from.toString()),o=r.imageManager.getPattern(t.to.toString()),{width:s,height:a}=r.imageManager.getPixelSize(),l=Math.pow(2,n.tileID.overscaledZ),u=n.tileSize*Math.pow(2,r.transform.tileZoom)/l,c=u*(n.tileID.canonical.x+n.tileID.wrap*l),h=u*n.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:i.tl,u_pattern_br_a:i.br,u_pattern_tl_b:o.tl,u_pattern_br_b:o.br,u_texsize:[s,a],u_mix:e.t,u_pattern_size_a:i.displaySize,u_pattern_size_b:o.displaySize,u_scale_a:e.fromScale,u_scale_b:e.toScale,u_tile_units_to_pixels:1/z(n,1,r.transform.tileZoom),u_pixel_coord_upper:[c>>16,h>>16],u_pixel_coord_lower:[65535&c,65535&h]}}(i,s,n,o),{u_matrix:e,u_opacity:r}),Hr={fillExtrusion:(e,r)=>({u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_lightpos:new t.Uniform3f(e,r.u_lightpos),u_lightintensity:new t.Uniform1f(e,r.u_lightintensity),u_lightcolor:new t.Uniform3f(e,r.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,r.u_vertical_gradient),u_opacity:new t.Uniform1f(e,r.u_opacity)}),fillExtrusionPattern:(e,r)=>({u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_lightpos:new t.Uniform3f(e,r.u_lightpos),u_lightintensity:new t.Uniform1f(e,r.u_lightintensity),u_lightcolor:new t.Uniform3f(e,r.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,r.u_vertical_gradient),u_height_factor:new t.Uniform1f(e,r.u_height_factor),u_image:new t.Uniform1i(e,r.u_image),u_texsize:new t.Uniform2f(e,r.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,r.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,r.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,r.u_scale),u_fade:new t.Uniform1f(e,r.u_fade),u_opacity:new t.Uniform1f(e,r.u_opacity)}),fill:(e,r)=>({u_matrix:new t.UniformMatrix4f(e,r.u_matrix)}),fillPattern:(e,r)=>({u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_image:new t.Uniform1i(e,r.u_image),u_texsize:new t.Uniform2f(e,r.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,r.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,r.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,r.u_scale),u_fade:new t.Uniform1f(e,r.u_fade)}),fillOutline:(e,r)=>({u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_world:new t.Uniform2f(e,r.u_world)}),fillOutlinePattern:(e,r)=>({u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_world:new t.Uniform2f(e,r.u_world),u_image:new t.Uniform1i(e,r.u_image),u_texsize:new t.Uniform2f(e,r.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,r.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,r.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,r.u_scale),u_fade:new t.Uniform1f(e,r.u_fade)}),circle:(e,r)=>({u_camera_to_center_distance:new t.Uniform1f(e,r.u_camera_to_center_distance),u_extrude_scale:new t.UniformMatrix2f(e,r.u_extrude_scale),u_device_pixel_ratio:new t.Uniform1f(e,r.u_device_pixel_ratio),u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_inv_rot_matrix:new t.UniformMatrix4f(e,r.u_inv_rot_matrix),u_merc_center:new t.Uniform2f(e,r.u_merc_center),u_tile_id:new t.Uniform3f(e,r.u_tile_id),u_zoom_transition:new t.Uniform1f(e,r.u_zoom_transition),u_up_dir:new t.Uniform3f(e,r.u_up_dir)}),collisionBox:(e,r)=>({u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_camera_to_center_distance:new t.Uniform1f(e,r.u_camera_to_center_distance),u_extrude_scale:new t.Uniform2f(e,r.u_extrude_scale)}),collisionCircle:(e,r)=>({u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_inv_matrix:new t.UniformMatrix4f(e,r.u_inv_matrix),u_camera_to_center_distance:new t.Uniform1f(e,r.u_camera_to_center_distance),u_viewport_size:new t.Uniform2f(e,r.u_viewport_size)}),debug:(e,r)=>({u_color:new t.UniformColor(e,r.u_color),u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_overlay:new t.Uniform1i(e,r.u_overlay),u_overlay_scale:new t.Uniform1f(e,r.u_overlay_scale)}),clippingMask:(e,r)=>({u_matrix:new t.UniformMatrix4f(e,r.u_matrix)}),heatmap:(e,r)=>({u_extrude_scale:new t.Uniform1f(e,r.u_extrude_scale),u_intensity:new t.Uniform1f(e,r.u_intensity),u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_inv_rot_matrix:new t.UniformMatrix4f(e,r.u_inv_rot_matrix),u_merc_center:new t.Uniform2f(e,r.u_merc_center),u_tile_id:new t.Uniform3f(e,r.u_tile_id),u_zoom_transition:new t.Uniform1f(e,r.u_zoom_transition),u_up_dir:new t.Uniform3f(e,r.u_up_dir)}),heatmapTexture:(e,r)=>({u_image:new t.Uniform1i(e,r.u_image),u_color_ramp:new t.Uniform1i(e,r.u_color_ramp),u_opacity:new t.Uniform1f(e,r.u_opacity)}),hillshade:(e,r)=>({u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_image:new t.Uniform1i(e,r.u_image),u_latrange:new t.Uniform2f(e,r.u_latrange),u_light:new t.Uniform2f(e,r.u_light),u_shadow:new t.UniformColor(e,r.u_shadow),u_highlight:new t.UniformColor(e,r.u_highlight),u_accent:new t.UniformColor(e,r.u_accent)}),hillshadePrepare:(e,r)=>({u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_image:new t.Uniform1i(e,r.u_image),u_dimension:new t.Uniform2f(e,r.u_dimension),u_zoom:new t.Uniform1f(e,r.u_zoom),u_unpack:new t.Uniform4f(e,r.u_unpack)}),line:(e,r)=>({u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_pixels_to_tile_units:new t.UniformMatrix2f(e,r.u_pixels_to_tile_units),u_device_pixel_ratio:new t.Uniform1f(e,r.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,r.u_units_to_pixels),u_dash_image:new t.Uniform1i(e,r.u_dash_image),u_gradient_image:new t.Uniform1i(e,r.u_gradient_image),u_image_height:new t.Uniform1f(e,r.u_image_height),u_texsize:new t.Uniform2f(e,r.u_texsize),u_scale:new t.Uniform3f(e,r.u_scale),u_mix:new t.Uniform1f(e,r.u_mix),u_alpha_discard_threshold:new t.Uniform1f(e,r.u_alpha_discard_threshold)}),linePattern:(e,r)=>({u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_texsize:new t.Uniform2f(e,r.u_texsize),u_pixels_to_tile_units:new t.UniformMatrix2f(e,r.u_pixels_to_tile_units),u_device_pixel_ratio:new t.Uniform1f(e,r.u_device_pixel_ratio),u_image:new t.Uniform1i(e,r.u_image),u_units_to_pixels:new t.Uniform2f(e,r.u_units_to_pixels),u_scale:new t.Uniform3f(e,r.u_scale),u_fade:new t.Uniform1f(e,r.u_fade),u_alpha_discard_threshold:new t.Uniform1f(e,r.u_alpha_discard_threshold)}),raster:(e,r)=>({u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_tl_parent:new t.Uniform2f(e,r.u_tl_parent),u_scale_parent:new t.Uniform1f(e,r.u_scale_parent),u_fade_t:new t.Uniform1f(e,r.u_fade_t),u_opacity:new t.Uniform1f(e,r.u_opacity),u_image0:new t.Uniform1i(e,r.u_image0),u_image1:new t.Uniform1i(e,r.u_image1),u_brightness_low:new t.Uniform1f(e,r.u_brightness_low),u_brightness_high:new t.Uniform1f(e,r.u_brightness_high),u_saturation_factor:new t.Uniform1f(e,r.u_saturation_factor),u_contrast_factor:new t.Uniform1f(e,r.u_contrast_factor),u_spin_weights:new t.Uniform3f(e,r.u_spin_weights),u_perspective_transform:new t.Uniform2f(e,r.u_perspective_transform)}),symbolIcon:(e,r)=>({u_is_size_zoom_constant:new t.Uniform1i(e,r.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,r.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,r.u_size_t),u_size:new t.Uniform1f(e,r.u_size),u_camera_to_center_distance:new t.Uniform1f(e,r.u_camera_to_center_distance),u_rotate_symbol:new t.Uniform1i(e,r.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,r.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,r.u_fade_change),u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,r.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,r.u_coord_matrix),u_is_text:new t.Uniform1i(e,r.u_is_text),u_pitch_with_map:new t.Uniform1i(e,r.u_pitch_with_map),u_texsize:new t.Uniform2f(e,r.u_texsize),u_tile_id:new t.Uniform3f(e,r.u_tile_id),u_zoom_transition:new t.Uniform1f(e,r.u_zoom_transition),u_inv_rot_matrix:new t.UniformMatrix4f(e,r.u_inv_rot_matrix),u_merc_center:new t.Uniform2f(e,r.u_merc_center),u_camera_forward:new t.Uniform3f(e,r.u_camera_forward),u_tile_matrix:new t.UniformMatrix4f(e,r.u_tile_matrix),u_ecef_origin:new t.Uniform3f(e,r.u_ecef_origin),u_texture:new t.Uniform1i(e,r.u_texture)}),symbolSDF:(e,r)=>({u_is_size_zoom_constant:new t.Uniform1i(e,r.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,r.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,r.u_size_t),u_size:new t.Uniform1f(e,r.u_size),u_camera_to_center_distance:new t.Uniform1f(e,r.u_camera_to_center_distance),u_rotate_symbol:new t.Uniform1i(e,r.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,r.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,r.u_fade_change),u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,r.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,r.u_coord_matrix),u_is_text:new t.Uniform1i(e,r.u_is_text),u_pitch_with_map:new t.Uniform1i(e,r.u_pitch_with_map),u_texsize:new t.Uniform2f(e,r.u_texsize),u_texture:new t.Uniform1i(e,r.u_texture),u_gamma_scale:new t.Uniform1f(e,r.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,r.u_device_pixel_ratio),u_tile_id:new t.Uniform3f(e,r.u_tile_id),u_zoom_transition:new t.Uniform1f(e,r.u_zoom_transition),u_inv_rot_matrix:new t.UniformMatrix4f(e,r.u_inv_rot_matrix),u_merc_center:new t.Uniform2f(e,r.u_merc_center),u_camera_forward:new t.Uniform3f(e,r.u_camera_forward),u_tile_matrix:new t.UniformMatrix4f(e,r.u_tile_matrix),u_ecef_origin:new t.Uniform3f(e,r.u_ecef_origin),u_is_halo:new t.Uniform1i(e,r.u_is_halo)}),symbolTextAndIcon:(e,r)=>({u_is_size_zoom_constant:new t.Uniform1i(e,r.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,r.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,r.u_size_t),u_size:new t.Uniform1f(e,r.u_size),u_camera_to_center_distance:new t.Uniform1f(e,r.u_camera_to_center_distance),u_rotate_symbol:new t.Uniform1i(e,r.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,r.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,r.u_fade_change),u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,r.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,r.u_coord_matrix),u_is_text:new t.Uniform1i(e,r.u_is_text),u_pitch_with_map:new t.Uniform1i(e,r.u_pitch_with_map),u_texsize:new t.Uniform2f(e,r.u_texsize),u_texsize_icon:new t.Uniform2f(e,r.u_texsize_icon),u_texture:new t.Uniform1i(e,r.u_texture),u_texture_icon:new t.Uniform1i(e,r.u_texture_icon),u_gamma_scale:new t.Uniform1f(e,r.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,r.u_device_pixel_ratio),u_is_halo:new t.Uniform1i(e,r.u_is_halo)}),background:(e,r)=>({u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_opacity:new t.Uniform1f(e,r.u_opacity),u_color:new t.UniformColor(e,r.u_color)}),backgroundPattern:(e,r)=>({u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_opacity:new t.Uniform1f(e,r.u_opacity),u_image:new t.Uniform1i(e,r.u_image),u_pattern_tl_a:new t.Uniform2f(e,r.u_pattern_tl_a),u_pattern_br_a:new t.Uniform2f(e,r.u_pattern_br_a),u_pattern_tl_b:new t.Uniform2f(e,r.u_pattern_tl_b),u_pattern_br_b:new t.Uniform2f(e,r.u_pattern_br_b),u_texsize:new t.Uniform2f(e,r.u_texsize),u_mix:new t.Uniform1f(e,r.u_mix),u_pattern_size_a:new t.Uniform2f(e,r.u_pattern_size_a),u_pattern_size_b:new t.Uniform2f(e,r.u_pattern_size_b),u_scale_a:new t.Uniform1f(e,r.u_scale_a),u_scale_b:new t.Uniform1f(e,r.u_scale_b),u_pixel_coord_upper:new t.Uniform2f(e,r.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,r.u_pixel_coord_lower),u_tile_units_to_pixels:new t.Uniform1f(e,r.u_tile_units_to_pixels)}),terrainRaster:lr,terrainDepth:lr,skybox:(e,r)=>({u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_sun_direction:new t.Uniform3f(e,r.u_sun_direction),u_cubemap:new t.Uniform1i(e,r.u_cubemap),u_opacity:new t.Uniform1f(e,r.u_opacity),u_temporal_offset:new t.Uniform1f(e,r.u_temporal_offset)}),skyboxGradient:(e,r)=>({u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_color_ramp:new t.Uniform1i(e,r.u_color_ramp),u_center_direction:new t.Uniform3f(e,r.u_center_direction),u_radius:new t.Uniform1f(e,r.u_radius),u_opacity:new t.Uniform1f(e,r.u_opacity),u_temporal_offset:new t.Uniform1f(e,r.u_temporal_offset)}),skyboxCapture:(e,r)=>({u_matrix_3f:new t.UniformMatrix3f(e,r.u_matrix_3f),u_sun_direction:new t.Uniform3f(e,r.u_sun_direction),u_sun_intensity:new t.Uniform1f(e,r.u_sun_intensity),u_color_tint_r:new t.Uniform4f(e,r.u_color_tint_r),u_color_tint_m:new t.Uniform4f(e,r.u_color_tint_m),u_luminance:new t.Uniform1f(e,r.u_luminance)}),globeRaster:(e,r)=>({u_proj_matrix:new t.UniformMatrix4f(e,r.u_proj_matrix),u_globe_matrix:new t.UniformMatrix4f(e,r.u_globe_matrix),u_merc_matrix:new t.UniformMatrix4f(e,r.u_merc_matrix),u_zoom_transition:new t.Uniform1f(e,r.u_zoom_transition),u_merc_center:new t.Uniform2f(e,r.u_merc_center),u_image0:new t.Uniform1i(e,r.u_image0)}),globeAtmosphere:(e,r)=>({u_center:new t.Uniform2f(e,r.u_center),u_radius:new t.Uniform1f(e,r.u_radius),u_screen_size:new t.Uniform2f(e,r.u_screen_size),u_pixel_ratio:new t.Uniform1f(e,r.u_pixel_ratio),u_opacity:new t.Uniform1f(e,r.u_opacity),u_fadeout_range:new t.Uniform1f(e,r.u_fadeout_range),u_start_color:new t.Uniform3f(e,r.u_start_color),u_end_color:new t.Uniform3f(e,r.u_end_color)})};let Jr;function Kr(e,r,n,i,o,s,a){const l=e.context,u=l.gl,c=e.useProgram("collisionBox"),h=[];let p=0,f=0;for(let x=0;x<i.length;x++){const d=i[x],m=r.getTile(d),g=m.getBucket(n);if(!g)continue;let y=d.projMatrix;0===o[0]&&0===o[1]||(y=e.translatePosMatrix(d.projMatrix,m,o,s));const _=a?g.textCollisionBox:g.iconCollisionBox,v=g.collisionCircleArray;if(v.length>0){const r=t.create(),n=y;t.mul(r,g.placementInvProjMatrix,e.transform.glCoordMatrix),t.mul(r,r,g.placementViewportMatrix),h.push({circleArray:v,circleOffset:f,transform:n,invTransform:r}),p+=v.length/4,f=p}_&&(e.terrain&&e.terrain.setupElevationDraw(m,c),c.draw(l,u.LINES,t.DepthMode.disabled,t.StencilMode.disabled,e.colorModeForRenderPass(),t.CullFaceMode.disabled,zr(y,e.transform,m),n.id,_.layoutVertexBuffer,_.indexBuffer,_.segments,null,e.transform.zoom,null,_.collisionVertexBuffer,_.collisionVertexBufferExt))}if(!a||!h.length)return;const d=e.useProgram("collisionCircle"),m=new t.StructArrayLayout2f1f2i16;m.resize(4*p),m._trim();let g=0;for(const t of h)for(let e=0;e<t.circleArray.length/4;e++){const r=4*e,n=t.circleArray[r+0],i=t.circleArray[r+1],o=t.circleArray[r+2],s=t.circleArray[r+3];m.emplace(g++,n,i,o,s,0),m.emplace(g++,n,i,o,s,1),m.emplace(g++,n,i,o,s,2),m.emplace(g++,n,i,o,s,3)}(!Jr||Jr.length<2*p)&&(Jr=function(e){const r=2*e,n=new t.StructArrayLayout3ui6;n.resize(r),n._trim();for(let t=0;t<r;t++){const e=6*t;n.uint16[e+0]=4*t+0,n.uint16[e+1]=4*t+1,n.uint16[e+2]=4*t+2,n.uint16[e+3]=4*t+2,n.uint16[e+4]=4*t+3,n.uint16[e+5]=4*t+0}return n}(p));const y=l.createIndexBuffer(Jr,!0),_=l.createVertexBuffer(m,t.collisionCircleLayout.members,!0);for(const x of h){const r={u_matrix:x.transform,u_inv_matrix:x.invTransform,u_camera_to_center_distance:(v=e.transform).cameraToCenterDistance,u_viewport_size:[v.width,v.height]};d.draw(l,u.TRIANGLES,t.DepthMode.disabled,t.StencilMode.disabled,e.colorModeForRenderPass(),t.CullFaceMode.disabled,r,n.id,_,y,t.SegmentVector.simpleSegment(0,2*x.circleOffset,x.circleArray.length,x.circleArray.length/2),null,e.transform.zoom,null,null,null)}var v;_.destroy(),y.destroy()}const Qr=t.create();function tn(e,r,n,i,o,s){const{horizontalAlign:a,verticalAlign:l}=t.getAnchorAlignment(e),u=-(a-.5)*r,c=-(l-.5)*n,h=t.evaluateVariableOffset(e,i);return new t.pointGeometry((u/o+h[0])*s,(c/o+h[1])*s)}function en(e,r,n,i,o,s,a,l,u,c,h,p){const f=e.text.placedSymbolArray,d=e.text.dynamicLayoutVertexArray,m=e.icon.dynamicLayoutVertexArray,g={},y=l.projMatrix,_=s.elevation,v=p.upVectorScale(l.canonical,s.center.lat,s.worldSize);d.clear();for(let x=0;x<f.length;x++){const m=f.get(x),b=e.allowVerticalPlacement&&!m.placedOrientation,w=m.hidden||!m.crossTileID||b?null:i[m.crossTileID];if(w){const i=new t.pointGeometry(m.tileAnchorX,m.tileAnchorY),f=p.upVector(l.canonical,i.x,i.y),x=_?_.getAtTileOffset(l,i.x,i.y):0,b=re([m.projectedAnchorX+x*f[0]*v.metersToTile,m.projectedAnchorY+x*f[1]*v.metersToTile,m.projectedAnchorZ+x*f[2]*v.metersToTile],n?y:a),E=ne(s.cameraToCenterDistance,b.signedDistanceFromCamera);let S=o.evaluateSizeForFeature(e.textSizeData,c,m)*E/t.ONE_EM;n&&(S*=e.tilePixelRatio/u);const{width:I,height:T,anchor:C,textOffset:M,textScale:A}=w,P=tn(C,I,T,M,A,S),k=n?ee(i.add(P),a,x*v.metersToLabelSpace).point:b.point.add(r?P.rotate(-s.angle):P),L=e.allowVerticalPlacement&&m.placedOrientation===t.WritingMode.vertical?Math.PI/2:0;for(let e=0;e<m.numGlyphs;e++)t.addDynamicAttributes(d,k,L);h&&m.associatedIconIndex>=0&&(g[m.associatedIconIndex]={shiftedAnchor:k,angle:L})}else fe(m.numGlyphs,d)}if(h){m.clear();const r=e.icon.placedSymbolArray;for(let e=0;e<r.length;e++){const n=r.get(e);if(n.hidden)fe(n.numGlyphs,m);else{const r=g[e];if(r)for(let e=0;e<n.numGlyphs;e++)t.addDynamicAttributes(m,r.shiftedAnchor,r.angle);else fe(n.numGlyphs,m)}}e.icon.dynamicLayoutVertexBuffer.updateData(m)}e.text.dynamicLayoutVertexBuffer.updateData(d)}function rn(t,e,r){return r.iconsInText&&e?"symbolTextAndIcon":t?"symbolSDF":"symbolIcon"}function nn(e,r,n,i,o,s,a,l,u,c,h,p){const f=e.context,d=f.gl,m=e.transform,g=m.projection.createTileTransform(m,m.worldSize),y="map"===l,_="map"===u,v=y&&"point"!==n.layout.get("symbol-placement"),x=y&&!_&&!v,b=void 0!==n.layout.get("symbol-sort-key").constantOr(1);let w=!1;const E=e.depthModeForSublayer(0,t.DepthMode.ReadOnly),S=[t.mercatorXfromLng(m.center.lng),t.mercatorYfromLat(m.center.lat)],I=n.layout.get("text-variable-anchor"),T="globe"===m.projection.name,C=T?t.globeToMercatorTransition(m.zoom):0,M=[],A=[];e.terrain&&_&&A.push("PITCH_WITH_MAP_TERRAIN"),T&&A.push("PROJECTION_GLOBE_VIEW");for(const P of i){const i=r.getTile(P),l=i.getBucket(n);if(!l||l.projection!==m.projection.name)continue;const u=o?l.text:l.icon;if(!u||l.fullyClipped||!u.segments.get().length)continue;const h=u.programConfigurations.get(n.id),p=o||l.sdfIcons,f=o?l.textSizeData:l.iconSizeData,E=_||0!==m.pitch,T=t.evaluateSizeForZoom(f,m.zoom);let k,L,z,D,R=[0,0],O=null;if(o){if(L=i.glyphAtlasTexture,z=d.LINEAR,k=i.glyphAtlasTexture.size,l.iconsInText){R=i.imageAtlasTexture.size,O=i.imageAtlasTexture;const t="composite"===f.kind||"camera"===f.kind;D=E||e.options.rotating||e.options.zooming||t?d.LINEAR:d.NEAREST}}else{const t=1!==n.layout.get("icon-size").constantOr(0)||l.iconsNeedLinear;L=i.imageAtlasTexture,z=p||e.options.rotating||e.options.zooming||t||E?d.LINEAR:d.NEAREST,k=i.imageAtlasTexture.size}const N=e.transform.calculatePixelsToTileUnitsMatrix(i),F=Qt(P.projMatrix,i.tileID.canonical,_,y,e.transform,N),B=e.terrain&&_&&v?t.invert(t.create(),F):Qr,j=te(P.projMatrix,i.tileID.canonical,_,y,e.transform,N),U=I&&l.hasTextData(),V="none"!==n.layout.get("icon-text-fit")&&U&&l.hasIconData();if(v){const t=m.elevation,r=t?t.getAtTileOffsetFunc(P,m.center.lat,m.worldSize,m.projection):t=>[0,0,0];oe(l,P.projMatrix,e,o,F,j,_,c,r,P)}const G=v||o&&I||V,q=e.translatePosMatrix(P.projMatrix,i,s,a),$=G?Qr:F,Z=e.translatePosMatrix(j,i,s,a,!0),X=G?A.concat(["PROJECTED_POS_ON_VIEWPORT"]):A,W=p&&0!==n.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1);let Y;Y=p?l.iconsInText?Xr(f.kind,T,x,_,e,q,$,Z,k,R,P,C,S,g):Zr(f.kind,T,x,_,e,q,$,Z,o,k,!0,P,C,S,g):$r(f.kind,T,x,_,e,q,$,Z,o,k,P,C,S,g);const H={program:e.useProgram(rn(p,o,l),h,X),buffers:u,uniformValues:Y,atlasTexture:L,atlasTextureIcon:O,atlasInterpolation:z,atlasInterpolationIcon:D,isSDF:p,hasHalo:W,tile:i,labelPlaneMatrixInv:B};if(b&&l.canOverlap){w=!0;const e=u.segments.get();for(const r of e)M.push({segments:new t.SegmentVector([r]),sortKey:r.sortKey,state:H})}else M.push({segments:u.segments,sortKey:0,state:H})}w&&M.sort((t,e)=>t.sortKey-e.sortKey);for(const t of M){const r=t.state;if(e.terrain&&e.terrain.setupElevationDraw(r.tile,r.program,{useDepthForOcclusion:!T,labelPlaneMatrixInv:r.labelPlaneMatrixInv}),f.activeTexture.set(d.TEXTURE0),r.atlasTexture.bind(r.atlasInterpolation,d.CLAMP_TO_EDGE),r.atlasTextureIcon&&(f.activeTexture.set(d.TEXTURE1),r.atlasTextureIcon&&r.atlasTextureIcon.bind(r.atlasInterpolationIcon,d.CLAMP_TO_EDGE)),r.isSDF){const i=r.uniformValues;r.hasHalo&&(i.u_is_halo=1,on(r.buffers,t.segments,n,e,r.program,E,h,p,i)),i.u_is_halo=0}on(r.buffers,t.segments,n,e,r.program,E,h,p,r.uniformValues)}}function on(e,r,n,i,o,s,a,l,u){const c=i.context;o.draw(c,c.gl.TRIANGLES,s,a,l,t.CullFaceMode.disabled,u,n.id,e.layoutVertexBuffer,e.indexBuffer,r,n.paint,i.transform.zoom,e.programConfigurations.get(n.id),e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer)}function sn(e,r,n,i,o,s,a){const l=e.context.gl,u=n.paint.get("fill-pattern"),c=u&&u.constantOr(1),h=n.getCrossfadeParameters();let p,f,d,m,g;a?(f=c&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",p=l.LINES):(f=c?"fillPattern":"fill",p=l.TRIANGLES);for(const y of i){const i=r.getTile(y);if(c&&!i.patternsLoaded())continue;const _=i.getBucket(n);if(!_)continue;e.prepareDrawTile();const v=_.programConfigurations.get(n.id),x=e.useProgram(f,v);c&&(e.context.activeTexture.set(l.TEXTURE0),i.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),v.updatePaintBuffers(h));const b=u.constantOr(null);if(b&&i.imageAtlas){const t=i.imageAtlas,e=t.patternPositions[b.to.toString()],r=t.patternPositions[b.from.toString()];e&&r&&v.setConstantPatternPositions(e,r)}const w=e.translatePosMatrix(y.projMatrix,i,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(a){m=_.indexBuffer2,g=_.segments2;const t=e.terrain&&e.terrain.renderingToTexture?e.terrain.drapeBufferSize:[l.drawingBufferWidth,l.drawingBufferHeight];d="fillOutlinePattern"===f&&c?Ar(w,e,h,i,t):Mr(w,t)}else m=_.indexBuffer,g=_.segments,d=c?Cr(w,e,h,i):Tr(w);e.prepareDrawProgram(e.context,x,y.toUnwrapped()),x.draw(e.context,p,o,e.stencilModeForClipping(y),s,t.CullFaceMode.disabled,d,n.id,_.layoutVertexBuffer,m,g,n.paint,e.transform.zoom,v)}}function an(e,r,n,i,o,s,a){const l=e.context,u=l.gl,c=n.paint.get("fill-extrusion-pattern"),h=c.constantOr(1),p=n.getCrossfadeParameters(),f=n.paint.get("fill-extrusion-opacity");for(const d of i){const i=r.getTile(d),m=i.getBucket(n);if(!m)continue;const g=m.programConfigurations.get(n.id),y=e.useProgram(h?"fillExtrusionPattern":"fillExtrusion",g);if(e.terrain){const t=e.terrain;if(!m.enableTerrain)continue;if(t.setupElevationDraw(i,y,{useMeterToDem:!0}),ln(l,r,d,m,n,t),!m.centroidVertexBuffer){const t=y.attributes.a_centroid_pos;void 0!==t&&u.vertexAttrib2f(t,0,0)}}h&&(e.context.activeTexture.set(u.TEXTURE0),i.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),g.updatePaintBuffers(p));const _=c.constantOr(null);if(_&&i.imageAtlas){const t=i.imageAtlas,e=t.patternPositions[_.to.toString()],r=t.patternPositions[_.from.toString()];e&&r&&g.setConstantPatternPositions(e,r)}const v=e.translatePosMatrix(d.projMatrix,i,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),x=n.paint.get("fill-extrusion-vertical-gradient"),b=h?Ir(v,e,x,f,d,p,i):Sr(v,e,x,f);e.prepareDrawProgram(l,y,d.toUnwrapped()),y.draw(l,l.gl.TRIANGLES,o,s,a,t.CullFaceMode.backCCW,b,n.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,n.paint,e.transform.zoom,g,e.terrain?m.centroidVertexBuffer:null)}}function ln(e,r,n,i,o,s){const a=[e=>{let r=e.canonical.x-1,n=e.wrap;return r<0&&(r=(1<<e.canonical.z)-1,n--),new t.OverscaledTileID(e.overscaledZ,n,e.canonical.z,r,e.canonical.y)},e=>{let r=e.canonical.x+1,n=e.wrap;return r===1<<e.canonical.z&&(r=0,n++),new t.OverscaledTileID(e.overscaledZ,n,e.canonical.z,r,e.canonical.y)},e=>new t.OverscaledTileID(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(0===e.canonical.y?1<<e.canonical.z:e.canonical.y)-1),e=>new t.OverscaledTileID(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)],l=t=>{const e=r.getSource().maxzoom,n=t=>{const e=r.getTileByID(t);if(e&&e.hasData())return e.getBucket(o)};let i,s,a;return(t.overscaledZ===t.canonical.z||t.overscaledZ>=e)&&(i=n(t.key)),t.overscaledZ>=e&&(s=n(t.calculateScaledKey(t.overscaledZ+1))),t.overscaledZ>e&&(a=n(t.calculateScaledKey(t.overscaledZ-1))),i||s||a},u=[0,0,0],c=(e,r)=>(u[0]=Math.min(e.min.y,r.min.y),u[1]=Math.max(e.max.y,r.max.y),u[2]=t.EXTENT-r.min.x>e.max.x?r.min.x-t.EXTENT:e.max.x,u),h=(e,r)=>(u[0]=Math.min(e.min.x,r.min.x),u[1]=Math.max(e.max.x,r.max.x),u[2]=t.EXTENT-r.min.y>e.max.y?r.min.y-t.EXTENT:e.max.y,u),p=[(t,e)=>c(t,e),(t,e)=>c(e,t),(t,e)=>h(t,e),(t,e)=>h(e,t)],f=new t.pointGeometry(0,0);let d,m,g;const y=(e,r,i,o,a)=>{const l=[[o?i:e,o?e:i,0],[o?i:r,o?r:i,0]],u=a<0?t.EXTENT+a:a,c=[o?u:(e+r)/2,o?(e+r)/2:u,0];return 0===i&&a<0||0!==i&&a>0?s.getForTilePoints(g,[c],!0,m):l.push(c),s.getForTilePoints(n,l,!0,d),Math.max(l[0][2],l[1][2],c[2])/s.exaggeration()};for(let _=0;_<4;_++){const e=i.borders[_];if(0===e.length&&(i.borderDone[_]=!0),i.borderDone[_])continue;const r=g=a[_](n),o=l(r);if(!o||!o.enableTerrain)continue;if(m=s.findDEMTileFor(r),!m||!m.dem)continue;if(!d){const t=s.findDEMTileFor(n);if(!t||!t.dem)return;d=t}const u=(_<2?1:5)-_,c=o.borders[u];let h=0;for(let n=0;n<e.length;n++){const r=i.featuresOnBorder[e[n]],s=r.borders[_];let a;for(;h<c.length&&(a=o.featuresOnBorder[c[h]],!(a.borders[u][1]>s[0]+3));)o.borderDone[u]||o.encodeCentroid(void 0,a,!1),h++;if(a&&h<c.length){const e=h;let n=0;for(;!(a.borders[u][0]>s[1]-3)&&(n++,++h!==c.length);)a=o.featuresOnBorder[c[h]];if(a=o.featuresOnBorder[c[e]],r.intersectsCount()>1||a.intersectsCount()>1||1!==n){1!==n&&(h=e),i.encodeCentroid(void 0,r,!1),o.borderDone[u]||o.encodeCentroid(void 0,a,!1);continue}const l=p[_](r,a),d=_%2?t.EXTENT-1:0;f.x=y(l[0],Math.min(t.EXTENT-1,l[1]),d,_<2,l[2]),f.y=0,i.encodeCentroid(f,r,!1),o.borderDone[u]||o.encodeCentroid(f,a,!1)}else i.encodeCentroid(void 0,r,!1)}i.borderDone[_]=i.needsCentroidUpdate=!0,o.borderDone[u]||(o.borderDone[u]=o.needsCentroidUpdate=!0)}(i.needsCentroidUpdate||!i.centroidVertexBuffer&&0!==i.centroidVertexArray.length)&&i.uploadCentroid(e)}const un=new t.Color(1,0,0,1),cn=new t.Color(0,1,0,1),hn=new t.Color(0,0,1,1),pn=new t.Color(1,0,1,1),fn=new t.Color(0,1,1,1);function dn(t,e,r,n){gn(t,0,e+r/2,t.transform.width,r,n)}function mn(t,e,r,n){gn(t,e-r/2,0,r,t.transform.height,n)}function gn(e,r,n,i,o,s){const a=e.context,l=a.gl;l.enable(l.SCISSOR_TEST),l.scissor(r*t.exported.devicePixelRatio,n*t.exported.devicePixelRatio,i*t.exported.devicePixelRatio,o*t.exported.devicePixelRatio),a.clear({color:s}),l.disable(l.SCISSOR_TEST)}function yn(e,r,n){const i=e.context,o=i.gl,s=n.projMatrix,a=e.useProgram("debug"),l=r.getTileByID(n.key);e.terrain&&e.terrain.setupElevationDraw(l,a);const u=t.DepthMode.disabled,c=t.StencilMode.disabled,h=e.colorModeForRenderPass(),p="$debug";i.activeTexture.set(o.TEXTURE0),e.emptyTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE),l._makeDebugTileBoundsBuffers(e.context,e.transform.projection);const f=l._tileDebugBuffer||e.debugBuffer,d=l._tileDebugIndexBuffer||e.debugIndexBuffer,m=l._tileDebugSegments||e.debugSegments;a.draw(i,o.LINE_STRIP,u,c,h,t.CullFaceMode.disabled,Dr(s,t.Color.red),p,f,d,m);const g=l.latestRawTileData,y=Math.floor((g&&g.byteLength||0)/1024),_=r.getTile(n).tileSize,v=512/Math.min(_,512)*(n.overscaledZ/e.transform.zoom)*.5;let x=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(x+=` => ${n.overscaledZ}`),function(t,e){t.initDebugOverlayCanvas();const r=t.debugOverlayCanvas,n=t.context.gl,i=t.debugOverlayCanvas.getContext("2d");i.clearRect(0,0,r.width,r.height),i.shadowColor="white",i.shadowBlur=2,i.lineWidth=1.5,i.strokeStyle="white",i.textBaseline="top",i.font="bold 36px Open Sans, sans-serif",i.fillText(e,5,5),i.strokeText(e,5,5),t.debugOverlayTexture.update(r),t.debugOverlayTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}(e,`${x} ${y}kb`),a.draw(i,o.TRIANGLES,u,c,t.ColorMode.alphaBlended,t.CullFaceMode.disabled,Dr(s,t.Color.transparent,v),p,e.debugBuffer,e.quadTriangleIndexBuffer,e.debugSegments)}const _n=t.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:vn}=_n;function xn(t,e,r,n){t.emplaceBack(e,r,n)}class bn{constructor(e){this.vertexArray=new t.StructArrayLayout3f12,this.indices=new t.StructArrayLayout3ui6,xn(this.vertexArray,-1,-1,1),xn(this.vertexArray,1,-1,1),xn(this.vertexArray,-1,1,1),xn(this.vertexArray,1,1,1),xn(this.vertexArray,-1,-1,-1),xn(this.vertexArray,1,-1,-1),xn(this.vertexArray,-1,1,-1),xn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=e.createVertexBuffer(this.vertexArray,vn),this.indexBuffer=e.createIndexBuffer(this.indices),this.segment=t.SegmentVector.simpleSegment(0,0,36,12)}}function wn(e,r,n,i,o,s){const a=e.gl,l=r.paint.get("sky-atmosphere-color"),u=r.paint.get("sky-atmosphere-halo-color"),c=r.paint.get("sky-atmosphere-sun-intensity"),h=((t,e,r,n,i)=>({u_matrix_3f:t,u_sun_direction:e,u_sun_intensity:r,u_color_tint_r:[n.r,n.g,n.b,n.a],u_color_tint_m:[i.r,i.g,i.b,i.a],u_luminance:5e-5}))(t.fromMat4(t.create$1(),i),o,c,l,u);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+s,r.skyboxTexture,0),n.draw(e,a.TRIANGLES,t.DepthMode.disabled,t.StencilMode.disabled,t.ColorMode.unblended,t.CullFaceMode.frontCW,h,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const En={symbol:function(e,r,n,i,o){if("translucent"!==e.renderPass)return;const s=t.StencilMode.disabled,a=e.colorModeForRenderPass();n.layout.get("text-variable-anchor")&&function(e,r,n,i,o,s,a){const l=r.transform,u="map"===o,c="map"===s;for(const h of e){const e=i.getTile(h),o=e.getBucket(n);if(!o||o.projection!==l.projection.name||!o.text||!o.text.segments.get().length)continue;const s=t.evaluateSizeForZoom(o.textSizeData,l.zoom),p=r.transform.calculatePixelsToTileUnitsMatrix(e),f=Qt(h.projMatrix,e.tileID.canonical,c,u,r.transform,p),d="none"!==n.layout.get("icon-text-fit")&&o.hasIconData();if(s){const r=Math.pow(2,l.zoom-e.tileID.overscaledZ);en(o,u,c,a,t.symbolSize,l,f,h,r,s,d,l.projection)}}}(i,e,n,r,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),o),0!==n.paint.get("icon-opacity").constantOr(1)&&nn(e,r,n,i,!1,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),n.layout.get("icon-rotation-alignment"),n.layout.get("icon-pitch-alignment"),n.layout.get("icon-keep-upright"),s,a),0!==n.paint.get("text-opacity").constantOr(1)&&nn(e,r,n,i,!0,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),n.layout.get("text-keep-upright"),s,a),r.map.showCollisionBoxes&&(Kr(e,r,n,i,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),Kr(e,r,n,i,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(e,r,n,i){if("translucent"!==e.renderPass)return;const o=n.paint.get("circle-opacity"),s=n.paint.get("circle-stroke-width"),a=n.paint.get("circle-stroke-opacity"),l=void 0!==n.layout.get("circle-sort-key").constantOr(1);if(0===o.constantOr(1)&&(0===s.constantOr(1)||0===a.constantOr(1)))return;const u=e.context,c=u.gl,h=e.transform,p=e.depthModeForSublayer(0,t.DepthMode.ReadOnly),f=t.StencilMode.disabled,d=e.colorModeForRenderPass(),m="globe"===h.projection.name,g=h.projection.createTileTransform(h,h.worldSize),y=[t.mercatorXfromLng(h.center.lng),t.mercatorYfromLat(h.center.lat)],_=[];for(let x=0;x<i.length;x++){const o=i[x],s=r.getTile(o),a=s.getBucket(n);if(!a)continue;const u=a.programConfigurations.get(n.id),c=Lr(n);m&&c.push("PROJECTION_GLOBE_VIEW");const h={programConfiguration:u,program:e.useProgram("circle",u,c),layoutVertexBuffer:a.layoutVertexBuffer,globeExtVertexBuffer:a.globeExtVertexBuffer,indexBuffer:a.indexBuffer,uniformValues:kr(e,o,s,g,y,n),tile:s};if(l){const e=a.segments.get();for(const r of e)_.push({segments:new t.SegmentVector([r]),sortKey:r.sortKey,state:h})}else _.push({segments:a.segments,sortKey:0,state:h})}l&&_.sort((t,e)=>t.sortKey-e.sortKey);const v={useDepthForOcclusion:!m};for(const x of _){const{programConfiguration:r,program:i,layoutVertexBuffer:o,globeExtVertexBuffer:s,indexBuffer:a,uniformValues:l,tile:g}=x.state,y=x.segments;e.terrain&&e.terrain.setupElevationDraw(g,i,v),e.prepareDrawProgram(u,i,g.tileID.toUnwrapped()),i.draw(u,c.TRIANGLES,p,f,d,t.CullFaceMode.disabled,l,n.id,o,a,y,n.paint,h.zoom,r,m?s:null)}},heatmap:function(e,r,n,i){if(0!==n.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){const o=e.context,s=o.gl,a=t.StencilMode.disabled,l=new t.ColorMode([s.ONE,s.ONE],t.Color.transparent,[!0,!0,!0,!0]);!function(t,e,r){const n=t.gl;t.activeTexture.set(n.TEXTURE1),t.viewport.set([0,0,e.width/4,e.height/4]);let i=r.heatmapFbo;if(i)n.bindTexture(n.TEXTURE_2D,i.colorAttachment.get()),t.bindFramebuffer.set(i.framebuffer);else{const o=n.createTexture();n.bindTexture(n.TEXTURE_2D,o),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),i=r.heatmapFbo=t.createFramebuffer(e.width/4,e.height/4,!1),function(t,e,r,n){const i=t.gl;i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e.width/4,e.height/4,0,i.RGBA,t.extRenderToTextureHalfFloat?t.extTextureHalfFloat.HALF_FLOAT_OES:i.UNSIGNED_BYTE,null),n.colorAttachment.set(r)}(t,e,o,i)}}(o,e,n),o.clear({color:t.Color.transparent});const u=e.transform,c="globe"===u.projection.name,h=c?["PROJECTION_GLOBE_VIEW"]:null,p=u.projection.createTileTransform(u,u.worldSize),f=[t.mercatorXfromLng(u.center.lng),t.mercatorYfromLat(u.center.lat)];for(let d=0;d<i.length;d++){const u=i[d];if(r.hasRenderableParent(u))continue;const m=r.getTile(u),g=m.getBucket(n);if(!g)continue;const y=g.programConfigurations.get(n.id),_=e.useProgram("heatmap",y,h),{zoom:v}=e.transform;e.terrain&&e.terrain.setupElevationDraw(m,_),e.prepareDrawProgram(o,_,u.toUnwrapped()),_.draw(o,s.TRIANGLES,t.DepthMode.disabled,a,l,t.CullFaceMode.disabled,Or(e,u,m,p,f,v,n.paint.get("heatmap-intensity")),n.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,n.paint,e.transform.zoom,y,c?g.globeExtVertexBuffer:null)}o.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,r){const n=e.context,i=n.gl,o=r.heatmapFbo;if(!o)return;n.activeTexture.set(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,o.colorAttachment.get()),n.activeTexture.set(i.TEXTURE1);let s=r.colorRampTexture;s||(s=r.colorRampTexture=new t.Texture(n,r.colorRamp,i.RGBA)),s.bind(i.LINEAR,i.CLAMP_TO_EDGE),e.useProgram("heatmapTexture").draw(n,i.TRIANGLES,t.DepthMode.disabled,t.StencilMode.disabled,e.colorModeForRenderPass(),t.CullFaceMode.disabled,((t,e,r,n)=>({u_image:0,u_color_ramp:1,u_opacity:e.paint.get("heatmap-opacity")}))(0,r),r.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,r.paint,e.transform.zoom)}(e,n))},line:function(e,r,n,i){if("translucent"!==e.renderPass)return;const o=n.paint.get("line-opacity"),s=n.paint.get("line-width");if(0===o.constantOr(1)||0===s.constantOr(1))return;const a=e.depthModeForSublayer(0,t.DepthMode.ReadOnly),l=e.colorModeForRenderPass(),u=n.paint.get("line-dasharray"),c=u.constantOr(1),h=n.layout.get("line-cap"),p=n.paint.get("line-pattern"),f=p.constantOr(1),d=n.paint.get("line-gradient"),m=n.getCrossfadeParameters(),g=f?"linePattern":"line",y=e.context,_=y.gl,v=(t=>{const e=[];Ur(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const r=t.paint.get("line-pattern").constantOr(1),n=1!==t.paint.get("line-opacity").constantOr(1);return!r&&n&&e.push("RENDER_LINE_ALPHA_DISCARD"),e})(n);let x=v.includes("RENDER_LINE_ALPHA_DISCARD");e.terrain&&e.terrain.clipOrMaskOverlapStencilType()&&(x=!1);for(const b of i){const i=r.getTile(b);if(f&&!i.patternsLoaded())continue;const o=i.getBucket(n);if(!o)continue;e.prepareDrawTile();const s=o.programConfigurations.get(n.id),w=e.useProgram(g,s,v),E=p.constantOr(null);if(E&&i.imageAtlas){const t=i.imageAtlas,e=t.patternPositions[E.to.toString()],r=t.patternPositions[E.from.toString()];e&&r&&s.setConstantPatternPositions(e,r)}const S=u.constantOr(null),I=h.constantOr(null);if(!f&&S&&I&&i.lineAtlas){const t=i.lineAtlas,e=t.getDash(S.to,I),r=t.getDash(S.from,I);e&&r&&s.setConstantPatternPositions(e,r)}const T=e.terrain?b.projMatrix:null,C=f?Fr(e,i,n,m,T):Nr(e,i,n,m,T,o.lineClipsArray.length);if(d){const i=o.gradients[n.id];let s=i.texture;if(n.gradientVersion!==i.version){let a=256;if(n.stepInterpolant){const n=r.getSource().maxzoom,i=b.canonical.z===n?Math.ceil(1<<e.transform.maxZoom-b.canonical.z):1;a=t.clamp(t.nextPowerOfTwo(o.maxLineLength/t.EXTENT*1024*i),256,y.maxTextureSize)}i.gradient=t.renderColorRamp({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:a,image:i.gradient||void 0,clips:o.lineClipsArray}),i.texture?i.texture.update(i.gradient):i.texture=new t.Texture(y,i.gradient,_.RGBA),i.version=n.gradientVersion,s=i.texture}y.activeTexture.set(_.TEXTURE1),s.bind(n.stepInterpolant?_.NEAREST:_.LINEAR,_.CLAMP_TO_EDGE)}c&&(y.activeTexture.set(_.TEXTURE0),i.lineAtlasTexture.bind(_.LINEAR,_.REPEAT),s.updatePaintBuffers(m)),f&&(y.activeTexture.set(_.TEXTURE0),i.imageAtlasTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),s.updatePaintBuffers(m)),e.prepareDrawProgram(y,w,b.toUnwrapped());const M=r=>{w.draw(y,_.TRIANGLES,a,r,l,t.CullFaceMode.disabled,C,n.id,o.layoutVertexBuffer,o.indexBuffer,o.segments,n.paint,e.transform.zoom,s,o.layoutVertexBuffer2)};if(x){const r=e.stencilModeForClipping(b).ref;0===r&&e.terrain&&y.clear({stencil:0});const n={func:_.EQUAL,mask:255};C.u_alpha_discard_threshold=.8,M(new t.StencilMode(n,r,255,_.KEEP,_.KEEP,_.INVERT)),C.u_alpha_discard_threshold=0,M(new t.StencilMode(n,r,255,_.KEEP,_.KEEP,_.KEEP))}else M(e.stencilModeForClipping(b))}x&&(e.resetStencilClippingMasks(),e.terrain&&y.clear({stencil:0}))},fill:function(e,r,n,i){const o=n.paint.get("fill-color"),s=n.paint.get("fill-opacity");if(0===s.constantOr(1))return;const a=e.colorModeForRenderPass(),l=n.paint.get("fill-pattern"),u=e.opaquePassEnabledForLayer()&&!l.constantOr(1)&&1===o.constantOr(t.Color.transparent).a&&1===s.constantOr(0)?"opaque":"translucent";if(e.renderPass===u){const o=e.depthModeForSublayer(1,"opaque"===e.renderPass?t.DepthMode.ReadWrite:t.DepthMode.ReadOnly);sn(e,r,n,i,o,a,!1)}if("translucent"===e.renderPass&&n.paint.get("fill-antialias")){const o=e.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,t.DepthMode.ReadOnly);sn(e,r,n,i,o,a,!0)}},"fill-extrusion":function(e,r,n,i){const o=n.paint.get("fill-extrusion-opacity");if(0!==o&&"translucent"===e.renderPass){const s=new t.DepthMode(e.context.gl.LEQUAL,t.DepthMode.ReadWrite,e.depthRangeFor3D);if(1!==o||n.paint.get("fill-extrusion-pattern").constantOr(1))an(e,r,n,i,s,t.StencilMode.disabled,t.ColorMode.disabled),an(e,r,n,i,s,e.stencilModeFor3D(),e.colorModeForRenderPass()),e.resetStencilClippingMasks();else{const o=e.colorModeForRenderPass();an(e,r,n,i,s,t.StencilMode.disabled,o)}}},hillshade:function(e,r,n,i){if("offscreen"!==e.renderPass&&"translucent"!==e.renderPass)return;const o=e.context,s=e.depthModeForSublayer(0,t.DepthMode.ReadOnly),a=e.colorModeForRenderPass(),l=e.terrain&&e.terrain.renderingToTexture,[u,c]="translucent"!==e.renderPass||l?[{},i]:e.stencilConfigForOverlap(i);for(const h of c){const i=r.getTile(h);if(i.needsHillshadePrepare&&"offscreen"===e.renderPass)ar(e,i,n,s,t.StencilMode.disabled,a);else if("translucent"===e.renderPass){const t=l&&e.terrain?e.terrain.stencilModeForRTTOverlap(h):u[h.overscaledZ];or(e,h,i,n,s,t,a)}}o.viewport.set([0,0,e.width,e.height]),e.resetStencilClippingMasks()},raster:function(e,r,n,i,o,s){if("translucent"!==e.renderPass)return;if(0===n.paint.get("raster-opacity"))return;if(!i.length)return;const a=e.context,l=a.gl,u=r.getSource(),c=e.useProgram("raster"),h=e.colorModeForRenderPass(),p=e.terrain&&e.terrain.renderingToTexture,[f,d]=u instanceof Mt||p?[{},i]:e.stencilConfigForOverlap(i),m=d[d.length-1].overscaledZ,g=!e.options.moving;for(const y of d){const i=p?t.DepthMode.disabled:e.depthModeForSublayer(y.overscaledZ-m,1===n.paint.get("raster-opacity")?t.DepthMode.ReadWrite:t.DepthMode.ReadOnly,l.LESS),o=y.toUnwrapped(),d=r.getTile(y);if(p&&(!d||!d.hasData()))continue;const _=p?y.projMatrix:e.transform.calculateProjMatrix(o,g),v=e.terrain&&p?e.terrain.stencilModeForRTTOverlap(y):f[y.overscaledZ],x=s?0:n.paint.get("raster-fade-duration");d.registerFadeDuration(x);const b=r.findLoadedParent(y,0),w=gr(d,b,r,e.transform,x);let E,S;e.terrain&&e.terrain.prepareDrawTile();const I="nearest"===n.paint.get("raster-resampling")?l.NEAREST:l.LINEAR;a.activeTexture.set(l.TEXTURE0),d.texture.bind(I,l.CLAMP_TO_EDGE),a.activeTexture.set(l.TEXTURE1),b?(b.texture.bind(I,l.CLAMP_TO_EDGE),E=Math.pow(2,b.tileID.overscaledZ-d.tileID.overscaledZ),S=[d.tileID.canonical.x*E%1,d.tileID.canonical.y*E%1]):d.texture.bind(I,l.CLAMP_TO_EDGE);const T=Vr(_,S||[0,0],E||1,w,n,u instanceof Mt?u.perspectiveTransform:[0,0]);if(e.prepareDrawProgram(a,c,o),u instanceof Mt)u.boundsBuffer&&u.boundsSegments&&c.draw(a,l.TRIANGLES,i,t.StencilMode.disabled,h,t.CullFaceMode.disabled,T,n.id,u.boundsBuffer,e.quadTriangleIndexBuffer,u.boundsSegments);else{const{tileBoundsBuffer:r,tileBoundsIndexBuffer:o,tileBoundsSegments:s}=e.getTileBoundsBuffers(d);c.draw(a,l.TRIANGLES,i,v,h,t.CullFaceMode.disabled,T,n.id,r,o,s)}}e.resetStencilClippingMasks()},background:function(e,r,n,i){const o=n.paint.get("background-color"),s=n.paint.get("background-opacity");if(0===s)return;const a=e.context,l=a.gl,u=e.transform,c=u.tileSize,h=n.paint.get("background-pattern");if(e.isPatternMissing(h))return;const p=!h&&1===o.a&&1===s&&e.opaquePassEnabledForLayer()?"opaque":"translucent";if(e.renderPass!==p)return;const f=t.StencilMode.disabled,d=e.depthModeForSublayer(0,"opaque"===p?t.DepthMode.ReadWrite:t.DepthMode.ReadOnly),m=e.colorModeForRenderPass(),g=e.useProgram(h?"backgroundPattern":"background");let y,_=i;_||(y=e.getBackgroundTiles(),_=Object.values(y).map(t=>t.tileID)),h&&(a.activeTexture.set(l.TEXTURE0),e.imageManager.bind(e.context));const v=n.getCrossfadeParameters();for(const x of _){const p=x.toUnwrapped(),_=i?x.projMatrix:e.transform.calculateProjMatrix(p);e.prepareDrawTile();const b=r?r.getTile(x):y?y[x.key]:new t.Tile(x,c,u.zoom,e),w=h?Yr(_,s,e,h,{tileID:x,tileSize:c},v):Wr(_,s,o);e.prepareDrawProgram(a,g,p);const{tileBoundsBuffer:E,tileBoundsIndexBuffer:S,tileBoundsSegments:I}=e.getTileBoundsBuffers(b);g.draw(a,l.TRIANGLES,d,f,m,t.CullFaceMode.disabled,w,n.id,E,S,I)}},sky:function(e,r,n){const i=e.transform,o="mercator"===i.projection.name||"globe"===i.projection.name?1:t.smoothstep(7,8,i.zoom),s=n.paint.get("sky-opacity")*o;if(0===s)return;const a=e.context,l=n.paint.get("sky-type"),u=new t.DepthMode(a.gl.LEQUAL,t.DepthMode.ReadOnly,[0,1]),c=e.frameCounter/1e3%1;"atmosphere"===l?"offscreen"===e.renderPass?n.needsSkyboxCapture(e)&&(function(e,r,n,i){const o=e.context,s=o.gl;let a=r.skyboxFbo;if(!a){a=r.skyboxFbo=o.createFramebuffer(32,32,!1),r.skyboxGeometry=new bn(o),r.skyboxTexture=o.gl.createTexture(),s.bindTexture(s.TEXTURE_CUBE_MAP,r.skyboxTexture),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR);for(let t=0;t<6;++t)s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,s.RGBA,32,32,0,s.RGBA,s.UNSIGNED_BYTE,null)}o.bindFramebuffer.set(a.framebuffer),o.viewport.set([0,0,32,32]);const l=r.getCenter(e,!0),u=e.useProgram("skyboxCapture"),c=new Float64Array(16);t.identity(c),t.rotateY(c,c,.5*-Math.PI),wn(o,r,u,c,l,0),t.identity(c),t.rotateY(c,c,.5*Math.PI),wn(o,r,u,c,l,1),t.identity(c),t.rotateX(c,c,.5*-Math.PI),wn(o,r,u,c,l,2),t.identity(c),t.rotateX(c,c,.5*Math.PI),wn(o,r,u,c,l,3),t.identity(c),wn(o,r,u,c,l,4),t.identity(c),t.rotateY(c,c,Math.PI),wn(o,r,u,c,l,5),o.viewport.set([0,0,e.width,e.height])}(e,n),n.markSkyboxValid(e)):"sky"===e.renderPass&&function(e,r,n,i,o){const s=e.context,a=s.gl,l=e.transform,u=e.useProgram("skybox");s.activeTexture.set(a.TEXTURE0),a.bindTexture(a.TEXTURE_CUBE_MAP,r.skyboxTexture);const c=((t,e,r,n,i)=>({u_matrix:t,u_sun_direction:e,u_cubemap:0,u_opacity:n,u_temporal_offset:i}))(l.skyboxMatrix,r.getCenter(e,!1),0,i,o);e.prepareDrawProgram(s,u),u.draw(s,a.TRIANGLES,n,t.StencilMode.disabled,e.colorModeForRenderPass(),t.CullFaceMode.backCW,c,"skybox",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}(e,n,u,s,c):"gradient"===l&&"sky"===e.renderPass&&function(e,r,n,i,o){const s=e.context,a=s.gl,l=e.transform,u=e.useProgram("skyboxGradient");r.skyboxGeometry||(r.skyboxGeometry=new bn(s)),s.activeTexture.set(a.TEXTURE0);let c=r.colorRampTexture;c||(c=r.colorRampTexture=new t.Texture(s,r.colorRamp,a.RGBA)),c.bind(a.LINEAR,a.CLAMP_TO_EDGE);const h=((e,r,n,i,o)=>({u_matrix:e,u_color_ramp:0,u_center_direction:r,u_radius:t.degToRad(n),u_opacity:i,u_temporal_offset:o}))(l.skyboxMatrix,r.getCenter(e,!1),r.paint.get("sky-gradient-radius"),i,o);e.prepareDrawProgram(s,u),u.draw(s,a.TRIANGLES,n,t.StencilMode.disabled,e.colorModeForRenderPass(),t.CullFaceMode.backCW,h,"skyboxGradient",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}(e,n,u,s,c)},debug:function(t,e,r){for(let n=0;n<r.length;n++)yn(t,e,r[n])},custom:function(e,r,n){const i=e.context,o=n.implementation;if(e.transform.projection.unsupportedLayers&&e.transform.projection.unsupportedLayers.includes("custom"))t.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===e.renderPass){const t=o.prerender;t&&(e.setCustomLayerDefaults(),i.setColorMode(e.colorModeForRenderPass()),t.call(o,i.gl,e.transform.customLayerMatrix()),i.setDirty(),e.setBaseState())}else if("translucent"===e.renderPass){e.setCustomLayerDefaults(),i.setColorMode(e.colorModeForRenderPass()),i.setStencilMode(t.StencilMode.disabled);const r="3d"===o.renderingMode?new t.DepthMode(e.context.gl.LEQUAL,t.DepthMode.ReadWrite,e.depthRangeFor3D):e.depthModeForSublayer(0,t.DepthMode.ReadOnly);i.setDepthMode(r),o.render(i.gl,e.transform.customLayerMatrix()),i.setDirty(),e.setBaseState(),i.bindFramebuffer.set(null)}}};class Sn{constructor(e,r){this.context=new xt(e),this.transform=r,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=t.SourceCache.maxUnderzooming+t.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ve,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(t,e){const r=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(r||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new xr(this,t));const n=this._terrain;this.transform.elevation=r?n:null,n.update(t,this.transform,e)}_updateFog(t){const e=t.fog;if(!e||e.getOpacity(this.transform.pitch)<1||e.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[r,n]=e.getFovAdjustedRange(this.transform._fov);if(r>n)return void(this.transform.fogCullDistSq=null);const i=r+.78*(n-r);this.transform.fogCullDistSq=i*i}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(e,r){if(this.width=e*t.exported.devicePixelRatio,this.height=r*t.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const t of this.style.order)this.style._layers[t].resize()}setup(){const e=this.context,r=new t.StructArrayLayout2i4;r.emplaceBack(0,0),r.emplaceBack(t.EXTENT,0),r.emplaceBack(0,t.EXTENT),r.emplaceBack(t.EXTENT,t.EXTENT),this.tileExtentBuffer=e.createVertexBuffer(r,t.posAttributes.members),this.tileExtentSegments=t.SegmentVector.simpleSegment(0,0,4,2);const n=new t.StructArrayLayout2i4;n.emplaceBack(0,0),n.emplaceBack(t.EXTENT,0),n.emplaceBack(0,t.EXTENT),n.emplaceBack(t.EXTENT,t.EXTENT),this.debugBuffer=e.createVertexBuffer(n,t.posAttributes.members),this.debugSegments=t.SegmentVector.simpleSegment(0,0,4,5);const i=new t.StructArrayLayout2i4;i.emplaceBack(-1,-1),i.emplaceBack(1,-1),i.emplaceBack(-1,1),i.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(i,t.posAttributes.members),this.viewportSegments=t.SegmentVector.simpleSegment(0,0,4,2);const o=new t.StructArrayLayout4i8;o.emplaceBack(0,0,0,0),o.emplaceBack(t.EXTENT,0,t.EXTENT,0),o.emplaceBack(0,t.EXTENT,0,t.EXTENT),o.emplaceBack(t.EXTENT,t.EXTENT,t.EXTENT,t.EXTENT),this.mercatorBoundsBuffer=e.createVertexBuffer(o,t.boundsAttributes.members),this.mercatorBoundsSegments=t.SegmentVector.simpleSegment(0,0,4,2);const s=new t.StructArrayLayout3ui6;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(s);const a=new t.StructArrayLayout1ui2;for(const t of[0,1,3,2,0])a.emplaceBack(t);this.debugIndexBuffer=e.createIndexBuffer(a),this.emptyTexture=new t.Texture(e,new t.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),e.gl.RGBA),this.identityMat=t.create();const l=this.context.gl;this.stencilClearMode=new t.StencilMode({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(t.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const e=this.context,r=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(e,r.TRIANGLES,t.DepthMode.disabled,this.stencilClearMode,t.ColorMode.disabled,t.CullFaceMode.disabled,mr(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(e,r,n){if(!r||this.currentStencilSource===r.id||!e.isTileClipped()||!n||0===n.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let t=!1;for(const e of n)if(void 0===this._tileClippingMaskIDs[e.key]){t=!0;break}if(!t)return}this.currentStencilSource=r.id;const i=this.context,o=i.gl;this.nextStencilID+n.length>256&&this.clearStencil(),i.setColorMode(t.ColorMode.disabled),i.setDepthMode(t.DepthMode.disabled);const s=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const a of n){const e=r.getTile(a),n=this._tileClippingMaskIDs[a.key]=this.nextStencilID++,{tileBoundsBuffer:l,tileBoundsIndexBuffer:u,tileBoundsSegments:c}=this.getTileBoundsBuffers(e);s.draw(i,o.TRIANGLES,t.DepthMode.disabled,new t.StencilMode({func:o.ALWAYS,mask:0},n,255,o.KEEP,o.KEEP,o.REPLACE),t.ColorMode.disabled,t.CullFaceMode.disabled,mr(a.projMatrix),"$clipping",l,u,c)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,r=this.context.gl;return new t.StencilMode({func:r.NOTEQUAL,mask:255},e,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(e){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(e);const r=this.context.gl;return new t.StencilMode({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,r.KEEP,r.KEEP,r.REPLACE)}stencilConfigForOverlap(e){const r=this.context.gl,n=e.sort((t,e)=>e.overscaledZ-t.overscaledZ),i=n[n.length-1].overscaledZ,o=n[0].overscaledZ-i+1;if(o>1){this.currentStencilSource=void 0,this.nextStencilID+o>256&&this.clearStencil();const e={};for(let n=0;n<o;n++)e[n+i]=new t.StencilMode({func:r.GEQUAL,mask:255},n+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=o,[e,n]}return[{[i]:t.StencilMode.disabled},n]}colorModeForRenderPass(){const e=this.context.gl;if(this._showOverdrawInspector){const r=1/8;return new t.ColorMode([e.CONSTANT_COLOR,e.ONE],new t.Color(r,r,r,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?t.ColorMode.unblended:t.ColorMode.alphaBlended}depthModeForSublayer(e,r,n){if(!this.opaquePassEnabledForLayer())return t.DepthMode.disabled;const i=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new t.DepthMode(n||this.context.gl.LEQUAL,r,[i,i])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,r){this.style=e,this.options=r,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(t.exported.now()),this.imageManager.beginFrame();const n=this.style.order,i=this.style._sourceCaches;for(const t in i){const e=i[t];e.used&&e.prepare(this.context)}const o={},s={},a={};for(const t in i){const e=i[t];o[t]=e.getVisibleCoordinates(),s[t]=o[t].slice().reverse(),a[t]=e.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let t=0;t<n.length;t++)if(this.style._layers[n[t]].is3D()){this.opaquePassCutoff=t;break}if(this.terrain&&(this.terrain.updateTileBinding(a),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new t.GlobeSharedBuffers(this.context)),!t.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const t of n){const r=this.style._layers[t],n=e._getLayerSourceCache(r);if(!r.hasOffscreenPass()||r.isHidden(this.transform.zoom))continue;const i=n?s[n.id]:void 0;("custom"===r.type||r.isSky()||i&&i.length)&&this.renderLayer(this,n,r,i)}this.depthRangeFor3D=[0,1-(e.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let l=t.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(l=this.style.fog.properties.get("color")),this.context.clear({color:r.showOverdrawInspector?t.Color.black:l,depth:1}),this.clearStencil(),this._showOverdrawInspector=r.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=n.length-1;this.currentLayer>=0;this.currentLayer--){const t=this.style._layers[n[this.currentLayer]],r=e._getLayerSourceCache(t);if(t.isSky())continue;const i=r?s[r.id]:void 0;this._renderTileClippingMasks(t,r,i),this.renderLayer(this,r,t,i)}if(this.renderPass="sky",(t.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<n.length;this.currentLayer++){const t=this.style._layers[n[this.currentLayer]],r=e._getLayerSourceCache(t);t.isSky()&&this.renderLayer(this,r,t,r?s[r.id]:void 0)}for("globe"===this.transform.projection.name&&function(e){const r=e.context,n=r.gl,i=e.transform,o=new t.DepthMode(n.LEQUAL,t.DepthMode.ReadOnly,[0,1]),s=e.useProgram("globeAtmosphere"),a=i._camera.getWorldToCamera(i.worldSize,1),l=i._camera.getCameraToClipPerspective(i._fov,i.width/i.height,i._nearZ,i._farZ),u=t.mul([],a,t.calculateGlobeMatrix(i,i.worldSize)),c=t.mul([],i.labelPlaneMatrix,l),h=t.transformMat4([],[0,0,0],u),p=t.add([],h,[i.worldSize/Math.PI/2,0,0]),f=t.transformMat4([0,0],h,c),d=t.transformMat4([],p,c),m=t.length(t.sub([],d,f)),g=1-t.globeToMercatorTransition(i.zoom),y={u_center:f,u_radius:m,u_screen_size:[i.width,i.height],u_pixel_ratio:t.exported.devicePixelRatio,u_opacity:g,u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};e.prepareDrawProgram(r,s);const _=e.globeSharedBuffers;_&&s.draw(r,n.TRIANGLES,o,t.StencilMode.disabled,t.ColorMode.alphaBlended,t.CullFaceMode.backCW,y,"skybox",_.atmosphereVertexBuffer,_.atmosphereIndexBuffer,_.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<n.length;){const t=this.style._layers[n[this.currentLayer]],r=e._getLayerSourceCache(t);if(t.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(t)){if(t.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const i=r?("symbol"===t.type?a:s)[r.id]:void 0;this._renderTileClippingMasks(t,r,r?o[r.id]:void 0),this.renderLayer(this,r,t,i),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let r=null;t.values(this.style._layers).forEach(t=>{const n=e._getLayerSourceCache(t);n&&!t.isHidden(this.transform.zoom)&&(!r||r.getSource().maxzoom<n.getSource().maxzoom)&&(r=n)}),r&&this.options.showTileBoundaries&&En.debug(this,r,r.getVisibleCoordinates())}this.options.showPadding&&function(t){const e=t.transform.padding;dn(t,t.transform.height-(e.top||0),3,un),dn(t,e.bottom||0,3,cn),mn(t,e.left||0,3,hn),mn(t,t.transform.width-(e.right||0),3,pn);const r=t.transform.centerPoint;!function(t,e,r,n){gn(t,e-1,r-10,2,20,n),gn(t,e-10,r-1,20,2,n)}(t,r.x,t.transform.height-r.y,fn)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(t.window.performance.now()),this.saveCanvasCopy())}renderLayer(t,e,r,n){r.isHidden(this.transform.zoom)||("background"===r.type||"sky"===r.type||"custom"===r.type||n&&n.length)&&(this.id=r.id,this.gpuTimingStart(r),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(r.type)||En[r.type](t,e,r,n,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const e=this.context.extTimerQuery;let r=this.gpuTimers[t.id];r||(r=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:e.createQueryEXT()}),r.calls++,e.beginQueryEXT(e.TIME_ELAPSED_EXT,r.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}queryGpuTimers(t){const e={};for(const r in t){const n=t[r],i=this.context.extTimerQuery,o=i.getQueryObjectEXT(n.query,i.QUERY_RESULT_EXT)/1e6;i.deleteQueryEXT(n.query),e[r]=o}return e}translatePosMatrix(e,r,n,i,o){if(!n[0]&&!n[1])return e;const s=o?"map"===i?this.transform.angle:0:"viewport"===i?-this.transform.angle:0;if(s){const t=Math.sin(s),e=Math.cos(s);n=[n[0]*e-n[1]*t,n[0]*t+n[1]*e]}const a=[o?n[0]:z(r,n[0],this.transform.zoom),o?n[1]:z(r,n[1],this.transform.zoom),0],l=new Float32Array(16);return t.translate(l,e,a),l}saveTileTexture(t){const e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const e=this._tileTextures[t];return e&&e.length>0?e.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const e=this.imageManager.getPattern(t.from.toString()),r=this.imageManager.getPattern(t.to.toString());return!e||!r}currentGlobalDefines(){const t=this.terrain&&this.terrain.renderingToTexture,e=this.style&&this.style.fog,r=[];return this.terrain&&!this.terrain.renderingToTexture&&r.push("TERRAIN"),e&&!t&&0!==e.getOpacity(this.transform.pitch)&&r.push("FOG"),t&&r.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&r.push("OVERDRAW_INSPECTOR"),r}useProgram(t,e,r){this.cache=this.cache||{};const n=r||[],i=this.currentGlobalDefines().concat(n),o=wr.cacheKey(t,i,e);return this.cache[o]||(this.cache[o]=new wr(this.context,t,er[t],e,Hr[t],i)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=t.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(t,e,r){if(this.terrain&&this.terrain.renderingToTexture)return;const n=this.style.fog;if(n){const i=n.getOpacity(this.transform.pitch);0!==i&&e.setFogUniformValues(t,((t,e,r,n)=>{const i=e.properties.get("color"),o=t.frameCounter/1e3%1,s=[i.r/i.a,i.g/i.a,i.b/i.a,n];return{u_fog_matrix:r?t.transform.calculateFogTileMatrix(r):t.identityMat,u_fog_range:e.getFovAdjustedRange(t.transform._fov),u_fog_color:s,u_fog_horizon_blend:e.properties.get("horizon-blend"),u_fog_temporal_offset:o}})(this,n,r,i))}}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const t=this.context.gl,e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),e}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&0!==t.getOpacity(this.transform.pitch)}getBackgroundTiles(){const e=this._backgroundTiles,r=this._backgroundTiles={},n=this.transform.coveringTiles({tileSize:512});for(const i of n)r[i.key]=e[i.key]||new t.Tile(i,512,this.transform.tileZoom,this);return r}clearBackgroundTiles(){this._backgroundTiles={}}}class In{constructor(t=0,e=0,r=0,n=0){if(isNaN(t)||t<0||isNaN(e)||e<0||isNaN(r)||r<0||isNaN(n)||n<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=r,this.right=n}interpolate(e,r,n){return null!=r.top&&null!=e.top&&(this.top=t.number(e.top,r.top,n)),null!=r.bottom&&null!=e.bottom&&(this.bottom=t.number(e.bottom,r.bottom,n)),null!=r.left&&null!=e.left&&(this.left=t.number(e.left,r.left,n)),null!=r.right&&null!=e.right&&(this.right=t.number(e.right,r.right,n)),this}getCenter(e,r){const n=t.clamp((this.left+e-this.right)/2,0,e),i=t.clamp((this.top+r-this.bottom)/2,0,r);return new t.pointGeometry(n,i)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new In(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Tn(e,r){const n=t.getColumn(e,3);t.fromQuat(e,r),t.setColumn(e,3,n)}function Cn(e,r){const n=t.identity$1([]);return t.rotateZ$1(n,n,-r),t.rotateX$1(n,n,-e),n}function Mn(e,r){const n=[e[0],e[1],0],i=[r[0],r[1],0];if(t.length(n)>=1e-15){const e=t.normalize([],n);t.scale$2(i,e,t.dot(i,e)),r[0]=i[0],r[1]=i[1]}const o=t.cross([],r,e);if(t.len(o)<1e-15)return null;const s=Math.atan2(-o[1],o[0]);return Cn(Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2]),s)}class An{constructor(t,e){this.position=t,this.orientation=e}get position(){return this._position}set position(e){if(e){const r=e instanceof t.MercatorCoordinate?e:new t.MercatorCoordinate(e[0],e[1],e[2]);this._renderWorldCopies&&(r.x=t.wrap(r.x,0,1)),this._position=r}else this._position=null}lookAtPoint(e,r){if(this.orientation=null,!this.position)return;const n=this._elevation?this._elevation.getAtPointOrZero(t.MercatorCoordinate.fromLngLat(e)):0,i=this.position,o=t.MercatorCoordinate.fromLngLat(e,n),s=[o.x-i.x,o.y-i.y,o.z-i.z];r||(r=[0,0,1]),r[2]=Math.abs(r[2]),this.orientation=Mn(s,r)}setPitchBearing(e,r){this.orientation=Cn(t.degToRad(e),t.degToRad(-r))}}class Pn{constructor(e,r){this._transform=t.identity([]),this.orientation=r,this.position=e}get mercatorPosition(){const e=this.position;return new t.MercatorCoordinate(e[0],e[1],e[2])}get position(){const e=t.getColumn(this._transform,3);return[e[0],e[1],e[2]]}set position(e){var r;e&&t.setColumn(this._transform,3,[(r=e)[0],r[1],r[2],1])}get orientation(){return this._orientation}set orientation(e){this._orientation=e||t.identity$1([]),e&&Tn(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),e=this.right();return{bearing:Math.atan2(-e[1],e[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,e){this._orientation=Cn(t,e),Tn(this._transform,this._orientation)}forward(){const e=t.getColumn(this._transform,2);return[-e[0],-e[1],-e[2]]}up(){const e=t.getColumn(this._transform,1);return[-e[0],-e[1],-e[2]]}right(){const e=t.getColumn(this._transform,0);return[e[0],e[1],e[2]]}getCameraToWorld(e,r){const n=new Float64Array(16);return t.invert(n,this.getWorldToCamera(e,r)),n}getWorldToCameraPosition(e,r,n){const i=this.position;t.scale$2(i,i,-e);const o=new Float64Array(16);return t.fromScaling(o,[n,n,n]),t.translate(o,o,i),o[10]*=r,o}getWorldToCamera(e,r){const n=new Float64Array(16),i=new Float64Array(4),o=this.position;return t.conjugate(i,this._orientation),t.scale$2(o,o,-e),t.fromQuat(n,i),t.translate(n,n,o),n[1]*=-1,n[5]*=-1,n[9]*=-1,n[13]*=-1,n[8]*=r,n[9]*=r,n[10]*=r,n[11]*=r,n}getCameraToClipPerspective(e,r,n,i){const o=new Float64Array(16);return t.perspective(o,e,r,n,i),o}getDistanceToElevation(e){const r=0===e?0:t.mercatorZfromAltitude(e,this.position[1]),n=this.forward();return(r-this.position[2])/n[2]}clone(){return new Pn([...this.position],[...this.orientation])}}function kn(e,r){const n=zn(e),i=function(e,r,n,i,o){const s=new t.LngLat(n.lng-180*Dn,n.lat),a=new t.LngLat(n.lng+180*Dn,n.lat),l=e.project(s.lng,s.lat),u=e.project(a.lng,a.lat),c=-Math.atan2(u.y-l.y,u.x-l.x),h=t.MercatorCoordinate.fromLngLat(n);h.y=t.clamp(h.y,-.999975,.999975);const p=h.toLngLat(),f=e.project(p.lng,p.lat),d=t.MercatorCoordinate.fromLngLat(p);d.x+=Dn;const m=d.toLngLat(),g=e.project(m.lng,m.lat),y=On(g.x-f.x,g.y-f.y,c),_=t.MercatorCoordinate.fromLngLat(p);_.y+=Dn;const v=_.toLngLat(),x=e.project(v.lng,v.lat),b=On(x.x-f.x,x.y-f.y,c),w=Math.abs(y.x)/Math.abs(b.y),E=t.identity([]);t.rotateZ(E,E,-c*(1-(o?0:i)));const S=t.identity([]);return t.scale(S,S,[1,1-(1-w)*i,1]),S[4]=-b.x/b.y*i,t.rotateZ(S,S,c),t.multiply$1(S,E,S),S}(e.projection,0,e.center,n,r),o=Ln(e);return t.scale(i,i,[o,o,1]),i}function Ln(e){const r=e.projection,n=zn(e),i=Rn(r,e.center),o=Rn(r,t.LngLat.convert(r.center));return Math.pow(2,i*n+(1-n)*o)}function zn(e){const r=e.projection.range;if(!r)return 0;const n=Math.max(e.width,e.height),i=Math.log(n/1024)/Math.LN2;return t.smoothstep(r[0]+i,r[1]+i,e.zoom)}const Dn=25e-6;function Rn(e,r){const n=t.clamp(r.lat,-t.MAX_MERCATOR_LATITUDE,t.MAX_MERCATOR_LATITUDE),i=new t.LngLat(r.lng-180*Dn,n),o=new t.LngLat(r.lng+180*Dn,n),s=e.project(i.lng,n),a=e.project(o.lng,n),l=t.MercatorCoordinate.fromLngLat(i),u=t.MercatorCoordinate.fromLngLat(o),c=a.x-s.x,h=a.y-s.y,p=u.x-l.x,f=u.y-l.y,d=Math.sqrt((p*p+f*f)/(c*c+h*h));return Math.log(d)/Math.LN2}function On(t,e,r){const n=Math.cos(r),i=Math.sin(r);return{x:t*n-e*i,y:t*i+e*n}}class Nn{constructor(e,r,n,i,o){this.tileSize=512,this._renderWorldCopies=void 0===o||o,this._minZoom=e||0,this._maxZoom=r||22,this._minPitch=null==n?0:n,this._maxPitch=null==i?60:i,this.setProjection(),this.setMaxBounds(),this.width=0,this.height=0,this._center=new t.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new In,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Pn,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const t=new Nn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.setProjection(this.getProjection()),t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t.tileSize=this.tileSize,t.setMaxBounds(this.getMaxBounds()),t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._cameraZoom=this._cameraZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,t?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(t){this._terrainEnabled()&&null==this._cameraZoom&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),t&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return t.pick(this.projection,["name","center","parallels"])}setProjection(e){null==e&&(e={name:"mercator"}),this.projectionOptions=e;const r=this.projection?this.getProjection():void 0;return this.projection=t.getProjection(e),!i(r,this.getProjection())&&(this._calcMatrices(),!0)}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new t.pointGeometry(this.width,this.height)}get bearing(){return t.wrap(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(e){const r=-e*Math.PI/180;var n;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=(n=new t.ARRAY_TYPE(4),t.ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n),function(t,e,r){var n=e[0],i=e[1],o=e[2],s=e[3],a=Math.sin(r),l=Math.cos(r);t[0]=n*l+o*a,t[1]=i*l+s*a,t[2]=n*-a+o*l,t[3]=i*-a+s*l}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const r=t.clamp(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(t){const e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._setZoom(e),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const t=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center),-1);return-1===t?(this._cameraZoom=null,!1):(this._centerAltitude=t,!0)}_updateCameraOnTerrain(){this._cameraZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize)}sampleAverageElevation(){if(!this._elevation)return 0;const e=this._elevation,r=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],n=this.horizonLineFromTop();let i=0,o=0;for(let s=0;s<r.length;s++){const a=new t.pointGeometry(r[s][0]*this.width,n+r[s][1]*(this.height-n)),l=e.pointCoordinate(a);if(!l)continue;const u=1/Math.hypot(l[0]-this._camera.position[0],l[1]-this._camera.position[1]);i+=l[3]*u,o+=u}return 0===o?NaN:i/o}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._cameraZoom||!this._elevation)return;const t=this._cameraZoom,e=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),r=this.pixelsPerMeter/this.worldSize*e,n=this._mercatorZfromZoom(t),i=this._mercatorZfromZoom(this._maxZoom),o=Math.max(n-r,i);this._setZoom(this._zoomFromMercatorZ(o))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(e){const r=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,e.toAltitude()));let n;n=e.z<this._camera.position[2]?[r.x,r.y,r.z]:[e.x,e.y,e.z];const i=t.length(t.sub([],this._camera.position,n));return t.clamp(this._zoomFromMercatorZ(i),this._minZoom,this._maxZoom)}setFreeCameraOptions(e){if(!this.height)return;if(!e.position&&!e.orientation)return;this._updateCameraState();let r=!1;if(e.orientation&&!t.exactEquals(e.orientation,this._camera.orientation)&&(r=this._setCameraOrientation(e.orientation)),e.position){const n=[e.position.x,e.position.y,e.position.z];t.exactEquals$1(n,this._camera.position)||(this._setCameraPosition(n),r=!0)}r&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const e=this._camera.position,r=new An;return r.position=new t.MercatorCoordinate(e[0],e[1],e[2]),r.orientation=this._camera.orientation,r._elevation=this.elevation,r._renderWorldCopies=this.renderWorldCopies,r}_setCameraOrientation(e){if(!t.length$1(e))return!1;t.normalize$1(e,e);const r=t.transformQuat([],[0,0,-1],e),n=t.transformQuat([],[0,-1,0],e);if(n[2]<0)return!1;const i=Mn(r,n);return!!i&&(this._camera.orientation=i,!0)}_setCameraPosition(e){const r=this.zoomScale(this.minZoom)*this.tileSize,n=this.zoomScale(this.maxZoom)*this.tileSize,i=this.cameraToCenterDistance;e[2]=t.clamp(e[2],i/n,i/r),this._camera.position=e}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,e,r){this._unmodified=!1,this._edgeInsets.interpolate(t,e,r),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)}getVisibleUnwrappedCoordinates(e){const r=[new t.UnwrappedTileID(0,e)];if(this.renderWorldCopies){const n=this.pointCoordinate(new t.pointGeometry(0,0)),i=this.pointCoordinate(new t.pointGeometry(this.width,0)),o=this.pointCoordinate(new t.pointGeometry(this.width,this.height)),s=this.pointCoordinate(new t.pointGeometry(0,this.height)),a=Math.floor(Math.min(n.x,i.x,o.x,s.x)),l=Math.floor(Math.max(n.x,i.x,o.x,s.x)),u=1;for(let c=a-u;c<=l+u;c++)0!==c&&r.push(new t.UnwrappedTileID(c,e))}return r}coveringTiles(e){let r=this.coveringZoomLevel(e);const n=r,i=this.elevation&&!e.isTerrainDEM,o="mercator"===this.projection.name;if(void 0!==e.minzoom&&r<e.minzoom)return[];void 0!==e.maxzoom&&r>e.maxzoom&&(r=e.maxzoom);const s=this.locationCoordinate(this.center),a=1<<r,l=[a*s.x,a*s.y,0],u=t.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,"globe"!==this.projection.name),c=this.pointCoordinate(this.getCameraPoint()),h=a*t.mercatorZfromAltitude(1,this.center.lat),p=this._camera.position[2]/t.mercatorZfromAltitude(1,this.center.lat),f=[a*c.x,a*c.y,p],d=this.cameraToCenterDistance/e.tileSize*(e.roundZoom?1:.502),m=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?r:0,g=e.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,y=e.isTerrainDEM?-g:this._elevation?this._elevation.getMinElevationBelowMSL():0,_=this.projection.isReprojectedInTileSpace?Ln(this):1,v=e=>{const r=25e-6,n=new t.MercatorCoordinate(e.x+r,e.y,e.z),i=new t.MercatorCoordinate(e.x,e.y+r,e.z),o=e.toLngLat(),s=n.toLngLat(),a=i.toLngLat(),l=this.locationCoordinate(o),u=this.locationCoordinate(s),c=this.locationCoordinate(a),h=Math.hypot(u.x-l.x,u.y-l.y),p=Math.hypot(c.x-l.x,c.y-l.y);return Math.sqrt(h*p)*_/r},x=e=>{const r=g,n=y;return{aabb:t.tileAABB(this,a,0,0,0,e,n,r,this.projection),zoom:0,x:0,y:0,minZ:n,maxZ:r,wrap:e,fullyVisible:!1}},b=[];let w=[];const E=r,S=e.reparseOverscaled?n:r,I=t=>t*t,T=I((p-this._centerAltitude)*h),C=t=>{if(!this._elevation||!t.tileID||!o)return;const e=this._elevation.getMinMaxForTile(t.tileID),r=t.aabb;e?(r.min[2]=e.min,r.max[2]=e.max,r.center[2]=(r.min[2]+r.max[2])/2):(t.shouldSplit=M(t),t.shouldSplit||(r.min[2]=r.max[2]=r.center[2]=this._centerAltitude))},M=e=>{if(e.zoom<m)return!0;if(e.zoom===E)return!1;if(null!=e.shouldSplit)return e.shouldSplit;const r=e.aabb.distanceX(f),o=e.aabb.distanceY(f);let s=T;i&&(s=I(e.aabb.distanceZ(f)*h));let a=1;if(this.projection.isReprojectedInTileSpace&&n<=5){const r=Math.pow(2,e.zoom),n=v(new t.MercatorCoordinate((e.x+.5)/r,(e.y+.5)/r));a=n>.85?1:n}const l=r*r+o*o+s;return l<I((1<<E-e.zoom)*d*a*((t,e)=>{if(e*I(.707)<t)return 1;const r=Math.sqrt(e/t);return r/(1.4144271570014144+(Math.pow(1.1,r-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(s,T),l))};if(this.renderWorldCopies)for(let t=1;t<=3;t++)b.push(x(-t)),b.push(x(t));for(b.push(x(0));b.length>0;){const n=b.pop(),s=n.x,c=n.y;let h=n.fullyVisible;if(!h){const t=n.aabb.intersects(u);if(0===t)continue;h=2===t}if(n.zoom!==E&&M(n))for(let e=0;e<4;e++){const r=(s<<1)+e%2,l=(c<<1)+(e>>1),u={aabb:o?n.aabb.quadrant(e):t.tileAABB(this,a,n.zoom+1,r,l,n.wrap,n.minZ,n.maxZ,this.projection),zoom:n.zoom+1,x:r,y:l,wrap:n.wrap,fullyVisible:h,tileID:void 0,shouldSplit:void 0,minZ:n.minZ,maxZ:n.maxZ};i&&(u.tileID=new t.OverscaledTileID(n.zoom+1===E?S:n.zoom+1,n.wrap,n.zoom+1,r,l),C(u)),b.push(u)}else{const i=n.zoom===E?S:n.zoom;if(e.minzoom&&e.minzoom>i)continue;const o=l[0]-(.5+s+(n.wrap<<n.zoom))*(1<<r-n.zoom),a=l[1]-.5-c,u=n.tileID?n.tileID:new t.OverscaledTileID(i,n.wrap,n.zoom,s,c);w.push({tileID:u,distanceSq:o*o+a*a})}}if(this.fogCullDistSq){const r=this.fogCullDistSq,n=this.horizonLineFromTop();w=w.filter(i=>{const o=[0,0,0,1],s=[t.EXTENT,t.EXTENT,0,1],a=this.calculateFogTileMatrix(i.tileID.toUnwrapped());t.transformMat4$1(o,o,a),t.transformMat4$1(s,s,a);const l=t.getAABBPointSquareDist(o,s);if(0===l)return!0;let u=!1;const c=this._elevation;if(c&&l>r&&0!==n){const r=this.calculateProjMatrix(i.tileID.toUnwrapped());let o;e.isTerrainDEM||(o=c.getMinMaxForTile(i.tileID)),o||(o={min:y,max:g});const s=t.furthestTileCorner(this.rotation),a=[s[0]*t.EXTENT,s[1]*t.EXTENT,o.max];t.transformMat4(a,a,r),u=(1-a[1])*this.height*.5<n}return l<r||u})}return w.sort((t,e)=>t.distanceSq-e.distanceSq).map(t=>t.tileID)}resize(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(e){const r=t.clamp(e.lat,-t.MAX_MERCATOR_LATITUDE,t.MAX_MERCATOR_LATITUDE),n=this.projection.project(e.lng,r);return new t.pointGeometry(n.x*this.worldSize,n.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(e,r){const n=this.pointCoordinate(r),i=this.pointCoordinate(this.centerPoint),o=this.locationCoordinate(e);this.setLocation(new t.MercatorCoordinate(o.x-(n.x-i.x),o.y-(n.y-i.y)))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this._coordinatePoint(this.locationCoordinate(t),!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(e,r){const n=r?t.mercatorZfromAltitude(r,e.lat):void 0,i=this.projection.project(e.lng,e.lat);return new t.MercatorCoordinate(i.x,i.y,n)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(e,r){const n=null!=r?r:this._centerAltitude,i=[e.x,e.y,0,1],o=[e.x,e.y,1,1];t.transformMat4$1(i,i,this.pixelMatrixInverse),t.transformMat4$1(o,o,this.pixelMatrixInverse);const s=o[3];t.scale$1(i,i,1/i[3]),t.scale$1(o,o,1/s);const a=i[2],l=o[2];return{p0:i,p1:o,t:a===l?0:(n-a)/(l-a)}}screenPointToMercatorRay(e){const r=[e.x,e.y,0,1],n=[e.x,e.y,1,1];return t.transformMat4$1(r,r,this.pixelMatrixInverse),t.transformMat4$1(n,n,this.pixelMatrixInverse),t.scale$1(r,r,1/r[3]),t.scale$1(n,n,1/n[3]),r[2]=t.mercatorZfromAltitude(r[2],this._center.lat)*this.worldSize,n[2]=t.mercatorZfromAltitude(n[2],this._center.lat)*this.worldSize,t.scale$1(r,r,1/this.worldSize),t.scale$1(n,n,1/this.worldSize),new t.Ray([r[0],r[1],r[2]],t.normalize([],t.sub([],n,r)))}rayIntersectionCoordinate(e){const{p0:r,p1:n,t:i}=e,o=t.mercatorZfromAltitude(r[2],this._center.lat),s=t.mercatorZfromAltitude(n[2],this._center.lat);return new t.MercatorCoordinate(t.number(r[0],n[0],i)/this.worldSize,t.number(r[1],n[1],i)/this.worldSize,t.number(o,s,i))}pointCoordinate(t,e=this._centerAltitude){return this.projection.createTileTransform(this,this.worldSize).pointCoordinate(t.x,t.y,e)}pointCoordinate3D(e){if(!this.elevation)return this.pointCoordinate(e);const r=this.elevation;let n=this.elevation.pointCoordinate(e);if(n)return new t.MercatorCoordinate(n[0],n[1],n[2]);let i=0,o=this.horizonLineFromTop();if(e.y>o)return this.pointCoordinate(e);const s=.02*o,a=e.clone();for(let l=0;l<10&&o-i>s;l++){a.y=t.number(i,o,.66);const e=r.pointCoordinate(a);e?(o=a.y,n=e):i=a.y}return n?new t.MercatorCoordinate(n[0],n[1],n[2]):this.pointCoordinate(e)}isPointAboveHorizon(t){if(this.elevation)return!this.elevation.pointCoordinate(t);{const e=this.horizonLineFromTop();return t.y<e}}_coordinatePoint(e,r){const n=r&&this.elevation?this.elevation.getAtPointOrZero(e,this._centerAltitude):this._centerAltitude,i=[e.x*this.worldSize,e.y*this.worldSize,n+e.toAltitude(),1];return t.transformMat4$1(i,i,this.pixelMatrix),i[3]>0?new t.pointGeometry(i[0]/i[3],i[1]/i[3]):new t.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(e,r){const n=new t.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),i=new t.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),o=new t.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),s=new t.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let a=this.pointCoordinate(n,e),l=this.pointCoordinate(i,e);const u=this.pointCoordinate(o,r),c=this.pointCoordinate(s,r),h=(t,e)=>(e.y-t.y)/(e.x-t.x);return a.y>1&&l.y>=0?a=new t.MercatorCoordinate((1-c.y)/h(c,a)+c.x,1):a.y<0&&l.y<=1&&(a=new t.MercatorCoordinate(-c.y/h(c,a)+c.x,0)),l.y>1&&a.y>=0?l=new t.MercatorCoordinate((1-u.y)/h(u,l)+u.x,1):l.y<0&&a.y<=1&&(l=new t.MercatorCoordinate(-u.y/h(u,l)+u.x,0)),(new t.LngLatBounds).extend(this.coordinateLocation(a)).extend(this.coordinateLocation(l)).extend(this.coordinateLocation(c)).extend(this.coordinateLocation(u))}_getBounds3D(){const t=this.elevation;if(!t.visibleDemTiles.length)return this._getBounds(0,0);const e=t.visibleDemTiles.reduce((t,e)=>{if(e.dem){const r=e.dem.tree;t.min=Math.min(t.min,r.minimums[0]),t.max=Math.max(t.max,r.maximums[0])}return t},{min:Number.MAX_VALUE,max:0});return this._getBounds(e.min*t.exaggeration(),e.max*t.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(t=!0){const e=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,r=this.height/2-e*(1-this._horizonShift);return t?Math.max(0,r):r}getMaxBounds(){return this.maxBounds}setMaxBounds(e){this.maxBounds=e,this.minLat=-t.MAX_MERCATOR_LATITUDE,this.maxLat=t.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,e&&(this.minLat=e.getSouth(),this.maxLat=e.getNorth(),this.minLng=e.getWest(),this.maxLng=e.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=t.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=t.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=t.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=t.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,e){return this.projection.createTileTransform(this,e).createTileMatrix(t)}calculateDistanceTileData(e){const r=e.key,n=this._distanceTileDataCache;if(n[r])return n[r];const i=e.canonical,o=1/this.height,s=this.cameraWorldSize/this.zoomScale(i.z),a=(i.x+Math.pow(2,i.z)*e.wrap)*s,l=i.y*s,u=this.point,c=this.angle,h=Math.sin(-c),p=-Math.cos(-c);return n[r]={bearing:[h,p],center:[(u.x-a)*o,(u.y-l)*o],scale:s/t.EXTENT*o},n[r]}calculateFogTileMatrix(e){const r=e.key,n=this._fogTileMatrixCache;if(n[r])return n[r];const i=this.calculatePosMatrix(e,this.cameraWorldSize);return t.multiply$1(i,this.worldToFogMatrix,i),n[r]=new Float32Array(i),n[r]}calculateProjMatrix(e,r=!1){const n=e.key,i=r?this._alignedProjMatrixCache:this._projMatrixCache;if(i[n])return i[n];const o=this.calculatePosMatrix(e,this.worldSize);return t.multiply$1(o,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:r?this.alignedProjMatrix:this.projMatrix,o),i[n]=new Float32Array(o),i[n]}calculatePixelsToTileUnitsMatrix(e){const r=e.tileID.key,n=this._pixelsToTileUnitsCache;if(n[r])return n[r];const i=function(e,r){const{scale:n}=e.tileTransform,i=n*t.EXTENT/(e.tileSize*Math.pow(2,r.zoom-e.tileID.overscaledZ+e.tileID.canonical.z));return o=new Float32Array(4),l=(s=r.inverseAdjustmentMatrix)[1],u=s[2],c=s[3],p=(a=[i,i])[1],o[0]=s[0]*(h=a[0]),o[1]=l*h,o[2]=u*p,o[3]=c*p,o;var o,s,a,l,u,c,h,p}(e,this);return n[r]=i,n[r]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const e=this._elevation;this._updateCameraState();const r=t.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,n=this._computeCameraPosition(r),i=this._camera.forward(),o=t.mercatorZfromAltitude(1,this._center.lat);n[2]/=o,i[2]/=o,t.normalize(i,i);const s=e.raycast(n,i,e.exaggeration());if(s){const e=t.scaleAndAdd([],n,i,s),r=new t.MercatorCoordinate(e[0],e[1],t.mercatorZfromAltitude(e[2],t.latFromMercatorY(e[1]))),a=(r.z+t.length([r.x-n[0],r.y-n[1],r.z-n[2]*o]))*this._projectionScaler;this._cameraZoom=this._zoomFromMercatorZ(a),this._centerAltitude=r.toAltitude(),this._center=this.coordinateLocation(r),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const e=this._elevation;this._updateCameraState();const r=t.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,n=this._computeCameraPosition(r),i=e.getAtPointOrZero(new t.MercatorCoordinate(...n)),o=this._minimumHeightOverTerrain()*Math.cos(t.degToRad(this._maxPitch)),s=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*i;if(s<o){const e=this.locationCoordinate(this._center,this._centerAltitude),r=[e.x-n[0],e.y-n[1],e.z-n[2]],i=t.length(r);r[2]-=(o-s)/this._projectionScaler;const a=t.length(r);if(0===a)return;t.scale$2(r,r,i/a*this._projectionScaler),this._camera.position=[e.x-r[0],e.y-r[1],e.z*this._projectionScaler-r[2]],this._camera.orientation=Mn(r,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const e=this.center;return e.lat=t.clamp(e.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(e.lng=t.clamp(e.lng,this.minLng,this.maxLng)),this.center=e,void(this._constraining=!1)}const e=this._unmodified,{x:r,y:n}=this.point;let i=0,o=r,s=n;const a=this.width/2,l=this.height/2,u=this.worldMinY*this.scale,c=this.worldMaxY*this.scale;if(n-l<u&&(s=u+l),n+l>c&&(s=c-l),c-u<this.height&&(i=Math.max(i,this.height/(c-u)),s=(c+u)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const t=this.worldMinX*this.scale,e=this.worldMaxX*this.scale,n=this.worldSize/2-(t+e)/2;o=(r+n+this.worldSize)%this.worldSize-n,o-a<t&&(o=t+a),o+a>e&&(o=e-a),e-t<this.width&&(i=Math.max(i,this.width/(e-t)),o=(e+t)/2)}o===r&&s===n||(this.center=this.unproject(new t.pointGeometry(o,s))),i&&(this.zoom+=this.scaleZoom(i)),this._constrainCameraAltitude(),this._unmodified=e,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const e=this._fov/2,r=this.centerOffset,n=this.pixelsPerMeter;this._projectionScaler=n/(t.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(e)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const i=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?n:1),o=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);o[8]=2*-r.x/this.width,o[9]=2*r.y/this.height;let s=t.mul([],o,i);if(this.projection.isReprojectedInTileSpace){const e=this.locationCoordinate(this.center),r=t.identity([]);t.translate(r,r,[e.x*this.worldSize,e.y*this.worldSize,0]),t.multiply$1(r,r,kn(this)),t.translate(r,r,[-e.x*this.worldSize,-e.y*this.worldSize,0]),t.multiply$1(s,s,r),this.inverseAdjustmentMatrix=function(t){const e=kn(t,!0);return _([],[e[0],e[1],e[4],e[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=t.scale([],s,[this.worldSize,this.worldSize,this.worldSize/n,1]),this.projMatrix=s,this.invProjMatrix=t.invert(new Float64Array(16),this.projMatrix);const a=new Float32Array(16);t.identity(a),t.scale(a,a,[1,-1,1]),t.rotateX(a,a,this._pitch),t.rotateZ(a,a,this.angle);const l=t.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),u=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;l[8]=2*-r.x/this.width,l[9]=2*(r.y+u)/this.height,this.skyboxMatrix=t.multiply$1(a,l,a);const c=this.point,h=c.x,p=c.y,f=this.width%2/2,d=this.height%2/2,m=Math.cos(this.angle),g=Math.sin(this.angle),y=h-Math.round(h)+m*f+g*d,v=p-Math.round(p)+m*d+g*f,x=new Float64Array(s);if(t.translate(x,x,[y>.5?y-1:y,v>.5?v-1:v,0]),this.alignedProjMatrix=x,s=t.create(),t.scale(s,s,[this.width/2,-this.height/2,1]),t.translate(s,s,[1,-1,0]),this.labelPlaneMatrix=s,s=t.create(),t.scale(s,s,[1,-1,1]),t.translate(s,s,[-1,-1,0]),t.scale(s,s,[2/this.width,2/this.height,1]),this.glCoordMatrix=s,this.pixelMatrix=t.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},s=t.invert(new Float64Array(16),this.pixelMatrix),!s)throw new Error("failed to invert matrix");this.pixelMatrixInverse=s,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const e=this.cameraWorldSize,r=this.cameraPixelsPerMeter,n=this._camera.position,i=1/this.height,o=[e,e,r];t.scale$2(o,o,i),t.scale$2(n,n,-1),t.multiply$2(n,n,o);const s=t.create();t.translate(s,s,n),t.scale(s,s,o),this.mercatorFogMatrix=s,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(e,r,i)}_computeCameraPosition(t){const e=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,r=this._camera.forward(),n=this.point,i=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)*e-t/this.worldSize*this._centerAltitude;return[n.x/this.worldSize-r[0]*i,n.y/this.worldSize-r[1]*i,t/this.worldSize*this._centerAltitude-r[2]*i]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(e){const r=this._maxCameraBoundsDistance()*Math.cos(this._pitch),n=e[2];let i=1;n>0&&(i=Math.min((r-this._camera.position[2])/n,1)),this._camera.position=t.scaleAndAdd([],this._camera.position,e,i),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const e=this._camera.position,r=this._camera.forward(),{pitch:n,bearing:i}=this._camera.getPitchBearing(),o=t.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,s=this._mercatorZfromZoom(this._maxZoom)*Math.cos(t.degToRad(this._maxPitch)),a=Math.max((e[2]-o)/Math.cos(n),s),l=this._zoomFromMercatorZ(a);t.scaleAndAdd(e,e,r,a),this._pitch=t.clamp(n,t.degToRad(this.minPitch),t.degToRad(this.maxPitch)),this.angle=t.wrap(i,-Math.PI,Math.PI),this._setZoom(t.clamp(l,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=this.coordinateLocation(new t.MercatorCoordinate(e[0],e[1],e[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min((null!=this._cameraZoom?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(t.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(e,r){const n=Math.min(e.x,r.x),i=Math.max(e.x,r.x),o=Math.min(e.y,r.y),s=Math.max(e.y,r.y);if(o<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const a=[new t.pointGeometry(n,o),new t.pointGeometry(i,s),new t.pointGeometry(n,s),new t.pointGeometry(i,o)],l=this.renderWorldCopies?-3:0,u=this.renderWorldCopies?4:1;for(const t of a){const e=this.pointRayIntersection(t);if(e.t<0)return!0;const r=this.rayIntersectionCoordinate(e);if(r.x<l||r.y<0||r.x>u||r.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+t.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new t.pointGeometry(0,0),new t.pointGeometry(this.width,this.height))}zoomDeltaToMovement(e,r){const n=t.length(t.sub([],this._camera.position,e)),i=this._zoomFromMercatorZ(n)+r;return n-this._mercatorZfromZoom(i)}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.pointGeometry(0,e))}}function Fn(t,e){let r=!1,n=null;const i=()=>{n=null,r&&(t(),n=setTimeout(i,e),r=!1)};return()=>(r=!0,n||i(),n)}class Bn{constructor(e){this._hashName=e&&encodeURIComponent(e),t.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Fn(this._updateHashUnthrottled.bind(this),300)}addTo(e){return this._map=e,t.window.addEventListener("hashchange",this._onHashChange,!1),e.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),t.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(e){const r=this._map;if(!r)return;const n=r.getCenter(),i=Math.round(100*r.getZoom())/100,o=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),s=Math.pow(10,o),a=Math.round(n.lng*s)/s,l=Math.round(n.lat*s)/s,u=r.getBearing(),c=r.getPitch();let h="";if(h+=e?`/${a}/${l}/${i}`:`${i}/${l}/${a}`,(u||c)&&(h+="/"+Math.round(10*u)/10),c&&(h+=`/${Math.round(c)}`),this._hashName){const e=this._hashName;let r=!1;const n=t.window.location.hash.slice(1).split("&").map(t=>{const n=t.split("=")[0];return n===e?(r=!0,`${n}=${h}`):t}).filter(t=>t);return r||n.push(`${e}=${h}`),`#${n.join("&")}`}return`#${h}`}_getCurrentHash(){const e=t.window.location.hash.replace("#","");if(this._hashName){let t;return e.split("&").map(t=>t.split("=")).forEach(e=>{e[0]===this._hashName&&(t=e)}),(t&&t[1]||"").split("/")}return e.split("/")}_onHashChange(){const t=this._map;if(!t)return;const e=this._getCurrentHash();if(e.length>=3&&!e.some(t=>isNaN(t))){const r=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(e[3]||0):t.getBearing();return t.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:r,pitch:+(e[4]||0)}),!0}return!1}_updateHashUnthrottled(){const e=t.window.location.href.replace(/(#.+)?$/,this.getHashString());t.window.history.replaceState(t.window.history.state,null,e)}}const jn={linearity:.3,easing:t.bezier(0,0,.3,1)},Un=t.extend({deceleration:2500,maxSpeed:1400},jn),Vn=t.extend({deceleration:20,maxSpeed:1400},jn),Gn=t.extend({deceleration:1e3,maxSpeed:360},jn),qn=t.extend({deceleration:1e3,maxSpeed:90},jn);class $n{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:t.exported.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,r=t.exported.now();for(;e.length>0&&r-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const r={zoom:0,bearing:0,pitch:0,pan:new t.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:t}of this._inertiaBuffer)r.zoom+=t.zoomDelta||0,r.bearing+=t.bearingDelta||0,r.pitch+=t.pitchDelta||0,t.panDelta&&r.pan._add(t.panDelta),t.around&&(r.around=t.around),t.pinchAround&&(r.pinchAround=t.pinchAround);const n=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,i={};if(r.pan.mag()){const o=Xn(r.pan.mag(),n,t.extend({},Un,e||{}));i.offset=r.pan.mult(o.amount/r.pan.mag()),i.center=this._map.transform.center,Zn(i,o)}if(r.zoom){const t=Xn(r.zoom,n,Vn);i.zoom=this._map.transform.zoom+t.amount,Zn(i,t)}if(r.bearing){const e=Xn(r.bearing,n,Gn);i.bearing=this._map.transform.bearing+t.clamp(e.amount,-179,179),Zn(i,e)}if(r.pitch){const t=Xn(r.pitch,n,qn);i.pitch=this._map.transform.pitch+t.amount,Zn(i,t)}if(i.zoom||i.bearing){const t=void 0===r.pinchAround?r.around:r.pinchAround;i.around=t?this._map.unproject(t):this._map.getCenter()}return this.clear(),t.extend(i,{noMoveStart:!0})}}function Zn(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function Xn(e,r,n){const{maxSpeed:i,linearity:o,deceleration:s}=n,a=t.clamp(e*o/(r/1e3),-i,i),l=Math.abs(a)/(s*o);return{easing:n.easing,duration:1e3*l,amount:a*(l/2)}}class Wn extends t.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,n,i={}){const o=d(r.getCanvasContainer(),n),s=r.unproject(o);super(e,t.extend({point:o,lngLat:s,originalEvent:n},i)),this._defaultPrevented=!1,this.target=r}}class Yn extends t.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,n){const i="touchend"===e?n.changedTouches:n.touches,o=m(r.getCanvasContainer(),i),s=o.map(t=>r.unproject(t)),a=o.reduce((t,e,r,n)=>t.add(e.div(n.length)),new t.pointGeometry(0,0));super(e,{points:o,point:a,lngLats:s,lngLat:r.unproject(a),originalEvent:n}),this._defaultPrevented=!1}}class Hn extends t.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,e,r){super(t,{originalEvent:r}),this._defaultPrevented=!1}}class Jn{constructor(t,e){this._map=t,this._clickTolerance=e.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Hn(t.type,this._map,t))}mousedown(t,e){return this._mousedownPos=e,this._firePreventable(new Wn(t.type,this._map,t))}mouseup(t){this._map.fire(new Wn(t.type,this._map,t))}preclick(e){const r=t.extend({},e);r.type="preclick",this._map.fire(new Wn(r.type,this._map,r))}click(t,e){this._mousedownPos&&this._mousedownPos.dist(e)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Wn(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Wn(t.type,this._map,t))}mouseover(t){this._map.fire(new Wn(t.type,this._map,t))}mouseout(t){this._map.fire(new Wn(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Yn(t.type,this._map,t))}touchmove(t){this._map.fire(new Yn(t.type,this._map,t))}touchend(t){this._map.fire(new Yn(t.type,this._map,t))}touchcancel(t){this._map.fire(new Yn(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Kn{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Wn(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Wn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Wn(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Qn{constructor(t,e){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(c(),this._startPos=this._lastPos=e,this._active=!0)}mousemoveWindow(t,e){if(!this._active)return;const r=e;if(this._lastPos.equals(r)||!this._box&&r.dist(this._startPos)<this._clickTolerance)return;const n=this._startPos;this._lastPos=r,this._box||(this._box=o("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const i=Math.min(n.x,r.x),s=Math.max(n.x,r.x),a=Math.min(n.y,r.y),l=Math.max(n.y,r.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${i}px,${a}px)`,this._box.style.width=s-i+"px",this._box.style.height=l-a+"px")})}mouseupWindow(e,r){if(!this._active)return;if(0!==e.button)return;const n=this._startPos,i=r;if(this.reset(),f(),n.x!==i.x||n.y!==i.y)return this._map.fire(new t.Event("boxzoomend",{originalEvent:e})),{cameraAnimation:t=>t.fitScreenCoordinates(n,i,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",e)}keydown(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),h(),delete this._startPos,delete this._lastPos}_fireEvent(e,r){return this._map.fire(new t.Event(e,{originalEvent:r}))}}function ti(t,e){const r={};for(let n=0;n<t.length;n++)r[t[n].identifier]=e[n];return r}class ei{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(e,r,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=e.timeStamp),n.length===this.numTouches&&(this.centroid=function(e){const r=new t.pointGeometry(0,0);for(const t of e)r._add(t);return r.div(e.length)}(r),this.touches=ti(n,r)))}touchmove(t,e,r){if(this.aborted||!this.centroid)return;const n=ti(r,e);for(const i in this.touches){const t=this.touches[i],e=n[i];(!e||e.dist(t)>30)&&(this.aborted=!0)}}touchend(t,e,r){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===r.length){const t=!this.aborted&&this.centroid;if(this.reset(),t)return t}}}class ri{constructor(t){this.singleTap=new ei(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,e,r){this.singleTap.touchstart(t,e,r)}touchmove(t,e,r){this.singleTap.touchmove(t,e,r)}touchend(t,e,r){const n=this.singleTap.touchend(t,e,r);if(n){const e=t.timeStamp-this.lastTime<500,r=!this.lastTap||this.lastTap.dist(n)<30;if(e&&r||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=n,this.count===this.numTaps)return this.reset(),n}}}class ni{constructor(){this._zoomIn=new ri({numTouches:1,numTaps:2}),this._zoomOut=new ri({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,e,r){this._zoomIn.touchstart(t,e,r),this._zoomOut.touchstart(t,e,r)}touchmove(t,e,r){this._zoomIn.touchmove(t,e,r),this._zoomOut.touchmove(t,e,r)}touchend(t,e,r){const n=this._zoomIn.touchend(t,e,r),i=this._zoomOut.touchend(t,e,r);return n?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:e.getZoom()+1,around:e.unproject(n)},{originalEvent:t})}):i?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:e.getZoom()-1,around:e.unproject(i)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const ii={0:1,2:2};class oi{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,e){return!1}_move(t,e){return{}}mousedown(t,e){if(this._lastPoint)return;const r=g(t);this._correctButton(t,r)&&(this._lastPoint=e,this._eventButton=r)}mousemoveWindow(t,e){const r=this._lastPoint;if(r)if(t.preventDefault(),null!=this._eventButton&&function(t,e){const r=ii[e];return void 0===t.buttons||(t.buttons&r)!==r}(t,this._eventButton))this.reset();else if(this._moved||!(e.dist(r)<this._clickTolerance))return this._moved=!0,this._lastPoint=e,this._move(r,e)}mouseupWindow(t){this._lastPoint&&g(t)===this._eventButton&&(this._moved&&f(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class si extends oi{mousedown(t,e){super.mousedown(t,e),this._lastPoint&&(this._active=!0)}_correctButton(t,e){return 0===e&&!t.ctrlKey}_move(t,e){return{around:e,panDelta:e.sub(t)}}}class ai extends oi{_correctButton(t,e){return 0===e&&t.ctrlKey||2===e}_move(t,e){const r=.8*(e.x-t.x);if(r)return this._active=!0,{bearingDelta:r}}contextmenu(t){t.preventDefault()}}class li extends oi{_correctButton(t,e){return 0===e&&t.ctrlKey||2===e}_move(t,e){const r=-.5*(e.y-t.y);if(r)return this._active=!0,{pitchDelta:r}}contextmenu(t){t.preventDefault()}}class ui{constructor(e,r){this._map=e,this._el=e.getCanvasContainer(),this._minTouches=1,this._clickTolerance=r.clickTolerance||1,this.reset(),t.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new t.pointGeometry(0,0)}touchstart(t,e,r){return this._calculateTransform(t,e,r)}touchmove(t,e,r){if(this._active&&!(r.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===r.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.preventDefault(),this._calculateTransform(t,e,r)}}touchend(t,e,r){this._calculateTransform(t,e,r),this._active&&r.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,r,n){n.length>0&&(this._active=!0);const i=ti(n,r),o=new t.pointGeometry(0,0),s=new t.pointGeometry(0,0);let a=0;for(const t in i){const e=i[t],r=this._touches[t];r&&(o._add(e),s._add(e.sub(r)),a++,i[t]=e)}if(this._touches=i,a<this._minTouches||!s.mag())return;const l=s.div(a);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:o.div(a),panDelta:l}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=o("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class ci{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,e,r){return{}}touchstart(t,e,r){this._firstTwoTouches||r.length<2||(this._firstTwoTouches=[r[0].identifier,r[1].identifier],this._start([e[0],e[1]]))}touchmove(t,e,r){const n=this._firstTwoTouches;if(!n)return;t.preventDefault();const[i,o]=n,s=hi(r,e,i),a=hi(r,e,o);if(!s||!a)return;const l=this._aroundCenter?null:s.add(a).div(2);return this._move([s,a],l,t)}touchend(t,e,r){if(!this._firstTwoTouches)return;const[n,i]=this._firstTwoTouches,o=hi(r,e,n),s=hi(r,e,i);o&&s||(this._active&&f(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function hi(t,e,r){for(let n=0;n<t.length;n++)if(t[n].identifier===r)return e[n]}function pi(t,e){return Math.log(t/e)/Math.LN2}class fi extends ci{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,e){const r=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(pi(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:pi(this._distance,r),pinchAround:e}}}function di(t,e){return 180*t.angleWith(e)/Math.PI}class mi extends ci{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,e){const r=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:di(this._vector,r),pinchAround:e}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const e=25/(Math.PI*this._minDiameter)*360,r=di(t,this._startVector);return Math.abs(r)<e}}function gi(t){return Math.abs(t.y)>Math.abs(t.x)}class yi extends ci{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,gi(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,e,r){const n=this._lastPoints;if(!n)return;const i=t[0].sub(n[0]),o=t[1].sub(n[1]);return this._map._cooperativeGestures&&r.touches.length<3||(this._valid=this.gestureBeginsVertically(i,o,r.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(i.y+o.y)/2*-.5})}gestureBeginsVertically(t,e,r){if(void 0!==this._valid)return this._valid;const n=t.mag()>=2,i=e.mag()>=2;if(!n&&!i)return;if(!n||!i)return null==this._firstMove&&(this._firstMove=r),r-this._firstMove<100&&void 0;const o=t.y>0==e.y>0;return gi(t)&&gi(e)&&o}}const _i={panStep:100,bearingStep:15,pitchStep:10};class vi{constructor(){const t=_i;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let e=0,r=0,n=0,i=0,o=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?r=-1:(t.preventDefault(),i=-1);break;case 39:t.shiftKey?r=1:(t.preventDefault(),i=1);break;case 38:t.shiftKey?n=1:(t.preventDefault(),o=-1);break;case 40:t.shiftKey?n=-1:(t.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(r=0,n=0),{cameraAnimation:s=>{const a=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:xi,zoom:e?Math.round(a)+e*(t.shiftKey?2:1):a,bearing:s.getBearing()+r*this._bearingStep,pitch:s.getPitch()+n*this._pitchStep,offset:[-i*this._panStep,-o*this._panStep],center:s.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function xi(t){return t*(2-t)}const bi=4.000244140625;class wi{constructor(e,r){this._map=e,this._el=e.getCanvasContainer(),this._handler=r,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,t.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(e){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(e.ctrlKey||e.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let r=e.deltaMode===t.window.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const n=t.exported.now(),i=n-(this._lastWheelEventTime||0);this._lastWheelEventTime=n,0!==r&&r%bi==0?this._type="wheel":0!==r&&Math.abs(r)<4?this._type="trackpad":i>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(i*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),e.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=e,this._delta-=r,this._active||this._start(e)),e.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const e=d(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:e,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const e=this._map.transform,r=()=>e._terrainEnabled()&&this._aroundCoord?e.computeZoomRelativeTo(this._aroundCoord):e.zoom;if(0!==this._delta){const t="wheel"===this._type&&Math.abs(this._delta)>bi?this._wheelZoomRate:this._defaultZoomRate;let n=2/(1+Math.exp(-Math.abs(this._delta*t)));this._delta<0&&0!==n&&(n=1/n);const i=r(),o=Math.pow(2,i),s="number"==typeof this._targetZoom?e.zoomScale(this._targetZoom):o;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(s*n))),"wheel"===this._type&&(this._startZoom=r(),this._easing=this._smoothOutEasing(200)),this._delta=0}const n="number"==typeof this._targetZoom?this._targetZoom:r(),i=this._startZoom,o=this._easing;let s,a=!1;if("wheel"===this._type&&i&&o){const e=Math.min((t.exported.now()-this._lastWheelEventTime)/200,1),r=o(e);s=t.number(i,n,r),e<1?this._frameId||(this._frameId=!0):a=!0}else s=n,a=!0;return this._active=!0,a&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!a,zoomDelta:s-r(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let r=t.ease;if(this._prevEase){const e=this._prevEase,n=(t.exported.now()-e.start)/e.duration,i=e.easing(n+.01)-e.easing(n),o=.27/Math.sqrt(i*i+1e-4)*.01,s=Math.sqrt(.0729-o*o);r=t.bezier(o,s,.25,1)}return this._prevEase={start:t.exported.now(),duration:e,easing:r},r}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=o("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(t.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!t.window.document.fullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class Ei{constructor(t,e){this._clickZoom=t,this._tapZoom=e}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Si{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,e){return t.preventDefault(),{cameraAnimation:r=>{r.easeTo({duration:300,zoom:r.getZoom()+(t.shiftKey?-1:1),around:r.unproject(e)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ii{constructor(){this._tap=new ri({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,e,r){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?r.length>0&&(this._swipePoint=e[0],this._swipeTouch=r[0].identifier):this._tap.touchstart(t,e,r))}touchmove(t,e,r){if(this._tapTime){if(this._swipePoint){if(r[0].identifier!==this._swipeTouch)return;const n=e[0],i=n.y-this._swipePoint.y;return this._swipePoint=n,t.preventDefault(),this._active=!0,{zoomDelta:i/128}}}else this._tap.touchmove(t,e,r)}touchend(t,e,r){this._tapTime?this._swipePoint&&0===r.length&&this.reset():this._tap.touchend(t,e,r)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ti{constructor(t,e,r){this._el=t,this._mousePan=e,this._touchPan=r}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ci{constructor(t,e,r){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=e,this._mousePitch=r}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Mi{constructor(t,e,r,n){this._el=t,this._touchZoom=e,this._touchRotate=r,this._tapDragZoom=n,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ai=t=>t.zoom||t.drag||t.pitch||t.rotate;class Pi extends t.Event{}class ki{constructor(){this.constants=[1,1,.01],this.radius=0}setup(e,r){const n=t.sub([],r,e);this.radius=t.length(n[2]<0?t.div([],n,this.constants):[n[0],n[1],0])}projectRay(e){t.div(e,e,this.constants),t.normalize(e,e),t.mul$1(e,e,this.constants);const r=t.scale$2([],e,this.radius);if(r[2]>0){const e=t.scale$2([],[0,0,1],t.dot(r,[0,0,1])),n=t.scale$2([],t.normalize([],[r[0],r[1],0]),this.radius),i=t.add([],r,t.scale$2([],t.sub([],t.add([],n,e),r),2));r[0]=i[0],r[1]=i[1]}return r}}function Li(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}class zi{constructor(e,r){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new $n(e),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ki,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(r),t.bindAll(["handleEvent","handleWindowEvent"],this);const n=this._el;this._listeners=[[n,"touchstart",{passive:!0}],[n,"touchmove",{passive:!1}],[n,"touchend",void 0],[n,"touchcancel",void 0],[n,"mousedown",void 0],[n,"mousemove",void 0],[n,"mouseup",void 0],[t.window.document,"mousemove",{capture:!0}],[t.window.document,"mouseup",void 0],[n,"mouseover",void 0],[n,"mouseout",void 0],[n,"dblclick",void 0],[n,"click",void 0],[n,"keydown",{capture:!1}],[n,"keyup",void 0],[n,"wheel",{passive:!1}],[n,"contextmenu",void 0],[t.window,"blur",void 0]];for(const[i,o,s]of this._listeners)i.addEventListener(o,i===t.window.document?this.handleWindowEvent:this.handleEvent,s)}destroy(){for(const[e,r,n]of this._listeners)e.removeEventListener(r,e===t.window.document?this.handleWindowEvent:this.handleEvent,n)}_addDefaultHandlers(t){const e=this._map,r=e.getCanvasContainer();this._add("mapEvent",new Jn(e,t));const n=e.boxZoom=new Qn(e,t);this._add("boxZoom",n);const i=new ni,o=new Si;e.doubleClickZoom=new Ei(o,i),this._add("tapZoom",i),this._add("clickZoom",o);const s=new Ii;this._add("tapDragZoom",s);const a=e.touchPitch=new yi(e);this._add("touchPitch",a);const l=new ai(t),u=new li(t);e.dragRotate=new Ci(t,l,u),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",u,["mouseRotate"]);const c=new si(t),h=new ui(e,t);e.dragPan=new Ti(r,c,h),this._add("mousePan",c),this._add("touchPan",h,["touchZoom","touchRotate"]);const p=new mi,f=new fi;e.touchZoomRotate=new Mi(r,f,p,s),this._add("touchRotate",p,["touchPan","touchZoom"]),this._add("touchZoom",f,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Kn(e));const d=e.scrollZoom=new wi(e,this);this._add("scrollZoom",d,["mousePan"]);const m=e.keyboard=new vi;this._add("keyboard",m);for(const g of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[g]&&e[g].enable(t[g])}_add(t,e,r){this._handlers.push({handlerName:t,handler:e,allowed:r}),this._handlersById[t]=e}stop(t){if(!this._updatingCamera){for(const{handler:t}of this._handlers)t.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Ai(this._eventsInProgress))||this.isZooming()}_blockedByActive(t,e,r){for(const n in t)if(n!==r&&(!e||e.indexOf(n)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const e=[];for(const r of t)this._el.contains(r.target)&&e.push(r);return e}handleEvent(t,e){this._updatingCamera=!0;const r="renderFrame"===t.type,n=r?void 0:t,i={needsRenderFrame:!1},o={},s={},a=t.touches?this._getMapTouches(t.touches):void 0,l=a?m(this._el,a):r?void 0:d(this._el,t);for(const{handlerName:h,handler:p,allowed:f}of this._handlers){if(!p.isEnabled())continue;let r;this._blockedByActive(s,f,h)?p.reset():p[e||t.type]&&(r=p[e||t.type](t,l,a),this.mergeHandlerResult(i,o,r,h,n),r&&r.needsRenderFrame&&this._triggerRenderFrame()),(r||p.isActive())&&(s[h]=p)}const u={};for(const h in this._previousActiveHandlers)s[h]||(u[h]=n);this._previousActiveHandlers=s,(Object.keys(u).length||Li(i))&&(this._changes.push([i,o,u]),this._triggerRenderFrame()),(Object.keys(s).length||Li(i))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:c}=i;c&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],c(this._map))}mergeHandlerResult(e,r,n,i,o){if(!n)return;t.extend(e,n);const s={handlerName:i,originalEvent:n.originalEvent||o};void 0!==n.zoomDelta&&(r.zoom=s),void 0!==n.panDelta&&(r.drag=s),void 0!==n.pitchDelta&&(r.pitch=s),void 0!==n.bearingDelta&&(r.rotate=s)}_applyChanges(){const e={},r={},n={};for(const[i,o,s]of this._changes)i.panDelta&&(e.panDelta=(e.panDelta||new t.pointGeometry(0,0))._add(i.panDelta)),i.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+i.zoomDelta),i.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+i.bearingDelta),i.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+i.pitchDelta),void 0!==i.around&&(e.around=i.around),void 0!==i.aroundCoord&&(e.aroundCoord=i.aroundCoord),void 0!==i.pinchAround&&(e.pinchAround=i.pinchAround),i.noInertia&&(e.noInertia=i.noInertia),t.extend(r,o),t.extend(n,s);this._updateMapTransform(e,r,n),this._changes=[]}_updateMapTransform(e,r,n){const i=this._map,o=i.transform,s=t=>[t.x,t.y,t.z];if((t=>{const e=this._eventsInProgress.drag;return e&&!this._handlersById[e.handlerName].isActive()})()&&!Li(e)){const t=o.zoom;o.cameraElevationReference="sea",o.recenterOnTerrain(),o.cameraElevationReference="ground",t!==o.zoom&&this._map._update(!0)}if(!Li(e))return this._fireEvents(r,n,!0);let{panDelta:a,zoomDelta:l,bearingDelta:u,pitchDelta:c,around:h,aroundCoord:p,pinchAround:f}=e;void 0!==f&&(h=f),(t=>r.drag&&!this._eventsInProgress.drag)()&&h&&(this._dragOrigin=s(o.pointCoordinate3D(h)),this._trackingEllipsoid.setup(o._camera.position,this._dragOrigin)),o.cameraElevationReference="sea",i._stop(!0),h=h||i.transform.centerPoint,u&&(o.bearing+=u),c&&(o.pitch+=c),o._updateCameraState();const d=[0,0,0];if(a){const t=o.pointCoordinate(h),e=o.pointCoordinate(h.sub(a));t&&e&&(d[0]=e.x-t.x,d[1]=e.y-t.y)}const m=o.zoom,g=[0,0,0];if(l){const e=s(p||o.pointCoordinate3D(h)),r={dir:t.normalize([],t.sub([],e,o._camera.position))};if(r.dir[2]<0){const n=o.zoomDeltaToMovement(e,l);t.scale$2(g,r.dir,n)}}const y=t.add(d,d,g);o._translateCameraConstrained(y),l&&Math.abs(o.zoom-m)>1e-4&&o.recenterOnTerrain(),o.cameraElevationReference="ground",this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(r,n,!0)}_fireEvents(e,r,n){const i=Ai(this._eventsInProgress),o=Ai(e),s={};for(const t in e){const{originalEvent:r}=e[t];this._eventsInProgress[t]||(s[`${t}start`]=r),this._eventsInProgress[t]=e[t]}!i&&o&&this._fireEvent("movestart",o.originalEvent);for(const t in s)this._fireEvent(t,s[t]);o&&this._fireEvent("move",o.originalEvent);for(const t in e){const{originalEvent:r}=e[t];this._fireEvent(t,r)}const a={};let l;for(const t in this._eventsInProgress){const{handlerName:e,originalEvent:n}=this._eventsInProgress[t];this._handlersById[e].isActive()||(delete this._eventsInProgress[t],l=r[e]||n,a[`${t}end`]=l)}for(const t in a)this._fireEvent(t,a[t]);const u=Ai(this._eventsInProgress);if(n&&(i||o)&&!u){this._updatingCamera=!0;const e=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),r=t=>0!==t&&-this._bearingSnap<t&&t<this._bearingSnap;e?(r(e.bearing||this._map.getBearing())&&(e.bearing=0),this._map.easeTo(e,{originalEvent:l})):(this._map.fire(new t.Event("moveend",{originalEvent:l})),r(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(e,r){this._map.fire(new t.Event(e,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new Pi("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Di="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Ri extends t.Evented{constructor(e,r){super(),this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=r.bearingSnap,t.bindAll(["_renderFrameCallback"],this)}getCenter(){return new t.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,e){return this.jumpTo({center:t},e)}panBy(e,r,n){return e=t.pointGeometry.convert(e).mult(-1),this.panTo(this.transform.center,t.extend({offset:e},r),n)}panTo(e,r,n){return this.easeTo(t.extend({center:e},r),n)}getZoom(){return this.transform.zoom}setZoom(t,e){return this.jumpTo({zoom:t},e),this}zoomTo(e,r,n){return this.easeTo(t.extend({zoom:e},r),n)}zoomIn(t,e){return this.zoomTo(this.getZoom()+1,t,e),this}zoomOut(t,e){return this.zoomTo(this.getZoom()-1,t,e),this}getBearing(){return this.transform.bearing}setBearing(t,e){return this.jumpTo({bearing:t},e),this}getPadding(){return this.transform.padding}setPadding(t,e){return this.jumpTo({padding:t},e),this}rotateTo(e,r,n){return this.easeTo(t.extend({bearing:e},r),n)}resetNorth(e,r){return this.rotateTo(0,t.extend({duration:1e3},e),r),this}resetNorthPitch(e,r){return this.easeTo(t.extend({bearing:0,pitch:0,duration:1e3},e),r),this}snapToNorth(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this}getPitch(){return this.transform.pitch}setPitch(t,e){return this.jumpTo({pitch:t},e),this}cameraForBounds(e,r){e=t.LngLatBounds.convert(e);const n=r&&r.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),n,r)}_extendCameraOptions(e){const r={top:0,bottom:0,right:0,left:0};if("number"==typeof(e=t.extend({padding:r,offset:[0,0],maxZoom:this.transform.maxZoom},e)).padding){const t=e.padding;e.padding={top:t,bottom:t,right:t,left:t}}return e.padding=t.extend(r,e.padding),e}_cameraForBoxAndBearing(e,r,n,i){const o=this._extendCameraOptions(i),s=this.transform,a=s.padding,l=s.project(t.LngLat.convert(e)),u=s.project(t.LngLat.convert(r)),c=l.rotate(-t.degToRad(n)),h=u.rotate(-t.degToRad(n)),p=new t.pointGeometry(Math.max(c.x,h.x),Math.max(c.y,h.y)),f=new t.pointGeometry(Math.min(c.x,h.x),Math.min(c.y,h.y)),d=p.sub(f),m=(s.width-((a.left||0)+(a.right||0)+o.padding.left+o.padding.right))/d.x,g=(s.height-((a.top||0)+(a.bottom||0)+o.padding.top+o.padding.bottom))/d.y;if(g<0||m<0)return void t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const y=Math.min(s.scaleZoom(s.scale*Math.min(m,g)),o.maxZoom),_="number"==typeof o.offset.x?new t.pointGeometry(o.offset.x,o.offset.y):t.pointGeometry.convert(o.offset),v=new t.pointGeometry((o.padding.left-o.padding.right)/2,(o.padding.top-o.padding.bottom)/2).rotate(n*Math.PI/180),x=_.add(v).mult(s.scale/s.zoomScale(y));return{center:s.unproject(l.add(u).div(2).sub(x)),zoom:y,bearing:n}}_cameraForBox(e,r,n,i,o){const s=this._extendCameraOptions(o);n=n||0,i=i||0,e=t.LngLat.convert(e),r=t.LngLat.convert(r);const a=this.transform.clone();a.padding=s.padding;const l=this.getFreeCameraOptions(),u=new t.LngLat(.5*(e.lng+r.lng),.5*(e.lat+r.lat)),c=.5*(n+i);if(a._camera.position[2]<t.mercatorZfromAltitude(c,u.lat))return void t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");l.lookAtPoint(u),a.setFreeCameraOptions(l);const h=t.MercatorCoordinate.fromLngLat(e),p=t.MercatorCoordinate.fromLngLat(r),f=a.pointRayIntersection(a.centerPoint,c),d=[(m=a.rayIntersectionCoordinate(f)).x,m.y,m.z];var m;const g=a.screenPointToMercatorRay(a.centerPoint),y="globe"!==a.projection.name;let _,v=0;do{const r=Math.floor(a.zoom),o=1<<r,s=Math.min(o*h.x,o*p.x),l=Math.min(o*h.y,o*p.y),u=Math.max(o*h.x,o*p.x),c=Math.max(o*h.y,o*p.y),f=new t.Aabb([s,l,n],[u,c,i]),m=t.Frustum.fromInvProjectionMatrix(a.invProjMatrix,a.worldSize,r,y);if(2!==f.intersects(m)){_&&(a._camera.position=t.scaleAndAdd([],a._camera.position,g.dir,-_),a._updateStateFromCamera());break}const v=t.sub([],a._camera.position,d);_=.5*t.length(v),a._camera.position=t.scaleAndAdd([],a._camera.position,g.dir,_);try{a._updateStateFromCamera()}catch(e){return void t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++v<10);return{center:a.center,zoom:a.zoom,bearing:a.bearing,pitch:a.pitch}}fitBounds(t,e,r){return this._fitInternal(this.cameraForBounds(t,e),e,r)}_raycastElevationBox(e,r){const n=this.transform.elevation;if(!n)return;const i=new t.pointGeometry(e.x,r.y),o=new t.pointGeometry(r.x,e.y),s=n.pointCoordinate(e);if(!s)return;const a=n.pointCoordinate(r);if(!a)return;const l=n.pointCoordinate(i);if(!l)return;const u=n.pointCoordinate(o);if(!u)return;const c=new t.MercatorCoordinate(s[0],s[1]).toLngLat(),h=new t.MercatorCoordinate(a[0],a[1]).toLngLat(),p=new t.MercatorCoordinate(l[0],l[1]).toLngLat(),f=new t.MercatorCoordinate(u[0],u[1]).toLngLat(),d=Math.min(c.lng,Math.min(h.lng,Math.min(p.lng,f.lng))),m=Math.min(c.lat,Math.min(h.lat,Math.min(p.lat,f.lat))),g=Math.max(c.lng,Math.max(h.lng,Math.max(p.lng,f.lng))),y=Math.max(c.lat,Math.max(h.lat,Math.max(p.lat,f.lat))),_=Math.min(s[3],Math.min(a[3],Math.min(l[3],u[3]))),v=Math.max(s[3],Math.max(a[3],Math.max(l[3],u[3])));return{minLngLat:new t.LngLat(d,m),maxLngLat:new t.LngLat(g,y),minAltitude:_,maxAltitude:v}}fitScreenCoordinates(e,r,n,i,o){let s,a,l,u;const c=t.pointGeometry.convert(e),h=t.pointGeometry.convert(r),p=this._raycastElevationBox(c,h);if(p)s=p.minLngLat,a=p.maxLngLat,l=p.minAltitude,u=p.maxAltitude;else{if(this.transform.anyCornerOffEdge(c,h))return this;s=this.transform.pointLocation(c),a=this.transform.pointLocation(h)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(t.pointGeometry.convert(e)),this.transform.pointLocation(t.pointGeometry.convert(r)),n,i):this._cameraForBox(s,a,l,u,i),i,o)}_fitInternal(e,r,n){return e?(delete(r=t.extend(e,r)).padding,r.linear?this.easeTo(r,n):this.flyTo(r,n)):this}jumpTo(e,r){this.stop();const n=e.preloadOnly?this.transform.clone():this.transform;let i=!1,o=!1,s=!1;return"zoom"in e&&n.zoom!==+e.zoom&&(i=!0,n.zoom=+e.zoom),void 0!==e.center&&(n.center=t.LngLat.convert(e.center)),"bearing"in e&&n.bearing!==+e.bearing&&(o=!0,n.bearing=+e.bearing),"pitch"in e&&n.pitch!==+e.pitch&&(s=!0,n.pitch=+e.pitch),null==e.padding||n.isPaddingEqual(e.padding)||(n.padding=e.padding),e.preloadOnly?(this._preloadTiles(n),this):(this.fire(new t.Event("movestart",r)).fire(new t.Event("move",r)),i&&this.fire(new t.Event("zoomstart",r)).fire(new t.Event("zoom",r)).fire(new t.Event("zoomend",r)),o&&this.fire(new t.Event("rotatestart",r)).fire(new t.Event("rotate",r)).fire(new t.Event("rotateend",r)),s&&this.fire(new t.Event("pitchstart",r)).fire(new t.Event("pitch",r)).fire(new t.Event("pitchend",r)),this.fire(new t.Event("moveend",r)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||t.warnOnce(Di),this.transform.getFreeCameraOptions()}setFreeCameraOptions(e,r){const n=this.transform;if(!n.projection.supportsFreeCamera)return void t.warnOnce(Di);this.stop();const i=n.zoom,o=n.pitch,s=n.bearing;n.setFreeCameraOptions(e);const a=i!==n.zoom,l=o!==n.pitch,u=s!==n.bearing;return this.fire(new t.Event("movestart",r)).fire(new t.Event("move",r)),a&&this.fire(new t.Event("zoomstart",r)).fire(new t.Event("zoom",r)).fire(new t.Event("zoomend",r)),u&&this.fire(new t.Event("rotatestart",r)).fire(new t.Event("rotate",r)).fire(new t.Event("rotateend",r)),l&&this.fire(new t.Event("pitchstart",r)).fire(new t.Event("pitch",r)).fire(new t.Event("pitchend",r)),this.fire(new t.Event("moveend",r)),this}easeTo(e,r){this._stop(!1,e.easeId),(!1===(e=t.extend({offset:[0,0],duration:500,easing:t.ease},e)).animate||!e.essential&&t.exported.prefersReducedMotion)&&(e.duration=0);const n=this.transform,i=this.getZoom(),o=this.getBearing(),s=this.getPitch(),a=this.getPadding(),l="zoom"in e?+e.zoom:i,u="bearing"in e?this._normalizeBearing(e.bearing,o):o,c="pitch"in e?+e.pitch:s,h="padding"in e?e.padding:n.padding,p=t.pointGeometry.convert(e.offset);let f=n.centerPoint.add(p);const d="globe"===n.projection.name?n.pointCoordinate(f).toLngLat():n.pointLocation(f),m=t.LngLat.convert(e.center||d);this._normalizeCenter(m);const g=n.project(d),y=n.project(m).sub(g),_=n.zoomScale(l-i);let v,x;e.around&&(v=t.LngLat.convert(e.around),x=n.locationPoint(v));const b=this._zooming||l!==i,w=this._rotating||o!==u,E=this._pitching||c!==s,S=!n.isPaddingEqual(h),I=n=>d=>{if(b&&(n.zoom=t.number(i,l,d)),w&&(n.bearing=t.number(o,u,d)),E&&(n.pitch=t.number(s,c,d)),S&&(n.interpolatePadding(a,h,d),f=n.centerPoint.add(p)),v)n.setLocationAtPoint(v,x);else{const t=n.zoomScale(n.zoom-i),e=l>i?Math.min(2,_):Math.max(.5,_),r=Math.pow(e,1-d),o=n.unproject(g.add(y.mult(d*r)).mult(t));n.setLocationAtPoint(n.renderWorldCopies?o.wrap():o,f)}return e.preloadOnly||this._fireMoveEvents(r),n};if(e.preloadOnly){const t=this._emulate(I,e.duration,n);return this._preloadTiles(t),this}const T={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=b,this._rotating=w,this._pitching=E,this._padding=S,this._easeId=e.easeId,this._prepareEase(r,e.noMoveStart,T),this._ease(I(n),t=>{n.recenterOnTerrain(),this._afterEase(r,t)},e),this}_prepareEase(e,r,n={}){this._moving=!0,this.transform.cameraElevationReference="sea",r||n.moving||this.fire(new t.Event("movestart",e)),this._zooming&&!n.zooming&&this.fire(new t.Event("zoomstart",e)),this._rotating&&!n.rotating&&this.fire(new t.Event("rotatestart",e)),this._pitching&&!n.pitching&&this.fire(new t.Event("pitchstart",e))}_fireMoveEvents(e){this.fire(new t.Event("move",e)),this._zooming&&this.fire(new t.Event("zoom",e)),this._rotating&&this.fire(new t.Event("rotate",e)),this._pitching&&this.fire(new t.Event("pitch",e))}_afterEase(e,r){if(this._easeId&&r&&this._easeId===r)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const n=this._zooming,i=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,n&&this.fire(new t.Event("zoomend",e)),i&&this.fire(new t.Event("rotateend",e)),o&&this.fire(new t.Event("pitchend",e)),this.fire(new t.Event("moveend",e))}flyTo(e,r){if(!e.essential&&t.exported.prefersReducedMotion){const n=t.pick(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(n,r)}this.stop(),e=t.extend({offset:[0,0],speed:1.2,curve:1.42,easing:t.ease},e);const n=this.transform,i=this.getZoom(),o=this.getBearing(),s=this.getPitch(),a=this.getPadding(),l="zoom"in e?t.clamp(+e.zoom,n.minZoom,n.maxZoom):i,u="bearing"in e?this._normalizeBearing(e.bearing,o):o,c="pitch"in e?+e.pitch:s,h="padding"in e?e.padding:n.padding,p=n.zoomScale(l-i),f=t.pointGeometry.convert(e.offset);let d=n.centerPoint.add(f);const m=n.pointLocation(d),g=t.LngLat.convert(e.center||m);this._normalizeCenter(g);const y=n.project(m),_=n.project(g).sub(y);let v=e.curve;const x=Math.max(n.width,n.height),b=x/p,w=_.mag();if("minZoom"in e){const r=t.clamp(Math.min(e.minZoom,i,l),n.minZoom,n.maxZoom),o=x/n.zoomScale(r-i);v=Math.sqrt(o/w*2)}const E=v*v;function S(t){const e=(b*b-x*x+(t?-1:1)*E*E*w*w)/(2*(t?b:x)*E*w);return Math.log(Math.sqrt(e*e+1)-e)}function I(t){return(Math.exp(t)-Math.exp(-t))/2}function T(t){return(Math.exp(t)+Math.exp(-t))/2}const C=S(0);let M=function(t){return T(C)/T(C+v*t)},A=function(t){return x*((T(C)*(I(e=C+v*t)/T(e))-I(C))/E)/w;var e},P=(S(1)-C)/v;if(Math.abs(w)<1e-6||!isFinite(P)){if(Math.abs(x-b)<1e-6)return this.easeTo(e,r);const t=b<x?-1:1;P=Math.abs(Math.log(b/x))/v,A=function(){return 0},M=function(e){return Math.exp(t*v*e)}}e.duration="duration"in e?+e.duration:1e3*P/("screenSpeed"in e?+e.screenSpeed/v:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0);const k=o!==u,L=c!==s,z=!n.isPaddingEqual(h),D=n=>p=>{const m=p*P,v=1/M(m);n.zoom=1===p?l:i+n.scaleZoom(v),k&&(n.bearing=t.number(o,u,p)),L&&(n.pitch=t.number(s,c,p)),z&&(n.interpolatePadding(a,h,p),d=n.centerPoint.add(f));const x=1===p?g:n.unproject(y.add(_.mult(A(m))).mult(v));return n.setLocationAtPoint(n.renderWorldCopies?x.wrap():x,d),n._updateCenterElevation(),e.preloadOnly||this._fireMoveEvents(r),n};if(e.preloadOnly){const t=this._emulate(D,e.duration,n);return this._preloadTiles(t),this}return this._zooming=!0,this._rotating=k,this._pitching=L,this._padding=z,this._prepareEase(r,!1),this._ease(D(n),()=>this._afterEase(r),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,e){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const t=this._onEaseEnd;this._onEaseEnd=void 0,t.call(this,e)}if(!t){const t=this.handlers;t&&t.stop(!1)}return this}_ease(e,r,n){!1===n.animate||0===n.duration?(e(1),r()):(this._easeStart=t.exported.now(),this._easeOptions=n,this._onEaseFrame=e,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const e=Math.min((t.exported.now()-this._easeStart)/this._easeOptions.duration,1),r=this._onEaseFrame;r&&r(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(e,r){e=t.wrap(e,-180,180);const n=Math.abs(e-r);return Math.abs(e-360-r)<n&&(e-=360),Math.abs(e+360-r)<n&&(e+=360),e}_normalizeCenter(t){const e=this.transform;if(!e.renderWorldCopies||e.maxBounds)return;const r=t.lng-e.center.lng;t.lng+=r>180?-360:r<-180?360:0}_emulate(t,e,r){const n=Math.ceil(15*e/1e3),i=[],o=t(r.clone());for(let s=0;s<=n;s++){const t=o(s/n);i.push(t.clone())}return i}}class Oi{constructor(e={}){this.options=e,t.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const e=this.options&&this.options.compact;return this._map=t,this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=o("button","mapboxgl-ctrl-attrib-button",this._container),o("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden",!0),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=o("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),e&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,e){const r=this._map._getUIString(`AttributionControl.${e}`);t.setAttribute("aria-label",r),t.removeAttribute("title"),t.firstElementChild&&t.firstElementChild.setAttribute("title",r)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));const r=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||t.config.ACCESS_TOKEN}];if(e){const n=r.reduce((t,e,n)=>(e.value&&(t+=`${e.key}=${e.value}${n<r.length-1?"&":""}`),t),"?");e.href=`${t.config.FEEDBACK_URL}/${n}${this._map._hash?this._map._hash.getHashString(!0):""}`,e.rel="noopener nofollow",this._setElementTitle(e,"MapFeedback")}}_updateData(t){!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const t=this._map.style.stylesheet;this.styleOwner=t.owner,this.styleId=t.id}const e=this._map.style._sourceCaches;for(const n in e){const r=e[n];if(r.used){const e=r.getSource();e.attribution&&t.indexOf(e.attribution)<0&&t.push(e.attribution)}}t.sort((t,e)=>t.length-e.length),t=t.filter((e,r)=>{for(let n=r+1;n<t.length;n++)if(t[n].indexOf(e)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const r=t.join(" | ");r!==this._attribHTML&&(this._attribHTML=r,t.length?(this._innerContainer.innerHTML=r,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Ni{constructor(){t.bindAll(["_updateLogo"],this),t.bindAll(["_updateCompact"],this)}onAdd(t){this._map=t,this._container=o("div","mapboxgl-ctrl");const e=o("a","mapboxgl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://www.mapbox.com/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(0===Object.entries(t).length)return!0;for(const e in t){const r=t[e].getSource();if(r.hasOwnProperty("mapbox_logo")&&!r.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const e=t[0];this._map.getCanvasContainer().offsetWidth<250?e.classList.add("mapboxgl-compact"):e.classList.remove("mapboxgl-compact")}}}class Fi{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e}remove(t){const e=this._currentlyRunning,r=e?this._queue.concat(e):this._queue;for(const n of r)if(n.id===t)return void(n.cancelled=!0)}run(t=0){const e=this._currentlyRunning=this._queue;this._queue=[];for(const r of e)if(!r.cancelled&&(r.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Bi(e,r,n){if(e=new t.LngLat(e.lng,e.lat),r){const i=new t.LngLat(e.lng-360,e.lat),o=new t.LngLat(e.lng+360,e.lat),s=360*Math.ceil(Math.abs(e.lng-n.center.lng)/360),a=n.locationPoint(e).distSqr(r),l=r.x<0||r.y<0||r.x>n.width||r.y>n.height;n.locationPoint(i).distSqr(r)<a&&(l||Math.abs(i.lng-n.center.lng)<s)?e=i:n.locationPoint(o).distSqr(r)<a&&(l||Math.abs(o.lng-n.center.lng)<s)&&(e=o)}for(;Math.abs(e.lng-n.center.lng)>180;){const t=n.locationPoint(e);if(t.x>=0&&t.y>=0&&t.x<=n.width&&t.y<=n.height)break;e.lng>n.center.lng?e.lng-=360:e.lng+=360}return e}const ji={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Ui extends t.Evented{constructor(e,r){if(super(),(e instanceof t.window.HTMLElement||r)&&(e=t.extend({element:e},r)),t.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&"auto"!==e.pitchAlignment?e.pitchAlignment:this._rotationAlignment,this._updateMoving=(()=>this._update(!0)),e&&e.element)this._element=e.element,this._offset=t.pointGeometry.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=o("div");const r=41,n=27,i=s("svg",{display:"block",height:r*this._scale+"px",width:n*this._scale+"px",viewBox:`0 0 ${n} ${r}`},this._element),a=s("radialGradient",{id:"shadowGradient"},s("defs",{},i));s("stop",{offset:"10%","stop-opacity":.4},a),s("stop",{offset:"100%","stop-opacity":.05},a),s("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},i),s("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},i),s("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},i),s("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},i),this._offset=t.pointGeometry.convert(e&&e.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",t=>{t.preventDefault()}),this._element.addEventListener("mousedown",t=>{t.preventDefault()});const n=this._element.classList;for(const t in ji)n.remove(`mapboxgl-marker-anchor-${t}`);n.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const e=38.1,r=13.5,n=Math.sqrt(Math.pow(r,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-e],"bottom-left":[n,-1*(e-r+n)],"bottom-right":[-n,-1*(e-r+n)],left:[r,-1*(e-r)],right:[-r,-1*(e-r)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const e=t.code,r=t.charCode||t.keyCode;"Space"!==e&&"Enter"!==e&&32!==r&&13!==r||this.togglePopup()}_onMapClick(t){const e=t.originalEvent.target,r=this._element;this._popup&&(e===r||r.contains(e))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const t=this._map;if(!t)return;const e=this._pos?this._pos.sub(this._transformedOffset()):null;if(!e||e.x<0||e.x>t.transform.width||e.y<0||e.y>t.transform.height)return void this._clearFadeTimer();const r=t.unproject(e);let n=!1;if(t.transform._terrainEnabled()&&t.getTerrain()){const e=t.getFreeCameraOptions();if(e.position){const t=e.position.toLngLat();n=t.distanceTo(r)<.9*t.distanceTo(this._lngLat)}}const i=(1-t._queryFogOpacity(r))*(n?.2:1);this._element.style.opacity=`${i}`,this._popup&&this._popup._setOpacity(`${i}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const e=this._pos||new t.pointGeometry(0,0),r=this._calculatePitch(),n=this._calculateRotation();this._element.style.transform=`${ji[this._anchor]} translate(${e.x}px, ${e.y}px) rotateX(${r}deg) rotateZ(${n}deg)`}_calculatePitch(){return"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?0:this._map&&"map"===this._pitchAlignment?this._map.getPitch():0}_calculateRotation(){return"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?this._rotation:this._map&&"map"===this._rotationAlignment?this._rotation-this._map.getBearing():0}_update(e){t.window.cancelAnimationFrame(this._updateFrameId);const r=this._map;r&&(r.transform.renderWorldCopies&&(this._lngLat=Bi(this._lngLat,this._pos,r.transform)),this._pos=r.project(this._lngLat)._add(this._transformedOffset()),!0===e?this._updateFrameId=t.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),r._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!r.getTerrain()&&!r.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}_transformedOffset(){if(!this._defaultMarker||!this._map)return this._offset;const t=this._map.transform,e=this._offset.mult(this._scale);return"map"===this._rotationAlignment&&e._rotate(t.angle),"map"===this._pitchAlignment&&(e.y*=Math.cos(t._pitch)),e}getOffset(){return this._offset}setOffset(e){return this._offset=t.pointGeometry.convert(e),this._update(),this}_onMove(e){const r=this._map;if(r){if(!this._isDragging){const t=this._clickTolerance||r._clickTolerance;this._isDragging=e.point.dist(this._pointerdownPos)>=t}this._isDragging&&(this._pos=e.point.sub(this._positionDelta),this._lngLat=r.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.Event("dragstart"))),this.fire(new t.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const e=this._map;e&&(e.off("mousemove",this._onMove),e.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new t.Event("dragend")),this._state="inactive"}_addDragHandler(t){const e=this._map;e&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=t.point,this._state="pending",e.on("mousemove",this._onMove),e.on("touchmove",this._onMove),e.once("mouseup",this._onUp),e.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const e=this._map;return e&&(t?(e.on("mousedown",this._addDragHandler),e.on("touchstart",this._addDragHandler)):(e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&"auto"!==t?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class Vi{constructor(t){this.jumpTo(t)}getValue(e){if(e<=this._startTime)return this._start;if(e>=this._endTime)return this._end;const r=t.easeCubicInOut((e-this._startTime)/(this._endTime-this._startTime));return this._start*(1-r)+this._end*r}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,e,r){this._start=this.getValue(e),this._end=t,this._startTime=e,this._endTime=e+r}}const Gi={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},qi={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function $i(t){t.parentNode&&t.parentNode.removeChild(t)}const Zi={showCompass:!0,showZoom:!0,visualizePitch:!1};class Xi{constructor(e,r,n=!1){this._clickTolerance=10,this.element=r,this.mouseRotate=new ai({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,n&&(this.mousePitch=new li({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),t.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),r.addEventListener("mousedown",this.mousedown),r.addEventListener("touchstart",this.touchstart,{passive:!1}),r.addEventListener("touchmove",this.touchmove),r.addEventListener("touchend",this.touchend),r.addEventListener("touchcancel",this.reset)}down(t,e){this.mouseRotate.mousedown(t,e),this.mousePitch&&this.mousePitch.mousedown(t,e),c()}move(t,e){const r=this.map,n=this.mouseRotate.mousemoveWindow(t,e);if(n&&n.bearingDelta&&r.setBearing(r.getBearing()+n.bearingDelta),this.mousePitch){const n=this.mousePitch.mousemoveWindow(t,e);n&&n.pitchDelta&&r.setPitch(r.getPitch()+n.pitchDelta)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){h(),t.window.removeEventListener("mousemove",this.mousemove),t.window.removeEventListener("mouseup",this.mouseup)}mousedown(e){this.down(t.extend({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),d(this.element,e)),t.window.addEventListener("mousemove",this.mousemove),t.window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,d(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=m(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){1!==t.targetTouches.length?this.reset():(this._lastPos=m(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Wi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let Yi,Hi=0,Ji=!1;const Ki={maxWidth:100,unit:"metric"};function Qi(t,e,r){const n=r&&r.maxWidth||100,i=t._containerHeight/2,o=t.unproject([0,i]),s=t.unproject([n,i]),a=o.distanceTo(s);if(r&&"imperial"===r.unit){const r=3.2808*a;r>5280?to(e,n,r/5280,t._getUIString("ScaleControl.Miles"),t):to(e,n,r,t._getUIString("ScaleControl.Feet"),t)}else r&&"nautical"===r.unit?to(e,n,a/1852,t._getUIString("ScaleControl.NauticalMiles"),t):a>=1e3?to(e,n,a/1e3,t._getUIString("ScaleControl.Kilometers"),t):to(e,n,a,t._getUIString("ScaleControl.Meters"),t)}function to(t,e,r,n,i){const o=function(t){const e=Math.pow(10,`${Math.floor(t)}`.length-1);let r=t/e;return r=r>=10?10:r>=5?5:r>=3?3:r>=2?2:r>=1?1:function(t){const e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(r),e*r}(r),s=o/r;i._requestDomTask(()=>{t.style.width=e*s+"px",t.innerHTML=`${o}&nbsp;${n}`})}const eo={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ro=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function no(e=new t.pointGeometry(0,0),r="bottom"){if("number"==typeof e){const n=Math.round(Math.sqrt(.5*Math.pow(e,2)));switch(r){case"top":return new t.pointGeometry(0,e);case"top-left":return new t.pointGeometry(n,n);case"top-right":return new t.pointGeometry(-n,n);case"bottom":return new t.pointGeometry(0,-e);case"bottom-left":return new t.pointGeometry(n,-n);case"bottom-right":return new t.pointGeometry(-n,-n);case"left":return new t.pointGeometry(e,0);case"right":return new t.pointGeometry(-e,0)}return new t.pointGeometry(0,0)}return e instanceof t.pointGeometry||Array.isArray(e)?t.pointGeometry.convert(e):t.pointGeometry.convert(e[r]||[0,0])}const io={version:t.version,supported:e,setRTLTextPlugin:t.setRTLTextPlugin,getRTLTextPluginStatus:t.getRTLTextPluginStatus,Map:class extends Ri{constructor(e){if(null!=(e=t.extend({},qi,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Nn(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),e),this._interactive=e.interactive,this._minTileCacheSize=e.minTileCacheSize,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=e.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=e.collectResourceTiming,this._optimizeForTerrain=e.optimizeForTerrain,this._renderTaskQueue=new Fi,this._domRenderTaskQueue=new Fi,this._controls=[],this._markers=[],this._mapId=t.uniqueId(),this._locale=t.extend({},Gi,e.locale),this._clickTolerance=e.clickTolerance,this._cooperativeGestures=e.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new Vi(0),this._requestManager=new t.RequestManager(e.transformRequest,e.accessToken,e.testMode),this._silenceAuthErrors=!!e.testMode,"string"==typeof e.container){if(this._container=t.window.document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof t.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(this._container.childNodes.length>0&&t.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),e.maxBounds&&this.setMaxBounds(e.maxBounds),t.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==t.window&&(t.window.addEventListener("online",this._onWindowOnline,!1),t.window.addEventListener("resize",this._onWindowResize,!1),t.window.addEventListener("orientationchange",this._onWindowResize,!1),t.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new zi(this,e),this._localFontFamily=e.localFontFamily,this._localIdeographFontFamily=e.localIdeographFontFamily,e.style&&this.setStyle(e.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),e.projection&&this.setProjection(e.projection),this._hash=e.hash&&new Bn("string"==typeof e.hash&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,t.extend({},e.fitBoundsOptions,{duration:0})))),this.resize(),e.attributionControl&&this.addControl(new Oi({customAttribution:e.customAttribution})),this._logoControl=new Ni,this.addControl(this._logoControl,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",e=>{this._update("style"===e.dataType),this.fire(new t.Event(`${e.dataType}data`,e))}),this.on("dataloading",e=>{this.fire(new t.Event(`${e.dataType}dataloading`,e))})}_getMapId(){return this._mapId}addControl(e,r){if(void 0===r&&(r=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=e.onAdd(this);this._controls.push(e);const i=this._controlPositions[r];return-1!==r.indexOf("bottom")?i.insertBefore(n,i.firstChild):i.appendChild(n),this}removeControl(e){if(!e||!e.onRemove)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(e);return r>-1&&this._controls.splice(r,1),e.onRemove(this),this}hasControl(t){return this._controls.indexOf(t)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(e){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new t.Event("movestart",e)).fire(new t.Event("move",e)),this.fire(new t.Event("resize",e)),r&&this.fire(new t.Event("moveend",e)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(e){return this.transform.setMaxBounds(t.LngLatBounds.convert(e)),this._update()}setMinZoom(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e?this.setZoom(e):this.fire(new t.Event("zoomstart")).fire(new t.Event("zoom")).fire(new t.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e?this.setZoom(e):this.fire(new t.Event("zoomstart")).fire(new t.Event("zoom")).fire(new t.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to 0");if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this._update(),this.getPitch()<e?this.setPitch(e):this.fire(new t.Event("pitchstart")).fire(new t.Event("pitch")).fire(new t.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if((e=null==e?85:e)>85)throw new Error("maxPitch must be less than or equal to 85");if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this._update(),this.getPitch()>e?this.setPitch(e):this.fire(new t.Event("pitchstart")).fire(new t.Event("pitch")).fire(new t.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(t){return this.transform.renderWorldCopies=t,this._update()}getProjection(){return this.transform.getProjection()}setProjection(t){return this._lazyInitEmptyStyle(),"string"==typeof t&&(t={name:t}),this._runtimeProjection=t,this._transitionFromGlobe=!1,this.style.updateProjection(),this}_setImplicitProjection(t){this._runtimeProjection=t,this.style.updateProjection()}project(e){return this.transform.locationPoint3D(t.LngLat.convert(e))}unproject(e){return this.transform.pointLocation3D(t.pointGeometry.convert(e))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(t,e,r){if("mouseenter"===t||"mouseover"===t){let n=!1;const i=i=>{const o=e.filter(t=>this.getLayer(t)),s=o.length?this.queryRenderedFeatures(i.point,{layers:o}):[];s.length?n||(n=!0,r.call(this,new Wn(t,this,i.originalEvent,{features:s}))):n=!1},o=()=>{n=!1};return{layers:new Set(e),listener:r,delegates:{mousemove:i,mouseout:o}}}if("mouseleave"===t||"mouseout"===t){let n=!1;const i=i=>{const o=e.filter(t=>this.getLayer(t));(o.length?this.queryRenderedFeatures(i.point,{layers:o}):[]).length?n=!0:n&&(n=!1,r.call(this,new Wn(t,this,i.originalEvent)))},o=e=>{n&&(n=!1,r.call(this,new Wn(t,this,e.originalEvent)))};return{layers:new Set(e),listener:r,delegates:{mousemove:i,mouseout:o}}}{const n=t=>{const n=e.filter(t=>this.getLayer(t)),i=n.length?this.queryRenderedFeatures(t.point,{layers:n}):[];i.length&&(t.features=i,r.call(this,t),delete t.features)};return{layers:new Set(e),listener:r,delegates:{[t]:n}}}}on(t,e,r){if(void 0===r)return super.on(t,e);Array.isArray(e)||(e=[e]);const n=this._createDelegatedListener(t,e,r);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(n);for(const i in n.delegates)this.on(i,n.delegates[i]);return this}once(t,e,r){if(void 0===r)return super.once(t,e);Array.isArray(e)||(e=[e]);const n=this._createDelegatedListener(t,e,r);for(const i in n.delegates)this.once(i,n.delegates[i]);return this}off(t,e,r){if(void 0===r)return super.off(t,e);e=new Set(Array.isArray(e)?e:[e]);const n=(t,e)=>{if(t.size!==e.size)return!1;for(const r of t)if(!e.has(r))return!1;return!0},i=this._delegatedListeners?this._delegatedListeners[t]:void 0;return i&&(t=>{for(let i=0;i<t.length;i++){const o=t[i];if(o.listener===r&&n(o.layers,e)){for(const t in o.delegates)this.off(t,o.delegates[t]);return t.splice(i,1),this}}})(i),this}queryRenderedFeatures(e,r){return this.style?(void 0!==r||void 0===e||e instanceof t.pointGeometry||Array.isArray(e)||(r=e,e=void 0),this.style.queryRenderedFeatures(e=e||[[0,0],[this.transform.width,this.transform.height]],r=r||{},this.transform)):[]}querySourceFeatures(t,e){return this.style.querySourceFeatures(t,e)}queryTerrainElevation(e,r){const n=this.transform.elevation;return n?(r=t.extend({},{exaggerated:!0},r),n.getAtPoint(t.MercatorCoordinate.fromLngLat(e),null,r.exaggerated)):null}setStyle(e,r){return!1!==(r=t.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r)).diff&&r.localIdeographFontFamily===this._localIdeographFontFamily&&r.localFontFamily===this._localFontFamily&&this.style&&e?(this._diffStyle(e,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(e,r))}_getUIString(t){const e=this._locale[t];if(null==e)throw new Error(`Missing UI string '${t}'`);return e}_updateStyle(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),t&&(this.style=new We(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new We(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(e,r){if("string"==typeof e){const n=this._requestManager.normalizeStyleURL(e),i=this._requestManager.transformRequest(n,t.ResourceType.Style);t.getJSON(i,(e,n)=>{e?this.fire(new t.ErrorEvent(e)):n&&this._updateDiff(n,r)})}else"object"==typeof e&&this._updateDiff(e,r)}_updateDiff(e,r){try{this.style.setState(e)&&this._update(!0)}catch(n){t.warnOnce(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(e,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():t.warnOnce("There is no style added to the map.")}addSource(t,e){return this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)}isSourceLoaded(t){return this.style&&this.style._isSourceCacheLoaded(t)}areTilesLoaded(){const t=this.style&&this.style._sourceCaches;for(const e in t){const r=t[e]._tiles;for(const t in r){const e=r[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}}return!0}addSourceType(t,e,r){return this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,r)}removeSource(t){return this.style.removeSource(t),this._updateTerrain(),this._update(!0)}getSource(t){return this.style.getSource(t)}addImage(e,r,{pixelRatio:n=1,sdf:i=!1,stretchX:o,stretchY:s,content:a}={}){if(this._lazyInitEmptyStyle(),r instanceof t.window.HTMLImageElement||t.window.ImageBitmap&&r instanceof t.window.ImageBitmap){const{width:l,height:u,data:c}=t.exported.getImageData(r);this.style.addImage(e,{data:new t.RGBAImage({width:l,height:u},c),pixelRatio:n,stretchX:o,stretchY:s,content:a,sdf:i,version:0})}else{if(void 0===r.width||void 0===r.height)return this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:l,height:u}=r,c=r;this.style.addImage(e,{data:new t.RGBAImage({width:l,height:u},new Uint8Array(c.data)),pixelRatio:n,stretchX:o,stretchY:s,content:a,sdf:i,version:0,userImage:c}),c.onAdd&&c.onAdd(this,e)}}}updateImage(e,r){const n=this.style.getImage(e);if(!n)return this.fire(new t.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const i=r instanceof t.window.HTMLImageElement||t.window.ImageBitmap&&r instanceof t.window.ImageBitmap?t.exported.getImageData(r):r,{width:o,height:s}=i,a=i.data;return void 0===o||void 0===s?this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):o!==n.data.width||s!==n.data.height?this.fire(new t.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(n.data.replace(a,!(r instanceof t.window.HTMLImageElement||t.window.ImageBitmap&&r instanceof t.window.ImageBitmap)),void this.style.updateImage(e,n))}hasImage(e){return e?!!this.style.getImage(e):(this.fire(new t.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(t)}loadImage(e,r){t.getImage(this._requestManager.transformRequest(e,t.ResourceType.Image),(e,n)=>{r(e,n instanceof t.window.HTMLImageElement?t.exported.getImageData(n):n)})}listImages(){return this.style.listImages()}addLayer(t,e){return this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)}moveLayer(t,e){return this.style.moveLayer(t,e),this._update(!0)}removeLayer(t){return this.style.removeLayer(t),this._update(!0)}getLayer(t){return this.style.getLayer(t)}setLayerZoomRange(t,e,r){return this.style.setLayerZoomRange(t,e,r),this._update(!0)}setFilter(t,e,r={}){return this.style.setFilter(t,e,r),this._update(!0)}getFilter(t){return this.style.getFilter(t)}setPaintProperty(t,e,r,n={}){return this.style.setPaintProperty(t,e,r,n),this._update(!0)}getPaintProperty(t,e){return this.style.getPaintProperty(t,e)}setLayoutProperty(t,e,r,n={}){return this.style.setLayoutProperty(t,e,r,n),this._update(!0)}getLayoutProperty(t,e){return this.style.getLayoutProperty(t,e)}setLight(t,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(t,e),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(t){return this._lazyInitEmptyStyle(),!t&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(t),this._averageElevationLastSampledAt=-1/0,this._update(!0)}_updateProjection(){const e=this.transform.zoom;"globe"===this.transform.projection.name&&e>=t.GLOBE_ZOOM_THRESHOLD_MAX&&!this._transitionFromGlobe?(this._transitionFromGlobe=!0,this._setImplicitProjection({name:"mercator"})):this._transitionFromGlobe&&e<t.GLOBE_ZOOM_THRESHOLD_MAX&&(this._setImplicitProjection({name:"globe"}),this._transitionFromGlobe=!1)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(t){return this._lazyInitEmptyStyle(),this.style.setFog(t),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(e){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(t.LngLat.convert(e),this.transform):0}setFeatureState(t,e){return this.style.setFeatureState(t,e),this._update()}removeFeatureState(t,e){return this.style.removeFeatureState(t,e),this._update()}getFeatureState(t){return this.style.getFeatureState(t)}_updateContainerDimensions(){if(!this._container)return;const e=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let n,i=this._container;for(;i&&!n;){const e=t.window.getComputedStyle(i).transform;e&&"none"!==e&&(n=e.match(/matrix.*\((.+)\)/)[1].split(", ")),i=i.parentElement}n?(this._containerWidth=n[0]&&"0"!==n[0]?Math.abs(e/n[0]):e,this._containerHeight=n[3]&&"0"!==n[3]?Math.abs(r/n[3]):r):(this._containerWidth=e,this._containerHeight=r)}_detectMissingCSS(){"rgb(250, 128, 114)"!==t.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&t.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=o("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();const e=this._canvasContainer=o("div","mapboxgl-canvas-container",t);this._interactive&&e.classList.add("mapboxgl-interactive"),this._canvas=o("canvas","mapboxgl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const r=this._controlContainer=o("div","mapboxgl-control-container",t),n=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(t=>{n[t]=o("div",`mapboxgl-ctrl-${t}`,r)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(e,r){const n=t.exported.devicePixelRatio||1;this._canvas.width=n*Math.ceil(e),this._canvas.height=n*Math.ceil(r),this._canvas.style.width=`${e}px`,this._canvas.style.height=`${r}px`}_addMarker(t){this._markers.push(t)}_removeMarker(t){const e=this._markers.indexOf(t);-1!==e&&this._markers.splice(e,1)}_setupPainter(){const r=t.extend({},e.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl",r)||this._canvas.getContext("experimental-webgl",r);n?(t.storeAuthState(n,!0),this.painter=new Sn(n,this.transform),this.on("data",t=>{"source"===t.dataType&&this.painter.setTileLoadedFlag(!0)}),t.exported$1.testSupport(n)):this.fire(new t.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.Event("webglcontextlost",{originalEvent:e}))}_contextRestored(e){this._setupPainter(),this.resize(),this._update(),this.fire(new t.Event("webglcontextrestored",{originalEvent:e}))}_onMapScroll(t){if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(t){return this._update(),this._renderTaskQueue.add(t)}_cancelRenderFrame(t){this._renderTaskQueue.remove(t)}_requestDomTask(t){!this.loaded()||this.loaded()&&!this.isMoving()?t():this._domRenderTaskQueue.add(t)}_render(e){let r;const n=this.painter.context.extTimerQuery,i=t.exported.now();this.listens("gpu-timing-frame")&&(r=n.createQueryEXT(),n.beginQueryEXT(n.TIME_ELAPSED_EXT,r));let o=this._updateAverageElevation(i);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(e),this._domRenderTaskQueue.run(e),this._removed)return;this._updateProjection();let s=!1;const a=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const e=this.transform.zoom,r=this.transform.pitch,n=t.exported.now();this.style.zoomHistory.update(e,n);const i=new t.EvaluationParameters(e,{now:n,fadeDuration:a,pitch:r,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),o=i.crossFadingFactor();1===o&&o===this._crossFadingFactor||(s=!0,this._crossFadingFactor=o),this.style.update(i)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,a,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:a,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new t.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new t.Event("load"))),this.style&&(this.style.hasTransitions()||s)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const e=t.exported.now()-i;n.endQueryEXT(n.TIME_ELAPSED_EXT,r),setTimeout(()=>{const i=n.getQueryObjectEXT(r,n.QUERY_RESULT_EXT)/1e6;n.deleteQueryEXT(r),this.fire(new t.Event("gpu-timing-frame",{cpuTime:e,gpuTime:i}))},50)}if(this.listens("gpu-timing-layer")){const e=this.painter.collectGpuTimers();setTimeout(()=>{const r=this.painter.queryGpuTimers(e);this.fire(new t.Event("gpu-timing-layer",{layerTimes:r}))},50)}const l=this._sourcesDirty||this._styleDirty||this._placementDirty||o;if(l||this._repaint)this.triggerRepaint();else{const e=!this.isMoving()&&this.loaded();if(e&&(o=this._updateAverageElevation(i,!0)),o)this.triggerRepaint();else if(this._triggerFrame(!1),e&&(this.fire(new t.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const e=this._calculateSpeedIndex();this.fire(new t.Event("speedindexcompleted",{speedIndex:e})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const t of this._markers)t._update()}_updateAverageElevation(t,e=!1){const r=t=>(this.transform.averageElevation=t,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&r(0);if((e||t-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(t)){const e=this.transform.averageElevation;let n=this.transform.sampleAverageElevation();isNaN(n)?n=0:this._averageElevationLastSampledAt=t;const i=Math.abs(e-n);if(i>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(n),r(n);this._averageElevation.easeTo(n,t,300)}else if(i>1e-4)return this._averageElevation.jumpTo(n),r(n)}return!!this._averageElevation.isEasing(t)&&r(this._averageElevation.getValue(t))}_authenticate(){t.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,e=>{if(e&&(e.message===t.AUTH_ERR_MSG||401===e.status)){const e=this.painter.context.gl;t.storeAuthState(e,!1),this._logoControl instanceof Ni&&this._logoControl._updateLogo(),e&&e.clear(e.DEPTH_BUFFER_BIT|e.COLOR_BUFFER_BIT|e.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new t.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),t.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const t=this.painter.canvasCopy(),e=this.painter.getCanvasCopiesAndTimestamps();e.timeStamps.push(performance.now());const r=this.painter.context.gl,n=r.createFramebuffer();function i(t){r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0);const e=new Uint8Array(r.drawingBufferWidth*r.drawingBufferHeight*4);return r.readPixels(0,0,r.drawingBufferWidth,r.drawingBufferHeight,r.RGBA,r.UNSIGNED_BYTE,e),e}return r.bindFramebuffer(r.FRAMEBUFFER,n),this._canvasPixelComparison(i(t),e.canvasCopies.map(i),e.timeStamps)}_canvasPixelComparison(t,e,r){let n=r[1]-r[0];const i=t.length/4;for(let o=0;o<e.length;o++){const s=e[o];let a=0;for(let e=0;e<s.length;e+=4)s[e]===t[e]&&s[e+1]===t[e+1]&&s[e+2]===t[e+2]&&s[e+3]===t[e+3]&&(a+=1);n+=(r[o+2]-r[o+1])*(1-a/i)}return n}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==t.window&&(t.window.removeEventListener("resize",this._onWindowResize,!1),t.window.removeEventListener("orientationchange",this._onWindowResize,!1),t.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),t.window.removeEventListener("online",this._onWindowOnline,!1));const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),$i(this._canvasContainer),$i(this._controlContainer),$i(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),t.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new t.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(e){this._renderNextFrame=this._renderNextFrame||e,this.style&&!this._frame&&(this._frame=t.exported.frame(t=>{const e=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,e&&this._render(t)}))}_preloadTiles(e){const r=this.style?Object.values(this.style._sourceCaches):[];return t.asyncAll(r,(t,r)=>t._preloadTiles(e,r),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(t){this._trackResize&&this.resize({originalEvent:t})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(t){this._showTerrainWireframe!==t&&(this._showTerrainWireframe=t,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(t){this._speedIndexTiming!==t&&(this._speedIndexTiming=t,this._update())}get showPadding(){return!!this._showPadding}set showPadding(t){this._showPadding!==t&&(this._showPadding=t,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())}get repaint(){return!!this._repaint}set repaint(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(t){this._vertices=t,this._update()}_setCacheLimits(e,r){t.setCacheLimits(e,r)}get version(){return t.version}},NavigationControl:class{constructor(e){this.options=t.extend({},Zi,e),this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(t.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),o("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),o("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(t.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const e=this._map;e&&(this.options.visualizePitch?e.resetNorthPitch({},{originalEvent:t}):e.resetNorth({},{originalEvent:t}))}),this._compassIcon=o("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const t=this._map;if(!t)return;const e=t.getZoom(),r=e===t.getMaxZoom(),n=e===t.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())}_rotateCompassArrow(){const t=this._map;if(!t)return;const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(t.transform.pitch*(Math.PI/180)),.5)}) rotateX(${t.transform.pitch}deg) rotateZ(${t.transform.angle*(180/Math.PI)}deg)`:`rotate(${t.transform.angle*(180/Math.PI)}deg)`;t._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=e)})}onAdd(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),t.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&t.on("pitch",this._rotateCompassArrow),t.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Xi(t,this._compass,this.options.visualizePitch)),this._container}onRemove(){const t=this._map;t&&(this._container.remove(),this.options.showZoom&&t.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&t.off("pitch",this._rotateCompassArrow),t.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(t,e){const r=o("button",t,this._container);return r.type="button",r.addEventListener("click",e),r}_setButtonTitle(t,e){if(!this._map)return;const r=this._map._getUIString(`NavigationControl.${e}`);t.setAttribute("aria-label",r),t.firstElementChild&&t.firstElementChild.setAttribute("title",r)}},GeolocateControl:class extends t.Evented{constructor(e){super(),this.options=t.extend({},Wi,e),t.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=Fn(this._updateMarkerRotation,20)}onAdd(e){var r;return this._map=e,this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),r=this._setupUI,void 0!==Yi?r(Yi):void 0!==t.window.navigator.permissions?t.window.navigator.permissions.query({name:"geolocation"}).then(t=>{Yi="denied"!==t.state,r(Yi)}):(Yi=!!t.window.navigator.geolocation,r(Yi)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,Hi=0,Ji=!1}_isOutOfMapMaxBounds(t){const e=this._map.getMaxBounds(),r=t.coords;return e&&(r.longitude<e.getWest()||r.longitude>e.getEast()||r.latitude<e.getSouth()||r.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new t.Event("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("geolocate",e)),this._finish()}}_updateCamera(e){const r=new t.LngLat(e.coords.longitude,e.coords.latitude),n=e.coords.accuracy,i=this._map.getBearing(),o=t.extend({bearing:i},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(n),o,{geolocateSource:!0})}_updateMarker(e){if(e){const r=new t.LngLat(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const t=this._map._containerHeight/2,e=this._map.unproject([0,t]),r=this._map.unproject([100,t]),n=e.distanceTo(r)/100,i=Math.ceil(2*this._accuracy/n);this._circleElement.style.width=`${i}px`,this._circleElement.style.height=`${i}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(e){if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&Ji)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("error",e)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(e){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=o("button","mapboxgl-ctrl-geolocate",this._container),o("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===e){t.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=o("div","mapboxgl-user-location"),this._dotElement.appendChild(o("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(o("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ui({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=o("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ui({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",e=>{e.geolocateSource||"ACTIVE_LOCK"!==this._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new t.Event("trackuserlocationend")))})}_onDeviceOrientation(t){this._userLocationDotMarker&&(t.webkitCompassHeading?this._heading=t.webkitCompassHeading:!0===t.absolute&&(this._heading=-1*t.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return t.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Hi--,Ji=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Hi++,Hi>1?(e={maximumAge:6e5,timeout:0},Ji=!0):(e=this.options.positionOptions,Ji=!1),this._geolocationWatchID=t.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else t.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const e=()=>{t.window.addEventListener("ondeviceorientationabsolute"in t.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};void 0!==t.window.DeviceMotionEvent&&"function"==typeof t.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(t=>{"granted"===t&&e()}).catch(console.error):e()}_clearWatch(){t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),t.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),t.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Oi,ScaleControl:class{constructor(e){this.options=t.extend({},Ki,e),t.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Qi(this._map,this._container,this.options)}onAdd(t){return this._map=t,this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(t){this.options.unit=t,Qi(this._map,this._container,this.options)}},FullscreenControl:class{constructor(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof t.window.HTMLElement?this._container=e.container:t.warnOnce("Full screen control 'container' must be a DOM element.")),t.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in t.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in t.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,t.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!t.window.document.fullscreenEnabled&&!t.window.document.webkitFullscreenEnabled)}_setupUI(){const e=this._fullscreenButton=o("button","mapboxgl-ctrl-fullscreen",this._controlContainer);o("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden",!0),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),t.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",t)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(t.window.document.fullscreenElement||t.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?t.window.document.exitFullscreen?t.window.document.exitFullscreen():t.window.document.webkitCancelFullScreen&&t.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends t.Evented{constructor(e){super(),this.options=t.extend(Object.create(eo),e),t.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(e&&e.className?e.className.trim().split(/\s+/):[])}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&e.on("preclick",this._onClose),this.options.closeOnMove&&e.on("move",this._onClose),e.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(e.on("mousemove",this._onMouseEvent),e.on("mouseup",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")):e.on("move",this._update),this.fire(new t.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const e=this._map;return e&&(e.off("move",this._update),e.off("move",this._onClose),e.off("click",this._onClose),e.off("remove",this.remove),e.off("mousemove",this._onMouseEvent),e.off("mouseup",this._onMouseEvent),e.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new t.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(e){this._lngLat=t.LngLat.convert(e),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const t=this._map;return t&&(t.off("move",this._update),t.on("mousemove",this._onMouseEvent),t.on("drag",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(t.window.document.createTextNode(e))}setHTML(e){const r=t.window.document.createDocumentFragment(),n=t.window.document.createElement("body");let i;for(n.innerHTML=e;i=n.firstChild,i;)r.appendChild(i);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(t){return this.options.maxWidth=t,this._update(),this}setDOMContent(t){let e=this._content;if(e)for(;e.hasChildNodes();)e.firstChild&&e.removeChild(e.firstChild);else e=this._content=o("div","mapboxgl-popup-content",this._container||void 0);if(e.appendChild(t),this.options.closeButton){const t=this._closeButton=o("button","mapboxgl-popup-close-button",e);t.type="button",t.setAttribute("aria-label","Close popup"),t.setAttribute("aria-hidden","true"),t.innerHTML="&#215;",t.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(t){return this._classList.add(t),this._updateClassList(),this}removeClassName(t){return this._classList.delete(t),this._updateClassList(),this}setOffset(t){return this.options.offset=t,this._update(),this}toggleClassName(t){let e;return this._classList.delete(t)?e=!1:(this._classList.add(t),e=!0),this._updateClassList(),e}_onMouseEvent(t){this._update(t.point)}_getAnchor(t){if(this.options.anchor)return this.options.anchor;const e=this._map,r=this._container,n=this._pos;if(!e||!r||!n)return"bottom";const i=r.offsetWidth,o=r.offsetHeight,s=n.x<i/2,a=n.x>e.transform.width-i/2;if(n.y+t<o)return s?"top-left":a?"top-right":"top";if(n.y>e.transform.height-o){if(s)return"bottom-left";if(a)return"bottom-right"}return s?"left":a?"right":"bottom"}_updateClassList(){const t=this._container;if(!t)return;const e=[...this._classList];e.push("mapboxgl-popup"),this._anchor&&e.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&e.push("mapboxgl-popup-track-pointer"),t.className=e.join(" ")}_update(t){const e=this._map;if(!e||!this._lngLat&&!this._trackPointer||!this._content)return;let r=this._container;if(r||(r=this._container=o("div","mapboxgl-popup",e.getContainer()),this._tip=o("div","mapboxgl-popup-tip",r),r.appendChild(this._content)),this.options.maxWidth&&r.style.maxWidth!==this.options.maxWidth&&(r.style.maxWidth=this.options.maxWidth),e.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Bi(this._lngLat,this._pos,e.transform)),!this._trackPointer||t){const r=this._pos=this._trackPointer&&t?t:e.project(this._lngLat),n=no(this.options.offset),i=this._anchor=this._getAnchor(n.y),o=no(this.options.offset,i),s=r.add(o).round();e._requestDomTask(()=>{this._container&&i&&(this._container.style.transform=`${ji[i]} translate(${s.x}px,${s.y}px)`)})}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const t=this._container.querySelector(ro);t&&t.focus()}_onClose(){this.remove()}_setOpacity(t){this._content&&(this._content.style.opacity=t),this._tip&&(this._tip.style.opacity=t)}},Marker:Ui,Style:We,LngLat:t.LngLat,LngLatBounds:t.LngLatBounds,Point:t.pointGeometry,MercatorCoordinate:t.MercatorCoordinate,FreeCameraOptions:An,Evented:t.Evented,config:t.config,prewarm:function(){Bt().acquire(Ot)},clearPrewarmedResources:function(){const t=Ft;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(Ot),Ft=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return t.config.ACCESS_TOKEN},set accessToken(e){t.config.ACCESS_TOKEN=e},get baseApiUrl(){return t.config.API_URL},set baseApiUrl(e){t.config.API_URL=e},get workerCount(){return Nt.workerCount},set workerCount(t){Nt.workerCount=t},get maxParallelImageRequests(){return t.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){t.config.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage(e){t.clearTileCache(e)},workerUrl:"",workerClass:null,setNow:t.exported.setNow,restoreNow:t.exported.restoreNow};return io});var i=r;return i})},e3db:function(t,e){var r={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==r.call(t)}}}]);
//# sourceMappingURL=chunk-vendors.0de86057.js.map